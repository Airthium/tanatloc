(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1780],{5094:function(e,t,i){"use strict";i.d(t,{Z:function(){return a}});var l=i(11425);let n=async(e,t)=>{let i=await (0,l.R)("/api/avatar",{method:"POST",headers:{Accept:"application/json"},body:JSON.stringify({file:e,project:t})});return i.json()};var a={add:n}},71270:function(e,t,i){"use strict";i.d(t,{Z:function(){return u}});var l=i(11425);let n=async e=>{await (0,l.R)("/api/plugin",{method:"POST",body:JSON.stringify(e)})},a=async e=>{await (0,l.R)("/api/plugin",{method:"PUT",body:JSON.stringify(e)})},r=async e=>{await (0,l.R)("/api/plugin",{method:"DELETE",body:JSON.stringify(e)})};var o=i(8100),d=i(67294);let s=()=>{let{data:e,error:t,mutate:i}=(0,o.ZP)("/api/plugin",l._),n=(null==e?void 0:e.plugins)||[],a=(0,d.useCallback)(e=>{let t=[...n,e];i({plugins:t})},[n,i]),r=(0,d.useCallback)(e=>{let t=n.filter(t=>t.key!==e.key);i({plugins:t})},[n,i]),s=(0,d.useCallback)(e=>{let t=n.map(t=>(t.key===e.key&&(t={...t,...e}),t));i({plugins:t})},[n,i]);return[n,{mutatePlugins:i,addOnePlugin:a,delOnePlugin:r,mutateOnePlugin:s,errorPlugins:t,loadingPlugins:!e}]};var u={add:n,update:a,del:r,usePlugins:s}},10843:function(e,t,i){"use strict";i.d(t,{Z:function(){return r}});var l=i(11425);let n=async()=>{let e=await (0,l.R)("/api/plugins",{method:"GET",headers:{Accept:"application/json"}});return e.json()},a=async()=>{let e=await (0,l.R)("/api/plugins",{method:"POST",headers:{Accept:"application/json"}});return e.json()};var r={list:n,completeList:a}},26791:function(e,t,i){"use strict";i.d(t,{Z:function(){return y}});var l=i(8100),n=i(67294),a=i(11425);let r=e=>{let{data:t,error:i,mutate:r}=(0,l.ZP)(["/api/projects",JSON.stringify({ids:e})],a._),o=(null==t?void 0:t.projects)||[],d=(0,n.useCallback)(e=>{let t=[...o,{...e,users:[],geometries:[],simulations:[],groups:[]}];r({projects:t})},[o,r]),s=(0,n.useCallback)(e=>{let t=o.filter(t=>t.id!==e.id);r({projects:t})},[o,r]),u=(0,n.useCallback)(e=>{let t=o.map(t=>(t.id===e.id&&(t={...t,...e}),t));r({projects:t})},[o,r]);return[o,{addOneProject:d,delOneProject:s,mutateOneProject:u,errorProjects:i,loadingProjects:!t}]},o=e=>{let{data:t,error:i,mutate:r}=(0,l.ZP)("/api/project"+(e?"/"+e:""),a._),o=(null==t?void 0:t.project)||{id:"0"},d=(0,n.useCallback)(e=>{let t={...o,...e};r({project:t})},[o,r]);return[o,{mutateProject:d,errorProject:i,loadingProject:!t}]},d=async(e,t)=>{let i=await (0,a.R)("/api/project",{method:"POST",headers:{Accept:"application/json"},body:JSON.stringify({workspace:{id:e.id},project:t})});return i.json()},s=async(e,t)=>{await (0,a.R)("/api/project/"+e.id,{method:"PUT",body:JSON.stringify(t)})},u=async(e,t)=>{await (0,a.R)("/api/project/"+t.id,{method:"DELETE",body:JSON.stringify({id:e.id})})},c=async e=>(0,a.R)("/api/project/"+e.id+"/archive",{method:"GET",headers:{Accept:"application/json"}}),m=async e=>(0,a.R)("/api/project/"+e.id+"/archive",{method:"PUT"}),h=async e=>(0,a.R)("/api/project/"+e.id+"/archive",{method:"DELETE"}),p=async(e,t)=>(0,a.R)("/api/project/"+e.id+"/archive",{method:"POST",body:JSON.stringify({archive:t})});var y={useProjects:r,useProject:o,add:d,update:s,del:u,archive:c,unarchiveFromServer:m,deleteArchiveFile:h,unarchiveFromFile:p}},23853:function(e,t,i){"use strict";i.d(t,{Z:function(){return y}});var l=i(8100),n=i(67294),a=i(11425);let r=e=>{let{data:t,error:i,mutate:r}=(0,l.ZP)(["/api/simulations",JSON.stringify({ids:e})],a._),o=(null==t?void 0:t.simulations)||[],d=(0,n.useCallback)(e=>{let t=[...o,e];r({simulations:t})},[o,r]),s=(0,n.useCallback)(e=>{let t=o.filter(t=>t.id!==e.id);r({simulations:t})},[o,r]),u=(0,n.useCallback)((e,t)=>{let i=o.map(t=>(t.id===e.id&&(t={...t,...e}),t));r({simulations:i},t)},[o,r]);return[o,{addOneSimulation:d,delOneSimulation:s,mutateOneSimulation:u,errorSimulations:i,loadingSimulations:!t}]},o=(e,t)=>{let{data:i,error:r,mutate:o}=(0,l.ZP)("/api/simulation"+(e?"/"+e:""),a._,{refreshInterval:t||0}),d=(null==i?void 0:i.simulation)||{id:"0"},s=(0,n.useCallback)(e=>{o({simulation:{...d,...e}})},[d,o]);return[d,{mutateSimulation:s,errorSimulation:r,loadingSimulation:!i}]},d=async(e,t)=>{let i=await (0,a.R)("/api/simulation",{method:"POST",headers:{Accept:"application/json"},body:JSON.stringify({project:{id:e.id},simulation:t})});return i.json()},s=async(e,t)=>{await (0,a.R)("/api/simulation/"+e.id,{method:"PUT",body:JSON.stringify(t)})},u=async e=>{await (0,a.R)("/api/simulation/"+e.id,{method:"DELETE"})},c=async e=>{await (0,a.R)("/api/simulation/"+e.id+"/run",{method:"GET"})},m=async e=>{await (0,a.R)("/api/simulation/"+e.id+"/stop",{method:"GET"})},h=async e=>{let t=await (0,a.R)("/api/simulation/"+e.id+"/tasks",{method:"GET",headers:{Accept:"application/json"}});return t.json()},p=async(e,t)=>{let i=await (0,a.R)("/api/simulation/"+e.id+"/log",{method:"POST",body:JSON.stringify({file:t})});return i.json()};var y={useSimulations:r,useSimulation:o,add:d,update:s,del:u,run:c,stop:m,tasks:h,log:p}},11780:function(e,t,i){"use strict";let l;i.d(t,{ZP:function(){return l2}});var n,a,r,o=i(14288),d=i(5152),s=i.n(d),u=i(11163),c=i(67294),m=i(83062),h=i(97183),p=i(68508),y=i(22850),v=i(71577),f=i(48869),Z=i(99611),g=i(90420),b=i(8751),w=i(18429),x=i(11475),C=i(73480),k=i(22844),S=i(50888),P=i(88484),E=i(64789),O=i(70917);let B=(e,t)=>{if(!e||!t)return!1;let i=e.length,l=t.length;return i===l&&e.every((e,i)=>{let l=t[i];return Array.isArray(e)?B(e,l):"object"==typeof e?j(e,l):e===l})},j=(e,t)=>!!e&&!!t&&JSON.stringify(e)===JSON.stringify(t),T=(e,t,i)=>{let l=(0,c.useRef)();(0,c.useEffect)(()=>{if(!l.current||!l.current.length||!B(l.current,t))return l.current=[...t||[]],e()},[...t||[],...i||[],e])};var M=i(18436),X=i(12271),N=i(67641),z=i(85813),L=i(26713),A=i(20280);let R={notAllowed:"You are not allowed to be here."},I=e=>{e.push("/")},H=()=>{let e=(0,u.useRouter)();return(0,c.useEffect)(()=>{e.prefetch("/")},[e]),(0,o.tZ)(h.Z,{children:(0,o.tZ)(h.Z.Content,{children:(0,o.tZ)(z.Z,{title:"Not allowed",children:(0,o.BX)(L.Z,{direction:"vertical",children:[(0,o.BX)(y.Z.Text,{children:[(0,o.tZ)(A.Z,{style:{color:"red"}})," ",R.notAllowed]}),(0,o.BX)(y.Z.Text,{children:["Go back"," ",(0,o.tZ)(v.Z,{type:"link",onClick:()=>I(e),children:"home"})]})]})})})})},D={enabled:!1,type:void 0,part:void 0,highlighted:void 0,selected:[],point:void 0,dispatch:()=>void 0},U={ENABLE:"ENABLE",DISABLE:"DISABLE",CLEAR:"CLEAR",SETTYPE:"SETTYPE",SETPART:"SETPART",HIGHLIGHT:"HIGHLIGHT",UNHIGHLIGHT:"UNHIGHLIGHT",SELECT:"SELECT",UNSELECT:"UNSELECT",SETPOINT:"SETPOINT"},K=(0,c.createContext)(D),W=(e,t)=>{let i;switch(t.type){case U.ENABLE:return{...e,enabled:!0};case U.DISABLE:return{...e,enabled:!1,highlighted:void 0,selected:[]};case U.CLEAR:return{...D};case U.SETTYPE:return{...e,type:t.value};case U.SETPART:return{...e,part:t.value};case U.HIGHLIGHT:return{...e,highlighted:t.value};case U.UNHIGHLIGHT:return{...e,highlighted:void 0};case U.SELECT:if(-1===(i=e.selected.findIndex(e=>e.uuid===t.value.uuid)))return{...e,selected:[...e.selected,t.value]};return e;case U.UNSELECT:if(-1===(i=e.selected.findIndex(e=>e.uuid===t.value.uuid)))return e;return{...e,selected:[...e.selected.slice(0,i),...e.selected.slice(i+1)]};case U.SETPOINT:return{...e,point:t.value};default:return e}},Y=e=>{let{children:t}=e,[i,l]=(0,c.useReducer)(W,D);return(0,o.tZ)(K.Provider,{value:{...i,dispatch:l},children:t})};var V=i(55734),F=i(26791),G=i(23853),J=i(8100),q=i(11425);let _=e=>{let{data:t,error:i,mutate:l}=(0,J.ZP)(["/api/geometries",JSON.stringify({ids:e})],q._),n=(null==t?void 0:t.geometries)||[],a=(0,c.useCallback)(e=>{let t=[...n,e];l({geometries:t})},[n,l]),r=(0,c.useCallback)(e=>{let t=n.filter(t=>t.id!==e.id);l({geometries:t})},[n,l]),o=(0,c.useCallback)(e=>{let t=n.map(t=>(t.id===e.id&&(t={...t,...e}),t));l({geometries:t})},[n,l]);return[n,{addOneGeometry:a,delOneGeometry:r,mutateOneGeometry:o,errorGeometries:i,loadingGeometries:!t}]},Q=async(e,t)=>{let i=await (0,q.R)("/api/geometry",{method:"POST",body:JSON.stringify({project:e,geometry:t})});return i.json()},$=async(e,t)=>{await (0,q.R)("/api/geometry/"+e.id,{method:"PUT",body:JSON.stringify(t)})},ee=async e=>{await (0,q.R)("/api/geometry/"+e.id,{method:"DELETE"})},et=async e=>{let t=await (0,q.R)("/api/geometry/"+e.id+"/download");return t.json()},ei=async e=>{let t=await (0,q.R)("/api/geometry/"+e.id+"/part");return t.json()};var el={useGeometries:_,add:Q,update:$,del:ee,download:et,getPart:ei},en=i(86159);let ea={sider:(0,O.iv)({height:"100vh",overflow:"hidden","& .ant-layout-sider-children":{height:"100vh",overflow:"hidden",borderRight:"1px solid "+en.Rl.colorPrimary}}),menu1:(0,O.iv)({maxHeight:"calc(100vh - 195px)",overflow:"auto",overflowX:"hidden","& .ant-menu-item-divider":{border:"1px solid "+en.Rl.colorPrimary,margin:"0 30px !important"},"& .Menu-title":{marginTop:"15px !important",lineHeight:"1.5em !important",cursor:"unset",whiteSpace:"normal",height:"4em"}}),menuScroll:(0,O.iv)({maxHeight:"calc(100vh - 180px)",overflow:"auto",overflowX:"hidden"}),menu2:(0,O.iv)({"& .SubMenu":{"& > div":{backgroundColor:"#f5f5f5",border:"1px solid #d9d9d9"},ul:{backgroundColor:"white !important",li:{paddingLeft:"24px !important","> div":{paddingLeft:"0 !important"},".ant-menu-title-content":{"> div":{display:"flex",justifyContent:"space-between"}},ul:{li:{paddingLeft:"24px !important",position:"relative !important",overflow:"visible !important",":not(:last-child)::before":{position:"absolute",content:'""',border:"1px solid #d9d9d9",backgroundColor:"#d9d9d9",height:"18px",width:"0px",top:"33px",left:"30px",zIndex:100}}}}},"& .display-none":{display:"none"}},button:{width:"100%"}})};var er=i(97937);let eo={panel:(0,O.iv)({position:"absolute",top:0,left:"-1px",width:"256px",maxHeight:"100vh",zIndex:100,overflow:"hidden",img:{maxWidth:"80%"},"& > .ant-card-body":{maxHeight:"calc(100vh - 65px)",overflow:"auto",padding:0},"& .ant-card-head":{height:"48px",fontSize:"20px",fontWeight:"bold",padding:"0 12px",border:"none",".ant-btn":{border:"none"}},"& .ant-card":{border:"none"},"& .ant-collapse":{border:"none"},"& .ant-collapse-item":{border:"none"},"& .ant-collapse-content-box":{padding:"0 !important",backgroundColor:"#fafafa",".ant-card-head":{backgroundColor:"#fafafa"},".ant-card-body":{backgroundColor:"#fafafa"}}}),subPanel:(0,O.iv)({"& .ant-card":{border:"none",borderBottom:"1px solid #f0f0f0"},"& .ant-card-body":{paddingRight:"0",paddingLeft:"0"},"& .ant-radio-group":{display:"flex",flexWrap:"wrap",gap:"10px"}})},ed=e=>{let{visible:t,title:i,children:l,onClose:n}=e;return(0,o.tZ)(z.Z,{css:(0,O.iv)([eo.panel,{display:t?"block":"none"}]),title:i,extra:(0,o.tZ)(v.Z,{type:"text",icon:(0,o.tZ)(er.Z,{}),onClick:()=>n()}),children:l})};var es=i(35083),eu=i(31365),ec=i(28345),em=i(48764).lW;let eh={add:"Unable to add geometry"},ep=e=>e.name.toLowerCase().includes(".stp")||e.name.toLowerCase().includes(".step")||e.name.toLowerCase().includes(".dxf"),ey=async e=>{let t=new FileReader;return new Promise(i=>{t.addEventListener("load",()=>{i(t.result)}),t.readAsArrayBuffer(e)})},ev=async(e,t,i)=>{if("uploading"===t.file.status)return!0;if("done"===t.file.status){let l=await ey(t.file.originFileObj);try{let n=await el.add({id:e.id},{name:t.file.name,uid:t.file.uid,buffer:em.from(l)});i.addOneGeometry(n),i.mutateProject({id:e.id,geometries:[...e.geometries,n.id]})}catch(a){throw(0,X.lt)(eh.add,a),a}}return!1},ef=e=>{let{visible:t,project:i,swr:l,setVisible:n}=e,[a,r]=(0,c.useState)(!1);return(0,o.tZ)(ec.ZP,{title:"Upload geometry",visible:t,onCancel:()=>n(!1),cancelButtonProps:{loading:a},children:(0,o.BX)(L.Z,{direction:"vertical",css:en.KP.fullWidth,children:[(0,o.tZ)(eu.Z,{css:(0,O.iv)({"& .ant-upload":{width:"100% !important",height:"100px !important"}}),action:"/api/noop",accept:".stp,.step,.dxf",showUploadList:!1,listType:"picture-card",beforeUpload:ep,async onChange(e){try{let t=await ev(i,e,l);r(t),n(t)}catch(a){r(!1)}},children:(0,o.tZ)("div",{children:a?(0,o.BX)(o.HY,{children:[(0,o.tZ)(S.Z,{style:{fontSize:25}}),(0,o.BX)("div",{style:{marginTop:8},children:[(0,o.tZ)("b",{children:"Loading"}),", converting, ..."]})]}):(0,o.BX)(o.HY,{children:[(0,o.tZ)(P.Z,{style:{fontSize:25}}),(0,o.BX)("div",{style:{marginTop:8},children:[(0,o.tZ)("b",{children:"Choose a file"})," or drop it here"]})]})})}),(0,o.tZ)(y.Z.Text,{children:(0,o.tZ)("p",{style:{color:"rgba(0, 0, 0, 0.45)",textAlign:"center"},children:"Native file format preferred: STEP (3D) or DXF (2D) file"})})]})})};var eZ=i(62806),eg=i(69677);let eb=e=>{let{visible:t,geometry:i,setVisible:l,onEdit:n}=e,a=(0,c.useRef)(null),[r,d]=(0,c.useState)(!1);return(0,c.useEffect)(()=>{a.current&&a.current.focus()}),(0,o.tZ)(ec.ZP,{title:"Edit the geometry's name",visible:t,initialValues:{name:i.name},onCancel:()=>l(!1),async onOk(e){d(!0);try{await n(e),d(!1),l(!1)}catch(t){throw d(!1),t}},loading:r,children:(0,o.tZ)(eZ.Z.Item,{name:"name",label:"Name:",rules:[{required:!0,message:"Name is required"}],children:(0,o.tZ)(eg.Z,{ref:a})})})};var ew=i(48764).lW;let ex={download:"Unable to download geometry",update:"Unable to update geometry",del:"Unable to delete geometry"},eC=async e=>{try{let t=await el.download({id:e.id}),i=new File([ew.from(t.buffer).toString()],e.name+"."+t.extension),l=window.URL.createObjectURL(i),n=document.createElement("a");n.href=l,n.setAttribute("download",e.name+"."+t.extension),n.click(),n.remove()}catch(a){(0,X.lt)(ex.download,a)}},ek=async(e,t,i)=>{try{await el.update({id:e.id},[{key:"name",value:t.name}]),e.name=t.name,i.mutateOneGeometry(e)}catch(l){throw(0,X.lt)(ex.update,l),l}},eS=async(e,t,i,l)=>{try{await el.del({id:e.id});let n=t.geometries.filter(t=>t!==e.id);l.mutateProject({id:t.id,geometries:n}),l.delOneGeometry(e),i()}catch(a){throw(0,X.lt)(ex.del,a),a}},eP=e=>{var t,i,l,n,a,r;let{project:d,geometry:s,swr:u,close:m,onCleanup:p}=e,[v,f]=(0,c.useState)(!1),[Z,g]=(0,c.useState)(!1),[b,w]=(0,c.useState)(!1);return s?(0,o.tZ)(h.Z,{children:(0,o.tZ)(h.Z.Content,{children:(0,o.tZ)(z.Z,{size:"small",title:"Informations",actions:[(0,o.tZ)(M.o6,{loading:v,async onDownload(){f(!0);try{await eC(s)}catch(e){}finally{f(!1)}}},"download"),(0,o.BX)("div",{children:[(0,o.tZ)(eb,{visible:Z,geometry:{id:null==s?void 0:s.id,name:null==s?void 0:s.name},setVisible:g,onEdit:async e=>ek(s,e,u)}),(0,o.tZ)(M.w6,{onEdit:()=>g(!0)})]},"edit"),(0,o.tZ)(M.m1,{loading:b,text:(0,o.BX)(o.HY,{children:["Are you sure you want to delete the geometry"," ",(0,o.tZ)(y.Z.Text,{strong:!0,children:s.name}),"?"]}),async onDelete(){w(!0);try{await eS(s,d,m,u),p(s.id)}finally{w(!1)}}},"delete")],children:(0,o.BX)(L.Z,{direction:"vertical",css:en.KP.fullWidth,children:[(0,o.BX)(y.Z.Text,{children:[(0,o.tZ)("span",{css:en.KP.textLight,children:"File:"})," ",s.name," "]}),(0,o.BX)(y.Z.Text,{children:[(0,o.tZ)("span",{css:en.KP.textLight,children:"Unit:"})," ",(0,o.tZ)(es.Z.Inline,{text:"m"})]}),(0,o.BX)(o.HY,{children:[3===s.summary.dimension&&(0,o.BX)(y.Z.Text,{children:[(0,o.tZ)("span",{css:en.KP.textLight,children:"Number of solids:"})," ",null!==(n=null===(t=s.summary.solids)||void 0===t?void 0:t.length)&&void 0!==n?n:0]}),(0,o.BX)(y.Z.Text,{children:[(0,o.tZ)("span",{css:en.KP.textLight,children:"Number of faces:"})," ",null!==(a=null===(i=s.summary.faces)||void 0===i?void 0:i.length)&&void 0!==a?a:0]}),2===s.summary.dimension&&(0,o.BX)(y.Z.Text,{children:[(0,o.tZ)("span",{css:en.KP.textLight,children:"Number of edges:"})," ",null!==(r=null===(l=s.summary.edges)||void 0===l?void 0:l.length)&&void 0!==r?r:0]})]})]})})})}):(0,o.tZ)(N.Z.Simple,{})};eP.componentName="Geometry",eP.Add=ef;let eE=async(e,t)=>{let i=await (0,q.R)("/api/result",{method:"POST",headers:{Accept:"application/json"},body:JSON.stringify({simulation:e,result:t})});return i.json()},eO=async(e,t)=>(0,q.R)("/api/result/download",{method:"POST",body:JSON.stringify({simulation:e,result:t})}),eB=async e=>(0,q.R)("/api/result/archive",{method:"POST",body:JSON.stringify({simulation:e})});var ej={load:eE,download:eO,archive:eB},eT=i(71648),eM=i(20137),eX=i(72269),eN=i(57953),ez=i(41428),eL=i(38095),eA=i(86350),eR=i(15668),eI=i(35598),eH=i(74317),eD=i(49591),eU=i(19478),eK=i(87784),eW=i(75843),eY=i(15611),eV=i(99477),eF=i(57632),eG=i(79753),eJ=i(54458),eq=i(58939),e_=i(24065),eQ=i(54327);let e$=e=>{let t=new eV.fHI(.025,.025,.8,50);t.translate(0,.4,0);let i=new eV.vBJ({color:e}),l=new eV.Kj0(t,i),n=new eV.b_z(.05,.2,50);n.translate(0,.9,0);let a=new eV.vBJ({color:e}),r=new eV.Kj0(n,a),o=new eV.ZAu;o.type="ArrowHelper",o.add(l),o.add(r);let d=()=>{t.dispose(),i.dispose(),n.dispose(),a.dispose()};return o.dispose=d,o},e0=(e,t,i)=>{let l=document.createElement("canvas");l.width=(null==i?void 0:i.width)||256,l.height=256;let n=l.getContext("2d");n.fillStyle="grey",n.font="50px sans-serif",n.textAlign=(null==i?void 0:i.align)||"center",n.textBaseline="middle",n.fillText(t,l.width/2,l.height/2);let a=new eV.xEZ(l);a.flipY=!0,a.needsUpdate=!0;let r=new eV.xeV({map:a,transparent:!0,depthWrite:!1});r.map.anisotropy=e.capabilities.getMaxAnisotropy();let o=new eV.jyi(r);o.type="LabelHelper",(null==i?void 0:i.position)&&o.position.copy(i.position),(null==i?void 0:i.scale)&&o.scale.setScalar(i.scale);let d=()=>{a.dispose(),r.dispose()};return o.dispose=d,o},e1=function(e,t){let{offsetWidth:i,offsetHeight:l,width:n,height:a}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{offsetWidth:0,offsetHeight:0,width:150,height:150},r=i,o=l,d=n,s=a,u=e$("red");u.rotateZ(-Math.PI/2);let c=e0(e,"X",{position:new eV.Pa4(1.1,0,0)}),m=e$("green"),h=e0(e,"Y",{position:new eV.Pa4(0,1.1,0)}),p=e$("blue");p.rotateX(Math.PI/2);let y=e0(e,"Z",{position:new eV.Pa4(0,0,1.1)}),v=new eV.xo$(.05,50,50),f=new eV.vBJ({color:"black"}),Z=new eV.Kj0(v,f),g=new eV.ZAu;g.type="AxisHelper",g.add(u),g.add(c),g.add(m),g.add(h),g.add(p),g.add(y),g.add(Z);let b=new eV.xsS;b.add(g);let w=new eV.iKG(-1.2,1.2,1.2,-1.2,-2,2),x=e=>{let{newOffsetWidth:t,newOffsetHeight:i,newWidth:l,newHeight:n}=e;r=t,o=i,d=l,s=n},C=()=>{e.setViewport(r,o,d,s),w.rotation.copy(t.rotation),e.render(b,w)},k=()=>{v.dispose(),f.dispose(),g.children.forEach(e=>{("ArrowHelper"===e.type||"LabelHelper"===e.type)&&e.dispose()}),b.remove(g)};return{dispose:k,render:C,resize:x}},e2=function(e,t,i,l){let{offsetWidth:n,offsetHeight:a,width:r,height:o}=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{offsetWidth:0,offsetHeight:0,width:150,height:150},d="#d3d3d3",s=null,u=null,c=[{text:"FRONT",normal:new eV.Pa4(0,0,1),up:new eV.Pa4(0,1,0)},{text:"BACK",normal:new eV.Pa4(0,0,-1),up:new eV.Pa4(0,1,0)},{text:"RIGHT",normal:new eV.Pa4(1,0,0),up:new eV.Pa4(0,1,0)},{text:"LEFT",normal:new eV.Pa4(-1,0,0),up:new eV.Pa4(0,1,0)},{text:"UP",normal:new eV.Pa4(0,1,0),up:new eV.Pa4(0,0,-1)},{text:"DOWN",normal:new eV.Pa4(0,-1,0),up:new eV.Pa4(0,0,1)}],m=new eV._12(75,75),h=new eV.TOt(m),p=new eV.xo$(37.5,10,10,0,Math.PI,0),y=new eV.ZAu;c.forEach(e=>{let t=document.createElement("canvas"),i=t.getContext("2d");t.width=t.height=256,i.fillStyle=d,i.fillRect(0,0,t.width,t.height),i.font="bold 50pt sans-serif",i.fillStyle="#000000",i.textAlign="center",i.textBaseline="middle",i.fillText(e.text,t.width/2,t.height/2);let l=new eV.ROQ(t);l.needsUpdate=!0;let n=new eV.vBJ({map:l}),a=new eV.vBJ({color:d}),r=new eV.Kj0(m,n),o=new eV.Kj0(m,a);o.rotateY(Math.PI);let s=new eV.nls({color:"#ffffff"}),u=new eV.ejS(h,s),c=new eV.vBJ({color:d,transparent:!0,opacity:.2}),v=new eV.Kj0(p,c),f=new eV.ZAu;f.add(r,o,u,v),f.lookAt(e.normal),f.translateZ(50),f.normal=e.normal,f.up=e.up,y.add(f)});let v=new eV.Mig("#ffffff",1),f=new eV.xsS;f.add(y),f.add(v);let Z=new eV.iKG(-100,100,100,-100,-100,100);Z.position.z=2;let g=new eV.iMs,b=e=>{let t=w(e);x(t)?(s=C(t),k(),(null==s?void 0:s.uuid)!==(null==u?void 0:u.uuid)&&(S(),u=s)):(s=null,S())},w=e=>{let t=e.target,i=t.getBoundingClientRect(),l=e.clientX-i.left,d=e.clientY-i.top,s=new eV.FM8;return s.x=(l-n)/r*2-1,s.y=-(2*((d+o-i.height+a)/o))+1,s},x=e=>e.x>-1&&e.x<1&&e.y>-1&&e.y<1,C=e=>{let t=new eV.Pa4(e.x,e.y,-1);t.unproject(Z);let i=new eV.Pa4;Z.getWorldDirection(i),g.set(t,i);let l=g.intersectObjects(f.children,!0);return l.length?l[0].object.parent:null},k=()=>{s&&s.children&&s.children.forEach(e=>{let t=e;t.material&&t.material.color&&(t.material.previousColor=t.material.color,t.material.color=new eV.Ilk("#FAD114"))})},S=()=>{u&&u.children&&u.children.forEach(e=>{let t=e;t.material&&t.material.color&&(t.material.color=new eV.Ilk(d))})},P=e=>{if(s){let n=s.normal,a=s.up,r=new eV.Pa4;t.boundingBox&&t.boundingBox.getCenter(r);let o=i.position.distanceTo(l.target),d=n.clone().multiplyScalar(o),u=r.add(d);i.position.copy(u),i.up.copy(a),s=null,S(),b(e)}};e.domElement.addEventListener("pointermove",b),e.domElement.addEventListener("pointerdown",P);let E=e=>{let{newOffsetWidth:t,newOffsetHeight:i,newWidth:l,newHeight:d}=e;n=t,a=i,r=l,o=d},O=()=>{e.setViewport(n,a,r,o),Z.rotation.copy(i.rotation),e.render(f,Z)},B=()=>{e.domElement.removeEventListener("pointermove",b),e.domElement.removeEventListener("pointerdown",P),y.children.forEach(e=>{e.children.forEach(e=>{e.geometry.dispose(),e.material.dispose()})}),f.remove(y)};return{resize:E,render:O,dispose:B}},e5=e=>1e-12>Math.abs(e)?"0":Math.abs(e)>1e3||.001>Math.abs(e)?e.toExponential(2):e.toFixed(3),e4=(e,t,i,l)=>{let n,a,r;let o=e=>{let t=Math.max(e.x,e.y,e.z),i=Math.max(Math.ceil(e.x/t*5),2),l=Math.max(Math.ceil(e.y/t*5),2),n=Math.max(Math.ceil(e.z/t*5),2);return new eV.Pa4(i,l,n)},d=(e,t,i,l,n)=>{let a=new eV.ZAu,r=new eV.nls({color:8947848}),o=new eV.Pa4(-e/2,0,-t/2),d=e/(i-1),s=t/(l-1);for(let u=0;u<l;++u){let c=new eV.u9r().setFromPoints([new eV.Pa4(o.x,0,o.z+u*s),new eV.Pa4(o.x+e,0,o.z+u*s)]);a.add(new eV.x12(c,r))}for(let m=0;m<i;++m){let h=new eV.u9r().setFromPoints([new eV.Pa4(o.x+m*d,0,o.z),new eV.Pa4(o.x+m*d,0,o.z+t)]);a.add(new eV.x12(h,r))}return null==n||n(a),a},s=(t,i,l,n)=>{let a=new eV.ZAu,r=Math.abs(i-t),o=r/(n-1),d=new eV.Pa4().copy(l).multiplyScalar(-r/2),s=new eV.Pa4().copy(l).multiplyScalar(o),u=t;for(let c=0;c<n;++c){let m=e0(e,e5(u));m.position.copy(d),a.add(m),d.add(s),u+=o}return a},u=()=>{let e=t.boundingBox,i=t.boundingSphere.center,l=new eV.Pa4(e.max.x-e.min.x,e.max.y-e.min.y,e.max.z-e.min.z),r=o(l);a=1*(n=.1*Math.max(l.x,l.y,l.z));let u=new eV.ZAu,c=d(l.x,l.z,r.x,r.z),m=d(l.x,l.y,r.x,r.y,e=>{e.rotateX(Math.PI/2)}),h=d(l.y,l.z,r.y,r.z,e=>{e.rotateZ(-Math.PI/2)});u.add(c,m,h);let p=s(e.min.x,e.max.x,new eV.Pa4(1,0,0),r.x),v=s(e.min.y,e.max.y,new eV.Pa4(0,1,0),r.y),f=s(e.min.z,e.max.z,new eV.Pa4(0,0,1),r.z);return u.add(p,v,f),u.position.set(i.x,i.y,i.z),u.type="GridHelper",u.dispose=y,u},c=e=>e<=0?-1:1,m=e=>.5>=Math.abs(e)?1:-1,h=()=>{let e=t.boundingBox,o=new eV.Pa4(e.max.x-e.min.x,e.max.y-e.min.y,e.max.z-e.min.z),d=!1;t.children.forEach(e=>{"GridHelper"===e.type&&(d=e.visible,t.remove(e),e.dispose())}),r=u();let s=l.object.position.distanceTo(l.target);r.traverse(e=>{"LabelHelper"===e.type&&e.scale.setScalar(.05*s)});let h=new eV.Pa4;i.getWorldDirection(h);let p=s/10/(l.minDistance+.001),y=r.children[0],v=r.children[1],f=r.children[2];y.position.set(0,c(h.y)*(o.y/2+n),0),v.position.set(0,0,c(h.z)*(o.z/2+n)),f.position.set(c(h.x)*(o.x/2+n),0,0);let Z=r.children[3],g=r.children[4],b=r.children[5];Z.position.set(0,c(h.y)*m(h.y)*(o.y/2+a),-(c(h.z)*m(h.y)*(o.z/2+a))),g.position.set(c(h.x)*m(h.x)*(o.x/2+a),0,-(c(h.z)*m(h.x)*(o.z/2+a))),b.position.set(c(h.x)*m(h.x)*(o.x/2+a),-(c(h.y)*m(h.x)*(o.y/2+a)),0);let w=.2*p,x=.3*p;Z.visible=Math.abs(h.y)>w||Math.abs(h.z)>x,g.visible=Math.abs(h.x)>x||Math.abs(h.z)>x,b.visible=Math.abs(h.x)>x||Math.abs(h.y)>w,r.visible=d,t.add(r)},p=e=>{r.visible=e},y=()=>{null==r||r.children.forEach(e=>{e.children.forEach(e=>{if("Line"===e.type){let t=e.geometry;t.dispose();let i=e.material;i.dispose()}else e.dispose()})})};return{dispose:y,setVisible:p,update:h}},e8=(e,t,i,l)=>{let n=document.createElement("div");n.style.pointerEvents="none",n.style.border="1px solid #55aaff",n.style.backgroundColor="rgba(75, 160, 255, 0.3)",n.style.position="fixed";let a=new eV.FM8,r=new eV.FM8,o=new eV.FM8,d=new eV.FM8,s=!1,u=!1,c=new eV.iMs,m=()=>{s=!0},h=()=>{s=!1},p=e=>{s&&0===e.button&&(u=!0,f(e))},y=e=>{s&&u&&Z(e)},v=e=>{u=!1,s&&g(e)};e.domElement.addEventListener("pointerdown",p),e.domElement.addEventListener("pointermove",y),e.domElement.addEventListener("pointerup",v);let f=t=>{l.enabled=!1,e.domElement.parentElement.appendChild(n),n.style.left=t.clientX+"px",n.style.top=t.clientY+"px",n.style.width="0px",n.style.height="0px",a.x=t.clientX,a.y=t.clientY},Z=e=>{d.x=Math.max(a.x,e.clientX),d.y=Math.max(a.y,e.clientY),o.x=Math.min(a.x,e.clientX),o.y=Math.min(a.y,e.clientY),n.style.left=o.x+"px",n.style.top=o.y+"px",n.style.width=d.x-o.x+"px",n.style.height=d.y-o.y+"px"},g=e=>{l.enabled=!0,n.parentElement&&n.parentElement.removeChild(n),r.x=e.clientX,r.y=e.clientY;let t=new eV.TUj(a,r);b(t),h()},b=n=>{let a=new eV.FM8;if(n.getSize(a),a.x<5||a.y<5)return;let r=new eV.FM8((n.max.x+n.min.x)/2,(n.max.y+n.min.y)/2),o=e.domElement.getBoundingClientRect(),d=r.x-o.left,s=r.y-o.top,u=new eV.FM8(d/o.width*2-1,-(2*(s/o.height))+1),m=t.children.find(e=>"Part"===e.type);if(!m)return;c.setFromCamera(u,i);let h=c.intersectObject(m);if(!h.length)return;l.target.copy(h[0].point);let p=new eV.FM8(a.x/o.width,a.y/o.height),y=Math.max(p.x,p.y),v=i.position.distanceTo(l.target),f=l.target.clone().sub(i.position).normalize().multiplyScalar(v*(1-y));i.position.add(f)},w=()=>{e.domElement.removeEventListener("pointerdown",p),e.domElement.removeEventListener("pointermove",y),e.domElement.removeEventListener("pointerup",v)};return{dispose:w,end:h,isEnabled:()=>s,start:m}},e3=(e,t,i,l)=>{let n,a,r;let o=new eV.Ilk("#fad114"),d=new eV.Ilk("#E98A15"),s=new eV.Pa4(-1,0,0),u=new eV.JOQ(s),c={up:new eV.Pa4,forward:new eV.Pa4,right:new eV.Pa4},m=new eV.Pa4,h=new eV.Pa4,p=new eV.USm,y=new eV.Pa4,v=new eV.FM8,f=new eV.JOQ,Z=new eV.Pa4,g=new eV.Pa4,b=new eV.Zzh,w={up:new eV.Pa4,forward:new eV.Pa4,right:new eV.Pa4},x=new eV.iMs,C=new eV.ZAu;C.type="SectionViewHelper",C.visible=!1,t.add(C),(()=>{let e=new eV._12(1,1),t=new eV.vBJ({color:o,side:eV.ehD,transparent:!0,opacity:.5}),i=new eV.Kj0(e,t);i.type="Plane",C.add(i)})(),(()=>{let e=new eV.xo$(.2,32,32,Math.PI,-Math.PI),t=new eV.vBJ({color:o,side:eV.ehD,transparent:!0,opacity:.5}),i=new eV.Kj0(e,t);i.type="Dome",C.add(i)})(),(()=>{class e extends eV.Hyl{getPoint(e){return new eV.Pa4().set(this.radius*Math.cos(Math.PI*e),this.radius*Math.sin(Math.PI*e),0)}constructor(e){super(),this.radius=e}}let t=new e(.2);{let i=new eV.WXh(t,32,.020000000000000004,32),l=new eV.vBJ({color:o,side:eV.ehD,transparent:!0,opacity:.5}),n=new eV.Kj0(i,l);n.rotateX(Math.PI/2),n.type="ArcX",C.add(n)}{let a=new eV.WXh(t,32,.020000000000000004,32),r=new eV.vBJ({color:o,side:eV.ehD,transparent:!0,opacity:.5}),d=new eV.Kj0(a,r);d.rotateX(Math.PI/2),d.rotateY(Math.PI/2),d.type="ArcY",C.add(d)}})();let k=()=>{let e=new eV.Pa4;t.boundingBox.getSize(e),e.multiplyScalar(1.2);let i=Math.max(Math.max(e.x,e.y),e.z);C.scale.setScalar(i)},S=()=>{let e=new eV.Pa4;t.boundingBox.getCenter(e),C.position.copy(e)},P=()=>{let e=C.visible;C.visible=!e},E=()=>{e.localClippingEnabled=!0,C.visible=!0,k(),S();let t=new eV.Pa4().copy(C.position).sub(s);C.lookAt(t),u.setFromNormalAndCoplanarPoint(s,C.position)},O=()=>{e.localClippingEnabled=!1,C.visible=!1},B=e=>{if(S(),s.equals(e)){j();return}let t=new eV.Pa4().copy(C.position).sub(e);C.lookAt(t),u.setFromNormalAndCoplanarPoint(e,C.position),s.copy(e)},j=()=>{C.rotateX(Math.PI);let e=u.normal.multiplyScalar(-1);u.setFromNormalAndCoplanarPoint(e,C.position)},T=()=>{C.traverse(e=>{("Plane"===e.type||"Dome"===e.type||"ArcX"===e.type||"ArcY"===e.type)&&(e.geometry.dispose(),e.material.dispose())}),e.domElement.removeEventListener("pointermove",R),e.domElement.removeEventListener("pointerdown",V),e.domElement.removeEventListener("pointerup",F)},M=e=>{let t=e.target,i=t.getBoundingClientRect(),l=e.clientX-i.left,n=e.clientY-i.top,a=new eV.FM8;return a.x=l/i.width*2-1,a.y=-(2*(n/i.height))+1,a},X=e=>{n&&n.material.color.set(o),n=e,e&&e.material.color.set(d)},N=()=>{l.enabled=!0},z=()=>{l.enabled=!1},L=()=>{i.getWorldDirection(c.forward),c.forward.normalize(),c.up.copy(i.up).normalize(),c.right.crossVectors(c.up,c.forward).normalize()},A=()=>{let e=new eV.Pa4(0,0,1).applyQuaternion(C.quaternion).multiplyScalar(-1);u.setFromNormalAndCoplanarPoint(e,C.position)},R=e=>{if(!C.visible)return;let t=M(e);if(x.setFromCamera(t,i),a){let l=new eV.Pa4;x.ray.intersectPlane(f,l),(null==r?void 0:r.type)==="Plane"?H(l):(null==r?void 0:r.type)==="Dome"?U(t):W(l),A()}else{let n=x.intersectObject(C);n.length?(z(),X(r=n[0].object),h.copy(n[0].point),L()):(r=null,X(),N())}},I=()=>{f.setFromNormalAndCoplanarPoint(c.forward,h),m.copy(C.position);let e=new eV.Pa4;x.ray.intersectPlane(f,e),Z.copy(e).sub(m),g.copy(Z).normalize(),b.set(m,new eV.Pa4().copy(m).add(u.normal))},H=e=>{e.sub(Z);let t=new eV.Pa4;b.closestPointToPoint(e,!1,t),C.position.copy(t)},D=e=>{p.copy(C.rotation),v.copy(e)},U=e=>{C.rotation.copy(p),C.rotateOnWorldAxis(c.up,-(5*(v.x-e.x))),C.rotateOnWorldAxis(c.right,-(5*(v.y-e.y)))},K=()=>{r.getWorldDirection(y),p.copy(C.rotation),Z.copy(h).sub(C.position),g.copy(Z).normalize(),w.up.copy(g),w.right.copy(y),w.forward.crossVectors(w.right,w.up),b.set(h,new eV.Pa4().copy(h).add(w.forward)),f.setFromNormalAndCoplanarPoint(c.forward,h)},W=e=>{let t=l.object.position.distanceTo(l.target),i=new eV.Pa4;b.closestPointToPoint(e,!1,i);let n=h.distanceTo(i);i.sub(h);let a=new eV.Pa4().copy(g).cross(i).normalize(),r=Math.sign(y.dot(a));C.rotation.copy(p),C.rotateOnWorldAxis(y,r*n*1/(t/100))},Y=e=>{switch(null==r?void 0:r.type){case"Plane":I();break;case"Dome":D(e);break;case"ArcX":case"ArcY":K()}},V=e=>{if(C.visible&&r){a=!0;let t=M(e);Y(t)}},F=()=>{C.visible&&(a=!1,X())};return e.domElement.addEventListener("pointermove",R),e.domElement.addEventListener("pointerdown",V),e.domElement.addEventListener("pointerup",F),{getClippingPlane:()=>u,toggleVisible:P,start:E,stop:O,toAxis:B,flip:j,dispose:T}};var e6=i(54104);let e7=e=>{let t=new eV.xsS,i=new eV.iKG(-1,1,1,-1,2,1);i.position.set(0,0,1);let l=new eV.ZAu;t.add(l);let n=e=>{t.children.forEach(t=>{t.children.forEach(t=>t.visible=e)})},a=()=>{t.children.forEach(e=>e.children.forEach(t=>{"LabelHelper"===t.type&&t.dispose(),"Sprite"===t.type&&t.dispose(),e.remove(t)}))},r=e=>{a();let t=new e6.A("rainbow",e.n);t.setMin(e.minV),t.setMax(e.maxV);let i=new eV.ROQ(t.createCanvas()),n=new eV.xeV({map:i,depthWrite:!1}),r=new eV.jyi(n);r.material.rotation=-Math.PI/2,r.scale.x=.2,r.scale.y=1.2,r.dispose=r.material.dispose,l.add(r),o(t)},o=t=>{let i=e5(t.minV),n=e5(t.maxV),a=e0(e,String(i),{position:new eV.Pa4(-.62,0,0),width:512,align:"right"});a.scale.x=.4,a.scale.y=2.8;let r=e0(e,String(n),{position:new eV.Pa4(.62,0,0),width:512,align:"left"});r.scale.x=.4,r.scale.y=2.8,l.add(a),l.add(r)},d=()=>{let l=e.domElement.getBoundingClientRect();e.setViewport(l.width/2-350,l.height-50,700,50),e.render(t,i)},s=()=>{a()};return{render:d,setLUT:r,setVisible:n,dispose:s}},e9=e=>{let t=new eV.ZAu;t.type="PointHelper",t.visible=!1,e.add(t);let i=()=>{var t,i;let l=(null!==(i=null===(t=e.boundingSphere)||void 0===t?void 0:t.radius)&&void 0!==i?i:1)/100,n=new eV.xo$(l),a=new eV.Wid({color:16711680});return new eV.Kj0(n,a)},l=(e,t)=>{let i=new eV.u9r().setFromPoints([e,t]),l=new eV.nls({color:16711680});return new eV.x12(i,l)},n=()=>{let t=[],i=e.boundingBox.max.x-e.boundingBox.min.x,n=e.boundingBox.max.y-e.boundingBox.min.y,a=e.boundingBox.max.z-e.boundingBox.min.z,r=Math.max(i,n,a),o=l(new eV.Pa4(-r/2,0,0),new eV.Pa4(r/2,0,0));t.push(o);let d=l(new eV.Pa4(0,-r/2,0),new eV.Pa4(0,r/2,0));t.push(d);let s=l(new eV.Pa4(0,0,-r/2),new eV.Pa4(0,0,r/2));return t.push(s),t},a=()=>{o();let e=i(),l=n();t.add(e),t.add(...l)},r=e=>{e?(t.position.set(e.x,e.y,e.z),t.visible=!0):t.visible=!1},o=()=>{t.children.forEach(e=>{t.remove(e),e.geometry.dispose(),e.material.dispose()})};return{build:a,dispose:o,update:r}};var te=i(1217),tt=i(82854),ti=i(6648),tl=i(48764).lW;let tn=(e,t)=>{e.traverse(e=>{if("Mesh"===e.type){let i=e,l=new eV.Uk6(i.geometry),n=new eV.nls({color:i.material.color,linewidth:1}),a=new eV.ejS(l,n);i.add(a),i.material.visible=!1,i.material.clippingPlanes=[t]}})},ta=(e,t)=>{e.traverse(e=>{if("Mesh"===e.type||"Line"===e.type){let i=e,l=i.geometry.getAttribute("data");if(l){let n=l.array.reduce((e,t)=>Math.min(e,t),l.array[0]),a=l.array.reduce((e,t)=>Math.max(e,t),l.array[0]);n===a&&(n-=1,a+=1);let r=new e6.A;r.setMin(n),r.setMax(a);let o=new Float32Array(3*l.count);for(let d=0;d<l.count;d++){let s=r.getColor(l.array[d]);o[3*d+0]=s.r,o[3*d+1]=s.g,o[3*d+2]=s.b}i.geometry.setAttribute("color",new eV.a$l(o,3)),i.userData={...i.userData,lut:r}}if("Mesh"===e.type){let u=new eV.Uk6(i.geometry),c=new eV.nls({linewidth:1}),m=new eV.ejS(u,c);i.add(m)}i.material.vertexColors=!0,i.material.clippingPlanes=[t]}})},tr=(e,t)=>{e.traverse(e=>{if("Mesh"===e.type){let i=e;i.material.clippingPlanes=[t],i.material.originalColor=i.material.color}})},to=(e,t)=>{let i=new eV.Ilk("#FAD114"),l=new eV.Ilk("#EE9817"),n=async(e,t,i,l)=>{let n=new Blob([tl.from(e.buffer)]),s=URL.createObjectURL(n),u=new te.E,c=new tt._;c.setDecoderPath("/three/libs/draco/"),u.setDRACOLoader(c);let m=new ti.a;m.setTranscoderPath("node_modules/three//examples/js/libs/basis/"),u.setKTX2Loader(m);let h=await new Promise((e,t)=>{u.load(s,t=>{e(t)},()=>void 0,e=>t(e))}),p=h.scene,g=new eV.Tme;return g.type="Part",g.uuid=e.summary.uuid,g.children=p.children,g.userData=p.userData,"mesh"===e.summary.type?tn(g,l):"result"===e.summary.type?ta(g,l):("geometry3D"===e.summary.type||"geometry2D"===e.summary.type)&&tr(g,l),o(g,t),d(g,i),g.boundingBox=a(g),g.dispose=()=>r(g),g.setTransparent=e=>o(g,e),g.setDisplayMesh=e=>d(g,e),g.startSelection=(e,t,i,l)=>f(g,e,t,i,l),g.stopSelection=()=>Z(),g.getHighlighted=()=>y,g.getSelected=()=>v,g.highlight=O,g.unhighlight=B,g.select=T,g.unselect=M,g},a=e=>{let t=new eV.ZzF;return e.traverse(e=>{t.expandByObject(e)}),t},r=e=>{e.traverse(e=>{"Mesh"===e.type&&(e.geometry.dispose(),e.material.dispose())})},o=(e,t)=>{e.traverse(e=>{if("Mesh"===e.type){let i=e;i.material.transparent=t,i.material.opacity=t?.5:1,i.material.depthWrite=!t}})},d=(e,t)=>{"result"===e.userData.type&&e.traverse(e=>{e.traverse(e=>{if("LineSegments"===e.type){let i=e;i.visible=t}})})},s=new eV.iMs,u=null,c=null,m=null,h=null,p=null,y=null,v=[],f=(e,t,i,l,n)=>{u=e,c=n,m=t,h=i,(p=l).selectedObjects=[],y=null,v.length=0,m.domElement.addEventListener("pointermove",S),m.domElement.addEventListener("pointerdown",j)},Z=()=>{m&&m.domElement.removeEventListener("pointermove",S),m&&m.domElement.removeEventListener("pointerdown",j),B(),y=null,v.forEach(e=>{M(e.uuid)}),v.length=0,c=null,u=null,m=null,h=null,p=null},g=(e,t)=>{let i;if(e&&t)return e.traverse(e=>{e.userData.uuid===t&&(i=e)}),i},b=e=>{let t=e.target,i=t.getBoundingClientRect(),l=e.clientX-i.left,n=e.clientY-i.top,a=new eV.FM8;return a.x=l/i.width*2-1,a.y=-(2*(n/i.height))+1,a},w=()=>{let t=s.intersectObject(u,!0);if(t.length){let i=t[0].object,l=i.parent;l&&e(u,l.userData.uuid,l.userData.label)}else e(u)},x=()=>{let t;let i=u.userData;if(2===i.dimension){if((t=s.intersectObject(u,!0)).length){let l=t[0].object,n=l.parent;(null==n?void 0:n.type)==="Mesh"?e(u,n.userData.uuid,n.userData.label):e(u,l.userData.uuid,l.userData.label)}else e(u)}else if((t=s.intersectObject(u,!0)).length){let a=t[0].object;e(u,a.userData.uuid,a.userData.label)}else e(u)},C=()=>{let t;let i=u.userData,l=i.edges;if((t=s.intersectObject(u,!0)).length){let n=t[0].object,a=null==l?void 0:l.find(e=>e.uuid===n.userData.uuid);a?e(u,n.userData.uuid,n.userData.label):e(u)}else e(u)},k=()=>{let t=s.intersectObject(u,!0);if(t.length){let i=t[0];e(u,void 0,void 0,i.point)}else e(u)},S=e=>{let t=b(e);switch(s.setFromCamera(t,h),c){case"solids":w();break;case"faces":x();break;case"edges":C();break;case"point":k()}},P=(e,t)=>{if(t){let i=p.selectedObjects.find(t=>t.userData.uuid===e.userData.uuid);i||p.selectedObjects.push(e)}else{let l=v.find(t=>t.uuid===e.userData.uuid);l||p.selectedObjects.push(e)}},E=(e,t)=>{if(t){let i=p.selectedObjects.findIndex(t=>t.userData.uuid===e.userData.uuid);p.selectedObjects=[...p.selectedObjects.slice(0,i),...p.selectedObjects.slice(i+1)]}else{let l=v.find(t=>t.uuid===e.userData.uuid);if(!l){let n=p.selectedObjects.findIndex(t=>t.userData.uuid===e.userData.uuid);p.selectedObjects=[...p.selectedObjects.slice(0,n),...p.selectedObjects.slice(n+1)]}}},O=e=>{if(e===(null==y?void 0:y.uuid))return;B();let t=g(u,e);if(t){if(y={uuid:t.userData.uuid,label:t.userData.label},P(t),"Mesh"===t.type){let l=t;l.material.color=i}else t.traverse(e=>{if("Mesh"===e.type){let t=e;t.material.color=i}})}},B=()=>{let e=g(u,null==y?void 0:y.uuid);if(y=null,!e)return;E(e);let t=v.findIndex(t=>t.uuid===e.userData.uuid);if("Mesh"===e.type){let i=e;i.material.color=-1===t?i.material.originalColor:l}else e.traverse(e=>{if("Mesh"===e.type){let i=e;i.material.color=-1===t?i.material.originalColor:l}})},j=()=>{y&&t(u,y.uuid,y.label)},T=e=>{let t=g(u,e);if(t){if(v.push({uuid:e,label:t.userData.label}),P(t,!0),"Mesh"===t.type){let i=t;i.material.color=l}else t.traverse(e=>{if("Mesh"===e.type){let t=e;t.material.color=l}})}},M=e=>{let t=g(u,e),i=v.findIndex(t=>t.uuid===e);if(-1!==i&&(v=[...v.slice(0,i),...v.slice(i+1)]),t){if(E(t,!0),"Mesh"===t.type){let l=t;l.material.color=l.material.originalColor}else t.traverse(e=>{if("Mesh"===e.type){let t=e;t.material.color=t.material.originalColor}});t.visible=!0}};return{load:n}},td=()=>({type:U.ENABLE}),ts=()=>({type:U.DISABLE}),tu=e=>({type:U.SETTYPE,value:e}),tc=e=>({type:U.SETPART,value:e}),tm=e=>{let{uuid:t,label:i}=e;return{type:U.HIGHLIGHT,value:{uuid:t,label:i}}},th=()=>({type:U.UNHIGHLIGHT}),tp=e=>{let{uuid:t,label:i}=e;return{type:U.SELECT,value:{uuid:t,label:i}}},ty=e=>{let{uuid:t,label:i}=e;return{type:U.UNSELECT,value:{uuid:t,label:i}}},tv=e=>({type:U.SETPOINT,value:e});var tf=i(5094);let tZ={view:(0,O.iv)({width:"100%",height:"100%"}),head:(0,O.iv)({position:"absolute",top:"160px",right:0,bottom:0,backgroundColor:"transparent !important",zIndex:10,height:"calc(100% - 160px)",padding:"0 57px",display:"flex",flexDirection:"column",rowGap:"10px",alignItems:"center"}),content:(0,O.iv)({width:"100%",height:"100%",position:"relative"}),loading:(0,O.iv)({position:"absolute",top:0,left:0,width:"100%",height:"100%",background:"rgba(128, 128, 118, 0.1)",zIndex:100,display:"flex",justifyContent:"center",alignItems:"center"}),canvas:(0,O.iv)({position:"absolute",top:0,left:0,bottom:0,right:0})},tg={load:"Error while loading part",snapshot:"Error while taking snapshot",saveScreenshot:"Unable to save screenshot"},tb=!1,tw=e=>{let t=new eV.ZzF;e.children.forEach(e=>{if(e.visible&&"Part"===e.type){let i=e.boundingBox,l=new eV.Pa4(Math.min(t.min.x,i.min.x),Math.min(t.min.y,i.min.y),Math.min(t.min.z,i.min.z)),n=new eV.Pa4(Math.max(t.max.x,i.max.x),Math.max(t.max.y,i.max.y),Math.max(t.max.z,i.max.z));t.set(l,n)}});let i=new eV.aLr;t.getBoundingSphere(i),e.boundingBox=t,e.boundingSphere=i},tx=(e,t,i)=>{let l=t.object.position.distanceTo(t.target),n=t.target.clone().sub(e.position).normalize().multiplyScalar(l*i*.01);e.position.add(n)},tC=(e,t)=>{tx(e,t,1);let i=()=>tC(e,t);l=requestAnimationFrame(i)},tk=(e,t)=>{tx(e,t,-1);let i=()=>tk(e,t);l=requestAnimationFrame(i)},tS=()=>{l&&cancelAnimationFrame(l),l=void 0},tP=(e,t,i)=>{let l=e.children.find(e=>"Part"===e.type);if(!l)return;tb=!0;let n=e.boundingSphere,a=n.center,r=2*n.radius,o=r/(2*Math.atan(Math.PI*t.fov/360)),d=o/t.aspect,s=1.1*Math.max(o,d),u=i.target.clone().sub(t.position).normalize().multiplyScalar(s);i.target.copy(a),i.minDistance=s/10,i.maxDistance=10*s,t.position.copy(a).sub(u),t.near=s/100,t.far=100*s,t.updateProjectionMatrix()},tE=async(e,t,i,l,n,a,r)=>{let o=(e,t,i,l)=>{t?(e.highlight(t),setTimeout(()=>r(tm({uuid:t,label:i})),1)):l?r(tv({x:l.x,y:l.y,z:l.z})):(e.unhighlight(),setTimeout(()=>r(th()),1))},d=(e,t,i)=>{let l=e.getSelected();l.find(e=>e.uuid===t)?(e.unselect(t),setTimeout(()=>r(ty({uuid:t,label:i})),1)):(e.select(t),setTimeout(()=>r(tp({uuid:t,label:i})),1))},s=to(o,d),u=await s.load(e,n.transparent,n.displayMesh,a.sectionViewHelper.getClippingPlane());t.add(u),tw(t),tb||tP(t,i,l),a.gridHelper.update(),a.gridHelper.update(),a.gridHelper.setVisible(!0),u.children[0].userData.lut?(a.colorbarHelper.setLUT(u.children[0].userData.lut),a.colorbarHelper.setVisible(!0)):a.colorbarHelper.setVisible(!1),a.pointHelper.build()},tO=(e,t)=>{e.setVisible(t)},tB=async(e,t,i,l)=>{try{let n=l.domElement.width,a=l.domElement.height,r=i.aspect;l.domElement.width=520,l.domElement.height=312,i.aspect=520/312,i.updateProjectionMatrix(),l.clear(),l.setViewport(0,0,520,312),l.render(t,i);let o=l.domElement.toDataURL();l.domElement.width=n,l.domElement.height=a,i.aspect=r,i.updateProjectionMatrix(),await tf.Z.add({name:"snapshot",uid:"snapshot_"+(0,eF.Z)(),data:o},{id:e.id})}catch(d){(0,X.lt)(tg.snapshot,d)}},tj=(e,t,i,l)=>{try{let n=l.domElement.width,a=l.domElement.height;l.clear(),l.setViewport(0,0,n,a),l.render(t,i);let r=l.domElement.toDataURL(),o=document.createElement("a");o.href=r.replace("image/png","image/octet-stream"),o.download=e.title+"_"+new Date().toLocaleDateString()+".png",o.click()}catch(d){(0,X.lt)(tg.saveScreenshot,d)}},tT=e=>{let{loading:t,project:i,parts:l}=e,n=(0,c.useRef)(null),a=(0,c.useRef)(),r=(0,c.useRef)(),d=(0,c.useRef)(),s=(0,c.useRef)(),p=(0,c.useRef)(),y=(0,c.useRef)(),f=(0,c.useRef)(),Z=(0,c.useRef)(),b=(0,c.useRef)(),w=(0,c.useRef)(),x=(0,c.useRef)(),[C,k]=(0,c.useState)(!1),[P,E]=(0,c.useState)(!0),[B,j]=(0,c.useState)(!1),[T,M]=(0,c.useState)(!1),[N,z]=(0,c.useState)(!1),L=(0,u.useRouter)(),{enabled:A,part:R,highlighted:I,selected:H,point:D,type:U,dispatch:W}=(0,c.useContext)(K);(0,c.useEffect)(()=>{let e;if(!eQ.Z.isWebGLAvailable()){L.push("/webgl");return}let t=n.current,i=t.clientWidth,l=t.clientHeight;a.current=new eV.xsS,a.current.boundingBox=new eV.ZzF,a.current.boundingSphere=new eV.aLr,r.current=new eV.cPb(50,i/l,.1,1e3),r.current.position.z=10;let o=new eV.Mig("#aaa",.75);a.current.add(o);let u=new eV.cek("#fff",.5);u.decay=2,r.current.add(u),a.current.add(r.current),d.current=new eV.CP7({antialias:!0,alpha:!0}),d.current.setClearColor("#ffffff"),d.current.setSize(i,l),d.current.setPixelRatio(window.devicePixelRatio||1),d.current.shadowMap.enabled=!0,d.current.autoClear=!1,t.appendChild(d.current.domElement);let c=new eJ.C(a.current,r.current);s.current=new eq.f(new eV.FM8(i,l),a.current,r.current),s.current.visibleEdgeColor.set("#FAD114"),s.current.hiddenEdgeColor.set("#FAD114"),p.current=new e_.xC(d.current),p.current.addPass(c),p.current.addPass(s.current),y.current=new eG.$(r.current,t),y.current.rotateSpeed=3,y.current.panSpeed=.1;let m=e1(d.current,r.current,{offsetWidth:i-155,offsetHeight:l-155,width:150,height:150}),h=e2(d.current,a.current,r.current,y.current,{offsetWidth:i-155,offsetHeight:l-155,width:150,height:150});f.current=e4(d.current,a.current,r.current,y.current),Z.current=e8(d.current,a.current,r.current,y.current),b.current=e3(d.current,a.current,r.current,y.current),w.current=e7(d.current),w.current.setVisible(!1),x.current=e9(a.current);let v=()=>{y.current.update(),d.current.setViewport(0,0,i,l),d.current.render(a.current,r.current),f.current.update(),p.current.render(),m.render(),h.render(),w.current.render()},g=()=>{i=t.clientWidth,l=t.clientHeight,r.current.aspect=i/l,r.current.updateProjectionMatrix(),d.current.setSize(i,l),p.current.setSize(i,l),m.resize({newOffsetWidth:i-155,newOffsetHeight:l-155,newWidth:150,newHeight:150}),h.resize({newOffsetWidth:i-155,newOffsetHeight:l-155,newWidth:150,newHeight:150}),v()},C=()=>{k(),v(),e=requestAnimationFrame(C)},k=()=>{cancelAnimationFrame(e)};return window.addEventListener("resize",g),e=requestAnimationFrame(C),()=>{k(),tb=!1,window.removeEventListener("resize",g),t.removeChild(d.current.domElement),a.current.children.forEach(e=>{a.current.remove(e)}),m.dispose(),h.dispose(),f.current.dispose(),b.current.dispose(),Z.current.dispose(),w.current.dispose(),x.current.dispose()}},[L]),(0,c.useEffect)(()=>{if(!a.current)return;let e=a.current.children;if(!l.length){var t;tw(a.current),f.current.update(),null===(t=x.current)||void 0===t||t.build()}let i=l.filter(t=>!e.find(e=>e.uuid===t.summary.uuid)),n=e.filter(e=>!l.find(t=>t.summary.uuid===e.uuid)).filter(e=>"Part"===e.type);n.forEach(e=>{var t;null===(t=a.current)||void 0===t||t.remove(e),e.dispose()}),i.forEach(e=>{tE(e,a.current,r.current,y.current,{transparent:C,displayMesh:P},{gridHelper:f.current,sectionViewHelper:b.current,colorbarHelper:w.current,pointHelper:x.current},W).catch(e=>{(0,X.lt)(tg.load,e),tw(a.current)})})},[l,C,P,W]),(0,c.useEffect)(()=>{var e;if(a.current){if((null===(e=l[0])||void 0===e?void 0:e.summary.dimension)===2){tw(a.current);let t=new eV.Pa4(0,0,1),i=new eV.Pa4(0,1,0),n=new eV.Pa4;a.current.boundingBox.getCenter(n);let o=r.current.position.distanceTo(y.current.target),d=t.clone().multiplyScalar(o),s=n.add(d);r.current.position.copy(s),r.current.up.copy(i),y.current.noRotate=!0}else y.current.noRotate=!1}},[l]),(0,c.useEffect)(()=>{a.current&&a.current.children.forEach(e=>{"Part"===e.type&&e.userData.uuid===R&&(A?e.startSelection(d.current,r.current,s.current,U):e.stopSelection())})},[A,R,U]),(0,c.useEffect)(()=>{a.current&&a.current.children.forEach(e=>{if("Part"===e.type&&e.uuid===R){e.highlight(null==I?void 0:I.uuid);let t=e.getSelected(),i=H.filter(e=>!t.find(t=>t.uuid===e.uuid));i.forEach(t=>{t.uuid&&e.select(t.uuid)});let l=t.filter(e=>!H.find(t=>t.uuid===e.uuid));l.forEach(t=>{e.unselect(t.uuid)})}})},[R,I,H]),(0,c.useEffect)(()=>{var e;a.current&&(null===(e=x.current)||void 0===e||e.update(D?new eV.Pa4(D.x,D.y,D.z):void 0))},[D]);let Y=(0,c.useCallback)(e=>{k(e),a.current.children.forEach(t=>{"Part"===t.type&&t.setTransparent(e)})},[]),V=(0,c.useCallback)(e=>{E(e),a.current.children.forEach(t=>{"Part"===t.type&&t.setDisplayMesh(e)})},[]),F=(0,c.useCallback)(()=>{let e=!B;j(e),e?b.current.start():b.current.stop()},[B]);return(0,o.BX)(h.Z,{css:(0,O.iv)([en.KP.noScroll,tZ.view]),children:[(0,o.BX)(h.Z.Header,{css:tZ.head,children:[(0,o.tZ)(m.Z,{title:"Take snasphot",placement:"left",children:(0,o.tZ)(eT.Z,{placement:"bottom",menu:{items:[{key:"project",label:(0,o.tZ)(v.Z,{type:"text",css:en.KP.fullWidth,loading:T,async onClick(){M(!0);try{await tB(i,a.current,r.current,d.current)}finally{M(!1)}},children:"Project snapshot"})},{key:"image",label:(0,o.tZ)(v.Z,{type:"text",css:en.KP.fullWidth,loading:N,onClick(){z(!0);try{tj(i,a.current,r.current,d.current)}finally{z(!1)}},children:"Export image"})}]},children:(0,o.tZ)(v.Z,{icon:(0,o.tZ)(ez.Z,{})})})}),(0,o.tZ)(eM.Z,{css:en.Ml.margin(0)}),(0,o.tZ)(m.Z,{title:"Display grid",placement:"left",children:(0,o.tZ)(eX.Z,{defaultChecked:!0,checkedChildren:(0,o.tZ)(eL.Z,{}),unCheckedChildren:(0,o.tZ)(eL.Z,{}),onChange:e=>tO(f.current,e)})}),(0,o.tZ)(m.Z,{title:"Set transparency",placement:"left",children:(0,o.tZ)(eX.Z,{checked:C,checkedChildren:(0,o.tZ)(eA.Z,{}),unCheckedChildren:(0,o.tZ)(eA.Z,{}),onChange:Y})}),(0,o.tZ)(eM.Z,{css:en.Ml.margin(0)}),(0,o.tZ)(m.Z,{title:"Zoom out",placement:"left",children:(0,o.tZ)(v.Z,{icon:(0,o.tZ)(eR.Z,{}),onMouseDown:()=>tk(r.current,y.current),onMouseUp:tS,onMouseOut:tS})}),(0,o.tZ)(m.Z,{title:"Zoom in",placement:"left",children:(0,o.tZ)(v.Z,{icon:(0,o.tZ)(eI.Z,{}),onMouseDown:()=>tC(r.current,y.current),onMouseUp:tS,onMouseOut:tS})}),(0,o.tZ)(m.Z,{title:"Zoom to fit",placement:"left",children:(0,o.tZ)(v.Z,{icon:(0,o.tZ)(eH.Z,{}),onClick:()=>tP(a.current,r.current,y.current)})}),(0,o.tZ)(m.Z,{title:"Zoom to selection",placement:"left",children:(0,o.tZ)(v.Z,{icon:(0,o.tZ)(eD.Z,{}),onClick:()=>Z.current.isEnabled()?Z.current.end():Z.current.start()})}),(0,o.tZ)(eM.Z,{css:en.Ml.margin(0)}),!B&&(0,o.tZ)(m.Z,{title:"Section view",children:(0,o.tZ)(v.Z,{icon:(0,o.tZ)(eU.Z,{}),onClick:F})}),B&&(0,o.BX)(o.HY,{children:[(0,o.tZ)(m.Z,{title:"Stop",placement:"left",children:(0,o.tZ)(v.Z,{icon:(0,o.tZ)(eK.Z,{}),onClick:F})}),(0,o.tZ)(m.Z,{title:"Hide plane",placement:"left",children:(0,o.tZ)(v.Z,{icon:(0,o.tZ)(g.Z,{}),onClick:()=>b.current.toggleVisible()})}),(0,o.tZ)(m.Z,{title:"Snap to X",placement:"left",children:(0,o.tZ)(v.Z,{className:"ant-btn-icon-only",onClick:()=>b.current.toAxis(new eV.Pa4(-1,0,0)),children:"X"})}),(0,o.tZ)(m.Z,{title:"Snap to Y",placement:"left",children:(0,o.tZ)(v.Z,{className:"ant-btn-icon-only",onClick:()=>b.current.toAxis(new eV.Pa4(0,-1,0)),children:"Y"})}),(0,o.tZ)(m.Z,{title:"Snap to Z",placement:"left",children:(0,o.tZ)(v.Z,{className:"ant-btn-icon-only",onClick:()=>b.current.toAxis(new eV.Pa4(0,0,-1)),children:"Z"})}),(0,o.tZ)(m.Z,{title:"Flip",placement:"left",children:(0,o.tZ)(v.Z,{onClick:()=>b.current.flip(),icon:(0,o.tZ)(eW.Z,{})})})]}),(0,o.tZ)("div",{children:l.filter(e=>"result"===e.summary.type).length?(0,o.BX)(o.HY,{children:[(0,o.tZ)(eM.Z,{className:"no-margin"}),(0,o.tZ)(m.Z,{title:"Display result mesh",placement:"right",children:(0,o.tZ)(eX.Z,{checked:P,checkedChildren:(0,o.tZ)(eY.Z,{}),unCheckedChildren:(0,o.tZ)(eY.Z,{}),onChange:V})})]}):null})]}),(0,o.BX)(h.Z.Content,{css:(0,O.iv)([en.KP.noScroll,tZ.content]),children:[(0,o.tZ)("div",{style:{display:t?"flex":"none"},css:en.KP.loading,children:(0,o.tZ)(eN.Z,{indicator:(0,o.tZ)(S.Z,{css:{color:en.Rl.colorPrimary},style:{fontSize:80},spin:!0})})}),(0,o.tZ)("div",{ref:n,css:tZ.canvas})]})]})},tM={part:"Unable to load part"},tX=async(e,t,i)=>{try{if("geometry"===i){let l=await el.getPart({id:t.id});return{...l,extra:{id:t.id}}}{let n=await ej.load({id:e.id},{originPath:t.originPath,glb:t.glb});return{...n,extra:{glb:t.glb}}}}catch(a){throw(0,X.lt)(tM.part,a),a}},tN=e=>{let{project:t,simulation:i,geometries:l,result:n,postprocessing:a}=e,[r,d]=(0,c.useState)([]),[s,u]=(0,c.useState)(!1);return(0,c.useEffect)(()=>{new Promise(async e=>{u(!0);try{let t=[];if(n){let o=r.find(e=>{var t;return(null===(t=e.extra)||void 0===t?void 0:t.glb)===n.glb});if(o)t.push(o);else{let s=await tX(i,n,"result");t.push(s)}}if(a){let c=r.find(e=>{var t;return(null===(t=e.extra)||void 0===t?void 0:t.glb)===a.glb});if(c)t.push(c);else{let m=await tX(i,a,"result");t.push(m)}}l.length&&await Promise.all(l.map(async e=>{let l=r.find(t=>{var i;return(null===(i=t.extra)||void 0===i?void 0:i.id)===e.id});if(l)t.push(l);else{let n=await tX(i,e,"geometry");t.push(n)}})),d(t)}catch(h){}finally{u(!1),e(!0)}})},[i,"".concat(l),n,a,"".concat(r)]),(0,o.tZ)(tT,{loading:s,project:{id:t.id,title:t.title},parts:r})};var tz=i(34041),tL=i(60974),tA=i(67875),tR=i(23389),tI=i(93398),tH=i(96486),tD=i(52402),tU=i(64376),tK=i(10843);let tW={selector:(0,O.iv)({padding:"20px",height:"60vh",overflow:"auto",figure:{maxWidth:"80%",border:"1px solid #f0f0f0",margin:"auto",display:"flex",flexDirection:"column",alignItems:"center"},figcaption:{textAlign:"center",color:"#9c9c9c"},img:{maxWidth:"80%"}}),geometriesList:(0,O.iv)({width:"100%",padding:"12px","> .ant-select":{width:"100%"}}),waring:(0,O.iv)({"& .ant-collapse-content":{backgroundColor:"rgba(250, 173, 20, 0.5) !important"}}),error:(0,O.iv)({"& .ant-collapse-content":{backgroundColor:"rgba(255, 77, 79, 0.5) !important"}}),listItem:(0,O.iv)({marginTop:"12px !important",border:"1px solid #f0f0f0 !important",cursor:"default","& .ant-card-body":{padding:"12px !important"}})};var tY=i(99138),tV=i(57132);let tF={copy:"Unable to copy simulation"},tG=async(e,t,i)=>{try{let l=tU.Z.deepCopy(t.scheme);l.configuration.run.done=!1,l.configuration.run.error=void 0;let n=await G.Z.add({id:e.id},{name:t.name+" (copy)",scheme:l});i.addOneSimulation(n),i.mutateProject({id:e.id,simulations:[...e.simulations,n.id]})}catch(a){(0,X.lt)(tF.copy,a)}},tJ=e=>{let{project:t,simulation:i,swr:l}=e,[n,a]=(0,c.useState)(!1);return(0,o.tZ)(m.Z,{title:"Copy simulation",children:(0,o.tZ)(v.Z,{css:en.KP.noBorder,loading:n,icon:(0,o.tZ)(tV.Z,{}),async onClick(){a(!0);try{await tG(t,i,l)}finally{a(!1)}}})})},tq={update:"Unable to update simulation"},t_=async(e,t,i)=>{try{await G.Z.update({id:e.id},[{key:"name",value:t.name}]),i.mutateOneSimulation({id:e.id,name:t.name})}catch(l){throw(0,X.lt)(tq.update,l),l}},tQ=e=>{let{simulation:t,swr:i}=e,l=(0,c.useRef)(null),[n,a]=(0,c.useState)(!1),[r,d]=(0,c.useState)(!1);return(0,c.useEffect)(()=>{l.current&&l.current.focus()}),(0,o.BX)(o.HY,{children:[(0,o.tZ)(M.w6,{onEdit:()=>a(!0)}),(0,o.tZ)(ec.ZP,{title:"Edit the simulation's name",visible:n,initialValues:{name:t.name},onCancel:()=>a(!1),async onOk(e){d(!0);try{await t_(t,e,i),d(!1),a(!1)}catch(l){throw d(!1),l}},loading:r,children:(0,o.tZ)(eZ.Z.Item,{name:"name",label:"Name:",rules:[{required:!0,message:"Name is required"}],children:(0,o.tZ)(eg.Z,{ref:l})})})]})},t$={del:"Unable to delete simulation"},t0=async(e,t,i)=>{try{await G.Z.del(t);let l=e.simulations.filter(e=>e!==t.id);i.mutateProject({id:e.id,simulations:l}),i.delOneSimulation({id:t.id})}catch(n){throw(0,X.lt)(t$.del,n),n}},t1=e=>{let{project:t,simulation:i,swr:l}=e,[n,a]=(0,c.useState)(!1);return(0,o.tZ)(M.m1,{loading:n,text:(0,o.BX)(o.HY,{children:["Are you sure you want to delete the simulation"," ",(0,o.tZ)(y.Z.Text,{strong:!0,children:i.name}),"?"]}),async onDelete(){a(!0);try{await t0(t,i,l)}finally{a(!1)}}})},t2=e=>{let{project:t,simulation:i,swr:l}=e;return t&&i?(0,o.tZ)(h.Z,{children:(0,o.tZ)(h.Z.Content,{children:(0,o.tZ)(z.Z,{size:"small",title:(0,o.tZ)(y.Z.Title,{level:5,ellipsis:!0,children:i.name}),actions:[(0,o.tZ)(tJ,{project:{id:t.id,simulations:t.simulations},simulation:i,swr:{mutateProject:l.mutateProject,addOneSimulation:l.addOneSimulation}},"copy"),(0,o.tZ)(tQ,{simulation:{id:i.id,name:i.name},swr:{mutateOneSimulation:l.mutateOneSimulation}},"edit"),(0,o.tZ)(t1,{project:{id:t.id,simulations:t.simulations},simulation:{id:i.id,name:i.name},swr:{mutateProject:l.mutateProject,delOneSimulation:l.delOneSimulation}},"delete")],children:(0,o.BX)(L.Z,{direction:"vertical",css:en.KP.fullWidth,children:[i.scheme.user&&(0,o.tZ)(tY.Z,{message:"User algorithm",type:"info",showIcon:!0}),(0,o.BX)(y.Z.Text,{children:[(0,o.tZ)("span",{css:en.KP.textLight,children:"Category:"})," ",i.scheme.category]}),(0,o.BX)(y.Z.Text,{children:[(0,o.tZ)("span",{css:en.KP.textLight,children:"Algorithm:"})," ",i.scheme.algorithm]}),(0,o.BX)(y.Z.Text,{children:[(0,o.tZ)("span",{css:en.KP.textLight,children:"Code:"})," ",i.scheme.code]}),(0,o.BX)(y.Z.Text,{children:[(0,o.tZ)("span",{css:en.KP.textLight,children:"Version:"})," ",i.scheme.version]}),(0,o.tZ)("div",{css:(0,O.iv)([en.KP.fullWidth,en.KP.scroll]),children:(0,o.tZ)(es.Z.Html,{html:i.scheme.description})})]})})})}):(0,o.tZ)(z.Z,{children:(0,o.tZ)(eN.Z,{})})};var t5=i(32808);let t4=e=>{let{label:t,css:i,defaultValue:l,defaultChecked:n,onValueChange:a,onCheckedChange:r,unit:d}=e,[s,u]=(0,c.useState)(String(null!=l?l:0)),[m,h]=(0,c.useState)(!!n),[p,y]=(0,c.useState)(void 0!==n&&!n),[v,f]=(0,c.useState)(0),[Z,g]=(0,c.useState)(!1);(0,c.useEffect)(()=>{u(String(null!=l?l:0))},[l]),(0,c.useEffect)(()=>{h(!!n)},[n]);let w=(0,c.useCallback)(e=>{let t=e.target.checked;h(t),g(!0),null==r||r(t),y(!t)},[r]),x=(0,c.useCallback)(e=>{v&&clearTimeout(v);let t=setTimeout(()=>{a(e),g(!1)},500);f(+t)},[v,a]),C=(0,c.useCallback)(e=>{let t=e.target.value;u(t),g(!0),x(t)},[x]);return(0,o.tZ)(L.Z,{css:(0,O.iv)({...en.KP.fullWidth,...i||{}}),align:"start",children:(0,o.tZ)(eZ.Z,{layout:"vertical",children:(0,o.tZ)(eZ.Z.Item,{label:(0,o.BX)(o.HY,{children:[void 0!==n&&(0,o.tZ)(t5.Z,{checked:m,onChange:w,style:{marginRight:"5px"}}),t]}),children:(0,o.tZ)(eg.Z,{disabled:p,value:s,onChange:C,addonAfter:(0,o.BX)(L.Z,{css:en.KP.fullWidth,children:[(0,o.tZ)(es.Z.Inline,{text:d}),Z?(0,o.tZ)(S.Z,{spin:!0,css:en.KP.textOrange}):(0,o.tZ)(b.Z,{css:en.KP.textGreen})]})})})})})},t8={update:"Unable to update simulation"},t3=async(e,t,i)=>{try{let l=tU.Z.deepCopy(e);l.scheme.configuration.geometry.meshParameters={type:t,value:"auto"===t?"normal":"1"};let n={...l.scheme.configuration.geometry,done:!0};await G.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","geometry"],value:n}]),await G.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","run"],value:{...l.scheme.configuration.run,done:!1}}]),i.mutateOneSimulation(l)}catch(a){throw(0,X.lt)(t8.update,a),a}},t6=async(e,t,i,l)=>{try{let n=tU.Z.deepCopy(e);n.scheme.configuration.geometry.meshParameters={...n.scheme.configuration.geometry.meshParameters,type:t,value:i};let a={...n.scheme.configuration.geometry,done:!0};await G.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","geometry"],value:a}]),await G.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","run"],value:{...n.scheme.configuration.run,done:!1}}]),l.mutateOneSimulation(n)}catch(r){throw(0,X.lt)(t8.update,r),r}},t7=e=>{let{simulation:t,swr:i}=e,[l,n]=(0,c.useState)(),[a,r]=(0,c.useState)();(0,c.useEffect)(()=>{let e=t.scheme.configuration.geometry.meshParameters;e?(n(e.type),r(e.value)):(n("auto"),r("normal"))},[t]);let d=(0,c.useCallback)(async e=>{try{await t6(t,l,e,i),r(e)}catch(n){}},[t,l,i]);return(0,o.tZ)(z.Z,{size:"small",title:"Mesh refinement",children:(0,o.BX)(L.Z,{direction:"vertical",css:en.KP.fullWidth,children:[(0,o.tZ)(eZ.Z,{layout:"vertical",children:(0,o.tZ)(eZ.Z.Item,{label:"Type",children:(0,o.BX)(tz.Z,{css:en.KP.fullWidth,value:l,async onChange(e){try{await t3(t,e,i),n(e),"auto"===e?r("normal"):r("1")}catch(l){}},children:[(0,o.tZ)(tz.Z.Option,{value:"auto",children:"Automatic"}),(0,o.tZ)(tz.Z.Option,{value:"manual",children:"Manual"})]})})}),"auto"===l&&(0,o.tZ)(eZ.Z,{layout:"vertical",children:(0,o.tZ)(eZ.Z.Item,{label:"Size",children:(0,o.BX)(tz.Z,{css:en.KP.fullWidth,value:a,onChange:d,children:[(0,o.tZ)(tz.Z.Option,{value:"veryfine",children:"Very fine"}),(0,o.tZ)(tz.Z.Option,{value:"fine",children:"Fine"}),(0,o.tZ)(tz.Z.Option,{value:"normal",children:"Normal"}),(0,o.tZ)(tz.Z.Option,{value:"coarse",children:"Coarse"}),(0,o.tZ)(tz.Z.Option,{value:"verycoarse",children:"Very coarse"})]})})}),"manual"===l&&(0,o.tZ)(t4,{label:"Size",defaultValue:a,onValueChange:d,unit:"m"})]})})},t9={update:"Unable to update simulation"},ie=async(e,t,i,l,n)=>{try{var a;let r=tU.Z.deepCopy(e),o=t.find(e=>e.id===i);r.scheme.configuration.geometry.value=i,r.scheme.configuration.geometry.values=void 0;let d={...r.scheme.configuration,dimension:null!==(a=o.summary.dimension)&&void 0!==a?a:3,geometry:{...r.scheme.configuration.geometry,done:!0},run:{...r.scheme.configuration.run,done:!1}};await G.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration"],value:d}]),n.mutateOneSimulation(r),l([o])}catch(s){(0,X.lt)(t9.update,s)}},it=async(e,t,i,l,n)=>{try{var a;if(!i.length)return;let r=tU.Z.deepCopy(e),o=t.filter(e=>i.includes(e.id));r.scheme.configuration.geometry.value=void 0,r.scheme.configuration.geometry.values=i;let d={...r.scheme.configuration,dimension:null!==(a=o[0].summary.dimension)&&void 0!==a?a:3,geometry:{...r.scheme.configuration.geometry,done:!0},run:{...r.scheme.configuration.run,done:!1}};await G.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration"],value:d}]),n.mutateOneSimulation(r),l(o)}catch(s){(0,X.lt)(t9.update,s)}},ii=e=>{let{loadedGeometries:t,geometries:i,simulation:l,setGeometries:n,swr:a}=e,r=l.scheme.configuration.geometry.multiple,d=l.scheme.configuration.geometry.value,s=l.scheme.configuration.geometry.values;r||d||!i.length?r&&!s&&i.length&&it(l,t,i.map(e=>e.id),n,a):ie(l,t,i[0].id,n,a);let u=(0,o.tZ)("div",{css:tW.geometriesList,children:(0,o.tZ)(tz.Z,{mode:r?"multiple":void 0,options:t.map(e=>({value:e.id,label:e.name})),value:r?s:d,onChange(e){r?it(l,t,e,n,a):ie(l,t,e,n,a)}})});return(0,o.BX)(o.HY,{children:[(0,o.tZ)(z.Z,{size:"small",children:(0,o.tZ)(y.Z.Text,{children:"When changing the simulation domain, you might lose your topological entity assignments"})}),(0,o.tZ)(z.Z,{size:"small",children:(0,o.tZ)(y.Z.Text,{strong:!0,children:"Select a simulation domain"})}),u,l.scheme.configuration.geometry.meshable&&(0,o.tZ)(t7,{simulation:{id:l.id,scheme:l.scheme},swr:{mutateOneSimulation:a.mutateOneSimulation}})]})},il={update:"Unable to delete material"},ia=async(e,t,i,l)=>{try{let n=tU.Z.deepCopy(e),a=n.scheme.configuration.materials,r=a.values[t];r.selected.forEach(e=>{i(ty(e))}),a.values=[...a.values.slice(0,t),...a.values.slice(t+1)];let o={...a,done:!!a.values.length};await G.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","materials"],value:o}]),l.mutateOneSimulation(n)}catch(d){throw(0,X.lt)(il.update,d),d}},ir=e=>{let{simulation:t,index:i,swr:l}=e,[n,a]=(0,c.useState)(!1),{dispatch:r}=(0,c.useContext)(K),d=t.scheme.configuration.materials,s=d.values[i];return(0,o.tZ)(M.m1,{loading:n,text:(0,o.BX)(o.HY,{children:["Are you sure you want to delete the material"," ",(0,o.tZ)(y.Z.Text,{strong:!0,children:s.material.label})]}),async onDelete(){a(!0);try{await ia(t,i,r,l)}finally{a(!1)}}})},io=e=>{var t;let{simulation:i,swr:l,onEdit:n}=e,[a,r]=(0,c.useState)(!0),d=i.scheme.configuration.materials,{dispatch:s}=(0,c.useContext)(K),u=(0,c.useCallback)(e=>{s(td());let t=d.values[e].selected;null==t||t.forEach(e=>{s(tp(e))})},[d,s]),m=(0,c.useCallback)(()=>{s(ts())},[s]);return(0,o.tZ)(o.HY,{children:null===(t=d.values)||void 0===t?void 0:t.map((e,t)=>(0,o.tZ)(z.Z,{css:(0,O.iv)([en.KP.textAlignCenter,tW.listItem]),hoverable:!0,onMouseEnter:()=>u(t),onMouseLeave(){a&&m()},actions:[(0,o.tZ)(M.w6,{onEdit(){r(!1),n(t),setTimeout(()=>r(!0),500)}},"edit"),(0,o.tZ)(ir,{index:t,simulation:{id:i.id,scheme:i.scheme},swr:{mutateOneSimulation:l.mutateOneSimulation}},"delete")],children:(0,o.tZ)(y.Z.Text,{strong:!0,css:en.KP.textAlignCenter,children:e.material.label})},t)).filter(e=>e)})};var id=i(85265),is=i(51904),iu=i(13982),ic=i(14618),im=i(94668),ih=i(68795);let ip=e=>{var t;let{geometry:i,alreadySelected:l,updateSelected:n}=e,[a,r]=(0,c.useState)([]),[d,s]=(0,c.useState)(),[u,h]=(0,c.useState)(),{type:p,highlighted:f,selected:Z,dispatch:g}=(0,c.useContext)(K);(0,c.useEffect)(()=>{n(Z)},[n,Z]),(0,c.useEffect)(()=>{var e;let t=[];p&&(null===(e=i.summary[p])||void 0===e||e.forEach(e=>{if(e.color){let i=t.find(t=>t.r===e.color.r&&t.g===e.color.g&&t.b===e.color.b);i||t.push(e.color)}})),r(t)},[i,p]);let b=e=>{g(tm(e))},w=()=>{g(th())},x=e=>{Z.find(t=>t.uuid===e.uuid)?g(ty(e)):g(tp(e))},C=(0,c.useCallback)(e=>{s(e)},[]),k=()=>{var e;null===(e=i.summary[p])||void 0===e||e.forEach(e=>{var t,i,l;(!d||d&&d.r===(null===(t=e.color)||void 0===t?void 0:t.r)&&d.g===(null===(i=e.color)||void 0===i?void 0:i.g)&&d.b===(null===(l=e.color)||void 0===l?void 0:l.b))&&g(tp({uuid:e.uuid,label:e.label}))})},S=()=>{var e;null===(e=i.summary[p])||void 0===e||e.forEach(e=>{var t,i,l;(!d||d&&d.r===(null===(t=e.color)||void 0===t?void 0:t.r)&&d.g===(null===(i=e.color)||void 0===i?void 0:i.g)&&d.b===(null===(l=e.color)||void 0===l?void 0:l.b))&&g(ty({uuid:e.uuid,label:e.label}))})},P=()=>{var e;null===(e=i.summary[p])||void 0===e||e.forEach(e=>{var t,i,l;(!d||d&&d.r===(null===(t=e.color)||void 0===t?void 0:t.r)&&d.g===(null===(i=e.color)||void 0===i?void 0:i.g)&&d.b===(null===(l=e.color)||void 0===l?void 0:l.b))&&Z.find(t=>t.uuid===e.uuid)?g(ty({uuid:e.uuid,label:e.label})):g(tp({uuid:e.uuid,label:e.label}))})},E=(0,c.useCallback)(e=>{let t=e.target.value;h(t)},[]),B=(0,c.useCallback)(e=>{var t,i,l;return(!d||d.r===(null===(t=e.color)||void 0===t?void 0:t.r)&&d.g===(null===(i=e.color)||void 0===i?void 0:i.g)&&d.b===(null===(l=e.color)||void 0===l?void 0:l.b))&&(!u||!e.name||!!e.name.includes(u))},[d,u]);return(0,o.BX)(z.Z,{size:"small",css:en.KP.noBorderBottom,children:[(0,o.BX)(L.Z,{direction:"vertical",css:en.KP.fullWidth,children:[(0,o.tZ)(y.Z.Text,{strong:!0,children:"Filters"}),(0,o.BX)(L.Z,{direction:"horizontal",wrap:!0,children:[a.length>1&&(0,o.BX)(o.HY,{children:[(0,o.tZ)(m.Z,{title:"Reset",children:(0,o.tZ)(v.Z,{icon:(0,o.tZ)(er.Z,{}),onClick:()=>C()})}),a.map(e=>(0,o.tZ)(m.Z,{title:"Color",children:(0,o.tZ)(v.Z,{style:{backgroundColor:tU.Z.rgbToHex(e)},onClick:()=>C(e),children:" "})},JSON.stringify(e)))]}),(0,o.tZ)(m.Z,{title:"Select all",children:(0,o.tZ)(v.Z,{icon:(0,o.tZ)(iu.Z,{}),onClick:k})}),(0,o.tZ)(m.Z,{title:"Unselect all",children:(0,o.tZ)(v.Z,{icon:(0,o.tZ)(ic.Z,{}),onClick:S})}),(0,o.tZ)(m.Z,{title:"Swap",children:(0,o.tZ)(v.Z,{icon:(0,o.tZ)(im.Z,{}),onClick:P})})]}),(0,o.tZ)(eg.Z,{placeholder:"Search",value:u,onChange:E,suffix:(0,o.tZ)(ih.Z,{css:en.KP.textLight})})]}),(0,o.tZ)("div",{css:(0,O.iv)([en.KP.fullWidth,en.Ml.marginTop(20)]),children:p?null===(t=i.summary[p])||void 0===t?void 0:t.map((e,t)=>{if(B(e)){let i="transparent",n="transparent";return Z.find(t=>t.uuid===e.uuid)?(i="#EE9817",n="rgba(238, 152, 23, 0.3)"):(null==f?void 0:f.uuid)===e.uuid&&(i="#FAD114",n="rgba(250, 209, 20, 0.3)"),(0,o.tZ)(z.Z,{css:en.Ml.marginBottom(10),bodyStyle:{position:"relative",padding:"10px 10px 10px 40px",borderWidth:"2px",borderStyle:"solid",borderColor:i,backgroundColor:n},onMouseEnter:()=>b({uuid:e.uuid,label:e.label}),onMouseLeave:w,onClick:()=>x({uuid:e.uuid,label:e.label}),children:(0,o.BX)(L.Z,{direction:"vertical",children:[(0,o.BX)("div",{children:[(0,o.tZ)("div",{style:{position:"absolute",left:"-2px",top:"-2px",bottom:"-2px",width:"30px",backgroundColor:tU.Z.rgbToRgba(e.color,1)}}),e.name]}),null==l?void 0:l.map(t=>{if(t.selected.find(t=>t.uuid===e.uuid))return(0,o.tZ)(is.Z,{color:tU.Z.stringToColor(t.label),children:t.label},e.uuid)})]})},t)}}):[]})]})};var iy=i(51158),iv=i(13520),iZ=i(23226);let ig=e=>{let{onSelect:t}=e,[i,l]=(0,c.useState)(),[n,a]=(0,c.useState)(),[r,d]=(0,c.useState)(),[s,u]=(0,c.useState)(),m=Object.keys(iZ.E),y=(0,c.useCallback)(e=>{let{key:t}=e,i=iZ.E[t];a({key:t,children:i.children}),d(void 0),u(void 0)},[]),f=(0,c.useCallback)(e=>{let{key:t}=e,i=iZ.E[n.key],l=i.children.find(e=>e.key===t);d({key:t}),u(l)},[n]),Z=(0,c.useCallback)(e=>{t(e),l(!1)},[t]);return(0,o.BX)(o.HY,{children:[(0,o.tZ)(v.Z,{icon:(0,o.tZ)(iv.Z,{}),onClick:()=>l(!0),css:en.KP.fullWidth,children:"Pick a material"}),(0,o.tZ)(tL.Z,{open:i,title:"Material database",onCancel:()=>l(!1),onOk:()=>Z(s),okText:"Choose",okButtonProps:{disabled:!s},width:"50%",children:(0,o.tZ)(h.Z,{children:(0,o.tZ)(h.Z.Content,{children:(0,o.BX)(L.Z,{style:{alignItems:"stretch"},children:[(0,o.tZ)(p.Z,{mode:"inline",items:m.map(e=>({key:e,label:iZ.E[e].label})),onClick:y}),(0,o.tZ)(p.Z,{mode:"inline",items:null==n?void 0:n.children.map(e=>({key:e.key,label:e.label})),selectedKeys:(null==r?void 0:r.key)?[null==r?void 0:r.key]:[],onClick:f}),s&&(0,o.tZ)(iy.ZP,{itemLayout:"vertical",children:s.children.map(e=>(0,o.BX)(iy.ZP.Item,{children:[e.label,": ",e.symbol," = ",e.value]},e.label))})]})})})})]})},ib={material:"You need to define a material",selected:"You need to select a solid",update:"Unable to add material"},iw=async(e,t,i)=>{try{let l=tU.Z.deepCopy(t);l.uuid=(0,eF.Z)();let n=tU.Z.deepCopy(e),a=n.scheme.configuration.materials;a.values=[...a.values||[],l];let r={...a,done:!0};await G.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","materials"],value:r}]),await G.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","run"],value:{...n.scheme.configuration.run,done:!1}}]),i.mutateOneSimulation(n)}catch(o){throw(0,X.lt)(ib.update,o),o}},ix=e=>{let{simulation:t,material:i,swr:l,onError:n,onClose:a}=e,[r,d]=(0,c.useState)(!1);return(0,o.tZ)(M.HS,{loading:r,needMargin:!0,async onAdd(){d(!0);try{var e;if(!i.material){n(ib.material),d(!1);return}if(!(null===(e=i.selected)||void 0===e?void 0:e.length)){n(ib.selected),d(!1);return}n(),await iw(t,i,l),d(!1),a()}catch(r){d(!1)}},children:"Add"})},iC={material:"You need to define a material",selected:"You need to select a solid",update:"Unable to edit material"},ik=async(e,t,i)=>{try{let l=tU.Z.deepCopy(e),n=l.scheme.configuration.materials,a=n.values.findIndex(e=>e.uuid===t.uuid);n.values=[...n.values.slice(0,a),t,...n.values.slice(a+1)];let r={...n};await G.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","materials"],value:r}]),i.mutateOneSimulation(l)}catch(o){throw(0,X.lt)(iC.update,o),o}},iS=e=>{let{simulation:t,material:i,swr:l,onError:n,onClose:a}=e,[r,d]=(0,c.useState)(!1);return(0,o.tZ)(M.w6,{loading:r,primary:!0,needMargin:!0,async onEdit(){d(!0);try{var e;if(!i.material){n(iC.material),d(!1);return}if(!(null===(e=i.selected)||void 0===e?void 0:e.length)){n(iC.selected),d(!1);return}n(),await ik(t,i,l),d(!1),a()}catch(r){d(!1)}},children:"Edit"})},iP=e=>{var t,i,l,n,a,r,d;let{visible:s,geometries:u,simulation:m,material:h,swr:p,onClose:f}=e,[Z,g]=(0,c.useState)(),[b,w]=(0,c.useState)(),[C,k]=(0,c.useState)(),{dispatch:S}=(0,c.useContext)(K),P=m.scheme.configuration.materials;(0,c.useEffect)(()=>{var e;S(tc(null===(e=u[0])||void 0===e?void 0:e.summary.uuid))},["".concat(u),S]),(0,c.useEffect)(()=>{!s&&b&&w(void 0)}),(0,c.useEffect)(()=>{s&&!b&&h&&w(h)},[b,s,h]),(0,c.useEffect)(()=>{var e;let t=null==P?void 0:null===(e=P.values)||void 0===e?void 0:e.map(e=>{if(e.uuid!==(null==h?void 0:h.uuid))return{label:e.material.label,selected:e.selected}}).filter(e=>e);g(t||[])},[m,h,P]);let E=(0,c.useCallback)(e=>{w(t=>({...t,material:e}))},[]),O=(0,c.useCallback)(e=>{w(t=>({...t,selected:e}))},[]),B=(0,c.useCallback)((e,t,i)=>{w(l=>{var n,a,r,o;return{...l,material:{label:"Custom",children:[...(null==l?void 0:null===(n=l.material)||void 0===n?void 0:null===(a=n.children)||void 0===a?void 0:a.slice(0,t))||[],{label:e.label,symbol:e.name,value:i},...(null==l?void 0:null===(r=l.material)||void 0===r?void 0:null===(o=r.children)||void 0===o?void 0:o.slice(t+1))||[]]}}})},[]);return(0,o.tZ)(id.Z,{css:eo.subPanel,title:"Material",placement:"left",closable:!1,open:s,mask:!1,maskClosable:!1,width:300,extra:(0,o.tZ)(v.Z,{type:"text",icon:(0,o.tZ)(er.Z,{}),onClick(){w(void 0),f()}}),footer:(0,o.BX)("div",{style:{display:"flex",justifyContent:"flex-end"},children:[(0,o.tZ)(M.Lw,{onCancel(){w(void 0),f()}}),h?(0,o.tZ)(iS,{material:{uuid:null!==(l=null==b?void 0:b.uuid)&&void 0!==l?l:h.uuid,material:null!==(n=null==b?void 0:b.material)&&void 0!==n?n:h.material,geometry:null!==(a=null==b?void 0:b.geometry)&&void 0!==a?a:h.geometry,selected:null!==(r=null==b?void 0:b.selected)&&void 0!==r?r:h.selected},simulation:{id:m.id,scheme:m.scheme},swr:{mutateOneSimulation:p.mutateOneSimulation},onError:e=>k(e),onClose:f}):(0,o.tZ)(ix,{material:{material:null==b?void 0:b.material,geometry:null==b?void 0:b.geometry,selected:null==b?void 0:b.selected},simulation:{id:m.id,scheme:m.scheme},swr:{mutateOneSimulation:p.mutateOneSimulation},onError:e=>k(e),onClose:f})]}),children:(0,o.BX)(L.Z,{direction:"vertical",css:en.KP.fullWidth,children:[(0,o.tZ)(z.Z,{size:"small",children:(0,o.BX)(L.Z,{direction:"vertical",css:en.KP.fullWidth,children:[(0,o.tZ)(ig,{onSelect:E}),(0,o.BX)(y.Z.Text,{children:["Material: ",null!==(d=null==b?void 0:null===(t=b.material)||void 0===t?void 0:t.label)&&void 0!==d?d:"default"]}),null==P?void 0:null===(i=P.children)||void 0===i?void 0:i.map((e,t)=>{var i,l;let n=null==b?void 0:null===(i=b.material)||void 0===i?void 0:null===(l=i.children)||void 0===l?void 0:l.find(t=>t.symbol===e.name);return(0,o.tZ)(t4,{label:e.name,defaultValue:n?n.value:String(e.default),unit:e.unit,onValueChange(i){B(e,t,i)}},e.name)})]})}),(0,o.tZ)(tA.Z,{items:u.map(e=>({key:e.summary.uuid,label:e.name,children:(0,o.tZ)(ip,{geometry:e,alreadySelected:Z,updateSelected:O})})),onChange:e=>S(tc(e))}),C&&(0,o.BX)(y.Z.Text,{children:[(0,o.tZ)(x.Z,{style:{color:"red"}})," ",C]})]})})},iE=e=>{let{geometries:t,simulation:i,swr:l,setVisible:n}=e,[a,r]=(0,c.useState)(),[d,s]=(0,c.useState)(!1),{dispatch:u}=(0,c.useContext)(K),m=i.scheme.configuration.materials;T(()=>{var e;(null===(e=t[0])||void 0===e?void 0:e.summary)&&u(tu(2===t[0].summary.dimension?"faces":"solids"))},[t],[u]);let p=(0,c.useCallback)(()=>{r(void 0),s(!0),n(!1),u(td())},[u,n]),y=(0,c.useCallback)(e=>{let t=m.values[e];r(t),s(!0),n(!1),u(td())},[m,u,n]),v=(0,c.useCallback)(()=>{u(ts()),s(!1),r(void 0),n(!0)},[u,n]);return t.length?(0,o.tZ)(h.Z,{children:(0,o.tZ)(h.Z.Content,{children:(0,o.BX)(z.Z,{size:"small",children:[(0,o.tZ)(M.HS,{onAdd:p,fullWidth:!0,primary:!1,children:"Add material"}),(0,o.tZ)(io,{simulation:{id:i.id,scheme:i.scheme},swr:l,onEdit:y}),(0,o.tZ)(iP,{visible:d,geometries:t.map(e=>({id:e.id,name:e.name,summary:e.summary})),simulation:{id:i.id,scheme:i.scheme},material:a&&{uuid:a.uuid,material:a.material,geometry:a.geometry,selected:a.selected},swr:{mutateOneSimulation:l.mutateOneSimulation},onClose:v})]})})}):(0,o.tZ)(N.Z.Simple,{})};var iO=i(15045);let iB={update:"Unable to update simulation"},ij=(e,t,i)=>(0,o.tZ)(t4,{label:t.label2D||t.label,defaultValue:null!==(n=t.value)&&void 0!==n?n:t.default,onValueChange:i,unit:t.unit},e),iT=(e,t,i)=>{var l;return(0,o.tZ)(eZ.Z,{layout:"vertical",children:(0,o.tZ)(eZ.Z.Item,{label:t.label2D||t.label,children:(0,o.tZ)(tz.Z,{options:null===(l=t.options)||void 0===l?void 0:l.map(e=>({label:e.label,value:null!==(a=e.value2D)&&void 0!==a?a:e.value})),defaultValue:t.value||t.default2D||t.default,onChange:i})})},e)},iM=(e,t,i)=>(0,o.tZ)(eZ.Z,{layout:"horizontal",children:(0,o.tZ)(eZ.Z.Item,{label:t.label2D||t.label,children:(0,o.tZ)(t5.Z,{defaultChecked:t.value,onChange:i})})},e),iX=(e,t,i)=>(0,o.tZ)(t4,{label:t.label,defaultValue:null!==(r=t.value)&&void 0!==r?r:t.default,onValueChange:i,unit:t.unit},e),iN=(e,t,i)=>(0,o.tZ)(eZ.Z,{layout:"vertical",children:(0,o.tZ)(eZ.Z.Item,{label:t.label,children:(0,o.tZ)(tz.Z,{options:t.options,defaultValue:t.value||t.default,onChange:i})})},e),iz=(e,t,i)=>(0,o.tZ)(eZ.Z,{layout:"horizontal",children:(0,o.tZ)(eZ.Z.Item,{label:t.label,children:(0,o.tZ)(t5.Z,{defaultChecked:t.value,onChange:i})})},e),iL=async(e,t)=>{try{let i=tU.Z.deepCopy(e),l=i.scheme.configuration.parameters,n={...l,done:!0};await G.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","parameters"],value:n}]),await G.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","run"],value:{...i.scheme.configuration.run,done:!1}}]),t.mutateOneSimulation(i)}catch(a){(0,X.lt)(iB.update,a)}},iA=async(e,t,i,l,n)=>{try{let a=tU.Z.deepCopy(e),r=a.scheme.configuration.parameters,o=r[t];o.children[i].value=l;let d={...r,done:!0};await G.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","parameters"],value:d}]),await G.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","run"],value:{...a.scheme.configuration.run,done:!1}}]),n.mutateOneSimulation(a)}catch(s){(0,X.lt)(iB.update,s)}},iR=e=>{let{simulation:t,swr:i}=e,l=null==t?void 0:t.scheme.configuration.parameters,n=null==t?void 0:t.scheme.configuration.dimension;(0,c.useEffect)(()=>{(null==l?void 0:l.done)||iL(t,i)},[t,l,i]);let a=[],r=[];return 2===n?Object.keys(l).forEach(e=>{if("index"===e||"title"===e||"done"==e)return;let n=l[e],d=null==n?void 0:n.children.map((l,n)=>{if(!l.only3D){if("formula"===l.htmlEntity)return ij(e+"&"+n,l,l=>iA(t,e,n,l,i));if("select"===l.htmlEntity)return iT(e+"&"+n,l,l=>iA(t,e,n,l,i));if("checkbox"===l.htmlEntity)return iM(e+"&"+n,l,l=>iA(t,e,n,l.target.checked,i))}});(null==n?void 0:n.advanced)?r.push((0,o.tZ)(z.Z,{size:"small",title:null==n?void 0:n.label,children:(0,o.tZ)(L.Z,{direction:"vertical",children:d})},e)):a.push((0,o.tZ)(z.Z,{size:"small",title:null==n?void 0:n.label,children:(0,o.tZ)(L.Z,{direction:"vertical",children:d})},e))}):Object.keys(l).forEach(e=>{if("index"===e||"title"===e||"done"==e)return;let n=l[e],d=null==n?void 0:n.children.map((l,n)=>"formula"===l.htmlEntity?iX(e+"&"+n,l,l=>iA(t,e,n,l,i)):"select"===l.htmlEntity?iN(e+"&"+n,l,l=>iA(t,e,n,l,i)):"checkbox"===l.htmlEntity?iz(e+"&"+n,l,l=>iA(t,e,n,l.target.checked,i)):void 0);(null==n?void 0:n.advanced)?r.push((0,o.tZ)(z.Z,{size:"small",title:null==n?void 0:n.label,children:(0,o.tZ)(L.Z,{direction:"vertical",children:d})},e)):a.push((0,o.tZ)(z.Z,{size:"small",title:null==n?void 0:n.label,children:(0,o.tZ)(L.Z,{direction:"vertical",children:d})},e))}),(0,o.tZ)(h.Z,{children:(0,o.tZ)(h.Z.Content,{children:(0,o.BX)(L.Z,{direction:"vertical",children:[a,(0,o.tZ)(iO.Z,{children:(0,o.tZ)(iO.Z.Panel,{header:"Advanced",children:(0,o.tZ)(L.Z,{direction:"vertical",children:r})},"advanced")})]})})})},iI=(e,t)=>e.map(e=>{let i=e.fileName.replace(RegExp(t.prefixPattern),"").replace(RegExp(t.suffixPattern),"");return{...e,number:+i}}),iH=(e,t)=>{let i=t.multiplicator;if(i){var l;let n=i.reduce((e,t)=>e[t],e);return null!==(l=n.value)&&void 0!==l?l:n.default}},iD={update:"Unable to update simulation"},iU=async(e,t,i)=>{try{let l=tU.Z.deepCopy(e),n=l.scheme.configuration.initialization;n.value={type:t},await G.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","initialization"],value:n}]),i.mutateOneSimulation(l)}catch(a){throw(0,X.lt)(iD.update,a),a}},iK=async(e,t,i,l)=>{try{var n;let a=await iV(e,i),r=tU.Z.deepCopy(t),o=r.scheme.configuration.initialization;o.value={...o.value,simulation:i,result:null==a?void 0:null===(n=a[0])||void 0===n?void 0:n.value},await G.Z.update({id:t.id},[{key:"scheme",type:"json",method:"set",path:["configuration","initialization"],value:o}]),l.mutateOneSimulation(r)}catch(d){throw(0,X.lt)(iD.update,d),d}},iW=async(e,t,i,l)=>{try{let n=tU.Z.deepCopy(e),a=n.scheme.configuration.initialization;a.value={...a.value,number:+t,result:i.file},await G.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","initialization"],value:a}]),l.mutateOneSimulation(n)}catch(r){(0,X.lt)(iD.update,r)}},iY=async(e,t,i,l)=>{try{let n=tU.Z.deepCopy(e),a=n.scheme.configuration.initialization;a.value.values||(a.value.values=[]),a.value.values[t]=i,await G.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","initialization"],value:a}]),l.mutateOneSimulation(n)}catch(r){(0,X.lt)(iD.update,r)}},iV=async(e,t)=>{var i;let l=await G.Z.tasks({id:t}),n=e.find(e=>e.id===t),a=n.scheme.configuration,r=null==a?void 0:null===(i=a.run)||void 0===i?void 0:i.resultsFilter,o=[];return l.forEach(e=>{if(e.file&&"result"===e.file.type&&o.push({label:e.file.fileName,value:e.file.fileName,file:e.file.fileName}),e.files){if(r){let t=RegExp(r.pattern),i=e.files.filter(e=>!t.test(e.fileName)).filter(e=>"result"===e.type),l=e.files.filter(e=>t.test(e.fileName)),n=iI(l,r),d=n.map(e=>({number:e.number,fileName:e.fileName.replace(RegExp(r.suffixPattern),"")})).filter((e,t,i)=>i.findIndex(t=>t.number===e.number)===t).sort((e,t)=>e.number-t.number),s=iH(a,r),u=d.map((e,t)=>{let i=s?e.number*s:t;return{label:String(Math.round(1e15*i)/1e15),value:e.fileName,file:e.fileName}});o.push(...i.map(e=>({label:e.fileName,value:e.fileName,file:e.fileName})).filter(e=>e)),o.push(...u)}else e.files.forEach(e=>{"result"===e.type&&o.push({label:e.fileName,value:e.fileName,file:e.fileName})})}}),o},iF=e=>{let{simulations:t,simulation:i,swr:l}=e,[n,a]=(0,c.useState)(!1),[r,d]=(0,c.useState)(),[s,u]=(0,c.useState)(),[m,p]=(0,c.useState)(),v=null==i?void 0:i.scheme.configuration.initialization,f=null==i?void 0:i.scheme.configuration.dimension,Z=(0,c.useCallback)(e=>{let i=t.find(t=>t.id===e);u(i)},[t]);(0,c.useEffect)(()=>{var e,t;!r&&v.value&&d(v.value.type),!s&&(null===(e=v.value)||void 0===e?void 0:e.simulation)&&Z(null===(t=v.value)||void 0===t?void 0:t.simulation)},[v,r,s,Z]),(0,c.useEffect)(()=>{s&&iV(t,s.id).then(e=>p(e))},[t,s]);let g=[{label:"None",value:"none"}];v.coupling&&g.push({label:v.coupling.label,value:"coupling"}),v.direct&&g.push({label:v.direct.label,value:"direct"});let b={none:(0,o.tZ)("div",{})},w=v.value;{let x=v.coupling;if(null==x?void 0:x.compatibility){let C=t.map(e=>{let t=e.id===i.id||!x.compatibility.find(t=>t.algorithm===e.scheme.algorithm);return{label:e.name,value:e.id,disabled:t}}),k=x.compatibility.find(e=>{var t;return e.algorithm===(null==s?void 0:null===(t=s.scheme)||void 0===t?void 0:t.algorithm)}),S=null==k?void 0:k.filter;b.coupling=(0,o.BX)(o.HY,{children:[(0,o.tZ)(y.Z.Text,{children:"If you use coupling, the selected simulation mesh will be used, at least for the first iteration."}),(0,o.BX)(L.Z,{direction:"vertical",css:(0,O.iv)([en.KP.fullWidth,en.Ml.marginTop(10)]),children:[(0,o.tZ)(tz.Z,{css:en.KP.fullWidth,options:C,placeholder:"Select a simulation",value:null==w?void 0:w.simulation,async onChange(e){a(!0);try{await iK(t,i,e,l),Z(e)}catch(n){}finally{a(!1)}}}),n&&(0,o.tZ)(eN.Z,{}),(null==m?void 0:m.length)?(0,o.BX)(o.HY,{children:[(0,o.BX)(y.Z.Text,{children:[null==S?void 0:S.name,":"]},"simulation"),(0,o.tZ)(tz.Z,{css:en.KP.fullWidth,options:m,placeholder:"Select a "+S.name,value:null==w?void 0:w.result,async onChange(e,t){iW(i,e,t,l)}})]}):(0,o.tZ)(y.Z.Text,{type:"danger",children:"No results, please select an other simulation."})]})]})}let P=v.direct;(null==P?void 0:P.children)&&(b.direct=(0,o.tZ)(L.Z,{direction:"vertical",css:en.KP.fullWidth,children:P.children.map((e,t)=>{var n,a;if(2!==f||!e.only3D)return(0,o.tZ)(t4,{label:e.label,defaultValue:(null!==(a=null==w?void 0:null===(n=w.values)||void 0===n?void 0:n[t])&&void 0!==a?a:e.default).toString(),unit:e.unit,onValueChange:e=>iY(i,t,e,l)},t)})}))}return(0,o.tZ)(h.Z,{children:(0,o.tZ)(h.Z.Content,{children:(0,o.BX)(z.Z,{size:"small",children:[(0,o.tZ)(tz.Z,{css:(0,O.iv)([en.KP.fullWidth,en.Ml.marginTop(10)]),defaultValue:"none",value:r,options:g,async onChange(e){try{await iU(i,e,l),d(e)}catch(t){}}}),b[r||"none"]]})})})},iG={update:"Unable to delete boundary condition"},iJ=async(e,t,i,l,n)=>{try{let a=tU.Z.deepCopy(e),r=a.scheme.configuration.boundaryConditions,o=r[t],d=o.values[i];d.selected.forEach(e=>{l(ty(e))}),o.values=[...o.values.slice(0,i),...o.values.slice(i+1)];let s=!1;Object.keys(r).forEach(e=>{var t;if("index"===e||"title"===e||"done"===e)return;let i=r[e];(null===(t=i.values)||void 0===t?void 0:t.length)&&(s=!0)});let u={...r,done:s};await G.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","boundaryConditions"],value:u}]),n.mutateOneSimulation(a)}catch(c){throw(0,X.lt)(iG.update,c),c}},iq=e=>{let{type:t,index:i,simulation:l,swr:n}=e,[a,r]=(0,c.useState)(!1),{dispatch:d}=(0,c.useContext)(K),s=l.scheme.configuration.boundaryConditions,u=s[t],m=u.values[i];return(0,o.tZ)(M.m1,{loading:a,async onDelete(){r(!0);try{await iJ(l,t,i,d,n)}finally{r(!1)}},text:(0,o.BX)(o.HY,{children:["Are you sure you want to delete the condition"," ",(0,o.tZ)(y.Z.Text,{strong:!0,children:null==m?void 0:m.name}),"?"]})})},i_=e=>{let{simulation:t,swr:i,onEdit:l}=e,[n,a]=(0,c.useState)(!0),r=t.scheme.configuration.boundaryConditions,{dispatch:d}=(0,c.useContext)(K),s=(0,c.useCallback)((e,t)=>{d(td());let i=r[e],l=i.values[t].selected;null==l||l.forEach(e=>{d(tp(e))})},[r,d]),u=(0,c.useCallback)(()=>{d(ts())},[d]);return(0,o.tZ)(o.HY,{children:Object.keys(r).map(e=>{var d;if("index"===e||"title"===e||"done"===e)return;let c=r[e];return null===(d=c.values)||void 0===d?void 0:d.map((r,d)=>(0,o.BX)(z.Z,{css:tW.listItem,hoverable:!0,onMouseEnter:()=>s(e,d),onMouseLeave(){n&&u()},actions:[(0,o.tZ)(M.w6,{onEdit(){a(!1),l(e,d),setTimeout(()=>a(!0),500)}},"edit"),(0,o.tZ)(iq,{simulation:{id:t.id,scheme:t.scheme},type:e,index:d,swr:{mutateOneSimulation:i.mutateOneSimulation}},"delete")],children:[(0,o.tZ)(y.Z.Text,{strong:!0,children:r.name})," ",(0,o.BX)(y.Z.Text,{children:["(",c.label,")"]})]},d))}).filter(e=>e)})};var iQ=i(78045);let i$={name:"You need to define a name",type:"You need to select a type",selected:"You need to select a face",update:"Unable to add boundary condition"},i0=async(e,t,i)=>{try{let l={...t},n=l.type.key;l.uuid=(0,eF.Z)();let a=tU.Z.deepCopy(e),r=a.scheme.configuration.boundaryConditions,o=r[n];o.values=[...o.values||[],l];let d={...r,done:!0};await G.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","boundaryConditions"],value:d}]),await G.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","run"],value:{...a.scheme.configuration.run,done:!1}}]),i.mutateOneSimulation(a)}catch(s){throw(0,X.lt)(i$.update,s),s}},i1=e=>{let{simulation:t,boundaryCondition:i,swr:l,onError:n,onClose:a}=e,[r,d]=(0,c.useState)(!1);return(0,o.tZ)(M.HS,{loading:r,async onAdd(){d(!0);try{var e,r;if(!i.name){n(i$.name),d(!1);return}if(!(null===(e=i.type)||void 0===e?void 0:e.key)){n(i$.type),d(!1);return}if(!(null===(r=i.selected)||void 0===r?void 0:r.length)){n(i$.selected),d(!1);return}n(),await i0(t,i,l),d(!1),a()}catch(o){d(!1)}},needMargin:!0,children:"Add"})},i2={name:"You need to define a name",type:"You need to select a type",selected:"You need to select a face",update:"Unable to edit boundary condition"},i5=async(e,t,i,l)=>{try{let n=tU.Z.deepCopy(e),a=n.scheme.configuration.boundaryConditions,r=t.type.key,o=i.type.key;if(o!==r){let d=a[o],s=d.values.findIndex(e=>e.uuid===i.uuid);d.values=[...d.values.slice(0,s),...d.values.slice(s+1)]}if(o!==r){let u=a[r];u.values=[...u.values||[],t]}else{let c=a[r],m=c.values.findIndex(e=>e.uuid===t.uuid);c.values=[...c.values.slice(0,m),t,...c.values.slice(m+1)]}let h={...a};await G.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","boundaryConditions"],value:h}]),l.mutateOneSimulation(n)}catch(p){throw(0,X.lt)(i2.update,p),p}},i4=e=>{let{simulation:t,boundaryCondition:i,oldBoundaryCondition:l,swr:n,onError:a,onClose:r}=e,[d,s]=(0,c.useState)(!1);return(0,o.tZ)(M.w6,{loading:d,async onEdit(){s(!0);try{var e,o;if(!i.name){a(i2.name),s(!1);return}if(!(null===(e=i.type)||void 0===e?void 0:e.key)){a(i2.type),s(!1);return}if(!(null===(o=i.selected)||void 0===o?void 0:o.length)){a(i2.selected),s(!1);return}a(),await i5(t,i,l,n),s(!1),r()}catch(d){s(!1)}},primary:!0,needMargin:!0,children:"Edit"})},i8=e=>{var t,i,l,n,a,r,d;let{visible:s,geometries:u,simulation:m,boundaryCondition:h,swr:p,onClose:f}=e,[Z,g]=(0,c.useState)([]),[b,w]=(0,c.useState)([]),[C,k]=(0,c.useState)(),[S,P]=(0,c.useState)(),[E,O]=(0,c.useState)(),B=m.scheme.configuration.boundaryConditions,j=m.scheme.configuration.dimension;(0,c.useEffect)(()=>{!s&&S&&P(void 0)}),(0,c.useEffect)(()=>{s&&!S&&h?P(h):!s||S||h||void 0===C||P(e=>({...e,name:"Boundary condition "+(C+1)}))},[S,C,s,h]),(0,c.useEffect)(()=>{let e=Object.keys(B).map(e=>{var t;if("index"===e||"title"===e||"done"===e)return;let i=B[e];return null==i?void 0:null===(t=i.values)||void 0===t?void 0:t.map(e=>{if(e.uuid!==(null==h?void 0:h.uuid))return{label:e.name,selected:e.selected}}).filter(e=>e)}).flat().filter(e=>e);g(e)},[B,h]),(0,c.useEffect)(()=>{let e=Object.keys(B).map(e=>{if("index"===e||"title"===e||"done"===e)return;let t=B[e];return{key:e,label:t.label,children:t.children,values:t.values}}).filter(e=>e);w(e)},[B]),(0,c.useEffect)(()=>{let e=null==b?void 0:b.map(e=>{var t;return null===(t=e.values)||void 0===t?void 0:t.length}).filter(e=>e).reduce((e,t)=>e+t,0);k(e)},[b]);let T=(0,c.useCallback)(e=>{let t=e.target.value;P(e=>({...e,name:t}))},[]),X=(0,c.useCallback)(e=>{var t;let i=e.target.value,l=b.find(e=>e.key===i),n=B[i],a=null===(t=n.children)||void 0===t?void 0:t.map(e=>({checked:!0,value:e.default}));P(e=>({...e,type:{key:l.key,label:l.label,children:l.children},values:a}))},[B,b]),N=(0,c.useCallback)((e,t)=>{P(i=>({...i,values:[...i.values.slice(0,e),{checked:i.values[e].checked,value:t},...i.values.slice(e+1)]}))},[]),A=(0,c.useCallback)((e,t)=>{P(i=>({...i,values:[...i.values.slice(0,e),{checked:t,value:i.values[e].value},...i.values.slice(e+1)]}))},[]),R=(0,c.useCallback)(e=>{P(t=>({...t,selected:e}))},[]),I=(0,c.useMemo)(()=>{var e;return(null==S?void 0:S.type)&&(null===(e=S.type)||void 0===e?void 0:e.children)?(0,o.tZ)(z.Z,{children:S.type.children.map((e,t)=>{if(2!==j||!e.only3D)return(0,o.tZ)(t4,{css:en.Ml.marginBottom(10),label:e.label,defaultValue:String(S.values[t].value),defaultChecked:S.type.children.length>1?S.values[t].checked:void 0,onValueChange:e=>N(t,e),onCheckedChange:e=>A(t,e),unit:e.unit},t)})}):null},[S,j,A,N]);return(0,o.tZ)(id.Z,{css:eo.subPanel,title:"Boundary condition",placement:"left",closable:!1,open:s,mask:!1,maskClosable:!1,width:300,extra:(0,o.tZ)(v.Z,{type:"text",icon:(0,o.tZ)(er.Z,{}),onClick(){P(void 0),f()}}),footer:(0,o.BX)("div",{style:{display:"flex",justifyContent:"flex-end"},children:[(0,o.tZ)(M.Lw,{onCancel(){P(void 0),f()}}),h?(0,o.tZ)(i4,{boundaryCondition:{uuid:null!==(i=null==S?void 0:S.uuid)&&void 0!==i?i:h.uuid,name:null!==(l=null==S?void 0:S.name)&&void 0!==l?l:h.name,type:null!==(n=null==S?void 0:S.type)&&void 0!==n?n:h.type,geometry:null!==(a=null==S?void 0:S.geometry)&&void 0!==a?a:h.geometry,selected:null!==(r=null==S?void 0:S.selected)&&void 0!==r?r:h.selected,values:null!==(d=null==S?void 0:S.values)&&void 0!==d?d:h.values},oldBoundaryCondition:{uuid:h.uuid,name:h.name,type:h.type,geometry:h.geometry,selected:h.selected,values:h.values},simulation:{id:m.id,scheme:m.scheme},swr:{mutateOneSimulation:p.mutateOneSimulation},onError:e=>O(e),onClose:f}):(0,o.tZ)(i1,{boundaryCondition:{name:null==S?void 0:S.name,type:null==S?void 0:S.type,geometry:null==S?void 0:S.geometry,selected:null==S?void 0:S.selected,values:null==S?void 0:S.values},simulation:{id:m.id,scheme:m.scheme},swr:{mutateOneSimulation:p.mutateOneSimulation},onError:e=>O(e),onClose:f})]}),children:(0,o.BX)(L.Z,{direction:"vertical",css:en.KP.fullWidth,children:[(0,o.tZ)(z.Z,{size:"small",children:(0,o.tZ)(eZ.Z,{layout:"vertical",children:(0,o.tZ)(eZ.Z.Item,{label:(0,o.tZ)(y.Z.Text,{strong:!0,children:"Boundary condition name"}),children:(0,o.tZ)(eg.Z,{value:(null==S?void 0:S.name)||"",onChange:T,maxLength:50})})})}),(0,o.tZ)(z.Z,{size:"small",children:(0,o.tZ)(eZ.Z,{layout:"vertical",children:(0,o.tZ)(eZ.Z.Item,{label:(0,o.tZ)(y.Z.Text,{strong:!0,children:"Boundary condition type"}),children:(0,o.tZ)(iQ.ZP.Group,{optionType:"button",buttonStyle:"solid",value:null==S?void 0:null===(t=S.type)||void 0===t?void 0:t.key,onChange:X,children:null==b?void 0:b.map(e=>(0,o.tZ)(iQ.ZP.Button,{value:e.key,children:e.label},e.key))})})})}),I,(0,o.tZ)(tA.Z,{items:u.map(e=>({key:e.id,label:e.name,children:(0,o.tZ)(ip,{geometry:e,alreadySelected:Z,updateSelected:R})}))}),E&&(0,o.BX)(y.Z.Text,{children:[(0,o.tZ)(x.Z,{style:{color:"red"}})," ",E]})]})})},i3=e=>{let{simulation:t,geometries:i,swr:l,setVisible:n}=e,[a,r]=(0,c.useState)(),[d,s]=(0,c.useState)(!1),{dispatch:u}=(0,c.useContext)(K),m=t.scheme.configuration.boundaryConditions;T(()=>{var e;(null===(e=i[0])||void 0===e?void 0:e.summary)&&u(tu(2===i[0].summary.dimension?"edges":"faces"))},[i],[u]);let p=(0,c.useCallback)(()=>{r(void 0),s(!0),n(!1),u(td())},[u,n]),y=(0,c.useCallback)((e,t)=>{let i=m[e],l=i.values[t];r(l),s(!0),n(!1),u(td())},[m,u,n]),v=(0,c.useCallback)(()=>{u(ts()),s(!1),r(void 0),n(!0)},[u,n]);return i.length?(0,o.tZ)(h.Z,{children:(0,o.tZ)(h.Z.Content,{children:(0,o.BX)(z.Z,{size:"small",children:[(0,o.tZ)(M.HS,{onAdd:p,fullWidth:!0,primary:!1,children:"Add boundary condition"}),(0,o.tZ)(i_,{simulation:{id:t.id,scheme:t.scheme},swr:{mutateOneSimulation:l.mutateOneSimulation},onEdit:y}),(0,o.tZ)(i8,{visible:d,geometries:i.map(e=>({id:e.id,name:e.name,summary:e.summary})),simulation:{id:t.id,scheme:t.scheme},boundaryCondition:a&&{uuid:a.uuid,name:a.name,type:a.type,geometry:a.geometry,selected:a.selected,values:a.values},swr:{mutateOneSimulation:l.mutateOneSimulation},onClose:v})]})})}):(0,o.tZ)(N.Z.Simple,{})};var i6=i(3363),i7=i(67841),i9=i(36027),le=i(57184);let lt={name:"You need to define a name",point:"You need to select a point",formula:"You need to define a formula",update:"Unable to update simulation"},li=async(e,t,i)=>{try{let l=tU.Z.deepCopy(e),n=l.scheme.configuration.run,a=t.index;n.sensors[a]={name:t.name,point:t.point,formula:t.formula},await G.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","run"],value:n}]),i.mutateOneSimulation(l)}catch(r){throw(0,X.lt)(lt.update,r),r}},ll=e=>{let{simulation:t,sensor:i,onError:l,onClose:n,swr:a}=e,[r,d]=(0,c.useState)();return(0,o.tZ)(M.w6,{loading:r,primary:!0,needMargin:!0,async onEdit(){d(!0);try{if(!i.name){l(lt.name),d(!1);return}if(!i.point){l(lt.point),d(!1);return}if(!i.formula){l(lt.formula),d(!1);return}l(),await li(t,i,a),d(!1),n()}catch(e){d(!1)}},children:"Edit"})},ln={name:"You need to define a name",point:"You need to select a point",formula:"You need to define a formula",update:"Unable to update simulation"},la=async(e,t,i)=>{try{let l=tU.Z.deepCopy(e),n=l.scheme.configuration.run,a={...n,sensors:[...n.sensors||[],t]};await G.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","run"],value:a}]),i.mutateOneSimulation(l)}catch(r){throw(0,X.lt)(ln.update,r),r}},lr=e=>{let{simulation:t,sensor:i,onError:l,onClose:n,swr:a}=e,[r,d]=(0,c.useState)();return(0,o.tZ)(M.HS,{loading:r,needMargin:!0,async onAdd(){d(!0);try{if(!i.name){l(ln.name),d(!1);return}if(!i.point){l(ln.point),d(!1);return}if(!i.formula){l(ln.formula),d(!1);return}l(),await la(t,i,a),d(!1),n()}catch(e){d(!1)}},children:"Add"})},lo=e=>{var t,i,l,n,a,r;let{visible:d,simulation:s,sensor:u,onClose:h,swr:p}=e,[f,Z]=(0,c.useState)(),[g,b]=(0,c.useState)(),[w,C]=(0,c.useState)(),[k,S]=(0,c.useState)(),{point:P,dispatch:E}=(0,c.useContext)(K);(0,c.useEffect)(()=>{E(tu("point"))},[E]),(0,c.useEffect)(()=>{if(!u){let e=s.scheme.configuration.run;b("Sensor "+(e.sensors?e.sensors.length+1:1))}},[s,u]),(0,c.useEffect)(()=>{u&&(b(u.name),E(tv({x:u.point.x,y:u.point.y,z:u.point.z})),C(u.formula))},[u,E]);let O=(0,c.useCallback)(()=>{Z(!1),E(ts()),window.removeEventListener("click",O)},[E]),B=(0,c.useCallback)(()=>{f?O():(Z(!0),E(td()),setTimeout(()=>window.addEventListener("click",O),50))},[f,O,E]),j=(0,c.useCallback)((e,t,i)=>{E(tv({x:e,y:t,z:i}))},[E]),T=(0,c.useCallback)(e=>{C(e)},[]),X=(0,c.useCallback)(()=>{b(void 0),C(void 0),S(void 0),E(tv()),h()},[E,h]);return(0,o.tZ)(id.Z,{title:"Sensor",placement:"left",closable:!1,open:d,mask:!1,maskClosable:!1,width:300,extra:(0,o.tZ)(v.Z,{type:"text",icon:(0,o.tZ)(er.Z,{}),onClick:X}),footer:(0,o.BX)("div",{style:{display:"flex",justifyContent:"flex-end"},children:[(0,o.tZ)(M.Lw,{onCancel:X}),u?(0,o.tZ)(ll,{simulation:s,sensor:{...u,name:g,point:P,formula:w},onError:S,onClose:X,swr:p}):(0,o.tZ)(lr,{simulation:s,sensor:{name:g,point:P,formula:w},onError:S,onClose:X,swr:p})]}),children:(0,o.BX)(L.Z,{direction:"vertical",css:en.KP.fullWidth,children:[(0,o.BX)(z.Z,{size:"small",children:[(0,o.tZ)(y.Z.Text,{children:"Name"}),(0,o.tZ)(eg.Z,{value:g,onChange:e=>b(e.target.value)})]}),(0,o.tZ)(z.Z,{size:"small",children:(0,o.BX)(L.Z,{direction:"vertical",css:en.KP.fullWidth,children:[(0,o.BX)(L.Z,{css:en.KP.fullWidth,style:{justifyContent:"space-between"},children:[(0,o.tZ)(y.Z.Text,{children:"Point selection"}),(0,o.tZ)(m.Z,{title:"Pin in the geometry",children:(0,o.tZ)(v.Z,{size:"small",type:f?"primary":"default",icon:(0,o.tZ)(le.Z,{}),onClick:B})})]}),(0,o.tZ)(t4,{label:"X",defaultValue:null==P?void 0:P.x,onValueChange:e=>j(+e,null!==(t=null==P?void 0:P.y)&&void 0!==t?t:0,null!==(i=null==P?void 0:P.z)&&void 0!==i?i:0)}),(0,o.tZ)(t4,{label:"Y",defaultValue:null==P?void 0:P.y,onValueChange:e=>j(null!==(l=null==P?void 0:P.x)&&void 0!==l?l:0,+e,null!==(n=null==P?void 0:P.z)&&void 0!==n?n:0)}),(0,o.tZ)(t4,{label:"Z",defaultValue:null==P?void 0:P.z,onValueChange:e=>j(null!==(a=null==P?void 0:P.x)&&void 0!==a?a:0,null!==(r=null==P?void 0:P.y)&&void 0!==r?r:0,+e)})]})}),(0,o.tZ)(z.Z,{size:"small",css:en.KP.noBorderBottom,children:(0,o.tZ)(t4,{label:"Formula",defaultValue:w,onValueChange:T})}),k&&(0,o.BX)(y.Z.Text,{children:[(0,o.tZ)(x.Z,{style:{color:"red"}})," ",k]})]})})},ld={udpate:"Unable to update simulation"},ls=async(e,t,i,l)=>{try{let n=tU.Z.deepCopy(e),a=n.scheme.configuration.run;i(tv()),a.sensors=[...a.sensors.slice(0,t),...a.sensors.slice(t+1)],await G.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","run"],value:a}]),l.mutateOneSimulation(n)}catch(r){throw(0,X.lt)(ld.udpate,r),r}},lu=e=>{let{simulation:t,index:i,swr:l}=e,[n,a]=(0,c.useState)(),{dispatch:r}=(0,c.useContext)(K),d=t.scheme.configuration.run,s=d.sensors[i];return(0,o.tZ)(M.m1,{loading:n,text:(0,o.BX)(o.HY,{children:["Are you sure you want to delete the sensor"," ",(0,o.tZ)(y.Z.Text,{strong:!0,children:s.name})]}),async onDelete(){a(!0);try{await ls(t,i,r,l)}finally{a(!1)}}})},lc=e=>{var t;let{simulation:i,onEdit:l,swr:n}=e,[a,r]=(0,c.useState)(!0),d=i.scheme.configuration.run,{dispatch:s}=(0,c.useContext)(K),u=(0,c.useCallback)(e=>{s(td()),s(tv(e.point))},[s]),m=(0,c.useCallback)(()=>{a&&s(tv()),s(ts())},[a,s]);return(0,o.tZ)(o.HY,{children:null===(t=d.sensors)||void 0===t?void 0:t.map((e,t)=>(0,o.tZ)(z.Z,{css:(0,O.iv)([en.KP.textAlignCenter,tW.listItem]),hoverable:!0,onMouseEnter:()=>u(e),onMouseLeave:m,actions:[(0,o.tZ)(M.w6,{onEdit(){r(!1),l({...e,index:t}),setTimeout(()=>r(!0),500)}},"edit"),(0,o.tZ)(lu,{simulation:i,index:t,swr:n},"delete")],children:(0,o.tZ)(y.Z.Text,{strong:!0,css:en.KP.textAlignCenter,children:e.name})},t))})},lm=e=>{let{simulation:t,setVisible:i,setResult:l,setPostprocessing:n,swr:a}=e,[r,d]=(0,c.useState)(),[s,u]=(0,c.useState)(),m=(0,c.useCallback)(()=>{l(void 0),n(void 0),u(void 0),i(!1),d(!0)},[i,l,n]),h=(0,c.useCallback)(e=>{l(void 0),n(void 0),u(e),i(!1),d(!0)},[i,l,n]),p=(0,c.useCallback)(()=>{u(void 0),i(!0),d(!1)},[i]);return(0,o.BX)(z.Z,{size:"small",title:"Sensors",children:[(0,o.tZ)(lo,{visible:r,simulation:t,sensor:s,onClose:p,swr:a}),(0,o.BX)(L.Z,{direction:"vertical",css:en.KP.fullWidth,children:[(0,o.tZ)(v.Z,{css:en.KP.fullWidth,disabled:!1,type:"primary",icon:(0,o.tZ)(i9.Z,{}),onClick:m,children:"Add a sensor"}),(0,o.tZ)(lc,{simulation:t,onEdit:h,swr:a})]})]})};var lh=i(139),lp=i(71270);let ly={plugins:"Plugins error",pluginsLoad:"Unable to load plugins"},lv=e=>{let{disabled:t,cloudServer:l,onOk:n}=e,[a,r]=(0,c.useState)(!1),[d,m]=(0,c.useState)([]),h=(0,u.useRouter)(),[p,{errorPlugins:f}]=lp.Z.usePlugins();return(0,c.useEffect)(()=>{f&&(0,X.lt)(ly.plugins,f)},[f]),(0,c.useEffect)(()=>{tK.Z.list().then(e=>{m(e)}).catch(e=>{(0,X.lt)(ly.pluginsLoad,e)})},[]),(0,o.BX)(z.Z,{size:"small",title:"Computational resource",children:[(0,o.tZ)(tL.Z,{open:a,title:"Computational resource",okButtonProps:{disabled:!0,style:{display:"none"}},onCancel:()=>r(!1),style:{width:"unset"},children:(0,o.BX)(L.Z,{direction:"vertical",children:[(0,o.BX)(y.Z.Text,{children:["Your computational resource does not appear in this list? Create one in your"," ",(0,o.tZ)(M.Qj,{onClick:()=>h.push({pathname:"/dashboard",query:{page:"account",tab:"hpc"}}),children:"account settings"})]}),(0,o.tZ)(L.Z,{align:"start",direction:"horizontal",wrap:!0,children:null==p?void 0:p.map(e=>{let t=d.find(t=>t.key===e.key);if(!t)return;let l=s()(()=>i(64546)("./".concat(t.key,"/src/components")));return(0,o.tZ)(z.Z,{title:e.configuration.name.value,children:(0,o.tZ)(l,{data:e.data,onSelect(t){(0,tH.merge)(e,t),n(e),r(!1)}})},e.uuid)})})]})}),(0,o.BX)(L.Z,{direction:"vertical",css:en.KP.fullWidth,children:[l&&(0,o.BX)(o.HY,{children:[(0,o.BX)(y.Z.Text,{children:[(0,o.tZ)("span",{css:en.KP.textLight,children:"Plugin:"})," ",l.name]}),(0,o.BX)(y.Z.Text,{children:[(0,o.tZ)("span",{css:en.KP.textLight,children:"Name:"})," ",l.configuration.name.value]}),Object.keys(l.inUseConfiguration).map(e=>{let t=l.inUseConfiguration[e],i=t.value;return"boolean"==typeof i&&(i=i?"yes":"no"),(0,o.BX)(y.Z.Text,{children:[(0,o.BX)("span",{css:en.KP.textLight,children:[t.label,":"]})," ",i]},e)})]}),(0,o.tZ)(v.Z,{css:en.KP.fullWidth,disabled:t,type:l?"link":"primary",icon:(0,o.tZ)(lh.Z,{}),onClick:()=>r(!0),children:l?"Modify the resource":"Select a resource"})]})]})};var lf=i(15360),lZ=i(25935),lg=i(48764).lW;let lb={log:"Unable to get system log"},lw=async(e,t)=>{try{let i=await G.Z.log({id:e.id},t.systemLog),l=lg.from(i.log).toString();tL.Z.info({title:"System log",width:"unset",content:(0,o.tZ)("div",{style:{maxHeight:"70vh",overflow:"auto"},children:(0,o.tZ)("pre",{children:(0,o.tZ)("code",{children:(0,lZ.ZP)(l.replace(/\n\n/g,"\n").replace(/\n/g,"<br />"))})})})})}catch(n){(0,X.lt)(lb.log,n)}},lx=e=>{let{simulation:t,steps:i}=e,[l,n]=(0,c.useState)(!1),[a,r]=(0,c.useState)(!1);return(0,o.BX)(o.HY,{children:[(0,o.tZ)(id.Z,{title:"Log",open:l,onClose:()=>n(!1),width:"50%",children:(0,o.tZ)(tA.Z,{items:null==i?void 0:i.map(e=>{var i,l;return{key:e.label,label:e.label,children:(0,o.BX)(o.HY,{children:[e.systemLog&&(0,o.BX)(o.HY,{children:[(0,o.tZ)(v.Z,{loading:a,async onClick(){r(!0);try{await lw(t,e)}catch(i){}finally{r(!1)}},children:"Complete log"}),(0,o.tZ)("br",{})]}),e.link&&(0,o.BX)(o.HY,{children:[(0,o.tZ)("a",{href:"https://"+e.link.href,target:"_blank",rel:"noreferrer",children:(0,o.tZ)(v.Z,{type:"primary",children:e.link.label})}),(0,o.tZ)("br",{})]}),(0,o.BX)(iO.Z,{ghost:!0,children:[e.warning&&(0,o.tZ)(iO.Z.Panel,{css:tW.warning,header:(0,o.tZ)(y.Z.Text,{type:"warning",children:"Warnings"}),children:(0,lZ.ZP)(e.warning.replace(/\n\n/g,"\n").replace(/\n/g,"<br />"))},"warnings"),e.error&&(0,o.tZ)(iO.Z.Panel,{css:tW.error,header:(0,o.tZ)(y.Z.Text,{type:"danger",children:"Errors"}),children:(0,lZ.ZP)(e.error.replace(/\n\n/g,"\n").replace(/\n/g,"<br />"))},"errors")]}),(0,lZ.ZP)((null===(i=e.pluginLog)||void 0===i?void 0:i.replace(/\n\n/g,"\n").replace(/\n/g,"<br />"))||""),(0,lZ.ZP)((null===(l=e.log)||void 0===l?void 0:l.replace(/\n\n/g,"\n").replace(/\n/g,"<br />"))||"")]})}})})}),(0,o.tZ)(m.Z,{title:"Log",children:(0,o.tZ)(v.Z,{disabled:!i||!i.length,icon:(0,o.tZ)(lf.Z,{}),onClick:()=>n(!0)})})]})};var lC=i(23430);let lk={download:"Unable to download file"},lS=async(e,t)=>{try{let i=await ej.download({id:e.id},{originPath:t.originPath,fileName:t.fileName}),l=await i.blob(),n=window.URL.createObjectURL(new Blob([l])),a=document.createElement("a");a.href=n,a.setAttribute("download",t.name+"."+t.fileName.split(".").pop()),a.click()}catch(r){(0,X.lt)(lk.download,r)}},lP=e=>{let{simulation:t,file:i}=e,[l,n]=(0,c.useState)(!1);return(0,o.tZ)(m.Z,{title:"Download",children:(0,o.tZ)(v.Z,{loading:l,icon:(0,o.tZ)(lC.Z,{}),async onClick(){n(!0);try{await lS(t,i)}catch(e){}finally{n(!1)}}})})},lE={archive:"Unable to download archive"},lO=async e=>{try{let t=await ej.archive({id:e.id}),i=await t.blob(),l=window.URL.createObjectURL(new Blob([i])),n=document.createElement("a");n.href=l,n.setAttribute("download",e.scheme.name+".zip"),n.click()}catch(a){(0,X.lt)(lE.archive,a)}},lB=e=>{let{simulation:t}=e,[i,l]=(0,c.useState)(!1);return(0,o.tZ)(M.o6,{loading:i,async onDownload(){l(!0);try{await lO(t)}catch(e){}finally{l(!1)}}})},lj=e=>{var t;let{simulation:i,result:l,setResult:n}=e,[a,r]=(0,c.useState)(),[d,s]=(0,c.useState)(),[u,m]=(0,c.useState)(),h=null==i?void 0:null===(t=i.scheme)||void 0===t?void 0:t.configuration;return((0,c.useEffect)(()=>{var e;if(!(null==i?void 0:i.tasks)){r([]),s(void 0);return}let t=[],l=null==h?void 0:null===(e=h.run)||void 0===e?void 0:e.resultsFilter;i.tasks.forEach(e=>{if(e.file&&t.push(e.file),e.files){if(l){let i=RegExp(l.pattern),n=e.files.filter(e=>!i.test(e.fileName)),a=e.files.filter(e=>i.test(e.fileName)),r=iI(a,l),o=r.map(e=>e.number).filter((e,t,i)=>i.indexOf(e)===t).sort((e,t)=>e-t),d=iH(h,l),u=o.map((e,t)=>({label:Math.round(1e15*(d?e*d:t))/1e15,value:e}));t.push(...n),s({filtered:!0,name:l.name,files:r,options:u})}else t.push(...e.files)}}),r(t)},[i,h]),(0,c.useEffect)(()=>{!u&&d&&m(null==d?void 0:d.options[0].value)},[d,u]),a||d)?(null==a?void 0:a.length)||d?(0,o.tZ)(z.Z,{size:"small",title:"Results",extra:(0,o.tZ)(lB,{simulation:i&&{id:i.id,scheme:i.scheme}}),children:(0,o.BX)(L.Z,{direction:"vertical",css:en.KP.fullWidth,children:[null==a?void 0:a.map(e=>(0,o.BX)(L.Z,{style:{alignItems:"center"},children:[(0,o.tZ)(v.Z,{icon:(null==l?void 0:l.fileName)===(null==e?void 0:e.fileName)&&(null==l?void 0:l.name)===(null==e?void 0:e.name)?(0,o.tZ)(Z.Z,{style:{color:"#fad114"}}):(0,o.tZ)(g.Z,{}),onClick:()=>n((null==l?void 0:l.fileName)===(null==e?void 0:e.fileName)&&(null==l?void 0:l.name)===(null==e?void 0:e.name)?void 0:e)}),(0,o.tZ)(lP,{simulation:i&&{id:i.id},file:e&&{name:e.name,fileName:e.fileName,originPath:e.originPath}}),e.name]},e.name)),d&&(0,o.BX)(o.HY,{children:[d.name,(0,o.tZ)(tz.Z,{css:en.KP.fullWidth,options:d.options,value:u,onChange(e){let t=d.files.find(t=>t.number===e&&t.name===(null==l?void 0:l.name));n(t),m(e)}}),d.files.map(e=>{if(e.number===u)return(0,o.BX)(L.Z,{style:{alignItems:"center"},children:[(0,o.tZ)(v.Z,{icon:(null==l?void 0:l.fileName)===(null==e?void 0:e.fileName)&&(null==l?void 0:l.name)===(null==e?void 0:e.name)?(0,o.tZ)(Z.Z,{style:{color:"#fad114"}}):(0,o.tZ)(g.Z,{}),onClick:()=>n((null==l?void 0:l.fileName)===(null==e?void 0:e.fileName)&&(null==l?void 0:l.name)===(null==e?void 0:e.name)?void 0:e)}),(0,o.tZ)(lP,{simulation:i&&{id:i.id},file:e&&{name:e.name,fileName:e.fileName,originPath:e.originPath}}),e.name]},e.name)})]})]})}):(0,o.tZ)(z.Z,{size:"small",children:"No results yet"}):(0,o.tZ)(eN.Z,{})},lT={run:"Unable to run simulation",stop:"Unable to stop simulation",update:"Unable to update simulation"},lM=async(e,t,i)=>{try{let l=tU.Z.deepCopy(e),n=e.scheme.configuration;n.run.cloudServer=t,l.scheme.configuration=n,await G.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","run"],value:n.run}]),i.mutateOneSimulation(l),i.mutateSimulation(l)}catch(a){(0,X.lt)(lT.update,a)}},lX=async e=>{try{await G.Z.run({id:e.id})}catch(t){throw(0,X.lt)(lT.run,t),t}},lN=async e=>{try{await G.Z.stop({id:e.id})}catch(t){throw(0,X.lt)(lT.stop,t),t}},lz=e=>{var t,i;let{simulation:l,result:n,setResult:a,setPostprocessing:r,setVisible:d,swr:s}=e,[u,m]=(0,c.useState)(!1),[p,y]=(0,c.useState)(!1),[f,Z]=(0,c.useState)([]),[g,{mutateSimulation:b}]=G.Z.useSimulation(l.id,2e3),w=l.scheme.configuration,x=null==g?void 0:null===(t=g.scheme)||void 0===t?void 0:t.configuration;return((0,c.useEffect)(()=>{if(!w){m(!0);return}let e=!0;Object.keys(w).forEach(t=>{if("dimension"!==t&&"run"!==t){let i=w[t];i.done||(e=!1)}}),w.run.cloudServer||(e=!1),m(!e)},[w]),(0,c.useEffect)(()=>{var e,t;(null==g?void 0:null===(e=g.tasks)||void 0===e?void 0:e.find(e=>(null==e?void 0:e.status)==="error"))?y(!1):(null==g?void 0:null===(t=g.tasks)||void 0===t?void 0:t.find(e=>e&&"finish"!==e.status))?y(!0):y(!1)},[null==g?void 0:g.tasks]),(0,c.useEffect)(()=>{var e;let t=[];null==g||null===(e=g.tasks)||void 0===e||e.forEach(e=>{e&&(t[e.index]={index:e.index,label:e.label,status:e.status,log:e.log,pluginLog:e.pluginLog,warning:e.warning,error:e.error,systemLog:e.systemLog,link:e.link})}),Z(t)},[null==g?void 0:g.tasks]),l&&g&&(null==g?void 0:g.id)!=="0")?(0,o.tZ)(h.Z,{children:(0,o.tZ)(h.Z.Content,{children:(0,o.BX)(L.Z,{direction:"vertical",css:en.KP.fullWidth,children:[(0,o.tZ)(lm,{simulation:l,setVisible:d,setResult:a,setPostprocessing:r,swr:{mutateOneSimulation:s.mutateOneSimulation}}),(0,o.tZ)(lv,{disabled:p,cloudServer:null==x?void 0:null===(i=x.run)||void 0===i?void 0:i.cloudServer,onOk:async e=>lM(l,e,{...s,mutateSimulation:b})}),(0,o.tZ)(z.Z,{size:"small",title:"Run",children:(0,o.BX)(L.Z,{direction:"vertical",css:en.KP.fullWidth,size:20,children:[(0,o.BX)("div",{css:en.KP.fullWidth,style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,o.BX)(L.Z,{children:[(0,o.tZ)(v.Z,{disabled:u,type:"primary",icon:(0,o.tZ)(i7.Z,{}),loading:p,async onClick(){y(!0);try{await lX(l)}catch(e){y(!1)}},children:"Run"}),(0,o.tZ)(v.Z,{disabled:!p,danger:!0,icon:(0,o.tZ)(eK.Z,{}),shape:"circle",async onClick(){try{await lN(l),y(!1)}catch(e){}}})]}),(0,o.tZ)(lx,{simulation:{id:l.id},steps:f})]}),(0,o.tZ)(i6.Z,{direction:"vertical",items:f.map((e,t)=>({key:e.label,title:e.label,description:"("+(t+1)+"/"+f.length+")",status:e.status}))})]})}),(0,o.tZ)(lj,{simulation:g&&{id:g.id,scheme:g.scheme,tasks:g.tasks},result:n&&{name:n.name,fileName:n.fileName},setResult:a})]})})}):(0,o.tZ)(h.Z,{children:(0,o.tZ)(h.Z.Content,{children:(0,o.tZ)(z.Z,{size:"small",children:(0,o.tZ)(eN.Z,{})})})})};var lL=i(1402),lA=[{key:"warpByVector",label:"Warp by vector",parameters:[{key:"Vectors",label:"Vectors",rules:[{required:!0,message:"Vectors is required"}]},{key:"ScaleFactor",label:"Scale factor",default:"1",rules:[{required:!0,message:"Scale factor is required"}]}]},{key:"contour",label:"Contour",parameters:[{key:"ContourBy",label:"Contour by",rules:[{required:!0,message:"ContourBy by is required"}]},{key:"isosurface",label:"Isosurface",default:"0",rules:[{required:!0,message:"Isosurface is required"}]}]},{key:"streamTracer",label:"Stream tracer",parameters:[{key:"Vectors",label:"Vectors",rules:[{required:!0,message:"Vectors is required"}]}]}];let lR=async(e,t,i,l)=>{let n=await (0,q.R)("/api/postprocessing",{method:"POST",headers:{Accept:"application/json"},body:JSON.stringify({simulation:e,result:t,filter:i,parameters:l})});return n.json()};var lI={run:lR};let lH={run:"Unable to run filter"},lD=async(e,t,i,l)=>{try{return await lI.run(e,t,i,l)}catch(n){(0,X.lt)(lH.run,n)}},lU=e=>{let{simulation:t,result:i,postprocessing:l,setResult:n}=e,[a,r]=(0,c.useState)(),[d,s]=(0,c.useState)(),[u,p]=(0,c.useState)(),[y,f]=(0,c.useState)();if((0,c.useEffect)(()=>{!i&&a&&r(!1)},[i,a]),(0,c.useEffect)(()=>{t||(s(void 0),f(void 0))},[t,i]),!t||!i)return null;let b=t.scheme.configuration.run.postprocessing;if(!b)return null;let w=lA.map(e=>{if(b.find(t=>t.key===e.key))return{label:e.label,value:e.key}}).filter(e=>e);if(!w.length)return null;let x=null;if(d){let C=lA.find(e=>e.key===d),k=b.find(e=>e.key===d);(null==C?void 0:C.parameters)&&(x=C.parameters.map((e,t)=>{var i;let l=null==k?void 0:null===(i=k.parameters)||void 0===i?void 0:i.find(t=>t.key===e.key);return(null==l?void 0:l.value)?(0,o.tZ)(eZ.Z.Item,{label:e.label,name:["parameters",t],initialValue:l.value,rules:e.rules,children:(0,o.tZ)(eg.Z,{disabled:!0})},e.key):(null==l?void 0:l.options)?(0,o.tZ)(eZ.Z.Item,{label:e.label,name:["parameters",t],rules:e.rules,children:(0,o.tZ)(tz.Z,{options:l.options.map(e=>({label:e,value:e}))})},e.key):(0,o.tZ)(eZ.Z.Item,{label:e.label,name:["parameters",t],rules:e.rules,initialValue:e.default,children:(0,o.tZ)(eg.Z,{})},e.key)}))}return(0,o.tZ)(h.Z,{style:{position:"absolute",zIndex:101,right:25,bottom:50,backgroundColor:"rgba(255, 255, 255, 0)"},children:(0,o.BX)(h.Z.Content,{children:[(0,o.tZ)(m.Z,{title:"Post-processing",children:(0,o.tZ)(v.Z,{type:"primary",icon:(0,o.tZ)(lL.Z,{}),onClick:()=>r(!0),style:{width:40,height:40,border:"1px solid #5E14FA",borderRadius:20,marginBottom:-20}})}),(0,o.BX)(id.Z,{title:"Post-processing",closable:!0,onClose:()=>r(!1),open:a,mask:!1,maskClosable:!1,children:[(0,o.tZ)(eZ.Z,{style:{margin:"24px 0"},children:(0,o.tZ)(eZ.Z.Item,{name:"filter",label:"Filter",children:(0,o.tZ)(tz.Z,{placeholder:"Select a filter",options:w,onChange:s})})}),(0,o.BX)(eZ.Z,{layout:"vertical",style:{margin:"24px 0"},async onFinish(e){p(!0);try{let l=await lD({id:t.id},i,d,e.parameters||[]);f(l)}catch(n){}p(!1)},children:[x,(0,o.tZ)(eZ.Z.Item,{children:(0,o.tZ)(v.Z,{type:"primary",loading:u,htmlType:"submit",icon:(0,o.tZ)(i7.Z,{}),children:"Run"})})]}),y&&(0,o.tZ)(z.Z,{size:"small",title:"Post-processing",extra:d,children:(0,o.tZ)(L.Z,{direction:"vertical",css:en.KP.fullWidth,children:y.length?y.map(e=>(0,o.BX)(L.Z,{children:[(0,o.tZ)(v.Z,{icon:(null==l?void 0:l.fileName)===e.fileName&&(null==l?void 0:l.name)===e.name?(0,o.tZ)(Z.Z,{style:{color:"#fad114"}}):(0,o.tZ)(g.Z,{}),onClick:()=>n((null==l?void 0:l.fileName)===e.fileName&&(null==l?void 0:l.name)===e.name?void 0:{type:"postprocessing",...e})}),(0,o.tZ)(lP,{simulation:{id:t.id},file:{name:e.name,fileName:e.fileName,originPath:e.originPath}}),e.name]},e.glb)):"No results"})})]})]})})},lK={plugins:"Unable to load plugins",update:"Unable to update simulation"},lW=(e,t)=>{tK.Z.list().then(i=>{let l=lY(e,tD.Z,i);t(l)}).catch(e=>{(0,X.lt)(lK.plugins,e)})},lY=(e,t,i)=>{let l=t;return i.forEach(t=>{var i;(null==e?void 0:null===(i=e.authorizedplugins)||void 0===i?void 0:i.includes(t.key))&&"Model"===t.category&&(l=[...l,...t.models])}),l},lV=e=>{let{visible:t,user:i,onOk:l,onCancel:n}=e,[a,r]=(0,c.useState)(),[d,s]=(0,c.useState)(!1),[u,m]=(0,c.useState)([]),[y,v]=(0,c.useState)(),[f,Z]=(0,c.useState)();(0,c.useEffect)(()=>{i&&lW(i,m)},[i]),(0,c.useEffect)(()=>{let e=u.map(e=>e.category).filter((e,t,i)=>i.indexOf(e)===t).map(e=>({key:e,value:e}));v(e)},[u]);let g=(0,c.useCallback)(e=>{let{key:t}=e,i=u.find(e=>e.algorithm===t);r(tU.Z.deepCopy(i))},[u]),b=(0,c.useCallback)(e=>{let{key:t}=e,l=i.models.find(e=>e.algorithm===t);r(tU.Z.deepCopy(l))},[i]),w=[{key:"category",disabled:!0,label:(0,o.tZ)(tz.Z,{css:en.KP.fullWidth,options:y,allowClear:!0,showArrow:!1,placeholder:"Category filter",onChange:e=>Z(e)})}];u.forEach(e=>{f&&e.category!==f||w.push({key:e.algorithm,label:e.name})});let x=[{key:"category",disabled:!0,label:(0,o.tZ)(tz.Z,{css:en.KP.fullWidth,options:y,allowClear:!0,showArrow:!1,placeholder:"Category filter",onChange:e=>Z(e)})}];return i&&i.models.forEach(e=>{f&&e.category!==f||x.push({key:e.algorithm,label:e.name})}),(0,o.tZ)(tL.Z,{open:t,title:"Create simulation",okText:"Create",okButtonProps:{loading:d},async onOk(){if(s(!0),a)try{await l(a)}catch(e){}s(!1)},onCancel:()=>n(),width:"80%",children:(0,o.BX)(h.Z,{children:[(0,o.tZ)(h.Z.Sider,{theme:"light",width:300,children:(0,o.tZ)(tA.Z,{items:[{key:"tanatloc",label:"Tanatloc algorithm",children:(0,o.tZ)(p.Z,{mode:"inline",items:w,onSelect:g})},{key:"personal",label:"User algorithm",children:(0,o.tZ)(p.Z,{mode:"inline",items:x,onSelect:b})}]})}),(0,o.tZ)(h.Z.Content,{css:tW.selector,children:(0,o.tZ)(es.Z.Html,{html:null==a?void 0:a.description})})]})})},lF=async(e,t,i)=>{try{let l=t.find(t=>{var i;return t.algorithm===(null==e?void 0:null===(i=e.scheme)||void 0===i?void 0:i.algorithm)}),n=tU.Z.deepCopy(e);(0,tH.merge)(n.scheme,l),await G.Z.update({id:e.id},[{key:"scheme",value:n.scheme}]),i.mutateOneSimulation(n)}catch(a){(0,X.lt)(lK.update,a)}},lG=e=>{let{user:t,simulation:i,swr:l}=e,[n,a]=(0,c.useState)([]);return(0,c.useEffect)(()=>{t&&lW(t,a)},[t]),(0,c.useEffect)(()=>{let e=n.find(e=>{var t;return e.algorithm===(null==i?void 0:null===(t=i.scheme)||void 0===t?void 0:t.algorithm)});if(e&&(null==i?void 0:i.scheme)){let t=(0,tR.Z)(i.scheme,e),a=(0,tI.Z)(i.scheme,e);(Object.keys(t).length||Object.keys(a).length)&&(tL.Z.info({title:"Update",content:"Your model need an update, please wait.",closable:!1,okButtonProps:{hidden:!0}}),lF(i,n,l).finally(()=>tL.Z.destroyAll()))}},[i,n,l]),null};var lJ={Selector:lV,Updater:lG,About:t2,Geometry:ii,Materials:iE,Parameters:iR,Initialization:iF,BoundaryConditions:i3,Run:lz,Postprocessing:lU};let lq=s()(()=>Promise.all([i.e(391),i.e(2073),i.e(1938)]).then(i.bind(i,61938)),{loadableGenerated:{webpack:()=>[61938]},ssr:!1}),l_={dashboard:{key:"dashboard"},geometries:{label:"GEOMETRIES",key:"geometries"},simulations:{label:"SIMULATIONS",key:"simulations"}},lQ={user:"Unable to get user",project:"Unable to get project",simulations:"Unable to get simulations",geometries:"Unable to get geometries",add:"Unable to add simulation"},l$=(e,t,i)=>{e.push({pathname:"/dashboard",query:{page:t,workspaceId:i}})},l0=async(e,t,i)=>{try{let l=await G.Z.add({id:e.id},{name:t.name,scheme:t});i.addOneSimulation(l),i.mutateProject({id:e.id,simulations:[...e.simulations||[],l.id]})}catch(n){throw(0,X.lt)(lQ.add,n),n}},l1=()=>{let e=(0,u.useRouter)(),{page:t,workspaceId:i,projectId:l}=e.query,[n,a]=(0,c.useState)(!1),[r,d]=(0,c.useState)([]),[s,B]=(0,c.useState)(!1),[j,z]=(0,c.useState)(),[L,A]=(0,c.useState)(),[R,I]=(0,c.useState)(),[D,U]=(0,c.useState)(),[K,W]=(0,c.useState)(),[J,q]=(0,c.useState)(!0),[_,{errorUser:Q,loadingUser:$}]=V.Z.useUser(),[ee,{mutateProject:et,errorProject:ei,loadingProject:er}]=F.Z.useProject(l),[eo,{addOneSimulation:es,delOneSimulation:eu,mutateOneSimulation:ec,errorSimulations:em,loadingSimulations:eh}]=G.Z.useSimulations(null==ee?void 0:ee.simulations),[ep,{addOneGeometry:ey,delOneGeometry:ev,mutateOneGeometry:ef,errorGeometries:eZ,loadingGeometries:eg}]=el.useGeometries(null==ee?void 0:ee.geometries),eb=(0,c.useCallback)(e=>{d(t=>[...t,e])},[]),ew=(0,c.useCallback)(e=>{let t=r.findIndex(t=>t.id===e.id);-1!==t&&d(e=>[...e.slice(0,t),...e.slice(t+1)])},[r]),ex=(0,c.useCallback)(()=>{W(void 0),U(void 0)},[]);(0,c.useEffect)(()=>{$||_||e.replace("/login")},[_,$,e]),(0,c.useEffect)(()=>{Q&&(0,X.lt)(lQ.user,Q),ei&&(0,X.lt)(lQ.project,ei),em&&(0,X.lt)(lQ.simulations,em),eZ&&(0,X.lt)(lQ.geometries,eZ)},[Q,ei,em,eZ]),T(()=>{er||eg?a(!1):ep.length?a(!1):a(!0)},[er,eg,ep]),T(()=>{if(!eg){if(r.length){let e=!1,t=r.map(t=>{let i=ep.find(e=>e.id===(null==t?void 0:t.id));return i?JSON.stringify({...i,visible:void 0})!==JSON.stringify({...t,visible:void 0})?(e=!0,i):t:(e=!0,null)}).filter(e=>e);e&&d(t)}else d(ep[0]?[ep[0]]:[])}},[eg,ep,r],[d]),T(()=>{if(!eh&&j){let e=eo.find(e=>e.id===(null==j?void 0:j.id));e?JSON.stringify(e)!==JSON.stringify(j)&&(z(e),D&&D.key===l_.simulations.key&&eX(D.id,D.item)):(ex(),z(void 0))}},[eo,eh,j,D],[z,ex]);let eC=(0,c.useCallback)(e=>{let t=ep.findIndex(t=>t.id===e);-1!==t&&d(e=>[...e.slice(0,t),{id:"0",needCleanup:!0},...e.slice(t+1)])},[ep]),ek=(0,c.useCallback)(e=>{let t=ep.find(t=>t.id===e);if(!t)return;let i=r.find(t=>t.id===e);i||d(e=>[...e,{...t,visible:!0}]),W((0,o.tZ)(ed,{visible:!0,title:"Geometry",onClose:ex,children:(0,o.tZ)(eP,{project:{id:ee.id,geometries:ee.geometries},geometry:{id:t.id,name:t.name,summary:t.summary},swr:{mutateProject:et,mutateOneGeometry:ef,delOneGeometry:ev},close:ex,onCleanup:eC})}))},[ee,ep,r,et,ef,ev,eC,ex]),eS=(0,c.useCallback)(e=>{W((0,o.tZ)(ed,{visible:!0,title:"About",onClose:ex,children:(0,o.tZ)(lJ.About,{project:{id:ee.id,simulations:ee.simulations},simulation:{id:e.id,name:e.name,scheme:e.scheme},swr:{mutateProject:et,addOneSimulation:es,delOneSimulation:eu,mutateOneSimulation:ec}})}))},[ee,et,es,eu,ec,ex]),eE=(0,c.useCallback)(e=>{W((0,o.tZ)(ed,{visible:!0,title:"Geometry",onClose:ex,children:(0,o.tZ)(lJ.Geometry,{loadedGeometries:ep,geometries:r.map(e=>({id:e.id,summary:e.summary})),simulation:{id:e.id,scheme:e.scheme},setGeometries:d,swr:{mutateOneSimulation:ec}})}))},[ep,r,ec,ex]),eO=(0,c.useCallback)(e=>{W((0,o.tZ)(ed,{visible:!0,title:"Parameters",onClose:ex,children:(0,o.tZ)(lJ.Parameters,{simulation:{id:e.id,scheme:e.scheme},swr:{mutateOneSimulation:ec}})}))},[ec,ex]),eB=(0,c.useCallback)(e=>{W((0,o.tZ)(ed,{visible:J,title:"Materials",onClose:ex,children:(0,o.tZ)(lJ.Materials,{geometries:r.map(e=>({id:e.id,name:e.name,summary:e.summary})),simulation:{id:e.id,scheme:e.scheme},swr:{mutateOneSimulation:ec},setVisible:e=>q(e)})}))},[r,J,ec,ex]),ej=(0,c.useCallback)(e=>{W((0,o.tZ)(ed,{visible:!0,title:"Initialization",onClose:ex,children:(0,o.tZ)(lJ.Initialization,{simulations:eo,simulation:e,swr:{mutateOneSimulation:ec}})}))},[eo,ec,ex]),eT=(0,c.useCallback)(e=>{W((0,o.tZ)(ed,{visible:J,title:"Boundary conditions",onClose:ex,children:(0,o.tZ)(lJ.BoundaryConditions,{geometries:r.map(e=>({id:e.id,name:e.name,summary:e.summary})),simulation:{id:e.id,scheme:e.scheme},swr:{mutateOneSimulation:ec},setVisible:e=>q(e)})}))},[r,J,ec,ex]),eM=(0,c.useCallback)(e=>{W((0,o.tZ)(ed,{visible:J,title:"Run",onClose:ex,children:(0,o.tZ)(lJ.Run,{simulation:{id:e.id,scheme:e.scheme},result:L&&{name:L.name,fileName:L.fileName},setResult:A,setPostprocessing:I,setVisible:e=>q(e),swr:{mutateOneSimulation:ec}})}))},[L,J,ec,ex]),eX=(0,c.useCallback)((e,t)=>{var i,l,n,a,r,o;let s=eo.find(t=>t.id===e);if(!s)return;z(s);let u=null===(i=s.scheme)||void 0===i?void 0:null===(l=i.configuration)||void 0===l?void 0:null===(n=l.geometry)||void 0===n?void 0:n.value,c=null===(a=s.scheme)||void 0===a?void 0:null===(r=a.configuration)||void 0===r?void 0:null===(o=r.geometry)||void 0===o?void 0:o.values;if(u){let m=ep.find(e=>e.id===u);m&&d([m])}else if(c){let h=ep.filter(e=>c.includes(e.id));d(h)}switch(t){case"about":eS(s);break;case"geometry":eE(s);break;case"parameters":eO(s);break;case"materials":eB(s);break;case"initialization":ej(s);break;case"boundaryConditions":eT(s);break;case"run":eM(s);break;default:W(void 0)}},[ep,eo,eS,eE,eO,eB,ej,eT,eM]);T(()=>{D&&(D.key===l_.geometries.key?ek(D.id):(eX(D.id,D.item),"run"!==D.item&&(A(void 0),I(void 0))))},[D,J],[ek,eX,ex]),(0,c.useEffect)(()=>{!L&&R&&I(void 0)},[L,R]);let eN=(0,c.useCallback)(e=>{let t,{keyPath:i}=e,l=i.pop(),n=i.pop(),a=i.pop();a&&(t=a.split("&").pop()),U({key:l,id:n,item:t})},[]),ez=(0,c.useMemo)(()=>ep.map(e=>{let t=r.find(t=>t.id===e.id);return{key:e.id,icon:(0,o.tZ)(f.Z,{}),label:(0,o.BX)("div",{children:[e.name,t?(0,o.tZ)(Z.Z,{onClick(t){var i,l,n;t.stopPropagation(),(null==K?void 0:null===(i=K.props)||void 0===i?void 0:null===(l=i.children)||void 0===l?void 0:null===(n=l.type)||void 0===n?void 0:n.componentName)===eP.componentName&&ex(),ew(e)}}):(0,o.tZ)(g.Z,{onClick(t){t.stopPropagation(),eb(e)}})]})}}),[ep,r,K,eb,ew,ex]),eL=(0,c.useMemo)(()=>eo.map(e=>{let t=e.scheme.configuration||{},i=[];Object.keys(t).forEach(l=>{if("dimension"===l)return;let n=t[l],a=(0,o.tZ)(b.Z,{style:{color:"green"}});n.error&&(a=(0,o.tZ)(w.Z,{style:{color:"red"}})),n.done||(a=(0,o.tZ)(x.Z,{style:{color:"orange"}})),"geometry"!==l||ep.filter(e=>e.id===n.value).length||eg||(a=(0,o.tZ)(x.Z,{style:{color:"orange"}}),n.done=null),i[n.index]={key:e.id+"&"+l,disabled:!r.length,icon:a,label:n.title}});let l=e.name;return e.scheme.user&&(l=(0,o.BX)(o.HY,{children:[(0,o.tZ)(m.Z,{title:"User algorithm",placement:"right",children:(0,o.tZ)(C.Z,{style:{position:"absolute",top:0,left:14,fontSize:14,color:"#fad114"}})}),e.name]})),{key:e.id,icon:(0,o.tZ)(k.Z,{}),label:l,children:[{key:e.id+"&about",disabled:!r.length,icon:(0,o.tZ)(b.Z,{style:{color:"green"}}),label:"About"},...i]}}),[r,eg,ep,eo]);return!_||$||er?(0,o.tZ)(N.Z.Simple,{}):"0"===ee.id?(0,o.tZ)(H,{}):(0,o.tZ)(Y,{children:(0,o.BX)(h.Z,{hasSider:!0,children:[(0,o.BX)(h.Z.Sider,{theme:"light",css:ea.sider,width:256,children:[(0,o.tZ)("div",{css:en.KP.logo,children:(0,o.tZ)("img",{src:"/images/logo.svg",alt:"Tanatloc"})}),(0,o.tZ)(p.Z,{css:ea.menu1,mode:"inline",items:[{key:"menu-go-back",disabled:!0,style:{cursor:"unset",margin:"10px 0",paddingLeft:10},label:(0,o.tZ)(M.ks,{buttonCss:en.KP.fullWidth,onClick:()=>l$(e,t,i),children:"Return to dashboard"})},{type:"divider"},{key:"title",disabled:!0,className:"Menu-title",label:(0,o.tZ)(y.Z.Paragraph,{ellipsis:{tooltip:!0,rows:1},children:ee.title})}]}),(0,o.tZ)("div",{css:ea.menuScroll,children:(0,o.tZ)(p.Z,{mode:"inline",css:ea.menu2,defaultOpenKeys:[l_.geometries.key,l_.simulations.key],items:[{key:l_.geometries.key,className:"SubMenu",icon:eg?(0,o.tZ)(S.Z,{}):(0,o.tZ)(f.Z,{}),label:(0,o.BX)(y.Z.Text,{strong:!0,children:[l_.geometries.label," (",ep.length,")"]}),children:[{key:"new_geometry",disabled:!0,label:(0,o.tZ)(v.Z,{icon:(0,o.tZ)(P.Z,{}),onClick:()=>a(!0),children:"New Geometry"})},{key:"geometry-needed",disabled:!0,className:r.length?"display-none":"",icon:(0,o.tZ)(x.Z,{style:{color:"red"}}),label:"A Geometry is needed"},...ez]},{key:l_.simulations.key,className:"SubMenu",icon:eh?(0,o.tZ)(S.Z,{}):(0,o.tZ)(k.Z,{}),label:(0,o.BX)(y.Z.Text,{strong:!0,children:[l_.simulations.label," (",eo.length,")"]}),children:[{key:"new_simulation",disabled:!0,label:(0,o.tZ)(v.Z,{disabled:!ep.length,icon:(0,o.tZ)(E.Z,{}),onClick:()=>B(!0),children:"New Simulation"})},...eL]}],onClick:eN})})]}),(0,o.BX)(h.Z.Content,{css:(0,O.iv)([en.KP.noScroll,{position:"relative"}]),children:[(0,o.tZ)(eP.Add,{visible:n,project:{id:ee.id,geometries:ee.geometries},swr:{mutateProject:et,addOneGeometry:ey},setVisible:e=>a(e)}),(0,o.tZ)(lJ.Selector,{user:{authorizedplugins:_.authorizedplugins,models:_.models},visible:s,async onOk(e){try{await l0(ee,e,{addOneSimulation:es,mutateProject:et}),B(!1)}catch(t){}},onCancel:()=>B(!1)}),(0,o.tZ)(lJ.Updater,{user:{authorizedplugins:_.authorizedplugins},simulation:j&&{id:j.id,scheme:j.scheme},swr:{mutateOneSimulation:ec}}),K,(0,o.tZ)(tN,{project:{id:ee.id,title:ee.title},simulation:j&&{id:j.id},geometries:r.map(e=>({id:e.id,needCleanup:e.needCleanup})),result:L&&{glb:L.glb,originPath:L.originPath},postprocessing:R&&{glb:R.glb,originPath:R.originPath}}),(0,o.tZ)(lq,{simulation:j&&{id:j.id,name:j.name}}),(0,o.tZ)(lJ.Postprocessing,{simulation:j&&{id:j.id,scheme:j.scheme},result:L&&{name:L.name,fileName:L.fileName,originPath:L.originPath},postprocessing:R&&{name:R.name,fileName:R.fileName},setResult:I})]})]})})};var l2=l1},64546:function(e,t,i){var l={"./local/src/components":[94295,4295]};function n(e){if(!i.o(l,e))return Promise.resolve().then(function(){var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t});var t=l[e],n=t[0];return i.e(t[1]).then(function(){return i(n)})}n.keys=function(){return Object.keys(l)},n.id=64546,e.exports=n}}]);