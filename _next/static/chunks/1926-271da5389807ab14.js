(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1926],{95940:function(e,t,i){"use strict";i.d(t,{Z:function(){return r}});var s=i(87462),l=i(67294),a={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M193 796c0 17.7 14.3 32 32 32h574c17.7 0 32-14.3 32-32V563c0-176.2-142.8-319-319-319S193 386.8 193 563v233zm72-233c0-136.4 110.6-247 247-247s247 110.6 247 247v193H404V585c0-5.5-4.5-10-10-10h-44c-5.5 0-10 4.5-10 10v171h-75V563zm-48.1-252.5l39.6-39.6c3.1-3.1 3.1-8.2 0-11.3l-67.9-67.9a8.03 8.03 0 00-11.3 0l-39.6 39.6a8.03 8.03 0 000 11.3l67.9 67.9c3.1 3.1 8.1 3.1 11.3 0zm669.6-79.2l-39.6-39.6a8.03 8.03 0 00-11.3 0l-67.9 67.9a8.03 8.03 0 000 11.3l39.6 39.6c3.1 3.1 8.2 3.1 11.3 0l67.9-67.9c3.1-3.2 3.1-8.2 0-11.3zM832 892H192c-17.7 0-32 14.3-32 32v24c0 4.4 3.6 8 8 8h688c4.4 0 8-3.6 8-8v-24c0-17.7-14.3-32-32-32zM484 180h56c4.4 0 8-3.6 8-8V76c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v96c0 4.4 3.6 8 8 8z"}}]},name:"alert",theme:"outlined"},n=i(44192),r=l.forwardRef(function(e,t){return l.createElement(n.Z,(0,s.Z)({},e,{ref:t,icon:a}))})},69944:function(e,t,i){"use strict";i.d(t,{Z:function(){return l}});var s=i(39360),l={add:async(e,t)=>(await (0,s.R)("/api/avatar",{method:"POST",headers:{Accept:"application/json"},body:JSON.stringify({file:e,project:t})})).json()}},36936:function(e,t,i){"use strict";i.d(t,{Z:function(){return n}});var s=i(81758),l=i(67294),a=i(39360),n={useGeometries:e=>{var t;let{data:i,error:n,mutate:r}=(0,s.ZP)(["/api/geometries",JSON.stringify({ids:e})],e=>{let[t,i]=e;return(0,a._)(t,i)}),o=null!==(t=null==i?void 0:i.geometries)&&void 0!==t?t:[],d=(0,l.useCallback)(async e=>{let t=[...o,e];await r({geometries:t})},[o,r]),c=(0,l.useCallback)(async e=>{let t=o.filter(t=>t.id!==e.id);await r({geometries:t})},[o,r]),u=(0,l.useCallback)(async e=>{let t=o.map(t=>(t.id===e.id&&(t={...t,...e}),t));await r({geometries:t})},[o,r]);return[o,{addOneGeometry:d,delOneGeometry:c,mutateOneGeometry:u,errorGeometries:n,loadingGeometries:!i}]},add:async(e,t)=>(await (0,a.R)("/api/geometry",{method:"POST",body:JSON.stringify({project:e,geometry:t})})).json(),update:async(e,t)=>{await (0,a.R)("/api/geometry/"+e.id,{method:"PUT",body:JSON.stringify(t)})},del:async e=>{await (0,a.R)("/api/geometry/"+e.id,{method:"DELETE"})},download:async e=>(await (0,a.R)("/api/geometry/"+e.id+"/download")).json(),getPart:async e=>(await (0,a.R)("/api/geometry/"+e.id+"/part")).json(),splitStep:async(e,t)=>(await (0,a.R)("/api/geometry/"+t.id+"/splitStep",{method:"POST",body:JSON.stringify({project:e})})).json()}},91926:function(e,t,i){"use strict";i.d(t,{ZP:function(){return eJ}});var s=i(85893),l=i(67294),a=i(5152),n=i.n(a),r=i(11163),o=i(25305),d=i(30441),c=i(30506),u=i(28025),m=i(46437),h=i(19175),g=i(6322),x=i(87462),p={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M296 250c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h384c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8H296zm184 144H296c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h184c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8zm-48 458H208V148h560v320c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8V108c0-17.7-14.3-32-32-32H168c-17.7 0-32 14.3-32 32v784c0 17.7 14.3 32 32 32h264c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm440-88H728v-36.6c46.3-13.8 80-56.6 80-107.4 0-61.9-50.1-112-112-112s-112 50.1-112 112c0 50.7 33.7 93.6 80 107.4V764H520c-8.8 0-16 7.2-16 16v152c0 8.8 7.2 16 16 16h352c8.8 0 16-7.2 16-16V780c0-8.8-7.2-16-16-16zM646 620c0-27.6 22.4-50 50-50s50 22.4 50 50-22.4 50-50 50-50-22.4-50-50zm180 266H566v-60h260v60z"}}]},name:"audit",theme:"outlined"},y=i(44192),f=l.forwardRef(function(e,t){return l.createElement(y.Z,(0,x.Z)({},e,{ref:t,icon:p}))}),b={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M864 518H506V160c0-4.4-3.6-8-8-8h-26a398.46 398.46 0 00-282.8 117.1 398.19 398.19 0 00-85.7 127.1A397.61 397.61 0 0072 552a398.46 398.46 0 00117.1 282.8c36.7 36.7 79.5 65.6 127.1 85.7A397.61 397.61 0 00472 952a398.46 398.46 0 00282.8-117.1c36.7-36.7 65.6-79.5 85.7-127.1A397.61 397.61 0 00872 552v-26c0-4.4-3.6-8-8-8zM705.7 787.8A331.59 331.59 0 01470.4 884c-88.1-.4-170.9-34.9-233.2-97.2C174.5 724.1 140 640.7 140 552c0-88.7 34.5-172.1 97.2-234.8 54.6-54.6 124.9-87.9 200.8-95.5V586h364.3c-7.7 76.3-41.3 147-96.6 201.8zM952 462.4l-2.6-28.2c-8.5-92.1-49.4-179-115.2-244.6A399.4 399.4 0 00589 74.6L560.7 72c-4.7-.4-8.7 3.2-8.7 7.9V464c0 4.4 3.6 8 8 8l384-1c4.7 0 8.4-4 8-8.6zm-332.2-58.2V147.6a332.24 332.24 0 01166.4 89.8c45.7 45.6 77 103.6 90 166.1l-256.4.7z"}}]},name:"pie-chart",theme:"outlined"},j=l.forwardRef(function(e,t){return l.createElement(y.Z,(0,x.Z)({},e,{ref:t,icon:b}))}),v=i(81990),Z=i(89119),w=i(81125),k={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M709.6 210l.4-.2h.2L512 96 313.9 209.8h-.2l.7.3L151.5 304v416L512 928l360.5-208V304l-162.9-94zM482.7 843.6L339.6 761V621.4L210 547.8V372.9l272.7 157.3v313.4zM238.2 321.5l134.7-77.8 138.9 79.7 139.1-79.9 135.2 78-273.9 158-274-158zM814 548.3l-128.8 73.1v139.1l-143.9 83V530.4L814 373.1v175.2z"}}]},name:"code-sandbox",theme:"outlined"},C=l.forwardRef(function(e,t){return l.createElement(y.Z,(0,x.Z)({},e,{ref:t,icon:k}))}),S=i(72034),P=i(44839),N=i(20802),z=i(99124),T=i(35164),V=i(32722),O=i(46362),_=i(89113),E=i(23721),M=i(35054),R=i(95940),U=()=>{let e=(0,r.useRouter)(),t=(0,l.useCallback)(()=>{(0,O.u)(async()=>{await e.push("/")})},[e]);return(0,s.jsx)(c.Z,{children:(0,s.jsx)(c.Z.Content,{children:(0,s.jsx)(E.Z,{title:"Not allowed",children:(0,s.jsxs)(M.Z,{direction:"vertical",children:[(0,s.jsxs)(o.Z.Text,{children:[(0,s.jsx)(R.Z,{style:{color:"red"}})," ","You are not allowed to be here."]}),(0,s.jsxs)(o.Z.Text,{children:["Go back"," ",(0,s.jsx)(m.ZP,{type:"link",onClick:t,children:"home"})]})]})})})})},L=i(26881),G=i(55320),H=i(38569),A=i(28305),F=i(86570),B=i(36936),I=i(69156),J=i(4374),D=i.n(J),q=e=>{let{visible:t,title:i,children:l,onClose:a}=e;return(0,s.jsx)(E.Z,{className:D().panel,style:{display:t?"block":"none"},title:i,extra:(0,s.jsx)(m.ZP,{type:"text",icon:(0,s.jsx)(I.Z,{}),onClick:a}),children:l})},W=i(90926),Y=i(44598),K=i(8993),Q=i(86731),X=e=>{let{visible:t,geometry:i,setVisible:a,onEdit:n}=e,r=(0,l.useRef)(null),[o,d]=(0,l.useState)(!1);(0,l.useEffect)(()=>{r.current&&r.current.focus()});let c=(0,l.useCallback)(()=>a(!1),[a]),u=(0,l.useCallback)(async e=>{d(!0);try{await n(e),d(!1),a(!1)}catch(e){throw d(!1),e}},[a,n]);return(0,s.jsx)(Q.ZP,{title:"Edit the geometry's name",visible:t,initialValues:{name:i.name},onCancel:c,onOk:u,loading:o,children:(0,s.jsx)(Y.Z.Item,{name:"name",label:"Name:",rules:[{required:!0,message:"Name is required"}],children:(0,s.jsx)(K.Z,{ref:r})})})},$={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"defs",attrs:{},children:[{tag:"style",attrs:{}}]},{tag:"path",attrs:{d:"M938.2 508.4L787.3 389c-3-2.4-7.3-.2-7.3 3.6V478H636V184h204v128c0 2.2 1.8 4 4 4h60c2.2 0 4-1.8 4-4V144c0-15.5-12.5-28-28-28H596c-15.5 0-28 12.5-28 28v736c0 15.5 12.5 28 28 28h284c15.5 0 28-12.5 28-28V712c0-2.2-1.8-4-4-4h-60c-2.2 0-4 1.8-4 4v128H636V546h144v85.4c0 3.8 4.4 6 7.3 3.6l150.9-119.4a4.5 4.5 0 000-7.2zM428 116H144c-15.5 0-28 12.5-28 28v168c0 2.2 1.8 4 4 4h60c2.2 0 4-1.8 4-4V184h204v294H244v-85.4c0-3.8-4.3-6-7.3-3.6l-151 119.4a4.52 4.52 0 000 7.1l151 119.5c2.9 2.3 7.3.2 7.3-3.6V546h144v294H184V712c0-2.2-1.8-4-4-4h-60c-2.2 0-4 1.8-4 4v168c0 15.5 12.5 28 28 28h284c15.5 0 28-12.5 28-28V144c0-15.5-12.5-28-28-28z"}}]},name:"split-cells",theme:"outlined"},ee=l.forwardRef(function(e,t){return l.createElement(y.Z,(0,x.Z)({},e,{ref:t,icon:$}))}),et=i(65920),ei=i.n(et);let es={split:"Unable to split geoemtry"},el=async(e,t)=>{let{message:i}=await B.Z.splitStep(e,t);return i};var ea=e=>{let{project:t,geometry:i}=e,[a,n]=(0,l.useState)(!1),{dispatch:r}=(0,l.useContext)(z.uj),o=(0,l.useMemo)(()=>3!==i.summary.dimension,[i.summary.dimension]),c=(0,l.useCallback)(()=>{(async()=>{n(!0);try{let e=await el(t,i);e.length&&r((0,T.iT)({title:e}))}catch(e){r((0,T.iT)({title:es.split,err:e}))}finally{n(!1)}})().catch(console.error)},[t,i,r]);return(0,s.jsx)(d.Z,{title:"Split volumes",children:(0,s.jsx)(m.ZP,{disabled:o,loading:a,className:ei().noBorder,icon:(0,s.jsx)(ee,{}),onClick:c})})},en=i(48764).lW;let er={download:"Unable to download geometry",update:"Unable to update geometry",del:"Unable to delete geometry"},eo=async e=>{let t=await B.Z.download({id:e.id}),i=new File([en.from(t.buffer).toString()],e.name+"."+t.extension),s=window.URL.createObjectURL(i),l=document.createElement("a");l.href=s,l.setAttribute("download",e.name+"."+t.extension),l.click(),l.remove()},ed=async(e,t,i)=>{await B.Z.update({id:e.id},[{key:"name",value:t.name}]),e.name=t.name,await i.mutateOneGeometry(e)},ec=async(e,t,i,s)=>{await B.Z.del({id:t.id});let l=e.geometries.filter(e=>e!==t.id);await s.mutateProject({id:e.id,geometries:l}),await s.delOneGeometry(t),i()};var eu=e=>{var t,i,a,n,r,d;let{project:u,geometry:m,swr:h,close:g,onCleanup:x}=e,[p,y]=(0,l.useState)(!1),[f,b]=(0,l.useState)(!1),[j,v]=(0,l.useState)(!1),{dispatch:Z}=(0,l.useContext)(z.uj),w=(0,l.useCallback)(()=>b(!0),[]),k=(0,l.useCallback)(()=>{(0,O.u)(async()=>{y(!0);try{await eo(m)}catch(e){Z((0,T.iT)({title:er.download,err:e}))}finally{y(!1)}})},[m,Z]),C=(0,l.useCallback)(async e=>{try{await ed(m,e,h)}catch(e){throw Z((0,T.iT)({title:er.update,err:e})),e}},[m,h,Z]),S=(0,l.useCallback)(async()=>{v(!0);try{await ec(u,m,g,h),x(m.id)}catch(e){throw Z((0,T.iT)({title:er.del,err:e})),e}finally{v(!1)}},[u,m,h,g,x,Z]);return m?(0,s.jsx)(c.Z,{children:(0,s.jsx)(c.Z.Content,{children:(0,s.jsx)(E.Z,{size:"small",title:"Informations",actions:[(0,s.jsx)(ea,{project:{id:u.id},geometry:{id:m.id,summary:m.summary}},"split"),(0,s.jsx)(L.o6,{loading:p,onDownload:k},"download"),(0,s.jsxs)("div",{children:[(0,s.jsx)(X,{visible:f,geometry:{id:null==m?void 0:m.id,name:null==m?void 0:m.name},setVisible:b,onEdit:C}),(0,s.jsx)(L.w6,{onEdit:w})]},"edit"),(0,s.jsx)(L.m1,{loading:j,text:(0,s.jsxs)(s.Fragment,{children:["Are you sure you want to delete the geometry"," ",(0,s.jsx)(o.Z.Text,{strong:!0,children:m.name}),"?"]}),onDelete:S},"delete")],children:(0,s.jsxs)(M.Z,{direction:"vertical",className:ei().fullWidth,children:[(0,s.jsxs)(o.Z.Text,{children:[(0,s.jsx)("span",{className:ei().textLight,children:"File:"})," ",m.name," "]}),(0,s.jsxs)(o.Z.Text,{children:[(0,s.jsx)("span",{className:ei().textLight,children:"Unit:"})," ",(0,s.jsx)(W.Z.Inline,{text:"m"})]}),(0,s.jsxs)(s.Fragment,{children:[3===m.summary.dimension&&(0,s.jsxs)(o.Z.Text,{children:[(0,s.jsx)("span",{className:ei().textLight,children:"Number of solids:"})," ",null!==(n=null===(t=m.summary.solids)||void 0===t?void 0:t.length)&&void 0!==n?n:0]}),(0,s.jsxs)(o.Z.Text,{children:[(0,s.jsx)("span",{className:ei().textLight,children:"Number of faces:"})," ",null!==(r=null===(i=m.summary.faces)||void 0===i?void 0:i.length)&&void 0!==r?r:0]}),2===m.summary.dimension&&(0,s.jsxs)(o.Z.Text,{children:[(0,s.jsx)("span",{className:ei().textLight,children:"Number of edges:"})," ",null!==(d=null===(a=m.summary.edges)||void 0===a?void 0:a.length)&&void 0!==d?d:0]})]})]})})})}):(0,s.jsx)(_.Z.Simple,{})},em=i(17689),eh=i(742),eg=i.n(eh),ex=i(48764).lW;let ep={add:"Unable to add geometry"},ey=e=>e.name.toLowerCase().includes(".stp")||e.name.toLowerCase().includes(".step")||e.name.toLowerCase().includes(".dxf"),ef=async e=>{let t=new FileReader;return new Promise(i=>{t.addEventListener("load",()=>{i(t.result)}),t.readAsArrayBuffer(e)})},eb=async(e,t,i)=>{if("uploading"===t.file.status)return!0;if("done"===t.file.status){let s=await ef(t.file.originFileObj),l=await B.Z.add({id:e.id},{name:t.file.name,uid:t.file.uid,buffer:ex.from(s)});await i.addOneGeometry(l),await i.mutateProject({id:e.id,geometries:[...e.geometries,l.id]})}return!1};var ej=e=>{let{visible:t,project:i,swr:a,setVisible:n}=e,[r,d]=(0,l.useState)(!1),{dispatch:c}=(0,l.useContext)(z.uj),u=(0,l.useCallback)(()=>n(!1),[n]),m=(0,l.useCallback)(e=>{(0,O.u)(async()=>{try{let t=await eb(i,e,a);d(t),n(t)}catch(e){c((0,T.iT)({title:ep.add,err:e})),d(!1)}})},[i,a,n,c]);return(0,s.jsx)(Q.ZP,{title:"Upload geometry",visible:t,onCancel:u,cancelButtonProps:{loading:r},children:(0,s.jsxs)(M.Z,{direction:"vertical",className:ei().fullWidth,children:[(0,s.jsx)(em.Z,{className:eg().upload,action:"/api/noop",accept:".stp,.step,.dxf",showUploadList:!1,listType:"picture-card",beforeUpload:ey,onChange:m,children:(0,s.jsx)("div",{children:r?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(S.Z,{style:{fontSize:25}}),(0,s.jsxs)("div",{style:{marginTop:8},children:[(0,s.jsx)("b",{children:"Loading"}),", converting, ..."]})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(P.Z,{style:{fontSize:25}}),(0,s.jsxs)("div",{style:{marginTop:8},children:[(0,s.jsx)("b",{children:"Choose a file"})," or drop it here"]})]})})}),(0,s.jsx)(o.Z.Text,{children:(0,s.jsx)("p",{style:{color:"rgba(0, 0, 0, 0.45)",textAlign:"center"},children:"Native file format preferred: STEP (3D) or DXF (2D) file"})})]})})},ev=i(4581),eZ=i(88773),ew=i(93363),ek=i(69944),eC=i(12367),eS=i(19372),eP=i.n(eS),eN=i(18695);let ez=n()(()=>Promise.all([i.e(3737),i.e(447),i.e(7090),i.e(1121),i.e(2912)]).then(i.bind(i,3246)).then(e=>e.default.Renderer),{loadableGenerated:{webpack:()=>[3246]},ssr:!1}),eT={part:"Unable to load part",snapshot:"Unable to save snapshot"},eV=async(e,t,i)=>"geometry"===i?{...await B.Z.getPart({id:t.id}),extra:{id:t.id}}:{...await eC.Z.load({id:e.id},{originPath:t.originPath,glb:t.glb}),extra:{name:t.name,glb:t.glb,fields:t.extra}},eO=async(e,t,i)=>{let s=[];for(let l of i){let i=t.find(e=>{var t;return(null===(t=e.extra)||void 0===t?void 0:t.glb)===l.glb});if(i){s.push(i);continue}let a=await eV(e,l,"result");s.push(a)}return s},e_=async(e,t,i)=>{if(i)return t.find(e=>{var t;return(null===(t=e.extra)||void 0===t?void 0:t.glb)===i.glb})||await eV(e,i,"result")},eE=async(e,t,i)=>{let s=[];for(let l of i){let i=t.find(e=>{var t;return(null===(t=e.extra)||void 0===t?void 0:t.id)===l.id});if(i){s.push(i);continue}let a=await eV(e,l,"geometry");s.push(a)}return s};var eM=e=>{let{project:t,simulation:i,geometries:a,results:n,postprocessing:r}=e,[o,d]=(0,l.useState)([]),[c,u]=(0,l.useState)(!1),[m,h]=(0,l.useState)(!1),[g,x]=(0,l.useState)(!1),{enabled:p,part:y,highlighted:f,selected:b,point:j,type:v,dispatch:Z}=(0,l.useContext)(G.ZB),{dispatch:w}=(0,l.useContext)(z.uj),[k]=F.Z.useSimulation(null==i?void 0:i.id);(0,V.Z)(()=>{(async()=>{u(!0);let e=[];if(i&&!r){let t=await eO(i,o,n);e.push(...t)}if(i){let t=await e_(i,o,r);t&&e.push(t)}if(!n.length&&!r){let t=await eE(i,o,a);e.push(...t)}d(e)})().catch(e=>{w((0,T.iT)({title:eT.part,err:e})),u(!1)}).finally(()=>u(!1))},[i,a,n,r,o,w]),(0,l.useEffect)(()=>{if("0"===k.id){h(!1);return}let e=k.tasks,t=null==e?void 0:e.map(e=>e.datas).filter(e=>e).flat();(null==t?void 0:t.length)?h(!0):h(!1)},[k]),(0,l.useEffect)(()=>{if(null==i?void 0:i.scheme.configuration.run.postprocessing){let e=!1;o.forEach(t=>{"result"===t.summary.type&&(e=!0)}),e?x(!0):x(!1)}else x(!1)},[i,o]);let C=(0,l.useCallback)(async e=>{try{await ek.Z.add({name:"snapshot",uid:"snapshot_"+(0,eZ.Z)(),data:e},{id:t.id})}catch(e){w((0,T.iT)({title:eT.snapshot,err:e}))}},[t.id,w]),P=(0,l.useCallback)(e=>{Z((0,ew.CH)(e))},[Z]),N=(0,l.useCallback)(e=>{Z((0,ew.Ys)(e))},[Z]),O=(0,l.useCallback)(e=>{Z((0,ew.N7)(e))},[Z]),_=(0,l.useCallback)(()=>{Z((0,ew.a_)(!0))},[Z]),E=(0,l.useCallback)(()=>{Z((0,ew.Ud)(!0))},[Z]);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{style:{display:c?"flex":"none"},className:eP().loading,children:(0,s.jsx)(ev.Z,{indicator:(0,s.jsx)(S.Z,{style:{fontSize:80},spin:!0})})}),(0,s.jsx)(ez,{theme:eN.Z,style:{width:"calc(100vw - 256px)"},parts:o,selection:{enabled:p,part:y,type:v,highlighted:f,selected:b,point:j,onHighlight:P,onSelect:N,onPoint:O},data:m,postProcessing:g,snapshot:{project:{apiRoute:C,size:{width:520,height:312}}},onData:_,onPostProcessing:E})]})},eR=i(72091),eU=i(65185),eL=i.n(eU);let eG=n()(()=>Promise.all([i.e(689),i.e(5238),i.e(7071)]).then(i.bind(i,17071)),{loadableGenerated:{webpack:()=>[17071]},ssr:!1}),eH={geometries:{label:"GEOMETRIES",key:"geometries"},simulations:{label:"SIMULATIONS",key:"simulations"}},eA={user:"Unable to get user",project:"Unable to get project",simulations:"Unable to get simulations",geometries:"Unable to get geometries",add:"Unable to add simulation"},eF=async(e,t,i)=>{var s;let l=await F.Z.add({id:e.id},{name:t.name,scheme:t});await i.addOneSimulation(l),await i.mutateProject({id:e.id,simulations:[...null!==(s=e.simulations)&&void 0!==s?s:[],l.id]})},eB=e=>{let{visible:t,geometry:i,panel:a,add:n,del:r,close:d}=e,c=(0,l.useCallback)(e=>{var t,s,l;e.stopPropagation(),(null==a?void 0:null===(l=a.props)||void 0===l?void 0:null===(s=l.children)||void 0===s?void 0:null===(t=s.type)||void 0===t?void 0:t.name)===eu.name&&d(),r(i)},[i,a,r,d]),u=(0,l.useCallback)(e=>{e.stopPropagation(),n(i)},[i,n]);return(0,s.jsxs)("div",{children:[(0,s.jsx)(o.Z.Text,{ellipsis:{tooltip:!0},children:i.name}),t?(0,s.jsx)(h.Z,{onClick:c}):(0,s.jsx)(g.Z,{onClick:u})]})},eI=e=>{let{simulation:t}=e;return t.scheme.userModelId?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(d.Z,{title:"User algorithm",placement:"right",children:(0,s.jsx)(f,{style:{position:"absolute",top:0,left:14,fontSize:14,color:"#fad114"}})}),(0,s.jsx)(o.Z.Text,{ellipsis:!0,children:t.name})]}):(0,s.jsx)(s.Fragment,{children:t.name})};var eJ=()=>{let e=(0,r.useRouter)(),{page:t,workspaceId:i,projectId:a}=e.query,[n,d]=(0,l.useState)(!1),[h,g]=(0,l.useState)([]),[x,p]=(0,l.useState)(!1),[y,f]=(0,l.useState)(),[b,k]=(0,l.useState)([]),[E,M]=(0,l.useState)(),[R,I]=(0,l.useState)(),[J,D]=(0,l.useState)(),[W,Y]=(0,l.useState)(!0),{dispatch:K}=(0,l.useContext)(z.uj),[Q,{errorUser:X,loadingUser:$}]=H.Z.useUser(),[ee,{mutateProject:et,errorProject:es,loadingProject:el}]=A.Z.useProject(a),ea=(0,l.useMemo)(()=>"0"===ee.id?void 0:ee,[ee]),[en,{addOneSimulation:er,delOneSimulation:eo,mutateOneSimulation:ed,errorSimulations:ec,loadingSimulations:em}]=F.Z.useSimulations(null==ea?void 0:ea.simulations),[eh,{addOneGeometry:eg,delOneGeometry:ex,mutateOneGeometry:ep,errorGeometries:ey,loadingGeometries:ef}]=B.Z.useGeometries(null==ea?void 0:ea.geometries),eb=(0,l.useCallback)(()=>d(!0),[]),ev=(0,l.useCallback)(()=>p(!0),[]),eZ=(0,l.useCallback)(()=>p(!1),[]),ew=(0,l.useCallback)(e=>{g(t=>[...t,e])},[]),ek=(0,l.useCallback)(e=>{let t=h.findIndex(t=>t.id===e.id);-1!==t&&g(e=>[...e.slice(0,t),...e.slice(t+1)])},[h]),eC=(0,l.useCallback)(()=>{D(void 0),I(void 0)},[]),eS=(0,l.useCallback)(e=>{let t=eh.findIndex(t=>t.id===e);-1!==t&&g(e=>[...e.slice(0,t),{id:"0",needCleanup:!0},...e.slice(t+1)])},[eh]),eP=(0,l.useCallback)(e=>{let t=eh.find(t=>t.id===e);t&&(h.find(t=>t.id===e)||g(e=>[...e,{...t,visible:!0}]),D((0,s.jsx)(q,{visible:!0,title:"Geometry",onClose:eC,children:(0,s.jsx)(eu,{project:{id:ea.id,geometries:ea.geometries},geometry:{id:t.id,name:t.name,summary:t.summary},swr:{mutateProject:et,mutateOneGeometry:ep,delOneGeometry:ex},close:eC,onCleanup:eS})})))},[ea,eh,h,et,ep,ex,eS,eC]),eN=(0,l.useCallback)(e=>{D((0,s.jsx)(q,{visible:!0,title:"About",onClose:eC,children:(0,s.jsx)(eR.ZP.About,{project:{id:ea.id,simulations:ea.simulations},simulation:{id:e.id,name:e.name,scheme:e.scheme},swr:{mutateProject:et,addOneSimulation:er,delOneSimulation:eo,mutateOneSimulation:ed}})}))},[ea,et,er,eo,ed,eC]),ez=(0,l.useCallback)(e=>{D((0,s.jsx)(q,{visible:!0,title:"Geometry",onClose:eC,children:(0,s.jsx)(eR.ZP.Geometry,{geometries:eh,simulation:{id:e.id,scheme:e.scheme},setGeometries:g,swr:{mutateOneSimulation:ed}})}))},[eh,ed,eC]),eT=(0,l.useCallback)(e=>{D((0,s.jsx)(q,{visible:!0,title:"Parameters",onClose:eC,children:(0,s.jsx)(eR.ZP.Parameters,{simulation:{id:e.id,scheme:e.scheme},swr:{mutateOneSimulation:ed}})}))},[ed,eC]),eV=(0,l.useCallback)((e,t)=>{D((0,s.jsx)(q,{visible:W,title:"Materials",onClose:eC,children:(0,s.jsx)(eR.ZP.Materials,{geometries:t,simulation:{id:e.id,scheme:e.scheme},swr:{mutateOneSimulation:ed},setVisible:Y})}))},[W,ed,eC]),eO=(0,l.useCallback)(e=>{D((0,s.jsx)(q,{visible:!0,title:"Initialization",onClose:eC,children:(0,s.jsx)(eR.ZP.Initialization,{simulations:en,simulation:e,swr:{mutateOneSimulation:ed}})}))},[en,ed,eC]),e_=(0,l.useCallback)((e,t)=>{D((0,s.jsx)(q,{visible:W,title:"Boundary conditions",onClose:eC,children:(0,s.jsx)(eR.ZP.BoundaryConditions,{geometries:t,simulation:{id:e.id,scheme:e.scheme},swr:{mutateOneSimulation:ed},setVisible:Y})}))},[W,ed,eC]),eE=(0,l.useCallback)(e=>{D((0,s.jsx)(q,{visible:W,title:"Run",onClose:eC,children:(0,s.jsx)(eR.ZP.Run,{geometries:h,simulation:{id:e.id,scheme:e.scheme},results:b,setResults:k,setPostprocessing:M,setVisible:Y,swr:{mutateOneSimulation:ed}})}))},[h,b,W,ed,eC]),eU=(0,l.useCallback)((e,t)=>{var i,s;let l=en.find(t=>t.id===e);if(!l)return;f(l);let a=(null!==(s=null===(i=l.scheme.configuration)||void 0===i?void 0:i.geometry.children)&&void 0!==s?s:[]).map(e=>{let t=e.value;if(t)return eh.find(e=>e.id===t)}).filter(e=>e);switch(a.length&&g(a),t){case"about":eN(l);break;case"geometry":ez(l);break;case"parameters":eT(l);break;case"materials":eV(l,a);break;case"initialization":eO(l);break;case"boundaryConditions":e_(l,a);break;case"run":eE(l);break;default:D(void 0)}},[eh,en,eN,ez,eT,eV,eO,e_,eE]),eJ=(0,l.useCallback)(()=>{(0,O.u)(async()=>{await e.push({pathname:"/dashboard",query:{page:t,workspaceId:i}})})},[e,t,i]),eD=(0,l.useCallback)(e=>{let t,{keyPath:i}=e,s=i.pop(),l=i.pop(),a=i.pop();a&&(t=a.split("&").pop()),I({key:s,id:l,item:t})},[]),eq=(0,l.useCallback)(async e=>{try{await eF(ea,e.model,{addOneSimulation:er,mutateProject:et}),p(!1)}catch(e){K((0,T.iT)({title:eA.add,err:e}))}},[ea,er,et,K]),eW=(0,l.useCallback)(e=>{if(ef)return!0;let t=!0;for(let i of e.children){let s=i.value;s&&!eh.filter(e=>e.id===s).length&&(e.done=!1,t=!1)}return t},[eh,ef]);(0,l.useEffect)(()=>{(0,O.u)(async()=>{$||Q||await e.replace("/login")})},[Q,$,e]),(0,l.useEffect)(()=>{X&&K((0,T.iT)({title:eA.user,err:X})),es&&K((0,T.iT)({title:eA.project,err:es})),ec&&K((0,T.iT)({title:eA.simulations,err:ec})),ey&&K((0,T.iT)({title:eA.geometries,err:ey}))},[X,es,ec,ey,K]),(0,V.Z)(()=>{el||ef?d(!1):eh.length?d(!1):d(!0)},[el,ef,eh]),(0,V.Z)(()=>{if(!ef){if(h.length){let e=!1,t=h.map(t=>{let i=eh.find(e=>e.id===(null==t?void 0:t.id));return i?JSON.stringify({...i,visible:void 0})!==JSON.stringify({...t,visible:void 0})?(e=!0,i):t:(e=!0,null)}).filter(e=>e);e&&g(t)}else g(eh[0]?[eh[0]]:[])}},[ef,eh,h],[g]),(0,V.Z)(()=>{if(!em&&y){let e=en.find(e=>e.id===(null==y?void 0:y.id));e?JSON.stringify(e)!==JSON.stringify(y)&&(f(e),R&&R.key===eH.simulations.key&&eU(R.id,R.item)):(eC(),f(void 0))}},[en,em,y,R],[f,eC]),(0,V.Z)(()=>{R&&(R.key===eH.geometries.key?eP(R.id):(eU(R.id,R.item),"run"!==R.item&&(k([]),M(void 0))))},[R,W,b],[eP,eU,eC]),(0,l.useEffect)(()=>{!b.length&&E&&M(void 0)},[b,E]);let eY=(0,l.useMemo)(()=>eh.map(e=>{let t=h.find(t=>t.id===e.id);return{key:e.id,icon:(0,s.jsx)(j,{}),label:(0,s.jsx)(eB,{visible:!!t,geometry:e,panel:J,add:ew,del:ek,close:eC})}}),[eh,h,J,ew,ek,eC]),eK=(0,l.useMemo)(()=>en.map(e=>{let t=e.scheme.configuration||{},i=[];return Object.keys(t).forEach(l=>{if("dimension"===l)return;let a=t[l],n=(0,s.jsx)(v.Z,{style:{color:"green"}});a.error?n=(0,s.jsx)(Z.Z,{style:{color:"red"}}):a.done||(n=(0,s.jsx)(w.Z,{style:{color:"orange"}})),"geometry"!==l||eW(a)||(n=(0,s.jsx)(w.Z,{style:{color:"orange"}})),i[a.index]={key:e.id+"&"+l,disabled:!h.length,icon:n,label:a.title}}),{key:e.id,icon:(0,s.jsx)(C,{}),label:(0,s.jsx)(eI,{simulation:e}),children:[{key:e.id+"&about",disabled:!h.length,icon:(0,s.jsx)(v.Z,{style:{color:"green"}}),label:"About"},...i]}}),[h,en,eW]);return!Q||$||el?(0,s.jsx)(_.Z.Simple,{}):ea?(0,s.jsx)(G.ZP,{children:(0,s.jsxs)(c.Z,{hasSider:!0,children:[(0,s.jsxs)(c.Z.Sider,{theme:"light",className:eL().sider,width:256,children:[(0,s.jsx)("div",{className:ei().logo,children:(0,s.jsx)("img",{src:"/images/logo.svg",alt:"Tanatloc"})}),(0,s.jsx)(u.Z,{className:eL().menu1,mode:"inline",items:[{key:"menu-go-back",disabled:!0,style:{cursor:"unset",margin:"10px 0",paddingLeft:10},label:(0,s.jsx)(L.ks,{className:ei().fullWidth,onClick:eJ,children:"Return to dashboard"})},{type:"divider"},{key:"title",disabled:!0,className:"Menu-title",label:(0,s.jsx)(o.Z.Paragraph,{ellipsis:{tooltip:!0,rows:2},children:ea.title})}]}),(0,s.jsx)("div",{className:eL().menuScroll,children:(0,s.jsx)(u.Z,{mode:"inline",className:eL().menu2,defaultOpenKeys:[eH.geometries.key,eH.simulations.key],items:[{key:eH.geometries.key,className:"SubMenu",icon:ef?(0,s.jsx)(S.Z,{}):(0,s.jsx)(j,{}),label:(0,s.jsxs)(o.Z.Text,{strong:!0,children:[eH.geometries.label," (",eh.length,")"]}),children:[{key:"new_geometry",disabled:!0,label:(0,s.jsx)(m.ZP,{icon:(0,s.jsx)(P.Z,{}),onClick:eb,children:"New Geometry"})},{key:"geometry-needed",disabled:!0,className:h.length?"display-none":"",icon:(0,s.jsx)(w.Z,{style:{color:"red"}}),label:"A Geometry is needed"},...eY]},{key:eH.simulations.key,className:"SubMenu",icon:em?(0,s.jsx)(S.Z,{}):(0,s.jsx)(C,{}),label:(0,s.jsxs)(o.Z.Text,{strong:!0,children:[eH.simulations.label," (",en.length,")"]}),children:[{key:"new_simulation",disabled:!0,label:(0,s.jsx)(m.ZP,{disabled:!eh.length,icon:(0,s.jsx)(N.Z,{}),onClick:ev,children:"New Simulation"})},...eK]}],onClick:eD})})]}),(0,s.jsxs)(c.Z.Content,{className:ei().noScroll,style:{position:"relative"},children:[(0,s.jsx)(ej,{visible:n,project:{id:ea.id,geometries:ea.geometries},swr:{mutateProject:et,addOneGeometry:eg},setVisible:d}),(0,s.jsx)(eR.ZP.Selector,{user:{id:Q.id,authorizedplugins:Q.authorizedplugins,usermodels:Q.usermodels},visible:x,onOk:eq,onCancel:eZ}),(0,s.jsx)(eR.ZP.Updater,{user:{authorizedplugins:Q.authorizedplugins},simulation:y&&{id:y.id,scheme:y.scheme},swr:{mutateOneSimulation:ed}}),J,(0,s.jsx)(eM,{project:{id:ea.id,title:ea.title},simulation:y&&{id:y.id,scheme:y.scheme},geometries:h.map(e=>{if("0"!==e.id)return{id:e.id,needCleanup:e.needCleanup}}).filter(e=>e),results:b.map(e=>({name:e.name,glb:e.glb,originPath:e.originPath,extra:e.extra})),postprocessing:E&&{glb:E.glb,originPath:E.originPath}}),(0,s.jsx)(eG,{simulation:y&&{id:y.id,name:y.name}}),(0,s.jsx)(eR.ZP.Postprocessing,{simulation:y&&{id:y.id,scheme:y.scheme},results:b.map(e=>({name:e.name,fileName:e.fileName,originPath:e.originPath})),postprocessing:E&&{name:E.name,fileName:E.fileName},setResult:M})]})]})}):(0,s.jsx)(U,{})}},742:function(e){e.exports={upload:"add_upload__OHzcC"}},65185:function(e){e.exports={variables:'"@/styles/variables.css"',colorPrimary:"#fad114",sider:"project_sider__KGpqG",menu1:"project_menu1__iUy_z",menuScroll:"project_menuScroll__d4eJz",menu2:"project_menu2__uQFdm"}},19372:function(e){e.exports={loading:"view_loading__rcZQY"}}}]);