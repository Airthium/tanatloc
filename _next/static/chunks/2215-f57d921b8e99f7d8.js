(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2215],{5957:function(e,t,l){"use strict";l.d(t,{Z:function(){return i}});var n=l(948);let add=async(e,t)=>{let l=await (0,n.R)("/api/avatar",{method:"POST",headers:{Accept:"application/json"},body:JSON.stringify({file:e,project:t})});return l.json()};var i={add:add}},42095:function(e,t,l){"use strict";l.d(t,{Z:function(){return r}});var n=l(59734),i=l(67294),a=l(948);let add=async(e,t)=>{let l=await (0,a.R)("/api/geometry",{method:"POST",body:JSON.stringify({project:e,geometry:t})});return l.json()},update=async(e,t)=>{await (0,a.R)("/api/geometry/"+e.id,{method:"PUT",body:JSON.stringify(t)})},del=async e=>{await (0,a.R)("/api/geometry/"+e.id,{method:"DELETE"})},download=async e=>{let t=await (0,a.R)("/api/geometry/"+e.id+"/download");return t.json()},getPart=async e=>{let t=await (0,a.R)("/api/geometry/"+e.id+"/part");return t.json()};var r={useGeometries:e=>{var t;let{data:l,error:r,mutate:o}=(0,n.ZP)(["/api/geometries",JSON.stringify({ids:e})],e=>{let[t,l]=e;return(0,a._)(t,l)}),s=null!==(t=null==l?void 0:l.geometries)&&void 0!==t?t:[],d=(0,i.useCallback)(async e=>{let t=[...s,e];await o({geometries:t})},[s,o]),c=(0,i.useCallback)(async e=>{let t=s.filter(t=>t.id!==e.id);await o({geometries:t})},[s,o]),u=(0,i.useCallback)(async e=>{let t=s.map(t=>(t.id===e.id&&(t={...t,...e}),t));await o({geometries:t})},[s,o]);return[s,{addOneGeometry:d,delOneGeometry:c,mutateOneGeometry:u,errorGeometries:r,loadingGeometries:!l}]},add:add,update:update,del:del,download:download,getPart:getPart}},42215:function(e,t,l){"use strict";let n;l.d(t,{ZP:function(){return project}});var i=l(85893),a=l(5152),r=l.n(a),o=l(11163),s=l(67294),d=l(65400),c=l.n(d),u=l(16373),m=l(12386),p=l(94055),h=l(53740),g=l(50685),x=l(96621),y=l(48138),b=l(92018),f=l(3855),w=l(4851),v=l(35855),j=l(61093),C=l(14552),P=l(42419),M=l(34265),S=l(8061),k=l(54509),Z=l(95590),E=l(40561),_=l(70302),L=l(74048),A=l(14527),notauthorized=()=>{let e=(0,o.useRouter)(),t=(0,s.useCallback)(()=>{(async()=>{await e.push("/")})()},[e]);return(0,i.jsx)(u.Z,{children:(0,i.jsx)(u.Z.Content,{children:(0,i.jsx)(_.Z,{title:"Not allowed",children:(0,i.jsxs)(L.default,{direction:"vertical",children:[(0,i.jsxs)(h.Z.Text,{children:[(0,i.jsx)(A.Z,{style:{color:"red"}})," ","You are not allowed to be here."]}),(0,i.jsxs)(h.Z.Text,{children:["Go back"," ",(0,i.jsx)(c(),{type:"link",onClick:t,children:"home"})]})]})})})})},z=l(88053),D=l(54523),N=l(40144),T=l(8798),H=l(81229),O=l(42095),R=l(83482),F=l(64098),U=l.n(F),project_panel=e=>{let{visible:t,title:l,children:n,onClose:a}=e;return(0,i.jsx)(_.Z,{className:U().panel,style:{display:t?"block":"none"},title:l,extra:(0,i.jsx)(c(),{type:"text",icon:(0,i.jsx)(R.default,{}),onClick:a}),children:n})},B=l(8418),G=l(28465),I=l(51274),V=l(35304),W=l.n(V),X=l(95361),J=l.n(X),K=l(48764).lW;let Y={add:"Unable to add geometry"},_beforeUpload=e=>e.name.toLowerCase().includes(".stp")||e.name.toLowerCase().includes(".step")||e.name.toLowerCase().includes(".dxf"),_getFile=async e=>{let t=new FileReader;return new Promise(l=>{t.addEventListener("load",()=>{l(t.result)}),t.readAsArrayBuffer(e)})},_onUpload=async(e,t,l,n)=>{if("uploading"===t.file.status)return!0;if("done"===t.file.status){let i=await _getFile(t.file.originFileObj);try{let n=await O.Z.add({id:e.id},{name:t.file.name,uid:t.file.uid,buffer:K.from(i)});await l.addOneGeometry(n),await l.mutateProject({id:e.id,geometries:[...e.geometries,n.id]})}catch(e){throw n((0,k.iT)({title:Y.add,err:e})),e}}return!1};var q=l(97538),$=l(51024),edit=e=>{let{visible:t,geometry:l,setVisible:n,onEdit:a}=e,r=(0,s.useRef)(null),[o,d]=(0,s.useState)(!1);(0,s.useEffect)(()=>{r.current&&r.current.focus()});let c=(0,s.useCallback)(()=>n(!1),[n]),u=(0,s.useCallback)(async e=>{d(!0);try{await a(e),d(!1),n(!1)}catch(e){throw d(!1),e}},[n,a]);return(0,i.jsx)(I.ZP,{title:"Edit the geometry's name",visible:t,initialValues:{name:l.name},onCancel:c,onOk:u,loading:o,children:(0,i.jsx)(q.Z.Item,{name:"name",label:"Name:",rules:[{required:!0,message:"Name is required"}],children:(0,i.jsx)($.default,{ref:r})})})},Q=l(48764).lW;let ee={download:"Unable to download geometry",update:"Unable to update geometry",del:"Unable to delete geometry"},_onDownload=async(e,t)=>{try{let t=await O.Z.download({id:e.id}),l=new File([Q.from(t.buffer).toString()],e.name+"."+t.extension),n=window.URL.createObjectURL(l),i=document.createElement("a");i.href=n,i.setAttribute("download",e.name+"."+t.extension),i.click(),i.remove()}catch(e){t((0,k.iT)({title:ee.download,err:e}))}},_onEdit=async(e,t,l,n)=>{try{await O.Z.update({id:e.id},[{key:"name",value:t.name}]),e.name=t.name,await l.mutateOneGeometry(e)}catch(e){throw n((0,k.iT)({title:ee.update,err:e})),e}},_onDelete=async(e,t,l,n,i)=>{try{await O.Z.del({id:e.id});let i=t.geometries.filter(t=>t!==e.id);await n.mutateProject({id:t.id,geometries:i}),await n.delOneGeometry(e),l()}catch(e){throw i((0,k.iT)({title:ee.del,err:e})),e}},Geometry=e=>{var t,l,n,a,r,o;let{project:d,geometry:c,swr:m,close:p,onCleanup:g}=e,[x,y]=(0,s.useState)(!1),[b,f]=(0,s.useState)(!1),[w,v]=(0,s.useState)(!1),{dispatch:j}=(0,s.useContext)(S.uj),C=(0,s.useCallback)(()=>f(!0),[]),P=(0,s.useCallback)(()=>{(async()=>{y(!0);try{await _onDownload(c,j)}catch(e){}finally{y(!1)}})()},[c,j]),M=(0,s.useCallback)(async e=>_onEdit(c,e,m,j),[c,m,j]),k=(0,s.useCallback)(async()=>{v(!0);try{await _onDelete(c,d,p,m,j),g(c.id)}finally{v(!1)}},[d,c,m,p,g,j]);return c?(0,i.jsx)(u.Z,{children:(0,i.jsx)(u.Z.Content,{children:(0,i.jsx)(_.Z,{size:"small",title:"Informations",actions:[(0,i.jsx)(z.o6,{loading:x,onDownload:P},"download"),(0,i.jsxs)("div",{children:[(0,i.jsx)(edit,{visible:b,geometry:{id:null==c?void 0:c.id,name:null==c?void 0:c.name},setVisible:f,onEdit:M}),(0,i.jsx)(z.w6,{onEdit:C})]},"edit"),(0,i.jsx)(z.m1,{loading:w,text:(0,i.jsxs)(i.Fragment,{children:["Are you sure you want to delete the geometry"," ",(0,i.jsx)(h.Z.Text,{strong:!0,children:c.name}),"?"]}),onDelete:k},"delete")],children:(0,i.jsxs)(L.default,{direction:"vertical",className:W().fullWidth,children:[(0,i.jsxs)(h.Z.Text,{children:[(0,i.jsx)("span",{className:W().textLight,children:"File:"})," ",c.name," "]}),(0,i.jsxs)(h.Z.Text,{children:[(0,i.jsx)("span",{className:W().textLight,children:"Unit:"})," ",(0,i.jsx)(B.Z.Inline,{text:"m"})]}),(0,i.jsxs)(i.Fragment,{children:[3===c.summary.dimension&&(0,i.jsxs)(h.Z.Text,{children:[(0,i.jsx)("span",{className:W().textLight,children:"Number of solids:"})," ",null!==(a=null===(t=c.summary.solids)||void 0===t?void 0:t.length)&&void 0!==a?a:0]}),(0,i.jsxs)(h.Z.Text,{children:[(0,i.jsx)("span",{className:W().textLight,children:"Number of faces:"})," ",null!==(r=null===(l=c.summary.faces)||void 0===l?void 0:l.length)&&void 0!==r?r:0]}),2===c.summary.dimension&&(0,i.jsxs)(h.Z.Text,{children:[(0,i.jsx)("span",{className:W().textLight,children:"Number of edges:"})," ",null!==(o=null===(n=c.summary.edges)||void 0===n?void 0:n.length)&&void 0!==o?o:0]})]})]})})})}):(0,i.jsx)(E.Z.Simple,{})};Geometry.componentName="Geometry",Geometry.Add=e=>{let{visible:t,project:l,swr:n,setVisible:a}=e,[r,o]=(0,s.useState)(!1),{dispatch:d}=(0,s.useContext)(S.uj),c=(0,s.useCallback)(()=>a(!1),[a]),u=(0,s.useCallback)(e=>{(async()=>{try{let t=await _onUpload(l,e,n,d);o(t),a(t)}catch(e){o(!1)}})()},[l,n,a,d]);return(0,i.jsx)(I.ZP,{title:"Upload geometry",visible:t,onCancel:c,cancelButtonProps:{loading:r},children:(0,i.jsxs)(L.default,{direction:"vertical",className:W().fullWidth,children:[(0,i.jsx)(G.Z,{className:J().upload,action:"/api/noop",accept:".stp,.step,.dxf",showUploadList:!1,listType:"picture-card",beforeUpload:_beforeUpload,onChange:u,children:(0,i.jsx)("div",{children:r?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(w.default,{style:{fontSize:25}}),(0,i.jsxs)("div",{style:{marginTop:8},children:[(0,i.jsx)("b",{children:"Loading"}),", converting, ..."]})]}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(v.Z,{style:{fontSize:25}}),(0,i.jsxs)("div",{style:{marginTop:8},children:[(0,i.jsx)("b",{children:"Choose a file"})," or drop it here"]})]})})}),(0,i.jsx)(h.Z.Text,{children:(0,i.jsx)("p",{style:{color:"rgba(0, 0, 0, 0.45)",textAlign:"center"},children:"Native file format preferred: STEP (3D) or DXF (2D) file"})})]})})};var et=l(85615),el=l(74253),en=l(77834),ei=l(89552),ea=l(40987),er=l(32246),eo=l(62681),es=l(54831),ed=l(46019),ec=l(34463),eu=l(55508),em=l(29051),ep=l(81451),eh=l(25256),eg=l(20891),ex=l(77367),ey=l(65772),eb=l(29257),ef=l(92511),ew=l(84831),ev=l(99477),ej=l(57632),eC=l(78804),eP=l(79753),eM=l(54327),helpers_ArrowHelper=e=>{let t=new ev.fHI(.025,.025,.8,50);t.translate(0,.4,0);let l=new ev.vBJ({color:e}),n=new ev.Kj0(t,l),i=new ev.b_z(.05,.2,50);i.translate(0,.9,0);let a=new ev.vBJ({color:e}),r=new ev.Kj0(i,a),o=new ev.ZAu;return o.type="ArrowHelper",o.add(n),o.add(r),o.dispose=()=>{t.dispose(),l.dispose(),i.dispose(),a.dispose()},o};let LabelHelper=(e,t,l)=>{var n,i,a;let r=document.createElement("canvas");r.width=null!==(n=null==l?void 0:l.width)&&void 0!==n?n:256,r.height=256;let o=r.getContext("2d");(null==l?void 0:l.background)&&(o.fillStyle=l.background,o.fillRect(0,0,r.width,r.height)),o.fillStyle=null!==(i=null==l?void 0:l.fillStyle)&&void 0!==i?i:"grey",o.font="50px sans-serif",o.textAlign=null!==(a=null==l?void 0:l.align)&&void 0!==a?a:"center",o.textBaseline="middle",o.fillText(t,r.width/2,r.height/2);let s=new ev.xEZ(r);s.flipY=!0,s.needsUpdate=!0;let d=new ev.xeV({map:s,transparent:!0,depthWrite:!1});d.map.anisotropy=e.capabilities.getMaxAnisotropy();let c=new ev.jyi(d);return c.type="LabelHelper",(null==l?void 0:l.position)&&c.position.copy(l.position),(null==l?void 0:l.scale)&&c.scale.setScalar(l.scale),c.dispose=()=>{s.dispose(),d.dispose()},c},AxisHelper=function(e,t){let{offsetWidth:l,offsetHeight:n,width:i,height:a}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{offsetWidth:0,offsetHeight:0,width:150,height:150},r=l,o=n,s=i,d=a,c=helpers_ArrowHelper("red");c.rotateZ(-Math.PI/2);let u=LabelHelper(e,"X",{position:new ev.Pa4(1.1,0,0)}),m=helpers_ArrowHelper("green"),p=LabelHelper(e,"Y",{position:new ev.Pa4(0,1.1,0)}),h=helpers_ArrowHelper("blue");h.rotateX(Math.PI/2);let g=LabelHelper(e,"Z",{position:new ev.Pa4(0,0,1.1)}),x=new ev.xo$(.05,50,50),y=new ev.vBJ({color:"black"}),b=new ev.Kj0(x,y),f=new ev.ZAu;f.type="AxisHelper",f.add(c),f.add(u),f.add(m),f.add(p),f.add(h),f.add(g),f.add(b);let w=new ev.xsS;w.add(f);let v=new ev.iKG(-1.2,1.2,1.2,-1.2,-2,2);return{dispose:()=>{x.dispose(),y.dispose(),f.children.forEach(e=>{("ArrowHelper"===e.type||"LabelHelper"===e.type)&&e.dispose()}),w.remove(f)},render:()=>{e.setViewport(r,o,s,d),v.rotation.copy(t.rotation),e.render(w,v)},resize:e=>{let{newOffsetWidth:t,newOffsetHeight:l,newWidth:n,newHeight:i}=e;r=t,o=l,s=n,d=i}}},shapeSmooth=(e,t,l,n,i,a)=>{let{smooth:r,radius:o,left:s,down:d}=i,{xc:c,yc:u,uc:m,vc:p}=a;for(let i=0;i<=r;i++){let a=Math.PI/2*(e+i/r),h=Math.cos(a),g=Math.sin(a);if(t.push(c+o*h,u+o*g,0),l.push(m+s*h,p+d*g),i<r){let t=(r+1)*e+i+4;n.push(e,t,t+1)}}},shape=(e,t,l,n)=>{let i=e/2-l,a=t/2-l,r=l/e,o=(e-l)/e,s=l/t,d=(t-l)/t,c=[i,a,0,-i,a,0,-i,-a,0,i,-a,0],u=[o,d,r,d,r,s,o,s],m=[3*(n+1)+3,3*(n+1)+4,n+4,n+5,2*(n+1)+4,2,1,2*(n+1)+3,3,4*(n+1)+3,4,0],p=[m[0],m[1],m[2],m[0],m[2],m[3],m[4],m[5],m[6],m[4],m[6],m[7],m[8],m[9],m[10],m[8],m[10],m[11]];for(let e=0;e<4;e++){let t=e<1||e>2?i:-i,m=e<2?a:-a,h=e<1||e>2?o:r,g=e<2?d:s;shapeSmooth(e,c,u,p,{smooth:n,radius:l,left:r,down:s},{xc:t,yc:m,uc:h,vc:g})}let h=new ev.u9r;return h.setIndex(new ev.lCJ(p,1)),h.setAttribute("position",new ev.a$l(c,3)),h.setAttribute("uv",new ev.a$l(u,2)),h},NavigationHelper=function(e,t,l,n){let{offsetWidth:i,offsetHeight:a,width:r,height:o}=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{offsetWidth:0,offsetHeight:0,width:150,height:150},s="#d3d3d3",d=null,c=null,u=[{text:"FRONT",normal:new ev.Pa4(0,0,1),up:new ev.Pa4(0,1,0)},{text:"BACK",normal:new ev.Pa4(0,0,-1),up:new ev.Pa4(0,1,0)},{text:"RIGHT",normal:new ev.Pa4(1,0,0),up:new ev.Pa4(0,1,0)},{text:"LEFT",normal:new ev.Pa4(-1,0,0),up:new ev.Pa4(0,1,0)},{text:"UP",normal:new ev.Pa4(0,1,0),up:new ev.Pa4(0,0,-1)},{text:"DOWN",normal:new ev.Pa4(0,-1,0),up:new ev.Pa4(0,0,1)}],m=shape(75,75,25,20),p=new ev.xo$(37.5,10,10,0,Math.PI,0),h=new ev.ZAu;u.forEach(e=>{let t=document.createElement("canvas"),l=t.getContext("2d");t.width=t.height=256,l.fillStyle=s,l.fillRect(0,0,t.width,t.height),l.font="bold 50pt sans-serif",l.fillStyle="#000000",l.textAlign="center",l.textBaseline="middle",l.fillText(e.text,t.width/2,t.height/2);let n=new ev.ROQ(t);n.needsUpdate=!0;let i=new ev.vBJ({map:n,transparent:!0,opacity:.75}),a=new ev.vBJ({color:s}),r=new ev.Kj0(m,i),o=new ev.Kj0(m,a);o.rotateY(Math.PI);let d=new ev.vBJ({color:s,transparent:!0,opacity:.2}),c=new ev.Kj0(p,d),u=new ev.ZAu;u.add(r,o,c),u.lookAt(e.normal),u.translateZ(50),u.normal=e.normal,u.up=e.up,h.add(u)});let g=new ev.Mig("#ffffff",1),x=new ev.xsS;x.add(h),x.add(g);let y=new ev.iKG(-100,100,100,-100,-100,100);y.position.z=2;let b=new ev.iMs,onMouseMove=e=>{let t=globalToLocal(e);isIn(t)?(d=intersect(t),highlight(),(null==d?void 0:d.uuid)!==(null==c?void 0:c.uuid)&&(unhighlight(),c=d)):(d=null,unhighlight())},globalToLocal=e=>{let t=e.target,l=t.getBoundingClientRect(),n=e.clientX-l.left,s=e.clientY-l.top,d=new ev.FM8;return d.x=(n-i)/r*2-1,d.y=-(2*((s+o-l.height+a)/o))+1,d},isIn=e=>e.x>-1&&e.x<1&&e.y>-1&&e.y<1,intersect=e=>{let t=new ev.Pa4(e.x,e.y,-1);t.unproject(y);let l=new ev.Pa4;y.getWorldDirection(l),b.set(t,l);let n=b.intersectObjects(x.children,!0);return n.length?n[0].object.parent:null},highlight=()=>{var e;null==d||null===(e=d.children)||void 0===e||e.forEach(e=>{var t;(null===(t=e.material)||void 0===t?void 0:t.color)&&(e.material.previousColor=e.material.color,e.material.color=new ev.Ilk("#FAD114"))})},unhighlight=()=>{var e;null==c||null===(e=c.children)||void 0===e||e.forEach(e=>{var t;(null===(t=e.material)||void 0===t?void 0:t.color)&&(e.material.color=new ev.Ilk(s))})},onMouseDown=e=>{if(d){var i;let a=d.normal,r=d.up,o=new ev.Pa4;null===(i=t.boundingBox)||void 0===i||i.getCenter(o);let s=l.position.distanceTo(n.target),c=a.clone().multiplyScalar(s),u=o.add(c);l.position.copy(u),l.up.copy(r),d=null,unhighlight(),onMouseMove(e)}};return e.domElement.addEventListener("pointermove",onMouseMove),e.domElement.addEventListener("pointerdown",onMouseDown),{resize:e=>{let{newOffsetWidth:t,newOffsetHeight:l,newWidth:n,newHeight:s}=e;i=t,a=l,r=n,o=s},render:()=>{e.setViewport(i,a,r,o),y.rotation.copy(l.rotation),e.render(x,y)},dispose:()=>{e.domElement.removeEventListener("pointermove",onMouseMove),e.domElement.removeEventListener("pointerdown",onMouseDown),h.children.forEach(e=>{e.children.forEach(e=>{e.geometry.dispose(),e.material.dispose()})}),x.remove(h)}}};var helpers_NumberHelper=e=>1e-12>Math.abs(e)?"0":Math.abs(e)>1e3||.001>Math.abs(e)?e.toExponential(2):e.toFixed(3);let GridHelper=(e,t,l,n)=>{let i,a,r;let o=1,getAxisDivions=e=>{let t=Math.max(e.x,e.y,e.z),l=Math.max(Math.ceil(e.x/t*5),2),n=Math.max(Math.ceil(e.y/t*5),2),i=Math.max(Math.ceil(e.z/t*5),2);return new ev.Pa4(l,n,i)},createGrid=(e,t,l,n,i)=>{let a=new ev.ZAu,r=new ev.nls({color:8947848}),o=new ev.Pa4(-e/2,0,-t/2),s=e/(l-1),d=t/(n-1);for(let t=0;t<n;++t){let l=new ev.u9r().setFromPoints([new ev.Pa4(o.x,0,o.z+t*d),new ev.Pa4(o.x+e,0,o.z+t*d)]);a.add(new ev.x12(l,r))}for(let e=0;e<l;++e){let l=new ev.u9r().setFromPoints([new ev.Pa4(o.x+e*s,0,o.z),new ev.Pa4(o.x+e*s,0,o.z+t)]);a.add(new ev.x12(l,r))}return null==i||i(a),a},createLabels=(t,l,n,i)=>{let a=new ev.ZAu,r=Math.abs(l-t),s=r/(i-1),d=new ev.Pa4().copy(n).multiplyScalar(-r/2),c=new ev.Pa4().copy(n).multiplyScalar(s),u=t;for(let t=0;t<i;++t){let t=LabelHelper(e,helpers_NumberHelper(u*o));t.position.copy(d),a.add(t),d.add(c),u+=s}return a},build=()=>{let e=t.boundingBox,l=t.boundingSphere.center,n=new ev.Pa4(e.max.x-e.min.x,e.max.y-e.min.y,e.max.z-e.min.z),r=getAxisDivions(n);a=1*(i=.1*Math.max(n.x,n.y,n.z));let o=new ev.ZAu,s=createGrid(n.x,n.z,r.x,r.z),d=createGrid(n.x,n.y,r.x,r.y,e=>{e.rotateX(Math.PI/2)}),c=createGrid(n.y,n.z,r.y,r.z,e=>{e.rotateZ(-Math.PI/2)});o.add(s,d,c);let u=createLabels(e.min.x,e.max.x,new ev.Pa4(1,0,0),r.x),m=createLabels(e.min.y,e.max.y,new ev.Pa4(0,1,0),r.y),p=createLabels(e.min.z,e.max.z,new ev.Pa4(0,0,1),r.z);return o.add(u,m,p),o.position.set(l.x,l.y,l.z),o.type="GridHelper",o.dispose=dispose,o},sign=e=>e<=0?-1:1,aMSign=e=>.5>=Math.abs(e)?1:-1,dispose=()=>{null==r||r.children.forEach(e=>{e.children.forEach(e=>{if("Line"===e.type){let t=e.geometry;t.dispose();let l=e.material;l.dispose()}else e.dispose()})})};return{dispose,setVisible:e=>{r.visible=e},setScale:e=>{o=e},update:()=>{let e=t.boundingBox,o=new ev.Pa4(e.max.x-e.min.x,e.max.y-e.min.y,e.max.z-e.min.z),s=!1;t.children.forEach(e=>{"GridHelper"===e.type&&(s=e.visible,t.remove(e),e.dispose())}),r=build();let d=n.object.position.distanceTo(n.target);r.traverse(e=>{"LabelHelper"===e.type&&e.scale.setScalar(.05*d)});let c=new ev.Pa4;l.getWorldDirection(c);let u=d/10/(n.minDistance+.001),m=r.children[0],p=r.children[1],h=r.children[2];m.position.set(0,sign(c.y)*(o.y/2+i),0),p.position.set(0,0,sign(c.z)*(o.z/2+i)),h.position.set(sign(c.x)*(o.x/2+i),0,0);let g=r.children[3],x=r.children[4],y=r.children[5];g.position.set(0,sign(c.y)*aMSign(c.y)*(o.y/2+a),-(sign(c.z)*aMSign(c.y)*(o.z/2+a))),x.position.set(sign(c.x)*aMSign(c.x)*(o.x/2+a),0,-(sign(c.z)*aMSign(c.x)*(o.z/2+a))),y.position.set(sign(c.x)*aMSign(c.x)*(o.x/2+a),-(sign(c.y)*aMSign(c.x)*(o.y/2+a)),0);let b=.2*u,f=.3*u;g.visible=Math.abs(c.y)>b||Math.abs(c.z)>f,x.visible=Math.abs(c.x)>f||Math.abs(c.z)>f,y.visible=Math.abs(c.x)>f||Math.abs(c.y)>b,r.visible=s,t.add(r)}}},SelectionHelper=(e,t,l,n)=>{let i=document.createElement("div");i.style.pointerEvents="none",i.style.border="1px solid #55aaff",i.style.backgroundColor="rgba(75, 160, 255, 0.3)",i.style.position="fixed";let a=new ev.FM8,r=new ev.FM8,o=new ev.FM8,s=new ev.FM8,d=!1,c=!1,u=new ev.iMs,end=()=>{d=!1},onMouseDown=e=>{d&&0===e.button&&(c=!0,onSelectStart(e))},onMouseMove=e=>{d&&c&&onSelectMove(e)},onMouseUp=e=>{c=!1,d&&onSelectEnd(e)};e.domElement.addEventListener("pointerdown",onMouseDown),e.domElement.addEventListener("pointermove",onMouseMove),e.domElement.addEventListener("pointerup",onMouseUp);let onSelectStart=t=>{n.enabled=!1,e.domElement.parentElement.appendChild(i),i.style.left=t.clientX+"px",i.style.top=t.clientY+"px",i.style.width="0px",i.style.height="0px",a.x=t.clientX,a.y=t.clientY},onSelectMove=e=>{s.x=Math.max(a.x,e.clientX),s.y=Math.max(a.y,e.clientY),o.x=Math.min(a.x,e.clientX),o.y=Math.min(a.y,e.clientY),i.style.left=o.x+"px",i.style.top=o.y+"px",i.style.width=s.x-o.x+"px",i.style.height=s.y-o.y+"px"},onSelectEnd=e=>{n.enabled=!0,i.parentElement&&i.parentElement.removeChild(i),r.x=e.clientX,r.y=e.clientY;let t=new ev.TUj(a,r);zoomToRect(t),end()},zoomToRect=i=>{let a=new ev.FM8(Math.abs(i.max.x-i.min.x),Math.abs(i.max.y-i.min.y));if(a.x<5||a.y<5)return;let r=new ev.FM8((i.max.x+i.min.x)/2,(i.max.y+i.min.y)/2),o=e.domElement.getBoundingClientRect(),s=r.x-o.left,d=r.y-o.top,c=new ev.FM8(s/o.width*2-1,-(2*(d/o.height))+1),m=t.children.find(e=>"Part"===e.type);if(!m)return;u.setFromCamera(c,l);let p=u.intersectObject(m);if(!p.length)return;n.target.copy(p[0].point);let h=new ev.FM8(a.x/o.width,a.y/o.height),g=Math.max(h.x,h.y),x=l.position.distanceTo(n.target),y=n.target.clone().sub(l.position).normalize().multiplyScalar(x*(1-g));l.position.add(y)};return{dispose:()=>{e.domElement.removeEventListener("pointerdown",onMouseDown),e.domElement.removeEventListener("pointermove",onMouseMove),e.domElement.removeEventListener("pointerup",onMouseUp)},end,isEnabled:()=>d,start:()=>{d=!0}}},SectionViewHelper=(e,t,l,n)=>{let i,a,r;let o=new ev.Ilk("#fad114"),s=new ev.Ilk("#E98A15"),d=new ev.Pa4(-1,0,0),c=new ev.JOQ(d),u={up:new ev.Pa4,forward:new ev.Pa4,right:new ev.Pa4},m=new ev.Pa4,p=new ev.Pa4,h=new ev.USm,g=new ev.Pa4,x=new ev.FM8,y=new ev.JOQ,b=new ev.Pa4,f=new ev.Pa4,w=new ev.Zzh,v={up:new ev.Pa4,forward:new ev.Pa4,right:new ev.Pa4},j=new ev.iMs,C=new ev.ZAu;C.type="SectionViewHelper",C.visible=!1,t.add(C),(()=>{let e=new ev._12(1,1),t=new ev.vBJ({color:o,side:ev.ehD,transparent:!0,opacity:.5}),l=new ev.Kj0(e,t);l.type="Plane",C.add(l)})(),(()=>{let e=new ev.xo$(.2,32,32,Math.PI,-Math.PI),t=new ev.vBJ({color:o,side:ev.ehD,transparent:!0,opacity:.5}),l=new ev.Kj0(e,t);l.type="Dome",C.add(l)})(),(()=>{let ArcCurve=class ArcCurve extends ev.Hyl{getPoint(e){return new ev.Pa4().set(this.radius*Math.cos(Math.PI*e),this.radius*Math.sin(Math.PI*e),0)}constructor(e){super(),this.radius=e}};let e=new ArcCurve(.2);{let t=new ev.WXh(e,32,.020000000000000004,32),l=new ev.vBJ({color:o,side:ev.ehD,transparent:!0,opacity:.5}),n=new ev.Kj0(t,l);n.rotateX(Math.PI/2),n.type="ArcX",C.add(n)}{let t=new ev.WXh(e,32,.020000000000000004,32),l=new ev.vBJ({color:o,side:ev.ehD,transparent:!0,opacity:.5}),n=new ev.Kj0(t,l);n.rotateX(Math.PI/2),n.rotateY(Math.PI/2),n.type="ArcY",C.add(n)}})();let setScale=()=>{let e=new ev.Pa4;t.boundingBox.getSize(e),e.multiplyScalar(1.2);let l=Math.max(Math.max(e.x,e.y),e.z);C.scale.setScalar(l)},setCenter=()=>{let e=new ev.Pa4;t.boundingBox.getCenter(e),C.position.copy(e)},flip=()=>{C.rotateX(Math.PI);let e=c.normal.multiplyScalar(-1);c.setFromNormalAndCoplanarPoint(e,C.position)},globalToLocal=e=>{let t=e.target,l=t.getBoundingClientRect(),n=e.clientX-l.left,i=e.clientY-l.top,a=new ev.FM8;return a.x=n/l.width*2-1,a.y=-(2*(i/l.height))+1,a},highlight=e=>{i&&i.material.color.set(o),i=e,e&&e.material.color.set(s)},enableControls=()=>{n.enabled=!0},disableControls=()=>{n.enabled=!1},setCameraDirections=()=>{l.getWorldDirection(u.forward),u.forward.normalize(),u.up.copy(l.up).normalize(),u.right.crossVectors(u.up,u.forward).normalize()},updateClippingPlane=()=>{let e=new ev.Pa4(0,0,1).applyQuaternion(C.quaternion).multiplyScalar(-1);c.setFromNormalAndCoplanarPoint(e,C.position)},onMouseMove=e=>{if(!C.visible)return;let t=globalToLocal(e);if(j.setFromCamera(t,l),a){let e=new ev.Pa4;j.ray.intersectPlane(y,e),(null==r?void 0:r.type)==="Plane"?planeMove(e):(null==r?void 0:r.type)==="Dome"?domeMove(t):arcMove(e),updateClippingPlane()}else{let e=j.intersectObject(C);e.length?(disableControls(),highlight(r=e[0].object),p.copy(e[0].point),setCameraDirections()):(r=null,highlight(),enableControls())}},planeControl=()=>{y.setFromNormalAndCoplanarPoint(u.forward,p),m.copy(C.position);let e=new ev.Pa4;j.ray.intersectPlane(y,e),b.copy(e).sub(m),f.copy(b).normalize(),w.set(m,new ev.Pa4().copy(m).add(c.normal))},planeMove=e=>{e.sub(b);let t=new ev.Pa4;w.closestPointToPoint(e,!1,t),C.position.copy(t)},domeControl=e=>{h.copy(C.rotation),x.copy(e)},domeMove=e=>{C.rotation.copy(h),C.rotateOnWorldAxis(u.up,-(5*(x.x-e.x))),C.rotateOnWorldAxis(u.right,-(5*(x.y-e.y)))},arcControl=()=>{r.getWorldDirection(g),h.copy(C.rotation),b.copy(p).sub(C.position),f.copy(b).normalize(),v.up.copy(f),v.right.copy(g),v.forward.crossVectors(v.right,v.up),w.set(p,new ev.Pa4().copy(p).add(v.forward)),y.setFromNormalAndCoplanarPoint(u.forward,p)},arcMove=e=>{let t=n.object.position.distanceTo(n.target),l=new ev.Pa4;w.closestPointToPoint(e,!1,l);let i=p.distanceTo(l);l.sub(p);let a=new ev.Pa4().copy(f).cross(l).normalize(),r=Math.sign(g.dot(a));C.rotation.copy(h),C.rotateOnWorldAxis(g,r*i*1/(t/100))},setControl=e=>{switch(null==r?void 0:r.type){case"Plane":planeControl();break;case"Dome":domeControl(e);break;case"ArcX":case"ArcY":arcControl()}},onMouseDown=e=>{if(C.visible&&r){a=!0;let t=globalToLocal(e);setControl(t)}},onMouseUp=()=>{C.visible&&(a=!1,highlight())};return e.domElement.addEventListener("pointermove",onMouseMove),e.domElement.addEventListener("pointerdown",onMouseDown),e.domElement.addEventListener("pointerup",onMouseUp),{getClippingPlane:()=>c,toggleVisible:()=>{let e=C.visible;C.visible=!e},start:()=>{e.localClippingEnabled=!0,C.visible=!0,setScale(),setCenter();let t=new ev.Pa4().copy(C.position).sub(d);C.lookAt(t),c.setFromNormalAndCoplanarPoint(d,C.position)},stop:()=>{e.localClippingEnabled=!1,C.visible=!1},toAxis:e=>{if(setCenter(),d.equals(e)){flip();return}let t=new ev.Pa4().copy(C.position).sub(e);C.lookAt(t),c.setFromNormalAndCoplanarPoint(e,C.position),d.copy(e)},flip,dispose:()=>{C.traverse(e=>{("Plane"===e.type||"Dome"===e.type||"ArcX"===e.type||"ArcY"===e.type)&&(e.geometry.dispose(),e.material.dispose())}),e.domElement.removeEventListener("pointermove",onMouseMove),e.domElement.removeEventListener("pointerdown",onMouseDown),e.domElement.removeEventListener("pointerup",onMouseUp)}}};var eS=l(54104);let ColorbarHelper=e=>{let t=new eS.A("rainbow",512);t.setMin(Number.MAX_VALUE),t.setMax(-Number.MAX_VALUE);let l=new ev.xsS,n=new ev.iKG(-1,1,1,-1,2,1);n.position.set(0,0,1);let i=new ev.ZAu;l.add(i);let a=!1,r=1,o=0,clearScene=()=>{l.children.forEach(e=>{e.children.forEach(t=>{"LabelHelper"===t.type&&t.dispose(),"Sprite"===t.type&&t.dispose(),e.remove(t)})})},setLabels=t=>{let l=helpers_NumberHelper(t.minV*r+o),n=helpers_NumberHelper(t.maxV*r+o),a=LabelHelper(e,String(l),{background:"white",fillStyle:"black",position:new ev.Pa4(-.62,0,0),width:512,align:"right"});a.scale.x=.4,a.scale.y=2.8,a.renderOrder=0;let s=LabelHelper(e,String(n),{background:"white",fillStyle:"black",position:new ev.Pa4(.62,0,0),width:512,align:"left"});s.scale.x=.4,s.scale.y=2.8,s.renderOrder=0,i.add(a),i.add(s)};return{render:()=>{let t=e.domElement.getBoundingClientRect();e.setViewport(t.width/2-350,t.height-50,700,50),e.render(l,n)},addLUT:e=>{if(!a){let l=t.minV,n=t.maxV;t.setMin(Math.min(l,e.minV)),t.setMax(Math.max(n,e.maxV))}let l=new ev.ROQ(t.createCanvas()),n=new ev.xeV({map:l,depthWrite:!1}),r=new ev.jyi(n);r.material.rotation=-Math.PI/2,r.scale.x=.2,r.scale.y=1.2,r.renderOrder=1,r.dispose=r.material.dispose,i.add(r),setLabels(t)},getMinV:()=>t.minV,getMaxV:()=>t.maxV,getColor:e=>t.getColor(e),setUnit:t=>{var l,n,a;let s=LabelHelper(e,String("Unit: "+(null!==(l=null==t?void 0:t.label)&&void 0!==l?l:1)),{background:"white",fillStyle:"black",position:new ev.Pa4(0,.5,0),width:512});s.scale.x=.4,s.scale.y=2.8,s.renderOrder=0,i.add(s),r=null!==(n=null==t?void 0:t.multiplicator)&&void 0!==n?n:1,o=null!==(a=null==t?void 0:t.adder)&&void 0!==a?a:0},setVisible:e=>{l.children.forEach(t=>{t.children.forEach(t=>t.visible=e)})},setColorMap:e=>{t.setColorMap(e,512)},setRange:(e,l)=>{a=!0,t.setMin(e),t.setMax(l)},setAutomaticRange:()=>{a=!1,t.setMin(Number.MAX_VALUE),t.setMax(-Number.MAX_VALUE)},dispose:()=>{a||(t.setMin(Number.MAX_VALUE),t.setMax(-Number.MAX_VALUE)),clearScene()}}},PointHelper=e=>{let t=new ev.ZAu;t.type="PointHelper",t.visible=!1,e.add(t);let buildSphere=()=>{var t,l;let n=(null!==(l=null===(t=e.boundingSphere)||void 0===t?void 0:t.radius)&&void 0!==l?l:1)/100,i=new ev.xo$(n),a=new ev.Wid({color:16711680});return new ev.Kj0(i,a)},buildLine=(e,t)=>{let l=new ev.u9r().setFromPoints([e,t]),n=new ev.nls({color:16711680});return new ev.x12(l,n)},buildLines=()=>{let t=[],l=e.boundingBox.max.x-e.boundingBox.min.x,n=e.boundingBox.max.y-e.boundingBox.min.y,i=e.boundingBox.max.z-e.boundingBox.min.z,a=Math.max(l,n,i),r=buildLine(new ev.Pa4(-a/2,0,0),new ev.Pa4(a/2,0,0));t.push(r);let o=buildLine(new ev.Pa4(0,-a/2,0),new ev.Pa4(0,a/2,0));t.push(o);let s=buildLine(new ev.Pa4(0,0,-a/2),new ev.Pa4(0,0,a/2));return t.push(s),t},dispose=()=>{t.children.forEach(e=>{t.remove(e),e.geometry.dispose(),e.material.dispose()})};return{build:()=>{dispose();let e=buildSphere(),l=buildLines();t.add(e),t.add(...l)},dispose,update:e=>{e?(t.position.set(e.x,e.y,e.z),t.visible=!0):t.visible=!1}}};var ek=l(77836),eZ=l(82854),eE=l(6648),e_=l(48764).lW;let loadMesh=(e,t)=>{e.traverse(e=>{if("Mesh"===e.type){let l=new ev.Uk6(e.geometry),n=new ev.nls({color:e.material.color,linewidth:1}),i=new ev.ejS(l,n);e.add(i),e.material.visible=!1,e.material.clippingPlanes=[t]}})},loadResult=(e,t)=>{e.traverse(e=>{if("Mesh"===e.type||"Line"===e.type){let l=e.geometry.getAttribute("data");if(l){let t=l.array.reduce((e,t)=>Math.min(e,t),l.array[0]),n=l.array.reduce((e,t)=>Math.max(e,t),l.array[0]);t===n&&(t-=1,n+=1);let i=new eS.A;i.setMin(t),i.setMax(n),e.userData={...e.userData,lut:i}}if("Mesh"===e.type){let t=new ev.Uk6(e.geometry),l=new ev.nls({linewidth:1}),n=new ev.ejS(t,l);e.add(n)}e.material.vertexColors=!0,e.material.clippingPlanes=[t]}})},loadGeometry=(e,t)=>{e.traverse(e=>{"Mesh"===e.type&&(e.material.clippingPlanes=[t],e.material.originalColor=e.material.color)})},PartLoader=(e,t)=>{let l=new ev.Ilk("#FAD114"),n=new ev.Ilk("#EE9817"),load=async(e,t,l,n)=>{console.log(JSON.stringify(e));let i=new Blob([e_.from(e.buffer)]),a=URL.createObjectURL(i),r=new ek.E,o=new eZ._;o.setDecoderPath("/three/libs/draco/"),r.setDRACOLoader(o);let s=new eE.a;s.setTranscoderPath("node_modules/three//examples/js/libs/basis/"),r.setKTX2Loader(s);let u=await new Promise((e,t)=>{r.load(a,t=>{e(t)},()=>void 0,e=>t(e))}),m=u.scene,p=new ev.Tme;return p.type="Part",p.uuid=e.summary.uuid,p.children=m.children,p.userData=m.userData,"mesh"===e.summary.type?loadMesh(p,n):"result"===e.summary.type?loadResult(p,n):("geometry3D"===e.summary.type||"geometry2D"===e.summary.type)&&loadGeometry(p,n),setTransparent(p,t),setDisplayMesh(p,l),p.boundingBox=computeBoundingBox(p),p.dispose=()=>dispose(p),p.setTransparent=e=>setTransparent(p,e),p.setDisplayMesh=e=>setDisplayMesh(p,e),p.startSelection=(e,t,l)=>startSelection(p,e,t,l),p.stopSelection=()=>stopSelection(),p.getHighlighted=()=>d,p.getSelected=()=>c,p.highlight=highlight,p.unhighlight=unhighlight,p.select=select,p.unselect=unselect,p},computeBoundingBox=e=>{let t=new ev.ZzF;return e.traverse(e=>{t.expandByObject(e)}),t},dispose=e=>{e.traverse(e=>{"Mesh"===e.type&&(e.geometry.dispose(),e.material.dispose())})},setTransparent=(e,t)=>{e.traverse(e=>{"Mesh"===e.type&&(e.material.transparent=t,e.material.opacity=t?.5:1,e.material.depthWrite=!t)})},setDisplayMesh=(e,t)=>{"result"===e.userData.type&&e.traverse(e=>{e.traverse(e=>{"LineSegments"===e.type&&(e.visible=t)})})},i=new ev.iMs,a=null,r=null,o=null,s=null,d=null,c=[],startSelection=(e,t,l,n)=>{a=e,r=n,o=t,s=l,d=null,c.length=0,o.domElement.addEventListener("pointermove",mouseMove),o.domElement.addEventListener("pointerdown",mouseDown)},stopSelection=()=>{null==o||o.domElement.removeEventListener("pointermove",mouseMove),null==o||o.domElement.removeEventListener("pointerdown",mouseDown),unhighlight(),d=null,c.forEach(e=>{unselect(e.uuid)}),c.length=0,r=null,a=null,o=null,s=null},findObject=(e,t)=>{let l;if(e&&t)return e.traverse(e=>{e.userData.uuid===t&&(l=e)}),l},globalToLocal=e=>{let t=e.target,l=t.getBoundingClientRect(),n=e.clientX-l.left,i=e.clientY-l.top,a=new ev.FM8;return a.x=n/l.width*2-1,a.y=-(2*(i/l.height))+1,a},solidsSelect=()=>{let t=i.intersectObject(a,!0);if(t.length){let l=t[0].object,n=l.parent;n&&e(a,n.userData.uuid,n.userData.label)}else e(a)},facesSelect=()=>{let t;let l=a.userData;if(2===l.dimension){if((t=i.intersectObject(a,!0)).length){let l=t[0].object,n=l.parent;(null==n?void 0:n.type)==="Mesh"?e(a,n.userData.uuid,n.userData.label):e(a,l.userData.uuid,l.userData.label)}else e(a)}else if((t=i.intersectObject(a,!0)).length){let l=t[0].object;e(a,l.userData.uuid,l.userData.label)}else e(a)},edgesSelect=()=>{let t;let l=a.userData,n=l.edges;if((t=i.intersectObject(a,!0)).length){let l=t[0].object,i=null==n?void 0:n.find(e=>e.uuid===l.userData.uuid);i?e(a,l.userData.uuid,l.userData.label):e(a)}else e(a)},pointSelect=()=>{let t=i.intersectObject(a,!0);if(t.length){let l=t[0];e(a,void 0,void 0,l.point)}else e(a)},mouseMove=e=>{let t=globalToLocal(e);switch(i.setFromCamera(t,s),r){case"solids":solidsSelect();break;case"faces":facesSelect();break;case"edges":edgesSelect();break;case"point":pointSelect()}},highlight=e=>{if(e===(null==d?void 0:d.uuid))return;unhighlight();let t=findObject(a,e);t&&(d={uuid:t.userData.uuid,label:t.userData.label},"Mesh"===t.type?t.material.color=l:t.traverse(e=>{"Mesh"===e.type&&(e.material.color=l)}))},unhighlight=()=>{let e=findObject(a,null==d?void 0:d.uuid);if(d=null,!e)return;let t=c.findIndex(t=>t.uuid===e.userData.uuid);"Mesh"===e.type?e.material.color=-1===t?e.material.originalColor:n:e.traverse(e=>{"Mesh"===e.type&&(e.material.color=-1===t?e.material.originalColor:n)})},mouseDown=()=>{d&&t(a,d.uuid,d.label)},select=e=>{let t=findObject(a,e);t&&(c.push({uuid:e,label:t.userData.label}),"Mesh"===t.type?t.material.color=n:t.traverse(e=>{"Mesh"===e.type&&(e.material.color=n)}))},unselect=e=>{let t=findObject(a,e),l=c.findIndex(t=>t.uuid===e);-1!==l&&(c=[...c.slice(0,l),...c.slice(l+1)]),t&&("Mesh"===t.type?t.material.color=t.material.originalColor:t.traverse(e=>{"Mesh"===e.type&&(e.material.color=e.material.originalColor)}))};return{load}};var eL=l(5957),eA=l(95490),ez=l.n(eA);let eD={load:"Error while loading part",snapshot:"Error while taking snapshot",saveScreenshot:"Unable to save screenshot"},eN=!1,eT=new ev.Pa4(1,1,1),_computeSceneBoundingSphere=e=>{let t=new ev.ZzF;e.children.forEach(e=>{if(e.visible&&"Part"===e.type){let l=e.boundingBox,n=new ev.Pa4(Math.min(t.min.x,l.min.x),Math.min(t.min.y,l.min.y),Math.min(t.min.z,l.min.z)),i=new ev.Pa4(Math.max(t.max.x,l.max.x),Math.max(t.max.y,l.max.y),Math.max(t.max.z,l.max.z));t.set(n,i)}});let l=new ev.aLr;t.getBoundingSphere(l),e.boundingBox=t,e.boundingSphere=l},_zoom=(e,t,l)=>{let n=t.object.position.distanceTo(t.target),i=t.target.clone().sub(e.position).normalize().multiplyScalar(n*l*.01);e.position.add(i)},_zoomToFit=(e,t,l)=>{let n=e.children.find(e=>"Part"===e.type);if(!n)return;eN=!0;let i=e.boundingSphere,a=i.center,r=2*i.radius,o=r/(2*Math.atan(Math.PI*t.fov/360)),s=o/t.aspect,d=1.1*Math.max(o,s),c=l.target.clone().sub(t.position).normalize().multiplyScalar(d);l.target.copy(a),l.minDistance=d/10,l.maxDistance=10*d,t.position.copy(a).sub(c),t.near=d/100,t.far=100*d,t.updateProjectionMatrix();let u=e.children.find(e=>"PointLight"===e.type);null==u||u.position.copy(t.position).add(eT.multiplyScalar(d))},_loadPart=async(e,t,l,n,i,a,r)=>{var o,s,d;let c=PartLoader((e,t,l,n)=>{t?(e.highlight(t),setTimeout(()=>r((0,eC.CH)({uuid:t,label:l})),1)):n?r((0,eC.N7)({x:n.x,y:n.y,z:n.z})):(e.unhighlight(),setTimeout(()=>r((0,eC.HW)()),1))},(e,t,l)=>{let n=e.getSelected();n.find(e=>e.uuid===t)?(e.unselect(t),setTimeout(()=>r((0,eC.hF)({uuid:t,label:l})),1)):(e.select(t),setTimeout(()=>r((0,eC.Ys)({uuid:t,label:l})),1))}),u=await c.load(e,i.transparent,i.displayMesh,a.sectionViewHelper.getClippingPlane());u.name=null!==(d=null===(o=e.extra)||void 0===o?void 0:o.name)&&void 0!==d?d:u.name,u.fields=null===(s=e.extra)||void 0===s?void 0:s.fields,t.add(u),_computeSceneBoundingSphere(t),eN||_zoomToFit(t,l,n),a.gridHelper.update(),a.gridHelper.update(),a.gridHelper.setVisible(!0),a.pointHelper.build()},_setColorbarhelper=(e,t)=>{for(let l of(t.dispose(),t.setVisible(!1),e.children))if("Part"===l.type&&"result"===l.userData.type){let e=l.name.split(" ").shift(),n=l.fields,i=null==n?void 0:n.find(t=>t.name===e);l.traverse(e=>{("Mesh"===e.type||"Line"===e.type)&&(t.setUnit(null==i?void 0:i.unit),t.addLUT(e.userData.lut),t.setVisible(!0))})}},_computeColors=(e,t)=>{for(let l of(_setColorbarhelper(e,t),e.children))"Part"===l.type&&"result"===l.userData.type&&l.traverse(e=>{if("Mesh"===e.type||"Line"===e.type){let l=e.geometry.getAttribute("data"),n=new Float32Array(3*l.count);for(let e=0;e<l.count;e++){let i=t.getColor(l.array[e]);n[3*e+0]=i.r,n[3*e+1]=i.g,n[3*e+2]=i.b}e.geometry.setAttribute("color",new ev.a$l(n,3))}})},_takeScreenshot=async(e,t,l,n,i)=>{try{let i=n.domElement.width,a=n.domElement.height,r=l.aspect;n.domElement.width=520,n.domElement.height=312,l.aspect=520/312,l.updateProjectionMatrix(),n.clear(),n.setViewport(0,0,520,312),n.render(t,l);let o=n.domElement.toDataURL();n.domElement.width=i,n.domElement.height=a,l.aspect=r,l.updateProjectionMatrix(),await eL.Z.add({name:"snapshot",uid:"snapshot_"+(0,ej.Z)(),data:o},{id:e.id})}catch(e){i((0,k.iT)({title:eD.snapshot,err:e}))}},_downloadScreenshot=(e,t,l,n,i)=>{try{let i=n.domElement.width,a=n.domElement.height;n.clear(),n.setViewport(0,0,i,a),n.render(t,l);let r=n.domElement.toDataURL(),o=document.createElement("a");o.href=r.replace("image/png","image/octet-stream"),o.download=e.title+"_"+new Date().toLocaleDateString()+".png",o.click()}catch(e){i((0,k.iT)({title:eD.saveScreenshot,err:e}))}};var three=e=>{var t,l,a,r,d;let{loading:m,project:h,parts:g}=e,x=(0,s.useRef)(null),y=(0,s.useRef)(),b=(0,s.useRef)(),f=(0,s.useRef)(),v=(0,s.useRef)(),j=(0,s.useRef)(),C=(0,s.useRef)(),P=(0,s.useRef)(),E=(0,s.useRef)(),_=(0,s.useRef)(),[L,A]=(0,s.useState)(!1),[z,N]=(0,s.useState)(!0),[T,H]=(0,s.useState)(!1),[O,R]=(0,s.useState)(!1),[F,U]=(0,s.useState)(!1),[G,V]=(0,s.useState)(!1),[X,J]=(0,s.useState)("m"),{enabled:K,part:Y,highlighted:Q,selected:ee,point:et,type:ej,dispatch:eC}=(0,s.useContext)(D.ZB),{dispatch:eS}=(0,s.useContext)(S.uj),ek=(0,o.useRouter)();(0,s.useEffect)(()=>{var e;if(!eM.Z.isWebGLAvailable()){(async()=>{await ek.push("/webgl")})();return}let t=x.current,l=t.clientWidth,n=t.clientHeight;y.current=new ev.xsS,y.current.boundingBox=new ev.ZzF,y.current.boundingSphere=new ev.aLr,b.current=new ev.cPb(50,l/n,.1,1e3),b.current.position.z=10;let i=new ev.Mig("#ccc",.75);y.current.add(i);let a=new ev.cek("#fff",.5);a.decay=0,y.current.add(a),y.current.add(b.current),f.current=new ev.CP7({antialias:!0,alpha:!0,powerPreference:"high-performance"}),f.current.setClearColor("#ffffff"),f.current.setSize(l,n),f.current.setPixelRatio(null!==(e=window.devicePixelRatio)&&void 0!==e?e:1),f.current.shadowMap.enabled=!0,f.current.autoClear=!1,t.appendChild(f.current.domElement),v.current=new eP.$(b.current,t),v.current.rotateSpeed=3,v.current.panSpeed=.1;let r=AxisHelper(f.current,b.current,{offsetWidth:l-155,offsetHeight:n-155,width:150,height:150}),o=NavigationHelper(f.current,y.current,b.current,v.current,{offsetWidth:l-155,offsetHeight:n-155,width:150,height:150});j.current=GridHelper(f.current,y.current,b.current,v.current),C.current=SelectionHelper(f.current,y.current,b.current,v.current),P.current=SectionViewHelper(f.current,y.current,b.current,v.current),E.current=ColorbarHelper(f.current),E.current.setVisible(!1),_.current=PointHelper(y.current);let renderScene=()=>{v.current.update(),f.current.setViewport(0,0,l,n),f.current.render(y.current,b.current),j.current.update(),r.render(),o.render(),E.current.render()},handleResize=()=>{l=t.clientWidth,n=t.clientHeight,b.current.aspect=l/n,b.current.updateProjectionMatrix(),f.current.setSize(l,n),r.resize({newOffsetWidth:l-155,newOffsetHeight:n-155,newWidth:150,newHeight:150}),o.resize({newOffsetWidth:l-155,newOffsetHeight:n-155,newWidth:150,newHeight:150}),renderScene()},animate=()=>{renderScene(),setTimeout(()=>requestAnimationFrame(animate),1e3/30)};return window.addEventListener("resize",handleResize),requestAnimationFrame(animate),()=>{eN=!1,window.removeEventListener("resize",handleResize),t.removeChild(f.current.domElement),y.current.children.forEach(e=>{y.current.remove(e)}),r.dispose(),o.dispose(),j.current.dispose(),P.current.dispose(),C.current.dispose(),E.current.dispose(),_.current.dispose()}},[ek]),(0,Z.Z)(()=>{if(!y.current)return;let e=y.current.children;if(!g.length){var t;_computeSceneBoundingSphere(y.current),j.current.update(),null===(t=_.current)||void 0===t||t.build()}let l=g.filter(t=>!e.find(e=>e.uuid===t.summary.uuid)),n=e.filter(e=>!g.find(t=>t.summary.uuid===e.uuid)).filter(e=>"Part"===e.type);n.forEach(e=>{var t;null===(t=y.current)||void 0===t||t.remove(e),e.dispose()}),(async()=>{await Promise.all(l.map(async e=>{try{await _loadPart(e,y.current,b.current,v.current,{transparent:L,displayMesh:z},{gridHelper:j.current,sectionViewHelper:P.current,pointHelper:_.current},eC)}catch(e){eS((0,k.iT)({title:eD.load,err:e})),_computeSceneBoundingSphere(y.current)}})),_computeColors(y.current,E.current)})()},[g,L,z,eC]),(0,Z.Z)(()=>{var e;if(y.current){if((null===(e=g[0])||void 0===e?void 0:e.summary.dimension)===2){_computeSceneBoundingSphere(y.current);let e=new ev.Pa4(0,0,1),t=new ev.Pa4(0,1,0),l=new ev.Pa4;y.current.boundingBox.getCenter(l);let n=b.current.position.distanceTo(v.current.target),i=e.clone().multiplyScalar(n),a=l.add(i);b.current.position.copy(a),b.current.up.copy(t),v.current.noRotate=!0}else v.current.noRotate=!1}},[g]),(0,s.useEffect)(()=>{y.current&&y.current.children.forEach(e=>{"Part"===e.type&&e.userData.uuid===Y&&(K?e.startSelection(f.current,b.current,ej):e.stopSelection())})},[K,Y,ej]),(0,s.useEffect)(()=>{y.current&&y.current.children.forEach(e=>{if("Part"===e.type&&e.uuid===Y){e.highlight(null==Q?void 0:Q.uuid);let t=e.getSelected(),l=ee.filter(e=>!t.find(t=>t.uuid===e.uuid));l.forEach(t=>{t.uuid&&e.select(t.uuid)});let n=t.filter(e=>!ee.find(t=>t.uuid===e.uuid));n.forEach(t=>{e.unselect(t.uuid)})}})},[Y,Q,ee]),(0,s.useEffect)(()=>{var e;y.current&&(null===(e=_.current)||void 0===e||e.update(et?new ev.Pa4(et.x,et.y,et.z):void 0))},[et]);let eZ=(0,s.useCallback)(e=>{A(e),y.current.children.forEach(t=>{"Part"===t.type&&t.setTransparent(e)})},[]),eE=(0,s.useCallback)(e=>{N(e),y.current.children.forEach(t=>{"Part"===t.type&&t.setDisplayMesh(e)})},[]),e_=(0,s.useCallback)(()=>{let e=!T;H(e),e?P.current.start():P.current.stop()},[T]),eL=(0,s.useCallback)(()=>{(async()=>{R(!0);try{await _takeScreenshot(h,y.current,b.current,f.current,eS)}finally{R(!1)}})()},[h,eS]),eA=(0,s.useCallback)(()=>{U(!0);try{_downloadScreenshot(h,y.current,b.current,f.current,eS)}finally{U(!1)}},[h,eS]),eT=(0,s.useCallback)(e=>{var t;null===(t=j.current)||void 0===t||t.setVisible(e)},[]),eH=(0,s.useCallback)(()=>{_zoom(b.current,v.current,1),n=requestAnimationFrame(()=>eH())},[]),eO=(0,s.useCallback)(()=>{_zoom(b.current,v.current,-1),n=requestAnimationFrame(()=>eO())},[]),eR=(0,s.useCallback)(()=>{n&&cancelAnimationFrame(n),n=void 0},[]),eF=(0,s.useCallback)(()=>{_zoomToFit(y.current,b.current,v.current)},[]),eU=(0,s.useCallback)(()=>{P.current.toAxis(new ev.Pa4(-1,0,0))},[]),eB=(0,s.useCallback)(()=>{P.current.toAxis(new ev.Pa4(0,-1,0))},[]),eG=(0,s.useCallback)(()=>{P.current.toAxis(new ev.Pa4(0,0,-1))},[]),eI=(0,s.useCallback)(e=>{var t;null===(t=E.current)||void 0===t||t.setColorMap(e.key),_computeColors(y.current,E.current)},[]),eV=(0,s.useCallback)(()=>{V(!0)},[]),eW=(0,s.useCallback)(()=>{V(!1)},[]),eX=(0,s.useCallback)(async e=>{var t;null===(t=E.current)||void 0===t||t.setRange(+e.min,+e.max),_computeColors(y.current,E.current),eW()},[eW]),eJ=(0,s.useCallback)(()=>{var e;null===(e=E.current)||void 0===e||e.setAutomaticRange(),_computeColors(y.current,E.current)},[]),eK=(0,s.useCallback)(e=>{var t,l;let{key:n}=e;"m"===n?null===(t=j.current)||void 0===t||t.setScale(1):null===(l=j.current)||void 0===l||l.setScale(1e3),J(n)},[]),eY=(0,s.useMemo)(()=>{let e=g.filter(e=>"result"===e.summary.type),t=e.map(e=>{var t,l,n;let i=null===(t=e.extra)||void 0===t?void 0:t.fields,a=null===(n=e.extra)||void 0===n?void 0:null===(l=n.name)||void 0===l?void 0:l.split(" ").shift(),r=null==i?void 0:i.find(e=>e.name===a);return null==r?void 0:r.units}).filter(e=>e).flat(),l=t.filter((e,l)=>t.findIndex(t=>t.label===e.label)===l);return l.map(e=>({key:e.label,multiplicator:e.multiplicator,adder:e.adder,label:(0,i.jsx)(B.Z.Inline,{text:e.label})}))},[g]);return(0,i.jsxs)(u.Z,{className:"".concat(W().noScroll," ").concat(ez().view),children:[(0,i.jsxs)(I.ZP,{visible:G,title:"Custom range",initialValues:{min:null===(t=E.current)||void 0===t?void 0:t.getMinV(),max:null===(l=E.current)||void 0===l?void 0:l.getMaxV()},onCancel:eW,onOk:eX,children:[(0,i.jsx)(q.Z.Item,{label:"Min",name:"min",children:(0,i.jsx)($.default,{})}),(0,i.jsx)(q.Z.Item,{label:"Max",name:"max",children:(0,i.jsx)($.default,{})})]}),(0,i.jsxs)(u.Z.Header,{className:ez().head,children:[(0,i.jsxs)(p.default,{title:"Units",className:ez().unit,children:[(0,i.jsx)(B.Z.Inline,{text:X}),(0,i.jsx)(en.default,{menu:{onClick:eK,items:[{key:"m",label:(0,i.jsx)(B.Z.Inline,{text:"m"})},{key:"mm",label:(0,i.jsx)(B.Z.Inline,{text:"mm"})}]},children:(0,i.jsx)(c(),{icon:(0,i.jsx)(ew.Z,{})})})]}),(0,i.jsx)(el.Z,{style:{margin:0}}),(0,i.jsx)(p.default,{title:"Take snapshot",placement:"left",children:(0,i.jsx)(en.default,{placement:"bottom",menu:{items:[{key:"project",label:(0,i.jsx)(c(),{type:"text",className:"".concat(W().fullWidth," ").concat(W().noBackground),loading:O,onClick:eL,children:"Project snapshot"})},{key:"image",label:(0,i.jsx)(c(),{type:"text",className:"".concat(W().fullWidth," ").concat(W().noBackground),loading:F,onClick:eA,children:"Export image"})}]},children:(0,i.jsx)(c(),{icon:(0,i.jsx)(es.Z,{})})})}),(0,i.jsx)(el.Z,{style:{margin:0}}),(0,i.jsx)(p.default,{title:"Display grid",placement:"left",children:(0,i.jsx)(ea.Z,{defaultChecked:!0,checkedChildren:(0,i.jsx)(er.Z,{}),unCheckedChildren:(0,i.jsx)(er.Z,{}),onChange:eT})}),(0,i.jsx)(p.default,{title:"Set transparency",placement:"left",children:(0,i.jsx)(ea.Z,{checked:L,checkedChildren:(0,i.jsx)(em.Z,{}),unCheckedChildren:(0,i.jsx)(em.Z,{}),onChange:eZ})}),(0,i.jsx)(el.Z,{style:{margin:0}}),(0,i.jsx)(p.default,{title:"Zoom out",placement:"left",children:(0,i.jsx)(c(),{icon:(0,i.jsx)(ec.Z,{}),onMouseDown:eO,onMouseUp:eR,onMouseOut:eR})}),(0,i.jsx)(p.default,{title:"Zoom in",placement:"left",children:(0,i.jsx)(c(),{icon:(0,i.jsx)(ed.Z,{}),onMouseDown:eH,onMouseUp:eR,onMouseOut:eR})}),(0,i.jsx)(p.default,{title:"Zoom to fit",placement:"left",children:(0,i.jsx)(c(),{icon:(0,i.jsx)(eo.Z,{}),onClick:eF})}),(0,i.jsx)(p.default,{title:"Zoom to selection",placement:"left",children:(0,i.jsx)(c(),{icon:(0,i.jsx)(eu.Z,{}),onClick:(null===(a=C.current)||void 0===a?void 0:a.isEnabled())?null===(r=C.current)||void 0===r?void 0:r.end:null===(d=C.current)||void 0===d?void 0:d.start})}),(0,i.jsx)(el.Z,{style:{margin:0}}),!T&&(0,i.jsx)(p.default,{title:"Section view",placement:"left",children:(0,i.jsx)(c(),{icon:(0,i.jsx)(ep.Z,{}),onClick:e_})}),T&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(p.default,{title:"Stop",placement:"left",children:(0,i.jsx)(c(),{icon:(0,i.jsx)(eh.Z,{}),onClick:e_})}),(0,i.jsx)(p.default,{title:"Hide plane",placement:"left",children:(0,i.jsx)(c(),{icon:(0,i.jsx)(M.default,{}),onClick:P.current.toggleVisible})}),(0,i.jsx)(p.default,{title:"Snap to X",placement:"left",children:(0,i.jsx)(c(),{className:"ant-btn-icon-only",onClick:eU,children:"X"})}),(0,i.jsx)(p.default,{title:"Snap to Y",placement:"left",children:(0,i.jsx)(c(),{className:"ant-btn-icon-only",onClick:eB,children:"Y"})}),(0,i.jsx)(p.default,{title:"Snap to Z",placement:"left",children:(0,i.jsx)(c(),{className:"ant-btn-icon-only",onClick:eG,children:"Z"})}),(0,i.jsx)(p.default,{title:"Flip",placement:"left",children:(0,i.jsx)(c(),{onClick:P.current.flip,icon:(0,i.jsx)(eg.Z,{})})})]}),g.filter(e=>"result"===e.summary.type).length?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(el.Z,{style:{margin:0}}),(0,i.jsx)(p.default,{title:"Display result mesh",placement:"left",children:(0,i.jsx)(ea.Z,{checked:z,checkedChildren:(0,i.jsx)(ex.Z,{}),unCheckedChildren:(0,i.jsx)(ex.Z,{}),onChange:eE})}),(0,i.jsx)(el.Z,{style:{margin:0}}),eY.length?(0,i.jsx)(p.default,{title:"Units",children:(0,i.jsx)(en.default,{placement:"bottom",menu:{onClick:e=>{var t;let{key:l}=e,n=eY.find(e=>e.key===l);null===(t=y.current)||void 0===t||t.children.forEach(e=>{if("Part"===e.type&&"result"===e.userData.type){let t=e.name.split(" ").shift(),i=e.fields,a=null==i?void 0:i.find(e=>e.name===t);a&&(a.unit={label:l,multiplicator:n.multiplicator,adder:n.adder})}}),_computeColors(y.current,E.current)},items:eY},children:(0,i.jsx)(c(),{icon:(0,i.jsx)(ew.Z,{})})})}):null,(0,i.jsx)(p.default,{title:"Colormap",placement:"left",children:(0,i.jsx)(en.default,{placement:"bottom",menu:{items:[{key:"rainbow",label:"Rainbow"},{key:"cooltowarm",label:"Cool to warm"},{key:"blackbody",label:"Black body"},{key:"grayscale",label:"Gray scale"}],onClick:eI},children:(0,i.jsx)(c(),{icon:(0,i.jsx)(ey.Z,{})})})}),(0,i.jsx)(p.default,{title:"Custom range",placement:"left",children:(0,i.jsx)(c(),{icon:(0,i.jsx)(eb.Z,{}),onClick:eV})}),(0,i.jsx)(p.default,{title:"Automatic range",placement:"left",children:(0,i.jsx)(c(),{icon:(0,i.jsx)(ef.Z,{}),onClick:eJ})})]}):null]}),(0,i.jsxs)(u.Z.Content,{className:"".concat(W().noScroll," ").concat(ez().content),children:[(0,i.jsx)("div",{style:{display:m?"flex":"none"},className:ez().loading,children:(0,i.jsx)(ei.default,{indicator:(0,i.jsx)(w.default,{style:{fontSize:80},spin:!0})})}),(0,i.jsx)("div",{ref:x,className:ez().canvas})]})]})};let eH={part:"Unable to load part"},view_loadPart=async(e,t,l,n)=>{try{if("geometry"===l){let e=await O.Z.getPart({id:t.id});return{...e,extra:{id:t.id}}}{let l=await et.Z.load({id:e.id},{originPath:t.originPath,glb:t.glb});return{...l,extra:{name:t.name,glb:t.glb,fields:t.extra}}}}catch(e){throw n((0,k.iT)({title:eH.part,err:e})),e}},_loadResults=async(e,t,l,n)=>Promise.all(l.map(async l=>{let i=t.find(e=>{var t;return(null===(t=e.extra)||void 0===t?void 0:t.glb)===l.glb});if(i)return i;let a=await view_loadPart(e,l,"result",n);return a})),_loadPostprocessing=async(e,t,l,n)=>{if(!n)return;let i=t.find(e=>{var t;return(null===(t=e.extra)||void 0===t?void 0:t.glb)===n.glb});if(i)return i;let a=await view_loadPart(e,n,"result",l);return a},_loadGeometries=async(e,t,l,n)=>Promise.all(l.map(async l=>{let i=t.find(e=>{var t;return(null===(t=e.extra)||void 0===t?void 0:t.id)===l.id});if(i)return i;let a=await view_loadPart(e,l,"geometry",n);return a}));var view=e=>{let{project:t,simulation:l,geometries:n,results:a,postprocessing:r}=e,[o,d]=(0,s.useState)([]),[c,u]=(0,s.useState)(!1),{dispatch:m}=(0,s.useContext)(S.uj);return(0,Z.Z)(()=>{(async()=>{u(!0);try{let e=[];if(l&&!r){let t=await _loadResults(l,o,a,m);e.push(...t)}if(l){let t=await _loadPostprocessing(l,o,m,r);t&&e.push(t)}if(!a.length&&!r){let t=await _loadGeometries(l,o,n,m);e.push(...t)}d(e)}catch(e){}finally{u(!1)}})()},[l,n,a,r,o],[m]),(0,i.jsx)(three,{loading:c,project:{id:t.id,title:t.title},parts:o})},eO=l(43083),eR=l(13156),eF=l.n(eR);let eU=r()(()=>Promise.all([l.e(3186),l.e(9305)]).then(l.bind(l,29305)),{loadableGenerated:{webpack:()=>[29305]},ssr:!1}),eB={geometries:{label:"GEOMETRIES",key:"geometries"},simulations:{label:"SIMULATIONS",key:"simulations"}},eG={user:"Unable to get user",project:"Unable to get project",simulations:"Unable to get simulations",geometries:"Unable to get geometries",add:"Unable to add simulation"},_onSelector=async(e,t,l,n)=>{try{var i;let n=await H.Z.add({id:e.id},{name:t.name,scheme:t});await l.addOneSimulation(n),await l.mutateProject({id:e.id,simulations:[...null!==(i=e.simulations)&&void 0!==i?i:[],n.id]})}catch(e){throw n((0,k.iT)({title:eG.add,err:e})),e}},GeometryLabel=e=>{let{visible:t,geometry:l,panel:n,add:a,del:r,close:o}=e,d=(0,s.useCallback)(e=>{var t,i,a;e.stopPropagation(),(null==n?void 0:null===(a=n.props)||void 0===a?void 0:null===(i=a.children)||void 0===i?void 0:null===(t=i.type)||void 0===t?void 0:t.componentName)===Geometry.componentName&&o(),r(l)},[l,n,r,o]),c=(0,s.useCallback)(e=>{e.stopPropagation(),a(l)},[l,a]);return(0,i.jsxs)("div",{children:[l.name,t?(0,i.jsx)(P.default,{onClick:d}):(0,i.jsx)(M.default,{onClick:c})]})},SimulationLabel=e=>{let{simulation:t}=e;return t.scheme.userModelId?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(p.default,{title:"User algorithm",placement:"right",children:(0,i.jsx)(C.Z,{style:{position:"absolute",top:0,left:14,fontSize:14,color:"#fad114"}})}),t.name]}):(0,i.jsx)(i.Fragment,{children:t.name})};var project=()=>{let e=(0,o.useRouter)(),{page:t,workspaceId:l,projectId:n}=e.query,[a,r]=(0,s.useState)(!1),[d,p]=(0,s.useState)([]),[C,P]=(0,s.useState)(!1),[M,_]=(0,s.useState)(),[L,A]=(0,s.useState)([]),[R,F]=(0,s.useState)(),[U,B]=(0,s.useState)(),[G,I]=(0,s.useState)(),[V,X]=(0,s.useState)(!0),{dispatch:J}=(0,s.useContext)(S.uj),[K,{errorUser:Y,loadingUser:q}]=N.Z.useUser(),[$,{mutateProject:Q,errorProject:ee,loadingProject:et}]=T.Z.useProject(n),[el,{addOneSimulation:en,delOneSimulation:ei,mutateOneSimulation:ea,errorSimulations:er,loadingSimulations:eo}]=H.Z.useSimulations(null==$?void 0:$.simulations),[es,{addOneGeometry:ed,delOneGeometry:ec,mutateOneGeometry:eu,errorGeometries:em,loadingGeometries:ep}]=O.Z.useGeometries(null==$?void 0:$.geometries),eh=(0,s.useCallback)(()=>r(!0),[]),eg=(0,s.useCallback)(()=>P(!0),[]),ex=(0,s.useCallback)(()=>P(!1),[]),ey=(0,s.useCallback)(e=>{p(t=>[...t,e])},[]),eb=(0,s.useCallback)(e=>{let t=d.findIndex(t=>t.id===e.id);-1!==t&&p(e=>[...e.slice(0,t),...e.slice(t+1)])},[d]),ef=(0,s.useCallback)(()=>{I(void 0),B(void 0)},[]),ew=(0,s.useCallback)(e=>{let t=es.findIndex(t=>t.id===e);-1!==t&&p(e=>[...e.slice(0,t),{id:"0",needCleanup:!0},...e.slice(t+1)])},[es]),ev=(0,s.useCallback)(e=>{let t=es.find(t=>t.id===e);if(!t)return;let l=d.find(t=>t.id===e);l||p(e=>[...e,{...t,visible:!0}]),I((0,i.jsx)(project_panel,{visible:!0,title:"Geometry",onClose:ef,children:(0,i.jsx)(Geometry,{project:{id:$.id,geometries:$.geometries},geometry:{id:t.id,name:t.name,summary:t.summary},swr:{mutateProject:Q,mutateOneGeometry:eu,delOneGeometry:ec},close:ef,onCleanup:ew})}))},[$,es,d,Q,eu,ec,ew,ef]),ej=(0,s.useCallback)(e=>{I((0,i.jsx)(project_panel,{visible:!0,title:"About",onClose:ef,children:(0,i.jsx)(eO.ZP.About,{project:{id:$.id,simulations:$.simulations},simulation:{id:e.id,name:e.name,scheme:e.scheme},swr:{mutateProject:Q,addOneSimulation:en,delOneSimulation:ei,mutateOneSimulation:ea}})}))},[$,Q,en,ei,ea,ef]),eC=(0,s.useCallback)(e=>{I((0,i.jsx)(project_panel,{visible:!0,title:"Geometry",onClose:ef,children:(0,i.jsx)(eO.ZP.Geometry,{loadedGeometries:es,geometries:d.map(e=>({id:e.id,summary:e.summary})),simulation:{id:e.id,scheme:e.scheme},setGeometries:p,swr:{mutateOneSimulation:ea}})}))},[es,d,ea,ef]),eP=(0,s.useCallback)(e=>{I((0,i.jsx)(project_panel,{visible:!0,title:"Parameters",onClose:ef,children:(0,i.jsx)(eO.ZP.Parameters,{simulation:{id:e.id,scheme:e.scheme},swr:{mutateOneSimulation:ea}})}))},[ea,ef]),eM=(0,s.useCallback)(e=>{I((0,i.jsx)(project_panel,{visible:V,title:"Materials",onClose:ef,children:(0,i.jsx)(eO.ZP.Materials,{geometries:d.map(e=>({id:e.id,name:e.name,summary:e.summary})),simulation:{id:e.id,scheme:e.scheme},swr:{mutateOneSimulation:ea},setVisible:X})}))},[d,V,ea,ef]),eS=(0,s.useCallback)(e=>{I((0,i.jsx)(project_panel,{visible:!0,title:"Initialization",onClose:ef,children:(0,i.jsx)(eO.ZP.Initialization,{simulations:el,simulation:e,swr:{mutateOneSimulation:ea}})}))},[el,ea,ef]),ek=(0,s.useCallback)(e=>{I((0,i.jsx)(project_panel,{visible:V,title:"Boundary conditions",onClose:ef,children:(0,i.jsx)(eO.ZP.BoundaryConditions,{geometries:d.map(e=>({id:e.id,name:e.name,summary:e.summary})),simulation:{id:e.id,scheme:e.scheme},swr:{mutateOneSimulation:ea},setVisible:X})}))},[d,V,ea,ef]),eZ=(0,s.useCallback)(e=>{I((0,i.jsx)(project_panel,{visible:V,title:"Run",onClose:ef,children:(0,i.jsx)(eO.ZP.Run,{geometries:d,simulation:{id:e.id,scheme:e.scheme},results:L,setResults:A,setPostprocessing:F,setVisible:X,swr:{mutateOneSimulation:ea}})}))},[d,L,V,ea,ef]),eE=(0,s.useCallback)((e,t)=>{var l,n,i,a,r,o;let s=el.find(t=>t.id===e);if(!s)return;_(s);let d=null===(i=s.scheme)||void 0===i?void 0:null===(n=i.configuration)||void 0===n?void 0:null===(l=n.geometry)||void 0===l?void 0:l.value,c=null===(o=s.scheme)||void 0===o?void 0:null===(r=o.configuration)||void 0===r?void 0:null===(a=r.geometry)||void 0===a?void 0:a.values;if(d){let e=es.find(e=>e.id===d);e&&p([e])}else if(c){let e=es.filter(e=>c.includes(e.id));p(e)}switch(t){case"about":ej(s);break;case"geometry":eC(s);break;case"parameters":eP(s);break;case"materials":eM(s);break;case"initialization":eS(s);break;case"boundaryConditions":ek(s);break;case"run":eZ(s);break;default:I(void 0)}},[es,el,ej,eC,eP,eM,eS,ek,eZ]),e_=(0,s.useCallback)(()=>{(async()=>{await e.push({pathname:"/dashboard",query:{page:t,workspaceId:l}})})()},[e,t,l]),eL=(0,s.useCallback)(e=>{let t,{keyPath:l}=e,n=l.pop(),i=l.pop(),a=l.pop();a&&(t=a.split("&").pop()),B({key:n,id:i,item:t})},[]),eA=(0,s.useCallback)(async e=>{try{await _onSelector($,e.model,{addOneSimulation:en,mutateProject:Q},J),P(!1)}catch(e){}},[$,en,Q,J]),ez=(0,s.useCallback)(e=>{if(ep)return!0;let t=e.value,l=e.values,n=e.multiple,i=e.n;return(!t||!!es.filter(e=>e.id===t).length)&&(!n||!l||(i?es.filter(e=>l.includes(e.id)).length===e.n:!!es.filter(e=>l.includes(e.id)).length))&&(!!t||!!l)||(e.done=!1,!1)},[es,ep]);(0,s.useEffect)(()=>{(async()=>{q||K||await e.replace("/login")})()},[K,q,e]),(0,s.useEffect)(()=>{Y&&J((0,k.iT)({title:eG.user,err:Y})),ee&&J((0,k.iT)({title:eG.project,err:ee})),er&&J((0,k.iT)({title:eG.simulations,err:er})),em&&J((0,k.iT)({title:eG.geometries,err:em}))},[Y,ee,er,em,J]),(0,Z.Z)(()=>{et||ep?r(!1):es.length?r(!1):r(!0)},[et,ep,es]),(0,Z.Z)(()=>{if(!ep){if(d.length){let e=!1,t=d.map(t=>{let l=es.find(e=>e.id===(null==t?void 0:t.id));return l?JSON.stringify({...l,visible:void 0})!==JSON.stringify({...t,visible:void 0})?(e=!0,l):t:(e=!0,null)}).filter(e=>e);e&&p(t)}else p(es[0]?[es[0]]:[])}},[ep,es,d],[p]),(0,Z.Z)(()=>{if(!eo&&M){let e=el.find(e=>e.id===(null==M?void 0:M.id));e?JSON.stringify(e)!==JSON.stringify(M)&&(_(e),U&&U.key===eB.simulations.key&&eE(U.id,U.item)):(ef(),_(void 0))}},[el,eo,M,U],[_,ef]),(0,Z.Z)(()=>{U&&(U.key===eB.geometries.key?ev(U.id):(eE(U.id,U.item),"run"!==U.item&&(A([]),F(void 0))))},[U,V,L],[ev,eE,ef]),(0,s.useEffect)(()=>{!L.length&&R&&F(void 0)},[L,R]);let eD=(0,s.useMemo)(()=>es.map(e=>{let t=d.find(t=>t.id===e.id);return{key:e.id,icon:(0,i.jsx)(x.Z,{}),label:(0,i.jsx)(GeometryLabel,{visible:!!t,geometry:e,panel:G,add:ey,del:eb,close:ef})}}),[es,d,G,ey,eb,ef]),eN=(0,s.useMemo)(()=>el.map(e=>{let t=e.scheme.configuration||{},l=[];return Object.keys(t).forEach(n=>{if("dimension"===n)return;let a=t[n],r=(0,i.jsx)(y.Z,{style:{color:"green"}});a.error?r=(0,i.jsx)(b.Z,{style:{color:"red"}}):a.done||(r=(0,i.jsx)(f.Z,{style:{color:"orange"}})),"geometry"!==n||ez(a)||(r=(0,i.jsx)(f.Z,{style:{color:"orange"}})),l[a.index]={key:e.id+"&"+n,disabled:!d.length,icon:r,label:a.title}}),{key:e.id,icon:(0,i.jsx)(g.Z,{}),label:(0,i.jsx)(SimulationLabel,{simulation:e}),children:[{key:e.id+"&about",disabled:!d.length,icon:(0,i.jsx)(y.Z,{style:{color:"green"}}),label:"About"},...l]}}),[d,el,ez]);return!K||q||et?(0,i.jsx)(E.Z.Simple,{}):"0"===$.id?(0,i.jsx)(notauthorized,{}):(0,i.jsx)(D.ZP,{children:(0,i.jsxs)(u.Z,{hasSider:!0,children:[(0,i.jsxs)(u.Z.Sider,{theme:"light",className:eF().sider,width:256,children:[(0,i.jsx)("div",{className:W().logo,children:(0,i.jsx)("img",{src:"/images/logo.svg",alt:"Tanatloc"})}),(0,i.jsx)(m.default,{className:eF().menu1,mode:"inline",items:[{key:"menu-go-back",disabled:!0,style:{cursor:"unset",margin:"10px 0",paddingLeft:10},label:(0,i.jsx)(z.ks,{className:W().fullWidth,onClick:e_,children:"Return to dashboard"})},{type:"divider"},{key:"title",disabled:!0,className:"Menu-title",label:(0,i.jsx)(h.Z.Paragraph,{ellipsis:{tooltip:!0,rows:2},children:$.title})}]}),(0,i.jsx)("div",{className:eF().menuScroll,children:(0,i.jsx)(m.default,{mode:"inline",className:eF().menu2,defaultOpenKeys:[eB.geometries.key,eB.simulations.key],items:[{key:eB.geometries.key,className:"SubMenu",icon:ep?(0,i.jsx)(w.default,{}):(0,i.jsx)(x.Z,{}),label:(0,i.jsxs)(h.Z.Text,{strong:!0,children:[eB.geometries.label," (",es.length,")"]}),children:[{key:"new_geometry",disabled:!0,label:(0,i.jsx)(c(),{icon:(0,i.jsx)(v.Z,{}),onClick:eh,children:"New Geometry"})},{key:"geometry-needed",disabled:!0,className:d.length?"display-none":"",icon:(0,i.jsx)(f.Z,{style:{color:"red"}}),label:"A Geometry is needed"},...eD]},{key:eB.simulations.key,className:"SubMenu",icon:eo?(0,i.jsx)(w.default,{}):(0,i.jsx)(g.Z,{}),label:(0,i.jsxs)(h.Z.Text,{strong:!0,children:[eB.simulations.label," (",el.length,")"]}),children:[{key:"new_simulation",disabled:!0,label:(0,i.jsx)(c(),{disabled:!es.length,icon:(0,i.jsx)(j.Z,{}),onClick:eg,children:"New Simulation"})},...eN]}],onClick:eL})})]}),(0,i.jsxs)(u.Z.Content,{className:W().noScroll,style:{position:"relative"},children:[(0,i.jsx)(Geometry.Add,{visible:a,project:{id:$.id,geometries:$.geometries},swr:{mutateProject:Q,addOneGeometry:ed},setVisible:r}),(0,i.jsx)(eO.ZP.Selector,{user:{id:K.id,authorizedplugins:K.authorizedplugins,usermodels:K.usermodels},visible:C,onOk:eA,onCancel:ex}),(0,i.jsx)(eO.ZP.Updater,{user:{authorizedplugins:K.authorizedplugins},simulation:M&&{id:M.id,scheme:M.scheme},swr:{mutateOneSimulation:ea}}),G,(0,i.jsx)(view,{project:{id:$.id,title:$.title},simulation:M&&{id:M.id},geometries:d.map(e=>({id:e.id,needCleanup:e.needCleanup})),results:L.map(e=>({name:e.name,glb:e.glb,originPath:e.originPath,extra:e.extra})),postprocessing:R&&{glb:R.glb,originPath:R.originPath}}),(0,i.jsx)(eU,{simulation:M&&{id:M.id,name:M.name}}),(0,i.jsx)(eO.ZP.Postprocessing,{simulation:M&&{id:M.id,scheme:M.scheme},results:L.map(e=>({name:e.name,fileName:e.fileName,originPath:e.originPath})),postprocessing:R&&{name:R.name,fileName:R.fileName},setResult:F})]})]})})}},95361:function(e){e.exports={upload:"add_upload__OHzcC"}},13156:function(e){e.exports={variables:'"@/styles/variables.css"',colorPrimary:"#fad114",sider:"project_sider__KGpqG",menu1:"project_menu1__iUy_z",menuScroll:"project_menuScroll__d4eJz",menu2:"project_menu2__uQFdm"}},95490:function(e){e.exports={variables:'"@/styles/variables.css"',colorPrimary:"#fad114",view:"three_view__K5oK8",head:"three_head___lRMF",unit:"three_unit__SHNbr",content:"three_content__1T_qO",loading:"three_loading__I3n7Q",canvas:"three_canvas__0K2Z4"}}}]);