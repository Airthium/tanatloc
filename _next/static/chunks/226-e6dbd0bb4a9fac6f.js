(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[226],{36444:(e,l,t)=>{"use strict";t.d(l,{V:()=>a,f:()=>i});let a=[{label:"Density",symbol:"Rho",units:[{label:"\\(kg.m^{-3}\\)"}],unit:{label:"\\(kg.m^{-3}\\)"}},{label:"Young's modulus",symbol:"E",units:[{label:"\\(Pa\\)"}],unit:{label:"\\(Pa\\)"}},{label:"Poisson's ratio",symbol:"Nu"},{label:"Thermal conductivity",symbol:"Lambda",units:[{label:"\\(W.m^{-1}.K^{-1}\\)"}],unit:{label:"\\(W.m^{-1}.K^{-1}\\)"}},{label:"Heat capacity",symbol:"Cp",units:[{label:"\\(J.K^{-1}.kg^{-1}\\)"}],unit:{label:"\\(J.K^{-1}.kg^{-1}\\)"}},{label:"Dynamic viscosity",symbol:"Mu",units:[{label:"\\(Pa.s\\)"}],unit:{label:"\\(Pa.s\\)"}}],i={metal:{label:"Metal",children:[{key:"steel",label:"Generic Steel",children:[{label:"Density",symbol:"Rho",value:"7850"},{label:"Young's modulus",symbol:"E",value:"2.1e11"},{label:"Poisson's ratio",symbol:"Nu",value:"0.3"},{label:"Thermal conductivity",symbol:"Lambda",value:"15"},{label:"Heat capacity",symbol:"Cp",value:"502"}]},{key:"S235JR+AR",label:"Steel (S235JR+AR)",children:[{label:"Density",symbol:"Rho",value:"7850"},{label:"Young's modulus",symbol:"E",value:"2.1e11"},{label:"Poisson's ratio",symbol:"Nu",value:"0.27"},{label:"Thermal conductivity",symbol:"Lambda",value:"15"},{label:"Heat capacity",symbol:"Cp",value:"502"}]},{key:"304",label:"Stainless Steel 304",children:[{label:"Density",symbol:"Rho",value:"8000"},{label:"Young's modulus",symbol:"E",value:"193e9"},{label:"Poisson's ratio",symbol:"Nu",value:"0.29"},{label:"Thermal conductivity",symbol:"Lambda",value:"16.2"},{label:"Heat capacity",symbol:"Cp",value:"500"},{label:"Yield strength",symbol:"SigmaY",value:"215e6"}]},{key:"316L",label:"Stainless Steel 316L",children:[{label:"Density",symbol:"Rho",value:"7990"},{label:"Young's modulus",symbol:"E",value:"193e9"},{label:"Poisson's ratio",symbol:"Nu",value:"0.25"},{label:"Thermal conductivity",symbol:"Lambda",value:"16.2"},{label:"Heat capacity",symbol:"Cp",value:"500"},{label:"Yield strength",symbol:"SigmaY",value:"290e6"}]},{key:"6082-O",label:"Aluminium 6082-O",children:[{label:"Density",symbol:"Rho",value:"2700"},{label:"Young's modulus",symbol:"E",value:"69e9"},{label:"Poisson's ratio",symbol:"Nu",value:"0.33"},{label:"Thermal conductivity",symbol:"Lambda",value:"170"},{label:"Heat capacity",symbol:"Cp",value:"960"},{label:"Yield strength",symbol:"SigmaY",value:"60e6"}]},{key:"7075-O",label:"Aluminium 7075-O",children:[{label:"Density",symbol:"Rho",value:"2810"},{label:"Young's modulus",symbol:"E",value:"71.7e9"},{label:"Poisson's ratio",symbol:"Nu",value:"0.33"},{label:"Thermal conductivity",symbol:"Lambda",value:"173"},{label:"Heat capacity",symbol:"Cp",value:"960"},{label:"Yield strength",symbol:"SigmaY",value:"110e6"}]},{key:"2017A",label:"Aluminium 2017A",children:[{label:"Density",symbol:"Rho",value:"2790"},{label:"Young's modulus",symbol:"E",value:"72.5e9"},{label:"Poisson's ratio",symbol:"Nu",value:"0.33"},{label:"Thermal conductivity",symbol:"Lambda",value:"134"},{label:"Heat capacity",symbol:"Cp",value:"873"},{label:"Yield strength",symbol:"SigmaY",value:"275e6"}]}]},polymer:{label:"Polymer",children:[{key:"PMMA",label:"PMMA",children:[{label:"Density",symbol:"Rho",value:"1180"},{label:"Young's modulus",symbol:"E",value:"2.9e9"},{label:"Poisson's ratio",symbol:"Nu",value:"0.36"},{label:"Thermal conductivity",symbol:"Lambda",value:"0.193"},{label:"Heat capacity",symbol:"Cp",value:"1480"},{label:"Yield strength",symbol:"SigmaY",value:"69e6"}]}]},fluid:{label:"Fluid",children:[{key:"water",label:"Water",children:[{label:"Density",symbol:"Rho",value:"1e3"},{label:"Dynamic viscosity",symbol:"Mu",value:"1e-3"},{label:"Thermal conductivity",symbol:"Lambda",value:"0.6"},{label:"Heat capacity",symbol:"Cp",value:"4185"}]}]},contact:{label:"Contact",children:[{key:"fundation",label:"Fundation",children:[]}]}}},83144:(e,l,t)=>{"use strict";t.d(l,{A:()=>i});var a=t(50641);let i={load:async(e,l)=>(await (0,a.T)("/api/result",{method:"POST",headers:{Accept:"application/json"},body:JSON.stringify({simulation:e,result:l})})).json(),download:async(e,l)=>(0,a.T)("/api/result/download",{method:"POST",body:JSON.stringify({simulation:e,result:l})}),archive:async e=>(0,a.T)("/api/result/archive",{method:"POST",body:JSON.stringify({simulation:e})})}},60226:(e,l,t)=>{"use strict";t.d(l,{Ay:()=>tT});var a=t(74848),i=t(96540),n=t(68180),s=t(6385),o=t(75654),r=t(79618),u=t(21807),d=t(65391),c=t(78971),m=t(31379),h=t(80418),y=t(55364),v=t.n(y),p=t(78252),x=t(40889),b=t(83892),g=t(70551),f=t(5602),j=t(67070),A=t(81621),C=t(72620),k=t(58534),w=t(87669),S=t(8331),N=t(8350),E=t(17004),T=t(27353),M=t(43508),O=t(86034),P=t(66188),L=t.n(P);let I={copy:"Unable to copy simulation"},V=async(e,l,t)=>{let a=await k.A.copy(l);await t.addOneSimulation(a),await t.mutateProject({id:e.id,simulations:[...e.simulations,a.id]})},R=e=>{let{project:l,simulation:t,swr:n}=e,[o,r]=(0,i.useState)(!1),{dispatch:u}=(0,i.useContext)(p.V2),d=(0,i.useCallback)(()=>{(0,g.g)(async()=>{r(!0);try{await V(l,t,n)}catch(e){u((0,x.CN)({title:I.copy,err:e}))}finally{r(!1)}})},[l,t,n,u]);return(0,a.jsx)(s.A,{title:"Copy simulation",children:(0,a.jsx)(M.Ay,{className:L().noBorder,loading:o,icon:(0,a.jsx)(O.A,{}),onClick:d})})};var U=t(61580),W=t(26603),_=t(5776);let z={update:"Unable to update simulation"},Y=async(e,l,t)=>{await k.A.update({id:e.id},[{key:"name",value:l.name}]),await t.mutateOneSimulation({id:e.id,name:l.name})},F=e=>{let{simulation:l,swr:t}=e,n=(0,i.useRef)(null),[s,o]=(0,i.useState)(!1),[r,u]=(0,i.useState)(!1),{dispatch:d}=(0,i.useContext)(p.V2);(0,i.useEffect)(()=>{n.current&&n.current.focus()});let c=(0,i.useCallback)(async e=>{u(!0);try{await Y(l,e,t),u(!1),o(!1)}catch(e){throw d((0,x.CN)({title:z.update,err:e})),u(!1),e}},[l,t,d]),m=(0,i.useCallback)(()=>o(!0),[]),h=(0,i.useCallback)(()=>o(!1),[]);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(j.lg,{onEdit:m}),(0,a.jsx)(_.Ay,{title:"Edit the simulation's name",visible:s,initialValues:{name:l.name},onCancel:h,onOk:c,loading:r,children:(0,a.jsx)(U.A.Item,{name:"name",label:"Name:",rules:[{required:!0,message:"Name is required"}],children:(0,a.jsx)(W.A,{ref:n})})})]})},D={del:"Unable to delete simulation"},B=async(e,l,t)=>{await k.A.del(l);let a=e.simulations.filter(e=>e!==l.id);await t.mutateProject({id:e.id,simulations:a}),await t.delOneSimulation({id:l.id})},H=e=>{let{project:l,simulation:t,swr:n}=e,[s,r]=(0,i.useState)(!1),{dispatch:u}=(0,i.useContext)(p.V2),d=(0,i.useCallback)(async()=>{r(!0);try{await B(l,t,n)}catch(e){throw u((0,x.CN)({title:D.del,err:e})),e}finally{r(!1)}},[l,t,n,u]);return(0,a.jsx)(j.et,{loading:s,text:(0,a.jsxs)(a.Fragment,{children:["Are you sure you want to delete the simulation"," ",(0,a.jsx)(o.A.Text,{strong:!0,children:t.name}),"?"]}),onDelete:d})};var G=t(56244),K=t(66533),q=t(22481),Q=t(64716),J=t(69572),Z=t(39729),X=t(72845),$=t(38444);let ee=e=>{let{dimension:l,initialValue:t,additionalKeywords:n,unit:r,units:u,onChange:d,onUnitChange:c}=e,[m,h]=(0,i.useState)(!1),[y,v]=(0,i.useState)(t),[p,x]=(0,i.useState)(),b=(0,i.useMemo)(()=>[{title:"Label",dataIndex:"label",key:"label"},{title:"Keyword",dataIndex:"value",key:"value"}],[]),g=(0,i.useCallback)(()=>h(!0),[]),j=(0,i.useCallback)(()=>h(!1),[]),A=(0,i.useCallback)(e=>{let t=e.target.value;try{x(void 0),(0,$.q)(t,{additionalKeywords:null==n?void 0:n.map(e=>{if(2!==l||!e.only3D)return e.value}).filter(e=>e)})}catch(e){x(e.message)}v(t)},[l,n]),C=(0,i.useCallback)(e=>{let l=e.target.value,t=null==u?void 0:u.find(e=>e.label===l);null==c||c(t)},[u,c]),k=(0,i.useCallback)(async()=>{d({target:{value:y}})},[y,d]);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(s.A,{title:"Complex formula",children:(0,a.jsx)(X.A,{onClick:g})}),(0,a.jsxs)(_.Ay,{title:"Formula",visible:m,initialValues:{formula:t},onOk:k,onCancel:j,children:[(0,a.jsx)(U.A.Item,{extra:(0,a.jsx)("span",{style:{color:"red"},children:p}),style:{marginBottom:0},children:(0,a.jsx)(W.A.TextArea,{value:y,onChange:A,style:p?{borderColor:"red"}:{}})}),u?(0,a.jsx)(U.A.Item,{children:(0,a.jsx)(J.Ay.Group,{value:null==r?void 0:r.label,onChange:C,children:null==u?void 0:u.map(e=>(0,a.jsx)(J.Ay.Button,{value:e.label,children:(0,a.jsx)(f.A.Inline,{text:e.label})},e.label))})}):null,n?(0,a.jsx)(U.A.Item,{children:(0,a.jsx)(G.A,{items:[{key:"additional",label:"Additional keywords",children:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(o.A.Text,{children:"Additional keywods are model-specific keywords, in addition to FreeFEM keywords."}),(0,a.jsx)(Z.A,{pagination:!1,columns:b,dataSource:n.map(e=>({key:e.label,...e})).filter(e=>!(2===l&&e.only3D))})]})}]})}):null]})]})};var el=t(53559),et=t.n(el);let ea=e=>{let{label:l,noLarge:t,className:s,dimension:o,defaultValue:r,defaultChecked:u,additionalKeywords:d,units:c,unit:m,onValueChange:h,onCheckedChange:y,onUnitChange:v}=e,[p,x]=(0,i.useState)(String(null!=r?r:0)),[b,g]=(0,i.useState)(!!u),[j,A]=(0,i.useState)(void 0!==u&&!u),[C,k]=(0,i.useState)(0),[w,S]=(0,i.useState)(!1);(0,i.useEffect)(()=>{x(String(null!=r?r:0))},[r]),(0,i.useEffect)(()=>{g(!!u)},[u]);let N=(0,i.useCallback)(e=>{let l=e.target.checked;g(l),null==y||y(l),A(!l)},[y]),T=(0,i.useCallback)(e=>{C&&clearTimeout(C),k(+setTimeout(()=>{h(e),S(!1)},500))},[C,h]),M=(0,i.useCallback)(e=>{let l=e.target.value;x(l),S(!0),T(l)},[T]),O=(0,i.useCallback)(e=>{let l=null==c?void 0:c.find(l=>l.label===e);null==v||v(l)},[c,v]),P=(0,i.useMemo)(()=>m?c&&c.length>1?(0,a.jsx)(n.A,{className:et().select,options:c.map(e=>({value:e.label,label:(0,a.jsx)(f.A.Inline,{text:e.label})})),onChange:O,value:null==m?void 0:m.label}):(0,a.jsx)(f.A.Inline,{text:m.label}):null,[m,c,O]),I=(0,i.useMemo)(()=>(0,a.jsx)(q.A,{spin:!0,className:L().textOrange}),[]),V=(0,i.useMemo)(()=>t?(0,a.jsx)(Q.A,{className:L().textGreen}):(0,a.jsx)(ee,{dimension:o,initialValue:p,additionalKeywords:d,unit:m,units:c,onChange:M,onUnitChange:v}),[t,o,p,d,m,c,M,v]);return(0,a.jsx)(E.A,{className:"".concat(L().fullWidth," ").concat(et().formula," ").concat(s),style:et(),align:"start",children:(0,a.jsx)(U.A,{layout:"vertical",children:(0,a.jsx)(U.A.Item,{label:(0,a.jsxs)(a.Fragment,{children:[void 0!==u&&(0,a.jsx)(K.A,{checked:b,onChange:N,style:{marginRight:"5px"}}),l]}),children:(0,a.jsx)(W.A,{className:et().input,disabled:j,value:p,onChange:M,addonBefore:w?I:V,addonAfter:P})})})})},ei={manual:{type:"manual",value:1,unit:{label:"m"}},auto:{type:"auto",value:"normal"},factor:{type:"factor",value:1}},en={update:"Unable to update simulation"},es=async(e,l,t,a)=>{let i=C.A.deepCopy(e);i.scheme.configuration.geometry.children[l].meshParameters=t;let n={...i.scheme.configuration.geometry,done:!0};await k.A.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","geometry"],value:n}]),await k.A.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","run"],value:{...i.scheme.configuration.run,done:!1}}]),await a.mutateOneSimulation(i)},eo=e=>{let{simulation:l,index:t,swr:s}=e,[o,r]=(0,i.useState)(ei.auto),{dispatch:u}=(0,i.useContext)(p.V2);(0,i.useEffect)(()=>{let e=l.scheme.configuration.geometry.children[t].meshParameters;e&&r(e)},[l,t]);let d=(0,i.useCallback)(e=>{(0,g.g)(async()=>{try{let a=ei[e];await es(l,t,a,s),r(a)}catch(e){u((0,x.CN)({title:en.update,err:e}))}})},[l,t,s,u]),c=(0,i.useCallback)(e=>{(0,g.g)(async()=>{try{let a={...o,value:e};await es(l,t,a,s),r(a)}catch(e){u((0,x.CN)({title:en.update,err:e}))}})},[l,t,s,o,u]),m=(0,i.useCallback)(e=>{(0,g.g)(async()=>{try{let a={...o,unit:e};await es(l,t,a,s),r(a)}catch(e){u((0,x.CN)({title:en.update,err:e}))}})},[l,t,s,o,u]);return(0,a.jsx)(G.A,{items:[{key:"meshRefinement",label:"Mesh refinement",children:(0,a.jsxs)(S.A,{size:"small",children:[(0,a.jsx)(U.A,{layout:"vertical",children:(0,a.jsx)(U.A.Item,{label:"Type",children:(0,a.jsx)(n.A,{className:L().fullWidth,options:Object.keys(ei).map(e=>({label:e.charAt(0).toUpperCase()+e.slice(1),value:e})),value:o.type,onChange:d})})}),"auto"===o.type&&(0,a.jsx)(U.A,{layout:"vertical",children:(0,a.jsx)(U.A.Item,{label:"Size",children:(0,a.jsx)(n.A,{className:L().fullWidth,options:[{label:"Very fine",value:"veryfine"},{label:"Fine",value:"fine"},{label:"Normal",value:"normal"},{label:"Coarse",value:"coarse"},{label:"Very coarse",value:"verycoarse"}],value:o.value,onChange:c})})}),"manual"===o.type&&(0,a.jsx)(ea,{label:"Size",noLarge:!0,defaultValue:o.value,units:[{label:"m"},{label:"mm",multiplicator:1e3}],unit:o.unit,onValueChange:c,onUnitChange:m}),"factor"===o.type&&(0,a.jsx)(ea,{label:"Size",noLarge:!0,defaultValue:o.value,onValueChange:c})]})}]})},er={update:"Unable to update simulation"},eu=async(e,l,t,a)=>{var i,n;let s=C.A.deepCopy(e);s.scheme.configuration.geometry.children[t].value=l.id;let o={...s.scheme.configuration,dimension:null!==(i=l.summary.dimension)&&void 0!==i?i:3,geometry:{...s.scheme.configuration.geometry,done:!0},run:{...s.scheme.configuration.run,done:!1}},r=s.scheme.configuration.geometry.children.map(e=>e.value);console.log(r);let u=e.scheme.configuration.boundaryConditions,d=!1;for(let e of Object.keys(u))if("index"!==e&&"title"!==e&&"done"!==e){for(let l of null!==(n=u[e].values)&&void 0!==n?n:[])if(r.forEach(e=>{e===l.geometry&&(d=!0)}),!d)break}s.scheme.configuration.boundaryConditions.done=d,await k.A.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration"],value:o}]),await a.mutateOneSimulation(s)},ed=e=>{let{geometries:l,simulation:t,child:s,index:r,setGeometries:u,swr:d}=e,{dispatch:c}=(0,i.useContext)(p.V2),m=(0,i.useMemo)(()=>s.value,[s.value]),h=(0,i.useMemo)(()=>!!l.find(e=>e.id===m),[l,m]),y=(0,i.useMemo)(()=>s.noMeshable,[s.noMeshable]),v=(0,i.useCallback)(e=>{(0,g.g)(async()=>{try{let a=l.find(l=>l.id===e);await eu(t,a,r,d),u([a])}catch(e){c((0,x.CN)({title:er.update,err:e}))}})},[l,t,r,u,d,c]);return(0,i.useEffect)(()=>{l.length&&!m&&v(l[0].id)},[l,m,v]),(0,a.jsxs)(S.A,{size:"small",title:s.label,children:[(0,a.jsxs)(U.A,{layout:"vertical",children:[h?[]:[(0,a.jsx)(o.A.Text,{strong:!0,type:"danger",children:"Geometry does not exists anymore"},"error")],(0,a.jsx)(U.A.Item,{children:(0,a.jsx)(n.A,{placeholder:"Select a simulation domain",options:l.map(e=>({value:e.id,label:e.name})),value:h?m:void 0,onChange:v})})]}),y?null:(0,a.jsx)(eo,{simulation:{id:t.id,scheme:t.scheme},index:r,swr:{mutateOneSimulation:d.mutateOneSimulation}})]})};var ec=t(32632),em=t(22373),eh=t(50549),ey=t(77896);let ev={update:"Unable to delete material"},ep=async(e,l,t)=>{try{let a=C.A.deepCopy(e),i=a.scheme.configuration.materials;i.values=[...i.values.slice(0,l),...i.values.slice(l+1)];let n={...i,done:!!i.values.length};await k.A.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","materials"],value:n}]),await t.mutateOneSimulation(a)}catch(e){throw e}},ex=e=>{let{simulation:l,index:t,swr:n}=e,[s,r]=(0,i.useState)(!1),{dispatch:u}=(0,i.useContext)(p.V2),{dispatch:d}=(0,i.useContext)(eh.CW),c=(0,i.useMemo)(()=>l.scheme.configuration.materials,[l]),m=(0,i.useMemo)(()=>c.values[t],[c,t]),h=(0,i.useMemo)(()=>m.selected,[m.selected]),y=(0,i.useCallback)(async()=>{r(!0);try{await ep(l,t,n),d((0,ey.Lt)(h))}catch(e){throw u((0,x.CN)({title:ev.update,err:e})),e}finally{r(!1)}},[l,t,n,h,d,u]);return(0,a.jsx)(j.et,{loading:s,text:(0,a.jsxs)(a.Fragment,{children:["Are you sure you want to delete the material"," ",(0,a.jsx)(o.A.Text,{strong:!0,children:m.material.label})]}),onDelete:y})};var eb=t(110),eg=t.n(eb);let ef=e=>{let{geometries:l,simulation:t,material:n,index:s,swr:r,_onEdit:u}=e,d=(0,i.useRef)(!1),{dispatch:c}=(0,i.useContext)(eh.CW),m=(0,i.useMemo)(()=>l.find(e=>e.id===n.geometry),[l,n]),h=(0,i.useMemo)(()=>n.selected,[n.selected]),y=(0,i.useMemo)(()=>(null==m?void 0:m.summary.dimension)===2?"faces":"solids",[m]),v=(0,i.useCallback)(()=>{c((0,ey.sS)()),c((0,ey.dv)(y)),c((0,ey.Y0)(null==m?void 0:m.summary.uuid)),c((0,ey.Lt)(h))},[m,h,y,c]),p=(0,i.useCallback)(()=>{d.current||c((0,ey.b8)())},[c]),x=(0,i.useCallback)(()=>{d.current=!0,u(s),setTimeout(()=>d.current=!1,1e3)},[s,u]);return(0,a.jsxs)(S.A,{className:"".concat(L().textAlignCenter," ").concat(eg().listItem),hoverable:!0,onMouseMove:v,onMouseLeave:p,actions:[(0,a.jsx)(j.lg,{onEdit:x},"edit"),(0,a.jsx)(ex,{index:s,simulation:t,swr:r},"delete")],children:[m?null:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(o.A.Text,{type:"danger",strong:!0,children:[(0,a.jsx)(em.A,{})," Geometry not found"]}),(0,a.jsx)("br",{})]}),(0,a.jsx)(o.A.Text,{strong:!0,className:L().textAlignCenter,children:n.material.label})]})},ej=e=>{var l;let{geometries:t,simulation:n,swr:s,onEdit:o}=e;return null===(l=(0,i.useMemo)(()=>n.scheme.configuration.materials,[n]).values)||void 0===l?void 0:l.map((e,l)=>(0,a.jsx)(ef,{geometries:t,simulation:n,material:e,index:l,swr:s,_onEdit:o},e.uuid)).filter(e=>e)};var eA=t(6799),eC=t(18358),ek=t(25264),ew=t(27831),eS=t(14044),eN=t(92701),eE=t(64388),eT=t(59202),eM=t(78745);let eO=(e,l)=>{let t=[...e],a=t.findIndex(e=>e.uuid===l.uuid);return -1===a?t.push(l):t=[...t.slice(0,a),...t.slice(a+1)],t},eP=(e,l)=>[...e,...l].reduce((e,l)=>(e.find(e=>e.uuid===l.uuid)||e.push(l),e),[]),eL=(e,l)=>{let t=[...e];return l.forEach(e=>{let l=t.findIndex(l=>l.uuid===e.uuid);-1!==l&&(t=[...t.slice(0,l),...t.slice(l+1)])}),t},eI=(e,l)=>{let t=[...e];return l.forEach(e=>{let l=t.findIndex(l=>l.uuid===e.uuid);-1===l?t.push(e):t=[...t.slice(0,l),...t.slice(l+1)]}),t},eV=e=>{let{color:l,setFilter:t}=e,n=(0,i.useCallback)(()=>{t(l)},[l,t]);return(0,a.jsx)(s.A,{title:"Color",children:(0,a.jsx)(M.Ay,{style:{backgroundColor:C.A.rgbToHex(l)},icon:(0,a.jsx)(eS.A,{}),onClick:n})})},eR=e=>{let{colors:l,setFilter:t}=e,n=(0,i.useCallback)(()=>{t(void 0)},[t]);return l.length>1&&(0,a.jsxs)(E.A,{direction:"horizontal",wrap:!0,children:[(0,a.jsx)(s.A,{title:"Reset",children:(0,a.jsx)(M.Ay,{icon:(0,a.jsx)(eC.A,{}),onClick:n})}),l.map(e=>(0,a.jsx)(eV,{color:e,setFilter:t},JSON.stringify(e)))]})},eU=e=>{let{element:l,alreadySelected:t,filter:n,search:s,context:o}=e,r=(0,i.useMemo)(()=>{var e,t,a;return(!n||n.r===(null===(e=l.color)||void 0===e?void 0:e.r)&&n.g===(null===(t=l.color)||void 0===t?void 0:t.g)&&n.b===(null===(a=l.color)||void 0===a?void 0:a.b))&&(!s||!l.name||!!l.name.includes(s))},[l,n,s]),u=(0,i.useMemo)(()=>{var e;return o.selected.find(e=>e.uuid===l.uuid)?"#EE9817":(null===(e=o.highlighted)||void 0===e?void 0:e.uuid)===l.uuid?"#FAD114":"transparent"},[l,o]),d=(0,i.useMemo)(()=>{var e;return o.selected.find(e=>e.uuid===l.uuid)?"rgba(238, 152, 23, 0.3)":(null===(e=o.highlighted)||void 0===e?void 0:e.uuid)===l.uuid?"rgba(250, 209, 20, 0.3)":"transparent"},[l,o]),c=(0,i.useCallback)(e=>{o.dispatch((0,ey.Zt)(e))},[o]),m=(0,i.useCallback)(()=>{o.dispatch((0,ey.Zt)())},[o]),h=(0,i.useCallback)(e=>{let l=eO(o.selected,e);o.dispatch((0,ey.Lt)(l))},[o]),y=(0,i.useCallback)(()=>c({uuid:l.uuid,label:l.label}),[l,c]),v=(0,i.useCallback)(()=>h({uuid:l.uuid,label:l.label}),[l,h]);return r?(0,a.jsx)(S.A,{style:{marginBottom:"10px"},styles:{body:{position:"relative",padding:"10px 10px 10px 40px",borderWidth:"2px",borderStyle:"solid",borderColor:u,backgroundColor:d}},onMouseEnter:y,onMouseLeave:m,onClick:v,children:(0,a.jsxs)(E.A,{direction:"vertical",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{style:{position:"absolute",left:"-2px",top:"-2px",bottom:"-2px",width:"30px",backgroundColor:C.A.rgbToRgba(l.color,1)}}),l.name]}),null==t?void 0:t.map(e=>{if(e.selected.find(e=>e.uuid===l.uuid))return(0,a.jsx)(ew.A,{color:C.A.stringToColor(e.label),children:e.label},l.uuid+e.label)})]})}):null},eW=e=>{var l;let{geometry:t,alreadySelected:n,updateSelected:r}=e,[u,d]=(0,i.useState)(),[c,m]=(0,i.useState)(),{type:h,highlighted:y,selected:v,dispatch:p}=(0,i.useContext)(eh.CW);(0,b.A)(()=>r(v),[v],[r]);let x=(0,i.useMemo)(()=>{var e;let l=[];return h&&(null===(e=t.summary[h])||void 0===e||e.forEach(e=>{e.color&&!l.find(l=>l.r===e.color.r&&l.g===e.color.g&&l.b===e.color.b)&&l.push(e.color)})),l},[t,h]),g=(0,i.useCallback)(()=>{var e,l;let a=eP(v,null!==(l=null===(e=t.summary[h])||void 0===e?void 0:e.map(e=>{var l,t,a;if(!u||u&&u.r===(null===(l=e.color)||void 0===l?void 0:l.r)&&u.g===(null===(t=e.color)||void 0===t?void 0:t.g)&&u.b===(null===(a=e.color)||void 0===a?void 0:a.b))return{uuid:e.uuid,label:e.label}}).filter(e=>e))&&void 0!==l?l:[]);p((0,ey.Lt)(a))},[t,h,v,u,p]),f=(0,i.useCallback)(()=>{var e,l;let a=eL(v,null!==(l=null===(e=t.summary[h])||void 0===e?void 0:e.map(e=>{var l,t,a;if(!u||u&&u.r===(null===(l=e.color)||void 0===l?void 0:l.r)&&u.g===(null===(t=e.color)||void 0===t?void 0:t.g)&&u.b===(null===(a=e.color)||void 0===a?void 0:a.b))return{uuid:e.uuid,label:e.label}}).filter(e=>e))&&void 0!==l?l:[]);p((0,ey.Lt)(a))},[t,h,v,u,p]),j=(0,i.useCallback)(()=>{var e,l;let a=eI(v,null!==(l=null===(e=t.summary[h])||void 0===e?void 0:e.map(e=>{var l,t,a;if(!u||u&&u.r===(null===(l=e.color)||void 0===l?void 0:l.r)&&u.g===(null===(t=e.color)||void 0===t?void 0:t.g)&&u.b===(null===(a=e.color)||void 0===a?void 0:a.b))return{uuid:e.uuid,label:e.label}}).filter(e=>e))&&void 0!==l?l:[]);p((0,ey.Lt)(a))},[t,h,v,u,p]),A=(0,i.useCallback)(e=>{m(e.target.value)},[]);return(0,a.jsxs)(S.A,{size:"small",className:L().noBorderBottom,children:[(0,a.jsxs)(E.A,{direction:"vertical",className:L().fullWidth,children:[(0,a.jsx)(o.A.Text,{strong:!0,children:"Filters"}),(0,a.jsxs)(E.A,{direction:"horizontal",wrap:!0,children:[(0,a.jsx)(eR,{colors:x,setFilter:d}),(0,a.jsx)(s.A,{title:"Select all",children:(0,a.jsx)(M.Ay,{icon:(0,a.jsx)(eN.A,{}),onClick:g})}),(0,a.jsx)(s.A,{title:"Unselect all",children:(0,a.jsx)(M.Ay,{icon:(0,a.jsx)(eE.A,{}),onClick:f})}),(0,a.jsx)(s.A,{title:"Swap",children:(0,a.jsx)(M.Ay,{icon:(0,a.jsx)(eT.A,{}),onClick:j})})]}),(0,a.jsx)(W.A,{placeholder:"Search",value:c,onChange:A,suffix:(0,a.jsx)(eM.A,{className:L().textLight})})]}),(0,a.jsx)("div",{className:L().fullWidth,style:{marginTop:"20px"},children:h?null===(l=t.summary[h])||void 0===l?void 0:l.map(e=>(0,a.jsx)(eU,{element:e,alreadySelected:n,filter:u,search:c,context:{selected:v,highlighted:y,dispatch:p}},e.uuid)):null})]})};var e_=t(83902),ez=t(87522),eY=t(36444);let eF=e=>{let{onSelect:l}=e,[t,n]=(0,i.useState)(),[s,o]=(0,i.useState)(),[d,m]=(0,i.useState)(),[h,y]=(0,i.useState)(),v=(0,i.useMemo)(()=>Object.keys(eY.f),[]),p=(0,i.useCallback)(()=>n(!0),[]),x=(0,i.useCallback)(()=>n(!1),[]),b=(0,i.useCallback)(e=>{let{key:l}=e,t=eY.f[l];o({key:l,children:t.children}),m(void 0),y(void 0)},[]),g=(0,i.useCallback)(e=>{let{key:l}=e,t=eY.f[s.key].children.find(e=>e.key===l);m({key:l}),y(t)},[s]),f=(0,i.useCallback)(()=>{l(h),n(!1)},[h,l]);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(M.Ay,{icon:(0,a.jsx)(ez.A,{}),onClick:p,className:L().fullWidth,children:"Pick a material"}),(0,a.jsx)(r.A,{open:t,title:"Material database",onCancel:x,onOk:f,okText:"Choose",okButtonProps:{disabled:!h},width:"80%",children:(0,a.jsx)(u.A,{children:(0,a.jsx)(u.A.Content,{children:(0,a.jsxs)(E.A,{className:L().fullWidth,style:{alignItems:"stretch",gap:"20px"},children:[(0,a.jsx)(c.A,{mode:"inline",items:v.map(e=>({key:e,label:eY.f[e].label})),onClick:b}),(0,a.jsx)(c.A,{mode:"inline",items:null==s?void 0:s.children.map(e=>({key:e.key,label:e.label})),selectedKeys:(null==d?void 0:d.key)?[null==d?void 0:d.key]:[],onClick:g}),h&&(0,a.jsx)(e_.A,{itemLayout:"vertical",style:{paddingLeft:"20px"},children:h.children.map(e=>(0,a.jsxs)(e_.A.Item,{children:[e.label,": ",e.symbol," = ",e.value]},e.label))})]})})})})]})};var eD=t(21303);let eB={material:"You need to define a material",selected:"You need to select a solid",update:"Unable to add material"},eH=async(e,l,t)=>{var a;let i=C.A.deepCopy(l);i.uuid=(0,eD.A)();let n=C.A.deepCopy(e),s=n.scheme.configuration.materials;s.values=[...null!==(a=s.values)&&void 0!==a?a:[],i];let o={...s,done:!0};await k.A.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","materials"],value:o}]),await k.A.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","run"],value:{...n.scheme.configuration.run,done:!1}}]),await t.mutateOneSimulation(n)},eG=e=>{let{simulation:l,material:t,swr:n,onError:s,onClose:o}=e,[r,u]=(0,i.useState)(!1),{dispatch:d}=(0,i.useContext)(p.V2),c=(0,i.useCallback)(()=>{(0,g.g)(async()=>{u(!0);try{var e;if(!t.material){s(eB.material),u(!1);return}if(!(null===(e=t.selected)||void 0===e?void 0:e.length)){s(eB.selected),u(!1);return}s(),await eH(l,t,n),u(!1),o()}catch(e){d((0,x.CN)({title:eB.update,err:e})),u(!1)}})},[l,t,n,s,o,d]);return(0,a.jsx)(j.M3,{loading:r,needMargin:!0,onAdd:c,children:"Add"})},eK={uuid:"UUID not defined on material",material:"You need to define a material",selected:"You need to select a solid",update:"Unable to edit material"},eq=async(e,l,t)=>{let a=C.A.deepCopy(e),i=a.scheme.configuration.materials,n=i.values.findIndex(e=>e.uuid===l.uuid);i.values=[...i.values.slice(0,n),l,...i.values.slice(n+1)];let s={...i};await k.A.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","materials"],value:s}]),await t.mutateOneSimulation(a)},eQ=e=>{let{simulation:l,material:t,swr:n,onError:s,onClose:o}=e,[r,u]=(0,i.useState)(!1),{dispatch:d}=(0,i.useContext)(p.V2),c=(0,i.useCallback)(()=>{(0,g.g)(async()=>{u(!0);try{var e;if(!t.uuid){s(eK.uuid),u(!1);return}if(!t.material){s(eK.material),u(!1);return}if(!(null===(e=t.selected)||void 0===e?void 0:e.length)){s(eK.selected),u(!1);return}s(),await eq(l,t,n),u(!1),o()}catch(e){d((0,x.CN)({title:eK.update,err:e})),u(!1)}})},[l,t,n,s,o,d]);return(0,a.jsx)(j.lg,{loading:r,primary:!0,needMargin:!0,onEdit:c,children:"Edit"})};var eJ=t(38949),eZ=t.n(eJ);let eX=e=>{let{simulation:l,dimension:t,material:n,child:s,index:o,_onMaterialChange:r,_onUnitChange:u}=e,d=(0,i.useMemo)(()=>l.scheme.variables,[l.scheme.variables]),c=(0,i.useMemo)(()=>null==n?void 0:n.value,[n]),m=(0,i.useMemo)(()=>null==n?void 0:n.unit,[n]),h=(0,i.useCallback)(e=>{r(s,o,e)},[s,o,r]),y=(0,i.useCallback)(e=>{u(o,e)},[o,u]);return(0,a.jsx)(ea,{dimension:t,label:s.name,defaultValue:null!=c?c:String(s.default),additionalKeywords:d,units:s.units,unit:null!=m?m:s.unit,onValueChange:h,onUnitChange:y})},e$=e=>{var l,t;let{geometries:n,simulation:s,value:r,swr:u,onClose:c}=e,[m,h]=(0,i.useState)(),[y,v]=(0,i.useState)(),[p,x]=(0,i.useState)(),[b,g]=(0,i.useState)(),[f,A]=(0,i.useState)(),[C,k]=(0,i.useState)(),{dispatch:w}=(0,i.useContext)(eh.CW),N=(0,i.useMemo)(()=>s.scheme.configuration.materials,[s]),T=(0,i.useMemo)(()=>{var e,l;return null!==(l=null===(e=N.values)||void 0===e?void 0:e.map(e=>{if(e.uuid!==m)return{label:e.material.label,selected:e.selected}}).filter(e=>e))&&void 0!==l?l:[]},[N,m]),O=(0,i.useCallback)(e=>{v(e)},[]),P=(0,i.useCallback)((e,l,t)=>{v({label:"Custom",children:[...y.children.slice(0,l),{...null==y?void 0:y.children[l],label:e.label,symbol:e.name,value:t},...y.children.slice(l+1)]})},[y]),I=(0,i.useCallback)((e,l)=>{v({...y,children:[...y.children.slice(0,e),{...y.children[e],unit:l},...y.children.slice(e+1)]})},[y]),V=(0,i.useCallback)(e=>{A(e)},[]),R=(0,i.useCallback)(e=>{let l=n.find(l=>l.id===e);x(l);let t=l.summary.dimension;g(t),w((0,ey.sS)()),w((0,ey.dv)(2===t?"faces":"solids")),w((0,ey.Y0)(l.summary.uuid))},[n,w]),U=(0,i.useCallback)(()=>{c(),w((0,ey.b8)())},[c,w]);return(0,i.useEffect)(()=>{var e;m||h(null!==(e=null==r?void 0:r.uuid)&&void 0!==e?e:"add")},[r,m]),(0,i.useEffect)(()=>{var e;p||R(null!==(e=null==r?void 0:r.geometry)&&void 0!==e?e:n[0].id)},[n,r,p,R]),(0,i.useEffect)(()=>{var e;y||v(null!==(e=null==r?void 0:r.material)&&void 0!==e?e:{label:"Default",children:N.children.map(e=>({label:e.label,symbol:e.name,value:e.default}))})},[r,N,y]),(0,a.jsx)(eA.A,{className:eZ().subPanel,title:"Material",placement:"left",closable:!1,open:!0,mask:!1,maskClosable:!1,width:300,extra:(0,a.jsx)(M.Ay,{type:"text",icon:(0,a.jsx)(eC.A,{}),onClick:U}),footer:(0,a.jsxs)("div",{style:{display:"flex",justifyContent:"flex-end"},children:[(0,a.jsx)(j.Zb,{onCancel:U}),r?(0,a.jsx)(eQ,{material:{uuid:m,material:y,geometry:null==p?void 0:p.id,selected:f},simulation:s,swr:u,onError:k,onClose:U}):(0,a.jsx)(eG,{material:{uuid:m,material:y,geometry:null==p?void 0:p.id,selected:f},simulation:s,swr:u,onError:k,onClose:U})]}),children:(0,a.jsxs)(E.A,{direction:"vertical",className:L().fullWidth,children:[(0,a.jsx)(S.A,{size:"small",children:(0,a.jsxs)(E.A,{direction:"vertical",className:L().fullWidth,children:[(0,a.jsx)(eF,{onSelect:O}),(0,a.jsxs)(o.A.Text,{children:["Material: ",null!==(t=null==y?void 0:y.label)&&void 0!==t?t:"default"]}),null==N?void 0:null===(l=N.children)||void 0===l?void 0:l.map((e,l)=>{var t;let i=null==y?void 0:null===(t=y.children)||void 0===t?void 0:t.find(l=>l.symbol===e.name);return(0,a.jsx)(eX,{simulation:s,dimension:b,material:i,child:e,index:l,_onMaterialChange:P,_onUnitChange:I},e.name)})]})}),(0,a.jsx)(d.A,{items:n.map(e=>({key:e.id,label:e.name,children:(0,a.jsx)(eW,{geometry:e,alreadySelected:T,updateSelected:V})})),activeKey:null==p?void 0:p.id,onChange:R}),C&&(0,a.jsxs)(o.A.Text,{children:[(0,a.jsx)(ek.A,{style:{color:"red"}})," ",C]})]})})},e0={update:"Unable to update simulation"},e1=(e,l,t,i,n)=>{var s,o;return(0,a.jsx)(ea,{dimension:2,label:null!==(s=t.label2D)&&void 0!==s?s:t.label,defaultValue:null!==(o=t.value)&&void 0!==o?o:t.default,additionalKeywords:l,onValueChange:i,onUnitChange:n,units:t.units,unit:t.unit},e)},e2=(e,l,t)=>{var i,s,o,r;return(0,a.jsx)(U.A,{layout:"vertical",children:(0,a.jsx)(U.A.Item,{label:null!==(s=l.label2D)&&void 0!==s?s:l.label,children:(0,a.jsx)(n.A,{options:null===(i=l.options)||void 0===i?void 0:i.map(e=>{var l;return{label:e.label,value:null!==(l=e.value2D)&&void 0!==l?l:e.value}}),defaultValue:null!==(r=null!==(o=l.value)&&void 0!==o?o:l.default2D)&&void 0!==r?r:l.default,onChange:t})})},e)},e3=(e,l,t)=>{var i,n;return(0,a.jsx)(U.A,{layout:"horizontal",children:(0,a.jsx)(U.A.Item,{label:null!==(i=l.label2D)&&void 0!==i?i:l.label,children:(0,a.jsx)(K.A,{defaultChecked:null!==(n=l.value)&&void 0!==n?n:l.default,onChange:t})})},e)},e5=(e,l,t,i,n)=>{var s;return(0,a.jsx)(ea,{dimension:3,label:t.label,defaultValue:null!==(s=t.value)&&void 0!==s?s:t.default,additionalKeywords:l,units:t.units,unit:t.unit,onValueChange:i,onUnitChange:n},e)},e8=(e,l,t)=>{var i;return(0,a.jsx)(U.A,{layout:"vertical",children:(0,a.jsx)(U.A.Item,{label:l.label,children:(0,a.jsx)(n.A,{options:l.options,defaultValue:null!==(i=l.value)&&void 0!==i?i:l.default,onChange:t})})},e)},e4=(e,l,t)=>{var i;return(0,a.jsx)(U.A,{layout:"horizontal",children:(0,a.jsx)(U.A.Item,{label:l.label,children:(0,a.jsx)(K.A,{defaultChecked:null!==(i=l.value)&&void 0!==i?i:l.default,onChange:t})})},e)},e7=(e,l,t)=>{var i;return(0,a.jsx)(U.A,{layout:"vertical",children:(0,a.jsx)(U.A.Item,{label:l.label,children:(0,a.jsx)(J.Ay.Group,{options:l.options,defaultValue:null!==(i=l.value)&&void 0!==i?i:l.default,onChange:t})})},e)},e6=async(e,l)=>{let t=C.A.deepCopy(e),a={...t.scheme.configuration.parameters,done:!0};await k.A.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","parameters"],value:a}]),await k.A.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","run"],value:{...t.scheme.configuration.run,done:!1}}]),await l.mutateOneSimulation(t)},e9=async(e,l,t,a,i)=>{let n=C.A.deepCopy(e),s=n.scheme.configuration.parameters;s[l].children[t].value=a;let o={...s};await k.A.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","parameters"],value:o}]),await k.A.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","run"],value:{...n.scheme.configuration.run,done:!1}}]),await i.mutateOneSimulation(n)},le=async(e,l,t,a,i)=>{let n=C.A.deepCopy(e),s=n.scheme.configuration.parameters;s[l].children[t].unit=a;let o={...s};await k.A.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","parameters"],value:o}]),await k.A.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","run"],value:{...n.scheme.configuration.run,done:!1}}]),await i.mutateOneSimulation(n)},ll=e=>{let{variables:l,child:t,pkey:a,index:i,onChange:n,onChangeEvent:s,onUnitChange:o}=e;if(t.only3D);else if("formula"===t.htmlEntity)return e1(a+"&"+i,l,t,n,o);else if("select"===t.htmlEntity)return e2(a+"&"+i,t,n);else if("checkbox"===t.htmlEntity)return e3(a+"&"+i,t,s);return null},lt=e=>{let{variables:l,child:t,pkey:a,index:i,onChange:n,onChangeEvent:s,onUnitChange:o}=e;return"formula"===t.htmlEntity?e5(a+"&"+i,l,t,n,o):"select"===t.htmlEntity?e8(a+"&"+i,t,n):"checkbox"===t.htmlEntity?e4(a+"&"+i,t,s):"radio"===t.htmlEntity?e7(a+"&"+i,t,s):null},la=e=>{let{simulation:l,dimension:t,child:n,pkey:s,index:o,swr:r}=e,{dispatch:u}=(0,i.useContext)(p.V2),d=(0,i.useMemo)(()=>l.scheme.variables,[l]),c=(0,i.useCallback)(e=>{(0,g.g)(async()=>{try{await e9(l,s,o,e,r)}catch(e){u((0,x.CN)({title:e0.update,err:e}))}})},[l,s,o,r,u]),m=(0,i.useCallback)(e=>{(0,g.g)(async()=>{try{await le(l,s,o,e,r)}catch(e){u((0,x.CN)({title:e0.update,err:e}))}})},[l,s,o,r,u]),h=(0,i.useCallback)(e=>{(0,g.g)(async()=>{try{await e9(l,s,o,e.target.checked,r)}catch(e){u((0,x.CN)({title:e0.update,err:e}))}})},[l,s,o,r,u]);return n.hidden?null:2===t?(0,a.jsx)(ll,{variables:d,child:n,pkey:s,index:o,onChange:c,onChangeEvent:h,onUnitChange:m}):(0,a.jsx)(lt,{variables:d,child:n,pkey:s,index:o,onChange:c,onChangeEvent:h,onUnitChange:m})},li=e=>{let{simulation:l,dimension:t,pkey:n,parameter:s,swr:o}=e,r=(0,i.useMemo)(()=>s.children.map((e,i)=>(0,a.jsx)(la,{simulation:l,dimension:t,child:e,pkey:n,index:i,swr:o},n+"&"+e.label)),[l,t,n,s,o]);return(0,a.jsx)(S.A,{size:"small",title:null==s?void 0:s.label,children:(0,a.jsx)(E.A,{direction:"vertical",children:r})},n)},ln=(e,l)=>{let t=[];t=Array.isArray(l.pattern)?l.pattern.map(e=>new RegExp(e)):[new RegExp(l.pattern)];let a=[],i=[];return e.forEach(e=>{0===t.map(l=>l.test(e.fileName)).reduce((e,l)=>+e+ +l,0)?i.push(e):a.push(e)}),{notFilteredFiles:i,filteredFiles:a}},ls=(e,l)=>{let t=[];t=Array.isArray(l.prefixPattern)?l.prefixPattern.map(e=>new RegExp(e)):[new RegExp(l.prefixPattern)];let a=[];return a=Array.isArray(l.suffixPattern)?l.suffixPattern.map(e=>new RegExp(e)):[new RegExp(l.suffixPattern)],e.map(e=>{let l=e.fileName;return t.forEach(e=>l=l.replace(e,"")),a.forEach(e=>l=l.replace(e,"")),{...e,number:+l}})},lo=(e,l)=>{let t=l.multiplicator;if(t){var a;let l=t.reduce((e,l)=>e[l],e);return null!==(a=l.value)&&void 0!==a?a:l.default}},lr={update:"Unable to update simulation"},lu=async(e,l,t)=>{let a=C.A.deepCopy(e),i=a.scheme.configuration.initialization;i.value={type:l},await k.A.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","initialization"],value:i}]),await t.mutateOneSimulation(a)},ld=async(e,l,t,a)=>{var i;let n=await ly(e,t),s=C.A.deepCopy(l),o=s.scheme.configuration.initialization;o.value={...o.value,simulation:t,result:null==n?void 0:null===(i=n[0])||void 0===i?void 0:i.value},await k.A.update({id:l.id},[{key:"scheme",type:"json",method:"set",path:["configuration","initialization"],value:o}]),await a.mutateOneSimulation(s)},lc=async(e,l,t,a)=>{let i=C.A.deepCopy(e),n=i.scheme.configuration.initialization;n.value={...n.value,number:+l,result:t.file},await k.A.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","initialization"],value:n}]),await a.mutateOneSimulation(i)},lm=async(e,l,t,a)=>{let i=C.A.deepCopy(e),n=i.scheme.configuration.initialization;n.value.values||(n.value.values=[]),n.value.values[l]=t,await k.A.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","initialization"],value:n}]),await a.mutateOneSimulation(i)},lh=(e,l)=>{let{filteredFiles:t,notFilteredFiles:a}=ln(e,l);return{filteredFiles:ls(t,l).map(e=>{let t=[];t=Array.isArray(l.suffixPattern)?l.suffixPattern.map(e=>new RegExp(e)):[new RegExp(l.suffixPattern)];let a=e.fileName;return t.forEach(e=>a=a.replace(e,"")),{number:e.number,fileName:a}}).filter((e,l,t)=>t.findIndex(l=>l.number===e.number)===l).sort((e,l)=>e.number-l.number),notFilteredFiles:a}},ly=async(e,l)=>{var t;let a=await k.A.tasks({id:l}),i=e.find(e=>e.id===l).scheme.configuration,n=null==i?void 0:null===(t=i.run)||void 0===t?void 0:t.resultsFilter,s=[];return a.forEach(e=>{if(e.file&&"result"===e.file.type&&s.push({label:e.file.fileName,value:e.file.fileName,file:e.file.fileName}),e.files){if(n){let{filteredFiles:l,notFilteredFiles:t}=lh(e.files,n),a=lo(i,n),o=l.map((e,l)=>({label:String(Math.round(1e15*(a?e.number*a:l))/1e15),value:e.fileName,file:e.fileName}));s.push(...t.map(e=>({label:e.fileName,value:e.fileName,file:e.fileName})).filter(e=>e)),s.push(...o)}else e.files.forEach(e=>{"result"===e.type&&s.push({label:e.fileName,value:e.fileName,file:e.fileName})})}}),s},lv=e=>{let{simulation:l,child:t,index:n,value:s,swr:o,dispatch:r}=e,u=(0,i.useCallback)(e=>{(0,g.g)(async()=>{try{await lm(l,n,e,o)}catch(e){r((0,x.CN)({title:lr.update,err:e}))}})},[l,n,o,r]);return(0,a.jsx)(ea,{label:t.label,defaultValue:(null!=s?s:t.default).toString(),units:t.units,unit:t.unit,onValueChange:u})},lp={update:"Unable to delete boundary condition"},lx=async(e,l,t,a)=>{let i=C.A.deepCopy(e),n=i.scheme.configuration.boundaryConditions,s=n[l];s.values=[...s.values.slice(0,t),...s.values.slice(t+1)];let o=!1;Object.keys(n).forEach(e=>{var l;"index"!==e&&"title"!==e&&"done"!==e&&(null===(l=n[e].values)||void 0===l?void 0:l.length)&&(o=!0)});let r={...n,done:o};await k.A.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","boundaryConditions"],value:r}]),await a.mutateOneSimulation(i)},lb=e=>{let{type:l,index:t,simulation:n,swr:s}=e,[r,u]=(0,i.useState)(!1),{dispatch:d}=(0,i.useContext)(eh.CW),{dispatch:c}=(0,i.useContext)(p.V2),m=(0,i.useMemo)(()=>n.scheme.configuration.boundaryConditions,[n]),h=(0,i.useMemo)(()=>m[l],[m,l]),y=(0,i.useMemo)(()=>h.values[t],[h,t]),v=(0,i.useCallback)(async()=>{u(!0);try{await lx(n,l,t,s),d((0,ey.Lt)(y.selected))}catch(e){throw c((0,x.CN)({title:lp.update,err:e})),e}finally{u(!1)}},[n,l,t,s,y,d,c]);return(0,a.jsx)(j.et,{loading:r,onDelete:v,text:(0,a.jsxs)(a.Fragment,{children:["Are you sure you want to delete the condition"," ",(0,a.jsx)(o.A.Text,{strong:!0,children:null==y?void 0:y.name}),"?"]})})},lg=e=>{let{geometries:l,simulation:t,boundaryCondition:n,index:s,type:r,swr:u,_onEdit:d}=e,c=(0,i.useRef)(!1),{dispatch:m}=(0,i.useContext)(eh.CW),h=(0,i.useMemo)(()=>l.find(e=>e.id===n.geometry),[l,n]),y=(0,i.useMemo)(()=>n.selected,[n.selected]),v=(0,i.useMemo)(()=>(null==h?void 0:h.summary.dimension)===2?"edges":"faces",[h]),p=(0,i.useCallback)(()=>{m((0,ey.sS)()),m((0,ey.dv)(v)),m((0,ey.Y0)(null==h?void 0:h.summary.uuid)),m((0,ey.Lt)(y))},[h,y,v,m]),x=(0,i.useCallback)(()=>{c.current||m((0,ey.b8)())},[m]),b=(0,i.useCallback)(()=>{c.current=!0,d(r,s),setTimeout(()=>c.current=!1,1e3)},[s,r,d]);return(0,a.jsxs)(S.A,{className:"".concat(L().textAlignCenter," ").concat(eg().listItem),hoverable:!0,onMouseMove:p,onMouseLeave:x,actions:[(0,a.jsx)(j.lg,{onEdit:b},"edit"),(0,a.jsx)(lb,{simulation:t,type:r,index:s,swr:u},"delete")],children:[h?null:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(o.A.Text,{type:"danger",strong:!0,children:[(0,a.jsx)(em.A,{})," Geometry not found"]}),(0,a.jsx)("br",{})]}),(0,a.jsx)(o.A.Text,{strong:!0,className:L().textAlignCenter,children:n.name})," ",(0,a.jsxs)(o.A.Text,{children:["(",n.type.label,")"]})]})},lf=e=>{let{geometries:l,simulation:t,swr:n,onEdit:s}=e,o=(0,i.useMemo)(()=>t.scheme.configuration.boundaryConditions,[t]);return(0,a.jsx)(a.Fragment,{children:Object.keys(o).map(e=>{var i;if("index"!==e&&"title"!==e&&"done"!==e)return null===(i=o[e].values)||void 0===i?void 0:i.map((i,o)=>(0,a.jsx)(lg,{geometries:l,simulation:t,boundaryCondition:i,index:o,type:e,swr:n,_onEdit:s},i.uuid))}).filter(e=>e)})},lj={name:"You need to define a name",type:"You need to select a type",selected:"You need to select a face",update:"Unable to add boundary condition"},lA=async(e,l,t)=>{var a;let i={...l},n=i.type.key;i.uuid=(0,eD.A)();let s=C.A.deepCopy(e),o=s.scheme.configuration.boundaryConditions,r=o[n];r.values=[...null!==(a=r.values)&&void 0!==a?a:[],i];let u={...o,done:!0};await k.A.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","boundaryConditions"],value:u}]),await k.A.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","run"],value:{...s.scheme.configuration.run,done:!1}}]),await t.mutateOneSimulation(s)},lC=e=>{let{simulation:l,boundaryCondition:t,swr:n,onError:s,onClose:o}=e,[r,u]=(0,i.useState)(!1),{dispatch:d}=(0,i.useContext)(p.V2),c=(0,i.useCallback)(()=>{(0,g.g)(async()=>{u(!0);try{var e,a;if(!t.name){s(lj.name),u(!1);return}if(!(null===(e=t.type)||void 0===e?void 0:e.key)){s(lj.type),u(!1);return}if(!(null===(a=t.selected)||void 0===a?void 0:a.length)){s(lj.selected),u(!1);return}s(),await lA(l,t,n),u(!1),o()}catch(e){d((0,x.CN)({title:lj.update,err:e})),u(!1)}})},[l,t,n,s,o,d]);return(0,a.jsx)(j.M3,{loading:r,onAdd:c,needMargin:!0,children:"Add"})},lk={name:"You need to define a name",type:"You need to select a type",selected:"You need to select a face",update:"Unable to edit boundary condition"},lw=async(e,l,t,a)=>{let i=C.A.deepCopy(e),n=i.scheme.configuration.boundaryConditions,s=l.type.key,o=t.type.key;if(o!==s){let e=n[o],l=e.values.findIndex(e=>e.uuid===t.uuid);e.values=[...e.values.slice(0,l),...e.values.slice(l+1)]}if(o!==s){var r;let e=n[s];e.values=[...null!==(r=e.values)&&void 0!==r?r:[],l]}else{let e=n[s],t=e.values.findIndex(e=>e.uuid===l.uuid);e.values=[...e.values.slice(0,t),l,...e.values.slice(t+1)]}let u={...n};await k.A.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","boundaryConditions"],value:u}]),await a.mutateOneSimulation(i)},lS=e=>{let{simulation:l,boundaryCondition:t,oldBoundaryCondition:n,swr:s,onError:o,onClose:r}=e,[u,d]=(0,i.useState)(!1),{dispatch:c}=(0,i.useContext)(p.V2),m=(0,i.useCallback)(()=>{(0,g.g)(async()=>{d(!0);try{var e,a;if(!t.name){o(lk.name),d(!1);return}if(!(null===(e=t.type)||void 0===e?void 0:e.key)){o(lk.type),d(!1);return}if(!(null===(a=t.selected)||void 0===a?void 0:a.length)){o(lk.selected),d(!1);return}o(),await lw(l,t,n,s),d(!1),r()}catch(e){c((0,x.CN)({title:lk.update,err:e})),d(!1)}})},[l,t,n,s,o,r,c]);return(0,a.jsx)(j.lg,{loading:u,onEdit:m,primary:!0,needMargin:!0,children:"Edit"})},lN=e=>{let{simulation:l,dimension:t,values:n,child:s,index:o,_onValueChange:r,_onCheckedChange:u,_onUnitChange:d}=e,c=(0,i.useMemo)(()=>l.scheme.variables,[l.scheme.variables]),m=(0,i.useMemo)(()=>n[o].value,[n,o]),h=(0,i.useMemo)(()=>n.length>1?n[o].checked:void 0,[n,o]),y=(0,i.useMemo)(()=>{var e;return null!==(e=n[o].unit)&&void 0!==e?e:s.unit},[n,o,s]),v=(0,i.useCallback)(e=>r(o,e),[o,r]),p=(0,i.useCallback)(e=>u(o,e),[o,u]),x=(0,i.useCallback)(e=>d(o,e),[o,d]);return(0,a.jsx)(ea,{dimension:t,label:s.label,defaultValue:null!=m?m:String(s.default),defaultChecked:h,additionalKeywords:c,units:s.units,unit:y,onValueChange:v,onCheckedChange:p,onUnitChange:x})},lE=e=>{let{geometries:l,simulation:t,value:n,swr:s,onClose:r}=e,[u,c]=(0,i.useState)(),[m,h]=(0,i.useState)(),[y,v]=(0,i.useState)(),[p,x]=(0,i.useState)(),[b,g]=(0,i.useState)(),[f,A]=(0,i.useState)(),[C,k]=(0,i.useState)(),[w,N]=(0,i.useState)(),{dispatch:T}=(0,i.useContext)(eh.CW),O=(0,i.useMemo)(()=>t.scheme.configuration.boundaryConditions,[t]),P=(0,i.useMemo)(()=>Object.keys(O).map(e=>{var l;if("index"===e||"title"===e||"done"===e)return;let t=O[e];return null==t?void 0:null===(l=t.values)||void 0===l?void 0:l.map(e=>{if(e.uuid!==u)return{label:e.name,selected:e.selected}}).filter(e=>e)}).flat().filter(e=>e),[O,u]),I=(0,i.useMemo)(()=>Object.keys(O).map(e=>{if("index"===e||"title"===e||"done"===e)return;let l=O[e];return{key:e,label:l.label}}).filter(e=>e),[O]),V=(0,i.useCallback)(e=>{h(e.target.value)},[]),R=(0,i.useCallback)(e=>{var l;let t=e.target.value;v(I.find(e=>e.key===t));let a=null===(l=O[t].children)||void 0===l?void 0:l.map(e=>({checked:!0,value:e.default}));k(null!=a?a:[])},[O,I]),_=(0,i.useCallback)((e,l)=>{k([...C.slice(0,e),{...C[e],value:l},...C.slice(e+1)])},[C]),z=(0,i.useCallback)((e,l)=>{k([...C.slice(0,e),{...C[e],checked:l},...C.slice(e+1)])},[C]),Y=(0,i.useCallback)((e,l)=>{k([...C.slice(0,e),{...C[e],unit:l},...C.slice(e+1)])},[C]),F=(0,i.useCallback)(e=>{A(e)},[]),D=(0,i.useCallback)(e=>{let t=l.find(l=>l.id===e);x(t);let a=t.summary.dimension;g(a),T((0,ey.sS)()),T((0,ey.dv)(2===a?"edges":"faces")),T((0,ey.Y0)(t.summary.uuid))},[l,T]),B=(0,i.useCallback)(()=>{r(),T((0,ey.b8)())},[r,T]),H=(0,i.useMemo)(()=>{if(!y)return;let e=O[y.key].children;if(e)return(0,a.jsx)(S.A,{children:e.map((e,l)=>{if(2!==b||!e.only3D)return(0,a.jsx)(lN,{simulation:t,dimension:b,values:C,child:e,index:l,_onValueChange:_,_onCheckedChange:z,_onUnitChange:Y},e.label)})})},[t,O,y,b,C,_,z,Y]),G=(0,i.useMemo)(()=>{let e=0;return Object.keys(O).forEach(l=>{var t,a;if("index"===l||"title"===l||"done"===l)return;let i=O[l];e+=null!==(a=null===(t=i.values)||void 0===t?void 0:t.length)&&void 0!==a?a:0}),e},[O]);return(0,i.useEffect)(()=>{var e;u||c(null!==(e=null==n?void 0:n.uuid)&&void 0!==e?e:"add")},[n,u]),(0,i.useEffect)(()=>{m||((null==n?void 0:n.name)?h(n.name):h("Boundary condition "+(G+1)))},[n,m,G]),(0,i.useEffect)(()=>{var e;p||D(null!==(e=null==n?void 0:n.geometry)&&void 0!==e?e:l[0].id)},[l,n,p,D]),(0,i.useEffect)(()=>{y||v(null==n?void 0:n.type)},[n,y]),(0,i.useEffect)(()=>{var e;C||k(null!==(e=null==n?void 0:n.values)&&void 0!==e?e:[])},[n,C]),(0,a.jsx)(eA.A,{className:eZ().subPanel,title:"Boundary condition",placement:"left",closable:!1,open:!0,mask:!1,maskClosable:!1,width:300,extra:(0,a.jsx)(M.Ay,{type:"text",icon:(0,a.jsx)(eC.A,{}),onClick:B}),footer:(0,a.jsxs)("div",{style:{display:"flex",justifyContent:"flex-end"},children:[(0,a.jsx)(j.Zb,{onCancel:B}),n?(0,a.jsx)(lS,{boundaryCondition:{uuid:u,name:m,type:y,geometry:null==p?void 0:p.id,selected:f,values:C},oldBoundaryCondition:n,simulation:t,swr:s,onError:N,onClose:r}):(0,a.jsx)(lC,{boundaryCondition:{uuid:u,name:m,type:y,geometry:null==p?void 0:p.id,selected:f,values:C},simulation:t,swr:s,onError:N,onClose:r})]}),children:(0,a.jsxs)(E.A,{direction:"vertical",className:L().fullWidth,children:[(0,a.jsx)(S.A,{size:"small",children:(0,a.jsx)(U.A,{layout:"vertical",children:(0,a.jsx)(U.A.Item,{label:(0,a.jsx)(o.A.Text,{strong:!0,children:"Boundary condition name"}),children:(0,a.jsx)(W.A,{value:null!=m?m:"",onChange:V,maxLength:50})})})}),(0,a.jsx)(S.A,{size:"small",children:(0,a.jsx)(U.A,{layout:"vertical",children:(0,a.jsx)(U.A.Item,{label:(0,a.jsx)(o.A.Text,{strong:!0,children:"Boundary condition type"}),children:(0,a.jsx)(J.Ay.Group,{optionType:"button",buttonStyle:"solid",value:null==y?void 0:y.key,onChange:R,style:{justifyContent:"center"},children:null==I?void 0:I.map(e=>(0,a.jsx)(J.Ay.Button,{value:e.key,children:e.label},e.key))})})})}),H,(0,a.jsx)(d.A,{items:l.map(e=>({key:e.id,label:e.name,children:(0,a.jsx)(eW,{geometry:e,alreadySelected:P,updateSelected:F})})),activeKey:null==p?void 0:p.id,onChange:D}),w&&(0,a.jsxs)(o.A.Text,{children:[(0,a.jsx)(ek.A,{style:{color:"red"}})," ",w]})]})})};var lT=t(13452),lM=t(77026),lO=t(34484),lP=t(88724),lL=t(27399);let lI={name:"You need to define a name",point:"You need to select a point",formula:"You need to define a formula",update:"Unable to update simulation"},lV=async(e,l,t)=>{let a=C.A.deepCopy(e),i=a.scheme.configuration.run,n=l.index;delete l.index,i.sensors[n]=l,await k.A.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","run"],value:i}]),await t.mutateOneSimulation(a)},lR=e=>{let{simulation:l,sensor:t,onError:n,onClose:s,swr:o}=e,[r,u]=(0,i.useState)(),{dispatch:d}=(0,i.useContext)(p.V2),c=(0,i.useCallback)(()=>{(0,g.g)(async()=>{u(!0);try{if(!t.name){n(lI.name),u(!1);return}if(!t.point){n(lI.point),u(!1);return}if(!t.formula){n(lI.formula),u(!1);return}n(),await lV(l,t,o),u(!1),s()}catch(e){d((0,x.CN)({title:lI.update,err:e})),u(!1)}})},[l,t,n,s,o,d]);return(0,a.jsx)(j.lg,{loading:r,primary:!0,needMargin:!0,onEdit:c,children:"Edit"})},lU={name:"You need to define a name",point:"You need to select a point",formula:"You need to define a formula",update:"Unable to update simulation"},lW=async(e,l,t)=>{var a;let i=C.A.deepCopy(e),n=i.scheme.configuration.run,s={...n,sensors:[...null!==(a=n.sensors)&&void 0!==a?a:[],l]};await k.A.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","run"],value:s}]),await t.mutateOneSimulation(i)},l_=e=>{let{simulation:l,sensor:t,onError:n,onClose:s,swr:o}=e,[r,u]=(0,i.useState)(),{dispatch:d}=(0,i.useContext)(p.V2),c=(0,i.useCallback)(()=>{(0,g.g)(async()=>{u(!0);try{if(!t.name){n(lU.name),u(!1);return}if(!t.point){n(lU.point),u(!1);return}if(!t.formula){n(lU.formula),u(!1);return}n(),await lW(l,t,o),u(!1),s()}catch(e){d((0,x.CN)({title:lU.update,err:e})),u(!1)}})},[l,t,n,s,o,d]);return(0,a.jsx)(j.M3,{loading:r,needMargin:!0,onAdd:c,children:"Add"})},lz=e=>{var l,t,n;let{visible:r,geometries:u,simulation:c,sensor:m,onClose:h,swr:y}=e,[v,p]=(0,i.useState)(),[x,g]=(0,i.useState)(),[f,A]=(0,i.useState)(),[C,k]=(0,i.useState)(),w=(0,i.useMemo)(()=>c.scheme.configuration.dimension,[c]),N=(0,i.useMemo)(()=>c.scheme.variables,[c]),{point:T,dispatch:O}=(0,i.useContext)(eh.CW);(0,b.A)(()=>{var e;O((0,ey.Y0)(null===(e=u[0])||void 0===e?void 0:e.summary.uuid)),A(null==m?void 0:m.geometry)},[u,m],[O]),(0,b.A)(()=>{O((0,ey.dv)("point"))},[O]),(0,b.A)(()=>{if(!m){let e=c.scheme.configuration.run;g(l=>({...l,name:"Sensor "+(e.sensors?e.sensors.length+1:1)}))}},[c,m]),(0,b.A)(()=>{m&&(g(m),O((0,ey.rO)({x:m.point.x,y:m.point.y,z:m.point.z})))},[m],[O]),(0,b.A)(()=>{T&&g(e=>({...e,point:T}))},[T]);let P=(0,i.useCallback)(()=>{p(!1),O((0,ey.b8)()),window.removeEventListener("click",P)},[O]),I=(0,i.useCallback)(()=>{v?P():(p(!0),O((0,ey.sS)()),setTimeout(()=>window.addEventListener("click",P),50))},[v,P,O]),V=(0,i.useCallback)(e=>{A(e);let l=u.find(l=>l.id===e);O((0,ey.Y0)(l.summary.uuid)),g(l=>({...l,geometry:e}))},[u,O]),R=(0,i.useCallback)((e,l,t)=>{O((0,ey.rO)({x:e,y:l,z:t}))},[O]),U=(0,i.useCallback)(e=>{g(l=>({...l,formula:e}))},[]),_=(0,i.useCallback)(()=>{g(void 0),k(void 0),O((0,ey.rO)()),O((0,ey.b8)()),h()},[O,h]),z=(0,i.useCallback)(e=>{g(l=>({...l,name:e.target.value}))},[]),Y=(0,i.useCallback)(e=>{var l,t;return R(+e,null!==(l=null==T?void 0:T.y)&&void 0!==l?l:0,null!==(t=null==T?void 0:T.z)&&void 0!==t?t:0)},[T,R]),F=(0,i.useCallback)(e=>{var l,t;return R(null!==(l=null==T?void 0:T.x)&&void 0!==l?l:0,+e,null!==(t=null==T?void 0:T.z)&&void 0!==t?t:0)},[T,R]),D=(0,i.useCallback)(e=>{var l,t;return R(null!==(l=null==T?void 0:T.x)&&void 0!==l?l:0,null!==(t=null==T?void 0:T.y)&&void 0!==t?t:0,+e)},[T,R]);return(0,a.jsx)(eA.A,{title:"Sensor",placement:"left",closable:!1,open:r,mask:!1,maskClosable:!1,width:300,extra:(0,a.jsx)(M.Ay,{type:"text",icon:(0,a.jsx)(eC.A,{}),onClick:_}),footer:(0,a.jsxs)("div",{style:{display:"flex",justifyContent:"flex-end"},children:[(0,a.jsx)(j.Zb,{onCancel:_}),m?(0,a.jsx)(lR,{simulation:c,sensor:{...m,...x},onError:k,onClose:_,swr:y}):(0,a.jsx)(l_,{simulation:c,sensor:x,onError:k,onClose:_,swr:y})]}),children:(0,a.jsxs)(E.A,{direction:"vertical",className:L().fullWidth,children:[(0,a.jsxs)(S.A,{size:"small",children:[(0,a.jsx)(o.A.Text,{children:"Name"}),(0,a.jsx)(W.A,{value:null==x?void 0:x.name,onChange:z})]}),(0,a.jsxs)(S.A,{size:"small",children:[(0,a.jsx)(d.A,{items:u.map(e=>({key:e.id,label:e.name})),activeKey:f,onChange:V}),(0,a.jsxs)(E.A,{direction:"vertical",className:L().fullWidth,children:[(0,a.jsxs)(E.A,{className:L().fullWidth,style:{justifyContent:"space-between"},children:[(0,a.jsx)(o.A.Text,{children:"Point selection"}),(0,a.jsx)(s.A,{title:"Pin in the geometry",children:(0,a.jsx)(M.Ay,{size:"small",type:v?"primary":"default",icon:(0,a.jsx)(lL.A,{}),onClick:I})})]}),(0,a.jsx)(ea,{label:"X",noLarge:!0,defaultValue:null==x?void 0:null===(l=x.point)||void 0===l?void 0:l.x,onValueChange:Y}),(0,a.jsx)(ea,{label:"Y",noLarge:!0,defaultValue:null==x?void 0:null===(t=x.point)||void 0===t?void 0:t.y,onValueChange:F}),(0,a.jsx)(ea,{label:"Z",noLarge:!0,defaultValue:null==x?void 0:null===(n=x.point)||void 0===n?void 0:n.z,onValueChange:D})]})]}),(0,a.jsx)(S.A,{size:"small",className:L().noBorderBottom,children:(0,a.jsx)(ea,{label:"Formula",dimension:w,defaultValue:null==x?void 0:x.formula,additionalKeywords:N,onValueChange:U})}),C&&(0,a.jsxs)(o.A.Text,{children:[(0,a.jsx)(ek.A,{style:{color:"red"}})," ",C]})]})})},lY={update:"Unable to update simulation"},lF=async(e,l,t)=>{let a=C.A.deepCopy(e),i=a.scheme.configuration.run;i.sensors=[...i.sensors.slice(0,l),...i.sensors.slice(l+1)],await k.A.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","run"],value:i}]),await t.mutateOneSimulation(a)},lD=e=>{let{simulation:l,index:t,swr:n}=e,[s,r]=(0,i.useState)(),{dispatch:u}=(0,i.useContext)(eh.CW),{dispatch:d}=(0,i.useContext)(p.V2),c=(0,i.useMemo)(()=>l.scheme.configuration.run,[l]),m=(0,i.useMemo)(()=>c.sensors[t],[t,c]),h=(0,i.useCallback)(async()=>{r(!0);try{await lF(l,t,n),u((0,ey.rO)())}catch(e){d((0,x.CN)({title:lY.update,err:e}))}finally{r(!1)}},[l,t,n,u,d]);return(0,a.jsx)(j.et,{loading:s,text:(0,a.jsxs)(a.Fragment,{children:["Are you sure you want to delete the sensor"," ",(0,a.jsx)(o.A.Text,{strong:!0,children:m.name})]}),onDelete:h})},lB=e=>{let{simulation:l,sensor:t,index:n,_onEdit:s,swr:r}=e,{dispatch:u}=(0,i.useContext)(eh.CW),d=(0,i.useCallback)(()=>{u((0,ey.sS)()),u((0,ey.rO)(t.point))},[t,u]),c=(0,i.useCallback)(()=>{u((0,ey.b8)()),u((0,ey.rO)())},[u]),m=(0,i.useCallback)(()=>s({...t,index:n}),[t,n,s]);return(0,a.jsx)(S.A,{className:"".concat(L().textAlignCenter," ").concat(eg().listItem),hoverable:!0,onMouseEnter:d,onMouseLeave:c,actions:[(0,a.jsx)(j.lg,{onEdit:m},"edit"),(0,a.jsx)(lD,{simulation:l,index:n,swr:r},"delete")],children:(0,a.jsx)(o.A.Text,{strong:!0,className:L().textAlignCenter,children:t.name})})},lH=e=>{var l;let{simulation:t,onEdit:n,swr:s}=e,o=(0,i.useMemo)(()=>t.scheme.configuration.run,[t]);return(0,a.jsx)(a.Fragment,{children:null===(l=o.sensors)||void 0===l?void 0:l.map((e,l)=>(0,a.jsx)(lB,{simulation:t,sensor:e,index:l,_onEdit:n,swr:s},e.name))})},lG=e=>{let{geometries:l,simulation:t,setVisible:n,setResults:s,setPostprocessing:o,swr:r}=e,[u,d]=(0,i.useState)(),[c,m]=(0,i.useState)(),h=(0,i.useCallback)(()=>{s([]),o(void 0),m(void 0),n(!1),d(!0)},[n,s,o]),y=(0,i.useCallback)(e=>{s([]),o(void 0),m(e),n(!1),d(!0)},[n,s,o]),v=(0,i.useCallback)(()=>{m(void 0),n(!0),d(!1)},[n]);return(0,a.jsxs)(S.A,{size:"small",title:"Sensors",children:[(0,a.jsx)(lz,{visible:u,geometries:l,simulation:t,sensor:c,onClose:v,swr:r}),(0,a.jsxs)(E.A,{direction:"vertical",className:L().fullWidth,children:[(0,a.jsx)(M.Ay,{className:L().fullWidth,disabled:!1,type:"primary",icon:(0,a.jsx)(lP.A,{}),onClick:h,children:"Add a sensor"}),(0,a.jsx)(lH,{simulation:t,onEdit:y,swr:r})]})]})};var lK=t(14953),lq=t.n(lK),lQ=t(86715),lJ=t(85078),lZ=t(54451),lX=t(80563);let l$={plugins:"Plugins error",pluginsLoad:"Unable to load plugins",extra:"Unable to execute extra action"},l0=async(e,l)=>await lX.A.extra(e,l),l1=e=>{let{plugin:l,parallel:n,onOk:s,setVisible:o}=e,r=lq()(()=>t(7858)("./".concat(l.key,"/src/components"))),u=(0,i.useCallback)(e=>{(0,g.g)(async()=>{v()(l,e),await s(l),o(!1)})},[l,s,o]);return(0,a.jsx)(S.A,{title:l.configuration.name.value,children:(0,a.jsx)(r,{data:l.data,parallel:n,onSelect:u})},l.uuid)},l2=e=>{let{pluginsList:l,plugins:t,parallel:n,onOk:s,setVisible:o}=e;return(0,i.useMemo)(()=>t.length,[t])?(0,a.jsx)(E.A,{direction:"vertical",children:t.map(e=>l.find(l=>l.key===e.key)?(0,a.jsx)(l1,{plugin:e,parallel:n,onOk:s,setVisible:o},e.uuid):null)}):null},l3=e=>{var l;let{disabled:t,parallel:n,cloudServer:u,onOk:d}=e,[c,m]=(0,i.useState)(!1),[h,y]=(0,i.useState)([]),{dispatch:v}=(0,i.useContext)(p.V2),b=(0,lQ.useRouter)(),[f,{errorPlugins:A}]=lX.A.usePlugins();(0,i.useEffect)(()=>{A&&v((0,x.CN)({title:l$.plugins,err:A}))},[A,v]),(0,i.useEffect)(()=>{(0,g.g)(async()=>{try{let e=(await w.A.list()).filter(e=>"HPC"===e.category);y(e)}catch(e){v((0,x.CN)({title:l$.pluginsLoad,err:e}))}})},[v]);let C=(0,i.useCallback)(()=>m(!0),[]),k=(0,i.useCallback)(()=>m(!1),[]),N=(0,i.useCallback)(()=>{(0,g.g)(async()=>{await b.push({pathname:"/dashboard",query:{page:"account",tab:"hpc"}})})},[b]),T=(0,i.useCallback)(e=>{(0,g.g)(async()=>{try{await l0(u,e)}catch(e){v((0,x.CN)({title:l$.extra,err:e}))}})},[u,v]),O=(0,i.useMemo)(()=>{let e=null==u?void 0:u.extra;if(!e)return(0,a.jsx)(a.Fragment,{});let l=Object.keys(e).map(l=>{let t=e[l],i="cloud-download"===t.icon?(0,a.jsx)(lJ.A,{}):null;if("button"===t.type)return(0,a.jsx)(s.A,{title:t.label,children:(0,a.jsx)(M.Ay,{icon:i,onClick:()=>T(t.action)})},t.action)});return(0,a.jsxs)("div",{children:["Custom plugin actions:",(0,a.jsx)("br",{}),l]})},[null==u?void 0:u.extra,T]);return(0,a.jsxs)(S.A,{size:"small",title:"Computational resource",children:[(0,a.jsx)(r.A,{open:c,title:"Computational resource",okButtonProps:{disabled:!0,style:{display:"none"}},onCancel:k,style:{width:"unset"},children:(0,a.jsxs)(E.A,{direction:"vertical",children:[(0,a.jsxs)(o.A.Text,{children:["Your computational resource does not appear in this list? Create one in your"," ",(0,a.jsx)(j.z9,{onClick:N,children:"account settings"})]}),(0,a.jsx)(l2,{pluginsList:h,plugins:f,parallel:n,onOk:d,setVisible:m})]})}),(0,a.jsxs)(E.A,{direction:"vertical",className:L().fullWidth,children:[u&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(o.A.Text,{children:[(0,a.jsx)("span",{className:L().textLight,children:"Plugin:"})," ",u.name]}),(0,a.jsxs)(o.A.Text,{children:[(0,a.jsx)("span",{className:L().textLight,children:"Name:"})," ",u.configuration.name.value]}),Object.keys(null!==(l=u.inUseConfiguration)&&void 0!==l?l:{}).map(e=>{let l=u.inUseConfiguration[e];if(l.parallelOnly&&!n)return;let t=l.value;return"boolean"==typeof t&&(t=t?"yes":"no"),(0,a.jsxs)(o.A.Text,{children:[(0,a.jsxs)("span",{className:L().textLight,children:[l.label,":"]})," ",t]},e)})]}),(0,a.jsx)(M.Ay,{className:L().fullWidth,disabled:t,type:u?"link":"primary",icon:(0,a.jsx)(lZ.A,{}),onClick:C,children:u?"Modify the resource":"Select a resource"}),O]})]})};var l5=t(47727),l8=t(10900),l4=t(48287).hp;let l7={log:"Unable to get system log"},l6=async(e,l)=>{let t=await k.A.log({id:e.id},l.systemLog),i=l4.from(t.log).toString();r.A.info({title:"System log",width:"unset",content:(0,a.jsx)("div",{style:{maxHeight:"70vh",overflow:"auto"},children:(0,a.jsx)("pre",{children:(0,a.jsx)("code",{children:(0,l8.Ay)(i.replace(/\n\n/g,"\n").replace(/\n/g,"<br />"))})})})})},l9=e=>{var l,t,n,s;let{simulation:r,step:u,loading:d,setLoading:c}=e,{dispatch:m}=(0,i.useContext)(p.V2),h=(0,i.useCallback)(()=>{(0,g.g)(async()=>{c(!0);try{await l6(r,u)}catch(e){m((0,x.CN)({title:l7.log,err:e}))}finally{c(!1)}})},[r,u,c,m]),y=(0,i.useMemo)(()=>{let e=[];return u.warning&&e.push({key:"warnings",className:eg().warning,label:(0,a.jsx)(o.A.Text,{type:"warning",children:"Warnings"}),children:(0,l8.Ay)(u.warning.replace(/\n\n/g,"\n").replace(/\n/g,"<br />"))}),u.error&&e.push({key:"errors",className:eg().error,label:(0,a.jsx)(o.A.Text,{type:"danger",children:"Errors"}),children:(0,l8.Ay)(u.error.replace(/\n\n/g,"\n").replace(/\n/g,"<br />"))}),e},[u]);return(0,a.jsxs)(a.Fragment,{children:[u.systemLog&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(M.Ay,{loading:d,onClick:h,children:"Complete log"}),(0,a.jsx)("br",{})]}),u.link&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("a",{href:"https://"+u.link.href,target:"_blank",rel:"noreferrer",children:(0,a.jsx)(M.Ay,{type:"primary",children:u.link.label})}),(0,a.jsx)("br",{})]}),(0,a.jsx)(G.A,{ghost:!0,items:y}),(0,l8.Ay)(null!==(n=null===(l=u.pluginLog)||void 0===l?void 0:l.replace(/\n\n/g,"\n").replace(/\n/g,"<br />").replace(/Warning:/g,'<span style="color: orange; font-weight: bold;">Info: </span>').replace(/Error:/g,'<span style="color: red; font-weight: bold;">Error:</span>'))&&void 0!==n?n:""),(0,l8.Ay)(null!==(s=null===(t=u.log)||void 0===t?void 0:t.replace(/^PERCENT.*\n?/gm,"").replace(/Info\s*:/g,'<span style="color: blue; font-weight: bold;">Info: </span>').replace(/Error:/g,'<span style="color: red; font-weight: bold;">Error:</span>').replace(/\n\n/g,"\n").replace(/\n/g,"<br />"))&&void 0!==s?s:"")]})},te=e=>{let{simulation:l,steps:t}=e,[n,o]=(0,i.useState)(!1),[r,u]=(0,i.useState)(!1),c=(0,i.useCallback)(()=>o(!0),[]),m=(0,i.useCallback)(()=>o(!1),[]);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(eA.A,{title:"Log",open:n,onClose:m,width:"50%",children:(0,a.jsx)(d.A,{items:null==t?void 0:t.map((e,t)=>({key:""+t,label:e.label,children:(0,a.jsx)(l9,{simulation:l,step:e,loading:r,setLoading:u})}))})}),(0,a.jsx)(s.A,{title:"Log",children:(0,a.jsx)(M.Ay,{disabled:!(null==t?void 0:t.length),icon:(0,a.jsx)(l5.A,{}),onClick:c})})]})};var tl=t(4071),tt=t(20234),ta=t(40416),ti=t(83144);let tn={download:"Unable to download file"},ts=async(e,l)=>{let t=await ti.A.download({id:e.id},{originPath:l.originPath,fileName:l.fileName}),a=await t.blob(),i=window.URL.createObjectURL(new Blob([a])),n=document.createElement("a");n.href=i,n.setAttribute("download",l.name+"."+l.fileName.split(".").pop()),n.click()},to=e=>{let{simulation:l,file:t}=e,[n,o]=(0,i.useState)(!1),{dispatch:r}=(0,i.useContext)(p.V2),u=(0,i.useCallback)(()=>{(0,g.g)(async()=>{o(!0);try{await ts(l,t)}catch(e){r((0,x.CN)({title:tn.download,err:e}))}finally{o(!1)}})},[l,t,r]);return(0,a.jsx)(s.A,{title:"Download",children:(0,a.jsx)(M.Ay,{loading:n,icon:(0,a.jsx)(ta.A,{}),onClick:u})})},tr={archive:"Unable to download archive"},tu=async e=>{let l=await ti.A.archive({id:e.id}),t=await l.blob(),a=window.URL.createObjectURL(new Blob([t])),i=document.createElement("a");i.href=a,i.setAttribute("download",e.scheme.name+".zip"),i.click()},td=e=>{let{simulation:l}=e,[t,n]=(0,i.useState)(!1),{dispatch:s}=(0,i.useContext)(p.V2),o=(0,i.useCallback)(()=>{(0,g.g)(async()=>{n(!0);try{await tu(l)}catch(e){s((0,x.CN)({title:tr.archive,err:e}))}finally{n(!1)}})},[l,s]);return(0,a.jsx)(j.fd,{loading:t,onDownload:o})},tc=e=>{var l;let{simulation:t,results:n,file:s,setResults:o}=e,r=(0,i.useCallback)(()=>{let e=n.findIndex(e=>e.fileName===s.fileName&&e.name===s.name);if(-1===e){let e=s.geometry;o([...n.filter(l=>l.geometry!==e),s])}else o([...n.slice(0,e),...n.slice(e+1)])},[n,s,o]),u=(0,i.useMemo)(()=>n.find(e=>e.fileName===s.fileName&&e.name===s.name),[n,s]);return(0,a.jsxs)(E.A,{style:{alignItems:"center"},children:[(0,a.jsx)(M.Ay,{icon:u?(0,a.jsx)(tl.A,{style:{color:"#fad114"}}):(0,a.jsx)(tt.A,{}),onClick:r}),(0,a.jsx)(to,{simulation:{id:t.id},file:{name:s.name,fileName:s.fileName,originPath:s.originPath}}),null===(l=s.name)||void 0===l?void 0:l.replaceAll("_"," ")]})},tm=e=>{let{simulation:l,results:t,setResults:s}=e,[o,r]=(0,i.useState)(),{singleFiles:u,filteredFiles:d}=(0,i.useMemo)(()=>{var e;let t;if(!l.tasks)return{singleFiles:[],filteredFiles:void 0};let a=l.scheme.configuration,i=[],n=null==a?void 0:null===(e=a.run)||void 0===e?void 0:e.resultsFilter;for(let e of l.tasks)if(e.file&&i.push(e.file),e.files){if(n){let{filteredFiles:l,notFilteredFiles:s}=ln(e.files,n),o=ls(l,n),r=o.map(e=>e.number).filter((e,l,t)=>t.indexOf(e)===l).sort((e,l)=>e-l),u=lo(a,n),d=r.map((e,l)=>({label:Math.round(1e15*(u?e*u:l))/1e15,value:e}));i.push(...s),t={filtered:!0,name:n.name,files:o,options:d}}else i.push(...e.files)}return{singleFiles:i,filteredFiles:t}},[l]);(0,b.A)(()=>{!o&&d&&r(null==d?void 0:d.options[0].value)},[d,o]);let c=(0,i.useCallback)(e=>{s(d.files.filter(l=>l.number===e&&t.find(e=>e.name===l.name))),r(e)},[t,d,s]);return u.length||d?(0,a.jsx)(S.A,{size:"small",title:"Results",extra:(0,a.jsx)(td,{simulation:l&&{id:l.id,scheme:l.scheme}}),children:(0,a.jsxs)(E.A,{direction:"vertical",className:L().fullWidth,children:[null==u?void 0:u.map(e=>(0,a.jsx)(tc,{simulation:l,results:t,file:e,setResults:s},e.name)),d&&(0,a.jsxs)(a.Fragment,{children:[d.name,(0,a.jsx)(n.A,{className:L().fullWidth,options:d.options,value:o,onChange:c}),d.files.map(e=>{if(e.number===o)return(0,a.jsx)(tc,{simulation:l,results:t,file:e,setResults:s},e.name)})]})]})}):(0,a.jsx)(S.A,{size:"small",children:"No results yet"})},th={run:"Unable to run simulation",stop:"Unable to stop simulation",update:"Unable to update simulation"},ty=async(e,l,t)=>{let a=C.A.deepCopy(e),i=e.scheme.configuration;i.run.cloudServer=l,a.scheme.configuration=i,await k.A.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","run"],value:i.run}]),await t.mutateOneSimulation(a),await t.mutateSimulation(a)},tv=async(e,l)=>await k.A.run({id:e.id},l),tp=async e=>await k.A.stop({id:e.id}),tx=[{key:"warpByVector",label:"Warp by vector",parameters:[{key:"Vectors",label:"Vectors",rules:[{required:!0,message:"Vectors is required"}]},{key:"ScaleFactor",label:"Scale factor",default:"1",rules:[{required:!0,message:"Scale factor is required"}]}]},{key:"contour",label:"Contour",parameters:[{key:"ContourBy",label:"Contour by",rules:[{required:!0,message:"ContourBy by is required"}]},{key:"isosurface",label:"Isosurface",default:"0",rules:[{required:!0,message:"Isosurface is required"}]}]},{key:"streamTracer",label:"Stream tracer",parameters:[{key:"Vectors",label:"Vectors",rules:[{required:!0,message:"Vectors is required"}]}]}];var tb=t(50641);let tg={run:async(e,l,t,a)=>(await (0,tb.T)("/api/postprocessing",{method:"POST",headers:{Accept:"application/json"},body:JSON.stringify({simulation:e,result:l,filter:t,parameters:a})})).json()},tf={run:"Unable to run filter"},tj=async(e,l,t,a)=>await tg.run(e,l,t,a),tA=e=>{let{simulation:l,postprocessing:t,result:n,setResult:s}=e,o=(0,i.useCallback)(()=>s((null==t?void 0:t.fileName)===n.fileName&&(null==t?void 0:t.name)===n.name?void 0:{type:"postprocessing",...n}),[t,n,s]);return(0,a.jsxs)(E.A,{children:[(0,a.jsx)(M.Ay,{icon:(null==t?void 0:t.fileName)===n.fileName&&(null==t?void 0:t.name)===n.name?(0,a.jsx)(tl.A,{className:L().primaryColor}):(0,a.jsx)(tt.A,{}),onClick:o}),(0,a.jsx)(to,{simulation:{id:l.id},file:{name:n.name,fileName:n.fileName,originPath:n.originPath}}),n.name]},n.glb)},tC=e=>{let{simulation:l,postprocessing:t,results:n,setResult:s}=e;return(0,i.useMemo)(()=>n.length,[n])?(0,a.jsx)(E.A,{direction:"vertical",className:L().fullWidth,children:n.map(e=>(0,a.jsx)(tA,{simulation:l,postprocessing:t,result:e,setResult:s},e.glb))}):(0,a.jsx)(a.Fragment,{children:"No results"})},tk={plugins:"Unable to load plugins",update:"Unable to update simulation"},tw=async e=>{let l=await w.A.list();return tS(e,A.A,l)},tS=(e,l,t)=>{let a=l;return t.forEach(l=>{var t;(null===(t=e.authorizedplugins)||void 0===t?void 0:t.includes(l.key))&&"Model"===l.category&&(a=[...a,...l.models])}),a},tN=(e,l)=>null==l||!l.length||(Array.isArray(e)?l.filter(l=>e.includes(l)).length==l.length:!!(1===l.length&&l.includes(e))),tE=async(e,l,t)=>{let a=l.find(l=>{var t;return l.algorithm===(null==e?void 0:null===(t=e.scheme)||void 0===t?void 0:t.algorithm)}),i=C.A.deepCopy(e);v()(i.scheme,a),await k.A.update({id:e.id},[{key:"scheme",value:i.scheme}]),await t.mutateOneSimulation(i)},tT={Selector:e=>{let{visible:l,user:t,title:m,okText:h,onOk:y,onCancel:v,onDelete:A}=e,[k,w]=(0,i.useState)(),[S,N]=(0,i.useState)(),[E,T]=(0,i.useState)(!1),[M,O]=(0,i.useState)([]),[P,I]=(0,i.useState)([]),{dispatch:V}=(0,i.useContext)(p.V2);(0,b.A)(()=>{(0,g.g)(async()=>{try{let e=await tw(t);O(e)}catch(e){V((0,x.CN)({title:tk.plugins,err:e})),O([])}})},[t],[V]);let R=(0,i.useMemo)(()=>M.map(e=>e.category).flat().filter((e,l,t)=>t.indexOf(e)===l).map(e=>({key:e,value:e})),[M]),U=(0,i.useCallback)(e=>{let{key:l}=e;w(l),N({model:M.find(e=>e.algorithm===l)})},[M]),W=(0,i.useCallback)(e=>{let{key:l}=e,a=l.split("&").pop();w(a);let i=t.usermodels.find(e=>e.model.algorithm===a);N(C.A.deepCopy(i))},[t]),_=(0,i.useCallback)(()=>{(0,g.g)(async()=>{if(T(!0),S)try{await y(S)}catch(e){}T(!1),N(void 0),w(void 0)})},[S,y]),z=(0,i.useCallback)(()=>{N(void 0),w(void 0),v()},[v]),Y=(0,i.useMemo)(()=>{let e=[{key:"category",disabled:!0,label:(0,a.jsx)(n.A,{mode:"multiple",className:L().fullWidth,options:R,allowClear:!0,suffixIcon:null,placeholder:"Category filter",onChange:I,value:P,style:{textOverflow:"ellipsis"}})}];return M.forEach(l=>{tN(l.category,P)&&e.push({key:l.algorithm,label:l.name})}),e},[M,R,P]),F=(0,i.useMemo)(()=>{let e=[{key:"category",disabled:!0,label:(0,a.jsx)(n.A,{mode:"multiple",className:L().fullWidth,options:R,allowClear:!0,suffixIcon:null,placeholder:"Category filter",onChange:I,value:P})}];return t.usermodels.forEach((l,i)=>{tN(l.model.category,P)&&e.push({key:l.id+"&"+l.model.algorithm,label:(0,a.jsxs)(a.Fragment,{children:[A?(0,a.jsx)(j.et,{onDelete:async()=>A(i)}):null,(0,a.jsx)(s.A,{title:l.model.name,children:(0,a.jsx)(o.A.Text,{ellipsis:!0,children:l.model.name})}),l.owners.find(e=>e.id===t.id)?null:(0,a.jsx)("div",{className:"shared",children:C.A.userToAvatar(l.owners[0])})]})})}),e},[t,R,P,A]);return(0,a.jsx)(r.A,{open:l,title:null!=m?m:"Create simulation",okText:null!=h?h:"Create",okButtonProps:{loading:E},onOk:_,onCancel:z,width:"80%",children:(0,a.jsxs)(u.A,{className:eg().selectorContent,children:[(0,a.jsx)(u.A.Sider,{theme:"light",width:300,className:eg().selectorSider,children:(0,a.jsx)(d.A,{defaultActiveKey:"tanatloc",items:[{key:"tanatloc",label:"Tanatloc algorithm",children:(0,a.jsx)(c.A,{selectedKeys:k?[k]:void 0,mode:"inline",items:Y,onClick:U})},{key:"personal",label:"User algorithm",children:(0,a.jsx)(c.A,{selectedKeys:k?[k]:void 0,mode:"inline",className:eg().userMenu,items:F,onClick:W})}]})}),(0,a.jsx)(u.A.Content,{className:eg().selector,children:(0,a.jsx)(f.A.Html,{html:null==S?void 0:S.model.description})})]})})},Updater:e=>{let{user:l,simulation:t,swr:a}=e,[n,s]=(0,i.useState)([]),{dispatch:o}=(0,i.useContext)(p.V2);return(0,b.A)(()=>{(0,g.g)(async()=>{try{let e=await tw(l);s(e)}catch(e){o((0,x.CN)({title:tk.plugins,err:e})),s([])}})},[l],[o]),(0,b.A)(()=>{let e=n.find(e=>{var l;return e.algorithm===(null==t?void 0:null===(l=t.scheme)||void 0===l?void 0:l.algorithm)});if(e&&(null==t?void 0:t.scheme)){let l=(0,m.A)(t.scheme,e,{excludedKeys:["value","unit"]}),i=(0,h.A)(t.scheme,e,{excludedKeys:["value","unit"]});(Object.keys(l).length||Object.keys(i).length)&&(r.A.info({title:"Update",content:"Your model need an update, please wait.",closable:!1,okButtonProps:{hidden:!0}}),tE(t,n,a).catch(e=>{o((0,x.CN)({title:tk.update,err:e}))}).finally(()=>r.A.destroyAll()))}},[t,n,a]),null},About:e=>{let{project:l,simulation:t,swr:i}=e;return l&&t?(0,a.jsx)(u.A,{children:(0,a.jsx)(u.A.Content,{children:(0,a.jsx)(S.A,{size:"small",title:(0,a.jsx)(o.A.Title,{level:5,ellipsis:!0,children:t.name}),actions:[(0,a.jsx)(R,{project:{id:l.id,simulations:l.simulations},simulation:t,swr:{mutateProject:i.mutateProject,addOneSimulation:i.addOneSimulation}},"copy"),(0,a.jsx)(F,{simulation:{id:t.id,name:t.name},swr:{mutateOneSimulation:i.mutateOneSimulation}},"edit"),(0,a.jsx)(H,{project:{id:l.id,simulations:l.simulations},simulation:{id:t.id,name:t.name},swr:{mutateProject:i.mutateProject,delOneSimulation:i.delOneSimulation}},"delete")],children:(0,a.jsxs)(E.A,{direction:"vertical",className:L().fullWidth,children:[t.scheme.userModelId&&(0,a.jsx)(T.A,{message:"User algorithm",type:"info",showIcon:!0}),(0,a.jsxs)(o.A.Text,{children:[(0,a.jsx)("span",{className:L().textLight,children:"Category:"})," ",t.scheme.category]}),(0,a.jsxs)(o.A.Text,{children:[(0,a.jsx)("span",{className:L().textLight,children:"Algorithm:"})," ",t.scheme.algorithm]}),(0,a.jsxs)(o.A.Text,{children:[(0,a.jsx)("span",{className:L().textLight,children:"Code:"})," ",t.scheme.code]}),(0,a.jsxs)(o.A.Text,{children:[(0,a.jsx)("span",{className:L().textLight,children:"Version:"})," ",t.scheme.version]}),(0,a.jsx)("div",{className:"".concat(L().fullWidth," ").concat(L().scroll),children:(0,a.jsx)(f.A.Html,{html:t.scheme.description})})]})})})}):(0,a.jsx)(S.A,{children:(0,a.jsx)(N.A,{})})},Geometry:e=>{let{geometries:l,simulation:t,setGeometries:n,swr:s}=e,r=(0,i.useMemo)(()=>t.scheme.configuration.geometry.children,[t.scheme.configuration.geometry.children]);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(S.A,{size:"small",children:(0,a.jsx)(o.A.Text,{children:"When changing the simulation domain, you might lose your topological entity assignments"})}),r.map((e,i)=>(0,a.jsx)(ed,{geometries:l,simulation:t,child:e,index:i,setGeometries:n,swr:s},e.label))]})},Materials:e=>{let{geometries:l,simulation:t,swr:n,setVisible:s}=e,[o,r]=(0,i.useState)(),[d,c]=(0,i.useState)(!1),m=(0,i.useMemo)(()=>t.scheme.configuration.materials,[t]),h=(0,i.useMemo)(()=>l.reduce((e,l)=>(e.find(e=>e.id===l.id)||e.push(l),e),[]),[l]),y=(0,i.useCallback)(()=>{r(void 0),c(!0),s(!1)},[s]),v=(0,i.useCallback)(e=>{r(m.values[e]),c(!0),s(!1)},[m,s]),p=(0,i.useCallback)(()=>{c(!1),r(void 0),s(!0)},[s]);return h.length?(0,a.jsx)(u.A,{children:(0,a.jsx)(u.A.Content,{children:(0,a.jsxs)(S.A,{size:"small",children:[(0,a.jsx)(j.M3,{onAdd:y,fullWidth:!0,children:"Add material"}),(0,a.jsx)(ej,{geometries:h,simulation:t,swr:n,onEdit:v}),d?(0,a.jsx)(e$,{geometries:h,simulation:t,value:o,swr:n,onClose:p}):null]})})}):(0,a.jsx)(ec.A.Simple,{})},Parameters:e=>{let{simulation:l,swr:t}=e,{dispatch:n}=(0,i.useContext)(p.V2),s=(0,i.useMemo)(()=>null==l?void 0:l.scheme.configuration.parameters,[l]),o=(0,i.useMemo)(()=>null==l?void 0:l.scheme.configuration.dimension,[l]);(0,i.useEffect)(()=>{(0,g.g)(async()=>{try{(null==s?void 0:s.done)||await e6(l,t)}catch(e){n((0,x.CN)({title:e0.update,err:e}))}})},[l,s,t,n]);let r=(0,i.useMemo)(()=>Object.keys(s).map(e=>{if("index"===e||"title"===e||"done"===e)return null;let i=s[e];return i.advanced||i.hidden?null:(0,a.jsx)(li,{simulation:l,dimension:o,pkey:e,parameter:i,swr:t},e)}).filter(e=>e),[l,o,s,t]),d=(0,i.useMemo)(()=>Object.keys(s).map(e=>{if("index"===e||"title"===e||"done"===e)return null;let i=s[e];return!i.advanced||i.hidden?null:(0,a.jsx)(li,{simulation:l,dimension:o,pkey:e,parameter:i,swr:t},e)}).filter(e=>e),[l,o,s,t]);return(0,a.jsx)(u.A,{children:(0,a.jsx)(u.A.Content,{children:(0,a.jsxs)(E.A,{direction:"vertical",children:[r,d.length?(0,a.jsx)(G.A,{items:[{key:"advanced",label:"Advanced",children:(0,a.jsx)(E.A,{direction:"vertical",children:d})}]}):null]})})})},Initialization:e=>{let{simulations:l,simulation:t,swr:s}=e,[r,d]=(0,i.useState)(!1),[c,m]=(0,i.useState)(),[h,y]=(0,i.useState)(),[v,f]=(0,i.useState)(),{dispatch:j}=(0,i.useContext)(p.V2),A=(0,i.useMemo)(()=>null==t?void 0:t.scheme.configuration.initialization,[t]),C=(0,i.useMemo)(()=>null==t?void 0:t.scheme.configuration.dimension,[t]),k=(0,i.useCallback)(e=>{y(l.find(l=>l.id===e))},[l]);(0,b.A)(()=>{var e,l;!c&&A.value&&m(A.value.type),!h&&(null===(e=A.value)||void 0===e?void 0:e.simulation)&&k(null===(l=A.value)||void 0===l?void 0:l.simulation)},[A,c,h],[k]),(0,b.A)(()=>{(0,g.g)(async()=>{h&&f(await ly(l,h.id))})},[l,h]);let w=(0,i.useMemo)(()=>{let e=[{label:"None",value:"none"}];return A.coupling&&e.push({label:A.coupling.label,value:"coupling"}),A.direct&&e.push({label:A.direct.label,value:"direct"}),e},[A]),T=A.value,M=(0,i.useCallback)(e=>{(0,g.g)(async()=>{d(!0);try{await ld(l,t,e,s),k(e)}catch(e){j((0,x.CN)({title:lr.update,err:e}))}finally{d(!1)}})},[l,t,s,k,j]),O=(0,i.useCallback)((e,l)=>{(0,g.g)(async()=>{try{await lc(t,e,null!=l?l:{},s)}catch(e){j((0,x.CN)({title:lr.update,err:e}))}})},[t,s,j]),P=(0,i.useCallback)((e,l)=>(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(o.A.Text,{children:"If you use coupling, the selected simulation mesh will be used, at least for the first iteration."}),(0,a.jsxs)(E.A,{direction:"vertical",className:L().fullWidth,style:{marginTop:"10px"},children:[(0,a.jsx)(n.A,{className:L().fullWidth,options:e,placeholder:"Select a simulation",value:null==T?void 0:T.simulation,onChange:M}),r&&(0,a.jsx)(N.A,{}),(null==v?void 0:v.length)?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(o.A.Text,{children:[null==l?void 0:l.name,":"]},"simulation"),(0,a.jsx)(n.A,{className:L().fullWidth,options:v,placeholder:"Select a "+l.name,value:null==T?void 0:T.result,onChange:O})]}):(0,a.jsx)(o.A.Text,{type:"danger",children:"No results, please select an other simulation."})]})]}),[T,v,r,M,O]),I=(0,i.useCallback)(e=>(0,a.jsx)(E.A,{direction:"vertical",className:L().fullWidth,children:e.children.map((e,l)=>{var i;if(2!==C||!e.only3D)return(0,a.jsx)(lv,{simulation:t,child:e,index:l,value:null==T?void 0:null===(i=T.values)||void 0===i?void 0:i[l],swr:s,dispatch:j},e.label)})}),[T,C,t,s,j]),V=(0,i.useMemo)(()=>{let e={none:(0,a.jsx)("div",{})},i=A.coupling;if(null==i?void 0:i.compatibility){let a=l.map(e=>{let l=e.id===t.id||!i.compatibility.find(l=>l.algorithm===e.scheme.algorithm);return{label:e.name,value:e.id,disabled:l}}),n=i.compatibility.find(e=>{var l;return e.algorithm===(null==h?void 0:null===(l=h.scheme)||void 0===l?void 0:l.algorithm)}),s=null==n?void 0:n.filter;e.coupling=P(a,s)}let n=A.direct;return(null==n?void 0:n.children)&&(e.direct=I(n)),e},[l,t,h,A,P,I]),R=(0,i.useCallback)(e=>{(0,g.g)(async()=>{try{await lu(t,e,s),m(e)}catch(e){j((0,x.CN)({title:lr.update,err:e}))}})},[t,s,j]);return(0,a.jsx)(u.A,{children:(0,a.jsx)(u.A.Content,{children:(0,a.jsxs)(S.A,{size:"small",children:[(0,a.jsx)(n.A,{className:L().fullWidth,style:{marginTop:"10px"},defaultValue:"none",value:c,options:w,onChange:R}),V[null!=c?c:"none"]]})})})},BoundaryConditions:e=>{let{simulation:l,geometries:t,swr:n,setVisible:s}=e,[o,r]=(0,i.useState)(),[d,c]=(0,i.useState)(!1),m=(0,i.useMemo)(()=>l.scheme.configuration.boundaryConditions,[l]),h=(0,i.useMemo)(()=>t.reduce((e,l)=>(e.find(e=>e.id===l.id)||e.push(l),e),[]),[t]),y=(0,i.useCallback)(()=>{r(void 0),c(!0),s(!1)},[s]),v=(0,i.useCallback)((e,l)=>{r(m[e].values[l]),c(!0),s(!1)},[m,s]),p=(0,i.useCallback)(()=>{c(!1),r(void 0),s(!0)},[s]);return h.length?(0,a.jsx)(u.A,{children:(0,a.jsx)(u.A.Content,{children:(0,a.jsxs)(S.A,{size:"small",children:[(0,a.jsx)(j.M3,{onAdd:y,fullWidth:!0,children:"Add boundary condition"}),(0,a.jsx)(lf,{geometries:h,simulation:l,swr:n,onEdit:v}),d?(0,a.jsx)(lE,{geometries:h,simulation:l,value:o,swr:n,onClose:p}):null]})})}):(0,a.jsx)(ec.A.Simple,{})},Run:e=>{var l;let{geometries:t,simulation:n,results:s,setResults:o,setPostprocessing:r,setVisible:d,swr:c}=e,[m,h]=(0,i.useState)(!1),[y,v]=(0,i.useState)(!1),{dispatch:b}=(0,i.useContext)(p.V2),[f,{mutateSimulation:j}]=k.A.useSimulation(n.id,2e3),A=(0,i.useMemo)(()=>n.scheme.configuration,[n]),C=(0,i.useMemo)(()=>{if("0"!==f.id)return f.scheme.configuration},[f]),w=(0,i.useMemo)(()=>{if(!A)return!0;let e=!1;return Object.keys(A).forEach(l=>{"dimension"===l||"run"===l||A[l].done||(e=!0)}),A.run.cloudServer||(e=!1),e},[A]),T=(0,i.useMemo)(()=>{if(!A)return!1;let e=A.geometry,l=!0;return e.children.forEach(e=>{e.mesh||(l=!1)}),!!l},[A]),{steps:O,percent:P}=(0,i.useMemo)(()=>{var e;let l;if("0"===f.id)return{steps:[],percent:void 0};let t=[];return null==f||null===(e=f.tasks)||void 0===e||e.forEach((e,a)=>{if(e){if(a===f.tasks.length-1){var i,n;let t=(null!==(n=null===(i=e.log)||void 0===i?void 0:i.split("\n"))&&void 0!==n?n:[]).filter(e=>e.startsWith("PERCENT:")).filter(e=>e),a=null==t?void 0:t.pop(),s=a?parseFloat(a.replace("PERCENT: ","").replace("%","")):0;s&&(l=s)}t[e.index]={index:e.index,label:e.label,status:e.status,log:e.log,pluginLog:e.pluginLog,warning:e.warning,error:e.error,systemLog:e.systemLog,link:e.link}}}),{steps:t,percent:l}},[f]);(0,i.useEffect)(()=>{var e,l;if("0"===f.id){h(!1);return}(null==f?void 0:null===(e=f.tasks)||void 0===e?void 0:e.find(e=>(null==e?void 0:e.status)==="error"))?h(!1):(null==f?void 0:null===(l=f.tasks)||void 0===l?void 0:l.find(e=>e&&"finish"!==e.status))?h(!0):h(!1)},[f]);let I=(0,i.useCallback)(async e=>{try{await ty(n,e,{...c,mutateSimulation:j})}catch(e){b((0,x.CN)({title:th.update,err:e}))}},[n,c,j,b]),V=(0,i.useCallback)(e=>v(e.target.checked),[]),R=(0,i.useCallback)(()=>{(0,g.g)(async()=>{h(!0);try{await tv(n,y)}catch(e){b((0,x.CN)({title:th.run,err:e})),h(!1)}})},[n,y,b]),U=(0,i.useCallback)(()=>{(0,g.g)(async()=>{try{await tp(n),h(!1)}catch(e){b((0,x.CN)({title:th.stop,err:e}))}})},[n,b]);return n&&f&&(null==f?void 0:f.id)!=="0"?(0,a.jsx)(u.A,{children:(0,a.jsx)(u.A.Content,{children:(0,a.jsxs)(E.A,{direction:"vertical",className:L().fullWidth,children:[(0,a.jsx)(lG,{geometries:t,simulation:n,setVisible:d,setResults:o,setPostprocessing:r,swr:{mutateOneSimulation:c.mutateOneSimulation}}),(0,a.jsx)(l3,{disabled:m,parallel:n.scheme.parallel,cloudServer:null==C?void 0:null===(l=C.run)||void 0===l?void 0:l.cloudServer,onOk:I}),(0,a.jsx)(S.A,{size:"small",title:"Run",children:(0,a.jsxs)(E.A,{direction:"vertical",className:L().fullWidth,size:20,children:[T?(0,a.jsx)(K.A,{checked:y,onChange:V,children:"Keep mesh(es)?"}):null,(0,a.jsxs)("div",{className:L().fullWidth,style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,a.jsxs)(E.A,{children:[(0,a.jsx)(M.Ay,{disabled:w,type:"primary",icon:(0,a.jsx)(lM.A,{}),loading:m,onClick:R,children:"Run"}),(0,a.jsx)(M.Ay,{disabled:!m,danger:!0,icon:(0,a.jsx)(lO.A,{}),shape:"circle",onClick:U})]}),(0,a.jsx)(te,{simulation:{id:n.id},steps:O})]}),(0,a.jsx)(lT.A,{direction:"vertical",current:O.length-1,percent:P,items:O.map((e,l)=>({key:l,title:e.label,description:"("+(l+1)+"/"+O.length+")",status:e.status}))})]})}),(0,a.jsx)(tm,{simulation:f&&{id:f.id,scheme:f.scheme,tasks:f.tasks},results:s,setResults:o})]})})}):(0,a.jsx)(u.A,{children:(0,a.jsx)(u.A.Content,{children:(0,a.jsx)(S.A,{size:"small",children:(0,a.jsx)(N.A,{})})})})},Postprocessing:e=>{let{simulation:l,results:t,postprocessing:s,setResult:o}=e,[r,u]=(0,i.useState)(),[d,c]=(0,i.useState)(),[m,h]=(0,i.useState)(),{postProcessing:y,dispatch:v}=(0,i.useContext)(eh.CW),{dispatch:b}=(0,i.useContext)(p.V2),f=(0,i.useMemo)(()=>t[0],[t]);(0,i.useEffect)(()=>{l||(u(void 0),h(void 0))},[l]);let j=(0,i.useMemo)(()=>null==l?void 0:l.scheme.configuration.run.postprocessing,[l]),A=(0,i.useMemo)(()=>tx.map(e=>{if(null==j?void 0:j.find(l=>l.key===e.key))return{label:e.label,value:e.key}}).filter(e=>e),[j]),C=(0,i.useMemo)(()=>{if(!j||!r)return;let e=tx.find(e=>e.key===r),l=j.find(e=>e.key===r);if(null==e?void 0:e.parameters)return e.parameters.map((e,t)=>{var i;let s=null==l?void 0:null===(i=l.parameters)||void 0===i?void 0:i.find(l=>l.key===e.key);return(null==s?void 0:s.value)?(0,a.jsx)(U.A.Item,{label:e.label,name:["parameters",t],initialValue:s.value,rules:e.rules,children:(0,a.jsx)(W.A,{disabled:!0})},e.key):(null==s?void 0:s.options)?(0,a.jsx)(U.A.Item,{label:e.label,name:["parameters",t],rules:e.rules,children:(0,a.jsx)(n.A,{options:s.options.map(e=>({label:e,value:e}))})},e.key):(0,a.jsx)(U.A.Item,{label:e.label,name:["parameters",t],rules:e.rules,initialValue:e.default,children:(0,a.jsx)(W.A,{})},e.key)})},[j,r]),k=(0,i.useCallback)(()=>v((0,ey.wI)(!1)),[v]),w=(0,i.useCallback)(e=>{(0,g.g)(async()=>{c(!0);try{var t;let a=await tj(l,f,r,null!==(t=e.parameters)&&void 0!==t?t:[]);h({filter:r,results:a})}catch(e){b((0,x.CN)({title:tf.run,err:e}))}c(!1)})},[l,f,r,b]);return((0,i.useEffect)(()=>{1!==t.length&&y&&k()},[t,y,k]),l&&1===t.length&&j&&A.length)?(0,a.jsxs)(eA.A,{title:"Post-processing",closable:!0,onClose:k,open:y,mask:!1,maskClosable:!1,children:[(0,a.jsx)(U.A,{children:(0,a.jsx)(U.A.Item,{name:"filter",label:"Filter",children:(0,a.jsx)(n.A,{placeholder:"Select a filter",options:A,onChange:u})})}),(0,a.jsxs)(U.A,{layout:"vertical",style:{margin:"24px 0"},onFinish:w,children:[C,(0,a.jsx)(U.A.Item,{children:(0,a.jsx)(M.Ay,{type:"primary",loading:d,htmlType:"submit",icon:(0,a.jsx)(lM.A,{}),children:"Run"})})]}),m&&(0,a.jsx)(S.A,{size:"small",title:"Post-processing",extra:m.filter,children:(0,a.jsx)(tC,{simulation:l,postprocessing:s,results:m.results,setResult:o})})]}):null}}},77896:(e,l,t)=>{"use strict";t.d(l,{Lt:()=>u,XO:()=>c,Y0:()=>o,Zt:()=>r,b8:()=>n,dv:()=>s,rO:()=>d,sS:()=>i,wI:()=>m});var a=t(50549);let i=()=>({type:a.QN.ENABLE}),n=()=>({type:a.QN.DISABLE}),s=e=>({type:a.QN.SETTYPE,value:e}),o=e=>({type:a.QN.SETPART,value:e}),r=e=>({type:a.QN.HIGHLIGHT,value:e}),u=e=>({type:a.QN.SELECT,value:e}),d=e=>({type:a.QN.SETPOINT,value:e}),c=e=>({type:a.QN.SETDATA,value:e}),m=e=>({type:a.QN.SETPOSTPROCESSING,value:e})},50549:(e,l,t)=>{"use strict";t.d(l,{Ay:()=>u,CW:()=>o,QN:()=>s});var a=t(74848),i=t(96540);let n={enabled:!1,type:void 0,part:void 0,highlighted:void 0,selected:[],point:void 0,data:void 0,postProcessing:void 0,dispatch:()=>void 0},s={ENABLE:"ENABLE",DISABLE:"DISABLE",CLEAR:"CLEAR",SETTYPE:"SETTYPE",SETPART:"SETPART",HIGHLIGHT:"HIGHLIGHT",SELECT:"SELECT",SETPOINT:"SETPOINT",SETDATA:"SETDATA",SETPOSTPROCESSING:"SETPOSTPROCESSING"},o=(0,i.createContext)(n),r=(e,l)=>{switch(l.type){case s.ENABLE:return{...e,enabled:!0};case s.DISABLE:return{...e,enabled:!1,highlighted:void 0,selected:[]};case s.CLEAR:return{...n};case s.SETTYPE:return{...e,type:l.value};case s.SETPART:return{...e,part:l.value};case s.HIGHLIGHT:return{...e,highlighted:l.value};case s.SELECT:return{...e,selected:l.value};case s.SETPOINT:return{...e,point:l.value};case s.SETDATA:return{...e,data:l.value};case s.SETPOSTPROCESSING:return{...e,postProcessing:l.value};default:return e}},u=e=>{let{children:l}=e,[t,s]=(0,i.useReducer)(r,n),u=(0,i.useMemo)(()=>({...t,dispatch:s}),[t]);return(0,a.jsx)(o.Provider,{value:u,children:l})}},53559:e=>{e.exports={formula:"formula_formula__5J08n",select:"formula_select__yg4qe"}},38949:e=>{e.exports={panel:"panel_panel__0UqOC",subPanel:"panel_subPanel__xW1ud"}},110:e=>{e.exports={userMenu:"simulation_userMenu__B0_qd",selectorContent:"simulation_selectorContent__NJ9PO",selectorSider:"simulation_selectorSider__gozkv",selector:"simulation_selector__y2Udd",geometriesList:"simulation_geometriesList__Lzj7P",waring:"simulation_waring___VG9C",error:"simulation_error__E54cQ",listItem:"simulation_listItem__PQKrU"}},7858:(e,l,t)=>{var a={"./local/src/components":[24610,1226,4610]};function i(e){if(!t.o(a,e))return Promise.resolve().then(()=>{var l=Error("Cannot find module '"+e+"'");throw l.code="MODULE_NOT_FOUND",l});var l=a[e],i=l[0];return Promise.all(l.slice(1).map(t.e)).then(()=>t(i))}i.keys=()=>Object.keys(a),i.id=7858,e.exports=i}}]);