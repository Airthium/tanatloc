(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2484],{10795:(e,t,i)=>{"use strict";i.d(t,{A:()=>n});var a=i(6768),l=i(14232),s=i(82304);let n={useGeometries:e=>{var t;let{data:i,error:n,mutate:r}=(0,a.Ay)(["/api/geometries",JSON.stringify({ids:e})],e=>{let[t,i]=e;return(0,s.G)(t,i)}),o=!i,d=null!=(t=null==i?void 0:i.geometries)?t:[],c=(0,l.useCallback)(async e=>{let t=[...d,e];await r({geometries:t})},[d,r]),u=(0,l.useCallback)(async e=>{let t=d.filter(t=>t.id!==e.id);await r({geometries:t})},[d,r]),m=(0,l.useCallback)(async e=>{let t=d.map(t=>(t.id===e.id&&(t={...t,...e}),t));await r({geometries:t})},[d,r]);return[d,{addOneGeometry:c,delOneGeometry:u,mutateOneGeometry:m,errorGeometries:n,loadingGeometries:o}]},add:async(e,t)=>(await (0,s.T)("/api/geometry",{method:"POST",body:JSON.stringify({project:e,geometry:t})})).json(),update:async(e,t)=>{await (0,s.T)("/api/geometry/"+e.id,{method:"PUT",body:JSON.stringify(t)})},del:async e=>{await (0,s.T)("/api/geometry/"+e.id,{method:"DELETE"})},download:async e=>(await (0,s.T)("/api/geometry/"+e.id+"/download")).json(),getPart:async e=>(await (0,s.T)("/api/geometry/"+e.id+"/part")).json(),splitStep:async(e,t)=>(await (0,s.T)("/api/geometry/"+t.id+"/splitStep",{method:"POST",body:JSON.stringify({project:e})})).json()}},15109:e=>{e.exports={loading:"view_loading__rcZQY"}},27758:(e,t,i)=>{"use strict";i.d(t,{A:()=>l});var a=i(82304);let l={add:async(e,t)=>(await (0,a.T)("/api/avatar",{method:"POST",headers:{Accept:"application/json"},body:JSON.stringify({file:e,project:t})})).json()}},51189:e=>{e.exports={variables:'"@/styles/variables.css"',colorPrimary:"#fad114",sider:"project_sider__KGpqG",menu1:"project_menu1__iUy_z",menuScroll:"project_menuScroll__d4eJz",menu2:"project_menu2__uQFdm"}},52484:(e,t,i)=>{"use strict";i.d(t,{Ay:()=>eQ});var a=i(37876),l=i(14232),s=i(18847),n=i.n(s),r=i(89099),o=i(8139),d=i(11329),c=i(52323),u=i(39931),m=i(50751),h=i(72686),g=i(77029);let y={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M296 250c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h384c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8H296zm184 144H296c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h184c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8zm-48 458H208V148h560v320c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8V108c0-17.7-14.3-32-32-32H168c-17.7 0-32 14.3-32 32v784c0 17.7 14.3 32 32 32h264c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm440-88H728v-36.6c46.3-13.8 80-56.6 80-107.4 0-61.9-50.1-112-112-112s-112 50.1-112 112c0 50.7 33.7 93.6 80 107.4V764H520c-8.8 0-16 7.2-16 16v152c0 8.8 7.2 16 16 16h352c8.8 0 16-7.2 16-16V780c0-8.8-7.2-16-16-16zM646 620c0-27.6 22.4-50 50-50s50 22.4 50 50-22.4 50-50 50-50-22.4-50-50zm180 266H566v-60h260v60z"}}]},name:"audit",theme:"outlined"};var p=i(3755);function b(){return(b=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e}).apply(this,arguments)}let x=l.forwardRef((e,t)=>l.createElement(p.A,b({},e,{ref:t,icon:y}))),f={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M864 518H506V160c0-4.4-3.6-8-8-8h-26a398.46 398.46 0 00-282.8 117.1 398.19 398.19 0 00-85.7 127.1A397.61 397.61 0 0072 552a398.46 398.46 0 00117.1 282.8c36.7 36.7 79.5 65.6 127.1 85.7A397.61 397.61 0 00472 952a398.46 398.46 0 00282.8-117.1c36.7-36.7 65.6-79.5 85.7-127.1A397.61 397.61 0 00872 552v-26c0-4.4-3.6-8-8-8zM705.7 787.8A331.59 331.59 0 01470.4 884c-88.1-.4-170.9-34.9-233.2-97.2C174.5 724.1 140 640.7 140 552c0-88.7 34.5-172.1 97.2-234.8 54.6-54.6 124.9-87.9 200.8-95.5V586h364.3c-7.7 76.3-41.3 147-96.6 201.8zM952 462.4l-2.6-28.2c-8.5-92.1-49.4-179-115.2-244.6A399.4 399.4 0 00589 74.6L560.7 72c-4.7-.4-8.7 3.2-8.7 7.9V464c0 4.4 3.6 8 8 8l384-1c4.7 0 8.4-4 8-8.6zm-332.2-58.2V147.6a332.24 332.24 0 01166.4 89.8c45.7 45.6 77 103.6 90 166.1l-256.4.7z"}}]},name:"pie-chart",theme:"outlined"};function j(){return(j=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e}).apply(this,arguments)}let v=l.forwardRef((e,t)=>l.createElement(p.A,j({},e,{ref:t,icon:f})));var A=i(70670),w=i(90666),C=i(87286);let k={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M709.6 210l.4-.2h.2L512 96 313.9 209.8h-.2l.7.3L151.5 304v416L512 928l360.5-208V304l-162.9-94zM482.7 843.6L339.6 761V621.4L210 547.8V372.9l272.7 157.3v313.4zM238.2 321.5l134.7-77.8 138.9 79.7 139.1-79.9 135.2 78-273.9 158-274-158zM814 548.3l-128.8 73.1v139.1l-143.9 83V530.4L814 373.1v175.2z"}}]},name:"code-sandbox",theme:"outlined"};function N(){return(N=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e}).apply(this,arguments)}let S=l.forwardRef((e,t)=>l.createElement(p.A,N({},e,{ref:t,icon:k})));var O=i(25867),P=i(84254),z=i(75565),V=i(62665),T=i(89480),E=i(22782),M=i(53994),_=i(69261),L=i(66510),U=i(90617),G=i(91022);let R={notAllowed:"You are not allowed to be here."},H=()=>{let e=(0,r.useRouter)(),t=(0,l.useCallback)(()=>{(0,M.g)(async()=>{await e.push("/")})},[e]);return(0,a.jsx)(c.A,{children:(0,a.jsx)(c.A.Content,{children:(0,a.jsx)(L.A,{title:"Not allowed",children:(0,a.jsxs)(U.A,{direction:"vertical",children:[(0,a.jsxs)(o.A.Text,{children:[(0,a.jsx)(G.A,{style:{color:"red"}})," ",R.notAllowed]}),(0,a.jsxs)(o.A.Text,{children:["Go back"," ",(0,a.jsx)(m.Ay,{type:"link",onClick:t,children:"home"})]})]})})})})};var F=i(64478),I=i(9772),B=i(90393),J=i(51974),D=i(81559),q=i(10795),W=i(74495),K=i(50256),Q=i.n(K);let X=e=>{let{visible:t,title:i,children:l,onClose:s}=e;return(0,a.jsx)(L.A,{className:Q().panel,style:{display:t?"block":"none"},title:i,extra:(0,a.jsx)(m.Ay,{type:"text",icon:(0,a.jsx)(W.A,{}),onClick:s}),children:l})};var Y=i(65144),Z=i(67135),$=i(66553),ee=i(71600);let et=e=>{let{visible:t,geometry:i,setVisible:s,onEdit:n}=e,r=(0,l.useRef)(null),[o,d]=(0,l.useState)(!1);(0,l.useEffect)(()=>{r.current&&r.current.focus()});let c=(0,l.useCallback)(()=>s(!1),[s]),u=(0,l.useCallback)(async e=>{d(!0);try{await n(e),d(!1),s(!1)}catch(e){throw d(!1),e}},[s,n]);return(0,a.jsx)(ee.Ay,{title:"Edit the geometry's name",visible:t,initialValues:{name:i.name},onCancel:c,onOk:u,loading:o,children:(0,a.jsx)(Z.A.Item,{name:"name",label:"Name:",rules:[{required:!0,message:"Name is required"}],children:(0,a.jsx)($.A,{ref:r})})})};var ei={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"defs",attrs:{},children:[{tag:"style",attrs:{}}]},{tag:"path",attrs:{d:"M938.2 508.4L787.3 389c-3-2.4-7.3-.2-7.3 3.6V478H636V184h204v128c0 2.2 1.8 4 4 4h60c2.2 0 4-1.8 4-4V144c0-15.5-12.5-28-28-28H596c-15.5 0-28 12.5-28 28v736c0 15.5 12.5 28 28 28h284c15.5 0 28-12.5 28-28V712c0-2.2-1.8-4-4-4h-60c-2.2 0-4 1.8-4 4v128H636V546h144v85.4c0 3.8 4.4 6 7.3 3.6l150.9-119.4a4.5 4.5 0 000-7.2zM428 116H144c-15.5 0-28 12.5-28 28v168c0 2.2 1.8 4 4 4h60c2.2 0 4-1.8 4-4V184h204v294H244v-85.4c0-3.8-4.3-6-7.3-3.6l-151 119.4a4.52 4.52 0 000 7.1l151 119.5c2.9 2.3 7.3.2 7.3-3.6V546h144v294H184V712c0-2.2-1.8-4-4-4h-60c-2.2 0-4 1.8-4 4v168c0 15.5 12.5 28 28 28h284c15.5 0 28-12.5 28-28V144c0-15.5-12.5-28-28-28z"}}]},name:"split-cells",theme:"outlined"};function ea(){return(ea=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e}).apply(this,arguments)}let el=l.forwardRef((e,t)=>l.createElement(p.A,ea({},e,{ref:t,icon:ei})));var es=i(25165),en=i.n(es);let er={split:"Unable to split geoemtry"},eo=async(e,t)=>{let{message:i}=await q.A.splitStep(e,t);return i},ed=e=>{let{project:t,geometry:i}=e,[s,n]=(0,l.useState)(!1),{dispatch:r}=(0,l.useContext)(V.V2),o=(0,l.useMemo)(()=>3!==i.summary.dimension,[i.summary.dimension]),c=(0,l.useCallback)(()=>{(async()=>{n(!0);try{let e=await eo(t,i);e.length&&r((0,T.CN)({title:e}))}catch(e){r((0,T.CN)({title:er.split,err:e}))}finally{n(!1)}})().catch(console.error)},[t,i,r]);return(0,a.jsx)(d.A,{title:"Split volumes",children:(0,a.jsx)(m.Ay,{disabled:o,loading:s,className:en().noBorder,icon:(0,a.jsx)(el,{}),onClick:c})})};var ec=i(82909).hp;let eu={download:"Unable to download geometry",update:"Unable to update geometry",del:"Unable to delete geometry"},em=async e=>{let t=await q.A.download({id:e.id}),i=new File([ec.from(t.buffer).toString()],e.name+"."+t.extension),a=window.URL.createObjectURL(i),l=document.createElement("a");l.href=a,l.setAttribute("download",e.name+"."+t.extension),l.click(),l.remove()},eh=async(e,t,i)=>{await q.A.update({id:e.id},[{key:"name",value:t.name}]),e.name=t.name,await i.mutateOneGeometry(e)},eg=async(e,t,i,a)=>{await q.A.del({id:t.id});let l=e.geometries.filter(e=>e!==t.id);await a.mutateProject({id:e.id,geometries:l}),await a.delOneGeometry(t),i()},ey=e=>{var t,i,s,n,r,d;let{project:u,geometry:m,swr:h,close:g,onCleanup:y}=e,[p,b]=(0,l.useState)(!1),[x,f]=(0,l.useState)(!1),[j,v]=(0,l.useState)(!1),{dispatch:A}=(0,l.useContext)(V.V2),w=(0,l.useCallback)(()=>f(!0),[]),C=(0,l.useCallback)(()=>{(0,M.g)(async()=>{b(!0);try{await em(m)}catch(e){A((0,T.CN)({title:eu.download,err:e}))}finally{b(!1)}})},[m,A]),k=(0,l.useCallback)(async e=>{try{await eh(m,e,h)}catch(e){throw A((0,T.CN)({title:eu.update,err:e})),e}},[m,h,A]),N=(0,l.useCallback)(async()=>{v(!0);try{await eg(u,m,g,h),y(m.id)}catch(e){throw A((0,T.CN)({title:eu.del,err:e})),e}finally{v(!1)}},[u,m,h,g,y,A]);return m?(0,a.jsx)(c.A,{children:(0,a.jsx)(c.A.Content,{children:(0,a.jsx)(L.A,{size:"small",title:"Informations",actions:[(0,a.jsx)(ed,{project:{id:u.id},geometry:{id:m.id,summary:m.summary}},"split"),(0,a.jsx)(F.fd,{loading:p,onDownload:C},"download"),(0,a.jsxs)("div",{children:[(0,a.jsx)(et,{visible:x,geometry:{id:null==m?void 0:m.id,name:null==m?void 0:m.name},setVisible:f,onEdit:k}),(0,a.jsx)(F.lg,{onEdit:w})]},"edit"),(0,a.jsx)(F.et,{loading:j,text:(0,a.jsxs)(a.Fragment,{children:["Are you sure you want to delete the geometry"," ",(0,a.jsx)(o.A.Text,{strong:!0,children:m.name}),"?"]}),onDelete:N},"delete")],children:(0,a.jsxs)(U.A,{direction:"vertical",className:en().fullWidth,children:[(0,a.jsxs)(o.A.Text,{children:[(0,a.jsx)("span",{className:en().textLight,children:"File:"})," ",m.name," "]}),(0,a.jsxs)(o.A.Text,{children:[(0,a.jsx)("span",{className:en().textLight,children:"Unit:"})," ",(0,a.jsx)(Y.A.Inline,{text:"m"})]}),(0,a.jsxs)(a.Fragment,{children:[3===m.summary.dimension&&(0,a.jsxs)(o.A.Text,{children:[(0,a.jsx)("span",{className:en().textLight,children:"Number of solids:"})," ",null!=(n=null==(t=m.summary.solids)?void 0:t.length)?n:0]}),(0,a.jsxs)(o.A.Text,{children:[(0,a.jsx)("span",{className:en().textLight,children:"Number of faces:"})," ",null!=(r=null==(i=m.summary.faces)?void 0:i.length)?r:0]}),2===m.summary.dimension&&(0,a.jsxs)(o.A.Text,{children:[(0,a.jsx)("span",{className:en().textLight,children:"Number of edges:"})," ",null!=(d=null==(s=m.summary.edges)?void 0:s.length)?d:0]})]})]})})})}):(0,a.jsx)(_.A.Simple,{})};var ep=i(51614),eb=i(71964),ex=i.n(eb),ef=i(82909).hp;let ej={add:"Unable to add geometry"},ev=e=>e.name.toLowerCase().includes(".stp")||e.name.toLowerCase().includes(".step")||e.name.toLowerCase().includes(".dxf"),eA=async e=>{let t=new FileReader;return new Promise(i=>{t.addEventListener("load",()=>{i(t.result)}),t.readAsArrayBuffer(e)})},ew=async(e,t,i)=>{if("uploading"===t.file.status)return!0;if("done"===t.file.status){let a=await eA(t.file.originFileObj),l=await q.A.add({id:e.id},{name:t.file.name,uid:t.file.uid,buffer:ef.from(a)});await i.addOneGeometry(l),await i.mutateProject({id:e.id,geometries:[...e.geometries,l.id]})}return!1},eC=e=>{let{visible:t,project:i,swr:s,setVisible:n}=e,[r,d]=(0,l.useState)(!1),{dispatch:c}=(0,l.useContext)(V.V2),u=(0,l.useCallback)(()=>n(!1),[n]),m=(0,l.useCallback)(e=>{(0,M.g)(async()=>{try{let t=await ew(i,e,s);d(t),n(t)}catch(e){c((0,T.CN)({title:ej.add,err:e})),d(!1)}})},[i,s,n,c]);return(0,a.jsx)(ee.Ay,{title:"Upload geometry",visible:t,onCancel:u,cancelButtonProps:{loading:r},children:(0,a.jsxs)(U.A,{direction:"vertical",className:en().fullWidth,children:[(0,a.jsx)(ep.A,{className:ex().upload,action:"/api/noop",accept:".stp,.step,.dxf",showUploadList:!1,listType:"picture-card",beforeUpload:ev,onChange:m,children:(0,a.jsx)("div",{children:r?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(O.A,{style:{fontSize:25}}),(0,a.jsxs)("div",{style:{marginTop:8},children:[(0,a.jsx)("b",{children:"Loading"}),", converting, ..."]})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(P.A,{style:{fontSize:25}}),(0,a.jsxs)("div",{style:{marginTop:8},children:[(0,a.jsx)("b",{children:"Choose a file"})," or drop it here"]})]})})}),(0,a.jsx)(o.A.Text,{children:(0,a.jsx)("p",{style:{color:"rgba(0, 0, 0, 0.45)",textAlign:"center"},children:"Native file format preferred: STEP (3D) or DXF (2D) file"})})]})})};var ek=i(14237),eN=i(91423),eS=i(59597),eO=i(27758),eP=i(94292),ez=i(15109),eV=i.n(ez),eT=i(70593);let eE=n()(()=>Promise.all([i.e(5334),i.e(7391),i.e(683),i.e(5037),i.e(2930),i.e(5046),i.e(3998)]).then(i.bind(i,61192)).then(e=>e.default.Renderer),{loadableGenerated:{webpack:()=>[61192]},ssr:!1}),eM={part:"Unable to load part",snapshot:"Unable to save snapshot"},e_=async(e,t,i)=>"geometry"===i?{...await q.A.getPart({id:t.id}),extra:{id:t.id}}:{...await eP.A.load({id:e.id},{originPath:t.originPath,glb:t.glb}),extra:{name:t.name,glb:t.glb,fields:t.extra}},eL=async(e,t,i)=>{let a=[];for(let l of i){let i=t.find(e=>{var t;return(null==(t=e.extra)?void 0:t.glb)===l.glb});if(i){a.push(i);continue}let s=await e_(e,l,"result");a.push(s)}return a},eU=async(e,t,i)=>{if(!i)return;let a=t.find(e=>{var t;return(null==(t=e.extra)?void 0:t.glb)===i.glb});return a||await e_(e,i,"result")},eG=async(e,t,i)=>{let a=[];for(let l of i){let i=t.find(e=>{var t;return(null==(t=e.extra)?void 0:t.id)===l.id});if(i){a.push(i);continue}let s=await e_(e,l,"geometry");a.push(s)}return a},eR=e=>{let{project:t,simulation:i,geometries:s,results:n,postprocessing:r}=e,[o,d]=(0,l.useState)([]),[c,u]=(0,l.useState)(!1),[m,h]=(0,l.useState)(!1),[g,y]=(0,l.useState)(!1),{enabled:p,part:b,highlighted:x,selected:f,point:j,type:v,dispatch:A}=(0,l.useContext)(I.CW),{dispatch:w}=(0,l.useContext)(V.V2),[C]=D.A.useSimulation(null==i?void 0:i.id);(0,E.A)(()=>{(async()=>{u(!0);let e=[];if(i&&!r){let t=await eL(i,o,n);e.push(...t)}if(i){let t=await eU(i,o,r);t&&e.push(t)}if(!n.length&&!r){let t=await eG(i,o,s);e.push(...t)}d(e)})().catch(e=>{w((0,T.CN)({title:eM.part,err:e})),u(!1)}).finally(()=>u(!1))},[i,s,n,r,o,w]),(0,l.useEffect)(()=>{if("0"===C.id)return void h(!1);let e=C.tasks,t=null==e?void 0:e.map(e=>e.datas).filter(e=>e).flat();(null==t?void 0:t.length)?h(!0):h(!1)},[C]),(0,l.useEffect)(()=>{if(null==i?void 0:i.scheme.configuration.run.postprocessing){let e=!1;o.forEach(t=>{"result"===t.summary.type&&(e=!0)}),e?y(!0):y(!1)}else y(!1)},[i,o]);let k=(0,l.useCallback)(async e=>{try{await eO.A.add({name:"snapshot",uid:"snapshot_"+(0,eN.A)(),data:e},{id:t.id})}catch(e){w((0,T.CN)({title:eM.snapshot,err:e}))}},[t.id,w]),N=(0,l.useCallback)(e=>{A((0,eS.Zt)(e))},[A]),S=(0,l.useCallback)(e=>{A((0,eS.Lt)(e))},[A]),P=(0,l.useCallback)(e=>{A((0,eS.rO)(e))},[A]),z=(0,l.useCallback)(()=>{A((0,eS.XO)(!0))},[A]),M=(0,l.useCallback)(()=>{A((0,eS.wI)(!0))},[A]);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{style:{display:c?"flex":"none"},className:eV().loading,children:(0,a.jsx)(ek.A,{indicator:(0,a.jsx)(O.A,{style:{fontSize:80},spin:!0})})}),(0,a.jsx)(eE,{theme:eT.A,style:{width:"calc(100vw - 256px)"},parts:o,selection:{enabled:p,part:b,type:v,highlighted:x,selected:f,point:j,onHighlight:N,onSelect:S,onPoint:P},data:m,postProcessing:g,snapshot:{project:{apiRoute:k,size:{width:520,height:312}}},onData:z,onPostProcessing:M})]})};var eH=i(16856),eF=i(51189),eI=i.n(eF);let eB=n()(()=>Promise.all([i.e(3684),i.e(2099),i.e(4195)]).then(i.bind(i,4195)),{loadableGenerated:{webpack:()=>[4195]},ssr:!1}),eJ={geometries:{label:"GEOMETRIES",key:"geometries"},simulations:{label:"SIMULATIONS",key:"simulations"}},eD={user:"Unable to get user",project:"Unable to get project",simulations:"Unable to get simulations",geometries:"Unable to get geometries",add:"Unable to add simulation"},eq=async(e,t,i)=>{var a;let l=await D.A.add({id:e.id},{name:t.name,scheme:t});await i.addOneSimulation(l),await i.mutateProject({id:e.id,simulations:[...null!=(a=e.simulations)?a:[],l.id]})},eW=e=>{let{visible:t,geometry:i,panel:s,add:n,del:r,close:d}=e,c=(0,l.useCallback)(e=>{var t,a,l;e.stopPropagation(),(null==s||null==(l=s.props)||null==(a=l.children)||null==(t=a.type)?void 0:t.name)===ey.name&&d(),r(i)},[i,s,r,d]),u=(0,l.useCallback)(e=>{e.stopPropagation(),n(i)},[i,n]);return(0,a.jsxs)("div",{children:[(0,a.jsx)(o.A.Text,{ellipsis:{tooltip:!0},children:i.name}),t?(0,a.jsx)(h.A,{onClick:c}):(0,a.jsx)(g.A,{onClick:u})]})},eK=e=>{let{simulation:t}=e;return t.scheme.userModelId?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(d.A,{title:"User algorithm",placement:"right",children:(0,a.jsx)(x,{style:{position:"absolute",top:0,left:14,fontSize:14,color:"#fad114"}})}),(0,a.jsx)(o.A.Text,{ellipsis:!0,children:t.name})]}):(0,a.jsx)(a.Fragment,{children:t.name})},eQ=()=>{let e=(0,r.useRouter)(),{page:t,workspaceId:i,projectId:s}=e.query,[n,d]=(0,l.useState)(!1),[h,g]=(0,l.useState)([]),[y,p]=(0,l.useState)(!1),[b,x]=(0,l.useState)(),[f,j]=(0,l.useState)([]),[k,N]=(0,l.useState)(),[L,U]=(0,l.useState)(),[G,R]=(0,l.useState)(),[W,K]=(0,l.useState)(!0),{dispatch:Q}=(0,l.useContext)(V.V2),[Y,{errorUser:Z,loadingUser:$}]=B.A.useUser(),[ee,{mutateProject:et,errorProject:ei,loadingProject:ea}]=J.A.useProject(s),el=(0,l.useMemo)(()=>"0"===ee.id?void 0:ee,[ee]),[es,{addOneSimulation:er,delOneSimulation:eo,mutateOneSimulation:ed,errorSimulations:ec,loadingSimulations:eu}]=D.A.useSimulations(null==el?void 0:el.simulations),[em,{addOneGeometry:eh,delOneGeometry:eg,mutateOneGeometry:ep,errorGeometries:eb,loadingGeometries:ex}]=q.A.useGeometries(null==el?void 0:el.geometries),ef=(0,l.useCallback)(()=>d(!0),[]),ej=(0,l.useCallback)(()=>p(!0),[]),ev=(0,l.useCallback)(()=>p(!1),[]),eA=(0,l.useCallback)(e=>{g(t=>[...t,e])},[]),ew=(0,l.useCallback)(e=>{let t=h.findIndex(t=>t.id===e.id);-1!==t&&g(e=>[...e.slice(0,t),...e.slice(t+1)])},[h]),ek=(0,l.useCallback)(()=>{R(void 0),U(void 0)},[]),eN=(0,l.useCallback)(e=>{let t=em.findIndex(t=>t.id===e);-1!==t&&g(e=>[...e.slice(0,t),{id:"0",needCleanup:!0},...e.slice(t+1)])},[em]),eS=(0,l.useCallback)(e=>{let t=em.find(t=>t.id===e);t&&(h.find(t=>t.id===e)||g(e=>[...e,{...t,visible:!0}]),R((0,a.jsx)(X,{visible:!0,title:"Geometry",onClose:ek,children:(0,a.jsx)(ey,{project:{id:el.id,geometries:el.geometries},geometry:{id:t.id,name:t.name,summary:t.summary},swr:{mutateProject:et,mutateOneGeometry:ep,delOneGeometry:eg},close:ek,onCleanup:eN})})))},[el,em,h,et,ep,eg,eN,ek]),eO=(0,l.useCallback)(e=>{R((0,a.jsx)(X,{visible:!0,title:"About",onClose:ek,children:(0,a.jsx)(eH.Ay.About,{project:{id:el.id,simulations:el.simulations},simulation:{id:e.id,name:e.name,scheme:e.scheme},swr:{mutateProject:et,addOneSimulation:er,delOneSimulation:eo,mutateOneSimulation:ed}})}))},[el,et,er,eo,ed,ek]),eP=(0,l.useCallback)(e=>{R((0,a.jsx)(X,{visible:!0,title:"Geometry",onClose:ek,children:(0,a.jsx)(eH.Ay.Geometry,{geometries:em,simulation:{id:e.id,scheme:e.scheme},setGeometries:g,swr:{mutateOneSimulation:ed}})}))},[em,ed,ek]),ez=(0,l.useCallback)(e=>{R((0,a.jsx)(X,{visible:!0,title:"Parameters",onClose:ek,children:(0,a.jsx)(eH.Ay.Parameters,{simulation:{id:e.id,scheme:e.scheme},swr:{mutateOneSimulation:ed}})}))},[ed,ek]),eV=(0,l.useCallback)((e,t)=>{R((0,a.jsx)(X,{visible:W,title:"Materials",onClose:ek,children:(0,a.jsx)(eH.Ay.Materials,{geometries:t,simulation:{id:e.id,scheme:e.scheme},swr:{mutateOneSimulation:ed},setVisible:K})}))},[W,ed,ek]),eT=(0,l.useCallback)(e=>{R((0,a.jsx)(X,{visible:!0,title:"Initialization",onClose:ek,children:(0,a.jsx)(eH.Ay.Initialization,{simulations:es,simulation:e,swr:{mutateOneSimulation:ed}})}))},[es,ed,ek]),eE=(0,l.useCallback)((e,t)=>{R((0,a.jsx)(X,{visible:W,title:"Boundary conditions",onClose:ek,children:(0,a.jsx)(eH.Ay.BoundaryConditions,{geometries:t,simulation:{id:e.id,scheme:e.scheme},swr:{mutateOneSimulation:ed},setVisible:K})}))},[W,ed,ek]),eM=(0,l.useCallback)(e=>{R((0,a.jsx)(X,{visible:W,title:"Run",onClose:ek,children:(0,a.jsx)(eH.Ay.Run,{geometries:h,simulation:{id:e.id,scheme:e.scheme},results:f,setResults:j,setPostprocessing:N,setVisible:K,swr:{mutateOneSimulation:ed}})}))},[h,f,W,ed,ek]),e_=(0,l.useCallback)((e,t)=>{var i,a;let l=es.find(t=>t.id===e);if(!l)return;x(l);let s=(null!=(a=null==(i=l.scheme.configuration)?void 0:i.geometry.children)?a:[]).map(e=>{let t=e.value;if(t)return em.find(e=>e.id===t)}).filter(e=>e);switch(s.length&&g(s),t){case"about":eO(l);break;case"geometry":eP(l);break;case"parameters":ez(l);break;case"materials":eV(l,s);break;case"initialization":eT(l);break;case"boundaryConditions":eE(l,s);break;case"run":eM(l);break;default:R(void 0)}},[em,es,eO,eP,ez,eV,eT,eE,eM]),eL=(0,l.useCallback)(()=>{(0,M.g)(async()=>{await e.push({pathname:"/dashboard",query:{page:t,workspaceId:i}})})},[e,t,i]),eU=(0,l.useCallback)(e=>{let t,{keyPath:i}=e,a=i.pop(),l=i.pop(),s=i.pop();s&&(t=s.split("&").pop()),U({key:a,id:l,item:t})},[]),eG=(0,l.useCallback)(async e=>{try{await eq(el,e.model,{addOneSimulation:er,mutateProject:et}),p(!1)}catch(e){Q((0,T.CN)({title:eD.add,err:e}))}},[el,er,et,Q]),eF=(0,l.useCallback)(e=>{if(ex)return!0;let t=!0;for(let i of e.children){let a=i.value;a&&!em.filter(e=>e.id===a).length&&(e.done=!1,t=!1)}return t},[em,ex]);(0,l.useEffect)(()=>{(0,M.g)(async()=>{$||Y||await e.replace("/login")})},[Y,$,e]),(0,l.useEffect)(()=>{Z&&Q((0,T.CN)({title:eD.user,err:Z})),ei&&Q((0,T.CN)({title:eD.project,err:ei})),ec&&Q((0,T.CN)({title:eD.simulations,err:ec})),eb&&Q((0,T.CN)({title:eD.geometries,err:eb}))},[Z,ei,ec,eb,Q]),(0,E.A)(()=>{ea||ex||em.length?d(!1):d(!0)},[ea,ex,em]),(0,E.A)(()=>{if(!ex)if(h.length){let e=!1,t=h.map(t=>{let i=em.find(e=>e.id===(null==t?void 0:t.id));return i?JSON.stringify({...i,visible:void 0})!==JSON.stringify({...t,visible:void 0})?(e=!0,i):t:(e=!0,null)}).filter(e=>e);e&&g(t)}else g(em[0]?[em[0]]:[])},[ex,em,h],[g]),(0,E.A)(()=>{if(!eu&&b){let e=es.find(e=>e.id===(null==b?void 0:b.id));e?JSON.stringify(e)!==JSON.stringify(b)&&(x(e),L&&L.key===eJ.simulations.key&&e_(L.id,L.item)):(ek(),x(void 0))}},[es,eu,b,L],[x,ek]),(0,E.A)(()=>{L&&(L.key===eJ.geometries.key?eS(L.id):(e_(L.id,L.item),"run"!==L.item&&(j([]),N(void 0))))},[L,W,f],[eS,e_,ek]),(0,l.useEffect)(()=>{!f.length&&k&&N(void 0)},[f,k]);let eQ=(0,l.useMemo)(()=>em.map(e=>{let t=h.find(t=>t.id===e.id);return{key:e.id,icon:(0,a.jsx)(v,{}),label:(0,a.jsx)(eW,{visible:!!t,geometry:e,panel:G,add:eA,del:ew,close:ek})}}),[em,h,G,eA,ew,ek]),eX=(0,l.useMemo)(()=>es.map(e=>{let t=e.scheme.configuration||{},i=[];return Object.keys(t).forEach(l=>{if("dimension"===l)return;let s=t[l],n=(0,a.jsx)(A.A,{style:{color:"green"}});s.error?n=(0,a.jsx)(w.A,{style:{color:"red"}}):s.done||(n=(0,a.jsx)(C.A,{style:{color:"orange"}})),"geometry"!==l||eF(s)||(n=(0,a.jsx)(C.A,{style:{color:"orange"}})),i[s.index]={key:e.id+"&"+l,disabled:!h.length,icon:n,label:s.title}}),{key:e.id,icon:(0,a.jsx)(S,{}),label:(0,a.jsx)(eK,{simulation:e}),children:[{key:e.id+"&about",disabled:!h.length,icon:(0,a.jsx)(A.A,{style:{color:"green"}}),label:"About"},...i]}}),[h,es,eF]);return!Y||$||ea?(0,a.jsx)(_.A.Simple,{}):el?(0,a.jsx)(I.Ay,{children:(0,a.jsxs)(c.A,{hasSider:!0,children:[(0,a.jsxs)(c.A.Sider,{theme:"light",className:eI().sider,width:256,children:[(0,a.jsx)("div",{className:en().logo,children:(0,a.jsx)("img",{src:"/images/logo.svg",alt:"Tanatloc"})}),(0,a.jsx)(u.A,{className:eI().menu1,mode:"inline",items:[{key:"menu-go-back",disabled:!0,style:{cursor:"unset",margin:"10px 0",paddingLeft:10},label:(0,a.jsx)(F.ee,{className:en().fullWidth,onClick:eL,children:"Return to dashboard"})},{type:"divider"},{key:"title",disabled:!0,className:"Menu-title",label:(0,a.jsx)(o.A.Paragraph,{ellipsis:{tooltip:!0,rows:2},children:el.title})}]}),(0,a.jsx)("div",{className:eI().menuScroll,children:(0,a.jsx)(u.A,{mode:"inline",className:eI().menu2,defaultOpenKeys:[eJ.geometries.key,eJ.simulations.key],items:[{key:eJ.geometries.key,className:"SubMenu",icon:ex?(0,a.jsx)(O.A,{}):(0,a.jsx)(v,{}),label:(0,a.jsxs)(o.A.Text,{strong:!0,children:[eJ.geometries.label," (",em.length,")"]}),children:[{key:"new_geometry",disabled:!0,label:(0,a.jsx)(m.Ay,{icon:(0,a.jsx)(P.A,{}),onClick:ef,children:"New Geometry"})},{key:"geometry-needed",disabled:!0,className:h.length?"display-none":"",icon:(0,a.jsx)(C.A,{style:{color:"red"}}),label:"A Geometry is needed"},...eQ]},{key:eJ.simulations.key,className:"SubMenu",icon:eu?(0,a.jsx)(O.A,{}):(0,a.jsx)(S,{}),label:(0,a.jsxs)(o.A.Text,{strong:!0,children:[eJ.simulations.label," (",es.length,")"]}),children:[{key:"new_simulation",disabled:!0,label:(0,a.jsx)(m.Ay,{disabled:!em.length,icon:(0,a.jsx)(z.A,{}),onClick:ej,children:"New Simulation"})},...eX]}],onClick:eU})})]}),(0,a.jsxs)(c.A.Content,{className:en().noScroll,style:{position:"relative"},children:[(0,a.jsx)(eC,{visible:n,project:{id:el.id,geometries:el.geometries},swr:{mutateProject:et,addOneGeometry:eh},setVisible:d}),(0,a.jsx)(eH.Ay.Selector,{user:{id:Y.id,authorizedplugins:Y.authorizedplugins,usermodels:Y.usermodels},visible:y,onOk:eG,onCancel:ev}),(0,a.jsx)(eH.Ay.Updater,{user:{authorizedplugins:Y.authorizedplugins},simulation:b&&{id:b.id,scheme:b.scheme},swr:{mutateOneSimulation:ed}}),G,(0,a.jsx)(eR,{project:{id:el.id,title:el.title},simulation:b&&{id:b.id,scheme:b.scheme},geometries:h.map(e=>{if("0"!==e.id)return{id:e.id,needCleanup:e.needCleanup}}).filter(e=>e),results:f.map(e=>({name:e.name,glb:e.glb,originPath:e.originPath,extra:e.extra})),postprocessing:k&&{glb:k.glb,originPath:k.originPath}}),(0,a.jsx)(eB,{simulation:b&&{id:b.id,name:b.name}}),(0,a.jsx)(eH.Ay.Postprocessing,{simulation:b&&{id:b.id,scheme:b.scheme},results:f.map(e=>({name:e.name,fileName:e.fileName,originPath:e.originPath})),postprocessing:k&&{name:k.name,fileName:k.fileName},setResult:N})]})]})}):(0,a.jsx)(H,{})}},71964:e=>{e.exports={upload:"add_upload__OHzcC"}},91022:(e,t,i)=>{"use strict";i.d(t,{A:()=>r});var a=i(14232);let l={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M193 796c0 17.7 14.3 32 32 32h574c17.7 0 32-14.3 32-32V563c0-176.2-142.8-319-319-319S193 386.8 193 563v233zm72-233c0-136.4 110.6-247 247-247s247 110.6 247 247v193H404V585c0-5.5-4.5-10-10-10h-44c-5.5 0-10 4.5-10 10v171h-75V563zm-48.1-252.5l39.6-39.6c3.1-3.1 3.1-8.2 0-11.3l-67.9-67.9a8.03 8.03 0 00-11.3 0l-39.6 39.6a8.03 8.03 0 000 11.3l67.9 67.9c3.1 3.1 8.1 3.1 11.3 0zm669.6-79.2l-39.6-39.6a8.03 8.03 0 00-11.3 0l-67.9 67.9a8.03 8.03 0 000 11.3l39.6 39.6c3.1 3.1 8.2 3.1 11.3 0l67.9-67.9c3.1-3.2 3.1-8.2 0-11.3zM832 892H192c-17.7 0-32 14.3-32 32v24c0 4.4 3.6 8 8 8h688c4.4 0 8-3.6 8-8v-24c0-17.7-14.3-32-32-32zM484 180h56c4.4 0 8-3.6 8-8V76c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v96c0 4.4 3.6 8 8 8z"}}]},name:"alert",theme:"outlined"};var s=i(3755);function n(){return(n=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e}).apply(this,arguments)}let r=a.forwardRef((e,t)=>a.createElement(s.A,n({},e,{ref:t,icon:l})))}}]);