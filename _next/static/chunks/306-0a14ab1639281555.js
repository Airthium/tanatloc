(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[306],{72735:function(e,t,i){"use strict";i.d(t,{Z:function(){return a}});var l=i(83755);let n=async(e,t)=>{let i=await (0,l.R)("/api/avatar",{method:"POST",headers:{Accept:"application/json"},body:JSON.stringify({file:e,project:t})});return i.json()};var a={add:n}},33900:function(e,t,i){"use strict";i.d(t,{Z:function(){return u}});var l=i(59734),n=i(67294),a=i(83755);let r=async(e,t)=>{let i=await (0,a.R)("/api/geometry",{method:"POST",body:JSON.stringify({project:e,geometry:t})});return i.json()},s=async(e,t)=>{await (0,a.R)("/api/geometry/"+e.id,{method:"PUT",body:JSON.stringify(t)})},o=async e=>{await (0,a.R)("/api/geometry/"+e.id,{method:"DELETE"})},d=async e=>{let t=await (0,a.R)("/api/geometry/"+e.id+"/download");return t.json()},c=async e=>{let t=await (0,a.R)("/api/geometry/"+e.id+"/part");return t.json()};var u={useGeometries:e=>{var t;let{data:i,error:r,mutate:s}=(0,l.ZP)(["/api/geometries",JSON.stringify({ids:e})],e=>{let[t,i]=e;return(0,a._)(t,i)}),o=null!==(t=null==i?void 0:i.geometries)&&void 0!==t?t:[],d=(0,n.useCallback)(async e=>{let t=[...o,e];await s({geometries:t})},[o,s]),c=(0,n.useCallback)(async e=>{let t=o.filter(t=>t.id!==e.id);await s({geometries:t})},[o,s]),u=(0,n.useCallback)(async e=>{let t=o.map(t=>(t.id===e.id&&(t={...t,...e}),t));await s({geometries:t})},[o,s]);return[o,{addOneGeometry:d,delOneGeometry:c,mutateOneGeometry:u,errorGeometries:r,loadingGeometries:!i}]},add:r,update:s,del:o,download:d,getPart:c}},90306:function(e,t,i){"use strict";let l;i.d(t,{ZP:function(){return tj}});var n=i(85893),a=i(5152),r=i.n(a),s=i(11163),o=i(67294),d=i(65400),c=i.n(d),u=i(16373),m=i(12386),p=i(94055),h=i(53740),x=i(50685),y=i(96621),f=i(48138),g=i(92018),w=i(3855),b=i(4851),v=i(35855),j=i(61093),P=i(14552),C=i(42419),k=i(34265),M=i(55359),Z=i(830),E=i(36642),S=i(94725),A=i(70302),z=i(74048),N=i(14527),D=()=>{let e=(0,s.useRouter)(),t=(0,o.useCallback)(()=>{(async()=>{await e.push("/")})()},[e]);return(0,n.jsx)(u.Z,{children:(0,n.jsx)(u.Z.Content,{children:(0,n.jsx)(A.Z,{title:"Not allowed",children:(0,n.jsxs)(z.default,{direction:"vertical",children:[(0,n.jsxs)(h.Z.Text,{children:[(0,n.jsx)(N.Z,{style:{color:"red"}})," ","You are not allowed to be here."]}),(0,n.jsxs)(h.Z.Text,{children:["Go back"," ",(0,n.jsx)(c(),{type:"link",onClick:t,children:"home"})]})]})})})})},L=i(51302),T=i(48474),O=i(42661),F=i(77149),R=i(72616),_=i(33900),U=i(83482),I=i(68847),V=i.n(I),B=e=>{let{visible:t,title:i,children:l,onClose:a}=e;return(0,n.jsx)(A.Z,{className:V().panel,style:{display:t?"block":"none"},title:i,extra:(0,n.jsx)(c(),{type:"text",icon:(0,n.jsx)(U.default,{}),onClick:a}),children:l})},H=i(62585),W=i(28465),G=i(86373),X=i(14856),J=i.n(X),K=i(87819),Y=i.n(K),q=i(48764).lW;let $={add:"Unable to add geometry"},Q=e=>e.name.toLowerCase().includes(".stp")||e.name.toLowerCase().includes(".step")||e.name.toLowerCase().includes(".dxf"),ee=async e=>{let t=new FileReader;return new Promise(i=>{t.addEventListener("load",()=>{i(t.result)}),t.readAsArrayBuffer(e)})},et=async(e,t,i,l)=>{if("uploading"===t.file.status)return!0;if("done"===t.file.status){let n=await ee(t.file.originFileObj);try{let l=await _.Z.add({id:e.id},{name:t.file.name,uid:t.file.uid,buffer:q.from(n)});await i.addOneGeometry(l),await i.mutateProject({id:e.id,geometries:[...e.geometries,l.id]})}catch(e){throw l((0,Z.iT)({title:$.add,err:e})),e}}return!1};var ei=i(97538),el=i(51024),en=e=>{let{visible:t,geometry:i,setVisible:l,onEdit:a}=e,r=(0,o.useRef)(null),[s,d]=(0,o.useState)(!1);(0,o.useEffect)(()=>{r.current&&r.current.focus()});let c=(0,o.useCallback)(()=>l(!1),[l]),u=(0,o.useCallback)(async e=>{d(!0);try{await a(e),d(!1),l(!1)}catch(e){throw d(!1),e}},[l,a]);return(0,n.jsx)(G.ZP,{title:"Edit the geometry's name",visible:t,initialValues:{name:i.name},onCancel:c,onOk:u,loading:s,children:(0,n.jsx)(ei.Z.Item,{name:"name",label:"Name:",rules:[{required:!0,message:"Name is required"}],children:(0,n.jsx)(el.default,{ref:r})})})},ea=i(48764).lW;let er={download:"Unable to download geometry",update:"Unable to update geometry",del:"Unable to delete geometry"},es=async(e,t)=>{try{let t=await _.Z.download({id:e.id}),i=new File([ea.from(t.buffer).toString()],e.name+"."+t.extension),l=window.URL.createObjectURL(i),n=document.createElement("a");n.href=l,n.setAttribute("download",e.name+"."+t.extension),n.click(),n.remove()}catch(e){t((0,Z.iT)({title:er.download,err:e}))}},eo=async(e,t,i,l)=>{try{await _.Z.update({id:e.id},[{key:"name",value:t.name}]),e.name=t.name,await i.mutateOneGeometry(e)}catch(e){throw l((0,Z.iT)({title:er.update,err:e})),e}},ed=async(e,t,i,l,n)=>{try{await _.Z.del({id:e.id});let n=t.geometries.filter(t=>t!==e.id);await l.mutateProject({id:t.id,geometries:n}),await l.delOneGeometry(e),i()}catch(e){throw n((0,Z.iT)({title:er.del,err:e})),e}},ec=e=>{var t,i,l,a,r,s;let{project:d,geometry:c,swr:m,close:p,onCleanup:x}=e,[y,f]=(0,o.useState)(!1),[g,w]=(0,o.useState)(!1),[b,v]=(0,o.useState)(!1),{dispatch:j}=(0,o.useContext)(M.uj),P=(0,o.useCallback)(()=>w(!0),[]),C=(0,o.useCallback)(()=>{(async()=>{f(!0);try{await es(c,j)}catch(e){}finally{f(!1)}})()},[c,j]),k=(0,o.useCallback)(async e=>eo(c,e,m,j),[c,m,j]),Z=(0,o.useCallback)(async()=>{v(!0);try{await ed(c,d,p,m,j),x(c.id)}finally{v(!1)}},[d,c,m,p,x,j]);return c?(0,n.jsx)(u.Z,{children:(0,n.jsx)(u.Z.Content,{children:(0,n.jsx)(A.Z,{size:"small",title:"Informations",actions:[(0,n.jsx)(L.o6,{loading:y,onDownload:C},"download"),(0,n.jsxs)("div",{children:[(0,n.jsx)(en,{visible:g,geometry:{id:null==c?void 0:c.id,name:null==c?void 0:c.name},setVisible:w,onEdit:k}),(0,n.jsx)(L.w6,{onEdit:P})]},"edit"),(0,n.jsx)(L.m1,{loading:b,text:(0,n.jsxs)(n.Fragment,{children:["Are you sure you want to delete the geometry"," ",(0,n.jsx)(h.Z.Text,{strong:!0,children:c.name}),"?"]}),onDelete:Z},"delete")],children:(0,n.jsxs)(z.default,{direction:"vertical",className:J().fullWidth,children:[(0,n.jsxs)(h.Z.Text,{children:[(0,n.jsx)("span",{className:J().textLight,children:"File:"})," ",c.name," "]}),(0,n.jsxs)(h.Z.Text,{children:[(0,n.jsx)("span",{className:J().textLight,children:"Unit:"})," ",(0,n.jsx)(H.Z.Inline,{text:"m"})]}),(0,n.jsxs)(n.Fragment,{children:[3===c.summary.dimension&&(0,n.jsxs)(h.Z.Text,{children:[(0,n.jsx)("span",{className:J().textLight,children:"Number of solids:"})," ",null!==(a=null===(t=c.summary.solids)||void 0===t?void 0:t.length)&&void 0!==a?a:0]}),(0,n.jsxs)(h.Z.Text,{children:[(0,n.jsx)("span",{className:J().textLight,children:"Number of faces:"})," ",null!==(r=null===(i=c.summary.faces)||void 0===i?void 0:i.length)&&void 0!==r?r:0]}),2===c.summary.dimension&&(0,n.jsxs)(h.Z.Text,{children:[(0,n.jsx)("span",{className:J().textLight,children:"Number of edges:"})," ",null!==(s=null===(l=c.summary.edges)||void 0===l?void 0:l.length)&&void 0!==s?s:0]})]})]})})})}):(0,n.jsx)(S.Z.Simple,{})};ec.componentName="Geometry",ec.Add=e=>{let{visible:t,project:i,swr:l,setVisible:a}=e,[r,s]=(0,o.useState)(!1),{dispatch:d}=(0,o.useContext)(M.uj),c=(0,o.useCallback)(()=>a(!1),[a]),u=(0,o.useCallback)(e=>{(async()=>{try{let t=await et(i,e,l,d);s(t),a(t)}catch(e){s(!1)}})()},[i,l,a,d]);return(0,n.jsx)(G.ZP,{title:"Upload geometry",visible:t,onCancel:c,cancelButtonProps:{loading:r},children:(0,n.jsxs)(z.default,{direction:"vertical",className:J().fullWidth,children:[(0,n.jsx)(W.Z,{className:Y().upload,action:"/api/noop",accept:".stp,.step,.dxf",showUploadList:!1,listType:"picture-card",beforeUpload:Q,onChange:u,children:(0,n.jsx)("div",{children:r?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(b.default,{style:{fontSize:25}}),(0,n.jsxs)("div",{style:{marginTop:8},children:[(0,n.jsx)("b",{children:"Loading"}),", converting, ..."]})]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(v.Z,{style:{fontSize:25}}),(0,n.jsxs)("div",{style:{marginTop:8},children:[(0,n.jsx)("b",{children:"Choose a file"})," or drop it here"]})]})})}),(0,n.jsx)(h.Z.Text,{children:(0,n.jsx)("p",{style:{color:"rgba(0, 0, 0, 0.45)",textAlign:"center"},children:"Native file format preferred: STEP (3D) or DXF (2D) file"})})]})})};var eu=i(10739),em=i(74253),ep=i(82891),eh=i(89552),ex=i(40987),ey=i(32246),ef=i(62681),eg=i(54831),ew=i(46019),eb=i(34463),ev=i(55508),ej=i(29051),eP=i(81451),eC=i(25256),ek=i(20891),eM=i(77367),eZ=i(65772),eE=i(29257),eS=i(92511),eA=i(84831),ez=i(99477),eN=i(57632),eD=i(40782),eL=i(79753),eT=i(54327),eO=e=>{let t=new ez.fHI(.025,.025,.8,50);t.translate(0,.4,0);let i=new ez.vBJ({color:e}),l=new ez.Kj0(t,i),n=new ez.b_z(.05,.2,50);n.translate(0,.9,0);let a=new ez.vBJ({color:e}),r=new ez.Kj0(n,a),s=new ez.ZAu;return s.type="ArrowHelper",s.add(l),s.add(r),s.dispose=()=>{t.dispose(),i.dispose(),n.dispose(),a.dispose()},s};let eF=(e,t,i)=>{var l,n,a;let r=document.createElement("canvas");r.width=null!==(l=null==i?void 0:i.width)&&void 0!==l?l:256,r.height=256;let s=r.getContext("2d");(null==i?void 0:i.background)&&(s.fillStyle=i.background,s.fillRect(0,0,r.width,r.height)),s.fillStyle=null!==(n=null==i?void 0:i.fillStyle)&&void 0!==n?n:"grey",s.font="50px sans-serif",s.textAlign=null!==(a=null==i?void 0:i.align)&&void 0!==a?a:"center",s.textBaseline="middle",s.fillText(t,r.width/2,r.height/2);let o=new ez.xEZ(r);o.flipY=!0,o.needsUpdate=!0;let d=new ez.xeV({map:o,transparent:!0,depthWrite:!1});d.map.anisotropy=e.capabilities.getMaxAnisotropy();let c=new ez.jyi(d);return c.type="LabelHelper",(null==i?void 0:i.position)&&c.position.copy(i.position),(null==i?void 0:i.scale)&&c.scale.setScalar(i.scale),c.dispose=()=>{o.dispose(),d.dispose()},c},eR=function(e,t){let{offsetWidth:i,offsetHeight:l,width:n,height:a}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{offsetWidth:0,offsetHeight:0,width:150,height:150},r=i,s=l,o=n,d=a,c=eO("red");c.rotateZ(-Math.PI/2);let u=eF(e,"X",{position:new ez.Pa4(1.1,0,0)}),m=eO("green"),p=eF(e,"Y",{position:new ez.Pa4(0,1.1,0)}),h=eO("blue");h.rotateX(Math.PI/2);let x=eF(e,"Z",{position:new ez.Pa4(0,0,1.1)}),y=new ez.xo$(.05,50,50),f=new ez.vBJ({color:"black"}),g=new ez.Kj0(y,f),w=new ez.ZAu;w.type="AxisHelper",w.add(c),w.add(u),w.add(m),w.add(p),w.add(h),w.add(x),w.add(g);let b=new ez.xsS;b.add(w);let v=new ez.iKG(-1.2,1.2,1.2,-1.2,-2,2);return{dispose:()=>{y.dispose(),f.dispose(),w.children.forEach(e=>{("ArrowHelper"===e.type||"LabelHelper"===e.type)&&e.dispose()}),b.remove(w)},render:()=>{e.setViewport(r,s,o,d),v.rotation.copy(t.rotation),e.render(b,v)},resize:e=>{let{newOffsetWidth:t,newOffsetHeight:i,newWidth:l,newHeight:n}=e;r=t,s=i,o=l,d=n}}},e_=(e,t,i,l,n,a)=>{let{smooth:r,radius:s,left:o,down:d}=n,{xc:c,yc:u,uc:m,vc:p}=a;for(let n=0;n<=r;n++){let a=Math.PI/2*(e+n/r),h=Math.cos(a),x=Math.sin(a);if(t.push(c+s*h,u+s*x,0),i.push(m+o*h,p+d*x),n<r){let t=(r+1)*e+n+4;l.push(e,t,t+1)}}},eU=(e,t,i,l)=>{let n=e/2-i,a=t/2-i,r=i/e,s=(e-i)/e,o=i/t,d=(t-i)/t,c=[n,a,0,-n,a,0,-n,-a,0,n,-a,0],u=[s,d,r,d,r,o,s,o],m=[3*(l+1)+3,3*(l+1)+4,l+4,l+5,2*(l+1)+4,2,1,2*(l+1)+3,3,4*(l+1)+3,4,0],p=[m[0],m[1],m[2],m[0],m[2],m[3],m[4],m[5],m[6],m[4],m[6],m[7],m[8],m[9],m[10],m[8],m[10],m[11]];for(let e=0;e<4;e++){let t=e<1||e>2?n:-n,m=e<2?a:-a,h=e<1||e>2?s:r,x=e<2?d:o;e_(e,c,u,p,{smooth:l,radius:i,left:r,down:o},{xc:t,yc:m,uc:h,vc:x})}let h=new ez.u9r;return h.setIndex(new ez.lCJ(p,1)),h.setAttribute("position",new ez.a$l(c,3)),h.setAttribute("uv",new ez.a$l(u,2)),h},eI=function(e,t,i,l){let{offsetWidth:n,offsetHeight:a,width:r,height:s}=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{offsetWidth:0,offsetHeight:0,width:150,height:150},o="#d3d3d3",d=null,c=null,u=[{text:"FRONT",normal:new ez.Pa4(0,0,1),up:new ez.Pa4(0,1,0)},{text:"BACK",normal:new ez.Pa4(0,0,-1),up:new ez.Pa4(0,1,0)},{text:"RIGHT",normal:new ez.Pa4(1,0,0),up:new ez.Pa4(0,1,0)},{text:"LEFT",normal:new ez.Pa4(-1,0,0),up:new ez.Pa4(0,1,0)},{text:"UP",normal:new ez.Pa4(0,1,0),up:new ez.Pa4(0,0,-1)},{text:"DOWN",normal:new ez.Pa4(0,-1,0),up:new ez.Pa4(0,0,1)}],m=eU(75,75,25,20),p=new ez.xo$(37.5,10,10,0,Math.PI,0),h=new ez.ZAu;u.forEach(e=>{let t=document.createElement("canvas"),i=t.getContext("2d");t.width=t.height=256,i.fillStyle=o,i.fillRect(0,0,t.width,t.height),i.font="bold 50pt sans-serif",i.fillStyle="#000000",i.textAlign="center",i.textBaseline="middle",i.fillText(e.text,t.width/2,t.height/2);let l=new ez.ROQ(t);l.needsUpdate=!0;let n=new ez.vBJ({map:l,transparent:!0,opacity:.75}),a=new ez.vBJ({color:o}),r=new ez.Kj0(m,n),s=new ez.Kj0(m,a);s.rotateY(Math.PI);let d=new ez.vBJ({color:o,transparent:!0,opacity:.2}),c=new ez.Kj0(p,d),u=new ez.ZAu;u.add(r,s,c),u.lookAt(e.normal),u.translateZ(50),u.normal=e.normal,u.up=e.up,h.add(u)});let x=new ez.Mig("#ffffff",1),y=new ez.xsS;y.add(h),y.add(x);let f=new ez.iKG(-100,100,100,-100,-100,100);f.position.z=2;let g=new ez.iMs,w=e=>{let t=b(e);if(v(t)){var i,l;d=j(t),P(),(null===(i=d)||void 0===i?void 0:i.uuid)!==(null===(l=c)||void 0===l?void 0:l.uuid)&&(C(),c=d)}else d=null,C()},b=e=>{let t=e.target,i=t.getBoundingClientRect(),l=e.clientX-i.left,o=e.clientY-i.top,d=new ez.FM8;return d.x=(l-n)/r*2-1,d.y=-(2*((o+s-i.height+a)/s))+1,d},v=e=>e.x>-1&&e.x<1&&e.y>-1&&e.y<1,j=e=>{let t=new ez.Pa4(e.x,e.y,-1);t.unproject(f);let i=new ez.Pa4;f.getWorldDirection(i),g.set(t,i);let l=g.intersectObjects(y.children,!0);return l.length?l[0].object.parent:null},P=()=>{var e,t;null===(t=d)||void 0===t||null===(e=t.children)||void 0===e||e.forEach(e=>{var t;(null===(t=e.material)||void 0===t?void 0:t.color)&&(e.material.previousColor=e.material.color,e.material.color=new ez.Ilk("#FAD114"))})},C=()=>{var e,t;null===(t=c)||void 0===t||null===(e=t.children)||void 0===e||e.forEach(e=>{var t;(null===(t=e.material)||void 0===t?void 0:t.color)&&(e.material.color=new ez.Ilk(o))})},k=e=>{if(d){var n;let a=d.normal,r=d.up,s=new ez.Pa4;null===(n=t.boundingBox)||void 0===n||n.getCenter(s);let o=i.position.distanceTo(l.target),c=a.clone().multiplyScalar(o),u=s.add(c);i.position.copy(u),i.up.copy(r),d=null,C(),w(e)}};return e.domElement.addEventListener("pointermove",w),e.domElement.addEventListener("pointerdown",k),{resize:e=>{let{newOffsetWidth:t,newOffsetHeight:i,newWidth:l,newHeight:o}=e;n=t,a=i,r=l,s=o},render:()=>{e.setViewport(n,a,r,s),f.rotation.copy(i.rotation),e.render(y,f)},dispose:()=>{e.domElement.removeEventListener("pointermove",w),e.domElement.removeEventListener("pointerdown",k),h.children.forEach(e=>{e.children.forEach(e=>{e.geometry.dispose(),e.material.dispose()})}),y.remove(h)}}};var eV=e=>1e-12>Math.abs(e)?"0":Math.abs(e)>1e3||.001>Math.abs(e)?e.toExponential(2):e.toFixed(3);let eB=(e,t,i,l)=>{let n,a,r;let s=1,o=e=>{let t=Math.max(e.x,e.y,e.z),i=Math.max(Math.ceil(e.x/t*5),2),l=Math.max(Math.ceil(e.y/t*5),2),n=Math.max(Math.ceil(e.z/t*5),2);return new ez.Pa4(i,l,n)},d=(e,t,i,l,n)=>{let a=new ez.ZAu,r=new ez.nls({color:8947848}),s=new ez.Pa4(-e/2,0,-t/2),o=e/(i-1),d=t/(l-1);for(let t=0;t<l;++t){let i=new ez.u9r().setFromPoints([new ez.Pa4(s.x,0,s.z+t*d),new ez.Pa4(s.x+e,0,s.z+t*d)]);a.add(new ez.x12(i,r))}for(let e=0;e<i;++e){let i=new ez.u9r().setFromPoints([new ez.Pa4(s.x+e*o,0,s.z),new ez.Pa4(s.x+e*o,0,s.z+t)]);a.add(new ez.x12(i,r))}return null==n||n(a),a},c=(t,i,l,n)=>{let a=new ez.ZAu,r=Math.abs(i-t),o=r/(n-1),d=new ez.Pa4().copy(l).multiplyScalar(-r/2),c=new ez.Pa4().copy(l).multiplyScalar(o),u=t;for(let t=0;t<n;++t){let t=eF(e,eV(u*s));t.position.copy(d),a.add(t),d.add(c),u+=o}return a},u=()=>{let e=t.boundingBox,i=t.boundingSphere.center,l=new ez.Pa4(e.max.x-e.min.x,e.max.y-e.min.y,e.max.z-e.min.z),r=o(l);a=1*(n=.1*Math.max(l.x,l.y,l.z));let s=new ez.ZAu,u=d(l.x,l.z,r.x,r.z),m=d(l.x,l.y,r.x,r.y,e=>{e.rotateX(Math.PI/2)}),p=d(l.y,l.z,r.y,r.z,e=>{e.rotateZ(-Math.PI/2)});s.add(u,m,p);let x=c(e.min.x,e.max.x,new ez.Pa4(1,0,0),r.x),y=c(e.min.y,e.max.y,new ez.Pa4(0,1,0),r.y),f=c(e.min.z,e.max.z,new ez.Pa4(0,0,1),r.z);return s.add(x,y,f),s.position.set(i.x,i.y,i.z),s.type="GridHelper",s.dispose=h,s},m=e=>e<=0?-1:1,p=e=>.5>=Math.abs(e)?1:-1,h=()=>{var e;null===(e=r)||void 0===e||e.children.forEach(e=>{e.children.forEach(e=>{if("Line"===e.type){let t=e.geometry;t.dispose();let i=e.material;i.dispose()}else e.dispose()})})};return{dispose:h,setVisible:e=>{r.visible=e},setScale:e=>{s=e},update:()=>{let e=t.boundingBox,s=new ez.Pa4(e.max.x-e.min.x,e.max.y-e.min.y,e.max.z-e.min.z),o=!1;t.children.forEach(e=>{"GridHelper"===e.type&&(o=e.visible,t.remove(e),e.dispose())}),r=u();let d=l.object.position.distanceTo(l.target);r.traverse(e=>{"LabelHelper"===e.type&&e.scale.setScalar(.05*d)});let c=new ez.Pa4;i.getWorldDirection(c);let h=d/10/(l.minDistance+.001),x=r.children[0],y=r.children[1],f=r.children[2];x.position.set(0,m(c.y)*(s.y/2+n),0),y.position.set(0,0,m(c.z)*(s.z/2+n)),f.position.set(m(c.x)*(s.x/2+n),0,0);let g=r.children[3],w=r.children[4],b=r.children[5];g.position.set(0,m(c.y)*p(c.y)*(s.y/2+a),-(m(c.z)*p(c.y)*(s.z/2+a))),w.position.set(m(c.x)*p(c.x)*(s.x/2+a),0,-(m(c.z)*p(c.x)*(s.z/2+a))),b.position.set(m(c.x)*p(c.x)*(s.x/2+a),-(m(c.y)*p(c.x)*(s.y/2+a)),0);let v=.2*h,j=.3*h;g.visible=Math.abs(c.y)>v||Math.abs(c.z)>j,w.visible=Math.abs(c.x)>j||Math.abs(c.z)>j,b.visible=Math.abs(c.x)>j||Math.abs(c.y)>v,r.visible=o,t.add(r)}}},eH=(e,t,i,l)=>{let n=document.createElement("div");n.style.pointerEvents="none",n.style.border="1px solid #55aaff",n.style.backgroundColor="rgba(75, 160, 255, 0.3)",n.style.position="fixed";let a=new ez.FM8,r=new ez.FM8,s=new ez.FM8,o=new ez.FM8,d=!1,c=!1,u=new ez.iMs,m=()=>{d=!1},p=e=>{d&&0===e.button&&(c=!0,y(e))},h=e=>{d&&c&&f(e)},x=e=>{c=!1,d&&g(e)};e.domElement.addEventListener("pointerdown",p),e.domElement.addEventListener("pointermove",h),e.domElement.addEventListener("pointerup",x);let y=t=>{l.enabled=!1,e.domElement.parentElement.appendChild(n),n.style.left=t.clientX+"px",n.style.top=t.clientY+"px",n.style.width="0px",n.style.height="0px",a.x=t.clientX,a.y=t.clientY},f=e=>{o.x=Math.max(a.x,e.clientX),o.y=Math.max(a.y,e.clientY),s.x=Math.min(a.x,e.clientX),s.y=Math.min(a.y,e.clientY),n.style.left=s.x+"px",n.style.top=s.y+"px",n.style.width=o.x-s.x+"px",n.style.height=o.y-s.y+"px"},g=e=>{l.enabled=!0,n.parentElement&&n.parentElement.removeChild(n),r.x=e.clientX,r.y=e.clientY;let t=new ez.TUj(a,r);w(t),m()},w=n=>{let a=new ez.FM8(Math.abs(n.max.x-n.min.x),Math.abs(n.max.y-n.min.y));if(a.x<5||a.y<5)return;let r=new ez.FM8((n.max.x+n.min.x)/2,(n.max.y+n.min.y)/2),s=e.domElement.getBoundingClientRect(),o=r.x-s.left,d=r.y-s.top,c=new ez.FM8(o/s.width*2-1,-(2*(d/s.height))+1),m=t.children.find(e=>"Part"===e.type);if(!m)return;u.setFromCamera(c,i);let p=u.intersectObject(m);if(!p.length)return;l.target.copy(p[0].point);let h=new ez.FM8(a.x/s.width,a.y/s.height),x=Math.max(h.x,h.y),y=i.position.distanceTo(l.target),f=l.target.clone().sub(i.position).normalize().multiplyScalar(y*(1-x));i.position.add(f)};return{dispose:()=>{e.domElement.removeEventListener("pointerdown",p),e.domElement.removeEventListener("pointermove",h),e.domElement.removeEventListener("pointerup",x)},end:m,isEnabled:()=>d,start:()=>{d=!0}}},eW=(e,t,i,l)=>{let n,a,r;let s=new ez.Ilk("#fad114"),o=new ez.Ilk("#E98A15"),d=new ez.Pa4(-1,0,0),c=new ez.JOQ(d),u={up:new ez.Pa4,forward:new ez.Pa4,right:new ez.Pa4},m=new ez.Pa4,p=new ez.Pa4,h=new ez.USm,x=new ez.Pa4,y=new ez.FM8,f=new ez.JOQ,g=new ez.Pa4,w=new ez.Pa4,b=new ez.Zzh,v={up:new ez.Pa4,forward:new ez.Pa4,right:new ez.Pa4},j=new ez.iMs,P=new ez.ZAu;P.type="SectionViewHelper",P.visible=!1,t.add(P),(()=>{let e=new ez._12(1,1),t=new ez.vBJ({color:s,side:ez.ehD,transparent:!0,opacity:.5}),i=new ez.Kj0(e,t);i.type="Plane",P.add(i)})(),(()=>{let e=new ez.xo$(.2,32,32,Math.PI,-Math.PI),t=new ez.vBJ({color:s,side:ez.ehD,transparent:!0,opacity:.5}),i=new ez.Kj0(e,t);i.type="Dome",P.add(i)})(),(()=>{class e extends ez.Hyl{getPoint(e){return new ez.Pa4().set(this.radius*Math.cos(Math.PI*e),this.radius*Math.sin(Math.PI*e),0)}constructor(e){super(),this.radius=e}}let t=new e(.2);{let e=new ez.WXh(t,32,.020000000000000004,32),i=new ez.vBJ({color:s,side:ez.ehD,transparent:!0,opacity:.5}),l=new ez.Kj0(e,i);l.rotateX(Math.PI/2),l.type="ArcX",P.add(l)}{let e=new ez.WXh(t,32,.020000000000000004,32),i=new ez.vBJ({color:s,side:ez.ehD,transparent:!0,opacity:.5}),l=new ez.Kj0(e,i);l.rotateX(Math.PI/2),l.rotateY(Math.PI/2),l.type="ArcY",P.add(l)}})();let C=()=>{let e=new ez.Pa4;t.boundingBox.getSize(e),e.multiplyScalar(1.2);let i=Math.max(Math.max(e.x,e.y),e.z);P.scale.setScalar(i)},k=()=>{let e=new ez.Pa4;t.boundingBox.getCenter(e),P.position.copy(e)},M=()=>{P.rotateX(Math.PI);let e=c.normal.multiplyScalar(-1);c.setFromNormalAndCoplanarPoint(e,P.position)},Z=e=>{let t=e.target,i=t.getBoundingClientRect(),l=e.clientX-i.left,n=e.clientY-i.top,a=new ez.FM8;return a.x=l/i.width*2-1,a.y=-(2*(n/i.height))+1,a},E=e=>{n&&n.material.color.set(s),n=e,e&&e.material.color.set(o)},S=()=>{l.enabled=!0},A=()=>{l.enabled=!1},z=()=>{i.getWorldDirection(u.forward),u.forward.normalize(),u.up.copy(i.up).normalize(),u.right.crossVectors(u.up,u.forward).normalize()},N=()=>{let e=new ez.Pa4(0,0,1).applyQuaternion(P.quaternion).multiplyScalar(-1);c.setFromNormalAndCoplanarPoint(e,P.position)},D=e=>{if(!P.visible)return;let t=Z(e);if(j.setFromCamera(t,i),a){var l,n;let e=new ez.Pa4;j.ray.intersectPlane(f,e),(null===(l=r)||void 0===l?void 0:l.type)==="Plane"?T(e):(null===(n=r)||void 0===n?void 0:n.type)==="Dome"?F(t):_(e),N()}else{let e=j.intersectObject(P);e.length?(A(),E(r=e[0].object),p.copy(e[0].point),z()):(r=null,E(),S())}},L=()=>{f.setFromNormalAndCoplanarPoint(u.forward,p),m.copy(P.position);let e=new ez.Pa4;j.ray.intersectPlane(f,e),g.copy(e).sub(m),w.copy(g).normalize(),b.set(m,new ez.Pa4().copy(m).add(c.normal))},T=e=>{e.sub(g);let t=new ez.Pa4;b.closestPointToPoint(e,!1,t),P.position.copy(t)},O=e=>{h.copy(P.rotation),y.copy(e)},F=e=>{P.rotation.copy(h),P.rotateOnWorldAxis(u.up,-(5*(y.x-e.x))),P.rotateOnWorldAxis(u.right,-(5*(y.y-e.y)))},R=()=>{r.getWorldDirection(x),h.copy(P.rotation),g.copy(p).sub(P.position),w.copy(g).normalize(),v.up.copy(w),v.right.copy(x),v.forward.crossVectors(v.right,v.up),b.set(p,new ez.Pa4().copy(p).add(v.forward)),f.setFromNormalAndCoplanarPoint(u.forward,p)},_=e=>{let t=l.object.position.distanceTo(l.target),i=new ez.Pa4;b.closestPointToPoint(e,!1,i);let n=p.distanceTo(i);i.sub(p);let a=new ez.Pa4().copy(w).cross(i).normalize(),r=Math.sign(x.dot(a));P.rotation.copy(h),P.rotateOnWorldAxis(x,r*n*1/(t/100))},U=e=>{var t;switch(null===(t=r)||void 0===t?void 0:t.type){case"Plane":L();break;case"Dome":O(e);break;case"ArcX":case"ArcY":R()}},I=e=>{if(P.visible&&r){a=!0;let t=Z(e);U(t)}},V=()=>{P.visible&&(a=!1,E())};return e.domElement.addEventListener("pointermove",D),e.domElement.addEventListener("pointerdown",I),e.domElement.addEventListener("pointerup",V),{getClippingPlane:()=>c,toggleVisible:()=>{let e=P.visible;P.visible=!e},start:()=>{e.localClippingEnabled=!0,P.visible=!0,C(),k();let t=new ez.Pa4().copy(P.position).sub(d);P.lookAt(t),c.setFromNormalAndCoplanarPoint(d,P.position)},stop:()=>{e.localClippingEnabled=!1,P.visible=!1},toAxis:e=>{if(k(),d.equals(e)){M();return}let t=new ez.Pa4().copy(P.position).sub(e);P.lookAt(t),c.setFromNormalAndCoplanarPoint(e,P.position),d.copy(e)},flip:M,dispose:()=>{P.traverse(e=>{("Plane"===e.type||"Dome"===e.type||"ArcX"===e.type||"ArcY"===e.type)&&(e.geometry.dispose(),e.material.dispose())}),e.domElement.removeEventListener("pointermove",D),e.domElement.removeEventListener("pointerdown",I),e.domElement.removeEventListener("pointerup",V)}}};var eG=i(54104);let eX=e=>{let t=new eG.A("rainbow",512);t.setMin(Number.MAX_VALUE),t.setMax(-Number.MAX_VALUE);let i=new ez.xsS,l=new ez.iKG(-1,1,1,-1,2,1);l.position.set(0,0,1);let n=new ez.ZAu;i.add(n);let a=!1,r=1,s=0,o=()=>{i.children.forEach(e=>{e.children.forEach(t=>{"LabelHelper"===t.type&&t.dispose(),"Sprite"===t.type&&t.dispose(),e.remove(t)})})},d=t=>{let i=eV(t.minV*r+s),l=eV(t.maxV*r+s),a=eF(e,String(i),{background:"white",fillStyle:"black",position:new ez.Pa4(-.62,0,0),width:512,align:"right"});a.scale.x=.4,a.scale.y=2.8,a.renderOrder=0;let o=eF(e,String(l),{background:"white",fillStyle:"black",position:new ez.Pa4(.62,0,0),width:512,align:"left"});o.scale.x=.4,o.scale.y=2.8,o.renderOrder=0,n.add(a),n.add(o)};return{render:()=>{let t=e.domElement.getBoundingClientRect();e.setViewport(t.width/2-350,t.height-50,700,50),e.render(i,l)},addLUT:e=>{if(!a){let i=t.minV,l=t.maxV;t.setMin(Math.min(i,e.minV)),t.setMax(Math.max(l,e.maxV))}let i=new ez.ROQ(t.createCanvas()),l=new ez.xeV({map:i,depthWrite:!1}),r=new ez.jyi(l);r.material.rotation=-Math.PI/2,r.scale.x=.2,r.scale.y=1.2,r.renderOrder=1,r.dispose=r.material.dispose,n.add(r),d(t)},getMinV:()=>t.minV,getMaxV:()=>t.maxV,getColor:e=>t.getColor(e),setUnit:t=>{var i,l,a;let o=eF(e,String("Unit: "+(null!==(i=null==t?void 0:t.label)&&void 0!==i?i:1)),{background:"white",fillStyle:"black",position:new ez.Pa4(0,.5,0),width:512});o.scale.x=.4,o.scale.y=2.8,o.renderOrder=0,n.add(o),r=null!==(l=null==t?void 0:t.multiplicator)&&void 0!==l?l:1,s=null!==(a=null==t?void 0:t.adder)&&void 0!==a?a:0},setVisible:e=>{i.children.forEach(t=>{t.children.forEach(t=>t.visible=e)})},setColorMap:e=>{t.setColorMap(e,512)},setRange:(e,i)=>{a=!0,t.setMin(e),t.setMax(i)},setAutomaticRange:()=>{a=!1,t.setMin(Number.MAX_VALUE),t.setMax(-Number.MAX_VALUE)},dispose:()=>{a||(t.setMin(Number.MAX_VALUE),t.setMax(-Number.MAX_VALUE)),o()}}},eJ=e=>{let t=new ez.ZAu;t.type="PointHelper",t.visible=!1,e.add(t);let i=()=>{var t,i;let l=(null!==(i=null===(t=e.boundingSphere)||void 0===t?void 0:t.radius)&&void 0!==i?i:1)/100,n=new ez.xo$(l),a=new ez.Wid({color:16711680});return new ez.Kj0(n,a)},l=(e,t)=>{let i=new ez.u9r().setFromPoints([e,t]),l=new ez.nls({color:16711680});return new ez.x12(i,l)},n=()=>{let t=[],i=e.boundingBox.max.x-e.boundingBox.min.x,n=e.boundingBox.max.y-e.boundingBox.min.y,a=e.boundingBox.max.z-e.boundingBox.min.z,r=Math.max(i,n,a),s=l(new ez.Pa4(-r/2,0,0),new ez.Pa4(r/2,0,0));t.push(s);let o=l(new ez.Pa4(0,-r/2,0),new ez.Pa4(0,r/2,0));t.push(o);let d=l(new ez.Pa4(0,0,-r/2),new ez.Pa4(0,0,r/2));return t.push(d),t},a=()=>{t.children.forEach(e=>{t.remove(e),e.geometry.dispose(),e.material.dispose()})};return{build:()=>{a();let e=i(),l=n();t.add(e),t.add(...l)},dispose:a,update:e=>{e?(t.position.set(e.x,e.y,e.z),t.visible=!0):t.visible=!1}}};var eK=i(77836),eY=i(82854),eq=i(6648),e$=i(48764).lW;let eQ=(e,t)=>{e.traverse(e=>{if("Mesh"===e.type){let i=new ez.Uk6(e.geometry),l=new ez.nls({color:e.material.color,linewidth:1}),n=new ez.ejS(i,l);e.add(n),e.material.visible=!1,e.material.clippingPlanes=[t]}})},e0=(e,t)=>{e.traverse(e=>{if("Mesh"===e.type||"Line"===e.type){let i=e.geometry.getAttribute("data");if(i){let t=i.array.reduce((e,t)=>Math.min(e,t),i.array[0]),l=i.array.reduce((e,t)=>Math.max(e,t),i.array[0]);t===l&&(t-=1,l+=1);let n=new eG.A;n.setMin(t),n.setMax(l),e.userData={...e.userData,lut:n}}if("Mesh"===e.type){let t=new ez.Uk6(e.geometry),i=new ez.nls({linewidth:1}),l=new ez.ejS(t,i);e.add(l)}e.material.vertexColors=!0,e.material.clippingPlanes=[t]}})},e1=(e,t)=>{e.traverse(e=>{"Mesh"===e.type&&(e.material.clippingPlanes=[t],e.material.originalColor=e.material.color)})},e2=(e,t)=>{let i=new ez.Ilk("#FAD114"),l=new ez.Ilk("#EE9817"),n=async(e,t,i,l)=>{let n=new Blob([e$.from(e.buffer)]),d=URL.createObjectURL(n),c=new eK.E,u=new eY._;u.setDecoderPath("/three/libs/draco/"),c.setDRACOLoader(u);let m=new eq.a;m.setTranscoderPath("node_modules/three//examples/js/libs/basis/"),c.setKTX2Loader(m);let p=await new Promise((e,t)=>{c.load(d,t=>{e(t)},()=>void 0,e=>t(e))}),g=p.scene,w=new ez.Tme;return w.type="Part",w.uuid=e.summary.uuid,w.children=g.children,w.userData=g.userData,"mesh"===e.summary.type?eQ(w,l):"result"===e.summary.type?e0(w,l):("geometry3D"===e.summary.type||"geometry2D"===e.summary.type)&&e1(w,l),s(w,t),o(w,i),w.boundingBox=a(w),w.dispose=()=>r(w),w.setTransparent=e=>s(w,e),w.setDisplayMesh=e=>o(w,e),w.startSelection=(e,t,i)=>y(w,e,t,i),w.stopSelection=()=>f(),w.getHighlighted=()=>h,w.getSelected=()=>x,w.highlight=k,w.unhighlight=M,w.select=E,w.unselect=S,w},a=e=>{let t=new ez.ZzF;return e.traverse(e=>{t.expandByObject(e)}),t},r=e=>{e.traverse(e=>{"Mesh"===e.type&&(e.geometry.dispose(),e.material.dispose())})},s=(e,t)=>{e.traverse(e=>{"Mesh"===e.type&&(e.material.transparent=t,e.material.opacity=t?.5:1,e.material.depthWrite=!t)})},o=(e,t)=>{"result"===e.userData.type&&e.traverse(e=>{e.traverse(e=>{"LineSegments"===e.type&&(e.visible=t)})})},d=new ez.iMs,c=null,u=null,m=null,p=null,h=null,x=[],y=(e,t,i,l)=>{c=e,u=l,m=t,p=i,h=null,x.length=0,m.domElement.addEventListener("pointermove",C),m.domElement.addEventListener("pointerdown",Z)},f=()=>{var e,t;null===(e=m)||void 0===e||e.domElement.removeEventListener("pointermove",C),null===(t=m)||void 0===t||t.domElement.removeEventListener("pointerdown",Z),M(),h=null,x.forEach(e=>{S(e.uuid)}),x.length=0,u=null,c=null,m=null,p=null},g=(e,t)=>{let i;if(e&&t)return e.traverse(e=>{e.userData.uuid===t&&(i=e)}),i},w=e=>{let t=e.target,i=t.getBoundingClientRect(),l=e.clientX-i.left,n=e.clientY-i.top,a=new ez.FM8;return a.x=l/i.width*2-1,a.y=-(2*(n/i.height))+1,a},b=()=>{let t=d.intersectObject(c,!0);if(t.length){let i=t[0].object,l=i.parent;l&&e(c,l.userData.uuid,l.userData.label)}else e(c)},v=()=>{let t;let i=c.userData;if(2===i.dimension){if((t=d.intersectObject(c,!0)).length){let i=t[0].object,l=i.parent;(null==l?void 0:l.type)==="Mesh"?e(c,l.userData.uuid,l.userData.label):e(c,i.userData.uuid,i.userData.label)}else e(c)}else if((t=d.intersectObject(c,!0)).length){let i=t[0].object;e(c,i.userData.uuid,i.userData.label)}else e(c)},j=()=>{let t;let i=c.userData,l=i.edges;if((t=d.intersectObject(c,!0)).length){let i=t[0].object,n=null==l?void 0:l.find(e=>e.uuid===i.userData.uuid);n?e(c,i.userData.uuid,i.userData.label):e(c)}else e(c)},P=()=>{let t=d.intersectObject(c,!0);if(t.length){let i=t[0];e(c,void 0,void 0,i.point)}else e(c)},C=e=>{let t=w(e);switch(d.setFromCamera(t,p),u){case"solids":b();break;case"faces":v();break;case"edges":j();break;case"point":P()}},k=e=>{var t;if(e===(null===(t=h)||void 0===t?void 0:t.uuid))return;M();let l=g(c,e);l&&(h={uuid:l.userData.uuid,label:l.userData.label},"Mesh"===l.type?l.material.color=i:l.traverse(e=>{"Mesh"===e.type&&(e.material.color=i)}))},M=()=>{var e;let t=g(c,null===(e=h)||void 0===e?void 0:e.uuid);if(h=null,!t)return;let i=x.findIndex(e=>e.uuid===t.userData.uuid);"Mesh"===t.type?t.material.color=-1===i?t.material.originalColor:l:t.traverse(e=>{"Mesh"===e.type&&(e.material.color=-1===i?e.material.originalColor:l)})},Z=()=>{h&&t(c,h.uuid,h.label)},E=e=>{let t=g(c,e);t&&(x.push({uuid:e,label:t.userData.label}),"Mesh"===t.type?t.material.color=l:t.traverse(e=>{"Mesh"===e.type&&(e.material.color=l)}))},S=e=>{let t=g(c,e),i=x.findIndex(t=>t.uuid===e);-1!==i&&(x=[...x.slice(0,i),...x.slice(i+1)]),t&&("Mesh"===t.type?t.material.color=t.material.originalColor:t.traverse(e=>{"Mesh"===e.type&&(e.material.color=e.material.originalColor)}))};return{load:n}};var e4=i(72735),e5=i(60968),e3=i.n(e5);let e8={load:"Error while loading part",snapshot:"Error while taking snapshot",saveScreenshot:"Unable to save screenshot"},e7=!1,e6=e=>{let t=new ez.ZzF;e.children.forEach(e=>{if(e.visible&&"Part"===e.type){let i=e.boundingBox,l=new ez.Pa4(Math.min(t.min.x,i.min.x),Math.min(t.min.y,i.min.y),Math.min(t.min.z,i.min.z)),n=new ez.Pa4(Math.max(t.max.x,i.max.x),Math.max(t.max.y,i.max.y),Math.max(t.max.z,i.max.z));t.set(l,n)}});let i=new ez.aLr;t.getBoundingSphere(i),e.boundingBox=t,e.boundingSphere=i},e9=(e,t,i)=>{let l=t.object.position.distanceTo(t.target),n=t.target.clone().sub(e.position).normalize().multiplyScalar(l*i*.01);e.position.add(n)},te=(e,t,i)=>{let l=e.children.find(e=>"Part"===e.type);if(!l)return;e7=!0;let n=e.boundingSphere,a=n.center,r=2*n.radius,s=r/(2*Math.atan(Math.PI*t.fov/360)),o=s/t.aspect,d=1.1*Math.max(s,o),c=i.target.clone().sub(t.position).normalize().multiplyScalar(d);i.target.copy(a),i.minDistance=d/10,i.maxDistance=10*d,t.position.copy(a).sub(c),t.near=d/100,t.far=100*d,t.updateProjectionMatrix()},tt=async(e,t,i,l,n,a,r)=>{var s,o,d;let c=e2((e,t,i,l)=>{t?(e.highlight(t),setTimeout(()=>r((0,eD.CH)({uuid:t,label:i})),1)):l?r((0,eD.N7)({x:l.x,y:l.y,z:l.z})):(e.unhighlight(),setTimeout(()=>r((0,eD.HW)()),1))},(e,t,i)=>{let l=e.getSelected();l.find(e=>e.uuid===t)?(e.unselect(t),setTimeout(()=>r((0,eD.hF)({uuid:t,label:i})),1)):(e.select(t),setTimeout(()=>r((0,eD.Ys)({uuid:t,label:i})),1))}),u=await c.load(e,n.transparent,n.displayMesh,a.sectionViewHelper.getClippingPlane());u.name=null!==(d=null===(s=e.extra)||void 0===s?void 0:s.name)&&void 0!==d?d:u.name,u.fields=null===(o=e.extra)||void 0===o?void 0:o.fields,t.add(u),e6(t),e7||te(t,i,l),a.gridHelper.update(),a.gridHelper.update(),a.gridHelper.setVisible(!0),a.pointHelper.build()},ti=(e,t)=>{for(let i of(t.dispose(),t.setVisible(!1),e.children))if("Part"===i.type&&"result"===i.userData.type){let e=i.name.split(" ").shift(),l=i.fields,n=null==l?void 0:l.find(t=>t.name===e);i.traverse(e=>{("Mesh"===e.type||"Line"===e.type)&&(t.setUnit(null==n?void 0:n.unit),t.addLUT(e.userData.lut),t.setVisible(!0))})}},tl=(e,t)=>{for(let i of(ti(e,t),e.children))"Part"===i.type&&"result"===i.userData.type&&i.traverse(e=>{if("Mesh"===e.type||"Line"===e.type){let i=e.geometry.getAttribute("data"),l=new Float32Array(3*i.count);for(let e=0;e<i.count;e++){let n=t.getColor(i.array[e]);l[3*e+0]=n.r,l[3*e+1]=n.g,l[3*e+2]=n.b}e.geometry.setAttribute("color",new ez.a$l(l,3))}})},tn=async(e,t,i,l,n)=>{try{let n=l.domElement.width,a=l.domElement.height,r=i.aspect;l.domElement.width=520,l.domElement.height=312,i.aspect=520/312,i.updateProjectionMatrix(),l.clear(),l.setViewport(0,0,520,312),l.render(t,i);let s=l.domElement.toDataURL();l.domElement.width=n,l.domElement.height=a,i.aspect=r,i.updateProjectionMatrix(),await e4.Z.add({name:"snapshot",uid:"snapshot_"+(0,eN.Z)(),data:s},{id:e.id})}catch(e){n((0,Z.iT)({title:e8.snapshot,err:e}))}},ta=(e,t,i,l,n)=>{try{let n=l.domElement.width,a=l.domElement.height;l.clear(),l.setViewport(0,0,n,a),l.render(t,i);let r=l.domElement.toDataURL(),s=document.createElement("a");s.href=r.replace("image/png","image/octet-stream"),s.download=e.title+"_"+new Date().toLocaleDateString()+".png",s.click()}catch(e){n((0,Z.iT)({title:e8.saveScreenshot,err:e}))}};var tr=e=>{var t,i,a,r,d;let{loading:m,project:h,parts:x}=e,y=(0,o.useRef)(null),f=(0,o.useRef)(),g=(0,o.useRef)(),w=(0,o.useRef)(),v=(0,o.useRef)(),j=(0,o.useRef)(),P=(0,o.useRef)(),C=(0,o.useRef)(),S=(0,o.useRef)(),A=(0,o.useRef)(),[z,N]=(0,o.useState)(!1),[D,L]=(0,o.useState)(!0),[O,F]=(0,o.useState)(!1),[R,_]=(0,o.useState)(!1),[U,I]=(0,o.useState)(!1),[V,B]=(0,o.useState)(!1),[W,X]=(0,o.useState)("m"),{enabled:K,part:Y,highlighted:q,selected:$,point:Q,type:ee,dispatch:et}=(0,o.useContext)(T.ZB),{dispatch:en}=(0,o.useContext)(M.uj),ea=(0,s.useRouter)();(0,o.useEffect)(()=>{var e;if(!eT.Z.isWebGLAvailable()){(async()=>{await ea.push("/webgl")})();return}let t=y.current,i=t.clientWidth,l=t.clientHeight;f.current=new ez.xsS,f.current.boundingBox=new ez.ZzF,f.current.boundingSphere=new ez.aLr,g.current=new ez.cPb(50,i/l,.1,1e3),g.current.position.z=10;let n=new ez.Mig("#aaa",.75);f.current.add(n);let a=new ez.cek("#fff",.5);a.decay=2,g.current.add(a),f.current.add(g.current),w.current=new ez.CP7({antialias:!0,alpha:!0,powerPreference:"high-performance"}),w.current.setClearColor("#ffffff"),w.current.setSize(i,l),w.current.setPixelRatio(null!==(e=window.devicePixelRatio)&&void 0!==e?e:1),w.current.shadowMap.enabled=!0,w.current.autoClear=!1,t.appendChild(w.current.domElement),v.current=new eL.$(g.current,t),v.current.rotateSpeed=3,v.current.panSpeed=.1;let r=eR(w.current,g.current,{offsetWidth:i-155,offsetHeight:l-155,width:150,height:150}),s=eI(w.current,f.current,g.current,v.current,{offsetWidth:i-155,offsetHeight:l-155,width:150,height:150});j.current=eB(w.current,f.current,g.current,v.current),P.current=eH(w.current,f.current,g.current,v.current),C.current=eW(w.current,f.current,g.current,v.current),S.current=eX(w.current),S.current.setVisible(!1),A.current=eJ(f.current);let o=()=>{v.current.update(),w.current.setViewport(0,0,i,l),w.current.render(f.current,g.current),j.current.update(),r.render(),s.render(),S.current.render()},d=()=>{i=t.clientWidth,l=t.clientHeight,g.current.aspect=i/l,g.current.updateProjectionMatrix(),w.current.setSize(i,l),r.resize({newOffsetWidth:i-155,newOffsetHeight:l-155,newWidth:150,newHeight:150}),s.resize({newOffsetWidth:i-155,newOffsetHeight:l-155,newWidth:150,newHeight:150}),o()},c=()=>{o(),setTimeout(()=>requestAnimationFrame(c),1e3/30)};return window.addEventListener("resize",d),requestAnimationFrame(c),()=>{e7=!1,window.removeEventListener("resize",d),t.removeChild(w.current.domElement),f.current.children.forEach(e=>{f.current.remove(e)}),r.dispose(),s.dispose(),j.current.dispose(),C.current.dispose(),P.current.dispose(),S.current.dispose(),A.current.dispose()}},[ea]),(0,E.Z)(()=>{if(!f.current)return;let e=f.current.children;if(!x.length){var t;e6(f.current),j.current.update(),null===(t=A.current)||void 0===t||t.build()}let i=x.filter(t=>!e.find(e=>e.uuid===t.summary.uuid)),l=e.filter(e=>!x.find(t=>t.summary.uuid===e.uuid)).filter(e=>"Part"===e.type);l.forEach(e=>{var t;null===(t=f.current)||void 0===t||t.remove(e),e.dispose()}),(async()=>{await Promise.all(i.map(async e=>{try{await tt(e,f.current,g.current,v.current,{transparent:z,displayMesh:D},{gridHelper:j.current,sectionViewHelper:C.current,pointHelper:A.current},et)}catch(e){en((0,Z.iT)({title:e8.load,err:e})),e6(f.current)}})),tl(f.current,S.current)})()},[x,z,D,et]),(0,E.Z)(()=>{var e;if(f.current){if((null===(e=x[0])||void 0===e?void 0:e.summary.dimension)===2){e6(f.current);let e=new ez.Pa4(0,0,1),t=new ez.Pa4(0,1,0),i=new ez.Pa4;f.current.boundingBox.getCenter(i);let l=g.current.position.distanceTo(v.current.target),n=e.clone().multiplyScalar(l),a=i.add(n);g.current.position.copy(a),g.current.up.copy(t),v.current.noRotate=!0}else v.current.noRotate=!1}},[x]),(0,o.useEffect)(()=>{f.current&&f.current.children.forEach(e=>{"Part"===e.type&&e.userData.uuid===Y&&(K?e.startSelection(w.current,g.current,ee):e.stopSelection())})},[K,Y,ee]),(0,o.useEffect)(()=>{f.current&&f.current.children.forEach(e=>{if("Part"===e.type&&e.uuid===Y){e.highlight(null==q?void 0:q.uuid);let t=e.getSelected(),i=$.filter(e=>!t.find(t=>t.uuid===e.uuid));i.forEach(t=>{t.uuid&&e.select(t.uuid)});let l=t.filter(e=>!$.find(t=>t.uuid===e.uuid));l.forEach(t=>{e.unselect(t.uuid)})}})},[Y,q,$]),(0,o.useEffect)(()=>{var e;f.current&&(null===(e=A.current)||void 0===e||e.update(Q?new ez.Pa4(Q.x,Q.y,Q.z):void 0))},[Q]);let er=(0,o.useCallback)(e=>{N(e),f.current.children.forEach(t=>{"Part"===t.type&&t.setTransparent(e)})},[]),es=(0,o.useCallback)(e=>{L(e),f.current.children.forEach(t=>{"Part"===t.type&&t.setDisplayMesh(e)})},[]),eo=(0,o.useCallback)(()=>{let e=!O;F(e),e?C.current.start():C.current.stop()},[O]),ed=(0,o.useCallback)(()=>{(async()=>{_(!0);try{await tn(h,f.current,g.current,w.current,en)}finally{_(!1)}})()},[h,en]),ec=(0,o.useCallback)(()=>{I(!0);try{ta(h,f.current,g.current,w.current,en)}finally{I(!1)}},[h,en]),eu=(0,o.useCallback)(e=>{var t;null===(t=j.current)||void 0===t||t.setVisible(e)},[]),eN=(0,o.useCallback)(()=>{e9(g.current,v.current,1),l=requestAnimationFrame(()=>eN())},[]),eD=(0,o.useCallback)(()=>{e9(g.current,v.current,-1),l=requestAnimationFrame(()=>eD())},[]),eO=(0,o.useCallback)(()=>{l&&cancelAnimationFrame(l),l=void 0},[]),eF=(0,o.useCallback)(()=>{te(f.current,g.current,v.current)},[]),e_=(0,o.useCallback)(()=>{C.current.toAxis(new ez.Pa4(-1,0,0))},[]),eU=(0,o.useCallback)(()=>{C.current.toAxis(new ez.Pa4(0,-1,0))},[]),eV=(0,o.useCallback)(()=>{C.current.toAxis(new ez.Pa4(0,0,-1))},[]),eG=(0,o.useCallback)(e=>{var t;null===(t=S.current)||void 0===t||t.setColorMap(e.key),tl(f.current,S.current)},[]),eK=(0,o.useCallback)(()=>{B(!0)},[]),eY=(0,o.useCallback)(()=>{B(!1)},[]),eq=(0,o.useCallback)(async e=>{var t;null===(t=S.current)||void 0===t||t.setRange(+e.min,+e.max),tl(f.current,S.current),eY()},[eY]),e$=(0,o.useCallback)(()=>{var e;null===(e=S.current)||void 0===e||e.setAutomaticRange(),tl(f.current,S.current)},[]),eQ=(0,o.useCallback)(e=>{var t,i;let{key:l}=e;"m"===l?null===(t=j.current)||void 0===t||t.setScale(1):null===(i=j.current)||void 0===i||i.setScale(1e3),X(l)},[]),e0=(0,o.useMemo)(()=>{let e=x.filter(e=>"result"===e.summary.type),t=e.map(e=>{var t,i,l;let n=null===(t=e.extra)||void 0===t?void 0:t.fields,a=null===(l=e.extra)||void 0===l?void 0:null===(i=l.name)||void 0===i?void 0:i.split(" ").shift(),r=null==n?void 0:n.find(e=>e.name===a);return null==r?void 0:r.units}).filter(e=>e).flat(),i=t.filter((e,i)=>t.findIndex(t=>t.label===e.label)===i);return i.map(e=>({key:e.label,multiplicator:e.multiplicator,adder:e.adder,label:(0,n.jsx)(H.Z.Inline,{text:e.label})}))},[x]);return(0,n.jsxs)(u.Z,{className:"".concat(J().noScroll," ").concat(e3().view),children:[(0,n.jsxs)(G.ZP,{visible:V,title:"Custom range",initialValues:{min:null===(t=S.current)||void 0===t?void 0:t.getMinV(),max:null===(i=S.current)||void 0===i?void 0:i.getMaxV()},onCancel:eY,onOk:eq,children:[(0,n.jsx)(ei.Z.Item,{label:"Min",name:"min",children:(0,n.jsx)(el.default,{})}),(0,n.jsx)(ei.Z.Item,{label:"Max",name:"max",children:(0,n.jsx)(el.default,{})})]}),(0,n.jsxs)(u.Z.Header,{className:e3().head,children:[(0,n.jsxs)(p.default,{title:"Units",className:e3().unit,children:[(0,n.jsx)(H.Z.Inline,{text:W}),(0,n.jsx)(ep.default,{menu:{onClick:eQ,items:[{key:"m",label:(0,n.jsx)(H.Z.Inline,{text:"m"})},{key:"mm",label:(0,n.jsx)(H.Z.Inline,{text:"mm"})}]},children:(0,n.jsx)(c(),{icon:(0,n.jsx)(eA.Z,{})})})]}),(0,n.jsx)(em.Z,{style:{margin:0}}),(0,n.jsx)(p.default,{title:"Take snapshot",placement:"left",children:(0,n.jsx)(ep.default,{placement:"bottom",menu:{items:[{key:"project",label:(0,n.jsx)(c(),{type:"text",className:"".concat(J().fullWidth," ").concat(J().noBackground),loading:R,onClick:ed,children:"Project snapshot"})},{key:"image",label:(0,n.jsx)(c(),{type:"text",className:"".concat(J().fullWidth," ").concat(J().noBackground),loading:U,onClick:ec,children:"Export image"})}]},children:(0,n.jsx)(c(),{icon:(0,n.jsx)(eg.Z,{})})})}),(0,n.jsx)(em.Z,{style:{margin:0}}),(0,n.jsx)(p.default,{title:"Display grid",placement:"left",children:(0,n.jsx)(ex.Z,{defaultChecked:!0,checkedChildren:(0,n.jsx)(ey.Z,{}),unCheckedChildren:(0,n.jsx)(ey.Z,{}),onChange:eu})}),(0,n.jsx)(p.default,{title:"Set transparency",placement:"left",children:(0,n.jsx)(ex.Z,{checked:z,checkedChildren:(0,n.jsx)(ej.Z,{}),unCheckedChildren:(0,n.jsx)(ej.Z,{}),onChange:er})}),(0,n.jsx)(em.Z,{style:{margin:0}}),(0,n.jsx)(p.default,{title:"Zoom out",placement:"left",children:(0,n.jsx)(c(),{icon:(0,n.jsx)(eb.Z,{}),onMouseDown:eD,onMouseUp:eO,onMouseOut:eO})}),(0,n.jsx)(p.default,{title:"Zoom in",placement:"left",children:(0,n.jsx)(c(),{icon:(0,n.jsx)(ew.Z,{}),onMouseDown:eN,onMouseUp:eO,onMouseOut:eO})}),(0,n.jsx)(p.default,{title:"Zoom to fit",placement:"left",children:(0,n.jsx)(c(),{icon:(0,n.jsx)(ef.Z,{}),onClick:eF})}),(0,n.jsx)(p.default,{title:"Zoom to selection",placement:"left",children:(0,n.jsx)(c(),{icon:(0,n.jsx)(ev.Z,{}),onClick:(null===(a=P.current)||void 0===a?void 0:a.isEnabled())?null===(r=P.current)||void 0===r?void 0:r.end:null===(d=P.current)||void 0===d?void 0:d.start})}),(0,n.jsx)(em.Z,{style:{margin:0}}),!O&&(0,n.jsx)(p.default,{title:"Section view",placement:"left",children:(0,n.jsx)(c(),{icon:(0,n.jsx)(eP.Z,{}),onClick:eo})}),O&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(p.default,{title:"Stop",placement:"left",children:(0,n.jsx)(c(),{icon:(0,n.jsx)(eC.Z,{}),onClick:eo})}),(0,n.jsx)(p.default,{title:"Hide plane",placement:"left",children:(0,n.jsx)(c(),{icon:(0,n.jsx)(k.default,{}),onClick:C.current.toggleVisible})}),(0,n.jsx)(p.default,{title:"Snap to X",placement:"left",children:(0,n.jsx)(c(),{className:"ant-btn-icon-only",onClick:e_,children:"X"})}),(0,n.jsx)(p.default,{title:"Snap to Y",placement:"left",children:(0,n.jsx)(c(),{className:"ant-btn-icon-only",onClick:eU,children:"Y"})}),(0,n.jsx)(p.default,{title:"Snap to Z",placement:"left",children:(0,n.jsx)(c(),{className:"ant-btn-icon-only",onClick:eV,children:"Z"})}),(0,n.jsx)(p.default,{title:"Flip",placement:"left",children:(0,n.jsx)(c(),{onClick:C.current.flip,icon:(0,n.jsx)(ek.Z,{})})})]}),x.filter(e=>"result"===e.summary.type).length?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(em.Z,{style:{margin:0}}),(0,n.jsx)(p.default,{title:"Display result mesh",placement:"left",children:(0,n.jsx)(ex.Z,{checked:D,checkedChildren:(0,n.jsx)(eM.Z,{}),unCheckedChildren:(0,n.jsx)(eM.Z,{}),onChange:es})}),(0,n.jsx)(em.Z,{style:{margin:0}}),e0.length?(0,n.jsx)(p.default,{title:"Units",children:(0,n.jsx)(ep.default,{placement:"bottom",menu:{onClick:e=>{var t;let{key:i}=e,l=e0.find(e=>e.key===i);null===(t=f.current)||void 0===t||t.children.forEach(e=>{if("Part"===e.type&&"result"===e.userData.type){let t=e.name.split(" ").shift(),n=e.fields,a=null==n?void 0:n.find(e=>e.name===t);a&&(a.unit={label:i,multiplicator:l.multiplicator,adder:l.adder})}}),tl(f.current,S.current)},items:e0},children:(0,n.jsx)(c(),{icon:(0,n.jsx)(eA.Z,{})})})}):null,(0,n.jsx)(p.default,{title:"Colormap",placement:"left",children:(0,n.jsx)(ep.default,{placement:"bottom",menu:{items:[{key:"rainbow",label:"Rainbow"},{key:"cooltowarm",label:"Cool to warm"},{key:"blackbody",label:"Black body"},{key:"grayscale",label:"Gray scale"}],onClick:eG},children:(0,n.jsx)(c(),{icon:(0,n.jsx)(eZ.Z,{})})})}),(0,n.jsx)(p.default,{title:"Custom range",placement:"left",children:(0,n.jsx)(c(),{icon:(0,n.jsx)(eE.Z,{}),onClick:eK})}),(0,n.jsx)(p.default,{title:"Automatic range",placement:"left",children:(0,n.jsx)(c(),{icon:(0,n.jsx)(eS.Z,{}),onClick:e$})})]}):null]}),(0,n.jsxs)(u.Z.Content,{className:"".concat(J().noScroll," ").concat(e3().content),children:[(0,n.jsx)("div",{style:{display:m?"flex":"none"},className:e3().loading,children:(0,n.jsx)(eh.default,{indicator:(0,n.jsx)(b.default,{style:{fontSize:80},spin:!0})})}),(0,n.jsx)("div",{ref:y,className:e3().canvas})]})]})};let ts={part:"Unable to load part"},to=async(e,t,i,l)=>{try{if("geometry"===i){let e=await _.Z.getPart({id:t.id});return{...e,extra:{id:t.id}}}{let i=await eu.Z.load({id:e.id},{originPath:t.originPath,glb:t.glb});return{...i,extra:{name:t.name,glb:t.glb,fields:t.extra}}}}catch(e){throw l((0,Z.iT)({title:ts.part,err:e})),e}},td=async(e,t,i,l)=>Promise.all(i.map(async i=>{let n=t.find(e=>{var t;return(null===(t=e.extra)||void 0===t?void 0:t.glb)===i.glb});if(n)return n;let a=await to(e,i,"result",l);return a})),tc=async(e,t,i,l)=>{if(!l)return;let n=t.find(e=>{var t;return(null===(t=e.extra)||void 0===t?void 0:t.glb)===l.glb});if(n)return n;let a=await to(e,l,"result",i);return a},tu=async(e,t,i,l)=>Promise.all(i.map(async i=>{let n=t.find(e=>{var t;return(null===(t=e.extra)||void 0===t?void 0:t.id)===i.id});if(n)return n;let a=await to(e,i,"geometry",l);return a}));var tm=e=>{let{project:t,simulation:i,geometries:l,results:a,postprocessing:r}=e,[s,d]=(0,o.useState)([]),[c,u]=(0,o.useState)(!1),{dispatch:m}=(0,o.useContext)(M.uj);return(0,E.Z)(()=>{(async()=>{u(!0);try{let e=[];if(i&&!r){let t=await td(i,s,a,m);e.push(...t)}if(i){let t=await tc(i,s,m,r);t&&e.push(t)}if(!a.length&&!r){let t=await tu(i,s,l,m);e.push(...t)}d(e)}catch(e){}finally{u(!1)}})()},[i,l,a,r,s],[m]),(0,n.jsx)(tr,{loading:c,project:{id:t.id,title:t.title},parts:s})},tp=i(91447),th=i(39095),tx=i.n(th);let ty=r()(()=>Promise.all([i.e(3857),i.e(4830)]).then(i.bind(i,4830)),{loadableGenerated:{webpack:()=>[4830]},ssr:!1}),tf={geometries:{label:"GEOMETRIES",key:"geometries"},simulations:{label:"SIMULATIONS",key:"simulations"}},tg={user:"Unable to get user",project:"Unable to get project",simulations:"Unable to get simulations",geometries:"Unable to get geometries",add:"Unable to add simulation"},tw=async(e,t,i,l)=>{try{var n;let l=await R.Z.add({id:e.id},{name:t.name,scheme:t});await i.addOneSimulation(l),await i.mutateProject({id:e.id,simulations:[...null!==(n=e.simulations)&&void 0!==n?n:[],l.id]})}catch(e){throw l((0,Z.iT)({title:tg.add,err:e})),e}},tb=e=>{let{visible:t,geometry:i,panel:l,add:a,del:r,close:s}=e,d=(0,o.useCallback)(e=>{var t,n,a;e.stopPropagation(),(null==l?void 0:null===(a=l.props)||void 0===a?void 0:null===(n=a.children)||void 0===n?void 0:null===(t=n.type)||void 0===t?void 0:t.componentName)===ec.componentName&&s(),r(i)},[i,l,r,s]),c=(0,o.useCallback)(e=>{e.stopPropagation(),a(i)},[i,a]);return(0,n.jsxs)("div",{children:[i.name,t?(0,n.jsx)(C.default,{onClick:d}):(0,n.jsx)(k.default,{onClick:c})]})},tv=e=>{let{simulation:t}=e;return t.scheme.userModelId?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(p.default,{title:"User algorithm",placement:"right",children:(0,n.jsx)(P.Z,{style:{position:"absolute",top:0,left:14,fontSize:14,color:"#fad114"}})}),t.name]}):(0,n.jsx)(n.Fragment,{children:t.name})};var tj=()=>{let e=(0,s.useRouter)(),{page:t,workspaceId:i,projectId:l}=e.query,[a,r]=(0,o.useState)(!1),[d,p]=(0,o.useState)([]),[P,C]=(0,o.useState)(!1),[k,A]=(0,o.useState)(),[z,N]=(0,o.useState)([]),[U,I]=(0,o.useState)(),[V,H]=(0,o.useState)(),[W,G]=(0,o.useState)(),[X,K]=(0,o.useState)(!0),{dispatch:Y}=(0,o.useContext)(M.uj),[q,{errorUser:$,loadingUser:Q}]=O.Z.useUser(),[ee,{mutateProject:et,errorProject:ei,loadingProject:el}]=F.Z.useProject(l),[en,{addOneSimulation:ea,delOneSimulation:er,mutateOneSimulation:es,errorSimulations:eo,loadingSimulations:ed}]=R.Z.useSimulations(null==ee?void 0:ee.simulations),[eu,{addOneGeometry:em,delOneGeometry:ep,mutateOneGeometry:eh,errorGeometries:ex,loadingGeometries:ey}]=_.Z.useGeometries(null==ee?void 0:ee.geometries),ef=(0,o.useCallback)(()=>r(!0),[]),eg=(0,o.useCallback)(()=>C(!0),[]),ew=(0,o.useCallback)(()=>C(!1),[]),eb=(0,o.useCallback)(e=>{p(t=>[...t,e])},[]),ev=(0,o.useCallback)(e=>{let t=d.findIndex(t=>t.id===e.id);-1!==t&&p(e=>[...e.slice(0,t),...e.slice(t+1)])},[d]),ej=(0,o.useCallback)(()=>{G(void 0),H(void 0)},[]),eP=(0,o.useCallback)(e=>{let t=eu.findIndex(t=>t.id===e);-1!==t&&p(e=>[...e.slice(0,t),{id:"0",needCleanup:!0},...e.slice(t+1)])},[eu]),eC=(0,o.useCallback)(e=>{let t=eu.find(t=>t.id===e);if(!t)return;let i=d.find(t=>t.id===e);i||p(e=>[...e,{...t,visible:!0}]),G((0,n.jsx)(B,{visible:!0,title:"Geometry",onClose:ej,children:(0,n.jsx)(ec,{project:{id:ee.id,geometries:ee.geometries},geometry:{id:t.id,name:t.name,summary:t.summary},swr:{mutateProject:et,mutateOneGeometry:eh,delOneGeometry:ep},close:ej,onCleanup:eP})}))},[ee,eu,d,et,eh,ep,eP,ej]),ek=(0,o.useCallback)(e=>{G((0,n.jsx)(B,{visible:!0,title:"About",onClose:ej,children:(0,n.jsx)(tp.ZP.About,{project:{id:ee.id,simulations:ee.simulations},simulation:{id:e.id,name:e.name,scheme:e.scheme},swr:{mutateProject:et,addOneSimulation:ea,delOneSimulation:er,mutateOneSimulation:es}})}))},[ee,et,ea,er,es,ej]),eM=(0,o.useCallback)(e=>{G((0,n.jsx)(B,{visible:!0,title:"Geometry",onClose:ej,children:(0,n.jsx)(tp.ZP.Geometry,{loadedGeometries:eu,geometries:d.map(e=>({id:e.id,summary:e.summary})),simulation:{id:e.id,scheme:e.scheme},setGeometries:p,swr:{mutateOneSimulation:es}})}))},[eu,d,es,ej]),eZ=(0,o.useCallback)(e=>{G((0,n.jsx)(B,{visible:!0,title:"Parameters",onClose:ej,children:(0,n.jsx)(tp.ZP.Parameters,{simulation:{id:e.id,scheme:e.scheme},swr:{mutateOneSimulation:es}})}))},[es,ej]),eE=(0,o.useCallback)(e=>{G((0,n.jsx)(B,{visible:X,title:"Materials",onClose:ej,children:(0,n.jsx)(tp.ZP.Materials,{geometries:d.map(e=>({id:e.id,name:e.name,summary:e.summary})),simulation:{id:e.id,scheme:e.scheme},swr:{mutateOneSimulation:es},setVisible:K})}))},[d,X,es,ej]),eS=(0,o.useCallback)(e=>{G((0,n.jsx)(B,{visible:!0,title:"Initialization",onClose:ej,children:(0,n.jsx)(tp.ZP.Initialization,{simulations:en,simulation:e,swr:{mutateOneSimulation:es}})}))},[en,es,ej]),eA=(0,o.useCallback)(e=>{G((0,n.jsx)(B,{visible:X,title:"Boundary conditions",onClose:ej,children:(0,n.jsx)(tp.ZP.BoundaryConditions,{geometries:d.map(e=>({id:e.id,name:e.name,summary:e.summary})),simulation:{id:e.id,scheme:e.scheme},swr:{mutateOneSimulation:es},setVisible:K})}))},[d,X,es,ej]),ez=(0,o.useCallback)(e=>{G((0,n.jsx)(B,{visible:X,title:"Run",onClose:ej,children:(0,n.jsx)(tp.ZP.Run,{geometries:d,simulation:{id:e.id,scheme:e.scheme},results:z,setResults:N,setPostprocessing:I,setVisible:K,swr:{mutateOneSimulation:es}})}))},[d,z,X,es,ej]),eN=(0,o.useCallback)((e,t)=>{var i,l,n,a,r,s;let o=en.find(t=>t.id===e);if(!o)return;A(o);let d=null===(n=o.scheme)||void 0===n?void 0:null===(l=n.configuration)||void 0===l?void 0:null===(i=l.geometry)||void 0===i?void 0:i.value,c=null===(s=o.scheme)||void 0===s?void 0:null===(r=s.configuration)||void 0===r?void 0:null===(a=r.geometry)||void 0===a?void 0:a.values;if(d){let e=eu.find(e=>e.id===d);e&&p([e])}else if(c){let e=eu.filter(e=>c.includes(e.id));p(e)}switch(t){case"about":ek(o);break;case"geometry":eM(o);break;case"parameters":eZ(o);break;case"materials":eE(o);break;case"initialization":eS(o);break;case"boundaryConditions":eA(o);break;case"run":ez(o);break;default:G(void 0)}},[eu,en,ek,eM,eZ,eE,eS,eA,ez]),eD=(0,o.useCallback)(()=>{(async()=>{await e.push({pathname:"/dashboard",query:{page:t,workspaceId:i}})})()},[e,t,i]),eL=(0,o.useCallback)(e=>{let t,{keyPath:i}=e,l=i.pop(),n=i.pop(),a=i.pop();a&&(t=a.split("&").pop()),H({key:l,id:n,item:t})},[]),eT=(0,o.useCallback)(async e=>{try{await tw(ee,e.model,{addOneSimulation:ea,mutateProject:et},Y),C(!1)}catch(e){}},[ee,ea,et,Y]),eO=(0,o.useCallback)(e=>{if(ey)return!0;let t=e.value,i=e.values,l=e.multiple,n=e.n;return(!t||!!eu.filter(e=>e.id===t).length)&&(!l||!i||(n?eu.filter(e=>i.includes(e.id)).length===e.n:!!eu.filter(e=>i.includes(e.id)).length))&&(!!t||!!i)||(e.done=!1,!1)},[eu,ey]);(0,o.useEffect)(()=>{(async()=>{Q||q||await e.replace("/login")})()},[q,Q,e]),(0,o.useEffect)(()=>{$&&Y((0,Z.iT)({title:tg.user,err:$})),ei&&Y((0,Z.iT)({title:tg.project,err:ei})),eo&&Y((0,Z.iT)({title:tg.simulations,err:eo})),ex&&Y((0,Z.iT)({title:tg.geometries,err:ex}))},[$,ei,eo,ex,Y]),(0,E.Z)(()=>{el||ey?r(!1):eu.length?r(!1):r(!0)},[el,ey,eu]),(0,E.Z)(()=>{if(!ey){if(d.length){let e=!1,t=d.map(t=>{let i=eu.find(e=>e.id===(null==t?void 0:t.id));return i?JSON.stringify({...i,visible:void 0})!==JSON.stringify({...t,visible:void 0})?(e=!0,i):t:(e=!0,null)}).filter(e=>e);e&&p(t)}else p(eu[0]?[eu[0]]:[])}},[ey,eu,d],[p]),(0,E.Z)(()=>{if(!ed&&k){let e=en.find(e=>e.id===(null==k?void 0:k.id));e?JSON.stringify(e)!==JSON.stringify(k)&&(A(e),V&&V.key===tf.simulations.key&&eN(V.id,V.item)):(ej(),A(void 0))}},[en,ed,k,V],[A,ej]),(0,E.Z)(()=>{V&&(V.key===tf.geometries.key?eC(V.id):(eN(V.id,V.item),"run"!==V.item&&(N([]),I(void 0))))},[V,X,z],[eC,eN,ej]),(0,o.useEffect)(()=>{!z.length&&U&&I(void 0)},[z,U]);let eF=(0,o.useMemo)(()=>eu.map(e=>{let t=d.find(t=>t.id===e.id);return{key:e.id,icon:(0,n.jsx)(y.Z,{}),label:(0,n.jsx)(tb,{visible:!!t,geometry:e,panel:W,add:eb,del:ev,close:ej})}}),[eu,d,W,eb,ev,ej]),eR=(0,o.useMemo)(()=>en.map(e=>{let t=e.scheme.configuration||{},i=[];return Object.keys(t).forEach(l=>{if("dimension"===l)return;let a=t[l],r=(0,n.jsx)(f.Z,{style:{color:"green"}});a.error?r=(0,n.jsx)(g.Z,{style:{color:"red"}}):a.done||(r=(0,n.jsx)(w.Z,{style:{color:"orange"}})),"geometry"!==l||eO(a)||(r=(0,n.jsx)(w.Z,{style:{color:"orange"}})),i[a.index]={key:e.id+"&"+l,disabled:!d.length,icon:r,label:a.title}}),{key:e.id,icon:(0,n.jsx)(x.Z,{}),label:(0,n.jsx)(tv,{simulation:e}),children:[{key:e.id+"&about",disabled:!d.length,icon:(0,n.jsx)(f.Z,{style:{color:"green"}}),label:"About"},...i]}}),[d,en,eO]);return!q||Q||el?(0,n.jsx)(S.Z.Simple,{}):"0"===ee.id?(0,n.jsx)(D,{}):(0,n.jsx)(T.ZP,{children:(0,n.jsxs)(u.Z,{hasSider:!0,children:[(0,n.jsxs)(u.Z.Sider,{theme:"light",className:tx().sider,width:256,children:[(0,n.jsx)("div",{className:J().logo,children:(0,n.jsx)("img",{src:"/images/logo.svg",alt:"Tanatloc"})}),(0,n.jsx)(m.default,{className:tx().menu1,mode:"inline",items:[{key:"menu-go-back",disabled:!0,style:{cursor:"unset",margin:"10px 0",paddingLeft:10},label:(0,n.jsx)(L.ks,{className:J().fullWidth,onClick:eD,children:"Return to dashboard"})},{type:"divider"},{key:"title",disabled:!0,className:"Menu-title",label:(0,n.jsx)(h.Z.Paragraph,{ellipsis:{tooltip:!0,rows:2},children:ee.title})}]}),(0,n.jsx)("div",{className:tx().menuScroll,children:(0,n.jsx)(m.default,{mode:"inline",className:tx().menu2,defaultOpenKeys:[tf.geometries.key,tf.simulations.key],items:[{key:tf.geometries.key,className:"SubMenu",icon:ey?(0,n.jsx)(b.default,{}):(0,n.jsx)(y.Z,{}),label:(0,n.jsxs)(h.Z.Text,{strong:!0,children:[tf.geometries.label," (",eu.length,")"]}),children:[{key:"new_geometry",disabled:!0,label:(0,n.jsx)(c(),{icon:(0,n.jsx)(v.Z,{}),onClick:ef,children:"New Geometry"})},{key:"geometry-needed",disabled:!0,className:d.length?"display-none":"",icon:(0,n.jsx)(w.Z,{style:{color:"red"}}),label:"A Geometry is needed"},...eF]},{key:tf.simulations.key,className:"SubMenu",icon:ed?(0,n.jsx)(b.default,{}):(0,n.jsx)(x.Z,{}),label:(0,n.jsxs)(h.Z.Text,{strong:!0,children:[tf.simulations.label," (",en.length,")"]}),children:[{key:"new_simulation",disabled:!0,label:(0,n.jsx)(c(),{disabled:!eu.length,icon:(0,n.jsx)(j.Z,{}),onClick:eg,children:"New Simulation"})},...eR]}],onClick:eL})})]}),(0,n.jsxs)(u.Z.Content,{className:J().noScroll,style:{position:"relative"},children:[(0,n.jsx)(ec.Add,{visible:a,project:{id:ee.id,geometries:ee.geometries},swr:{mutateProject:et,addOneGeometry:em},setVisible:r}),(0,n.jsx)(tp.ZP.Selector,{user:{id:q.id,authorizedplugins:q.authorizedplugins,usermodels:q.usermodels},visible:P,onOk:eT,onCancel:ew}),(0,n.jsx)(tp.ZP.Updater,{user:{authorizedplugins:q.authorizedplugins},simulation:k&&{id:k.id,scheme:k.scheme},swr:{mutateOneSimulation:es}}),W,(0,n.jsx)(tm,{project:{id:ee.id,title:ee.title},simulation:k&&{id:k.id},geometries:d.map(e=>({id:e.id,needCleanup:e.needCleanup})),results:z.map(e=>({name:e.name,glb:e.glb,originPath:e.originPath,extra:e.extra})),postprocessing:U&&{glb:U.glb,originPath:U.originPath}}),(0,n.jsx)(ty,{simulation:k&&{id:k.id,name:k.name}}),(0,n.jsx)(tp.ZP.Postprocessing,{simulation:k&&{id:k.id,scheme:k.scheme},results:z.map(e=>({name:e.name,fileName:e.fileName,originPath:e.originPath})),postprocessing:U&&{name:U.name,fileName:U.fileName},setResult:I})]})]})})}},87819:function(e){e.exports={upload:"add_upload__OHzcC"}},39095:function(e){e.exports={variables:'"@/styles/variables.css"',colorPrimary:"#fad114",sider:"project_sider__KGpqG",menu1:"project_menu1__iUy_z",menuScroll:"project_menuScroll__d4eJz",menu2:"project_menu2__uQFdm"}},60968:function(e){e.exports={variables:'"@/styles/variables.css"',colorPrimary:"#fad114",view:"three_view__K5oK8",head:"three_head___lRMF",unit:"three_unit__SHNbr",content:"three_content__1T_qO",loading:"three_loading__I3n7Q",canvas:"three_canvas__0K2Z4"}}}]);