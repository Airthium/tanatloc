(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[306],{72735:function(e,t,i){"use strict";i.d(t,{Z:function(){return a}});var n=i(83755);let l=async(e,t)=>{let i=await (0,n.R)("/api/avatar",{method:"POST",headers:{Accept:"application/json"},body:JSON.stringify({file:e,project:t})});return i.json()};var a={add:l}},33900:function(e,t,i){"use strict";i.d(t,{Z:function(){return u}});var n=i(59734),l=i(67294),a=i(83755);let r=async(e,t)=>{let i=await (0,a.R)("/api/geometry",{method:"POST",body:JSON.stringify({project:e,geometry:t})});return i.json()},s=async(e,t)=>{await (0,a.R)("/api/geometry/"+e.id,{method:"PUT",body:JSON.stringify(t)})},o=async e=>{await (0,a.R)("/api/geometry/"+e.id,{method:"DELETE"})},d=async e=>{let t=await (0,a.R)("/api/geometry/"+e.id+"/download");return t.json()},c=async e=>{let t=await (0,a.R)("/api/geometry/"+e.id+"/part");return t.json()};var u={useGeometries:e=>{var t;let{data:i,error:r,mutate:s}=(0,n.ZP)(["/api/geometries",JSON.stringify({ids:e})],e=>{let[t,i]=e;return(0,a._)(t,i)}),o=null!==(t=null==i?void 0:i.geometries)&&void 0!==t?t:[],d=(0,l.useCallback)(async e=>{let t=[...o,e];await s({geometries:t})},[o,s]),c=(0,l.useCallback)(async e=>{let t=o.filter(t=>t.id!==e.id);await s({geometries:t})},[o,s]),u=(0,l.useCallback)(async e=>{let t=o.map(t=>(t.id===e.id&&(t={...t,...e}),t));await s({geometries:t})},[o,s]);return[o,{addOneGeometry:d,delOneGeometry:c,mutateOneGeometry:u,errorGeometries:r,loadingGeometries:!i}]},add:r,update:s,del:o,download:d,getPart:c}},90306:function(e,t,i){"use strict";let n;i.d(t,{ZP:function(){return tj}});var l=i(85893),a=i(5152),r=i.n(a),s=i(11163),o=i(67294),d=i(83062),c=i(97183),u=i(68508),m=i(22850),p=i(71577),h=i(99611),x=i(90420),y=i(73480),g=i(48869),w=i(8751),b=i(18429),f=i(11475),v=i(22844),j=i(50888),P=i(88484),Z=i(64789),C=i(55359),k=i(830),M=i(36642),E=i(94725),S=i(85813),A=i(42075),z=i(20280);let N={notAllowed:"You are not allowed to be here."};var L=()=>{let e=(0,s.useRouter)(),t=(0,o.useCallback)(()=>{(async()=>{await e.push("/")})()},[e]);return(0,l.jsx)(c.Z,{children:(0,l.jsx)(c.Z.Content,{children:(0,l.jsx)(S.Z,{title:"Not allowed",children:(0,l.jsxs)(A.Z,{direction:"vertical",children:[(0,l.jsxs)(m.Z.Text,{children:[(0,l.jsx)(z.Z,{style:{color:"red"}})," ",N.notAllowed]}),(0,l.jsxs)(m.Z.Text,{children:["Go back"," ",(0,l.jsx)(p.ZP,{type:"link",onClick:t,children:"home"})]})]})})})})},D=i(51302),T=i(48474),O=i(42661),R=i(77149),_=i(72616),F=i(33900),U=i(97937),I=i(68847),V=i.n(I),B=e=>{let{visible:t,title:i,children:n,onClose:a}=e;return(0,l.jsx)(S.Z,{className:V().panel,style:{display:t?"block":"none"},title:i,extra:(0,l.jsx)(p.ZP,{type:"text",icon:(0,l.jsx)(U.Z,{}),onClick:a}),children:n})},H=i(62585),W=i(31365),X=i(86373),G=i(14856),J=i.n(G),Y=i(87819),K=i.n(Y),q=i(48764).lW;let $={add:"Unable to add geometry"},Q=e=>e.name.toLowerCase().includes(".stp")||e.name.toLowerCase().includes(".step")||e.name.toLowerCase().includes(".dxf"),ee=async e=>{let t=new FileReader;return new Promise(i=>{t.addEventListener("load",()=>{i(t.result)}),t.readAsArrayBuffer(e)})},et=async(e,t,i,n)=>{if("uploading"===t.file.status)return!0;if("done"===t.file.status){let l=await ee(t.file.originFileObj);try{let n=await F.Z.add({id:e.id},{name:t.file.name,uid:t.file.uid,buffer:q.from(l)});await i.addOneGeometry(n),await i.mutateProject({id:e.id,geometries:[...e.geometries,n.id]})}catch(e){throw n((0,k.iT)({title:$.add,err:e})),e}}return!1};var ei=i(638),en=i(69677),el=e=>{let{visible:t,geometry:i,setVisible:n,onEdit:a}=e,r=(0,o.useRef)(null),[s,d]=(0,o.useState)(!1);(0,o.useEffect)(()=>{r.current&&r.current.focus()});let c=(0,o.useCallback)(()=>n(!1),[n]),u=(0,o.useCallback)(async e=>{d(!0);try{await a(e),d(!1),n(!1)}catch(e){throw d(!1),e}},[n,a]);return(0,l.jsx)(X.ZP,{title:"Edit the geometry's name",visible:t,initialValues:{name:i.name},onCancel:c,onOk:u,loading:s,children:(0,l.jsx)(ei.Z.Item,{name:"name",label:"Name:",rules:[{required:!0,message:"Name is required"}],children:(0,l.jsx)(en.Z,{ref:r})})})},ea=i(48764).lW;let er={download:"Unable to download geometry",update:"Unable to update geometry",del:"Unable to delete geometry"},es=async(e,t)=>{try{let t=await F.Z.download({id:e.id}),i=new File([ea.from(t.buffer).toString()],e.name+"."+t.extension),n=window.URL.createObjectURL(i),l=document.createElement("a");l.href=n,l.setAttribute("download",e.name+"."+t.extension),l.click(),l.remove()}catch(e){t((0,k.iT)({title:er.download,err:e}))}},eo=async(e,t,i,n)=>{try{await F.Z.update({id:e.id},[{key:"name",value:t.name}]),e.name=t.name,await i.mutateOneGeometry(e)}catch(e){throw n((0,k.iT)({title:er.update,err:e})),e}},ed=async(e,t,i,n,l)=>{try{await F.Z.del({id:e.id});let l=t.geometries.filter(t=>t!==e.id);await n.mutateProject({id:t.id,geometries:l}),await n.delOneGeometry(e),i()}catch(e){throw l((0,k.iT)({title:er.del,err:e})),e}},ec=e=>{var t,i,n,a,r,s;let{project:d,geometry:u,swr:p,close:h,onCleanup:x}=e,[y,g]=(0,o.useState)(!1),[w,b]=(0,o.useState)(!1),[f,v]=(0,o.useState)(!1),{dispatch:j}=(0,o.useContext)(C.uj),P=(0,o.useCallback)(()=>b(!0),[]),Z=(0,o.useCallback)(()=>{(async()=>{g(!0);try{await es(u,j)}catch(e){}finally{g(!1)}})()},[u,j]),k=(0,o.useCallback)(async e=>eo(u,e,p,j),[u,p,j]),M=(0,o.useCallback)(async()=>{v(!0);try{await ed(u,d,h,p,j),x(u.id)}finally{v(!1)}},[d,u,p,h,x,j]);return u?(0,l.jsx)(c.Z,{children:(0,l.jsx)(c.Z.Content,{children:(0,l.jsx)(S.Z,{size:"small",title:"Informations",actions:[(0,l.jsx)(D.o6,{loading:y,onDownload:Z},"download"),(0,l.jsxs)("div",{children:[(0,l.jsx)(el,{visible:w,geometry:{id:null==u?void 0:u.id,name:null==u?void 0:u.name},setVisible:b,onEdit:k}),(0,l.jsx)(D.w6,{onEdit:P})]},"edit"),(0,l.jsx)(D.m1,{loading:f,text:(0,l.jsxs)(l.Fragment,{children:["Are you sure you want to delete the geometry"," ",(0,l.jsx)(m.Z.Text,{strong:!0,children:u.name}),"?"]}),onDelete:M},"delete")],children:(0,l.jsxs)(A.Z,{direction:"vertical",className:J().fullWidth,children:[(0,l.jsxs)(m.Z.Text,{children:[(0,l.jsx)("span",{className:J().textLight,children:"File:"})," ",u.name," "]}),(0,l.jsxs)(m.Z.Text,{children:[(0,l.jsx)("span",{className:J().textLight,children:"Unit:"})," ",(0,l.jsx)(H.Z.Inline,{text:"m"})]}),(0,l.jsxs)(l.Fragment,{children:[3===u.summary.dimension&&(0,l.jsxs)(m.Z.Text,{children:[(0,l.jsx)("span",{className:J().textLight,children:"Number of solids:"})," ",null!==(a=null===(t=u.summary.solids)||void 0===t?void 0:t.length)&&void 0!==a?a:0]}),(0,l.jsxs)(m.Z.Text,{children:[(0,l.jsx)("span",{className:J().textLight,children:"Number of faces:"})," ",null!==(r=null===(i=u.summary.faces)||void 0===i?void 0:i.length)&&void 0!==r?r:0]}),2===u.summary.dimension&&(0,l.jsxs)(m.Z.Text,{children:[(0,l.jsx)("span",{className:J().textLight,children:"Number of edges:"})," ",null!==(s=null===(n=u.summary.edges)||void 0===n?void 0:n.length)&&void 0!==s?s:0]})]})]})})})}):(0,l.jsx)(E.Z.Simple,{})};ec.componentName="Geometry",ec.Add=e=>{let{visible:t,project:i,swr:n,setVisible:a}=e,[r,s]=(0,o.useState)(!1),{dispatch:d}=(0,o.useContext)(C.uj),c=(0,o.useCallback)(()=>a(!1),[a]),u=(0,o.useCallback)(e=>{(async()=>{try{let t=await et(i,e,n,d);s(t),a(t)}catch(e){s(!1)}})()},[i,n,a,d]);return(0,l.jsx)(X.ZP,{title:"Upload geometry",visible:t,onCancel:c,cancelButtonProps:{loading:r},children:(0,l.jsxs)(A.Z,{direction:"vertical",className:J().fullWidth,children:[(0,l.jsx)(W.Z,{className:K().upload,action:"/api/noop",accept:".stp,.step,.dxf",showUploadList:!1,listType:"picture-card",beforeUpload:Q,onChange:u,children:(0,l.jsx)("div",{children:r?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(j.Z,{style:{fontSize:25}}),(0,l.jsxs)("div",{style:{marginTop:8},children:[(0,l.jsx)("b",{children:"Loading"}),", converting, ..."]})]}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(P.Z,{style:{fontSize:25}}),(0,l.jsxs)("div",{style:{marginTop:8},children:[(0,l.jsx)("b",{children:"Choose a file"})," or drop it here"]})]})})}),(0,l.jsx)(m.Z.Text,{children:(0,l.jsx)("p",{style:{color:"rgba(0, 0, 0, 0.45)",textAlign:"center"},children:"Native file format preferred: STEP (3D) or DXF (2D) file"})})]})})};var eu=i(10739),em=i(83159),ep=i(96074),eh=i(72269),ex=i(57953),ey=i(69015),eg=i(41428),ew=i(38095),eb=i(86350),ef=i(15668),ev=i(35598),ej=i(74317),eP=i(49591),eZ=i(19478),eC=i(87784),ek=i(75843),eM=i(15611),eE=i(69980),eS=i(62992),eA=i(53073),ez=i(99477),eN=i(57632),eL=i(40782),eD=i(79753),eT=i(54327),eO=e=>{let t=new ez.fHI(.025,.025,.8,50);t.translate(0,.4,0);let i=new ez.vBJ({color:e}),n=new ez.Kj0(t,i),l=new ez.b_z(.05,.2,50);l.translate(0,.9,0);let a=new ez.vBJ({color:e}),r=new ez.Kj0(l,a),s=new ez.ZAu;return s.type="ArrowHelper",s.add(n),s.add(r),s.dispose=()=>{t.dispose(),i.dispose(),l.dispose(),a.dispose()},s};let eR=(e,t,i)=>{var n,l,a;let r=document.createElement("canvas");r.width=null!==(n=null==i?void 0:i.width)&&void 0!==n?n:256,r.height=256;let s=r.getContext("2d");(null==i?void 0:i.background)&&(s.fillStyle=i.background,s.fillRect(0,0,r.width,r.height)),s.fillStyle=null!==(l=null==i?void 0:i.fillStyle)&&void 0!==l?l:"grey",s.font="50px sans-serif",s.textAlign=null!==(a=null==i?void 0:i.align)&&void 0!==a?a:"center",s.textBaseline="middle",s.fillText(t,r.width/2,r.height/2);let o=new ez.xEZ(r);o.flipY=!0,o.needsUpdate=!0;let d=new ez.xeV({map:o,transparent:!0,depthWrite:!1});d.map.anisotropy=e.capabilities.getMaxAnisotropy();let c=new ez.jyi(d);return c.type="LabelHelper",(null==i?void 0:i.position)&&c.position.copy(i.position),(null==i?void 0:i.scale)&&c.scale.setScalar(i.scale),c.dispose=()=>{o.dispose(),d.dispose()},c},e_=function(e,t){let{offsetWidth:i,offsetHeight:n,width:l,height:a}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{offsetWidth:0,offsetHeight:0,width:150,height:150},r=i,s=n,o=l,d=a,c=eO("red");c.rotateZ(-Math.PI/2);let u=eR(e,"X",{position:new ez.Pa4(1.1,0,0)}),m=eO("green"),p=eR(e,"Y",{position:new ez.Pa4(0,1.1,0)}),h=eO("blue");h.rotateX(Math.PI/2);let x=eR(e,"Z",{position:new ez.Pa4(0,0,1.1)}),y=new ez.xo$(.05,50,50),g=new ez.vBJ({color:"black"}),w=new ez.Kj0(y,g),b=new ez.ZAu;b.type="AxisHelper",b.add(c),b.add(u),b.add(m),b.add(p),b.add(h),b.add(x),b.add(w);let f=new ez.xsS;f.add(b);let v=new ez.iKG(-1.2,1.2,1.2,-1.2,-2,2);return{dispose:()=>{y.dispose(),g.dispose(),b.children.forEach(e=>{("ArrowHelper"===e.type||"LabelHelper"===e.type)&&e.dispose()}),f.remove(b)},render:()=>{e.setViewport(r,s,o,d),v.rotation.copy(t.rotation),e.render(f,v)},resize:e=>{let{newOffsetWidth:t,newOffsetHeight:i,newWidth:n,newHeight:l}=e;r=t,s=i,o=n,d=l}}},eF=(e,t,i,n,l,a)=>{let{smooth:r,radius:s,left:o,down:d}=l,{xc:c,yc:u,uc:m,vc:p}=a;for(let l=0;l<=r;l++){let a=Math.PI/2*(e+l/r),h=Math.cos(a),x=Math.sin(a);if(t.push(c+s*h,u+s*x,0),i.push(m+o*h,p+d*x),l<r){let t=(r+1)*e+l+4;n.push(e,t,t+1)}}},eU=(e,t,i,n)=>{let l=e/2-i,a=t/2-i,r=i/e,s=(e-i)/e,o=i/t,d=(t-i)/t,c=[l,a,0,-l,a,0,-l,-a,0,l,-a,0],u=[s,d,r,d,r,o,s,o],m=[3*(n+1)+3,3*(n+1)+4,n+4,n+5,2*(n+1)+4,2,1,2*(n+1)+3,3,4*(n+1)+3,4,0],p=[m[0],m[1],m[2],m[0],m[2],m[3],m[4],m[5],m[6],m[4],m[6],m[7],m[8],m[9],m[10],m[8],m[10],m[11]];for(let e=0;e<4;e++){let t=e<1||e>2?l:-l,m=e<2?a:-a,h=e<1||e>2?s:r,x=e<2?d:o;eF(e,c,u,p,{smooth:n,radius:i,left:r,down:o},{xc:t,yc:m,uc:h,vc:x})}let h=new ez.u9r;return h.setIndex(new ez.lCJ(p,1)),h.setAttribute("position",new ez.a$l(c,3)),h.setAttribute("uv",new ez.a$l(u,2)),h},eI=function(e,t,i,n){let{offsetWidth:l,offsetHeight:a,width:r,height:s}=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{offsetWidth:0,offsetHeight:0,width:150,height:150},o="#d3d3d3",d=null,c=null,u=[{text:"FRONT",normal:new ez.Pa4(0,0,1),up:new ez.Pa4(0,1,0)},{text:"BACK",normal:new ez.Pa4(0,0,-1),up:new ez.Pa4(0,1,0)},{text:"RIGHT",normal:new ez.Pa4(1,0,0),up:new ez.Pa4(0,1,0)},{text:"LEFT",normal:new ez.Pa4(-1,0,0),up:new ez.Pa4(0,1,0)},{text:"UP",normal:new ez.Pa4(0,1,0),up:new ez.Pa4(0,0,-1)},{text:"DOWN",normal:new ez.Pa4(0,-1,0),up:new ez.Pa4(0,0,1)}],m=eU(75,75,25,20),p=new ez.xo$(37.5,10,10,0,Math.PI,0),h=new ez.ZAu;u.forEach(e=>{let t=document.createElement("canvas"),i=t.getContext("2d");t.width=t.height=256,i.fillStyle=o,i.fillRect(0,0,t.width,t.height),i.font="bold 50pt sans-serif",i.fillStyle="#000000",i.textAlign="center",i.textBaseline="middle",i.fillText(e.text,t.width/2,t.height/2);let n=new ez.ROQ(t);n.needsUpdate=!0;let l=new ez.vBJ({map:n,transparent:!0,opacity:.75}),a=new ez.vBJ({color:o}),r=new ez.Kj0(m,l),s=new ez.Kj0(m,a);s.rotateY(Math.PI);let d=new ez.vBJ({color:o,transparent:!0,opacity:.2}),c=new ez.Kj0(p,d),u=new ez.ZAu;u.add(r,s,c),u.lookAt(e.normal),u.translateZ(50),u.normal=e.normal,u.up=e.up,h.add(u)});let x=new ez.Mig("#ffffff",1),y=new ez.xsS;y.add(h),y.add(x);let g=new ez.iKG(-100,100,100,-100,-100,100);g.position.z=2;let w=new ez.iMs,b=e=>{let t=f(e);v(t)?(d=j(t),P(),(null==d?void 0:d.uuid)!==(null==c?void 0:c.uuid)&&(Z(),c=d)):(d=null,Z())},f=e=>{let t=e.target,i=t.getBoundingClientRect(),n=e.clientX-i.left,o=e.clientY-i.top,d=new ez.FM8;return d.x=(n-l)/r*2-1,d.y=-(2*((o+s-i.height+a)/s))+1,d},v=e=>e.x>-1&&e.x<1&&e.y>-1&&e.y<1,j=e=>{let t=new ez.Pa4(e.x,e.y,-1);t.unproject(g);let i=new ez.Pa4;g.getWorldDirection(i),w.set(t,i);let n=w.intersectObjects(y.children,!0);return n.length?n[0].object.parent:null},P=()=>{var e;null==d||null===(e=d.children)||void 0===e||e.forEach(e=>{var t;(null===(t=e.material)||void 0===t?void 0:t.color)&&(e.material.previousColor=e.material.color,e.material.color=new ez.Ilk("#FAD114"))})},Z=()=>{var e;null==c||null===(e=c.children)||void 0===e||e.forEach(e=>{var t;(null===(t=e.material)||void 0===t?void 0:t.color)&&(e.material.color=new ez.Ilk(o))})},C=e=>{if(d){var l;let a=d.normal,r=d.up,s=new ez.Pa4;null===(l=t.boundingBox)||void 0===l||l.getCenter(s);let o=i.position.distanceTo(n.target),c=a.clone().multiplyScalar(o),u=s.add(c);i.position.copy(u),i.up.copy(r),d=null,Z(),b(e)}};return e.domElement.addEventListener("pointermove",b),e.domElement.addEventListener("pointerdown",C),{resize:e=>{let{newOffsetWidth:t,newOffsetHeight:i,newWidth:n,newHeight:o}=e;l=t,a=i,r=n,s=o},render:()=>{e.setViewport(l,a,r,s),g.rotation.copy(i.rotation),e.render(y,g)},dispose:()=>{e.domElement.removeEventListener("pointermove",b),e.domElement.removeEventListener("pointerdown",C),h.children.forEach(e=>{e.children.forEach(e=>{e.geometry.dispose(),e.material.dispose()})}),y.remove(h)}}};var eV=e=>1e-12>Math.abs(e)?"0":Math.abs(e)>1e3||.001>Math.abs(e)?e.toExponential(2):e.toFixed(3);let eB=(e,t,i,n)=>{let l,a,r;let s=1,o=e=>{let t=Math.max(e.x,e.y,e.z),i=Math.max(Math.ceil(e.x/t*5),2),n=Math.max(Math.ceil(e.y/t*5),2),l=Math.max(Math.ceil(e.z/t*5),2);return new ez.Pa4(i,n,l)},d=(e,t,i,n,l)=>{let a=new ez.ZAu,r=new ez.nls({color:8947848}),s=new ez.Pa4(-e/2,0,-t/2),o=e/(i-1),d=t/(n-1);for(let t=0;t<n;++t){let i=new ez.u9r().setFromPoints([new ez.Pa4(s.x,0,s.z+t*d),new ez.Pa4(s.x+e,0,s.z+t*d)]);a.add(new ez.x12(i,r))}for(let e=0;e<i;++e){let i=new ez.u9r().setFromPoints([new ez.Pa4(s.x+e*o,0,s.z),new ez.Pa4(s.x+e*o,0,s.z+t)]);a.add(new ez.x12(i,r))}return null==l||l(a),a},c=(t,i,n,l)=>{let a=new ez.ZAu,r=Math.abs(i-t),o=r/(l-1),d=new ez.Pa4().copy(n).multiplyScalar(-r/2),c=new ez.Pa4().copy(n).multiplyScalar(o),u=t;for(let t=0;t<l;++t){let t=eR(e,eV(u*s));t.position.copy(d),a.add(t),d.add(c),u+=o}return a},u=()=>{let e=t.boundingBox,i=t.boundingSphere.center,n=new ez.Pa4(e.max.x-e.min.x,e.max.y-e.min.y,e.max.z-e.min.z),r=o(n);a=1*(l=.1*Math.max(n.x,n.y,n.z));let s=new ez.ZAu,u=d(n.x,n.z,r.x,r.z),m=d(n.x,n.y,r.x,r.y,e=>{e.rotateX(Math.PI/2)}),p=d(n.y,n.z,r.y,r.z,e=>{e.rotateZ(-Math.PI/2)});s.add(u,m,p);let x=c(e.min.x,e.max.x,new ez.Pa4(1,0,0),r.x),y=c(e.min.y,e.max.y,new ez.Pa4(0,1,0),r.y),g=c(e.min.z,e.max.z,new ez.Pa4(0,0,1),r.z);return s.add(x,y,g),s.position.set(i.x,i.y,i.z),s.type="GridHelper",s.dispose=h,s},m=e=>e<=0?-1:1,p=e=>.5>=Math.abs(e)?1:-1,h=()=>{null==r||r.children.forEach(e=>{e.children.forEach(e=>{if("Line"===e.type){let t=e.geometry;t.dispose();let i=e.material;i.dispose()}else e.dispose()})})};return{dispose:h,setVisible:e=>{r.visible=e},setScale:e=>{s=e},update:()=>{let e=t.boundingBox,s=new ez.Pa4(e.max.x-e.min.x,e.max.y-e.min.y,e.max.z-e.min.z),o=!1;t.children.forEach(e=>{"GridHelper"===e.type&&(o=e.visible,t.remove(e),e.dispose())}),r=u();let d=n.object.position.distanceTo(n.target);r.traverse(e=>{"LabelHelper"===e.type&&e.scale.setScalar(.05*d)});let c=new ez.Pa4;i.getWorldDirection(c);let h=d/10/(n.minDistance+.001),x=r.children[0],y=r.children[1],g=r.children[2];x.position.set(0,m(c.y)*(s.y/2+l),0),y.position.set(0,0,m(c.z)*(s.z/2+l)),g.position.set(m(c.x)*(s.x/2+l),0,0);let w=r.children[3],b=r.children[4],f=r.children[5];w.position.set(0,m(c.y)*p(c.y)*(s.y/2+a),-(m(c.z)*p(c.y)*(s.z/2+a))),b.position.set(m(c.x)*p(c.x)*(s.x/2+a),0,-(m(c.z)*p(c.x)*(s.z/2+a))),f.position.set(m(c.x)*p(c.x)*(s.x/2+a),-(m(c.y)*p(c.x)*(s.y/2+a)),0);let v=.2*h,j=.3*h;w.visible=Math.abs(c.y)>v||Math.abs(c.z)>j,b.visible=Math.abs(c.x)>j||Math.abs(c.z)>j,f.visible=Math.abs(c.x)>j||Math.abs(c.y)>v,r.visible=o,t.add(r)}}},eH=(e,t,i,n)=>{let l=document.createElement("div");l.style.pointerEvents="none",l.style.border="1px solid #55aaff",l.style.backgroundColor="rgba(75, 160, 255, 0.3)",l.style.position="fixed";let a=new ez.FM8,r=new ez.FM8,s=new ez.FM8,o=new ez.FM8,d=!1,c=!1,u=new ez.iMs,m=()=>{d=!1},p=e=>{d&&0===e.button&&(c=!0,y(e))},h=e=>{d&&c&&g(e)},x=e=>{c=!1,d&&w(e)};e.domElement.addEventListener("pointerdown",p),e.domElement.addEventListener("pointermove",h),e.domElement.addEventListener("pointerup",x);let y=t=>{n.enabled=!1,e.domElement.parentElement.appendChild(l),l.style.left=t.clientX+"px",l.style.top=t.clientY+"px",l.style.width="0px",l.style.height="0px",a.x=t.clientX,a.y=t.clientY},g=e=>{o.x=Math.max(a.x,e.clientX),o.y=Math.max(a.y,e.clientY),s.x=Math.min(a.x,e.clientX),s.y=Math.min(a.y,e.clientY),l.style.left=s.x+"px",l.style.top=s.y+"px",l.style.width=o.x-s.x+"px",l.style.height=o.y-s.y+"px"},w=e=>{n.enabled=!0,l.parentElement&&l.parentElement.removeChild(l),r.x=e.clientX,r.y=e.clientY;let t=new ez.TUj(a,r);b(t),m()},b=l=>{let a=new ez.FM8(Math.abs(l.max.x-l.min.x),Math.abs(l.max.y-l.min.y));if(a.x<5||a.y<5)return;let r=new ez.FM8((l.max.x+l.min.x)/2,(l.max.y+l.min.y)/2),s=e.domElement.getBoundingClientRect(),o=r.x-s.left,d=r.y-s.top,c=new ez.FM8(o/s.width*2-1,-(2*(d/s.height))+1),m=t.children.find(e=>"Part"===e.type);if(!m)return;u.setFromCamera(c,i);let p=u.intersectObject(m);if(!p.length)return;n.target.copy(p[0].point);let h=new ez.FM8(a.x/s.width,a.y/s.height),x=Math.max(h.x,h.y),y=i.position.distanceTo(n.target),g=n.target.clone().sub(i.position).normalize().multiplyScalar(y*(1-x));i.position.add(g)};return{dispose:()=>{e.domElement.removeEventListener("pointerdown",p),e.domElement.removeEventListener("pointermove",h),e.domElement.removeEventListener("pointerup",x)},end:m,isEnabled:()=>d,start:()=>{d=!0}}},eW=(e,t,i,n)=>{let l,a,r;let s=new ez.Ilk("#fad114"),o=new ez.Ilk("#E98A15"),d=new ez.Pa4(-1,0,0),c=new ez.JOQ(d),u={up:new ez.Pa4,forward:new ez.Pa4,right:new ez.Pa4},m=new ez.Pa4,p=new ez.Pa4,h=new ez.USm,x=new ez.Pa4,y=new ez.FM8,g=new ez.JOQ,w=new ez.Pa4,b=new ez.Pa4,f=new ez.Zzh,v={up:new ez.Pa4,forward:new ez.Pa4,right:new ez.Pa4},j=new ez.iMs,P=new ez.ZAu;P.type="SectionViewHelper",P.visible=!1,t.add(P),(()=>{let e=new ez._12(1,1),t=new ez.vBJ({color:s,side:ez.ehD,transparent:!0,opacity:.5}),i=new ez.Kj0(e,t);i.type="Plane",P.add(i)})(),(()=>{let e=new ez.xo$(.2,32,32,Math.PI,-Math.PI),t=new ez.vBJ({color:s,side:ez.ehD,transparent:!0,opacity:.5}),i=new ez.Kj0(e,t);i.type="Dome",P.add(i)})(),(()=>{class e extends ez.Hyl{getPoint(e){return new ez.Pa4().set(this.radius*Math.cos(Math.PI*e),this.radius*Math.sin(Math.PI*e),0)}constructor(e){super(),this.radius=e}}let t=new e(.2);{let e=new ez.WXh(t,32,.020000000000000004,32),i=new ez.vBJ({color:s,side:ez.ehD,transparent:!0,opacity:.5}),n=new ez.Kj0(e,i);n.rotateX(Math.PI/2),n.type="ArcX",P.add(n)}{let e=new ez.WXh(t,32,.020000000000000004,32),i=new ez.vBJ({color:s,side:ez.ehD,transparent:!0,opacity:.5}),n=new ez.Kj0(e,i);n.rotateX(Math.PI/2),n.rotateY(Math.PI/2),n.type="ArcY",P.add(n)}})();let Z=()=>{let e=new ez.Pa4;t.boundingBox.getSize(e),e.multiplyScalar(1.2);let i=Math.max(Math.max(e.x,e.y),e.z);P.scale.setScalar(i)},C=()=>{let e=new ez.Pa4;t.boundingBox.getCenter(e),P.position.copy(e)},k=()=>{P.rotateX(Math.PI);let e=c.normal.multiplyScalar(-1);c.setFromNormalAndCoplanarPoint(e,P.position)},M=e=>{let t=e.target,i=t.getBoundingClientRect(),n=e.clientX-i.left,l=e.clientY-i.top,a=new ez.FM8;return a.x=n/i.width*2-1,a.y=-(2*(l/i.height))+1,a},E=e=>{l&&l.material.color.set(s),l=e,e&&e.material.color.set(o)},S=()=>{n.enabled=!0},A=()=>{n.enabled=!1},z=()=>{i.getWorldDirection(u.forward),u.forward.normalize(),u.up.copy(i.up).normalize(),u.right.crossVectors(u.up,u.forward).normalize()},N=()=>{let e=new ez.Pa4(0,0,1).applyQuaternion(P.quaternion).multiplyScalar(-1);c.setFromNormalAndCoplanarPoint(e,P.position)},L=e=>{if(!P.visible)return;let t=M(e);if(j.setFromCamera(t,i),a){let e=new ez.Pa4;j.ray.intersectPlane(g,e),(null==r?void 0:r.type)==="Plane"?T(e):(null==r?void 0:r.type)==="Dome"?R(t):F(e),N()}else{let e=j.intersectObject(P);e.length?(A(),E(r=e[0].object),p.copy(e[0].point),z()):(r=null,E(),S())}},D=()=>{g.setFromNormalAndCoplanarPoint(u.forward,p),m.copy(P.position);let e=new ez.Pa4;j.ray.intersectPlane(g,e),w.copy(e).sub(m),b.copy(w).normalize(),f.set(m,new ez.Pa4().copy(m).add(c.normal))},T=e=>{e.sub(w);let t=new ez.Pa4;f.closestPointToPoint(e,!1,t),P.position.copy(t)},O=e=>{h.copy(P.rotation),y.copy(e)},R=e=>{P.rotation.copy(h),P.rotateOnWorldAxis(u.up,-(5*(y.x-e.x))),P.rotateOnWorldAxis(u.right,-(5*(y.y-e.y)))},_=()=>{r.getWorldDirection(x),h.copy(P.rotation),w.copy(p).sub(P.position),b.copy(w).normalize(),v.up.copy(b),v.right.copy(x),v.forward.crossVectors(v.right,v.up),f.set(p,new ez.Pa4().copy(p).add(v.forward)),g.setFromNormalAndCoplanarPoint(u.forward,p)},F=e=>{let t=n.object.position.distanceTo(n.target),i=new ez.Pa4;f.closestPointToPoint(e,!1,i);let l=p.distanceTo(i);i.sub(p);let a=new ez.Pa4().copy(b).cross(i).normalize(),r=Math.sign(x.dot(a));P.rotation.copy(h),P.rotateOnWorldAxis(x,r*l*1/(t/100))},U=e=>{switch(null==r?void 0:r.type){case"Plane":D();break;case"Dome":O(e);break;case"ArcX":case"ArcY":_()}},I=e=>{if(P.visible&&r){a=!0;let t=M(e);U(t)}},V=()=>{P.visible&&(a=!1,E())};return e.domElement.addEventListener("pointermove",L),e.domElement.addEventListener("pointerdown",I),e.domElement.addEventListener("pointerup",V),{getClippingPlane:()=>c,toggleVisible:()=>{let e=P.visible;P.visible=!e},start:()=>{e.localClippingEnabled=!0,P.visible=!0,Z(),C();let t=new ez.Pa4().copy(P.position).sub(d);P.lookAt(t),c.setFromNormalAndCoplanarPoint(d,P.position)},stop:()=>{e.localClippingEnabled=!1,P.visible=!1},toAxis:e=>{if(C(),d.equals(e)){k();return}let t=new ez.Pa4().copy(P.position).sub(e);P.lookAt(t),c.setFromNormalAndCoplanarPoint(e,P.position),d.copy(e)},flip:k,dispose:()=>{P.traverse(e=>{("Plane"===e.type||"Dome"===e.type||"ArcX"===e.type||"ArcY"===e.type)&&(e.geometry.dispose(),e.material.dispose())}),e.domElement.removeEventListener("pointermove",L),e.domElement.removeEventListener("pointerdown",I),e.domElement.removeEventListener("pointerup",V)}}};var eX=i(54104);let eG=e=>{let t=new eX.A("rainbow",512);t.setMin(Number.MAX_VALUE),t.setMax(-Number.MAX_VALUE);let i=new ez.xsS,n=new ez.iKG(-1,1,1,-1,2,1);n.position.set(0,0,1);let l=new ez.ZAu;i.add(l);let a=!1,r=1,s=0,o=()=>{i.children.forEach(e=>{e.children.forEach(t=>{"LabelHelper"===t.type&&t.dispose(),"Sprite"===t.type&&t.dispose(),e.remove(t)})})},d=t=>{let i=eV(t.minV*r+s),n=eV(t.maxV*r+s),a=eR(e,String(i),{background:"white",fillStyle:"black",position:new ez.Pa4(-.62,0,0),width:512,align:"right"});a.scale.x=.4,a.scale.y=2.8,a.renderOrder=0;let o=eR(e,String(n),{background:"white",fillStyle:"black",position:new ez.Pa4(.62,0,0),width:512,align:"left"});o.scale.x=.4,o.scale.y=2.8,o.renderOrder=0,l.add(a),l.add(o)};return{render:()=>{let t=e.domElement.getBoundingClientRect();e.setViewport(t.width/2-350,t.height-50,700,50),e.render(i,n)},addLUT:e=>{if(!a){let i=t.minV,n=t.maxV;t.setMin(Math.min(i,e.minV)),t.setMax(Math.max(n,e.maxV))}let i=new ez.ROQ(t.createCanvas()),n=new ez.xeV({map:i,depthWrite:!1}),r=new ez.jyi(n);r.material.rotation=-Math.PI/2,r.scale.x=.2,r.scale.y=1.2,r.renderOrder=1,r.dispose=r.material.dispose,l.add(r),d(t)},getMinV:()=>t.minV,getMaxV:()=>t.maxV,getColor:e=>t.getColor(e),setUnit:t=>{var i,n,a;let o=eR(e,String("Unit: "+(null!==(i=null==t?void 0:t.label)&&void 0!==i?i:1)),{background:"white",fillStyle:"black",position:new ez.Pa4(0,.5,0),width:512});o.scale.x=.4,o.scale.y=2.8,o.renderOrder=0,l.add(o),r=null!==(n=null==t?void 0:t.multiplicator)&&void 0!==n?n:1,s=null!==(a=null==t?void 0:t.adder)&&void 0!==a?a:0},setVisible:e=>{i.children.forEach(t=>{t.children.forEach(t=>t.visible=e)})},setColorMap:e=>{t.setColorMap(e,512)},setRange:(e,i)=>{a=!0,t.setMin(e),t.setMax(i)},setAutomaticRange:()=>{a=!1,t.setMin(Number.MAX_VALUE),t.setMax(-Number.MAX_VALUE)},dispose:()=>{a||(t.setMin(Number.MAX_VALUE),t.setMax(-Number.MAX_VALUE)),o()}}},eJ=e=>{let t=new ez.ZAu;t.type="PointHelper",t.visible=!1,e.add(t);let i=()=>{var t,i;let n=(null!==(i=null===(t=e.boundingSphere)||void 0===t?void 0:t.radius)&&void 0!==i?i:1)/100,l=new ez.xo$(n),a=new ez.Wid({color:16711680});return new ez.Kj0(l,a)},n=(e,t)=>{let i=new ez.u9r().setFromPoints([e,t]),n=new ez.nls({color:16711680});return new ez.x12(i,n)},l=()=>{let t=[],i=e.boundingBox.max.x-e.boundingBox.min.x,l=e.boundingBox.max.y-e.boundingBox.min.y,a=e.boundingBox.max.z-e.boundingBox.min.z,r=Math.max(i,l,a),s=n(new ez.Pa4(-r/2,0,0),new ez.Pa4(r/2,0,0));t.push(s);let o=n(new ez.Pa4(0,-r/2,0),new ez.Pa4(0,r/2,0));t.push(o);let d=n(new ez.Pa4(0,0,-r/2),new ez.Pa4(0,0,r/2));return t.push(d),t},a=()=>{t.children.forEach(e=>{t.remove(e),e.geometry.dispose(),e.material.dispose()})};return{build:()=>{a();let e=i(),n=l();t.add(e),t.add(...n)},dispose:a,update:e=>{e?(t.position.set(e.x,e.y,e.z),t.visible=!0):t.visible=!1}}};var eY=i(77836),eK=i(82854),eq=i(6648),e$=i(48764).lW;let eQ=(e,t)=>{e.traverse(e=>{if("Mesh"===e.type){let i=new ez.Uk6(e.geometry),n=new ez.nls({color:e.material.color,linewidth:1}),l=new ez.ejS(i,n);e.add(l),e.material.visible=!1,e.material.clippingPlanes=[t]}})},e0=(e,t)=>{e.traverse(e=>{if("Mesh"===e.type||"Line"===e.type){let i=e.geometry.getAttribute("data");if(i){let t=i.array.reduce((e,t)=>Math.min(e,t),i.array[0]),n=i.array.reduce((e,t)=>Math.max(e,t),i.array[0]);t===n&&(t-=1,n+=1);let l=new eX.A;l.setMin(t),l.setMax(n),e.userData={...e.userData,lut:l}}if("Mesh"===e.type){let t=new ez.Uk6(e.geometry),i=new ez.nls({linewidth:1}),n=new ez.ejS(t,i);e.add(n)}e.material.vertexColors=!0,e.material.clippingPlanes=[t]}})},e1=(e,t)=>{e.traverse(e=>{"Mesh"===e.type&&(e.material.clippingPlanes=[t],e.material.originalColor=e.material.color)})},e2=(e,t)=>{let i=new ez.Ilk("#FAD114"),n=new ez.Ilk("#EE9817"),l=async(e,t,i,n)=>{let l=new Blob([e$.from(e.buffer)]),d=URL.createObjectURL(l),c=new eY.E,u=new eK._;u.setDecoderPath("/three/libs/draco/"),c.setDRACOLoader(u);let m=new eq.a;m.setTranscoderPath("node_modules/three//examples/js/libs/basis/"),c.setKTX2Loader(m);let p=await new Promise((e,t)=>{c.load(d,t=>{e(t)},()=>void 0,e=>t(e))}),w=p.scene,b=new ez.Tme;return b.type="Part",b.uuid=e.summary.uuid,b.children=w.children,b.userData=w.userData,"mesh"===e.summary.type?eQ(b,n):"result"===e.summary.type?e0(b,n):("geometry3D"===e.summary.type||"geometry2D"===e.summary.type)&&e1(b,n),s(b,t),o(b,i),b.boundingBox=a(b),b.dispose=()=>r(b),b.setTransparent=e=>s(b,e),b.setDisplayMesh=e=>o(b,e),b.startSelection=(e,t,i)=>y(b,e,t,i),b.stopSelection=()=>g(),b.getHighlighted=()=>h,b.getSelected=()=>x,b.highlight=C,b.unhighlight=k,b.select=E,b.unselect=S,b},a=e=>{let t=new ez.ZzF;return e.traverse(e=>{t.expandByObject(e)}),t},r=e=>{e.traverse(e=>{"Mesh"===e.type&&(e.geometry.dispose(),e.material.dispose())})},s=(e,t)=>{e.traverse(e=>{"Mesh"===e.type&&(e.material.transparent=t,e.material.opacity=t?.5:1,e.material.depthWrite=!t)})},o=(e,t)=>{"result"===e.userData.type&&e.traverse(e=>{e.traverse(e=>{"LineSegments"===e.type&&(e.visible=t)})})},d=new ez.iMs,c=null,u=null,m=null,p=null,h=null,x=[],y=(e,t,i,n)=>{c=e,u=n,m=t,p=i,h=null,x.length=0,m.domElement.addEventListener("pointermove",Z),m.domElement.addEventListener("pointerdown",M)},g=()=>{null==m||m.domElement.removeEventListener("pointermove",Z),null==m||m.domElement.removeEventListener("pointerdown",M),k(),h=null,x.forEach(e=>{S(e.uuid)}),x.length=0,u=null,c=null,m=null,p=null},w=(e,t)=>{let i;if(e&&t)return e.traverse(e=>{e.userData.uuid===t&&(i=e)}),i},b=e=>{let t=e.target,i=t.getBoundingClientRect(),n=e.clientX-i.left,l=e.clientY-i.top,a=new ez.FM8;return a.x=n/i.width*2-1,a.y=-(2*(l/i.height))+1,a},f=()=>{let t=d.intersectObject(c,!0);if(t.length){let i=t[0].object,n=i.parent;n&&e(c,n.userData.uuid,n.userData.label)}else e(c)},v=()=>{let t;let i=c.userData;if(2===i.dimension){if((t=d.intersectObject(c,!0)).length){let i=t[0].object,n=i.parent;(null==n?void 0:n.type)==="Mesh"?e(c,n.userData.uuid,n.userData.label):e(c,i.userData.uuid,i.userData.label)}else e(c)}else if((t=d.intersectObject(c,!0)).length){let i=t[0].object;e(c,i.userData.uuid,i.userData.label)}else e(c)},j=()=>{let t;let i=c.userData,n=i.edges;if((t=d.intersectObject(c,!0)).length){let i=t[0].object,l=null==n?void 0:n.find(e=>e.uuid===i.userData.uuid);l?e(c,i.userData.uuid,i.userData.label):e(c)}else e(c)},P=()=>{let t=d.intersectObject(c,!0);if(t.length){let i=t[0];e(c,void 0,void 0,i.point)}else e(c)},Z=e=>{let t=b(e);switch(d.setFromCamera(t,p),u){case"solids":f();break;case"faces":v();break;case"edges":j();break;case"point":P()}},C=e=>{if(e===(null==h?void 0:h.uuid))return;k();let t=w(c,e);t&&(h={uuid:t.userData.uuid,label:t.userData.label},"Mesh"===t.type?t.material.color=i:t.traverse(e=>{"Mesh"===e.type&&(e.material.color=i)}))},k=()=>{let e=w(c,null==h?void 0:h.uuid);if(h=null,!e)return;let t=x.findIndex(t=>t.uuid===e.userData.uuid);"Mesh"===e.type?e.material.color=-1===t?e.material.originalColor:n:e.traverse(e=>{"Mesh"===e.type&&(e.material.color=-1===t?e.material.originalColor:n)})},M=()=>{h&&t(c,h.uuid,h.label)},E=e=>{let t=w(c,e);t&&(x.push({uuid:e,label:t.userData.label}),"Mesh"===t.type?t.material.color=n:t.traverse(e=>{"Mesh"===e.type&&(e.material.color=n)}))},S=e=>{let t=w(c,e),i=x.findIndex(t=>t.uuid===e);-1!==i&&(x=[...x.slice(0,i),...x.slice(i+1)]),t&&("Mesh"===t.type?t.material.color=t.material.originalColor:t.traverse(e=>{"Mesh"===e.type&&(e.material.color=e.material.originalColor)}))};return{load:l}};var e4=i(72735),e5=i(60968),e8=i.n(e5);let e3={load:"Error while loading part",snapshot:"Error while taking snapshot",saveScreenshot:"Unable to save screenshot"},e7=!1,e6=e=>{let t=new ez.ZzF;e.children.forEach(e=>{if(e.visible&&"Part"===e.type){let i=e.boundingBox,n=new ez.Pa4(Math.min(t.min.x,i.min.x),Math.min(t.min.y,i.min.y),Math.min(t.min.z,i.min.z)),l=new ez.Pa4(Math.max(t.max.x,i.max.x),Math.max(t.max.y,i.max.y),Math.max(t.max.z,i.max.z));t.set(n,l)}});let i=new ez.aLr;t.getBoundingSphere(i),e.boundingBox=t,e.boundingSphere=i},e9=(e,t,i)=>{let n=t.object.position.distanceTo(t.target),l=t.target.clone().sub(e.position).normalize().multiplyScalar(n*i*.01);e.position.add(l)},te=(e,t,i)=>{let n=e.children.find(e=>"Part"===e.type);if(!n)return;e7=!0;let l=e.boundingSphere,a=l.center,r=2*l.radius,s=r/(2*Math.atan(Math.PI*t.fov/360)),o=s/t.aspect,d=1.1*Math.max(s,o),c=i.target.clone().sub(t.position).normalize().multiplyScalar(d);i.target.copy(a),i.minDistance=d/10,i.maxDistance=10*d,t.position.copy(a).sub(c),t.near=d/100,t.far=100*d,t.updateProjectionMatrix()},tt=async(e,t,i,n,l,a,r)=>{var s,o,d;let c=e2((e,t,i,n)=>{t?(e.highlight(t),setTimeout(()=>r((0,eL.CH)({uuid:t,label:i})),1)):n?r((0,eL.N7)({x:n.x,y:n.y,z:n.z})):(e.unhighlight(),setTimeout(()=>r((0,eL.HW)()),1))},(e,t,i)=>{let n=e.getSelected();n.find(e=>e.uuid===t)?(e.unselect(t),setTimeout(()=>r((0,eL.hF)({uuid:t,label:i})),1)):(e.select(t),setTimeout(()=>r((0,eL.Ys)({uuid:t,label:i})),1))}),u=await c.load(e,l.transparent,l.displayMesh,a.sectionViewHelper.getClippingPlane());u.name=null!==(d=null===(s=e.extra)||void 0===s?void 0:s.name)&&void 0!==d?d:u.name,u.fields=null===(o=e.extra)||void 0===o?void 0:o.fields,t.add(u),e6(t),e7||te(t,i,n),a.gridHelper.update(),a.gridHelper.update(),a.gridHelper.setVisible(!0),a.pointHelper.build()},ti=(e,t)=>{for(let i of(t.dispose(),t.setVisible(!1),e.children))if("Part"===i.type&&"result"===i.userData.type){let e=i.name.split(" ").shift(),n=i.fields,l=null==n?void 0:n.find(t=>t.name===e);i.traverse(e=>{("Mesh"===e.type||"Line"===e.type)&&(t.setUnit(null==l?void 0:l.unit),t.addLUT(e.userData.lut),t.setVisible(!0))})}},tn=(e,t)=>{for(let i of(ti(e,t),e.children))"Part"===i.type&&"result"===i.userData.type&&i.traverse(e=>{if("Mesh"===e.type||"Line"===e.type){let i=e.geometry.getAttribute("data"),n=new Float32Array(3*i.count);for(let e=0;e<i.count;e++){let l=t.getColor(i.array[e]);n[3*e+0]=l.r,n[3*e+1]=l.g,n[3*e+2]=l.b}e.geometry.setAttribute("color",new ez.a$l(n,3))}})},tl=async(e,t,i,n,l)=>{try{let l=n.domElement.width,a=n.domElement.height,r=i.aspect;n.domElement.width=520,n.domElement.height=312,i.aspect=520/312,i.updateProjectionMatrix(),n.clear(),n.setViewport(0,0,520,312),n.render(t,i);let s=n.domElement.toDataURL();n.domElement.width=l,n.domElement.height=a,i.aspect=r,i.updateProjectionMatrix(),await e4.Z.add({name:"snapshot",uid:"snapshot_"+(0,eN.Z)(),data:s},{id:e.id})}catch(e){l((0,k.iT)({title:e3.snapshot,err:e}))}},ta=(e,t,i,n,l)=>{try{let l=n.domElement.width,a=n.domElement.height;n.clear(),n.setViewport(0,0,l,a),n.render(t,i);let r=n.domElement.toDataURL(),s=document.createElement("a");s.href=r.replace("image/png","image/octet-stream"),s.download=e.title+"_"+new Date().toLocaleDateString()+".png",s.click()}catch(e){l((0,k.iT)({title:e3.saveScreenshot,err:e}))}};var tr=e=>{var t,i,a,r,u;let{loading:m,project:h,parts:y}=e,g=(0,o.useRef)(null),w=(0,o.useRef)(),b=(0,o.useRef)(),f=(0,o.useRef)(),v=(0,o.useRef)(),P=(0,o.useRef)(),Z=(0,o.useRef)(),E=(0,o.useRef)(),S=(0,o.useRef)(),A=(0,o.useRef)(),[z,N]=(0,o.useState)(!1),[L,D]=(0,o.useState)(!0),[O,R]=(0,o.useState)(!1),[_,F]=(0,o.useState)(!1),[U,I]=(0,o.useState)(!1),[V,B]=(0,o.useState)(!1),[W,G]=(0,o.useState)("m"),{enabled:Y,part:K,highlighted:q,selected:$,point:Q,type:ee,dispatch:et}=(0,o.useContext)(T.ZB),{dispatch:el}=(0,o.useContext)(C.uj),ea=(0,s.useRouter)();(0,o.useEffect)(()=>{var e;if(!eT.Z.isWebGLAvailable()){(async()=>{await ea.push("/webgl")})();return}let t=g.current,i=t.clientWidth,n=t.clientHeight;w.current=new ez.xsS,w.current.boundingBox=new ez.ZzF,w.current.boundingSphere=new ez.aLr,b.current=new ez.cPb(50,i/n,.1,1e3),b.current.position.z=10;let l=new ez.Mig("#aaa",.75);w.current.add(l);let a=new ez.cek("#fff",.5);a.decay=2,b.current.add(a),w.current.add(b.current),f.current=new ez.CP7({antialias:!0,alpha:!0}),f.current.setClearColor("#ffffff"),f.current.setSize(i,n),f.current.setPixelRatio(null!==(e=window.devicePixelRatio)&&void 0!==e?e:1),f.current.shadowMap.enabled=!0,f.current.autoClear=!1,t.appendChild(f.current.domElement),v.current=new eD.$(b.current,t),v.current.rotateSpeed=3,v.current.panSpeed=.1;let r=e_(f.current,b.current,{offsetWidth:i-155,offsetHeight:n-155,width:150,height:150}),s=eI(f.current,w.current,b.current,v.current,{offsetWidth:i-155,offsetHeight:n-155,width:150,height:150});P.current=eB(f.current,w.current,b.current,v.current),Z.current=eH(f.current,w.current,b.current,v.current),E.current=eW(f.current,w.current,b.current,v.current),S.current=eG(f.current),S.current.setVisible(!1),A.current=eJ(w.current);let o=()=>{v.current.update(),f.current.setViewport(0,0,i,n),f.current.render(w.current,b.current),P.current.update(),r.render(),s.render(),S.current.render()},d=()=>{i=t.clientWidth,n=t.clientHeight,b.current.aspect=i/n,b.current.updateProjectionMatrix(),f.current.setSize(i,n),r.resize({newOffsetWidth:i-155,newOffsetHeight:n-155,newWidth:150,newHeight:150}),s.resize({newOffsetWidth:i-155,newOffsetHeight:n-155,newWidth:150,newHeight:150}),o()},c=()=>{o(),setTimeout(()=>requestAnimationFrame(c),1e3/30)};return window.addEventListener("resize",d),requestAnimationFrame(c),()=>{e7=!1,window.removeEventListener("resize",d),t.removeChild(f.current.domElement),w.current.children.forEach(e=>{w.current.remove(e)}),r.dispose(),s.dispose(),P.current.dispose(),E.current.dispose(),Z.current.dispose(),S.current.dispose(),A.current.dispose()}},[ea]),(0,M.Z)(()=>{if(!w.current)return;let e=w.current.children;if(!y.length){var t;e6(w.current),P.current.update(),null===(t=A.current)||void 0===t||t.build()}let i=y.filter(t=>!e.find(e=>e.uuid===t.summary.uuid)),n=e.filter(e=>!y.find(t=>t.summary.uuid===e.uuid)).filter(e=>"Part"===e.type);n.forEach(e=>{var t;null===(t=w.current)||void 0===t||t.remove(e),e.dispose()}),(async()=>{await Promise.all(i.map(async e=>{try{await tt(e,w.current,b.current,v.current,{transparent:z,displayMesh:L},{gridHelper:P.current,sectionViewHelper:E.current,pointHelper:A.current},et)}catch(e){el((0,k.iT)({title:e3.load,err:e})),e6(w.current)}})),tn(w.current,S.current)})()},[y,z,L,et]),(0,M.Z)(()=>{var e;if(w.current){if((null===(e=y[0])||void 0===e?void 0:e.summary.dimension)===2){e6(w.current);let e=new ez.Pa4(0,0,1),t=new ez.Pa4(0,1,0),i=new ez.Pa4;w.current.boundingBox.getCenter(i);let n=b.current.position.distanceTo(v.current.target),l=e.clone().multiplyScalar(n),a=i.add(l);b.current.position.copy(a),b.current.up.copy(t),v.current.noRotate=!0}else v.current.noRotate=!1}},[y]),(0,o.useEffect)(()=>{w.current&&w.current.children.forEach(e=>{"Part"===e.type&&e.userData.uuid===K&&(Y?e.startSelection(f.current,b.current,ee):e.stopSelection())})},[Y,K,ee]),(0,o.useEffect)(()=>{w.current&&w.current.children.forEach(e=>{if("Part"===e.type&&e.uuid===K){e.highlight(null==q?void 0:q.uuid);let t=e.getSelected(),i=$.filter(e=>!t.find(t=>t.uuid===e.uuid));i.forEach(t=>{t.uuid&&e.select(t.uuid)});let n=t.filter(e=>!$.find(t=>t.uuid===e.uuid));n.forEach(t=>{e.unselect(t.uuid)})}})},[K,q,$]),(0,o.useEffect)(()=>{var e;w.current&&(null===(e=A.current)||void 0===e||e.update(Q?new ez.Pa4(Q.x,Q.y,Q.z):void 0))},[Q]);let er=(0,o.useCallback)(e=>{N(e),w.current.children.forEach(t=>{"Part"===t.type&&t.setTransparent(e)})},[]),es=(0,o.useCallback)(e=>{D(e),w.current.children.forEach(t=>{"Part"===t.type&&t.setDisplayMesh(e)})},[]),eo=(0,o.useCallback)(()=>{let e=!O;R(e),e?E.current.start():E.current.stop()},[O]),ed=(0,o.useCallback)(()=>{(async()=>{F(!0);try{await tl(h,w.current,b.current,f.current,el)}finally{F(!1)}})()},[h,el]),ec=(0,o.useCallback)(()=>{I(!0);try{ta(h,w.current,b.current,f.current,el)}finally{I(!1)}},[h,el]),eu=(0,o.useCallback)(e=>{var t;null===(t=P.current)||void 0===t||t.setVisible(e)},[]),eN=(0,o.useCallback)(()=>{e9(b.current,v.current,1),n=requestAnimationFrame(()=>eN())},[]),eL=(0,o.useCallback)(()=>{e9(b.current,v.current,-1),n=requestAnimationFrame(()=>eL())},[]),eO=(0,o.useCallback)(()=>{n&&cancelAnimationFrame(n),n=void 0},[]),eR=(0,o.useCallback)(()=>{te(w.current,b.current,v.current)},[]),eF=(0,o.useCallback)(()=>{E.current.toAxis(new ez.Pa4(-1,0,0))},[]),eU=(0,o.useCallback)(()=>{E.current.toAxis(new ez.Pa4(0,-1,0))},[]),eV=(0,o.useCallback)(()=>{E.current.toAxis(new ez.Pa4(0,0,-1))},[]),eX=(0,o.useCallback)(e=>{var t;null===(t=S.current)||void 0===t||t.setColorMap(e.key),tn(w.current,S.current)},[]),eY=(0,o.useCallback)(()=>{B(!0)},[]),eK=(0,o.useCallback)(()=>{B(!1)},[]),eq=(0,o.useCallback)(async e=>{var t;null===(t=S.current)||void 0===t||t.setRange(+e.min,+e.max),tn(w.current,S.current),eK()},[eK]),e$=(0,o.useCallback)(()=>{var e;null===(e=S.current)||void 0===e||e.setAutomaticRange(),tn(w.current,S.current)},[]),eQ=(0,o.useCallback)(e=>{var t,i;let{key:n}=e;"m"===n?null===(t=P.current)||void 0===t||t.setScale(1):null===(i=P.current)||void 0===i||i.setScale(1e3),G(n)},[]),e0=(0,o.useMemo)(()=>{let e=y.filter(e=>"result"===e.summary.type),t=e.map(e=>{var t,i,n;let l=null===(t=e.extra)||void 0===t?void 0:t.fields,a=null===(i=e.extra)||void 0===i?void 0:null===(n=i.name)||void 0===n?void 0:n.split(" ").shift(),r=null==l?void 0:l.find(e=>e.name===a);return null==r?void 0:r.units}).filter(e=>e).flat(),i=t.filter((e,i)=>t.findIndex(t=>t.label===e.label)===i);return i.map(e=>({key:e.label,multiplicator:e.multiplicator,adder:e.adder,label:(0,l.jsx)(H.Z.Inline,{text:e.label})}))},[y]);return(0,l.jsxs)(c.Z,{className:"".concat(J().noScroll," ").concat(e8().view),children:[(0,l.jsxs)(X.ZP,{visible:V,title:"Custom range",initialValues:{min:null===(t=S.current)||void 0===t?void 0:t.getMinV(),max:null===(i=S.current)||void 0===i?void 0:i.getMaxV()},onCancel:eK,onOk:eq,children:[(0,l.jsx)(ei.Z.Item,{label:"Min",name:"min",children:(0,l.jsx)(en.Z,{})}),(0,l.jsx)(ei.Z.Item,{label:"Max",name:"max",children:(0,l.jsx)(en.Z,{})})]}),(0,l.jsxs)(c.Z.Header,{className:e8().head,children:[(0,l.jsxs)(d.Z,{title:"Units",className:e8().unit,children:[(0,l.jsx)(H.Z.Inline,{text:W}),(0,l.jsx)(em.Z,{menu:{onClick:eQ,items:[{key:"m",label:(0,l.jsx)(H.Z.Inline,{text:"m"})},{key:"mm",label:(0,l.jsx)(H.Z.Inline,{text:"mm"})}]},children:(0,l.jsx)(p.ZP,{icon:(0,l.jsx)(ey.Z,{})})})]}),(0,l.jsx)(ep.Z,{style:{margin:0}}),(0,l.jsx)(d.Z,{title:"Take snapshot",placement:"left",children:(0,l.jsx)(em.Z,{placement:"bottom",menu:{items:[{key:"project",label:(0,l.jsx)(p.ZP,{type:"text",className:"".concat(J().fullWidth," ").concat(J().noBackground),loading:_,onClick:ed,children:"Project snapshot"})},{key:"image",label:(0,l.jsx)(p.ZP,{type:"text",className:"".concat(J().fullWidth," ").concat(J().noBackground),loading:U,onClick:ec,children:"Export image"})}]},children:(0,l.jsx)(p.ZP,{icon:(0,l.jsx)(eg.Z,{})})})}),(0,l.jsx)(ep.Z,{style:{margin:0}}),(0,l.jsx)(d.Z,{title:"Display grid",placement:"left",children:(0,l.jsx)(eh.Z,{defaultChecked:!0,checkedChildren:(0,l.jsx)(ew.Z,{}),unCheckedChildren:(0,l.jsx)(ew.Z,{}),onChange:eu})}),(0,l.jsx)(d.Z,{title:"Set transparency",placement:"left",children:(0,l.jsx)(eh.Z,{checked:z,checkedChildren:(0,l.jsx)(eb.Z,{}),unCheckedChildren:(0,l.jsx)(eb.Z,{}),onChange:er})}),(0,l.jsx)(ep.Z,{style:{margin:0}}),(0,l.jsx)(d.Z,{title:"Zoom out",placement:"left",children:(0,l.jsx)(p.ZP,{icon:(0,l.jsx)(ef.Z,{}),onMouseDown:eL,onMouseUp:eO,onMouseOut:eO})}),(0,l.jsx)(d.Z,{title:"Zoom in",placement:"left",children:(0,l.jsx)(p.ZP,{icon:(0,l.jsx)(ev.Z,{}),onMouseDown:eN,onMouseUp:eO,onMouseOut:eO})}),(0,l.jsx)(d.Z,{title:"Zoom to fit",placement:"left",children:(0,l.jsx)(p.ZP,{icon:(0,l.jsx)(ej.Z,{}),onClick:eR})}),(0,l.jsx)(d.Z,{title:"Zoom to selection",placement:"left",children:(0,l.jsx)(p.ZP,{icon:(0,l.jsx)(eP.Z,{}),onClick:(null===(a=Z.current)||void 0===a?void 0:a.isEnabled())?null===(r=Z.current)||void 0===r?void 0:r.end:null===(u=Z.current)||void 0===u?void 0:u.start})}),(0,l.jsx)(ep.Z,{style:{margin:0}}),!O&&(0,l.jsx)(d.Z,{title:"Section view",placement:"left",children:(0,l.jsx)(p.ZP,{icon:(0,l.jsx)(eZ.Z,{}),onClick:eo})}),O&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(d.Z,{title:"Stop",placement:"left",children:(0,l.jsx)(p.ZP,{icon:(0,l.jsx)(eC.Z,{}),onClick:eo})}),(0,l.jsx)(d.Z,{title:"Hide plane",placement:"left",children:(0,l.jsx)(p.ZP,{icon:(0,l.jsx)(x.Z,{}),onClick:E.current.toggleVisible})}),(0,l.jsx)(d.Z,{title:"Snap to X",placement:"left",children:(0,l.jsx)(p.ZP,{className:"ant-btn-icon-only",onClick:eF,children:"X"})}),(0,l.jsx)(d.Z,{title:"Snap to Y",placement:"left",children:(0,l.jsx)(p.ZP,{className:"ant-btn-icon-only",onClick:eU,children:"Y"})}),(0,l.jsx)(d.Z,{title:"Snap to Z",placement:"left",children:(0,l.jsx)(p.ZP,{className:"ant-btn-icon-only",onClick:eV,children:"Z"})}),(0,l.jsx)(d.Z,{title:"Flip",placement:"left",children:(0,l.jsx)(p.ZP,{onClick:E.current.flip,icon:(0,l.jsx)(ek.Z,{})})})]}),y.filter(e=>"result"===e.summary.type).length?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(ep.Z,{style:{margin:0}}),(0,l.jsx)(d.Z,{title:"Display result mesh",placement:"left",children:(0,l.jsx)(eh.Z,{checked:L,checkedChildren:(0,l.jsx)(eM.Z,{}),unCheckedChildren:(0,l.jsx)(eM.Z,{}),onChange:es})}),(0,l.jsx)(ep.Z,{style:{margin:0}}),e0.length?(0,l.jsx)(d.Z,{title:"Units",children:(0,l.jsx)(em.Z,{placement:"bottom",menu:{onClick:e=>{var t;let{key:i}=e,n=e0.find(e=>e.key===i);null===(t=w.current)||void 0===t||t.children.forEach(e=>{if("Part"===e.type&&"result"===e.userData.type){let t=e.name.split(" ").shift(),l=e.fields,a=null==l?void 0:l.find(e=>e.name===t);a&&(a.unit={label:i,multiplicator:n.multiplicator,adder:n.adder})}}),tn(w.current,S.current)},items:e0},children:(0,l.jsx)(p.ZP,{icon:(0,l.jsx)(ey.Z,{})})})}):null,(0,l.jsx)(d.Z,{title:"Colormap",placement:"left",children:(0,l.jsx)(em.Z,{placement:"bottom",menu:{items:[{key:"rainbow",label:"Rainbow"},{key:"cooltowarm",label:"Cool to warm"},{key:"blackbody",label:"Black body"},{key:"grayscale",label:"Gray scale"}],onClick:eX},children:(0,l.jsx)(p.ZP,{icon:(0,l.jsx)(eE.Z,{})})})}),(0,l.jsx)(d.Z,{title:"Custom range",placement:"left",children:(0,l.jsx)(p.ZP,{icon:(0,l.jsx)(eS.Z,{}),onClick:eY})}),(0,l.jsx)(d.Z,{title:"Automatic range",placement:"left",children:(0,l.jsx)(p.ZP,{icon:(0,l.jsx)(eA.Z,{}),onClick:e$})})]}):null]}),(0,l.jsxs)(c.Z.Content,{className:"".concat(J().noScroll," ").concat(e8().content),children:[(0,l.jsx)("div",{style:{display:m?"flex":"none"},className:e8().loading,children:(0,l.jsx)(ex.Z,{indicator:(0,l.jsx)(j.Z,{style:{fontSize:80},spin:!0})})}),(0,l.jsx)("div",{ref:g,className:e8().canvas})]})]})};let ts={part:"Unable to load part"},to=async(e,t,i,n)=>{try{if("geometry"===i){let e=await F.Z.getPart({id:t.id});return{...e,extra:{id:t.id}}}{let i=await eu.Z.load({id:e.id},{originPath:t.originPath,glb:t.glb});return{...i,extra:{name:t.name,glb:t.glb,fields:t.extra}}}}catch(e){throw n((0,k.iT)({title:ts.part,err:e})),e}},td=async(e,t,i,n)=>Promise.all(i.map(async i=>{let l=t.find(e=>{var t;return(null===(t=e.extra)||void 0===t?void 0:t.glb)===i.glb});if(l)return l;let a=await to(e,i,"result",n);return a})),tc=async(e,t,i,n)=>{if(!n)return;let l=t.find(e=>{var t;return(null===(t=e.extra)||void 0===t?void 0:t.glb)===n.glb});if(l)return l;let a=await to(e,n,"result",i);return a},tu=async(e,t,i,n)=>Promise.all(i.map(async i=>{let l=t.find(e=>{var t;return(null===(t=e.extra)||void 0===t?void 0:t.id)===i.id});if(l)return l;let a=await to(e,i,"geometry",n);return a}));var tm=e=>{let{project:t,simulation:i,geometries:n,results:a,postprocessing:r}=e,[s,d]=(0,o.useState)([]),[c,u]=(0,o.useState)(!1),{dispatch:m}=(0,o.useContext)(C.uj);return(0,M.Z)(()=>{(async()=>{u(!0);try{let e=[];if(i&&!r){let t=await td(i,s,a,m);e.push(...t)}if(i){let t=await tc(i,s,m,r);t&&e.push(t)}if(!a.length&&!r){let t=await tu(i,s,n,m);e.push(...t)}d(e)}catch(e){}finally{u(!1)}})()},[i,n,a,r,s],[m]),(0,l.jsx)(tr,{loading:c,project:{id:t.id,title:t.title},parts:s})},tp=i(20807),th=i(39095),tx=i.n(th);let ty=r()(()=>Promise.all([i.e(9779),i.e(8824),i.e(5731),i.e(4830)]).then(i.bind(i,4830)),{loadableGenerated:{webpack:()=>[4830]},ssr:!1}),tg={dashboard:{key:"dashboard"},geometries:{label:"GEOMETRIES",key:"geometries"},simulations:{label:"SIMULATIONS",key:"simulations"}},tw={user:"Unable to get user",project:"Unable to get project",simulations:"Unable to get simulations",geometries:"Unable to get geometries",add:"Unable to add simulation"},tb=async(e,t,i,n)=>{try{var l;let n=await _.Z.add({id:e.id},{name:t.name,scheme:t});await i.addOneSimulation(n),await i.mutateProject({id:e.id,simulations:[...null!==(l=e.simulations)&&void 0!==l?l:[],n.id]})}catch(e){throw n((0,k.iT)({title:tw.add,err:e})),e}},tf=e=>{let{visible:t,geometry:i,panel:n,add:a,del:r,close:s}=e,d=(0,o.useCallback)(e=>{var t,l,a;e.stopPropagation(),(null==n?void 0:null===(t=n.props)||void 0===t?void 0:null===(l=t.children)||void 0===l?void 0:null===(a=l.type)||void 0===a?void 0:a.componentName)===ec.componentName&&s(),r(i)},[i,n,r,s]),c=(0,o.useCallback)(e=>{e.stopPropagation(),a(i)},[i,a]);return(0,l.jsxs)("div",{children:[i.name,t?(0,l.jsx)(h.Z,{onClick:d}):(0,l.jsx)(x.Z,{onClick:c})]})},tv=e=>{let{simulation:t}=e;return t.scheme.userModelId?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(d.Z,{title:"User algorithm",placement:"right",children:(0,l.jsx)(y.Z,{style:{position:"absolute",top:0,left:14,fontSize:14,color:"#fad114"}})}),t.name]}):(0,l.jsx)(l.Fragment,{children:t.name})};var tj=()=>{let e=(0,s.useRouter)(),{page:t,workspaceId:i,projectId:n}=e.query,[a,r]=(0,o.useState)(!1),[d,h]=(0,o.useState)([]),[x,y]=(0,o.useState)(!1),[S,A]=(0,o.useState)(),[z,N]=(0,o.useState)([]),[U,I]=(0,o.useState)(),[V,H]=(0,o.useState)(),[W,X]=(0,o.useState)(),[G,Y]=(0,o.useState)(!0),{dispatch:K}=(0,o.useContext)(C.uj),[q,{errorUser:$,loadingUser:Q}]=O.Z.useUser(),[ee,{mutateProject:et,errorProject:ei,loadingProject:en}]=R.Z.useProject(n),[el,{addOneSimulation:ea,delOneSimulation:er,mutateOneSimulation:es,errorSimulations:eo,loadingSimulations:ed}]=_.Z.useSimulations(null==ee?void 0:ee.simulations),[eu,{addOneGeometry:em,delOneGeometry:ep,mutateOneGeometry:eh,errorGeometries:ex,loadingGeometries:ey}]=F.Z.useGeometries(null==ee?void 0:ee.geometries),eg=(0,o.useCallback)(()=>r(!0),[]),ew=(0,o.useCallback)(()=>y(!0),[]),eb=(0,o.useCallback)(()=>y(!1),[]),ef=(0,o.useCallback)(e=>{h(t=>[...t,e])},[]),ev=(0,o.useCallback)(e=>{let t=d.findIndex(t=>t.id===e.id);-1!==t&&h(e=>[...e.slice(0,t),...e.slice(t+1)])},[d]),ej=(0,o.useCallback)(()=>{X(void 0),H(void 0)},[]),eP=(0,o.useCallback)(e=>{let t=eu.findIndex(t=>t.id===e);-1!==t&&h(e=>[...e.slice(0,t),{id:"0",needCleanup:!0},...e.slice(t+1)])},[eu]),eZ=(0,o.useCallback)(e=>{let t=eu.find(t=>t.id===e);if(!t)return;let i=d.find(t=>t.id===e);i||h(e=>[...e,{...t,visible:!0}]),X((0,l.jsx)(B,{visible:!0,title:"Geometry",onClose:ej,children:(0,l.jsx)(ec,{project:{id:ee.id,geometries:ee.geometries},geometry:{id:t.id,name:t.name,summary:t.summary},swr:{mutateProject:et,mutateOneGeometry:eh,delOneGeometry:ep},close:ej,onCleanup:eP})}))},[ee,eu,d,et,eh,ep,eP,ej]),eC=(0,o.useCallback)(e=>{X((0,l.jsx)(B,{visible:!0,title:"About",onClose:ej,children:(0,l.jsx)(tp.ZP.About,{project:{id:ee.id,simulations:ee.simulations},simulation:{id:e.id,name:e.name,scheme:e.scheme},swr:{mutateProject:et,addOneSimulation:ea,delOneSimulation:er,mutateOneSimulation:es}})}))},[ee,et,ea,er,es,ej]),ek=(0,o.useCallback)(e=>{X((0,l.jsx)(B,{visible:!0,title:"Geometry",onClose:ej,children:(0,l.jsx)(tp.ZP.Geometry,{loadedGeometries:eu,geometries:d.map(e=>({id:e.id,summary:e.summary})),simulation:{id:e.id,scheme:e.scheme},setGeometries:h,swr:{mutateOneSimulation:es}})}))},[eu,d,es,ej]),eM=(0,o.useCallback)(e=>{X((0,l.jsx)(B,{visible:!0,title:"Parameters",onClose:ej,children:(0,l.jsx)(tp.ZP.Parameters,{simulation:{id:e.id,scheme:e.scheme},swr:{mutateOneSimulation:es}})}))},[es,ej]),eE=(0,o.useCallback)(e=>{X((0,l.jsx)(B,{visible:G,title:"Materials",onClose:ej,children:(0,l.jsx)(tp.ZP.Materials,{geometries:d.map(e=>({id:e.id,name:e.name,summary:e.summary})),simulation:{id:e.id,scheme:e.scheme},swr:{mutateOneSimulation:es},setVisible:Y})}))},[d,G,es,ej]),eS=(0,o.useCallback)(e=>{X((0,l.jsx)(B,{visible:!0,title:"Initialization",onClose:ej,children:(0,l.jsx)(tp.ZP.Initialization,{simulations:el,simulation:e,swr:{mutateOneSimulation:es}})}))},[el,es,ej]),eA=(0,o.useCallback)(e=>{X((0,l.jsx)(B,{visible:G,title:"Boundary conditions",onClose:ej,children:(0,l.jsx)(tp.ZP.BoundaryConditions,{geometries:d.map(e=>({id:e.id,name:e.name,summary:e.summary})),simulation:{id:e.id,scheme:e.scheme},swr:{mutateOneSimulation:es},setVisible:Y})}))},[d,G,es,ej]),ez=(0,o.useCallback)(e=>{X((0,l.jsx)(B,{visible:G,title:"Run",onClose:ej,children:(0,l.jsx)(tp.ZP.Run,{geometries:d,simulation:{id:e.id,scheme:e.scheme},results:z,setResults:N,setPostprocessing:I,setVisible:Y,swr:{mutateOneSimulation:es}})}))},[d,z,G,es,ej]),eN=(0,o.useCallback)((e,t)=>{var i,n,l,a,r,s;let o=el.find(t=>t.id===e);if(!o)return;A(o);let d=null===(i=o.scheme)||void 0===i?void 0:null===(n=i.configuration)||void 0===n?void 0:null===(l=n.geometry)||void 0===l?void 0:l.value,c=null===(a=o.scheme)||void 0===a?void 0:null===(r=a.configuration)||void 0===r?void 0:null===(s=r.geometry)||void 0===s?void 0:s.values;if(d){let e=eu.find(e=>e.id===d);e&&h([e])}else if(c){let e=eu.filter(e=>c.includes(e.id));h(e)}switch(t){case"about":eC(o);break;case"geometry":ek(o);break;case"parameters":eM(o);break;case"materials":eE(o);break;case"initialization":eS(o);break;case"boundaryConditions":eA(o);break;case"run":ez(o);break;default:X(void 0)}},[eu,el,eC,ek,eM,eE,eS,eA,ez]),eL=(0,o.useCallback)(()=>{(async()=>{await e.push({pathname:"/dashboard",query:{page:t,workspaceId:i}})})()},[e,t,i]),eD=(0,o.useCallback)(e=>{let t,{keyPath:i}=e,n=i.pop(),l=i.pop(),a=i.pop();a&&(t=a.split("&").pop()),H({key:n,id:l,item:t})},[]),eT=(0,o.useCallback)(async e=>{try{await tb(ee,e.model,{addOneSimulation:ea,mutateProject:et},K),y(!1)}catch(e){}},[ee,ea,et,K]),eO=(0,o.useCallback)(e=>{if(ey)return!0;let t=e.value,i=e.values,n=e.multiple,l=e.n;return(!t||!!eu.filter(e=>e.id===t).length)&&(!n||!i||(l?eu.filter(e=>i.includes(e.id)).length===e.n:!!eu.filter(e=>i.includes(e.id)).length))&&(!!t||!!i)||(e.done=!1,!1)},[eu,ey]);(0,o.useEffect)(()=>{(async()=>{Q||q||await e.replace("/login")})()},[q,Q,e]),(0,o.useEffect)(()=>{$&&K((0,k.iT)({title:tw.user,err:$})),ei&&K((0,k.iT)({title:tw.project,err:ei})),eo&&K((0,k.iT)({title:tw.simulations,err:eo})),ex&&K((0,k.iT)({title:tw.geometries,err:ex}))},[$,ei,eo,ex,K]),(0,M.Z)(()=>{en||ey?r(!1):eu.length?r(!1):r(!0)},[en,ey,eu]),(0,M.Z)(()=>{if(!ey){if(d.length){let e=!1,t=d.map(t=>{let i=eu.find(e=>e.id===(null==t?void 0:t.id));return i?JSON.stringify({...i,visible:void 0})!==JSON.stringify({...t,visible:void 0})?(e=!0,i):t:(e=!0,null)}).filter(e=>e);e&&h(t)}else h(eu[0]?[eu[0]]:[])}},[ey,eu,d],[h]),(0,M.Z)(()=>{if(!ed&&S){let e=el.find(e=>e.id===(null==S?void 0:S.id));e?JSON.stringify(e)!==JSON.stringify(S)&&(A(e),V&&V.key===tg.simulations.key&&eN(V.id,V.item)):(ej(),A(void 0))}},[el,ed,S,V],[A,ej]),(0,M.Z)(()=>{V&&(V.key===tg.geometries.key?eZ(V.id):(eN(V.id,V.item),"run"!==V.item&&(N([]),I(void 0))))},[V,G,z],[eZ,eN,ej]),(0,o.useEffect)(()=>{!z.length&&U&&I(void 0)},[z,U]);let eR=(0,o.useMemo)(()=>eu.map(e=>{let t=d.find(t=>t.id===e.id);return{key:e.id,icon:(0,l.jsx)(g.Z,{}),label:(0,l.jsx)(tf,{visible:!!t,geometry:e,panel:W,add:ef,del:ev,close:ej})}}),[eu,d,W,ef,ev,ej]),e_=(0,o.useMemo)(()=>el.map(e=>{let t=e.scheme.configuration||{},i=[];return Object.keys(t).forEach(n=>{if("dimension"===n)return;let a=t[n],r=(0,l.jsx)(w.Z,{style:{color:"green"}});a.error?r=(0,l.jsx)(b.Z,{style:{color:"red"}}):a.done||(r=(0,l.jsx)(f.Z,{style:{color:"orange"}})),"geometry"!==n||eO(a)||(r=(0,l.jsx)(f.Z,{style:{color:"orange"}})),i[a.index]={key:e.id+"&"+n,disabled:!d.length,icon:r,label:a.title}}),{key:e.id,icon:(0,l.jsx)(v.Z,{}),label:(0,l.jsx)(tv,{simulation:e}),children:[{key:e.id+"&about",disabled:!d.length,icon:(0,l.jsx)(w.Z,{style:{color:"green"}}),label:"About"},...i]}}),[d,el,eO]);return!q||Q||en?(0,l.jsx)(E.Z.Simple,{}):"0"===ee.id?(0,l.jsx)(L,{}):(0,l.jsx)(T.ZP,{children:(0,l.jsxs)(c.Z,{hasSider:!0,children:[(0,l.jsxs)(c.Z.Sider,{theme:"light",className:tx().sider,width:256,children:[(0,l.jsx)("div",{className:J().logo,children:(0,l.jsx)("img",{src:"/images/logo.svg",alt:"Tanatloc"})}),(0,l.jsx)(u.Z,{className:tx().menu1,mode:"inline",items:[{key:"menu-go-back",disabled:!0,style:{cursor:"unset",margin:"10px 0",paddingLeft:10},label:(0,l.jsx)(D.ks,{className:J().fullWidth,onClick:eL,children:"Return to dashboard"})},{type:"divider"},{key:"title",disabled:!0,className:"Menu-title",label:(0,l.jsx)(m.Z.Paragraph,{ellipsis:{tooltip:!0,rows:2},children:ee.title})}]}),(0,l.jsx)("div",{className:tx().menuScroll,children:(0,l.jsx)(u.Z,{mode:"inline",className:tx().menu2,defaultOpenKeys:[tg.geometries.key,tg.simulations.key],items:[{key:tg.geometries.key,className:"SubMenu",icon:ey?(0,l.jsx)(j.Z,{}):(0,l.jsx)(g.Z,{}),label:(0,l.jsxs)(m.Z.Text,{strong:!0,children:[tg.geometries.label," (",eu.length,")"]}),children:[{key:"new_geometry",disabled:!0,label:(0,l.jsx)(p.ZP,{icon:(0,l.jsx)(P.Z,{}),onClick:eg,children:"New Geometry"})},{key:"geometry-needed",disabled:!0,className:d.length?"display-none":"",icon:(0,l.jsx)(f.Z,{style:{color:"red"}}),label:"A Geometry is needed"},...eR]},{key:tg.simulations.key,className:"SubMenu",icon:ed?(0,l.jsx)(j.Z,{}):(0,l.jsx)(v.Z,{}),label:(0,l.jsxs)(m.Z.Text,{strong:!0,children:[tg.simulations.label," (",el.length,")"]}),children:[{key:"new_simulation",disabled:!0,label:(0,l.jsx)(p.ZP,{disabled:!eu.length,icon:(0,l.jsx)(Z.Z,{}),onClick:ew,children:"New Simulation"})},...e_]}],onClick:eD})})]}),(0,l.jsxs)(c.Z.Content,{className:J().noScroll,style:{position:"relative"},children:[(0,l.jsx)(ec.Add,{visible:a,project:{id:ee.id,geometries:ee.geometries},swr:{mutateProject:et,addOneGeometry:em},setVisible:r}),(0,l.jsx)(tp.ZP.Selector,{user:{id:q.id,authorizedplugins:q.authorizedplugins,usermodels:q.usermodels},visible:x,onOk:eT,onCancel:eb}),(0,l.jsx)(tp.ZP.Updater,{user:{authorizedplugins:q.authorizedplugins},simulation:S&&{id:S.id,scheme:S.scheme},swr:{mutateOneSimulation:es}}),W,(0,l.jsx)(tm,{project:{id:ee.id,title:ee.title},simulation:S&&{id:S.id},geometries:d.map(e=>({id:e.id,needCleanup:e.needCleanup})),results:z.map(e=>({name:e.name,glb:e.glb,originPath:e.originPath,extra:e.extra})),postprocessing:U&&{glb:U.glb,originPath:U.originPath}}),(0,l.jsx)(ty,{simulation:S&&{id:S.id,name:S.name}}),(0,l.jsx)(tp.ZP.Postprocessing,{simulation:S&&{id:S.id,scheme:S.scheme},results:z.map(e=>({name:e.name,fileName:e.fileName,originPath:e.originPath})),postprocessing:U&&{name:U.name,fileName:U.fileName},setResult:I})]})]})})}},87819:function(e){e.exports={upload:"add_upload__gI0Tw"}},39095:function(e){e.exports={variables:'"@/styles/variables.css"',colorPrimary:"#fad114",sider:"project_sider__iUhsS",menu1:"project_menu1__XdM_R",menuScroll:"project_menuScroll__78_Ce",menu2:"project_menu2__Txzic"}},60968:function(e){e.exports={variables:'"@/styles/variables.css"',colorPrimary:"#fad114",view:"three_view__MDbup",head:"three_head__fY_4c",unit:"three_unit__z6Chc",content:"three_content__FaWcm",loading:"three_loading__B2ZAP",canvas:"three_canvas__LLX1q"}}}]);