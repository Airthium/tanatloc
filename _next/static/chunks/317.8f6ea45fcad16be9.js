"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[317],{7317:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{errors:function(){return errors},exportCSV:function(){return exportCSV},onCheck:function(){return onCheck}});var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(85893),react__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(67294),antd__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(26713),antd__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(32808),antd__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(97183),antd__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__(84908),antd__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__(71577),antd__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__(63463),antd__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__(70584),_ant_design_icons__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(56299),recharts__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(18870),recharts__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__(9253),recharts__WEBPACK_IMPORTED_MODULE_17__=__webpack_require__(51584),recharts__WEBPACK_IMPORTED_MODULE_18__=__webpack_require__(14195),recharts__WEBPACK_IMPORTED_MODULE_19__=__webpack_require__(3023),recharts__WEBPACK_IMPORTED_MODULE_20__=__webpack_require__(75358),recharts__WEBPACK_IMPORTED_MODULE_21__=__webpack_require__(14888),recharts__WEBPACK_IMPORTED_MODULE_22__=__webpack_require__(44141),lodash__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(96486),_components_assets_button__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(18436),_components_assets_notification__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(67582),_lib_utils__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(64376),_api_simulation__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(23853);let errors={download:"Unable to download CSV"},onCheck=(event,index,columnSelection)=>{let checked=event.target.checked,newSelection=[...columnSelection];return newSelection[index]=checked,newSelection},exportCSV=(simulation,datas,names,camelNames)=>{let CSV="";CSV="x,"+names.join(",")+"\n",datas.forEach(data=>{CSV+=data.x,null==camelNames||camelNames.forEach(name=>{void 0!==data[name]&&(CSV+=","+data[name])}),CSV+="\n"});let fileName=simulation.name+".csv",file=new File([CSV],fileName,{type:"text/csv"}),url=window.URL.createObjectURL(file),link=document.createElement("a");link.href=url,link.setAttribute("download",fileName),link.click(),link.remove()},Data=param=>{let{simulation}=param,[visible,setVisible]=(0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(!1),[datas,setDatas]=(0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(),[names,setNames]=(0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(),[camelNames,setCamelNames]=(0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(),[columns,setColumns]=(0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(),[columnSelection,setColumnSelection]=(0,react__WEBPACK_IMPORTED_MODULE_1__.useState)([!0]),[plot,setPlot]=(0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(),[downloading,setDownloading]=(0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(!1),[currentSimulation]=_api_simulation__WEBPACK_IMPORTED_MODULE_6__.Z.useSimulation(null==simulation?void 0:simulation.id);return((0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(()=>{let tasks=null==currentSimulation?void 0:currentSimulation.tasks;if(!tasks){setDatas(void 0),setNames(void 0),setCamelNames(void 0);return}let tasksDatas=tasks.map(task=>task.datas).filter(t=>t).flatMap(t=>t);if(!tasksDatas.length||!tasksDatas[0].names){setNames(void 0),setCamelNames(void 0);return}tasksDatas.sort((a,b)=>a.x-b.x);let newNames=tasksDatas.map(data=>data.names).flatMap(n=>n).filter((value,index,self1)=>self1.findIndex(s=>s===value)===index),newCamelNames=newNames.map(name=>(0,lodash__WEBPACK_IMPORTED_MODULE_2__.camelCase)(name)),newDatas=[];tasksDatas.forEach((data,index)=>{data.names.forEach((name,nameIndex)=>{let existing=newDatas.find(d=>d.x===data.x);existing?existing[(0,lodash__WEBPACK_IMPORTED_MODULE_2__.camelCase)(name)]=data.ys[nameIndex]:newDatas.push({key:index,x:data.x,[(0,lodash__WEBPACK_IMPORTED_MODULE_2__.camelCase)(name)]:data.ys[nameIndex]})})}),setDatas(newDatas),setNames(newNames),setCamelNames(newCamelNames)},[currentSimulation]),(0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(()=>{if(!datas||!names||!camelNames){setColumns(void 0);return}let tableColumns=names.map((name,index)=>({align:"center",className:"Data-column"+(columnSelection[index]?" Data-column-selected":""),title:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)(antd__WEBPACK_IMPORTED_MODULE_7__.Z,{children:[name,(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(antd__WEBPACK_IMPORTED_MODULE_8__.Z,{checked:columnSelection[index],onChange:event=>setColumnSelection(onCheck(event,index,columnSelection)),children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_ant_design_icons__WEBPACK_IMPORTED_MODULE_9__.Z,{style:{fontSize:20}})})]}),dataIndex:camelNames[index],key:camelNames[index]}));tableColumns.unshift({title:"",dataIndex:"x",key:"x"}),setColumns(tableColumns)},[datas,names,camelNames,columnSelection]),(0,react__WEBPACK_IMPORTED_MODULE_1__.useEffect)(()=>{if(!datas||!names||!camelNames){setPlot(void 0);return}let keys=[],lines=columnSelection.map((selection,index)=>{if(!selection)return;let key=camelNames[index],name=names[index];return keys.push(key),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(recharts__WEBPACK_IMPORTED_MODULE_10__.x,{name:name,type:"monotone",dataKey:key,stroke:_lib_utils__WEBPACK_IMPORTED_MODULE_5__.Z.stringToColor(key),strokeWidth:2},index)}).filter(l=>l),data=datas.map(d=>{let part={x:d.x};return keys.forEach(key=>{d[key]&&(part[key]=d[key])}),part}).filter(d=>d),min=Math.min(...keys.flatMap(key=>data.map(d=>d[key]))),max=Math.max(...keys.flatMap(key=>data.map(d=>d[key])));setPlot({data,min,max,lines})},[datas,names,camelNames,columnSelection]),simulation&&datas&&names&&camelNames)?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(antd__WEBPACK_IMPORTED_MODULE_11__.Z,{style:{position:"absolute",zIndex:100,right:50,bottom:25,backgroundColor:"rgba(255, 255, 255, 0)"},children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)(antd__WEBPACK_IMPORTED_MODULE_11__.Z.Content,{children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(antd__WEBPACK_IMPORTED_MODULE_12__.Z,{title:"Data visualization",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(antd__WEBPACK_IMPORTED_MODULE_13__.Z,{type:"primary",icon:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_ant_design_icons__WEBPACK_IMPORTED_MODULE_9__.Z,{}),onClick:()=>setVisible(!0),style:{width:40,height:40,border:"1px solid #5E14FA",borderRadius:20,marginBottom:-20}})}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(antd__WEBPACK_IMPORTED_MODULE_14__.Z,{title:"Data visualization",placement:"bottom",closable:!0,onClose:()=>setVisible(!1),open:visible,mask:!1,maskClosable:!1,height:"50vh",bodyStyle:{height:"100%",overflow:"hidden"},extra:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_components_assets_button__WEBPACK_IMPORTED_MODULE_3__.o6,{bordered:!0,loading:downloading,disabled:!datas,onDownload(){setDownloading(!0);try{exportCSV(simulation,datas,names,camelNames)}catch(err){(0,_components_assets_notification__WEBPACK_IMPORTED_MODULE_4__.lt)(errors.download,err)}finally{setDownloading(!1)}},children:"Export CSV"}),children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("div",{style:{display:"flex",height:"100%",padding:"10px",justifyContent:"space-around"},children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("div",{style:{display:"flex",height:"100%",width:"45%",overflow:"auto"},children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(antd__WEBPACK_IMPORTED_MODULE_15__.Z,{size:"small",dataSource:datas,columns:columns,pagination:!1,sticky:!0})}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(recharts__WEBPACK_IMPORTED_MODULE_16__.h,{width:"45%",height:"100%",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)(recharts__WEBPACK_IMPORTED_MODULE_17__.w,{data:null==plot?void 0:plot.data,margin:{top:0,right:40,left:40,bottom:0},children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(recharts__WEBPACK_IMPORTED_MODULE_18__.q,{strokeDasharray:"3 3"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(recharts__WEBPACK_IMPORTED_MODULE_19__.K,{dataKey:"x"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(recharts__WEBPACK_IMPORTED_MODULE_20__.B,{domain:[plot&&(null==plot?void 0:plot.min)*.9||-1,plot&&(null==plot?void 0:plot.max)*1.1||1],tickFormatter:value=>new Intl.NumberFormat("en-US",{notation:"scientific",minimumFractionDigits:2,maximumFractionDigits:2}).format(value)}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(recharts__WEBPACK_IMPORTED_MODULE_21__.u,{}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(recharts__WEBPACK_IMPORTED_MODULE_22__.D,{}),null==plot?void 0:plot.lines]})})]})})]})}):null};__webpack_exports__.default=Data}}]);