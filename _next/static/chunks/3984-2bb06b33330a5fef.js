(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3984],{4223:(e,t,i)=>{"use strict";i.d(t,{A:()=>r});var l=i(58168),a=i(96540);let s={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M193 796c0 17.7 14.3 32 32 32h574c17.7 0 32-14.3 32-32V563c0-176.2-142.8-319-319-319S193 386.8 193 563v233zm72-233c0-136.4 110.6-247 247-247s247 110.6 247 247v193H404V585c0-5.5-4.5-10-10-10h-44c-5.5 0-10 4.5-10 10v171h-75V563zm-48.1-252.5l39.6-39.6c3.1-3.1 3.1-8.2 0-11.3l-67.9-67.9a8.03 8.03 0 00-11.3 0l-39.6 39.6a8.03 8.03 0 000 11.3l67.9 67.9c3.1 3.1 8.1 3.1 11.3 0zm669.6-79.2l-39.6-39.6a8.03 8.03 0 00-11.3 0l-67.9 67.9a8.03 8.03 0 000 11.3l39.6 39.6c3.1 3.1 8.2 3.1 11.3 0l67.9-67.9c3.1-3.2 3.1-8.2 0-11.3zM832 892H192c-17.7 0-32 14.3-32 32v24c0 4.4 3.6 8 8 8h688c4.4 0 8-3.6 8-8v-24c0-17.7-14.3-32-32-32zM484 180h56c4.4 0 8-3.6 8-8V76c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v96c0 4.4 3.6 8 8 8z"}}]},name:"alert",theme:"outlined"};var n=i(25363);let r=a.forwardRef(function(e,t){return a.createElement(n.A,(0,l.A)({},e,{ref:t,icon:s}))})},84702:(e,t,i)=>{"use strict";i.d(t,{A:()=>a});var l=i(50641);let a={add:async(e,t)=>(await (0,l.T)("/api/avatar",{method:"POST",headers:{Accept:"application/json"},body:JSON.stringify({file:e,project:t})})).json()}},81118:(e,t,i)=>{"use strict";i.d(t,{A:()=>n});var l=i(8065),a=i(96540),s=i(50641);let n={useGeometries:e=>{var t;let{data:i,error:n,mutate:r}=(0,l.Ay)(["/api/geometries",JSON.stringify({ids:e})],e=>{let[t,i]=e;return(0,s.G)(t,i)}),o=!i,d=null!==(t=null==i?void 0:i.geometries)&&void 0!==t?t:[],c=(0,a.useCallback)(async e=>{let t=[...d,e];await r({geometries:t})},[d,r]),u=(0,a.useCallback)(async e=>{let t=d.filter(t=>t.id!==e.id);await r({geometries:t})},[d,r]),m=(0,a.useCallback)(async e=>{let t=d.map(t=>(t.id===e.id&&(t={...t,...e}),t));await r({geometries:t})},[d,r]);return[d,{addOneGeometry:c,delOneGeometry:u,mutateOneGeometry:m,errorGeometries:n,loadingGeometries:o}]},add:async(e,t)=>(await (0,s.T)("/api/geometry",{method:"POST",body:JSON.stringify({project:e,geometry:t})})).json(),update:async(e,t)=>{await (0,s.T)("/api/geometry/"+e.id,{method:"PUT",body:JSON.stringify(t)})},del:async e=>{await (0,s.T)("/api/geometry/"+e.id,{method:"DELETE"})},download:async e=>(await (0,s.T)("/api/geometry/"+e.id+"/download")).json(),getPart:async e=>(await (0,s.T)("/api/geometry/"+e.id+"/part")).json(),splitStep:async(e,t)=>(await (0,s.T)("/api/geometry/"+t.id+"/splitStep",{method:"POST",body:JSON.stringify({project:e})})).json()}},23984:(e,t,i)=>{"use strict";i.d(t,{Ay:()=>eq});var l=i(74848),a=i(96540),s=i(14953),n=i.n(s),r=i(86715),o=i(75654),d=i(6385),c=i(21807),u=i(78971),m=i(43508),h=i(4071),g=i(20234),y=i(58168);let x={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M296 250c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h384c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8H296zm184 144H296c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h184c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8zm-48 458H208V148h560v320c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8V108c0-17.7-14.3-32-32-32H168c-17.7 0-32 14.3-32 32v784c0 17.7 14.3 32 32 32h264c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm440-88H728v-36.6c46.3-13.8 80-56.6 80-107.4 0-61.9-50.1-112-112-112s-112 50.1-112 112c0 50.7 33.7 93.6 80 107.4V764H520c-8.8 0-16 7.2-16 16v152c0 8.8 7.2 16 16 16h352c8.8 0 16-7.2 16-16V780c0-8.8-7.2-16-16-16zM646 620c0-27.6 22.4-50 50-50s50 22.4 50 50-22.4 50-50 50-50-22.4-50-50zm180 266H566v-60h260v60z"}}]},name:"audit",theme:"outlined"};var p=i(25363),b=a.forwardRef(function(e,t){return a.createElement(p.A,(0,y.A)({},e,{ref:t,icon:x}))});let f={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M864 518H506V160c0-4.4-3.6-8-8-8h-26a398.46 398.46 0 00-282.8 117.1 398.19 398.19 0 00-85.7 127.1A397.61 397.61 0 0072 552a398.46 398.46 0 00117.1 282.8c36.7 36.7 79.5 65.6 127.1 85.7A397.61 397.61 0 00472 952a398.46 398.46 0 00282.8-117.1c36.7-36.7 65.6-79.5 85.7-127.1A397.61 397.61 0 00872 552v-26c0-4.4-3.6-8-8-8zM705.7 787.8A331.59 331.59 0 01470.4 884c-88.1-.4-170.9-34.9-233.2-97.2C174.5 724.1 140 640.7 140 552c0-88.7 34.5-172.1 97.2-234.8 54.6-54.6 124.9-87.9 200.8-95.5V586h364.3c-7.7 76.3-41.3 147-96.6 201.8zM952 462.4l-2.6-28.2c-8.5-92.1-49.4-179-115.2-244.6A399.4 399.4 0 00589 74.6L560.7 72c-4.7-.4-8.7 3.2-8.7 7.9V464c0 4.4 3.6 8 8 8l384-1c4.7 0 8.4-4 8-8.6zm-332.2-58.2V147.6a332.24 332.24 0 01166.4 89.8c45.7 45.6 77 103.6 90 166.1l-256.4.7z"}}]},name:"pie-chart",theme:"outlined"};var v=a.forwardRef(function(e,t){return a.createElement(p.A,(0,y.A)({},e,{ref:t,icon:f}))}),j=i(64716),A=i(92480),w=i(25264);let C={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M709.6 210l.4-.2h.2L512 96 313.9 209.8h-.2l.7.3L151.5 304v416L512 928l360.5-208V304l-162.9-94zM482.7 843.6L339.6 761V621.4L210 547.8V372.9l272.7 157.3v313.4zM238.2 321.5l134.7-77.8 138.9 79.7 139.1-79.9 135.2 78-273.9 158-274-158zM814 548.3l-128.8 73.1v139.1l-143.9 83V530.4L814 373.1v175.2z"}}]},name:"code-sandbox",theme:"outlined"};var k=a.forwardRef(function(e,t){return a.createElement(p.A,(0,y.A)({},e,{ref:t,icon:C}))}),N=i(22481),S=i(71728),z=i(13500),V=i(78252),P=i(40889),T=i(83892),O=i(70551),E=i(32632),M=i(8331),_=i(17004),L=i(4223);let U={notAllowed:"You are not allowed to be here."},G=()=>{let e=(0,r.useRouter)(),t=(0,a.useCallback)(()=>{(0,O.g)(async()=>{await e.push("/")})},[e]);return(0,l.jsx)(c.A,{children:(0,l.jsx)(c.A.Content,{children:(0,l.jsx)(M.A,{title:"Not allowed",children:(0,l.jsxs)(_.A,{direction:"vertical",children:[(0,l.jsxs)(o.A.Text,{children:[(0,l.jsx)(L.A,{style:{color:"red"}})," ",U.notAllowed]}),(0,l.jsxs)(o.A.Text,{children:["Go back"," ",(0,l.jsx)(m.Ay,{type:"link",onClick:t,children:"home"})]})]})})})})};var R=i(67070),H=i(50549),F=i(249),I=i(58779),B=i(58534),J=i(81118),D=i(18358),q=i(38949),W=i.n(q);let K=e=>{let{visible:t,title:i,children:a,onClose:s}=e;return(0,l.jsx)(M.A,{className:W().panel,style:{display:t?"block":"none"},title:i,extra:(0,l.jsx)(m.Ay,{type:"text",icon:(0,l.jsx)(D.A,{}),onClick:s}),children:a})};var Q=i(5602),X=i(61580),Y=i(26603),Z=i(5776);let $=e=>{let{visible:t,geometry:i,setVisible:s,onEdit:n}=e,r=(0,a.useRef)(null),[o,d]=(0,a.useState)(!1);(0,a.useEffect)(()=>{r.current&&r.current.focus()});let c=(0,a.useCallback)(()=>s(!1),[s]),u=(0,a.useCallback)(async e=>{d(!0);try{await n(e),d(!1),s(!1)}catch(e){throw d(!1),e}},[s,n]);return(0,l.jsx)(Z.Ay,{title:"Edit the geometry's name",visible:t,initialValues:{name:i.name},onCancel:c,onOk:u,loading:o,children:(0,l.jsx)(X.A.Item,{name:"name",label:"Name:",rules:[{required:!0,message:"Name is required"}],children:(0,l.jsx)(Y.A,{ref:r})})})},ee={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"defs",attrs:{},children:[{tag:"style",attrs:{}}]},{tag:"path",attrs:{d:"M938.2 508.4L787.3 389c-3-2.4-7.3-.2-7.3 3.6V478H636V184h204v128c0 2.2 1.8 4 4 4h60c2.2 0 4-1.8 4-4V144c0-15.5-12.5-28-28-28H596c-15.5 0-28 12.5-28 28v736c0 15.5 12.5 28 28 28h284c15.5 0 28-12.5 28-28V712c0-2.2-1.8-4-4-4h-60c-2.2 0-4 1.8-4 4v128H636V546h144v85.4c0 3.8 4.4 6 7.3 3.6l150.9-119.4a4.5 4.5 0 000-7.2zM428 116H144c-15.5 0-28 12.5-28 28v168c0 2.2 1.8 4 4 4h60c2.2 0 4-1.8 4-4V184h204v294H244v-85.4c0-3.8-4.3-6-7.3-3.6l-151 119.4a4.52 4.52 0 000 7.1l151 119.5c2.9 2.3 7.3.2 7.3-3.6V546h144v294H184V712c0-2.2-1.8-4-4-4h-60c-2.2 0-4 1.8-4 4v168c0 15.5 12.5 28 28 28h284c15.5 0 28-12.5 28-28V144c0-15.5-12.5-28-28-28z"}}]},name:"split-cells",theme:"outlined"};var et=a.forwardRef(function(e,t){return a.createElement(p.A,(0,y.A)({},e,{ref:t,icon:ee}))}),ei=i(66188),el=i.n(ei);let ea={split:"Unable to split geoemtry"},es=async(e,t)=>{let{message:i}=await J.A.splitStep(e,t);return i},en=e=>{let{project:t,geometry:i}=e,[s,n]=(0,a.useState)(!1),{dispatch:r}=(0,a.useContext)(V.V2),o=(0,a.useMemo)(()=>3!==i.summary.dimension,[i.summary.dimension]),c=(0,a.useCallback)(()=>{(async()=>{n(!0);try{let e=await es(t,i);e.length&&r((0,P.CN)({title:e}))}catch(e){r((0,P.CN)({title:ea.split,err:e}))}finally{n(!1)}})().catch(console.error)},[t,i,r]);return(0,l.jsx)(d.A,{title:"Split volumes",children:(0,l.jsx)(m.Ay,{disabled:o,loading:s,className:el().noBorder,icon:(0,l.jsx)(et,{}),onClick:c})})};var er=i(48287).hp;let eo={download:"Unable to download geometry",update:"Unable to update geometry",del:"Unable to delete geometry"},ed=async e=>{let t=await J.A.download({id:e.id}),i=new File([er.from(t.buffer).toString()],e.name+"."+t.extension),l=window.URL.createObjectURL(i),a=document.createElement("a");a.href=l,a.setAttribute("download",e.name+"."+t.extension),a.click(),a.remove()},ec=async(e,t,i)=>{await J.A.update({id:e.id},[{key:"name",value:t.name}]),e.name=t.name,await i.mutateOneGeometry(e)},eu=async(e,t,i,l)=>{await J.A.del({id:t.id});let a=e.geometries.filter(e=>e!==t.id);await l.mutateProject({id:e.id,geometries:a}),await l.delOneGeometry(t),i()},em=e=>{var t,i,s,n,r,d;let{project:u,geometry:m,swr:h,close:g,onCleanup:y}=e,[x,p]=(0,a.useState)(!1),[b,f]=(0,a.useState)(!1),[v,j]=(0,a.useState)(!1),{dispatch:A}=(0,a.useContext)(V.V2),w=(0,a.useCallback)(()=>f(!0),[]),C=(0,a.useCallback)(()=>{(0,O.g)(async()=>{p(!0);try{await ed(m)}catch(e){A((0,P.CN)({title:eo.download,err:e}))}finally{p(!1)}})},[m,A]),k=(0,a.useCallback)(async e=>{try{await ec(m,e,h)}catch(e){throw A((0,P.CN)({title:eo.update,err:e})),e}},[m,h,A]),N=(0,a.useCallback)(async()=>{j(!0);try{await eu(u,m,g,h),y(m.id)}catch(e){throw A((0,P.CN)({title:eo.del,err:e})),e}finally{j(!1)}},[u,m,h,g,y,A]);return m?(0,l.jsx)(c.A,{children:(0,l.jsx)(c.A.Content,{children:(0,l.jsx)(M.A,{size:"small",title:"Informations",actions:[(0,l.jsx)(en,{project:{id:u.id},geometry:{id:m.id,summary:m.summary}},"split"),(0,l.jsx)(R.fd,{loading:x,onDownload:C},"download"),(0,l.jsxs)("div",{children:[(0,l.jsx)($,{visible:b,geometry:{id:null==m?void 0:m.id,name:null==m?void 0:m.name},setVisible:f,onEdit:k}),(0,l.jsx)(R.lg,{onEdit:w})]},"edit"),(0,l.jsx)(R.et,{loading:v,text:(0,l.jsxs)(l.Fragment,{children:["Are you sure you want to delete the geometry"," ",(0,l.jsx)(o.A.Text,{strong:!0,children:m.name}),"?"]}),onDelete:N},"delete")],children:(0,l.jsxs)(_.A,{direction:"vertical",className:el().fullWidth,children:[(0,l.jsxs)(o.A.Text,{children:[(0,l.jsx)("span",{className:el().textLight,children:"File:"})," ",m.name," "]}),(0,l.jsxs)(o.A.Text,{children:[(0,l.jsx)("span",{className:el().textLight,children:"Unit:"})," ",(0,l.jsx)(Q.A.Inline,{text:"m"})]}),(0,l.jsxs)(l.Fragment,{children:[3===m.summary.dimension&&(0,l.jsxs)(o.A.Text,{children:[(0,l.jsx)("span",{className:el().textLight,children:"Number of solids:"})," ",null!==(n=null===(t=m.summary.solids)||void 0===t?void 0:t.length)&&void 0!==n?n:0]}),(0,l.jsxs)(o.A.Text,{children:[(0,l.jsx)("span",{className:el().textLight,children:"Number of faces:"})," ",null!==(r=null===(i=m.summary.faces)||void 0===i?void 0:i.length)&&void 0!==r?r:0]}),2===m.summary.dimension&&(0,l.jsxs)(o.A.Text,{children:[(0,l.jsx)("span",{className:el().textLight,children:"Number of edges:"})," ",null!==(d=null===(s=m.summary.edges)||void 0===s?void 0:s.length)&&void 0!==d?d:0]})]})]})})})}):(0,l.jsx)(E.A.Simple,{})};var eh=i(5269),eg=i(66081),ey=i.n(eg),ex=i(48287).hp;let ep={add:"Unable to add geometry"},eb=e=>e.name.toLowerCase().includes(".stp")||e.name.toLowerCase().includes(".step")||e.name.toLowerCase().includes(".dxf"),ef=async e=>{let t=new FileReader;return new Promise(i=>{t.addEventListener("load",()=>{i(t.result)}),t.readAsArrayBuffer(e)})},ev=async(e,t,i)=>{if("uploading"===t.file.status)return!0;if("done"===t.file.status){let l=await ef(t.file.originFileObj),a=await J.A.add({id:e.id},{name:t.file.name,uid:t.file.uid,buffer:ex.from(l)});await i.addOneGeometry(a),await i.mutateProject({id:e.id,geometries:[...e.geometries,a.id]})}return!1},ej=e=>{let{visible:t,project:i,swr:s,setVisible:n}=e,[r,d]=(0,a.useState)(!1),{dispatch:c}=(0,a.useContext)(V.V2),u=(0,a.useCallback)(()=>n(!1),[n]),m=(0,a.useCallback)(e=>{(0,O.g)(async()=>{try{let t=await ev(i,e,s);d(t),n(t)}catch(e){c((0,P.CN)({title:ep.add,err:e})),d(!1)}})},[i,s,n,c]);return(0,l.jsx)(Z.Ay,{title:"Upload geometry",visible:t,onCancel:u,cancelButtonProps:{loading:r},children:(0,l.jsxs)(_.A,{direction:"vertical",className:el().fullWidth,children:[(0,l.jsx)(eh.A,{className:ey().upload,action:"/api/noop",accept:".stp,.step,.dxf",showUploadList:!1,listType:"picture-card",beforeUpload:eb,onChange:m,children:(0,l.jsx)("div",{children:r?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(N.A,{style:{fontSize:25}}),(0,l.jsxs)("div",{style:{marginTop:8},children:[(0,l.jsx)("b",{children:"Loading"}),", converting, ..."]})]}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(S.A,{style:{fontSize:25}}),(0,l.jsxs)("div",{style:{marginTop:8},children:[(0,l.jsx)("b",{children:"Choose a file"})," or drop it here"]})]})})}),(0,l.jsx)(o.A.Text,{children:(0,l.jsx)("p",{style:{color:"rgba(0, 0, 0, 0.45)",textAlign:"center"},children:"Native file format preferred: STEP (3D) or DXF (2D) file"})})]})})};var eA=i(8350),ew=i(21303),eC=i(77896),ek=i(84702),eN=i(83144),eS=i(43356),ez=i.n(eS),eV=i(18132);let eP=n()(()=>Promise.all([i.e(9438),i.e(3624),i.e(1084),i.e(1226),i.e(305),i.e(9663)]).then(i.bind(i,18629)).then(e=>e.default.Renderer),{loadableGenerated:{webpack:()=>[18629]},ssr:!1}),eT={part:"Unable to load part",snapshot:"Unable to save snapshot"},eO=async(e,t,i)=>"geometry"===i?{...await J.A.getPart({id:t.id}),extra:{id:t.id}}:{...await eN.A.load({id:e.id},{originPath:t.originPath,glb:t.glb}),extra:{name:t.name,glb:t.glb,fields:t.extra}},eE=async(e,t,i)=>{let l=[];for(let a of i){let i=t.find(e=>{var t;return(null===(t=e.extra)||void 0===t?void 0:t.glb)===a.glb});if(i){l.push(i);continue}let s=await eO(e,a,"result");l.push(s)}return l},eM=async(e,t,i)=>{if(i)return t.find(e=>{var t;return(null===(t=e.extra)||void 0===t?void 0:t.glb)===i.glb})||await eO(e,i,"result")},e_=async(e,t,i)=>{let l=[];for(let a of i){let i=t.find(e=>{var t;return(null===(t=e.extra)||void 0===t?void 0:t.id)===a.id});if(i){l.push(i);continue}let s=await eO(e,a,"geometry");l.push(s)}return l},eL=e=>{let{project:t,simulation:i,geometries:s,results:n,postprocessing:r}=e,[o,d]=(0,a.useState)([]),[c,u]=(0,a.useState)(!1),[m,h]=(0,a.useState)(!1),[g,y]=(0,a.useState)(!1),{enabled:x,part:p,highlighted:b,selected:f,point:v,type:j,dispatch:A}=(0,a.useContext)(H.CW),{dispatch:w}=(0,a.useContext)(V.V2),[C]=B.A.useSimulation(null==i?void 0:i.id);(0,T.A)(()=>{(async()=>{u(!0);let e=[];if(i&&!r){let t=await eE(i,o,n);e.push(...t)}if(i){let t=await eM(i,o,r);t&&e.push(t)}if(!n.length&&!r){let t=await e_(i,o,s);e.push(...t)}d(e)})().catch(e=>{w((0,P.CN)({title:eT.part,err:e})),u(!1)}).finally(()=>u(!1))},[i,s,n,r,o,w]),(0,a.useEffect)(()=>{if("0"===C.id){h(!1);return}let e=C.tasks,t=null==e?void 0:e.map(e=>e.datas).filter(e=>e).flat();(null==t?void 0:t.length)?h(!0):h(!1)},[C]),(0,a.useEffect)(()=>{if(null==i?void 0:i.scheme.configuration.run.postprocessing){let e=!1;o.forEach(t=>{"result"===t.summary.type&&(e=!0)}),e?y(!0):y(!1)}else y(!1)},[i,o]);let k=(0,a.useCallback)(async e=>{try{await ek.A.add({name:"snapshot",uid:"snapshot_"+(0,ew.A)(),data:e},{id:t.id})}catch(e){w((0,P.CN)({title:eT.snapshot,err:e}))}},[t.id,w]),S=(0,a.useCallback)(e=>{A((0,eC.Zt)(e))},[A]),z=(0,a.useCallback)(e=>{A((0,eC.Lt)(e))},[A]),O=(0,a.useCallback)(e=>{A((0,eC.rO)(e))},[A]),E=(0,a.useCallback)(()=>{A((0,eC.XO)(!0))},[A]),M=(0,a.useCallback)(()=>{A((0,eC.wI)(!0))},[A]);return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{style:{display:c?"flex":"none"},className:ez().loading,children:(0,l.jsx)(eA.A,{indicator:(0,l.jsx)(N.A,{style:{fontSize:80},spin:!0})})}),(0,l.jsx)(eP,{theme:eV.A,style:{width:"calc(100vw - 256px)"},parts:o,selection:{enabled:x,part:p,type:j,highlighted:b,selected:f,point:v,onHighlight:S,onSelect:z,onPoint:O},data:m,postProcessing:g,snapshot:{project:{apiRoute:k,size:{width:520,height:312}}},onData:E,onPostProcessing:M})]})};var eU=i(60226),eG=i(86980),eR=i.n(eG);let eH=n()(()=>Promise.all([i.e(9076),i.e(1791),i.e(130)]).then(i.bind(i,30130)),{loadableGenerated:{webpack:()=>[30130]},ssr:!1}),eF={geometries:{label:"GEOMETRIES",key:"geometries"},simulations:{label:"SIMULATIONS",key:"simulations"}},eI={user:"Unable to get user",project:"Unable to get project",simulations:"Unable to get simulations",geometries:"Unable to get geometries",add:"Unable to add simulation"},eB=async(e,t,i)=>{var l;let a=await B.A.add({id:e.id},{name:t.name,scheme:t});await i.addOneSimulation(a),await i.mutateProject({id:e.id,simulations:[...null!==(l=e.simulations)&&void 0!==l?l:[],a.id]})},eJ=e=>{let{visible:t,geometry:i,panel:s,add:n,del:r,close:d}=e,c=(0,a.useCallback)(e=>{var t,l,a;e.stopPropagation(),(null==s?void 0:null===(a=s.props)||void 0===a?void 0:null===(l=a.children)||void 0===l?void 0:null===(t=l.type)||void 0===t?void 0:t.name)===em.name&&d(),r(i)},[i,s,r,d]),u=(0,a.useCallback)(e=>{e.stopPropagation(),n(i)},[i,n]);return(0,l.jsxs)("div",{children:[(0,l.jsx)(o.A.Text,{ellipsis:{tooltip:!0},children:i.name}),t?(0,l.jsx)(h.A,{onClick:c}):(0,l.jsx)(g.A,{onClick:u})]})},eD=e=>{let{simulation:t}=e;return t.scheme.userModelId?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(d.A,{title:"User algorithm",placement:"right",children:(0,l.jsx)(b,{style:{position:"absolute",top:0,left:14,fontSize:14,color:"#fad114"}})}),(0,l.jsx)(o.A.Text,{ellipsis:!0,children:t.name})]}):(0,l.jsx)(l.Fragment,{children:t.name})},eq=()=>{let e=(0,r.useRouter)(),{page:t,workspaceId:i,projectId:s}=e.query,[n,d]=(0,a.useState)(!1),[h,g]=(0,a.useState)([]),[y,x]=(0,a.useState)(!1),[p,b]=(0,a.useState)(),[f,C]=(0,a.useState)([]),[M,_]=(0,a.useState)(),[L,U]=(0,a.useState)(),[D,q]=(0,a.useState)(),[W,Q]=(0,a.useState)(!0),{dispatch:X}=(0,a.useContext)(V.V2),[Y,{errorUser:Z,loadingUser:$}]=F.A.useUser(),[ee,{mutateProject:et,errorProject:ei,loadingProject:ea}]=I.A.useProject(s),es=(0,a.useMemo)(()=>"0"===ee.id?void 0:ee,[ee]),[en,{addOneSimulation:er,delOneSimulation:eo,mutateOneSimulation:ed,errorSimulations:ec,loadingSimulations:eu}]=B.A.useSimulations(null==es?void 0:es.simulations),[eh,{addOneGeometry:eg,delOneGeometry:ey,mutateOneGeometry:ex,errorGeometries:ep,loadingGeometries:eb}]=J.A.useGeometries(null==es?void 0:es.geometries),ef=(0,a.useCallback)(()=>d(!0),[]),ev=(0,a.useCallback)(()=>x(!0),[]),eA=(0,a.useCallback)(()=>x(!1),[]),ew=(0,a.useCallback)(e=>{g(t=>[...t,e])},[]),eC=(0,a.useCallback)(e=>{let t=h.findIndex(t=>t.id===e.id);-1!==t&&g(e=>[...e.slice(0,t),...e.slice(t+1)])},[h]),ek=(0,a.useCallback)(()=>{q(void 0),U(void 0)},[]),eN=(0,a.useCallback)(e=>{let t=eh.findIndex(t=>t.id===e);-1!==t&&g(e=>[...e.slice(0,t),{id:"0",needCleanup:!0},...e.slice(t+1)])},[eh]),eS=(0,a.useCallback)(e=>{let t=eh.find(t=>t.id===e);t&&(h.find(t=>t.id===e)||g(e=>[...e,{...t,visible:!0}]),q((0,l.jsx)(K,{visible:!0,title:"Geometry",onClose:ek,children:(0,l.jsx)(em,{project:{id:es.id,geometries:es.geometries},geometry:{id:t.id,name:t.name,summary:t.summary},swr:{mutateProject:et,mutateOneGeometry:ex,delOneGeometry:ey},close:ek,onCleanup:eN})})))},[es,eh,h,et,ex,ey,eN,ek]),ez=(0,a.useCallback)(e=>{q((0,l.jsx)(K,{visible:!0,title:"About",onClose:ek,children:(0,l.jsx)(eU.Ay.About,{project:{id:es.id,simulations:es.simulations},simulation:{id:e.id,name:e.name,scheme:e.scheme},swr:{mutateProject:et,addOneSimulation:er,delOneSimulation:eo,mutateOneSimulation:ed}})}))},[es,et,er,eo,ed,ek]),eV=(0,a.useCallback)(e=>{q((0,l.jsx)(K,{visible:!0,title:"Geometry",onClose:ek,children:(0,l.jsx)(eU.Ay.Geometry,{geometries:eh,simulation:{id:e.id,scheme:e.scheme},setGeometries:g,swr:{mutateOneSimulation:ed}})}))},[eh,ed,ek]),eP=(0,a.useCallback)(e=>{q((0,l.jsx)(K,{visible:!0,title:"Parameters",onClose:ek,children:(0,l.jsx)(eU.Ay.Parameters,{simulation:{id:e.id,scheme:e.scheme},swr:{mutateOneSimulation:ed}})}))},[ed,ek]),eT=(0,a.useCallback)((e,t)=>{q((0,l.jsx)(K,{visible:W,title:"Materials",onClose:ek,children:(0,l.jsx)(eU.Ay.Materials,{geometries:t,simulation:{id:e.id,scheme:e.scheme},swr:{mutateOneSimulation:ed},setVisible:Q})}))},[W,ed,ek]),eO=(0,a.useCallback)(e=>{q((0,l.jsx)(K,{visible:!0,title:"Initialization",onClose:ek,children:(0,l.jsx)(eU.Ay.Initialization,{simulations:en,simulation:e,swr:{mutateOneSimulation:ed}})}))},[en,ed,ek]),eE=(0,a.useCallback)((e,t)=>{q((0,l.jsx)(K,{visible:W,title:"Boundary conditions",onClose:ek,children:(0,l.jsx)(eU.Ay.BoundaryConditions,{geometries:t,simulation:{id:e.id,scheme:e.scheme},swr:{mutateOneSimulation:ed},setVisible:Q})}))},[W,ed,ek]),eM=(0,a.useCallback)(e=>{q((0,l.jsx)(K,{visible:W,title:"Run",onClose:ek,children:(0,l.jsx)(eU.Ay.Run,{geometries:h,simulation:{id:e.id,scheme:e.scheme},results:f,setResults:C,setPostprocessing:_,setVisible:Q,swr:{mutateOneSimulation:ed}})}))},[h,f,W,ed,ek]),e_=(0,a.useCallback)((e,t)=>{var i,l;let a=en.find(t=>t.id===e);if(!a)return;b(a);let s=(null!==(l=null===(i=a.scheme.configuration)||void 0===i?void 0:i.geometry.children)&&void 0!==l?l:[]).map(e=>{let t=e.value;if(t)return eh.find(e=>e.id===t)}).filter(e=>e);switch(s.length&&g(s),t){case"about":ez(a);break;case"geometry":eV(a);break;case"parameters":eP(a);break;case"materials":eT(a,s);break;case"initialization":eO(a);break;case"boundaryConditions":eE(a,s);break;case"run":eM(a);break;default:q(void 0)}},[eh,en,ez,eV,eP,eT,eO,eE,eM]),eG=(0,a.useCallback)(()=>{(0,O.g)(async()=>{await e.push({pathname:"/dashboard",query:{page:t,workspaceId:i}})})},[e,t,i]),eq=(0,a.useCallback)(e=>{let t,{keyPath:i}=e,l=i.pop(),a=i.pop(),s=i.pop();s&&(t=s.split("&").pop()),U({key:l,id:a,item:t})},[]),eW=(0,a.useCallback)(async e=>{try{await eB(es,e.model,{addOneSimulation:er,mutateProject:et}),x(!1)}catch(e){X((0,P.CN)({title:eI.add,err:e}))}},[es,er,et,X]),eK=(0,a.useCallback)(e=>{if(eb)return!0;let t=!0;for(let i of e.children){let l=i.value;l&&!eh.filter(e=>e.id===l).length&&(e.done=!1,t=!1)}return t},[eh,eb]);(0,a.useEffect)(()=>{(0,O.g)(async()=>{$||Y||await e.replace("/login")})},[Y,$,e]),(0,a.useEffect)(()=>{Z&&X((0,P.CN)({title:eI.user,err:Z})),ei&&X((0,P.CN)({title:eI.project,err:ei})),ec&&X((0,P.CN)({title:eI.simulations,err:ec})),ep&&X((0,P.CN)({title:eI.geometries,err:ep}))},[Z,ei,ec,ep,X]),(0,T.A)(()=>{ea||eb?d(!1):eh.length?d(!1):d(!0)},[ea,eb,eh]),(0,T.A)(()=>{if(!eb){if(h.length){let e=!1,t=h.map(t=>{let i=eh.find(e=>e.id===(null==t?void 0:t.id));return i?JSON.stringify({...i,visible:void 0})!==JSON.stringify({...t,visible:void 0})?(e=!0,i):t:(e=!0,null)}).filter(e=>e);e&&g(t)}else g(eh[0]?[eh[0]]:[])}},[eb,eh,h],[g]),(0,T.A)(()=>{if(!eu&&p){let e=en.find(e=>e.id===(null==p?void 0:p.id));e?JSON.stringify(e)!==JSON.stringify(p)&&(b(e),L&&L.key===eF.simulations.key&&e_(L.id,L.item)):(ek(),b(void 0))}},[en,eu,p,L],[b,ek]),(0,T.A)(()=>{L&&(L.key===eF.geometries.key?eS(L.id):(e_(L.id,L.item),"run"!==L.item&&(C([]),_(void 0))))},[L,W,f],[eS,e_,ek]),(0,a.useEffect)(()=>{!f.length&&M&&_(void 0)},[f,M]);let eQ=(0,a.useMemo)(()=>eh.map(e=>{let t=h.find(t=>t.id===e.id);return{key:e.id,icon:(0,l.jsx)(v,{}),label:(0,l.jsx)(eJ,{visible:!!t,geometry:e,panel:D,add:ew,del:eC,close:ek})}}),[eh,h,D,ew,eC,ek]),eX=(0,a.useMemo)(()=>en.map(e=>{let t=e.scheme.configuration||{},i=[];return Object.keys(t).forEach(a=>{if("dimension"===a)return;let s=t[a],n=(0,l.jsx)(j.A,{style:{color:"green"}});s.error?n=(0,l.jsx)(A.A,{style:{color:"red"}}):s.done||(n=(0,l.jsx)(w.A,{style:{color:"orange"}})),"geometry"!==a||eK(s)||(n=(0,l.jsx)(w.A,{style:{color:"orange"}})),i[s.index]={key:e.id+"&"+a,disabled:!h.length,icon:n,label:s.title}}),{key:e.id,icon:(0,l.jsx)(k,{}),label:(0,l.jsx)(eD,{simulation:e}),children:[{key:e.id+"&about",disabled:!h.length,icon:(0,l.jsx)(j.A,{style:{color:"green"}}),label:"About"},...i]}}),[h,en,eK]);return!Y||$||ea?(0,l.jsx)(E.A.Simple,{}):es?(0,l.jsx)(H.Ay,{children:(0,l.jsxs)(c.A,{hasSider:!0,children:[(0,l.jsxs)(c.A.Sider,{theme:"light",className:eR().sider,width:256,children:[(0,l.jsx)("div",{className:el().logo,children:(0,l.jsx)("img",{src:"/images/logo.svg",alt:"Tanatloc"})}),(0,l.jsx)(u.A,{className:eR().menu1,mode:"inline",items:[{key:"menu-go-back",disabled:!0,style:{cursor:"unset",margin:"10px 0",paddingLeft:10},label:(0,l.jsx)(R.ee,{className:el().fullWidth,onClick:eG,children:"Return to dashboard"})},{type:"divider"},{key:"title",disabled:!0,className:"Menu-title",label:(0,l.jsx)(o.A.Paragraph,{ellipsis:{tooltip:!0,rows:2},children:es.title})}]}),(0,l.jsx)("div",{className:eR().menuScroll,children:(0,l.jsx)(u.A,{mode:"inline",className:eR().menu2,defaultOpenKeys:[eF.geometries.key,eF.simulations.key],items:[{key:eF.geometries.key,className:"SubMenu",icon:eb?(0,l.jsx)(N.A,{}):(0,l.jsx)(v,{}),label:(0,l.jsxs)(o.A.Text,{strong:!0,children:[eF.geometries.label," (",eh.length,")"]}),children:[{key:"new_geometry",disabled:!0,label:(0,l.jsx)(m.Ay,{icon:(0,l.jsx)(S.A,{}),onClick:ef,children:"New Geometry"})},{key:"geometry-needed",disabled:!0,className:h.length?"display-none":"",icon:(0,l.jsx)(w.A,{style:{color:"red"}}),label:"A Geometry is needed"},...eQ]},{key:eF.simulations.key,className:"SubMenu",icon:eu?(0,l.jsx)(N.A,{}):(0,l.jsx)(k,{}),label:(0,l.jsxs)(o.A.Text,{strong:!0,children:[eF.simulations.label," (",en.length,")"]}),children:[{key:"new_simulation",disabled:!0,label:(0,l.jsx)(m.Ay,{disabled:!eh.length,icon:(0,l.jsx)(z.A,{}),onClick:ev,children:"New Simulation"})},...eX]}],onClick:eq})})]}),(0,l.jsxs)(c.A.Content,{className:el().noScroll,style:{position:"relative"},children:[(0,l.jsx)(ej,{visible:n,project:{id:es.id,geometries:es.geometries},swr:{mutateProject:et,addOneGeometry:eg},setVisible:d}),(0,l.jsx)(eU.Ay.Selector,{user:{id:Y.id,authorizedplugins:Y.authorizedplugins,usermodels:Y.usermodels},visible:y,onOk:eW,onCancel:eA}),(0,l.jsx)(eU.Ay.Updater,{user:{authorizedplugins:Y.authorizedplugins},simulation:p&&{id:p.id,scheme:p.scheme},swr:{mutateOneSimulation:ed}}),D,(0,l.jsx)(eL,{project:{id:es.id,title:es.title},simulation:p&&{id:p.id,scheme:p.scheme},geometries:h.map(e=>{if("0"!==e.id)return{id:e.id,needCleanup:e.needCleanup}}).filter(e=>e),results:f.map(e=>({name:e.name,glb:e.glb,originPath:e.originPath,extra:e.extra})),postprocessing:M&&{glb:M.glb,originPath:M.originPath}}),(0,l.jsx)(eH,{simulation:p&&{id:p.id,name:p.name}}),(0,l.jsx)(eU.Ay.Postprocessing,{simulation:p&&{id:p.id,scheme:p.scheme},results:f.map(e=>({name:e.name,fileName:e.fileName,originPath:e.originPath})),postprocessing:M&&{name:M.name,fileName:M.fileName},setResult:_})]})]})}):(0,l.jsx)(G,{})}},66081:e=>{e.exports={upload:"add_upload__OHzcC"}},86980:e=>{e.exports={variables:'"@/styles/variables.css"',colorPrimary:"#fad114",sider:"project_sider__KGpqG",menu1:"project_menu1__iUy_z",menuScroll:"project_menuScroll__d4eJz",menu2:"project_menu2__uQFdm"}},43356:e=>{e.exports={loading:"view_loading__rcZQY"}}}]);