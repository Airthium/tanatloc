"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4278],{91326:function(e,a,t){t.d(a,{Z:function(){return s}});var i=t(59734),r=t(67294),n=t(948);let add=async e=>{let a=await (0,n.R)("/api/organization",{method:"POST",headers:{Accept:"application/json"},body:JSON.stringify(e)});return a.json()},update=async(e,a)=>{await (0,n.R)("/api/organization",{method:"PUT",body:JSON.stringify({organization:e,data:a})})},del=async e=>{await (0,n.R)("/api/organization",{method:"DELETE",body:JSON.stringify(e)})},accept=async e=>{await (0,n.R)("/api/organization/"+e.id,{method:"PUT"})},decline=async e=>{await (0,n.R)("/api/organization/"+e.id,{method:"POST"})},quit=async e=>{await (0,n.R)("/api/organization/"+e.id,{method:"DELETE"})};var s={useOrganizations:()=>{var e;let{data:a,error:t,mutate:s}=(0,i.ZP)("/api/organizations",n._),l=null!==(e=null==a?void 0:a.organizations)&&void 0!==e?e:[],o=(0,r.useCallback)(async e=>{let a=[...l,{...e,pendingowners:[],users:[],pendingusers:[],groups:[]}];await s({organizations:a})},[l,s]),d=(0,r.useCallback)(async e=>{let a=l.filter(a=>a.id!==e.id);await s({organizations:a})},[l,s]),u=(0,r.useCallback)(async e=>{let a=l.map(a=>(a.id===e.id&&(a={...a,...e}),a));await s({organizations:a})},[l,s]);return[l,{addOneOrganization:o,delOneOrganization:d,mutateOneOrganization:u,errorOrganizations:t,loadingOrganizations:!a}]},add:add,update:update,del:del,accept:accept,decline:decline,quit:quit}},2524:function(e,a,t){t.d(a,{Z:function(){return r}});var i=t(948);let add=async e=>{let a=await (0,i.R)("/api/userModel",{method:"POST",body:JSON.stringify({userModel:e})});return a.json()},update=async(e,a)=>{await (0,i.R)("/api/userModel",{method:"PUT",body:JSON.stringify({userModel:e,data:a})})},del=async e=>{await (0,i.R)("/api/userModel",{method:"DELETE",body:JSON.stringify({userModel:e})})};var r={add:add,update:update,del:del}},55043:function(e,a,t){t.d(a,{Z:function(){return s}});var i=t(59734),r=t(67294),n=t(948);let add=async e=>{let a=await (0,n.R)("/api/workspace",{method:"POST",headers:{Accept:"application/json"},body:JSON.stringify(e)});return a.json()},update=async(e,a)=>{await (0,n.R)("/api/workspace",{method:"PUT",body:JSON.stringify({workspace:e,data:a})})},del=async e=>{await (0,n.R)("/api/workspace",{method:"DELETE",body:JSON.stringify(e)})};var s={useWorkspaces:()=>{var e;let{data:a,error:t,mutate:s}=(0,i.ZP)("/api/workspace",n._),l=null!==(e=null==a?void 0:a.workspaces)&&void 0!==e?e:[],o=(0,r.useCallback)(async e=>{let a=[...l,e];await s({workspaces:a})},[l,s]),d=(0,r.useCallback)(async e=>{let a=l.filter(a=>a.id!==e.id);await s({workspaces:a})},[l,s]),u=(0,r.useCallback)(async e=>{let a=l.map(a=>(a.id===e.id&&(a={...a,...e}),a));await s({workspaces:a})},[l,s]);return[l,{addOneWorkspace:o,delOneWorkspace:d,mutateOneWorkspace:u,errorWorkspaces:t,loadingWorkspaces:!a}]},add:add,update:update,del:del}},17072:function(e,a,t){var i=t(85893),r=t(11163),n=t(67294),s=t(65400),l=t.n(s),o=t(97538),d=t(94055),u=t(42378),c=t(53740),p=t(69650),h=t(59134),g=t.n(h),y=t(8061),m=t(54509),k=t(88053),w=t(51274),f=t(97221),v=t(8798),b=t(55043),S=t(2524),j=t(35304),O=t.n(j);let x={share:"Unable to share"},_onShare=async(e,a,t,i,r,n,s)=>{try{if(e){await b.Z.update({id:e.id},[{key:"groups",value:i},{key:"users",value:r}]);let a=f.Z.deepCopy(e);a.groups=i.map(e=>({id:e})),a.users=r.map(e=>({id:e})),await n.mutateOneWorkspace(a)}else if(a){await v.Z.update({id:a.id},[{key:"groups",value:i},{key:"users",value:r}]);let e=f.Z.deepCopy(a);e.groups=i.map(e=>({id:e})),e.users=r.map(e=>({id:e})),await n.mutateOneProject(e)}else{await S.Z.update({id:t.id},[{key:"groups",value:i},{key:"users",value:r}]);let e=f.Z.deepCopy(t);e.groups=i.map(e=>({id:e})),e.users=r.map(e=>({id:e})),await n.mutateUser(e)}}catch(e){throw s((0,m.iT)({title:x.share,err:e})),e}},_userTitle=e=>{let a=e.email;if(e.lastname||e.firstname){var t;a=(e.lastname?e.lastname+" ":"")+(null!==(t=e.firstname)&&void 0!==t?t:"")}return a};a.ZP=e=>{let{disabled:a,workspace:t,project:s,userModel:h,organizations:m,swr:f,style:v}=e,[b,S]=(0,n.useState)(!1),[j,x]=(0,n.useState)(!1),[C,z]=(0,n.useState)([]),[E,Z]=(0,n.useState)([]),[T,P]=(0,n.useState)([]),[N,_]=(0,n.useState)([]),{dispatch:R}=(0,n.useContext)(y.uj),W=(0,r.useRouter)();(0,n.useEffect)(()=>{var e;let a=null!==(e=null!=t?t:s)&&void 0!==e?e:h,i=null==a?void 0:a.groups.map(e=>e.id),r=null==a?void 0:a.users.map(e=>e.id);P(null!=i?i:[]),_(null!=r?r:[])},[t,s,h]),(0,n.useEffect)(()=>{let e=m.map(e=>{let a=e.groups.map(e=>({key:e.id,title:e.name,value:e.id,type:"group"}));return{key:e.id,title:e.name,value:e.id,disabled:!0,checkable:!1,children:a}}),a=[];m.forEach(e=>{e.owners.forEach(e=>{a.push({key:e.id,title:_userTitle(e),value:e.id,type:"user"})}),e.users.forEach(e=>{a.push({key:e.id,title:_userTitle(e),value:e.id,type:"user"})}),e.groups.forEach(e=>{e.users.forEach(e=>{a.push({key:e.id,title:_userTitle(e),value:e.id,type:"user"})})})});let t=a.filter((e,a,t)=>t.findIndex(a=>a.key===e.key)===a);z(e),Z(t)},[m]);let D=(0,n.useCallback)(()=>{(async()=>{await W.push({pathname:"/dashboard",query:{page:"organizations"}})})()},[W]),L=(0,n.useMemo)(()=>{let e="Share this ";return t?e+="workspace":s?e+="project":e+="user model",e+=" with organizations groups"},[t,s]),J=(0,n.useMemo)(()=>{let e="Share this ";return t?e+="workspace":s?e+="project":e+="user model",e+=" with organizations users"},[t,s]),M=(0,n.useMemo)(()=>C.length?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(o.Z.Item,{label:(0,i.jsx)(i.Fragment,{children:L}),children:(0,i.jsx)(u.ZP,{multiple:!0,treeCheckable:!0,treeDefaultExpandAll:!0,showCheckedStrategy:u.ZP.SHOW_ALL,placeholder:"Select groups",dropdownStyle:{maxHeight:400,overflow:"auto"},className:O().fullWidth,treeData:C,value:T,onChange:P})}),(0,i.jsx)(o.Z.Item,{label:(0,i.jsx)(i.Fragment,{children:J}),children:(0,i.jsx)(u.ZP,{multiple:!0,treeCheckable:!0,treeDefaultExpandAll:!0,showCheckedStrategy:u.ZP.SHOW_ALL,placeholder:"Select users",dropdownStyle:{maxHeight:400,overflow:"auto"},className:O().fullWidth,treeData:E,value:N,onChange:_})})]}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("br",{}),(0,i.jsx)(c.Z.Text,{strong:!0,children:"There is no organization for now"}),(0,i.jsx)("br",{}),(0,i.jsxs)(c.Z.Text,{children:["You can create organizations and groups in the"," ",(0,i.jsx)(k.Qj,{onClick:D,children:"Organization menu"}),"."]})]}),[L,J,C,E,T,N,D]),U=(0,n.useCallback)(()=>S(!0),[]),A=(0,n.useCallback)(()=>S(!1),[]),F=(0,n.useCallback)(async()=>{x(!0);try{await _onShare(t,s,h,T,N,f,R),x(!1),S(!1)}catch(e){throw x(!1),e}},[t,s,h,T,N,f,R]),q=(0,n.useMemo)(()=>{let e="Share ";return t?e+="workspace":s?e+="project":e+="user model",e},[t,s]),B=(0,n.useMemo)(()=>{let e="";return t?e+="Workspace":s?e+="Project":e+="User model",e+=": ",t?e+=t.name:s?e+=s.title:e+=null==h?void 0:h.model.name,e},[t,s,h]);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(d.default,{title:"Share",children:(0,i.jsx)(l(),{className:"".concat(O().noBackground," ").concat((null==v?void 0:v.buttonLight)?O().textLight:""," ").concat((null==v?void 0:v.buttonDark)?O().textDark:""," ").concat((null==v?void 0:v.buttonBordered)?"":O().noBorder," ").concat(g()()?O().displayNone:""),id:"share",disabled:a,type:!a||(null==v?void 0:v.buttonBordered)?void 0:"link",icon:(0,i.jsx)(p.Z,{}),onClick:U},"share")}),(0,i.jsxs)(w.ZP,{title:q,visible:b,onCancel:A,onOk:F,loading:j,children:[(0,i.jsx)(c.Z.Title,{level:5,children:B}),M]})]})}}}]);