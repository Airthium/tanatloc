(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4285],{5094:function(e,t,l){"use strict";l.d(t,{Z:function(){return a}});var i=l(11425);let n=async(e,t)=>{let l=await (0,i.R)("/api/avatar",{method:"POST",headers:{Accept:"application/json"},body:JSON.stringify({file:e,project:t})});return l.json()};var a={add:n}},71270:function(e,t,l){"use strict";l.d(t,{Z:function(){return u}});var i=l(11425);let n=async e=>{await (0,i.R)("/api/plugin",{method:"POST",body:JSON.stringify(e)})},a=async e=>{await (0,i.R)("/api/plugin",{method:"PUT",body:JSON.stringify(e)})},r=async e=>{await (0,i.R)("/api/plugin",{method:"DELETE",body:JSON.stringify(e)})};var o=l(59734),s=l(67294);let d=()=>{let{data:e,error:t,mutate:l}=(0,o.ZP)("/api/plugin",i._),n=(null==e?void 0:e.plugins)||[],a=(0,s.useCallback)(e=>{let t=[...n,e];l({plugins:t})},[n,l]),r=(0,s.useCallback)(e=>{let t=n.filter(t=>t.key!==e.key);l({plugins:t})},[n,l]),d=(0,s.useCallback)(e=>{let t=n.map(t=>(t.key===e.key&&(t={...t,...e}),t));l({plugins:t})},[n,l]);return[n,{mutatePlugins:l,addOnePlugin:a,delOnePlugin:r,mutateOnePlugin:d,errorPlugins:t,loadingPlugins:!e}]};var u={add:n,update:a,del:r,usePlugins:d}},10843:function(e,t,l){"use strict";l.d(t,{Z:function(){return r}});var i=l(11425);let n=async()=>{let e=await (0,i.R)("/api/plugins",{method:"GET",headers:{Accept:"application/json"}});return e.json()},a=async()=>{let e=await (0,i.R)("/api/plugins",{method:"POST",headers:{Accept:"application/json"}});return e.json()};var r={list:n,completeList:a}},26791:function(e,t,l){"use strict";l.d(t,{Z:function(){return y}});var i=l(59734),n=l(67294),a=l(11425);let r=e=>{let{data:t,error:l,mutate:r}=(0,i.ZP)(["/api/projects",JSON.stringify({ids:e})],e=>{let[t,l]=e;return(0,a._)(t,l)}),o=(null==t?void 0:t.projects)||[],s=(0,n.useCallback)(e=>{let t=[...o,{...e,users:[],geometries:[],simulations:[],groups:[]}];r({projects:t})},[o,r]),d=(0,n.useCallback)(e=>{let t=o.filter(t=>t.id!==e.id);r({projects:t})},[o,r]),u=(0,n.useCallback)(e=>{let t=o.map(t=>(t.id===e.id&&(t={...t,...e}),t));r({projects:t})},[o,r]);return[o,{addOneProject:s,delOneProject:d,mutateOneProject:u,errorProjects:l,loadingProjects:!t}]},o=e=>{let{data:t,error:l,mutate:r}=(0,i.ZP)("/api/project"+(e?"/"+e:""),a._),o=(null==t?void 0:t.project)||{id:"0"},s=(0,n.useCallback)(e=>{let t={...o,...e};r({project:t})},[o,r]);return[o,{mutateProject:s,errorProject:l,loadingProject:!t}]},s=async(e,t)=>{let l=await (0,a.R)("/api/project",{method:"POST",headers:{Accept:"application/json"},body:JSON.stringify({workspace:{id:e.id},project:t})});return l.json()},d=async(e,t)=>{await (0,a.R)("/api/project/"+e.id,{method:"PUT",body:JSON.stringify(t)})},u=async(e,t)=>{await (0,a.R)("/api/project/"+t.id,{method:"DELETE",body:JSON.stringify({id:e.id})})},c=async e=>(0,a.R)("/api/project/"+e.id+"/archive",{method:"GET",headers:{Accept:"application/json"}}),m=async e=>(0,a.R)("/api/project/"+e.id+"/archive",{method:"PUT"}),h=async e=>(0,a.R)("/api/project/"+e.id+"/archive",{method:"DELETE"}),p=async(e,t)=>(0,a.R)("/api/project/"+e.id+"/archive",{method:"POST",body:JSON.stringify({archive:t})});var y={useProjects:r,useProject:o,add:s,update:d,del:u,archive:c,unarchiveFromServer:m,deleteArchiveFile:h,unarchiveFromFile:p}},23853:function(e,t,l){"use strict";l.d(t,{Z:function(){return y}});var i=l(59734),n=l(67294),a=l(11425);let r=e=>{let{data:t,error:l,mutate:r}=(0,i.ZP)(["/api/simulations",JSON.stringify({ids:e})],e=>{let[t,l]=e;return(0,a._)(t,l)}),o=(null==t?void 0:t.simulations)||[],s=(0,n.useCallback)(e=>{let t=[...o,e];r({simulations:t})},[o,r]),d=(0,n.useCallback)(e=>{let t=o.filter(t=>t.id!==e.id);r({simulations:t})},[o,r]),u=(0,n.useCallback)((e,t)=>{let l=o.map(t=>(t.id===e.id&&(t={...t,...e}),t));r({simulations:l},t)},[o,r]);return[o,{addOneSimulation:s,delOneSimulation:d,mutateOneSimulation:u,errorSimulations:l,loadingSimulations:!t}]},o=(e,t)=>{let{data:l,error:r,mutate:o}=(0,i.ZP)("/api/simulation"+(e?"/"+e:""),a._,{refreshInterval:t||0}),s=(null==l?void 0:l.simulation)||{id:"0"},d=(0,n.useCallback)(e=>{o({simulation:{...s,...e}})},[s,o]);return[s,{mutateSimulation:d,errorSimulation:r,loadingSimulation:!l}]},s=async(e,t)=>{let l=await (0,a.R)("/api/simulation",{method:"POST",headers:{Accept:"application/json"},body:JSON.stringify({project:{id:e.id},simulation:t})});return l.json()},d=async(e,t)=>{await (0,a.R)("/api/simulation/"+e.id,{method:"PUT",body:JSON.stringify(t)})},u=async e=>{await (0,a.R)("/api/simulation/"+e.id,{method:"DELETE"})},c=async e=>{await (0,a.R)("/api/simulation/"+e.id+"/run",{method:"GET"})},m=async e=>{await (0,a.R)("/api/simulation/"+e.id+"/stop",{method:"GET"})},h=async e=>{let t=await (0,a.R)("/api/simulation/"+e.id+"/tasks",{method:"GET",headers:{Accept:"application/json"}});return t.json()},p=async(e,t)=>{let l=await (0,a.R)("/api/simulation/"+e.id+"/log",{method:"POST",body:JSON.stringify({file:t})});return l.json()};var y={useSimulations:r,useSimulation:o,add:s,update:d,del:u,run:c,stop:m,tasks:h,log:p}},44285:function(e,t,l){"use strict";let i;l.d(t,{ZP:function(){return ns}});var n,a,r,o=l(14288),s=l(5152),d=l.n(s),u=l(11163),c=l(67294),m=l(83062),h=l(97183),p=l(68508),y=l(22850),Z=l(71577),v=l(99611),g=l(90420),f=l(73480),b=l(48869),w=l(8751),C=l(18429),k=l(11475),x=l(22844),P=l(50888),S=l(88484),E=l(64789),M=l(70917),B=l(12935),O=l(67641),j=l(85813),T=l(26713),X=l(20280);let L={notAllowed:"You are not allowed to be here."},A=()=>{let e=(0,u.useRouter)(),t=(0,c.useCallback)(()=>e.push("/"),[e]);return(0,o.tZ)(h.Z,{children:(0,o.tZ)(h.Z.Content,{children:(0,o.tZ)(j.Z,{title:"Not allowed",children:(0,o.BX)(T.Z,{direction:"vertical",children:[(0,o.BX)(y.Z.Text,{children:[(0,o.tZ)(X.Z,{style:{color:"red"}})," ",L.notAllowed]}),(0,o.BX)(y.Z.Text,{children:["Go back"," ",(0,o.tZ)(Z.ZP,{type:"link",onClick:t,children:"home"})]})]})})})})};var z=l(18436),N=l(12271);let R={enabled:!1,type:void 0,part:void 0,highlighted:void 0,selected:[],point:void 0,dispatch:()=>void 0},I={ENABLE:"ENABLE",DISABLE:"DISABLE",CLEAR:"CLEAR",SETTYPE:"SETTYPE",SETPART:"SETPART",HIGHLIGHT:"HIGHLIGHT",UNHIGHLIGHT:"UNHIGHLIGHT",SELECT:"SELECT",UNSELECT:"UNSELECT",SETPOINT:"SETPOINT"},H=(0,c.createContext)(R),D=(e,t)=>{let l;switch(t.type){case I.ENABLE:return{...e,enabled:!0};case I.DISABLE:return{...e,enabled:!1,highlighted:void 0,selected:[],point:void 0};case I.CLEAR:return{...R};case I.SETTYPE:return{...e,type:t.value};case I.SETPART:return{...e,part:t.value};case I.HIGHLIGHT:return{...e,highlighted:t.value};case I.UNHIGHLIGHT:return{...e,highlighted:void 0};case I.SELECT:if(-1===(l=e.selected.findIndex(e=>e.uuid===t.value.uuid)))return{...e,selected:[...e.selected,t.value]};return e;case I.UNSELECT:if(-1===(l=e.selected.findIndex(e=>e.uuid===t.value.uuid)))return e;return{...e,selected:[...e.selected.slice(0,l),...e.selected.slice(l+1)]};case I.SETPOINT:return{...e,point:t.value};default:return e}},K=e=>{let{children:t}=e,[l,i]=(0,c.useReducer)(D,R),n=(0,c.useMemo)(()=>({...l,dispatch:i}),[l]);return(0,o.tZ)(H.Provider,{value:n,children:t})};var U=l(55734),W=l(26791),Y=l(23853),V=l(59734),F=l(11425);let G=e=>{let{data:t,error:l,mutate:i}=(0,V.ZP)(["/api/geometries",JSON.stringify({ids:e})],e=>{let[t,l]=e;return(0,F._)(t,l)}),n=(null==t?void 0:t.geometries)||[],a=(0,c.useCallback)(e=>{let t=[...n,e];i({geometries:t})},[n,i]),r=(0,c.useCallback)(e=>{let t=n.filter(t=>t.id!==e.id);i({geometries:t})},[n,i]),o=(0,c.useCallback)(e=>{let t=n.map(t=>(t.id===e.id&&(t={...t,...e}),t));i({geometries:t})},[n,i]);return[n,{addOneGeometry:a,delOneGeometry:r,mutateOneGeometry:o,errorGeometries:l,loadingGeometries:!t}]},J=async(e,t)=>{let l=await (0,F.R)("/api/geometry",{method:"POST",body:JSON.stringify({project:e,geometry:t})});return l.json()},_=async(e,t)=>{await (0,F.R)("/api/geometry/"+e.id,{method:"PUT",body:JSON.stringify(t)})},q=async e=>{await (0,F.R)("/api/geometry/"+e.id,{method:"DELETE"})},$=async e=>{let t=await (0,F.R)("/api/geometry/"+e.id+"/download");return t.json()},Q=async e=>{let t=await (0,F.R)("/api/geometry/"+e.id+"/part");return t.json()};var ee={useGeometries:G,add:J,update:_,del:q,download:$,getPart:Q},et=l(97937);let el={panel:(0,M.iv)({position:"absolute",top:0,left:"-1px",width:"256px",maxHeight:"100vh",zIndex:100,overflow:"hidden",img:{maxWidth:"80%"},"& > .ant-card-body":{maxHeight:"calc(100vh - 65px)",overflow:"auto",padding:0},"& .ant-card-head":{height:"48px",fontSize:"20px",fontWeight:"bold",padding:"0 12px",border:"none",".ant-btn":{border:"none"}},"& .ant-card":{border:"none"},"& .ant-collapse":{border:"none"},"& .ant-collapse-item":{border:"none"},"& .ant-collapse-content-box":{padding:"0 !important",backgroundColor:"#fafafa",".ant-card-head":{backgroundColor:"#fafafa"},".ant-card-body":{backgroundColor:"#fafafa"}}}),subPanel:(0,M.iv)({"& .ant-card":{border:"none",borderBottom:"1px solid #f0f0f0"},"& .ant-card-body":{paddingRight:"0",paddingLeft:"0"},"& .ant-radio-group":{display:"flex",flexWrap:"wrap",gap:"10px"}})},ei=e=>{let{visible:t,title:l,children:i,onClose:n}=e;return(0,o.tZ)(j.Z,{css:(0,M.iv)([el.panel,{display:t?"block":"none"}]),title:l,extra:(0,o.tZ)(Z.ZP,{type:"text",icon:(0,o.tZ)(et.Z,{}),onClick:n}),children:i})};var en=l(35083),ea=l(31365),er=l(28345),eo=l(86159),es=l(48764).lW;let ed={add:"Unable to add geometry"},eu=e=>e.name.toLowerCase().includes(".stp")||e.name.toLowerCase().includes(".step")||e.name.toLowerCase().includes(".dxf"),ec=async e=>{let t=new FileReader;return new Promise(l=>{t.addEventListener("load",()=>{l(t.result)}),t.readAsArrayBuffer(e)})},em=async(e,t,l)=>{if("uploading"===t.file.status)return!0;if("done"===t.file.status){let i=await ec(t.file.originFileObj);try{let n=await ee.add({id:e.id},{name:t.file.name,uid:t.file.uid,buffer:es.from(i)});l.addOneGeometry(n),l.mutateProject({id:e.id,geometries:[...e.geometries,n.id]})}catch(e){throw(0,N.lt)(ed.add,e),e}}return!1},eh=e=>{let{visible:t,project:l,swr:i,setVisible:n}=e,[a,r]=(0,c.useState)(!1),s=(0,c.useCallback)(()=>n(!1),[n]),d=(0,c.useCallback)(async e=>{try{let t=await em(l,e,i);r(t),n(t)}catch(e){r(!1)}},[l,i,n]);return(0,o.tZ)(er.ZP,{title:"Upload geometry",visible:t,onCancel:s,cancelButtonProps:{loading:a},children:(0,o.BX)(T.Z,{direction:"vertical",css:eo.KP.fullWidth,children:[(0,o.tZ)(ea.Z,{css:(0,M.iv)({"& .ant-upload":{width:"100% !important",height:"100px !important"}}),action:"/api/noop",accept:".stp,.step,.dxf",showUploadList:!1,listType:"picture-card",beforeUpload:eu,onChange:d,children:(0,o.tZ)("div",{children:a?(0,o.BX)(o.HY,{children:[(0,o.tZ)(P.Z,{style:{fontSize:25}}),(0,o.BX)("div",{style:{marginTop:8},children:[(0,o.tZ)("b",{children:"Loading"}),", converting, ..."]})]}):(0,o.BX)(o.HY,{children:[(0,o.tZ)(S.Z,{style:{fontSize:25}}),(0,o.BX)("div",{style:{marginTop:8},children:[(0,o.tZ)("b",{children:"Choose a file"})," or drop it here"]})]})})}),(0,o.tZ)(y.Z.Text,{children:(0,o.tZ)("p",{style:{color:"rgba(0, 0, 0, 0.45)",textAlign:"center"},children:"Native file format preferred: STEP (3D) or DXF (2D) file"})})]})})};var ep=l(96108),ey=l(69677);let eZ=e=>{let{visible:t,geometry:l,setVisible:i,onEdit:n}=e,a=(0,c.useRef)(null),[r,s]=(0,c.useState)(!1);(0,c.useEffect)(()=>{a.current&&a.current.focus()});let d=(0,c.useCallback)(()=>i(!1),[i]),u=(0,c.useCallback)(async e=>{s(!0);try{await n(e),s(!1),i(!1)}catch(e){throw s(!1),e}},[i,n]);return(0,o.tZ)(er.ZP,{title:"Edit the geometry's name",visible:t,initialValues:{name:l.name},onCancel:d,onOk:u,loading:r,children:(0,o.tZ)(ep.Z.Item,{name:"name",label:"Name:",rules:[{required:!0,message:"Name is required"}],children:(0,o.tZ)(ey.Z,{ref:a})})})};var ev=l(48764).lW;let eg={download:"Unable to download geometry",update:"Unable to update geometry",del:"Unable to delete geometry"},ef=async e=>{try{let t=await ee.download({id:e.id}),l=new File([ev.from(t.buffer).toString()],e.name+"."+t.extension),i=window.URL.createObjectURL(l),n=document.createElement("a");n.href=i,n.setAttribute("download",e.name+"."+t.extension),n.click(),n.remove()}catch(e){(0,N.lt)(eg.download,e)}},eb=async(e,t,l)=>{try{await ee.update({id:e.id},[{key:"name",value:t.name}]),e.name=t.name,l.mutateOneGeometry(e)}catch(e){throw(0,N.lt)(eg.update,e),e}},ew=async(e,t,l,i)=>{try{await ee.del({id:e.id});let n=t.geometries.filter(t=>t!==e.id);i.mutateProject({id:t.id,geometries:n}),i.delOneGeometry(e),l()}catch(e){throw(0,N.lt)(eg.del,e),e}},eC=e=>{var t,l,i,n,a,r;let{project:s,geometry:d,swr:u,close:m,onCleanup:p}=e,[Z,v]=(0,c.useState)(!1),[g,f]=(0,c.useState)(!1),[b,w]=(0,c.useState)(!1),C=(0,c.useCallback)(()=>f(!0),[]),k=(0,c.useCallback)(async()=>{v(!0);try{await ef(d)}catch(e){}finally{v(!1)}},[d]),x=(0,c.useCallback)(async e=>eb(d,e,u),[d,u]),P=(0,c.useCallback)(async()=>{w(!0);try{await ew(d,s,m,u),p(d.id)}finally{w(!1)}},[s,d,u,m,p]);return d?(0,o.tZ)(h.Z,{children:(0,o.tZ)(h.Z.Content,{children:(0,o.tZ)(j.Z,{size:"small",title:"Informations",actions:[(0,o.tZ)(z.o6,{loading:Z,onDownload:k},"download"),(0,o.BX)("div",{children:[(0,o.tZ)(eZ,{visible:g,geometry:{id:null==d?void 0:d.id,name:null==d?void 0:d.name},setVisible:f,onEdit:x}),(0,o.tZ)(z.w6,{onEdit:C})]},"edit"),(0,o.tZ)(z.m1,{loading:b,text:(0,o.BX)(o.HY,{children:["Are you sure you want to delete the geometry"," ",(0,o.tZ)(y.Z.Text,{strong:!0,children:d.name}),"?"]}),onDelete:P},"delete")],children:(0,o.BX)(T.Z,{direction:"vertical",css:eo.KP.fullWidth,children:[(0,o.BX)(y.Z.Text,{children:[(0,o.tZ)("span",{css:eo.KP.textLight,children:"File:"})," ",d.name," "]}),(0,o.BX)(y.Z.Text,{children:[(0,o.tZ)("span",{css:eo.KP.textLight,children:"Unit:"})," ",(0,o.tZ)(en.Z.Inline,{text:"m"})]}),(0,o.BX)(o.HY,{children:[3===d.summary.dimension&&(0,o.BX)(y.Z.Text,{children:[(0,o.tZ)("span",{css:eo.KP.textLight,children:"Number of solids:"})," ",null!==(n=null===(t=d.summary.solids)||void 0===t?void 0:t.length)&&void 0!==n?n:0]}),(0,o.BX)(y.Z.Text,{children:[(0,o.tZ)("span",{css:eo.KP.textLight,children:"Number of faces:"})," ",null!==(a=null===(l=d.summary.faces)||void 0===l?void 0:l.length)&&void 0!==a?a:0]}),2===d.summary.dimension&&(0,o.BX)(y.Z.Text,{children:[(0,o.tZ)("span",{css:eo.KP.textLight,children:"Number of edges:"})," ",null!==(r=null===(i=d.summary.edges)||void 0===i?void 0:i.length)&&void 0!==r?r:0]})]})]})})})}):(0,o.tZ)(O.Z.Simple,{})};eC.componentName="Geometry",eC.Add=eh;let ek=async(e,t)=>{let l=await (0,F.R)("/api/result",{method:"POST",headers:{Accept:"application/json"},body:JSON.stringify({simulation:e,result:t})});return l.json()},ex=async(e,t)=>(0,F.R)("/api/result/download",{method:"POST",body:JSON.stringify({simulation:e,result:t})}),eP=async e=>(0,F.R)("/api/result/archive",{method:"POST",body:JSON.stringify({simulation:e})});var eS={load:ek,download:ex,archive:eP},eE=l(71648),eM=l(20137),eB=l(72269),eO=l(57953),ej=l(41428),eT=l(38095),eX=l(86350),eL=l(15668),eA=l(35598),ez=l(74317),eN=l(49591),eR=l(19478),eI=l(87784),eH=l(75843),eD=l(15611),eK=l(99477),eU=l(57632),eW=l(79753),eY=l(54458),eV=l(58939),eF=l(24065),eG=l(54327);let eJ=e=>{let t=new eK.fHI(.025,.025,.8,50);t.translate(0,.4,0);let l=new eK.vBJ({color:e}),i=new eK.Kj0(t,l),n=new eK.b_z(.05,.2,50);n.translate(0,.9,0);let a=new eK.vBJ({color:e}),r=new eK.Kj0(n,a),o=new eK.ZAu;o.type="ArrowHelper",o.add(i),o.add(r);let s=()=>{t.dispose(),l.dispose(),n.dispose(),a.dispose()};return o.dispose=s,o},e_=(e,t,l)=>{let i=document.createElement("canvas");i.width=(null==l?void 0:l.width)||256,i.height=256;let n=i.getContext("2d");n.fillStyle="grey",n.font="50px sans-serif",n.textAlign=(null==l?void 0:l.align)||"center",n.textBaseline="middle",n.fillText(t,i.width/2,i.height/2);let a=new eK.xEZ(i);a.flipY=!0,a.needsUpdate=!0;let r=new eK.xeV({map:a,transparent:!0,depthWrite:!1});r.map.anisotropy=e.capabilities.getMaxAnisotropy();let o=new eK.jyi(r);o.type="LabelHelper",(null==l?void 0:l.position)&&o.position.copy(l.position),(null==l?void 0:l.scale)&&o.scale.setScalar(l.scale);let s=()=>{a.dispose(),r.dispose()};return o.dispose=s,o},eq=function(e,t){let{offsetWidth:l,offsetHeight:i,width:n,height:a}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{offsetWidth:0,offsetHeight:0,width:150,height:150},r=l,o=i,s=n,d=a,u=eJ("red");u.rotateZ(-Math.PI/2);let c=e_(e,"X",{position:new eK.Pa4(1.1,0,0)}),m=eJ("green"),h=e_(e,"Y",{position:new eK.Pa4(0,1.1,0)}),p=eJ("blue");p.rotateX(Math.PI/2);let y=e_(e,"Z",{position:new eK.Pa4(0,0,1.1)}),Z=new eK.xo$(.05,50,50),v=new eK.vBJ({color:"black"}),g=new eK.Kj0(Z,v),f=new eK.ZAu;f.type="AxisHelper",f.add(u),f.add(c),f.add(m),f.add(h),f.add(p),f.add(y),f.add(g);let b=new eK.xsS;b.add(f);let w=new eK.iKG(-1.2,1.2,1.2,-1.2,-2,2),C=e=>{let{newOffsetWidth:t,newOffsetHeight:l,newWidth:i,newHeight:n}=e;r=t,o=l,s=i,d=n},k=()=>{e.setViewport(r,o,s,d),w.rotation.copy(t.rotation),e.render(b,w)},x=()=>{Z.dispose(),v.dispose(),f.children.forEach(e=>{("ArrowHelper"===e.type||"LabelHelper"===e.type)&&e.dispose()}),b.remove(f)};return{dispose:x,render:k,resize:C}},e$=(e,t,l,i,n,a)=>{let{smooth:r,radius:o,left:s,down:d}=n,{xc:u,yc:c,uc:m,vc:h}=a;for(let n=0;n<=r;n++){let a=Math.PI/2*(e+n/r),p=Math.cos(a),y=Math.sin(a);if(t.push(u+o*p,c+o*y,0),l.push(m+s*p,h+d*y),n<r){let t=(r+1)*e+n+4;i.push(e,t,t+1)}}},eQ=(e,t,l,i)=>{let n=e/2-l,a=t/2-l,r=l/e,o=(e-l)/e,s=l/t,d=(t-l)/t,u=[n,a,0,-n,a,0,-n,-a,0,n,-a,0],c=[o,d,r,d,r,s,o,s],m=[3*(i+1)+3,3*(i+1)+4,i+4,i+5,2*(i+1)+4,2,1,2*(i+1)+3,3,4*(i+1)+3,4,0],h=[m[0],m[1],m[2],m[0],m[2],m[3],m[4],m[5],m[6],m[4],m[6],m[7],m[8],m[9],m[10],m[8],m[10],m[11]];for(let e=0;e<4;e++){let t=e<1||e>2?n:-n,m=e<2?a:-a,p=e<1||e>2?o:r,y=e<2?d:s;e$(e,u,c,h,{smooth:i,radius:l,left:r,down:s},{xc:t,yc:m,uc:p,vc:y})}let p=new eK.u9r;return p.setIndex(new eK.lCJ(h,1)),p.setAttribute("position",new eK.a$l(u,3)),p.setAttribute("uv",new eK.a$l(c,2)),p},e0=function(e,t,l,i){let{offsetWidth:n,offsetHeight:a,width:r,height:o}=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{offsetWidth:0,offsetHeight:0,width:150,height:150},s="#d3d3d3",d=null,u=null,c=[{text:"FRONT",normal:new eK.Pa4(0,0,1),up:new eK.Pa4(0,1,0)},{text:"BACK",normal:new eK.Pa4(0,0,-1),up:new eK.Pa4(0,1,0)},{text:"RIGHT",normal:new eK.Pa4(1,0,0),up:new eK.Pa4(0,1,0)},{text:"LEFT",normal:new eK.Pa4(-1,0,0),up:new eK.Pa4(0,1,0)},{text:"UP",normal:new eK.Pa4(0,1,0),up:new eK.Pa4(0,0,-1)},{text:"DOWN",normal:new eK.Pa4(0,-1,0),up:new eK.Pa4(0,0,1)}],m=eQ(75,75,25,20),h=new eK.xo$(37.5,10,10,0,Math.PI,0),p=new eK.ZAu;c.forEach(e=>{let t=document.createElement("canvas"),l=t.getContext("2d");t.width=t.height=256,l.fillStyle=s,l.fillRect(0,0,t.width,t.height),l.font="bold 50pt sans-serif",l.fillStyle="#000000",l.textAlign="center",l.textBaseline="middle",l.fillText(e.text,t.width/2,t.height/2);let i=new eK.ROQ(t);i.needsUpdate=!0;let n=new eK.vBJ({map:i,transparent:!0,opacity:.75}),a=new eK.vBJ({color:s}),r=new eK.Kj0(m,n),o=new eK.Kj0(m,a);o.rotateY(Math.PI);let d=new eK.vBJ({color:s,transparent:!0,opacity:.2}),u=new eK.Kj0(h,d),c=new eK.ZAu;c.add(r,o,u),c.lookAt(e.normal),c.translateZ(50),c.normal=e.normal,c.up=e.up,p.add(c)});let y=new eK.Mig("#ffffff",1),Z=new eK.xsS;Z.add(p),Z.add(y);let v=new eK.iKG(-100,100,100,-100,-100,100);v.position.z=2;let g=new eK.iMs,f=e=>{let t=b(e);w(t)?(d=C(t),k(),(null==d?void 0:d.uuid)!==(null==u?void 0:u.uuid)&&(x(),u=d)):(d=null,x())},b=e=>{let t=e.target,l=t.getBoundingClientRect(),i=e.clientX-l.left,s=e.clientY-l.top,d=new eK.FM8;return d.x=(i-n)/r*2-1,d.y=-(2*((s+o-l.height+a)/o))+1,d},w=e=>e.x>-1&&e.x<1&&e.y>-1&&e.y<1,C=e=>{let t=new eK.Pa4(e.x,e.y,-1);t.unproject(v);let l=new eK.Pa4;v.getWorldDirection(l),g.set(t,l);let i=g.intersectObjects(Z.children,!0);return i.length?i[0].object.parent:null},k=()=>{d&&d.children&&d.children.forEach(e=>{let t=e;t.material&&t.material.color&&(t.material.previousColor=t.material.color,t.material.color=new eK.Ilk("#FAD114"))})},x=()=>{u&&u.children&&u.children.forEach(e=>{let t=e;t.material&&t.material.color&&(t.material.color=new eK.Ilk(s))})},P=e=>{if(d){let n=d.normal,a=d.up,r=new eK.Pa4;t.boundingBox&&t.boundingBox.getCenter(r);let o=l.position.distanceTo(i.target),s=n.clone().multiplyScalar(o),u=r.add(s);l.position.copy(u),l.up.copy(a),d=null,x(),f(e)}};e.domElement.addEventListener("pointermove",f),e.domElement.addEventListener("pointerdown",P);let S=e=>{let{newOffsetWidth:t,newOffsetHeight:l,newWidth:i,newHeight:s}=e;n=t,a=l,r=i,o=s},E=()=>{e.setViewport(n,a,r,o),v.rotation.copy(l.rotation),e.render(Z,v)},M=()=>{e.domElement.removeEventListener("pointermove",f),e.domElement.removeEventListener("pointerdown",P),p.children.forEach(e=>{e.children.forEach(e=>{e.geometry.dispose(),e.material.dispose()})}),Z.remove(p)};return{resize:S,render:E,dispose:M}},e1=e=>1e-12>Math.abs(e)?"0":Math.abs(e)>1e3||.001>Math.abs(e)?e.toExponential(2):e.toFixed(3),e2=(e,t,l,i)=>{let n,a,r;let o=e=>{let t=Math.max(e.x,e.y,e.z),l=Math.max(Math.ceil(e.x/t*5),2),i=Math.max(Math.ceil(e.y/t*5),2),n=Math.max(Math.ceil(e.z/t*5),2);return new eK.Pa4(l,i,n)},s=(e,t,l,i,n)=>{let a=new eK.ZAu,r=new eK.nls({color:8947848}),o=new eK.Pa4(-e/2,0,-t/2),s=e/(l-1),d=t/(i-1);for(let t=0;t<i;++t){let l=new eK.u9r().setFromPoints([new eK.Pa4(o.x,0,o.z+t*d),new eK.Pa4(o.x+e,0,o.z+t*d)]);a.add(new eK.x12(l,r))}for(let e=0;e<l;++e){let l=new eK.u9r().setFromPoints([new eK.Pa4(o.x+e*s,0,o.z),new eK.Pa4(o.x+e*s,0,o.z+t)]);a.add(new eK.x12(l,r))}return null==n||n(a),a},d=(t,l,i,n)=>{let a=new eK.ZAu,r=Math.abs(l-t),o=r/(n-1),s=new eK.Pa4().copy(i).multiplyScalar(-r/2),d=new eK.Pa4().copy(i).multiplyScalar(o),u=t;for(let t=0;t<n;++t){let t=e_(e,e1(u));t.position.copy(s),a.add(t),s.add(d),u+=o}return a},u=()=>{let e=t.boundingBox,l=t.boundingSphere.center,i=new eK.Pa4(e.max.x-e.min.x,e.max.y-e.min.y,e.max.z-e.min.z),r=o(i);a=1*(n=.1*Math.max(i.x,i.y,i.z));let u=new eK.ZAu,c=s(i.x,i.z,r.x,r.z),m=s(i.x,i.y,r.x,r.y,e=>{e.rotateX(Math.PI/2)}),h=s(i.y,i.z,r.y,r.z,e=>{e.rotateZ(-Math.PI/2)});u.add(c,m,h);let p=d(e.min.x,e.max.x,new eK.Pa4(1,0,0),r.x),Z=d(e.min.y,e.max.y,new eK.Pa4(0,1,0),r.y),v=d(e.min.z,e.max.z,new eK.Pa4(0,0,1),r.z);return u.add(p,Z,v),u.position.set(l.x,l.y,l.z),u.type="GridHelper",u.dispose=y,u},c=e=>e<=0?-1:1,m=e=>.5>=Math.abs(e)?1:-1,h=()=>{let e=t.boundingBox,o=new eK.Pa4(e.max.x-e.min.x,e.max.y-e.min.y,e.max.z-e.min.z),s=!1;t.children.forEach(e=>{"GridHelper"===e.type&&(s=e.visible,t.remove(e),e.dispose())}),r=u();let d=i.object.position.distanceTo(i.target);r.traverse(e=>{"LabelHelper"===e.type&&e.scale.setScalar(.05*d)});let h=new eK.Pa4;l.getWorldDirection(h);let p=d/10/(i.minDistance+.001),y=r.children[0],Z=r.children[1],v=r.children[2];y.position.set(0,c(h.y)*(o.y/2+n),0),Z.position.set(0,0,c(h.z)*(o.z/2+n)),v.position.set(c(h.x)*(o.x/2+n),0,0);let g=r.children[3],f=r.children[4],b=r.children[5];g.position.set(0,c(h.y)*m(h.y)*(o.y/2+a),-(c(h.z)*m(h.y)*(o.z/2+a))),f.position.set(c(h.x)*m(h.x)*(o.x/2+a),0,-(c(h.z)*m(h.x)*(o.z/2+a))),b.position.set(c(h.x)*m(h.x)*(o.x/2+a),-(c(h.y)*m(h.x)*(o.y/2+a)),0);let w=.2*p,C=.3*p;g.visible=Math.abs(h.y)>w||Math.abs(h.z)>C,f.visible=Math.abs(h.x)>C||Math.abs(h.z)>C,b.visible=Math.abs(h.x)>C||Math.abs(h.y)>w,r.visible=s,t.add(r)},p=e=>{r.visible=e},y=()=>{null==r||r.children.forEach(e=>{e.children.forEach(e=>{if("Line"===e.type){let t=e.geometry;t.dispose();let l=e.material;l.dispose()}else e.dispose()})})};return{dispose:y,setVisible:p,update:h}},e4=(e,t,l,i)=>{let n=document.createElement("div");n.style.pointerEvents="none",n.style.border="1px solid #55aaff",n.style.backgroundColor="rgba(75, 160, 255, 0.3)",n.style.position="fixed";let a=new eK.FM8,r=new eK.FM8,o=new eK.FM8,s=new eK.FM8,d=!1,u=!1,c=new eK.iMs,m=()=>{d=!0},h=()=>{d=!1},p=e=>{d&&0===e.button&&(u=!0,v(e))},y=e=>{d&&u&&g(e)},Z=e=>{u=!1,d&&f(e)};e.domElement.addEventListener("pointerdown",p),e.domElement.addEventListener("pointermove",y),e.domElement.addEventListener("pointerup",Z);let v=t=>{i.enabled=!1,e.domElement.parentElement.appendChild(n),n.style.left=t.clientX+"px",n.style.top=t.clientY+"px",n.style.width="0px",n.style.height="0px",a.x=t.clientX,a.y=t.clientY},g=e=>{s.x=Math.max(a.x,e.clientX),s.y=Math.max(a.y,e.clientY),o.x=Math.min(a.x,e.clientX),o.y=Math.min(a.y,e.clientY),n.style.left=o.x+"px",n.style.top=o.y+"px",n.style.width=s.x-o.x+"px",n.style.height=s.y-o.y+"px"},f=e=>{i.enabled=!0,n.parentElement&&n.parentElement.removeChild(n),r.x=e.clientX,r.y=e.clientY;let t=new eK.TUj(a,r);b(t),h()},b=n=>{let a=new eK.FM8(Math.abs(n.max.x-n.min.x),Math.abs(n.max.y-n.min.y));if(a.x<5||a.y<5)return;let r=new eK.FM8((n.max.x+n.min.x)/2,(n.max.y+n.min.y)/2),o=e.domElement.getBoundingClientRect(),s=r.x-o.left,d=r.y-o.top,u=new eK.FM8(s/o.width*2-1,-(2*(d/o.height))+1),m=t.children.find(e=>"Part"===e.type);if(!m)return;c.setFromCamera(u,l);let h=c.intersectObject(m);if(!h.length)return;i.target.copy(h[0].point);let p=new eK.FM8(a.x/o.width,a.y/o.height),y=Math.max(p.x,p.y),Z=l.position.distanceTo(i.target),v=i.target.clone().sub(l.position).normalize().multiplyScalar(Z*(1-y));l.position.add(v)},w=()=>{e.domElement.removeEventListener("pointerdown",p),e.domElement.removeEventListener("pointermove",y),e.domElement.removeEventListener("pointerup",Z)};return{dispose:w,end:h,isEnabled:()=>d,start:m}},e5=(e,t,l,i)=>{let n,a,r;let o=new eK.Ilk("#fad114"),s=new eK.Ilk("#E98A15"),d=new eK.Pa4(-1,0,0),u=new eK.JOQ(d),c={up:new eK.Pa4,forward:new eK.Pa4,right:new eK.Pa4},m=new eK.Pa4,h=new eK.Pa4,p=new eK.USm,y=new eK.Pa4,Z=new eK.FM8,v=new eK.JOQ,g=new eK.Pa4,f=new eK.Pa4,b=new eK.Zzh,w={up:new eK.Pa4,forward:new eK.Pa4,right:new eK.Pa4},C=new eK.iMs,k=new eK.ZAu;k.type="SectionViewHelper",k.visible=!1,t.add(k),(()=>{let e=new eK._12(1,1),t=new eK.vBJ({color:o,side:eK.ehD,transparent:!0,opacity:.5}),l=new eK.Kj0(e,t);l.type="Plane",k.add(l)})(),(()=>{let e=new eK.xo$(.2,32,32,Math.PI,-Math.PI),t=new eK.vBJ({color:o,side:eK.ehD,transparent:!0,opacity:.5}),l=new eK.Kj0(e,t);l.type="Dome",k.add(l)})(),(()=>{class e extends eK.Hyl{getPoint(e){return new eK.Pa4().set(this.radius*Math.cos(Math.PI*e),this.radius*Math.sin(Math.PI*e),0)}constructor(e){super(),this.radius=e}}let t=new e(.2);{let e=new eK.WXh(t,32,.020000000000000004,32),l=new eK.vBJ({color:o,side:eK.ehD,transparent:!0,opacity:.5}),i=new eK.Kj0(e,l);i.rotateX(Math.PI/2),i.type="ArcX",k.add(i)}{let e=new eK.WXh(t,32,.020000000000000004,32),l=new eK.vBJ({color:o,side:eK.ehD,transparent:!0,opacity:.5}),i=new eK.Kj0(e,l);i.rotateX(Math.PI/2),i.rotateY(Math.PI/2),i.type="ArcY",k.add(i)}})();let x=()=>{let e=new eK.Pa4;t.boundingBox.getSize(e),e.multiplyScalar(1.2);let l=Math.max(Math.max(e.x,e.y),e.z);k.scale.setScalar(l)},P=()=>{let e=new eK.Pa4;t.boundingBox.getCenter(e),k.position.copy(e)},S=()=>{let e=k.visible;k.visible=!e},E=()=>{e.localClippingEnabled=!0,k.visible=!0,x(),P();let t=new eK.Pa4().copy(k.position).sub(d);k.lookAt(t),u.setFromNormalAndCoplanarPoint(d,k.position)},M=()=>{e.localClippingEnabled=!1,k.visible=!1},B=e=>{if(P(),d.equals(e)){O();return}let t=new eK.Pa4().copy(k.position).sub(e);k.lookAt(t),u.setFromNormalAndCoplanarPoint(e,k.position),d.copy(e)},O=()=>{k.rotateX(Math.PI);let e=u.normal.multiplyScalar(-1);u.setFromNormalAndCoplanarPoint(e,k.position)},j=()=>{k.traverse(e=>{("Plane"===e.type||"Dome"===e.type||"ArcX"===e.type||"ArcY"===e.type)&&(e.geometry.dispose(),e.material.dispose())}),e.domElement.removeEventListener("pointermove",R),e.domElement.removeEventListener("pointerdown",V),e.domElement.removeEventListener("pointerup",F)},T=e=>{let t=e.target,l=t.getBoundingClientRect(),i=e.clientX-l.left,n=e.clientY-l.top,a=new eK.FM8;return a.x=i/l.width*2-1,a.y=-(2*(n/l.height))+1,a},X=e=>{n&&n.material.color.set(o),n=e,e&&e.material.color.set(s)},L=()=>{i.enabled=!0},A=()=>{i.enabled=!1},z=()=>{l.getWorldDirection(c.forward),c.forward.normalize(),c.up.copy(l.up).normalize(),c.right.crossVectors(c.up,c.forward).normalize()},N=()=>{let e=new eK.Pa4(0,0,1).applyQuaternion(k.quaternion).multiplyScalar(-1);u.setFromNormalAndCoplanarPoint(e,k.position)},R=e=>{if(!k.visible)return;let t=T(e);if(C.setFromCamera(t,l),a){let e=new eK.Pa4;C.ray.intersectPlane(v,e),(null==r?void 0:r.type)==="Plane"?H(e):(null==r?void 0:r.type)==="Dome"?K(t):W(e),N()}else{let e=C.intersectObject(k);e.length?(A(),X(r=e[0].object),h.copy(e[0].point),z()):(r=null,X(),L())}},I=()=>{v.setFromNormalAndCoplanarPoint(c.forward,h),m.copy(k.position);let e=new eK.Pa4;C.ray.intersectPlane(v,e),g.copy(e).sub(m),f.copy(g).normalize(),b.set(m,new eK.Pa4().copy(m).add(u.normal))},H=e=>{e.sub(g);let t=new eK.Pa4;b.closestPointToPoint(e,!1,t),k.position.copy(t)},D=e=>{p.copy(k.rotation),Z.copy(e)},K=e=>{k.rotation.copy(p),k.rotateOnWorldAxis(c.up,-(5*(Z.x-e.x))),k.rotateOnWorldAxis(c.right,-(5*(Z.y-e.y)))},U=()=>{r.getWorldDirection(y),p.copy(k.rotation),g.copy(h).sub(k.position),f.copy(g).normalize(),w.up.copy(f),w.right.copy(y),w.forward.crossVectors(w.right,w.up),b.set(h,new eK.Pa4().copy(h).add(w.forward)),v.setFromNormalAndCoplanarPoint(c.forward,h)},W=e=>{let t=i.object.position.distanceTo(i.target),l=new eK.Pa4;b.closestPointToPoint(e,!1,l);let n=h.distanceTo(l);l.sub(h);let a=new eK.Pa4().copy(f).cross(l).normalize(),r=Math.sign(y.dot(a));k.rotation.copy(p),k.rotateOnWorldAxis(y,r*n*1/(t/100))},Y=e=>{switch(null==r?void 0:r.type){case"Plane":I();break;case"Dome":D(e);break;case"ArcX":case"ArcY":U()}},V=e=>{if(k.visible&&r){a=!0;let t=T(e);Y(t)}},F=()=>{k.visible&&(a=!1,X())};return e.domElement.addEventListener("pointermove",R),e.domElement.addEventListener("pointerdown",V),e.domElement.addEventListener("pointerup",F),{getClippingPlane:()=>u,toggleVisible:S,start:E,stop:M,toAxis:B,flip:O,dispose:j}};var e3=l(54104);let e8=e=>{let t=new eK.xsS,l=new eK.iKG(-1,1,1,-1,2,1);l.position.set(0,0,1);let i=new eK.ZAu;t.add(i);let n=e=>{t.children.forEach(t=>{t.children.forEach(t=>t.visible=e)})},a=()=>{t.children.forEach(e=>e.children.forEach(t=>{"LabelHelper"===t.type&&t.dispose(),"Sprite"===t.type&&t.dispose(),e.remove(t)}))},r=e=>{a();let t=new e3.A("rainbow",e.n);t.setMin(e.minV),t.setMax(e.maxV);let l=new eK.ROQ(t.createCanvas()),n=new eK.xeV({map:l,depthWrite:!1}),r=new eK.jyi(n);r.material.rotation=-Math.PI/2,r.scale.x=.2,r.scale.y=1.2,r.dispose=r.material.dispose,i.add(r),o(t)},o=t=>{let l=e1(t.minV),n=e1(t.maxV),a=e_(e,String(l),{position:new eK.Pa4(-.62,0,0),width:512,align:"right"});a.scale.x=.4,a.scale.y=2.8;let r=e_(e,String(n),{position:new eK.Pa4(.62,0,0),width:512,align:"left"});r.scale.x=.4,r.scale.y=2.8,i.add(a),i.add(r)},s=()=>{let i=e.domElement.getBoundingClientRect();e.setViewport(i.width/2-350,i.height-50,700,50),e.render(t,l)},d=()=>{a()};return{render:s,setLUT:r,setVisible:n,dispose:d}},e6=e=>{let t=new eK.ZAu;t.type="PointHelper",t.visible=!1,e.add(t);let l=()=>{var t,l;let i=(null!==(l=null===(t=e.boundingSphere)||void 0===t?void 0:t.radius)&&void 0!==l?l:1)/100,n=new eK.xo$(i),a=new eK.Wid({color:16711680});return new eK.Kj0(n,a)},i=(e,t)=>{let l=new eK.u9r().setFromPoints([e,t]),i=new eK.nls({color:16711680});return new eK.x12(l,i)},n=()=>{let t=[],l=e.boundingBox.max.x-e.boundingBox.min.x,n=e.boundingBox.max.y-e.boundingBox.min.y,a=e.boundingBox.max.z-e.boundingBox.min.z,r=Math.max(l,n,a),o=i(new eK.Pa4(-r/2,0,0),new eK.Pa4(r/2,0,0));t.push(o);let s=i(new eK.Pa4(0,-r/2,0),new eK.Pa4(0,r/2,0));t.push(s);let d=i(new eK.Pa4(0,0,-r/2),new eK.Pa4(0,0,r/2));return t.push(d),t},a=()=>{o();let e=l(),i=n();t.add(e),t.add(...i)},r=e=>{e?(t.position.set(e.x,e.y,e.z),t.visible=!0):t.visible=!1},o=()=>{t.children.forEach(e=>{t.remove(e),e.geometry.dispose(),e.material.dispose()})};return{build:a,dispose:o,update:r}};var e7=l(77836),e9=l(82854),te=l(6648),tt=l(48764).lW;let tl=(e,t)=>{e.traverse(e=>{if("Mesh"===e.type){let l=e,i=new eK.Uk6(l.geometry),n=new eK.nls({color:l.material.color,linewidth:1}),a=new eK.ejS(i,n);l.add(a),l.material.visible=!1,l.material.clippingPlanes=[t]}})},ti=(e,t)=>{e.traverse(e=>{if("Mesh"===e.type||"Line"===e.type){let l=e,i=l.geometry.getAttribute("data");if(i){let e=i.array.reduce((e,t)=>Math.min(e,t),i.array[0]),t=i.array.reduce((e,t)=>Math.max(e,t),i.array[0]);e===t&&(e-=1,t+=1);let n=new e3.A;n.setMin(e),n.setMax(t);let a=new Float32Array(3*i.count);for(let e=0;e<i.count;e++){let t=n.getColor(i.array[e]);a[3*e+0]=t.r,a[3*e+1]=t.g,a[3*e+2]=t.b}l.geometry.setAttribute("color",new eK.a$l(a,3)),l.userData={...l.userData,lut:n}}if("Mesh"===e.type){let e=new eK.Uk6(l.geometry),t=new eK.nls({linewidth:1}),i=new eK.ejS(e,t);l.add(i)}l.material.vertexColors=!0,l.material.clippingPlanes=[t]}})},tn=(e,t)=>{e.traverse(e=>{if("Mesh"===e.type){let l=e;l.material.clippingPlanes=[t],l.material.originalColor=l.material.color}})},ta=(e,t)=>{let l=new eK.Ilk("#FAD114"),i=new eK.Ilk("#EE9817"),n=async(e,t,l,i)=>{let n=new Blob([tt.from(e.buffer)]),d=URL.createObjectURL(n),u=new e7.E,c=new e9._;c.setDecoderPath("/three/libs/draco/"),u.setDRACOLoader(c);let m=new te.a;m.setTranscoderPath("node_modules/three//examples/js/libs/basis/"),u.setKTX2Loader(m);let h=await new Promise((e,t)=>{u.load(d,t=>{e(t)},()=>void 0,e=>t(e))}),p=h.scene,f=new eK.Tme;return f.type="Part",f.uuid=e.summary.uuid,f.children=p.children,f.userData=p.userData,"mesh"===e.summary.type?tl(f,i):"result"===e.summary.type?ti(f,i):("geometry3D"===e.summary.type||"geometry2D"===e.summary.type)&&tn(f,i),o(f,t),s(f,l),f.boundingBox=a(f),f.dispose=()=>r(f),f.setTransparent=e=>o(f,e),f.setDisplayMesh=e=>s(f,e),f.startSelection=(e,t,l,i)=>v(f,e,t,l,i),f.stopSelection=()=>g(),f.getHighlighted=()=>y,f.getSelected=()=>Z,f.highlight=M,f.unhighlight=B,f.select=j,f.unselect=T,f},a=e=>{let t=new eK.ZzF;return e.traverse(e=>{t.expandByObject(e)}),t},r=e=>{e.traverse(e=>{"Mesh"===e.type&&(e.geometry.dispose(),e.material.dispose())})},o=(e,t)=>{e.traverse(e=>{if("Mesh"===e.type){let l=e;l.material.transparent=t,l.material.opacity=t?.5:1,l.material.depthWrite=!t}})},s=(e,t)=>{"result"===e.userData.type&&e.traverse(e=>{e.traverse(e=>{if("LineSegments"===e.type){let l=e;l.visible=t}})})},d=new eK.iMs,u=null,c=null,m=null,h=null,p=null,y=null,Z=[],v=(e,t,l,i,n)=>{u=e,c=n,m=t,h=l,(p=i).selectedObjects=[],y=null,Z.length=0,m.domElement.addEventListener("pointermove",P),m.domElement.addEventListener("pointerdown",O)},g=()=>{m&&m.domElement.removeEventListener("pointermove",P),m&&m.domElement.removeEventListener("pointerdown",O),B(),y=null,Z.forEach(e=>{T(e.uuid)}),Z.length=0,c=null,u=null,m=null,h=null,p=null},f=(e,t)=>{let l;if(e&&t)return e.traverse(e=>{e.userData.uuid===t&&(l=e)}),l},b=e=>{let t=e.target,l=t.getBoundingClientRect(),i=e.clientX-l.left,n=e.clientY-l.top,a=new eK.FM8;return a.x=i/l.width*2-1,a.y=-(2*(n/l.height))+1,a},w=()=>{let t=d.intersectObject(u,!0);if(t.length){let l=t[0].object,i=l.parent;i&&e(u,i.userData.uuid,i.userData.label)}else e(u)},C=()=>{let t;let l=u.userData;if(2===l.dimension){if((t=d.intersectObject(u,!0)).length){let l=t[0].object,i=l.parent;(null==i?void 0:i.type)==="Mesh"?e(u,i.userData.uuid,i.userData.label):e(u,l.userData.uuid,l.userData.label)}else e(u)}else if((t=d.intersectObject(u,!0)).length){let l=t[0].object;e(u,l.userData.uuid,l.userData.label)}else e(u)},k=()=>{let t;let l=u.userData,i=l.edges;if((t=d.intersectObject(u,!0)).length){let l=t[0].object,n=null==i?void 0:i.find(e=>e.uuid===l.userData.uuid);n?e(u,l.userData.uuid,l.userData.label):e(u)}else e(u)},x=()=>{let t=d.intersectObject(u,!0);if(t.length){let l=t[0];e(u,void 0,void 0,l.point)}else e(u)},P=e=>{let t=b(e);switch(d.setFromCamera(t,h),c){case"solids":w();break;case"faces":C();break;case"edges":k();break;case"point":x()}},S=(e,t)=>{if(t){let t=p.selectedObjects.find(t=>t.userData.uuid===e.userData.uuid);t||p.selectedObjects.push(e)}else{let t=Z.find(t=>t.uuid===e.userData.uuid);t||p.selectedObjects.push(e)}},E=(e,t)=>{if(t){let t=p.selectedObjects.findIndex(t=>t.userData.uuid===e.userData.uuid);p.selectedObjects=[...p.selectedObjects.slice(0,t),...p.selectedObjects.slice(t+1)]}else{let t=Z.find(t=>t.uuid===e.userData.uuid);if(!t){let t=p.selectedObjects.findIndex(t=>t.userData.uuid===e.userData.uuid);p.selectedObjects=[...p.selectedObjects.slice(0,t),...p.selectedObjects.slice(t+1)]}}},M=e=>{if(e===(null==y?void 0:y.uuid))return;B();let t=f(u,e);if(t){if(y={uuid:t.userData.uuid,label:t.userData.label},S(t),"Mesh"===t.type){let e=t;e.material.color=l}else t.traverse(e=>{if("Mesh"===e.type){let t=e;t.material.color=l}})}},B=()=>{let e=f(u,null==y?void 0:y.uuid);if(y=null,!e)return;E(e);let t=Z.findIndex(t=>t.uuid===e.userData.uuid);if("Mesh"===e.type){let l=e;l.material.color=-1===t?l.material.originalColor:i}else e.traverse(e=>{if("Mesh"===e.type){let l=e;l.material.color=-1===t?l.material.originalColor:i}})},O=()=>{y&&t(u,y.uuid,y.label)},j=e=>{let t=f(u,e);if(t){if(Z.push({uuid:e,label:t.userData.label}),S(t,!0),"Mesh"===t.type){let e=t;e.material.color=i}else t.traverse(e=>{if("Mesh"===e.type){let t=e;t.material.color=i}})}},T=e=>{let t=f(u,e),l=Z.findIndex(t=>t.uuid===e);if(-1!==l&&(Z=[...Z.slice(0,l),...Z.slice(l+1)]),t){if(E(t,!0),"Mesh"===t.type){let e=t;e.material.color=e.material.originalColor}else t.traverse(e=>{if("Mesh"===e.type){let t=e;t.material.color=t.material.originalColor}});t.visible=!0}};return{load:n}},tr=()=>({type:I.ENABLE}),to=()=>({type:I.DISABLE}),ts=e=>({type:I.SETTYPE,value:e}),td=e=>({type:I.SETPART,value:e}),tu=e=>{let{uuid:t,label:l}=e;return{type:I.HIGHLIGHT,value:{uuid:t,label:l}}},tc=()=>({type:I.UNHIGHLIGHT}),tm=e=>{let{uuid:t,label:l}=e;return{type:I.SELECT,value:{uuid:t,label:l}}},th=e=>{let{uuid:t,label:l}=e;return{type:I.UNSELECT,value:{uuid:t,label:l}}},tp=e=>({type:I.SETPOINT,value:e});var ty=l(5094);let tZ={view:(0,M.iv)({width:"100%",height:"100%"}),head:(0,M.iv)({position:"absolute",top:"160px",right:0,bottom:0,backgroundColor:"transparent !important",zIndex:10,height:"calc(100% - 160px)",padding:"0 57px",display:"flex",flexDirection:"column",rowGap:"10px",alignItems:"center"}),content:(0,M.iv)({width:"100%",height:"100%",position:"relative"}),loading:(0,M.iv)({position:"absolute",top:0,left:0,width:"100%",height:"100%",background:"rgba(128, 128, 118, 0.1)",zIndex:100,display:"flex",justifyContent:"center",alignItems:"center"}),canvas:(0,M.iv)({position:"absolute",top:0,left:0,bottom:0,right:0})},tv={load:"Error while loading part",snapshot:"Error while taking snapshot",saveScreenshot:"Unable to save screenshot"},tg=!1,tf=e=>{let t=new eK.ZzF;e.children.forEach(e=>{if(e.visible&&"Part"===e.type){let l=e.boundingBox,i=new eK.Pa4(Math.min(t.min.x,l.min.x),Math.min(t.min.y,l.min.y),Math.min(t.min.z,l.min.z)),n=new eK.Pa4(Math.max(t.max.x,l.max.x),Math.max(t.max.y,l.max.y),Math.max(t.max.z,l.max.z));t.set(i,n)}});let l=new eK.aLr;t.getBoundingSphere(l),e.boundingBox=t,e.boundingSphere=l},tb=(e,t,l)=>{let i=t.object.position.distanceTo(t.target),n=t.target.clone().sub(e.position).normalize().multiplyScalar(i*l*.01);e.position.add(n)},tw=(e,t,l)=>{let i=e.children.find(e=>"Part"===e.type);if(!i)return;tg=!0;let n=e.boundingSphere,a=n.center,r=2*n.radius,o=r/(2*Math.atan(Math.PI*t.fov/360)),s=o/t.aspect,d=1.1*Math.max(o,s),u=l.target.clone().sub(t.position).normalize().multiplyScalar(d);l.target.copy(a),l.minDistance=d/10,l.maxDistance=10*d,t.position.copy(a).sub(u),t.near=d/100,t.far=100*d,t.updateProjectionMatrix()},tC=async(e,t,l,i,n,a,r)=>{let o=(e,t,l,i)=>{t?(e.highlight(t),setTimeout(()=>r(tu({uuid:t,label:l})),1)):i?r(tp({x:i.x,y:i.y,z:i.z})):(e.unhighlight(),setTimeout(()=>r(tc()),1))},s=(e,t,l)=>{let i=e.getSelected();i.find(e=>e.uuid===t)?(e.unselect(t),setTimeout(()=>r(th({uuid:t,label:l})),1)):(e.select(t),setTimeout(()=>r(tm({uuid:t,label:l})),1))},d=ta(o,s),u=await d.load(e,n.transparent,n.displayMesh,a.sectionViewHelper.getClippingPlane());t.add(u),tf(t),tg||tw(t,l,i),a.gridHelper.update(),a.gridHelper.update(),a.gridHelper.setVisible(!0),u.children[0].userData.lut?(a.colorbarHelper.setLUT(u.children[0].userData.lut),a.colorbarHelper.setVisible(!0)):a.colorbarHelper.setVisible(!1),a.pointHelper.build()},tk=async(e,t,l,i)=>{try{let n=i.domElement.width,a=i.domElement.height,r=l.aspect;i.domElement.width=520,i.domElement.height=312,l.aspect=520/312,l.updateProjectionMatrix(),i.clear(),i.setViewport(0,0,520,312),i.render(t,l);let o=i.domElement.toDataURL();i.domElement.width=n,i.domElement.height=a,l.aspect=r,l.updateProjectionMatrix(),await ty.Z.add({name:"snapshot",uid:"snapshot_"+(0,eU.Z)(),data:o},{id:e.id})}catch(e){(0,N.lt)(tv.snapshot,e)}},tx=(e,t,l,i)=>{try{let n=i.domElement.width,a=i.domElement.height;i.clear(),i.setViewport(0,0,n,a),i.render(t,l);let r=i.domElement.toDataURL(),o=document.createElement("a");o.href=r.replace("image/png","image/octet-stream"),o.download=e.title+"_"+new Date().toLocaleDateString()+".png",o.click()}catch(e){(0,N.lt)(tv.saveScreenshot,e)}},tP=e=>{var t,l,n;let{loading:a,project:r,parts:s}=e,d=(0,c.useRef)(null),p=(0,c.useRef)(),y=(0,c.useRef)(),v=(0,c.useRef)(),f=(0,c.useRef)(),b=(0,c.useRef)(),w=(0,c.useRef)(),C=(0,c.useRef)(),k=(0,c.useRef)(),x=(0,c.useRef)(),S=(0,c.useRef)(),E=(0,c.useRef)(),[O,j]=(0,c.useState)(!1),[T,X]=(0,c.useState)(!0),[L,A]=(0,c.useState)(!1),[z,R]=(0,c.useState)(!1),[I,D]=(0,c.useState)(!1),K=(0,u.useRouter)(),{enabled:U,part:W,highlighted:Y,selected:V,point:F,type:G,dispatch:J}=(0,c.useContext)(H);(0,c.useEffect)(()=>{if(!eG.Z.isWebGLAvailable()){K.push("/webgl");return}let e=d.current,t=e.clientWidth,l=e.clientHeight;p.current=new eK.xsS,p.current.boundingBox=new eK.ZzF,p.current.boundingSphere=new eK.aLr,y.current=new eK.cPb(50,t/l,.1,1e3),y.current.position.z=10;let i=new eK.Mig("#aaa",.75);p.current.add(i);let n=new eK.cek("#fff",.5);n.decay=2,y.current.add(n),p.current.add(y.current),v.current=new eK.CP7({antialias:!0,alpha:!0}),v.current.setClearColor("#ffffff"),v.current.setSize(t,l),v.current.setPixelRatio(window.devicePixelRatio||1),v.current.shadowMap.enabled=!0,v.current.autoClear=!1,e.appendChild(v.current.domElement);let a=new eY.C(p.current,y.current);f.current=new eV.f(new eK.FM8(t,l),p.current,y.current),f.current.visibleEdgeColor.set("#FAD114"),f.current.hiddenEdgeColor.set("#FAD114"),b.current=new eF.x(v.current),b.current.addPass(a),b.current.addPass(f.current),w.current=new eW.$(y.current,e),w.current.rotateSpeed=3,w.current.panSpeed=.1;let r=eq(v.current,y.current,{offsetWidth:t-155,offsetHeight:l-155,width:150,height:150}),o=e0(v.current,p.current,y.current,w.current,{offsetWidth:t-155,offsetHeight:l-155,width:150,height:150});C.current=e2(v.current,p.current,y.current,w.current),k.current=e4(v.current,p.current,y.current,w.current),x.current=e5(v.current,p.current,y.current,w.current),S.current=e8(v.current),S.current.setVisible(!1),E.current=e6(p.current);let s=()=>{w.current.update(),v.current.setViewport(0,0,t,l),v.current.render(p.current,y.current),C.current.update(),b.current.render(),r.render(),o.render(),S.current.render()},u=()=>{t=e.clientWidth,l=e.clientHeight,y.current.aspect=t/l,y.current.updateProjectionMatrix(),v.current.setSize(t,l),b.current.setSize(t,l),r.resize({newOffsetWidth:t-155,newOffsetHeight:l-155,newWidth:150,newHeight:150}),o.resize({newOffsetWidth:t-155,newOffsetHeight:l-155,newWidth:150,newHeight:150}),s()},c=()=>{s(),setTimeout(()=>requestAnimationFrame(c),1e3/30)};return window.addEventListener("resize",u),requestAnimationFrame(c),()=>{tg=!1,window.removeEventListener("resize",u),e.removeChild(v.current.domElement),p.current.children.forEach(e=>{p.current.remove(e)}),r.dispose(),o.dispose(),C.current.dispose(),x.current.dispose(),k.current.dispose(),S.current.dispose(),E.current.dispose()}},[K]),(0,B.Z)(()=>{if(!p.current)return;let e=p.current.children;if(!s.length){var t;tf(p.current),C.current.update(),null===(t=E.current)||void 0===t||t.build()}let l=s.filter(t=>!e.find(e=>e.uuid===t.summary.uuid)),i=e.filter(e=>!s.find(t=>t.summary.uuid===e.uuid)).filter(e=>"Part"===e.type);i.forEach(e=>{var t;null===(t=p.current)||void 0===t||t.remove(e),e.dispose()}),l.forEach(e=>{tC(e,p.current,y.current,w.current,{transparent:O,displayMesh:T},{gridHelper:C.current,sectionViewHelper:x.current,colorbarHelper:S.current,pointHelper:E.current},J).catch(e=>{(0,N.lt)(tv.load,e),tf(p.current)})})},[s,O,T,J]),(0,B.Z)(()=>{var e;if(p.current){if((null===(e=s[0])||void 0===e?void 0:e.summary.dimension)===2){tf(p.current);let e=new eK.Pa4(0,0,1),t=new eK.Pa4(0,1,0),l=new eK.Pa4;p.current.boundingBox.getCenter(l);let i=y.current.position.distanceTo(w.current.target),n=e.clone().multiplyScalar(i),a=l.add(n);y.current.position.copy(a),y.current.up.copy(t),w.current.noRotate=!0}else w.current.noRotate=!1}},[s]),(0,c.useEffect)(()=>{p.current&&p.current.children.forEach(e=>{"Part"===e.type&&e.userData.uuid===W&&(U?e.startSelection(v.current,y.current,f.current,G):e.stopSelection())})},[U,W,G]),(0,c.useEffect)(()=>{p.current&&p.current.children.forEach(e=>{if("Part"===e.type&&e.uuid===W){e.highlight(null==Y?void 0:Y.uuid);let t=e.getSelected(),l=V.filter(e=>!t.find(t=>t.uuid===e.uuid));l.forEach(t=>{t.uuid&&e.select(t.uuid)});let i=t.filter(e=>!V.find(t=>t.uuid===e.uuid));i.forEach(t=>{e.unselect(t.uuid)})}})},[W,Y,V]),(0,c.useEffect)(()=>{var e;p.current&&(null===(e=E.current)||void 0===e||e.update(F?new eK.Pa4(F.x,F.y,F.z):void 0))},[F]);let _=(0,c.useCallback)(e=>{j(e),p.current.children.forEach(t=>{"Part"===t.type&&t.setTransparent(e)})},[]),q=(0,c.useCallback)(e=>{X(e),p.current.children.forEach(t=>{"Part"===t.type&&t.setDisplayMesh(e)})},[]),$=(0,c.useCallback)(()=>{let e=!L;A(e),e?x.current.start():x.current.stop()},[L]),Q=(0,c.useCallback)(async()=>{R(!0);try{await tk(r,p.current,y.current,v.current)}finally{R(!1)}},[r]),ee=(0,c.useCallback)(()=>{D(!0);try{tx(r,p.current,y.current,v.current)}finally{D(!1)}},[r]),et=(0,c.useCallback)(e=>{var t;null===(t=C.current)||void 0===t||t.setVisible(e)},[]),el=(0,c.useCallback)(()=>{tb(y.current,w.current,1);let e=()=>el();i=requestAnimationFrame(e)},[]),ei=(0,c.useCallback)(()=>{tb(y.current,w.current,-1);let e=()=>ei();i=requestAnimationFrame(e)},[]),en=(0,c.useCallback)(()=>{i&&cancelAnimationFrame(i),i=void 0},[]),ea=(0,c.useCallback)(()=>{tw(p.current,y.current,w.current)},[]),er=(0,c.useCallback)(()=>{x.current.toAxis(new eK.Pa4(-1,0,0))},[]),es=(0,c.useCallback)(()=>{x.current.toAxis(new eK.Pa4(0,-1,0))},[]),ed=(0,c.useCallback)(()=>{x.current.toAxis(new eK.Pa4(0,0,-1))},[]);return(0,o.BX)(h.Z,{css:(0,M.iv)([eo.KP.noScroll,tZ.view]),children:[(0,o.BX)(h.Z.Header,{css:tZ.head,children:[(0,o.tZ)(m.Z,{title:"Take snapshot",placement:"left",children:(0,o.tZ)(eE.Z,{placement:"bottom",menu:{items:[{key:"project",label:(0,o.tZ)(Z.ZP,{type:"text",css:(0,M.iv)([eo.KP.fullWidth,eo.KP.noBackground]),loading:z,onClick:Q,children:"Project snapshot"})},{key:"image",label:(0,o.tZ)(Z.ZP,{type:"text",css:(0,M.iv)([eo.KP.fullWidth,eo.KP.noBackground]),loading:I,onClick:ee,children:"Export image"})}]},children:(0,o.tZ)(Z.ZP,{icon:(0,o.tZ)(ej.Z,{})})})}),(0,o.tZ)(eM.Z,{css:eo.Ml.margin(0)}),(0,o.tZ)(m.Z,{title:"Display grid",placement:"left",children:(0,o.tZ)(eB.Z,{defaultChecked:!0,checkedChildren:(0,o.tZ)(eT.Z,{}),unCheckedChildren:(0,o.tZ)(eT.Z,{}),onChange:et})}),(0,o.tZ)(m.Z,{title:"Set transparency",placement:"left",children:(0,o.tZ)(eB.Z,{checked:O,checkedChildren:(0,o.tZ)(eX.Z,{}),unCheckedChildren:(0,o.tZ)(eX.Z,{}),onChange:_})}),(0,o.tZ)(eM.Z,{css:eo.Ml.margin(0)}),(0,o.tZ)(m.Z,{title:"Zoom out",placement:"left",children:(0,o.tZ)(Z.ZP,{icon:(0,o.tZ)(eL.Z,{}),onMouseDown:ei,onMouseUp:en,onMouseOut:en})}),(0,o.tZ)(m.Z,{title:"Zoom in",placement:"left",children:(0,o.tZ)(Z.ZP,{icon:(0,o.tZ)(eA.Z,{}),onMouseDown:el,onMouseUp:en,onMouseOut:en})}),(0,o.tZ)(m.Z,{title:"Zoom to fit",placement:"left",children:(0,o.tZ)(Z.ZP,{icon:(0,o.tZ)(ez.Z,{}),onClick:ea})}),(0,o.tZ)(m.Z,{title:"Zoom to selection",placement:"left",children:(0,o.tZ)(Z.ZP,{icon:(0,o.tZ)(eN.Z,{}),onClick:(null===(t=k.current)||void 0===t?void 0:t.isEnabled())?null===(l=k.current)||void 0===l?void 0:l.end:null===(n=k.current)||void 0===n?void 0:n.start})}),(0,o.tZ)(eM.Z,{css:eo.Ml.margin(0)}),!L&&(0,o.tZ)(m.Z,{title:"Section view",children:(0,o.tZ)(Z.ZP,{icon:(0,o.tZ)(eR.Z,{}),onClick:$})}),L&&(0,o.BX)(o.HY,{children:[(0,o.tZ)(m.Z,{title:"Stop",placement:"left",children:(0,o.tZ)(Z.ZP,{icon:(0,o.tZ)(eI.Z,{}),onClick:$})}),(0,o.tZ)(m.Z,{title:"Hide plane",placement:"left",children:(0,o.tZ)(Z.ZP,{icon:(0,o.tZ)(g.Z,{}),onClick:x.current.toggleVisible})}),(0,o.tZ)(m.Z,{title:"Snap to X",placement:"left",children:(0,o.tZ)(Z.ZP,{className:"ant-btn-icon-only",onClick:er,children:"X"})}),(0,o.tZ)(m.Z,{title:"Snap to Y",placement:"left",children:(0,o.tZ)(Z.ZP,{className:"ant-btn-icon-only",onClick:es,children:"Y"})}),(0,o.tZ)(m.Z,{title:"Snap to Z",placement:"left",children:(0,o.tZ)(Z.ZP,{className:"ant-btn-icon-only",onClick:ed,children:"Z"})}),(0,o.tZ)(m.Z,{title:"Flip",placement:"left",children:(0,o.tZ)(Z.ZP,{onClick:x.current.flip,icon:(0,o.tZ)(eH.Z,{})})})]}),(0,o.tZ)("div",{children:s.filter(e=>"result"===e.summary.type).length?(0,o.BX)(o.HY,{children:[(0,o.tZ)(eM.Z,{className:"no-margin"}),(0,o.tZ)(m.Z,{title:"Display result mesh",placement:"right",children:(0,o.tZ)(eB.Z,{checked:T,checkedChildren:(0,o.tZ)(eD.Z,{}),unCheckedChildren:(0,o.tZ)(eD.Z,{}),onChange:q})})]}):null})]}),(0,o.BX)(h.Z.Content,{css:(0,M.iv)([eo.KP.noScroll,tZ.content]),children:[(0,o.tZ)("div",{style:{display:a?"flex":"none"},css:eo.KP.loading,children:(0,o.tZ)(eO.Z,{indicator:(0,o.tZ)(P.Z,{css:{color:eo.Rl.colorPrimary},style:{fontSize:80},spin:!0})})}),(0,o.tZ)("div",{ref:d,css:tZ.canvas})]})]})},tS={part:"Unable to load part"},tE=async(e,t,l)=>{try{if("geometry"===l){let e=await ee.getPart({id:t.id});return{...e,extra:{id:t.id}}}{let l=await eS.load({id:e.id},{originPath:t.originPath,glb:t.glb});return{...l,extra:{glb:t.glb}}}}catch(e){throw(0,N.lt)(tS.part,e),e}},tM=async(e,t,l)=>{if(!l)return;let i=t.find(e=>{var t;return(null===(t=e.extra)||void 0===t?void 0:t.glb)===l.glb});if(i)return i;let n=await tE(e,l,"result");return n},tB=async(e,t,l)=>{if(!l)return;let i=t.find(e=>{var t;return(null===(t=e.extra)||void 0===t?void 0:t.glb)===l.glb});if(i)return i;let n=await tE(e,l,"result");return n},tO=async(e,t,l)=>Promise.all(l.map(async l=>{let i=t.find(e=>{var t;return(null===(t=e.extra)||void 0===t?void 0:t.id)===l.id});if(i)return i;let n=await tE(e,l,"geometry");return n})),tj=e=>{let{project:t,simulation:l,geometries:i,result:n,postprocessing:a}=e,[r,s]=(0,c.useState)([]),[d,u]=(0,c.useState)(!1);return(0,B.Z)(()=>{(async()=>{u(!0);try{let e=[];if(l&&!a){let t=await tM(l,r,n);t&&e.push(t)}if(l){let t=await tB(l,r,a);t&&e.push(t)}if(!n&&!a){let t=await tO(l,r,i);e.push(...t)}s(e)}catch(e){}finally{u(!1)}})()},[l,i,n,a,r]),(0,o.tZ)(tP,{loading:d,project:{id:t.id,title:t.title},parts:r})};var tT=l(34041),tX=l(60974),tL=l(49502),tA=l(23389),tz=l(93398),tN=l(96486),tR=l(5193),tI=l(64376),tH=l(10843),tD=l(99138),tK=l(57132);let tU={copy:"Unable to copy simulation"},tW=async(e,t,l)=>{try{let i=tI.Z.deepCopy(t.scheme);i.configuration.run.done=!1,i.configuration.run.error=void 0;let n=await Y.Z.add({id:e.id},{name:t.name+" (copy)",scheme:i});l.addOneSimulation(n),l.mutateProject({id:e.id,simulations:[...e.simulations,n.id]})}catch(e){(0,N.lt)(tU.copy,e)}},tY=e=>{let{project:t,simulation:l,swr:i}=e,[n,a]=(0,c.useState)(!1),r=(0,c.useCallback)(async()=>{a(!0);try{await tW(t,l,i)}finally{a(!1)}},[t,l,i]);return(0,o.tZ)(m.Z,{title:"Copy simulation",children:(0,o.tZ)(Z.ZP,{css:eo.KP.noBorder,loading:n,icon:(0,o.tZ)(tK.Z,{}),onClick:r})})},tV={update:"Unable to update simulation"},tF=async(e,t,l)=>{try{await Y.Z.update({id:e.id},[{key:"name",value:t.name}]),l.mutateOneSimulation({id:e.id,name:t.name})}catch(e){throw(0,N.lt)(tV.update,e),e}},tG=e=>{let{simulation:t,swr:l}=e,i=(0,c.useRef)(null),[n,a]=(0,c.useState)(!1),[r,s]=(0,c.useState)(!1);(0,c.useEffect)(()=>{i.current&&i.current.focus()});let d=(0,c.useCallback)(async e=>{s(!0);try{await tF(t,e,l),s(!1),a(!1)}catch(e){throw s(!1),e}},[t,l]),u=(0,c.useCallback)(()=>a(!0),[]),m=(0,c.useCallback)(()=>a(!1),[]);return(0,o.BX)(o.HY,{children:[(0,o.tZ)(z.w6,{onEdit:u}),(0,o.tZ)(er.ZP,{title:"Edit the simulation's name",visible:n,initialValues:{name:t.name},onCancel:m,onOk:d,loading:r,children:(0,o.tZ)(ep.Z.Item,{name:"name",label:"Name:",rules:[{required:!0,message:"Name is required"}],children:(0,o.tZ)(ey.Z,{ref:i})})})]})},tJ={del:"Unable to delete simulation"},t_=async(e,t,l)=>{try{await Y.Z.del(t);let i=e.simulations.filter(e=>e!==t.id);l.mutateProject({id:e.id,simulations:i}),l.delOneSimulation({id:t.id})}catch(e){throw(0,N.lt)(tJ.del,e),e}},tq=e=>{let{project:t,simulation:l,swr:i}=e,[n,a]=(0,c.useState)(!1),r=(0,c.useCallback)(async()=>{a(!0);try{await t_(t,l,i)}finally{a(!1)}},[t,l,i]);return(0,o.tZ)(z.m1,{loading:n,text:(0,o.BX)(o.HY,{children:["Are you sure you want to delete the simulation"," ",(0,o.tZ)(y.Z.Text,{strong:!0,children:l.name}),"?"]}),onDelete:r})},t$=e=>{let{project:t,simulation:l,swr:i}=e;return t&&l?(0,o.tZ)(h.Z,{children:(0,o.tZ)(h.Z.Content,{children:(0,o.tZ)(j.Z,{size:"small",title:(0,o.tZ)(y.Z.Title,{level:5,ellipsis:!0,children:l.name}),actions:[(0,o.tZ)(tY,{project:{id:t.id,simulations:t.simulations},simulation:l,swr:{mutateProject:i.mutateProject,addOneSimulation:i.addOneSimulation}},"copy"),(0,o.tZ)(tG,{simulation:{id:l.id,name:l.name},swr:{mutateOneSimulation:i.mutateOneSimulation}},"edit"),(0,o.tZ)(tq,{project:{id:t.id,simulations:t.simulations},simulation:{id:l.id,name:l.name},swr:{mutateProject:i.mutateProject,delOneSimulation:i.delOneSimulation}},"delete")],children:(0,o.BX)(T.Z,{direction:"vertical",css:eo.KP.fullWidth,children:[l.scheme.user&&(0,o.tZ)(tD.Z,{message:"User algorithm",type:"info",showIcon:!0}),(0,o.BX)(y.Z.Text,{children:[(0,o.tZ)("span",{css:eo.KP.textLight,children:"Category:"})," ",l.scheme.category]}),(0,o.BX)(y.Z.Text,{children:[(0,o.tZ)("span",{css:eo.KP.textLight,children:"Algorithm:"})," ",l.scheme.algorithm]}),(0,o.BX)(y.Z.Text,{children:[(0,o.tZ)("span",{css:eo.KP.textLight,children:"Code:"})," ",l.scheme.code]}),(0,o.BX)(y.Z.Text,{children:[(0,o.tZ)("span",{css:eo.KP.textLight,children:"Version:"})," ",l.scheme.version]}),(0,o.tZ)("div",{css:(0,M.iv)([eo.KP.fullWidth,eo.KP.scroll]),children:(0,o.tZ)(en.Z.Html,{html:l.scheme.description})})]})})})}):(0,o.tZ)(j.Z,{children:(0,o.tZ)(eO.Z,{})})};var tQ=l(32808);let t0=e=>{let{label:t,css:l,defaultValue:i,defaultChecked:n,onValueChange:a,onCheckedChange:r,unit:s}=e,[d,u]=(0,c.useState)(String(null!=i?i:0)),[m,h]=(0,c.useState)(!!n),[p,y]=(0,c.useState)(void 0!==n&&!n),[Z,v]=(0,c.useState)(0),[g,f]=(0,c.useState)(!1);(0,c.useEffect)(()=>{u(String(null!=i?i:0))},[i]),(0,c.useEffect)(()=>{h(!!n)},[n]);let b=(0,c.useCallback)(e=>{let t=e.target.checked;h(t),null==r||r(t),y(!t)},[r]),C=(0,c.useCallback)(e=>{Z&&clearTimeout(Z);let t=setTimeout(()=>{a(e),f(!1)},500);v(+t)},[Z,a]),k=(0,c.useCallback)(e=>{let t=e.target.value;u(t),f(!0),C(t)},[C]);return(0,o.tZ)(T.Z,{css:(0,M.iv)({...eo.KP.fullWidth,...l||{}}),align:"start",children:(0,o.tZ)(ep.Z,{layout:"vertical",children:(0,o.tZ)(ep.Z.Item,{label:(0,o.BX)(o.HY,{children:[void 0!==n&&(0,o.tZ)(tQ.Z,{checked:m,onChange:b,style:{marginRight:"5px"}}),t]}),children:(0,o.tZ)(ey.Z,{disabled:p,value:d,onChange:k,addonAfter:(0,o.BX)(T.Z,{css:eo.KP.fullWidth,children:[(0,o.tZ)(en.Z.Inline,{text:s}),g?(0,o.tZ)(P.Z,{spin:!0,css:eo.KP.textOrange}):(0,o.tZ)(w.Z,{css:eo.KP.textGreen})]})})})})})},t1={update:"Unable to update simulation"},t2=async(e,t,l)=>{try{let i=tI.Z.deepCopy(e);i.scheme.configuration.geometry.meshParameters={type:t,value:"auto"===t?"normal":"1"};let n={...i.scheme.configuration.geometry,done:!0};await Y.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","geometry"],value:n}]),await Y.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","run"],value:{...i.scheme.configuration.run,done:!1}}]),l.mutateOneSimulation(i)}catch(e){throw(0,N.lt)(t1.update,e),e}},t4=async(e,t,l,i)=>{try{let n=tI.Z.deepCopy(e);n.scheme.configuration.geometry.meshParameters={...n.scheme.configuration.geometry.meshParameters,type:t,value:l};let a={...n.scheme.configuration.geometry,done:!0};await Y.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","geometry"],value:a}]),await Y.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","run"],value:{...n.scheme.configuration.run,done:!1}}]),i.mutateOneSimulation(n)}catch(e){throw(0,N.lt)(t1.update,e),e}},t5=e=>{let{simulation:t,swr:l}=e,[i,n]=(0,c.useState)(),[a,r]=(0,c.useState)();(0,c.useEffect)(()=>{let e=t.scheme.configuration.geometry.meshParameters;e?(n(e.type),r(e.value)):(n("auto"),r("normal"))},[t]);let s=(0,c.useCallback)(async e=>{try{await t2(t,e,l),n(e),"auto"===e?r("normal"):r("1")}catch(e){}},[t,l]),d=(0,c.useCallback)(async e=>{try{await t4(t,i,e,l),r(e)}catch(e){}},[t,i,l]);return(0,o.tZ)(j.Z,{size:"small",title:"Mesh refinement",children:(0,o.BX)(T.Z,{direction:"vertical",css:eo.KP.fullWidth,children:[(0,o.tZ)(ep.Z,{layout:"vertical",children:(0,o.tZ)(ep.Z.Item,{label:"Type",children:(0,o.BX)(tT.Z,{css:eo.KP.fullWidth,value:i,onChange:s,children:[(0,o.tZ)(tT.Z.Option,{value:"auto",children:"Automatic"}),(0,o.tZ)(tT.Z.Option,{value:"manual",children:"Manual"})]})})}),"auto"===i&&(0,o.tZ)(ep.Z,{layout:"vertical",children:(0,o.tZ)(ep.Z.Item,{label:"Size",children:(0,o.BX)(tT.Z,{css:eo.KP.fullWidth,value:a,onChange:d,children:[(0,o.tZ)(tT.Z.Option,{value:"veryfine",children:"Very fine"}),(0,o.tZ)(tT.Z.Option,{value:"fine",children:"Fine"}),(0,o.tZ)(tT.Z.Option,{value:"normal",children:"Normal"}),(0,o.tZ)(tT.Z.Option,{value:"coarse",children:"Coarse"}),(0,o.tZ)(tT.Z.Option,{value:"verycoarse",children:"Very coarse"})]})})}),"manual"===i&&(0,o.tZ)(t0,{label:"Size",defaultValue:a,onValueChange:d,unit:"m"})]})})},t3={selector:(0,M.iv)({padding:"20px",height:"60vh",overflow:"auto",figure:{maxWidth:"80%",border:"1px solid #f0f0f0",margin:"auto",display:"flex",flexDirection:"column",alignItems:"center"},figcaption:{textAlign:"center",color:"#9c9c9c"},img:{maxWidth:"80%"}}),geometriesList:(0,M.iv)({width:"100%",padding:"12px","> .ant-select":{width:"100%"}}),waring:(0,M.iv)({"& .ant-collapse-content":{backgroundColor:"rgba(250, 173, 20, 0.5) !important"}}),error:(0,M.iv)({"& .ant-collapse-content":{backgroundColor:"rgba(255, 77, 79, 0.5) !important"}}),listItem:(0,M.iv)({marginTop:"12px !important",border:"1px solid #f0f0f0 !important",cursor:"default","& .ant-card-body":{padding:"12px !important"}})},t8={update:"Unable to update simulation"},t6=async(e,t,l,i,n)=>{try{var a;let r=tI.Z.deepCopy(e),o=t.find(e=>e.id===l);r.scheme.configuration.geometry.value=l,r.scheme.configuration.geometry.values=void 0;let s={...r.scheme.configuration,dimension:null!==(a=o.summary.dimension)&&void 0!==a?a:3,geometry:{...r.scheme.configuration.geometry,done:!0},run:{...r.scheme.configuration.run,done:!1}};await Y.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration"],value:s}]),n.mutateOneSimulation(r),i([o])}catch(e){(0,N.lt)(t8.update,e)}},t7=async(e,t,l,i,n)=>{try{var a;let r=tI.Z.deepCopy(e),o=t.filter(e=>l.includes(e.id));r.scheme.configuration.geometry.value=void 0,r.scheme.configuration.geometry.values=l;let s={...r.scheme.configuration,dimension:null!==(a=o[0].summary.dimension)&&void 0!==a?a:3,geometry:{...r.scheme.configuration.geometry,done:!0},run:{...r.scheme.configuration.run,done:!1}};await Y.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration"],value:s}]),n.mutateOneSimulation(r),i(o)}catch(e){(0,N.lt)(t8.update,e)}},t9=e=>{let{loadedGeometries:t,geometries:l,simulation:i,setGeometries:n,swr:a}=e,r=(0,c.useMemo)(()=>i.scheme.configuration.geometry.multiple,[i]),s=(0,c.useMemo)(()=>i.scheme.configuration.geometry.n,[i]),d=(0,c.useMemo)(()=>i.scheme.configuration.geometry.value,[i]),u=(0,c.useMemo)(()=>i.scheme.configuration.geometry.values,[i]);(0,B.Z)(()=>{r||d||!l.length?r&&!u&&l.length&&t7(i,t,l.map(e=>e.id),n,a):t6(i,t,l[0].id,n,a)},[r,d,u,t,l,a]);let m=(0,c.useCallback)(e=>{r?t7(i,t,e,n,a):t6(i,t,e,n,a)},[r,t,i,n,a]),h=(0,c.useMemo)(()=>(0,o.tZ)("div",{css:t3.geometriesList,children:(0,o.tZ)(tT.Z,{mode:r?"multiple":void 0,options:t.map(e=>({value:e.id,label:e.name})),value:r?u:d,onChange:m})}),[r,d,u,m,t]);return(0,o.BX)(o.HY,{children:[(0,o.tZ)(j.Z,{size:"small",children:(0,o.tZ)(y.Z.Text,{children:"When changing the simulation domain, you might lose your topological entity assignments"})}),(0,o.BX)(j.Z,{size:"small",children:[(0,o.tZ)(y.Z.Text,{strong:!0,children:"Select a simulation domain"}),s?(0,o.BX)(o.HY,{children:[(0,o.tZ)("br",{}),(0,o.BX)(y.Z.Text,{children:[s," geometries needed"]})]}):null]}),h,i.scheme.configuration.geometry.meshable&&(0,o.tZ)(t5,{simulation:{id:i.id,scheme:i.scheme},swr:{mutateOneSimulation:a.mutateOneSimulation}})]})},le={update:"Unable to delete material"},lt=async(e,t,l,i)=>{try{let n=tI.Z.deepCopy(e),a=n.scheme.configuration.materials,r=a.values[t];r.selected.forEach(e=>{l(th(e))}),a.values=[...a.values.slice(0,t),...a.values.slice(t+1)];let o={...a,done:!!a.values.length};await Y.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","materials"],value:o}]),i.mutateOneSimulation(n)}catch(e){throw(0,N.lt)(le.update,e),e}},ll=e=>{let{simulation:t,index:l,swr:i}=e,[n,a]=(0,c.useState)(!1),{dispatch:r}=(0,c.useContext)(H),s=(0,c.useMemo)(()=>t.scheme.configuration.materials,[t]),d=(0,c.useMemo)(()=>s.values[l],[s,l]),u=(0,c.useCallback)(async()=>{a(!0);try{await lt(t,l,r,i)}finally{a(!1)}},[t,l,i,r]);return(0,o.tZ)(z.m1,{loading:n,text:(0,o.BX)(o.HY,{children:["Are you sure you want to delete the material"," ",(0,o.tZ)(y.Z.Text,{strong:!0,children:d.material.label})]}),onDelete:u})},li=e=>{let{geometries:t,simulation:l,material:i,index:n,swr:a,_onEdit:r}=e,[s,d]=(0,c.useState)(!0),{dispatch:u}=(0,c.useContext)(H),m=(0,c.useCallback)(()=>{u(tr());let e=i.geometry,l=t.find(t=>t.id===e);u(td(null==l?void 0:l.summary.uuid));let n=i.selected;null==n||n.forEach(e=>{u(tm(e))})},[t,i,u]),h=(0,c.useCallback)(()=>{s&&u(to())},[s,u]),p=(0,c.useCallback)(()=>{d(!1),r(n),setTimeout(()=>d(!0),500)},[n,r]);return(0,o.tZ)(j.Z,{css:(0,M.iv)([eo.KP.textAlignCenter,t3.listItem]),hoverable:!0,onMouseEnter:m,onMouseLeave:h,actions:[(0,o.tZ)(z.w6,{onEdit:p},"edit"),(0,o.tZ)(ll,{index:n,simulation:l,swr:a},"delete")],children:(0,o.tZ)(y.Z.Text,{strong:!0,css:eo.KP.textAlignCenter,children:i.material.label})})},ln=e=>{var t;let{geometries:l,simulation:i,swr:n,onEdit:a}=e,r=(0,c.useMemo)(()=>i.scheme.configuration.materials,[i]);return(0,o.tZ)(o.HY,{children:null===(t=r.values)||void 0===t?void 0:t.map((e,t)=>(0,o.tZ)(li,{geometries:l,simulation:i,material:e,index:t,swr:n,_onEdit:a},e.uuid)).filter(e=>e)})};var la=l(85265),lr=l(51904),lo=l(13982),ls=l(14618),ld=l(94668),lu=l(68795);let lc=e=>{let{color:t,setFilter:l}=e,i=(0,c.useCallback)(()=>{l(t)},[t,l]);return(0,o.tZ)(m.Z,{title:"Color",children:(0,o.tZ)(Z.ZP,{style:{backgroundColor:tI.Z.rgbToHex(t)},onClick:i,children:" "})},JSON.stringify(t))},lm=e=>{let{colors:t,setFilter:l}=e,i=(0,c.useCallback)(()=>{l(void 0)},[l]);return(0,o.tZ)(o.HY,{children:t.length>1&&(0,o.BX)(o.HY,{children:[(0,o.tZ)(m.Z,{title:"Reset",children:(0,o.tZ)(Z.ZP,{icon:(0,o.tZ)(et.Z,{}),onClick:i})}),t.map(e=>(0,o.tZ)(lc,{color:e,setFilter:l},JSON.stringify(e)))]})})},lh=e=>{let{element:t,alreadySelected:l,filter:i,search:n,context:a}=e,r=(0,c.useCallback)(e=>{var t,l,a;return(!i||i.r===(null===(t=e.color)||void 0===t?void 0:t.r)&&i.g===(null===(l=e.color)||void 0===l?void 0:l.g)&&i.b===(null===(a=e.color)||void 0===a?void 0:a.b))&&(!n||!e.name||!!e.name.includes(n))},[i,n]),s=(0,c.useCallback)(e=>{a.dispatch(tu(e))},[a]),d=(0,c.useCallback)(()=>{a.dispatch(tc())},[a]),u=(0,c.useCallback)(e=>{a.selected.find(t=>t.uuid===e.uuid)?a.dispatch(th(e)):a.dispatch(tm(e))},[a]),m=(0,c.useMemo)(()=>{var e;return a.selected.find(e=>e.uuid===t.uuid)?"#EE9817":(null===(e=a.highlighted)||void 0===e?void 0:e.uuid)===t.uuid?"#FAD114":"transparent"},[t,a]),h=(0,c.useMemo)(()=>{var e;return a.selected.find(e=>e.uuid===t.uuid)?"rgba(238, 152, 23, 0.3)":(null===(e=a.highlighted)||void 0===e?void 0:e.uuid)===t.uuid?"rgba(250, 209, 20, 0.3)":"transparent"},[t,a]),p=(0,c.useCallback)(()=>s({uuid:t.uuid,label:t.label}),[t,s]),y=(0,c.useCallback)(()=>u({uuid:t.uuid,label:t.label}),[t,u]);return r(t)?(0,o.tZ)(j.Z,{css:eo.Ml.marginBottom(10),bodyStyle:{position:"relative",padding:"10px 10px 10px 40px",borderWidth:"2px",borderStyle:"solid",borderColor:m,backgroundColor:h},onMouseEnter:p,onMouseLeave:d,onClick:y,children:(0,o.BX)(T.Z,{direction:"vertical",children:[(0,o.BX)("div",{children:[(0,o.tZ)("div",{style:{position:"absolute",left:"-2px",top:"-2px",bottom:"-2px",width:"30px",backgroundColor:tI.Z.rgbToRgba(t.color,1)}}),t.name]}),null==l?void 0:l.map(e=>{if(e.selected.find(e=>e.uuid===t.uuid))return(0,o.tZ)(lr.Z,{color:tI.Z.stringToColor(e.label),children:e.label},t.uuid)})]})}):null},lp=e=>{var t;let{geometry:l,alreadySelected:i,updateSelected:n}=e,[a,r]=(0,c.useState)([]),[s,d]=(0,c.useState)(),[u,h]=(0,c.useState)(),{type:p,highlighted:v,selected:g,dispatch:f}=(0,c.useContext)(H);(0,B.Z)(()=>n(g),[g],[n]),(0,B.Z)(()=>{var e;let t=[];p&&(null===(e=l.summary[p])||void 0===e||e.forEach(e=>{if(e.color){let l=t.find(t=>t.r===e.color.r&&t.g===e.color.g&&t.b===e.color.b);l||t.push(e.color)}})),r(t)},[l,p]);let b=(0,c.useCallback)(()=>{var e;null===(e=l.summary[p])||void 0===e||e.forEach(e=>{var t,l,i;(!s||s&&s.r===(null===(t=e.color)||void 0===t?void 0:t.r)&&s.g===(null===(l=e.color)||void 0===l?void 0:l.g)&&s.b===(null===(i=e.color)||void 0===i?void 0:i.b))&&f(tm({uuid:e.uuid,label:e.label}))})},[l,p,s,f]),w=(0,c.useCallback)(()=>{var e;null===(e=l.summary[p])||void 0===e||e.forEach(e=>{var t,l,i;(!s||s&&s.r===(null===(t=e.color)||void 0===t?void 0:t.r)&&s.g===(null===(l=e.color)||void 0===l?void 0:l.g)&&s.b===(null===(i=e.color)||void 0===i?void 0:i.b))&&f(th({uuid:e.uuid,label:e.label}))})},[l,p,s,f]),C=(0,c.useCallback)(()=>{var e;null===(e=l.summary[p])||void 0===e||e.forEach(e=>{var t,l,i;(!s||s&&s.r===(null===(t=e.color)||void 0===t?void 0:t.r)&&s.g===(null===(l=e.color)||void 0===l?void 0:l.g)&&s.b===(null===(i=e.color)||void 0===i?void 0:i.b))&&g.find(t=>t.uuid===e.uuid)?f(th({uuid:e.uuid,label:e.label})):f(tm({uuid:e.uuid,label:e.label}))})},[l,g,p,s,f]),k=(0,c.useCallback)(e=>{let t=e.target.value;h(t)},[]);return(0,o.BX)(j.Z,{size:"small",css:eo.KP.noBorderBottom,children:[(0,o.BX)(T.Z,{direction:"vertical",css:eo.KP.fullWidth,children:[(0,o.tZ)(y.Z.Text,{strong:!0,children:"Filters"}),(0,o.BX)(T.Z,{direction:"horizontal",wrap:!0,children:[(0,o.tZ)(lm,{colors:a,setFilter:d}),(0,o.tZ)(m.Z,{title:"Select all",children:(0,o.tZ)(Z.ZP,{icon:(0,o.tZ)(lo.Z,{}),onClick:b})}),(0,o.tZ)(m.Z,{title:"Unselect all",children:(0,o.tZ)(Z.ZP,{icon:(0,o.tZ)(ls.Z,{}),onClick:w})}),(0,o.tZ)(m.Z,{title:"Swap",children:(0,o.tZ)(Z.ZP,{icon:(0,o.tZ)(ld.Z,{}),onClick:C})})]}),(0,o.tZ)(ey.Z,{placeholder:"Search",value:u,onChange:k,suffix:(0,o.tZ)(lu.Z,{css:eo.KP.textLight})})]}),(0,o.tZ)("div",{css:(0,M.iv)([eo.KP.fullWidth,eo.Ml.marginTop(20)]),children:p?null===(t=l.summary[p])||void 0===t?void 0:t.map(e=>(0,o.tZ)(lh,{element:e,alreadySelected:i,filter:s,search:u,context:{selected:g,highlighted:v,dispatch:f}},e.uuid)):null})]})};var ly=l(51158),lZ=l(13520),lv=l(23226);let lg=e=>{let{onSelect:t}=e,[l,i]=(0,c.useState)(),[n,a]=(0,c.useState)(),[r,s]=(0,c.useState)(),[d,u]=(0,c.useState)(),m=(0,c.useMemo)(()=>Object.keys(lv.E),[]),y=(0,c.useCallback)(()=>i(!0),[]),v=(0,c.useCallback)(()=>i(!1),[]),g=(0,c.useCallback)(e=>{let{key:t}=e,l=lv.E[t];a({key:t,children:l.children}),s(void 0),u(void 0)},[]),f=(0,c.useCallback)(e=>{let{key:t}=e,l=lv.E[n.key],i=l.children.find(e=>e.key===t);s({key:t}),u(i)},[n]),b=(0,c.useCallback)(()=>{t(d),i(!1)},[d,t]);return(0,o.BX)(o.HY,{children:[(0,o.tZ)(Z.ZP,{icon:(0,o.tZ)(lZ.Z,{}),onClick:y,css:eo.KP.fullWidth,children:"Pick a material"}),(0,o.tZ)(tX.Z,{open:l,title:"Material database",onCancel:v,onOk:b,okText:"Choose",okButtonProps:{disabled:!d},width:"50%",children:(0,o.tZ)(h.Z,{children:(0,o.tZ)(h.Z.Content,{children:(0,o.BX)(T.Z,{style:{alignItems:"stretch"},children:[(0,o.tZ)(p.Z,{mode:"inline",items:m.map(e=>({key:e,label:lv.E[e].label})),onClick:g}),(0,o.tZ)(p.Z,{mode:"inline",items:null==n?void 0:n.children.map(e=>({key:e.key,label:e.label})),selectedKeys:(null==r?void 0:r.key)?[null==r?void 0:r.key]:[],onClick:f}),d&&(0,o.tZ)(ly.ZP,{itemLayout:"vertical",children:d.children.map(e=>(0,o.BX)(ly.ZP.Item,{children:[e.label,": ",e.symbol," = ",e.value]},e.label))})]})})})})]})},lf={material:"You need to define a material",selected:"You need to select a solid",update:"Unable to add material"},lb=async(e,t,l)=>{try{let i=tI.Z.deepCopy(t);i.uuid=(0,eU.Z)();let n=tI.Z.deepCopy(e),a=n.scheme.configuration.materials;a.values=[...a.values||[],i];let r={...a,done:!0};await Y.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","materials"],value:r}]),await Y.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","run"],value:{...n.scheme.configuration.run,done:!1}}]),l.mutateOneSimulation(n)}catch(e){throw(0,N.lt)(lf.update,e),e}},lw=e=>{let{simulation:t,material:l,swr:i,onError:n,onClose:a}=e,[r,s]=(0,c.useState)(!1),d=(0,c.useCallback)(async()=>{s(!0);try{var e;if(!l.material){n(lf.material),s(!1);return}if(!(null===(e=l.selected)||void 0===e?void 0:e.length)){n(lf.selected),s(!1);return}n(),await lb(t,l,i),s(!1),a()}catch(e){s(!1)}},[t,l,i,n,a]);return(0,o.tZ)(z.HS,{loading:r,needMargin:!0,onAdd:d,children:"Add"})},lC={material:"You need to define a material",selected:"You need to select a solid",update:"Unable to edit material"},lk=async(e,t,l)=>{try{let i=tI.Z.deepCopy(e),n=i.scheme.configuration.materials,a=n.values.findIndex(e=>e.uuid===t.uuid);n.values=[...n.values.slice(0,a),t,...n.values.slice(a+1)];let r={...n};await Y.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","materials"],value:r}]),l.mutateOneSimulation(i)}catch(e){throw(0,N.lt)(lC.update,e),e}},lx=e=>{let{simulation:t,material:l,swr:i,onError:n,onClose:a}=e,[r,s]=(0,c.useState)(!1),d=(0,c.useCallback)(async()=>{s(!0);try{var e;if(!l.material){n(lC.material),s(!1);return}if(!(null===(e=l.selected)||void 0===e?void 0:e.length)){n(lC.selected),s(!1);return}n(),await lk(t,l,i),s(!1),a()}catch(e){s(!1)}},[t,l,i,n,a]);return(0,o.tZ)(z.w6,{loading:r,primary:!0,needMargin:!0,onEdit:d,children:"Edit"})},lP=e=>{let{child:t,index:l,value:i,_onMaterialChange:n}=e,a=(0,c.useCallback)(e=>{n(t,l,e)},[t,l,n]);return(0,o.tZ)(t0,{label:t.name,defaultValue:null!=i?i:String(t.default),unit:t.unit,onValueChange:a},t.name)},lS=e=>{var t,l,i,n,a,r,s;let{visible:d,geometries:u,simulation:m,material:h,swr:p,onClose:v}=e,[g,f]=(0,c.useState)(),[b,w]=(0,c.useState)(),[C,x]=(0,c.useState)(),[P,S]=(0,c.useState)(),{dispatch:E}=(0,c.useContext)(H),M=(0,c.useMemo)(()=>m.scheme.configuration.materials,[m]);(0,B.Z)(()=>{var e;E(td(null===(e=u[0])||void 0===e?void 0:e.summary.uuid)),x(null==h?void 0:h.geometry)},[u,h],[E]),(0,B.Z)(()=>{!d&&b&&w(void 0)},[d,b]),(0,B.Z)(()=>{var e;d&&!b&&h?w(h):!d||b||h||w({material:{label:"Default",children:(null==M?void 0:M.children.map(e=>({label:e.label,symbol:e.name,value:e.default})))||[]},geometry:null===(e=u[0])||void 0===e?void 0:e.id})},[d,u,M,b]),(0,B.Z)(()=>{var e;let t=null==M?void 0:null===(e=M.values)||void 0===e?void 0:e.map(e=>{if(e.uuid!==(null==h?void 0:h.uuid))return{label:e.material.label,selected:e.selected}}).filter(e=>e);f(t||[])},[m,h,M]);let O=(0,c.useCallback)(e=>{w(t=>({...t,material:e}))},[]),X=(0,c.useCallback)((e,t,l)=>{w(i=>({...i,material:{label:"Custom",children:[...i.material.children.slice(0,t),{label:e.label,symbol:e.name,value:l},...i.material.children.slice(t+1)]}}))},[]),L=(0,c.useCallback)(e=>{w(t=>({...t,selected:e}))},[]),A=(0,c.useCallback)(e=>{x(e);let t=u.find(t=>t.id===e);E(td(t.summary.uuid)),w(t=>({...t,geometry:e}))},[u,E]),N=(0,c.useCallback)(()=>{w(void 0),v()},[v]);return(0,o.tZ)(la.Z,{css:el.subPanel,title:"Material",placement:"left",closable:!1,open:d,mask:!1,maskClosable:!1,width:300,extra:(0,o.tZ)(Z.ZP,{type:"text",icon:(0,o.tZ)(et.Z,{}),onClick:N}),footer:(0,o.BX)("div",{style:{display:"flex",justifyContent:"flex-end"},children:[(0,o.tZ)(z.Lw,{onCancel:N}),h?(0,o.tZ)(lx,{material:{uuid:null!==(i=null==b?void 0:b.uuid)&&void 0!==i?i:h.uuid,material:null!==(n=null==b?void 0:b.material)&&void 0!==n?n:h.material,geometry:null!==(a=null==b?void 0:b.geometry)&&void 0!==a?a:h.geometry,selected:null!==(r=null==b?void 0:b.selected)&&void 0!==r?r:h.selected},simulation:{id:m.id,scheme:m.scheme},swr:{mutateOneSimulation:p.mutateOneSimulation},onError:S,onClose:N}):(0,o.tZ)(lw,{material:{material:null==b?void 0:b.material,geometry:null==b?void 0:b.geometry,selected:null==b?void 0:b.selected},simulation:{id:m.id,scheme:m.scheme},swr:{mutateOneSimulation:p.mutateOneSimulation},onError:S,onClose:N})]}),children:(0,o.BX)(T.Z,{direction:"vertical",css:eo.KP.fullWidth,children:[(0,o.tZ)(j.Z,{size:"small",children:(0,o.BX)(T.Z,{direction:"vertical",css:eo.KP.fullWidth,children:[(0,o.tZ)(lg,{onSelect:O}),(0,o.BX)(y.Z.Text,{children:["Material: ",null!==(s=null==b?void 0:null===(t=b.material)||void 0===t?void 0:t.label)&&void 0!==s?s:"default"]}),null==M?void 0:null===(l=M.children)||void 0===l?void 0:l.map((e,t)=>{var l,i;let n=null==b?void 0:null===(l=b.material)||void 0===l?void 0:null===(i=l.children)||void 0===i?void 0:i.find(t=>t.symbol===e.name);return(0,o.tZ)(lP,{child:e,index:t,value:null==n?void 0:n.value,_onMaterialChange:X},e.name)})]})}),(0,o.tZ)(tL.Z,{items:u.map(e=>({key:e.id,label:e.name,children:(0,o.tZ)(lp,{geometry:e,alreadySelected:g,updateSelected:L})})),activeKey:C,onChange:A}),P&&(0,o.BX)(y.Z.Text,{children:[(0,o.tZ)(k.Z,{style:{color:"red"}})," ",P]})]})})},lE=e=>{let{geometries:t,simulation:l,swr:i,setVisible:n}=e,[a,r]=(0,c.useState)(),[s,d]=(0,c.useState)(!1),{dispatch:u}=(0,c.useContext)(H),m=(0,c.useMemo)(()=>l.scheme.configuration.materials,[l]);(0,B.Z)(()=>{var e;(null===(e=t[0])||void 0===e?void 0:e.summary)&&u(ts(2===t[0].summary.dimension?"faces":"solids"))},[t],[u]);let p=(0,c.useCallback)(()=>{r(void 0),d(!0),n(!1),u(tr())},[u,n]),y=(0,c.useCallback)(e=>{let t=m.values[e];r(t),d(!0),n(!1),u(tr())},[m,u,n]),Z=(0,c.useCallback)(()=>{u(to()),d(!1),r(void 0),n(!0)},[u,n]);return t.length?(0,o.tZ)(h.Z,{children:(0,o.tZ)(h.Z.Content,{children:(0,o.BX)(j.Z,{size:"small",children:[(0,o.tZ)(z.HS,{onAdd:p,fullWidth:!0,primary:!1,children:"Add material"}),(0,o.tZ)(ln,{geometries:t.map(e=>({id:e.id,summary:e.summary})),simulation:{id:l.id,scheme:l.scheme},swr:i,onEdit:y}),(0,o.tZ)(lS,{visible:s,geometries:t.map(e=>({id:e.id,name:e.name,summary:e.summary})),simulation:{id:l.id,scheme:l.scheme},material:a&&{uuid:a.uuid,material:a.material,geometry:a.geometry,selected:a.selected},swr:{mutateOneSimulation:i.mutateOneSimulation},onClose:Z})]})})}):(0,o.tZ)(O.Z.Simple,{})};var lM=l(15045);let lB={update:"Unable to update simulation"},lO=(e,t,l)=>(0,o.tZ)(t0,{label:t.label2D||t.label,defaultValue:null!==(n=t.value)&&void 0!==n?n:t.default,onValueChange:l,unit:t.unit},e),lj=(e,t,l)=>{var i;return(0,o.tZ)(ep.Z,{layout:"vertical",children:(0,o.tZ)(ep.Z.Item,{label:t.label2D||t.label,children:(0,o.tZ)(tT.Z,{options:null===(i=t.options)||void 0===i?void 0:i.map(e=>({label:e.label,value:null!==(a=e.value2D)&&void 0!==a?a:e.value})),defaultValue:t.value||t.default2D||t.default,onChange:l})})},e)},lT=(e,t,l)=>(0,o.tZ)(ep.Z,{layout:"horizontal",children:(0,o.tZ)(ep.Z.Item,{label:t.label2D||t.label,children:(0,o.tZ)(tQ.Z,{defaultChecked:t.value,onChange:l})})},e),lX=(e,t,l)=>(0,o.tZ)(t0,{label:t.label,defaultValue:null!==(r=t.value)&&void 0!==r?r:t.default,onValueChange:l,unit:t.unit},e),lL=(e,t,l)=>(0,o.tZ)(ep.Z,{layout:"vertical",children:(0,o.tZ)(ep.Z.Item,{label:t.label,children:(0,o.tZ)(tT.Z,{options:t.options,defaultValue:t.value||t.default,onChange:l})})},e),lA=(e,t,l)=>(0,o.tZ)(ep.Z,{layout:"horizontal",children:(0,o.tZ)(ep.Z.Item,{label:t.label,children:(0,o.tZ)(tQ.Z,{defaultChecked:t.value,onChange:l})})},e),lz=async(e,t)=>{try{let l=tI.Z.deepCopy(e),i=l.scheme.configuration.parameters,n={...i,done:!0};await Y.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","parameters"],value:n}]),await Y.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","run"],value:{...l.scheme.configuration.run,done:!1}}]),t.mutateOneSimulation(l)}catch(e){(0,N.lt)(lB.update,e)}},lN=async(e,t,l,i,n)=>{try{let a=tI.Z.deepCopy(e),r=a.scheme.configuration.parameters,o=r[t];o.children[l].value=i;let s={...r,done:!0};await Y.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","parameters"],value:s}]),await Y.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","run"],value:{...a.scheme.configuration.run,done:!1}}]),n.mutateOneSimulation(a)}catch(e){(0,N.lt)(lB.update,e)}},lR=e=>{let{simulation:t,dimension:l,child:i,pkey:n,index:a,swr:r}=e,o=(0,c.useCallback)(e=>lN(t,n,a,e,r),[t,n,a,r]),s=(0,c.useCallback)(e=>lN(t,n,a,e.target.checked,r),[t,n,a,r]);if(2===l){if(i.only3D);else if("formula"===i.htmlEntity)return lO(n+"&"+a,i,o);else if("select"===i.htmlEntity)return lj(n+"&"+a,i,o);else if("checkbox"===i.htmlEntity)return lT(n+"&"+a,i,s);return null}return"formula"===i.htmlEntity?lX(n+"&"+a,i,o):"select"===i.htmlEntity?lL(n+"&"+a,i,o):"checkbox"===i.htmlEntity?lA(n+"&"+a,i,s):null},lI=e=>{let{simulation:t,dimension:l,pkey:i,parameter:n,swr:a}=e,r=(0,c.useMemo)(()=>n.children.map((e,n)=>(0,o.tZ)(lR,{simulation:t,dimension:l,child:e,pkey:i,index:n,swr:a},i+"&"+e.label)),[t,l,i,n,a]);return(0,o.tZ)(j.Z,{size:"small",title:null==n?void 0:n.label,children:(0,o.tZ)(T.Z,{direction:"vertical",children:r})},i)},lH=e=>{let{simulation:t,swr:l}=e,i=(0,c.useMemo)(()=>null==t?void 0:t.scheme.configuration.parameters,[t]),n=(0,c.useMemo)(()=>null==t?void 0:t.scheme.configuration.dimension,[t]);(0,c.useEffect)(()=>{(null==i?void 0:i.done)||lz(t,l)},[t,i,l]);let a=(0,c.useMemo)(()=>Object.keys(i).map(e=>{if("index"===e||"title"===e||"done"==e)return null;let a=i[e];return a.advanced?null:(0,o.tZ)(lI,{simulation:t,dimension:n,pkey:e,parameter:a,swr:l},e)}).filter(e=>e),[t,n,i,l]),r=(0,c.useMemo)(()=>Object.keys(i).map(e=>{if("index"===e||"title"===e||"done"==e)return null;let a=i[e];return a.advanced?(0,o.tZ)(lI,{simulation:t,dimension:n,pkey:e,parameter:a,swr:l},e):null}).filter(e=>e),[t,n,i,l]);return(0,o.tZ)(h.Z,{children:(0,o.tZ)(h.Z.Content,{children:(0,o.BX)(T.Z,{direction:"vertical",children:[a,(0,o.tZ)(lM.Z,{children:(0,o.tZ)(lM.Z.Panel,{header:"Advanced",children:(0,o.tZ)(T.Z,{direction:"vertical",children:r})},"advanced")})]})})})},lD=(e,t)=>e.map(e=>{let l=e.fileName.replace(RegExp(t.prefixPattern),"").replace(RegExp(t.suffixPattern),"");return{...e,number:+l}}),lK=(e,t)=>{let l=t.multiplicator;if(l){var i;let t=l.reduce((e,t)=>e[t],e);return null!==(i=t.value)&&void 0!==i?i:t.default}},lU={update:"Unable to update simulation"},lW=async(e,t,l)=>{try{let i=tI.Z.deepCopy(e),n=i.scheme.configuration.initialization;n.value={type:t},await Y.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","initialization"],value:n}]),l.mutateOneSimulation(i)}catch(e){throw(0,N.lt)(lU.update,e),e}},lY=async(e,t,l,i)=>{try{var n;let a=await lG(e,l),r=tI.Z.deepCopy(t),o=r.scheme.configuration.initialization;o.value={...o.value,simulation:l,result:null==a?void 0:null===(n=a[0])||void 0===n?void 0:n.value},await Y.Z.update({id:t.id},[{key:"scheme",type:"json",method:"set",path:["configuration","initialization"],value:o}]),i.mutateOneSimulation(r)}catch(e){throw(0,N.lt)(lU.update,e),e}},lV=async(e,t,l,i)=>{try{let n=tI.Z.deepCopy(e),a=n.scheme.configuration.initialization;a.value={...a.value,number:+t,result:l.file},await Y.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","initialization"],value:a}]),i.mutateOneSimulation(n)}catch(e){(0,N.lt)(lU.update,e)}},lF=async(e,t,l,i)=>{try{let n=tI.Z.deepCopy(e),a=n.scheme.configuration.initialization;a.value.values||(a.value.values=[]),a.value.values[t]=l,await Y.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","initialization"],value:a}]),i.mutateOneSimulation(n)}catch(e){(0,N.lt)(lU.update,e)}},lG=async(e,t)=>{var l;let i=await Y.Z.tasks({id:t}),n=e.find(e=>e.id===t),a=n.scheme.configuration,r=null==a?void 0:null===(l=a.run)||void 0===l?void 0:l.resultsFilter,o=[];return i.forEach(e=>{if(e.file&&"result"===e.file.type&&o.push({label:e.file.fileName,value:e.file.fileName,file:e.file.fileName}),e.files){if(r){let t=RegExp(r.pattern),l=e.files.filter(e=>!t.test(e.fileName)).filter(e=>"result"===e.type),i=e.files.filter(e=>t.test(e.fileName)),n=lD(i,r),s=n.map(e=>({number:e.number,fileName:e.fileName.replace(RegExp(r.suffixPattern),"")})).filter((e,t,l)=>l.findIndex(t=>t.number===e.number)===t).sort((e,t)=>e.number-t.number),d=lK(a,r),u=s.map((e,t)=>{let l=d?e.number*d:t;return{label:String(Math.round(1e15*l)/1e15),value:e.fileName,file:e.fileName}});o.push(...l.map(e=>({label:e.fileName,value:e.fileName,file:e.fileName})).filter(e=>e)),o.push(...u)}else e.files.forEach(e=>{"result"===e.type&&o.push({label:e.fileName,value:e.fileName,file:e.fileName})})}}),o},lJ=e=>{let{simulation:t,child:l,index:i,value:n,swr:a}=e,r=(0,c.useCallback)(e=>lF(t,i,e,a),[t,i,a]);return(0,o.tZ)(t0,{label:l.label,defaultValue:(null!=n?n:l.default).toString(),unit:l.unit,onValueChange:r})},l_=e=>{let{simulations:t,simulation:l,swr:i}=e,[n,a]=(0,c.useState)(!1),[r,s]=(0,c.useState)(),[d,u]=(0,c.useState)(),[m,p]=(0,c.useState)(),Z=(0,c.useMemo)(()=>null==l?void 0:l.scheme.configuration.initialization,[l]),v=(0,c.useMemo)(()=>null==l?void 0:l.scheme.configuration.dimension,[l]),g=(0,c.useCallback)(e=>{let l=t.find(t=>t.id===e);u(l)},[t]);(0,B.Z)(()=>{var e,t;!r&&Z.value&&s(Z.value.type),!d&&(null===(e=Z.value)||void 0===e?void 0:e.simulation)&&g(null===(t=Z.value)||void 0===t?void 0:t.simulation)},[Z,r,d],[g]),(0,B.Z)(()=>{d&&lG(t,d.id).then(e=>p(e))},[t,d]);let f=(0,c.useMemo)(()=>{let e=[{label:"None",value:"none"}];return Z.coupling&&e.push({label:Z.coupling.label,value:"coupling"}),Z.direct&&e.push({label:Z.direct.label,value:"direct"}),e},[Z]),b=Z.value,w=(0,c.useCallback)(async e=>{a(!0);try{await lY(t,l,e,i),g(e)}catch(e){}finally{a(!1)}},[t,l,i,g]),C=(0,c.useCallback)(async(e,t)=>{lV(l,e,t,i)},[l,i]),k=(0,c.useCallback)((e,t)=>(0,o.BX)(o.HY,{children:[(0,o.tZ)(y.Z.Text,{children:"If you use coupling, the selected simulation mesh will be used, at least for the first iteration."}),(0,o.BX)(T.Z,{direction:"vertical",css:(0,M.iv)([eo.KP.fullWidth,eo.Ml.marginTop(10)]),children:[(0,o.tZ)(tT.Z,{css:eo.KP.fullWidth,options:e,placeholder:"Select a simulation",value:null==b?void 0:b.simulation,onChange:w}),n&&(0,o.tZ)(eO.Z,{}),(null==m?void 0:m.length)?(0,o.BX)(o.HY,{children:[(0,o.BX)(y.Z.Text,{children:[null==t?void 0:t.name,":"]},"simulation"),(0,o.tZ)(tT.Z,{css:eo.KP.fullWidth,options:m,placeholder:"Select a "+t.name,value:null==b?void 0:b.result,onChange:C})]}):(0,o.tZ)(y.Z.Text,{type:"danger",children:"No results, please select an other simulation."})]})]}),[b,m,n,w,C]),x=(0,c.useCallback)(e=>(0,o.tZ)(T.Z,{direction:"vertical",css:eo.KP.fullWidth,children:e.children.map((e,t)=>{var n;if(2!==v||!e.only3D)return(0,o.tZ)(lJ,{simulation:l,child:e,index:t,value:null==b?void 0:null===(n=b.values)||void 0===n?void 0:n[t],swr:i},e.label)})}),[b,v,l,i]),P=(0,c.useMemo)(()=>{let e={none:(0,o.tZ)("div",{})},i=Z.coupling;if(null==i?void 0:i.compatibility){let n=t.map(e=>{let t=e.id===l.id||!i.compatibility.find(t=>t.algorithm===e.scheme.algorithm);return{label:e.name,value:e.id,disabled:t}}),a=i.compatibility.find(e=>{var t;return e.algorithm===(null==d?void 0:null===(t=d.scheme)||void 0===t?void 0:t.algorithm)}),r=null==a?void 0:a.filter;e.coupling=k(n,r)}let n=Z.direct;return(null==n?void 0:n.children)&&(e.direct=x(n)),e},[t,l,d,Z,k,x]),S=(0,c.useCallback)(async e=>{try{await lW(l,e,i),s(e)}catch(e){}},[l,i]);return(0,o.tZ)(h.Z,{children:(0,o.tZ)(h.Z.Content,{children:(0,o.BX)(j.Z,{size:"small",children:[(0,o.tZ)(tT.Z,{css:(0,M.iv)([eo.KP.fullWidth,eo.Ml.marginTop(10)]),defaultValue:"none",value:r,options:f,onChange:S}),P[r||"none"]]})})})},lq={update:"Unable to delete boundary condition"},l$=async(e,t,l,i,n)=>{try{let a=tI.Z.deepCopy(e),r=a.scheme.configuration.boundaryConditions,o=r[t],s=o.values[l];s.selected.forEach(e=>{i(th(e))}),o.values=[...o.values.slice(0,l),...o.values.slice(l+1)];let d=!1;Object.keys(r).forEach(e=>{var t;if("index"===e||"title"===e||"done"===e)return;let l=r[e];(null===(t=l.values)||void 0===t?void 0:t.length)&&(d=!0)});let u={...r,done:d};await Y.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","boundaryConditions"],value:u}]),n.mutateOneSimulation(a)}catch(e){throw(0,N.lt)(lq.update,e),e}},lQ=e=>{let{type:t,index:l,simulation:i,swr:n}=e,[a,r]=(0,c.useState)(!1),{dispatch:s}=(0,c.useContext)(H),d=(0,c.useMemo)(()=>i.scheme.configuration.boundaryConditions,[i]),u=(0,c.useMemo)(()=>d[t],[d,t]),m=(0,c.useMemo)(()=>u.values[l],[u,l]),h=(0,c.useCallback)(async()=>{r(!0);try{await l$(i,t,l,s,n)}finally{r(!1)}},[i,t,l,n,s]);return(0,o.tZ)(z.m1,{loading:a,onDelete:h,text:(0,o.BX)(o.HY,{children:["Are you sure you want to delete the condition"," ",(0,o.tZ)(y.Z.Text,{strong:!0,children:null==m?void 0:m.name}),"?"]})})},l0=e=>{let{geometries:t,simulation:l,boundaryCondition:i,index:n,type:a,swr:r,_onEdit:s}=e,[d,u]=(0,c.useState)(!0),{dispatch:m}=(0,c.useContext)(H),h=(0,c.useCallback)(()=>{m(tr());let e=i.geometry,l=t.find(t=>t.id===e);m(td(null==l?void 0:l.summary.uuid));let n=i.selected;null==n||n.forEach(e=>{m(tm(e))})},[t,i,m]),p=(0,c.useCallback)(()=>{d&&m(to())},[d,m]),Z=(0,c.useCallback)(()=>{u(!1),s(a,n),setTimeout(()=>u(!0),500)},[n,a,s]);return(0,o.BX)(j.Z,{css:t3.listItem,hoverable:!0,onMouseEnter:h,onMouseLeave:p,actions:[(0,o.tZ)(z.w6,{onEdit:Z},"edit"),(0,o.tZ)(lQ,{simulation:{id:l.id,scheme:l.scheme},type:a,index:n,swr:{mutateOneSimulation:r.mutateOneSimulation}},"delete")],children:[(0,o.tZ)(y.Z.Text,{strong:!0,children:i.name})," ",(0,o.BX)(y.Z.Text,{children:["(",i.type.label,")"]})]})},l1=e=>{let{geometries:t,simulation:l,swr:i,onEdit:n}=e,a=(0,c.useMemo)(()=>l.scheme.configuration.boundaryConditions,[l]);return(0,o.tZ)(o.HY,{children:Object.keys(a).map(e=>{var r;if("index"===e||"title"===e||"done"===e)return;let s=a[e];return null===(r=s.values)||void 0===r?void 0:r.map((a,r)=>(0,o.tZ)(l0,{geometries:t,simulation:l,boundaryCondition:a,index:r,type:e,swr:i,_onEdit:n},a.uuid))}).filter(e=>e)})};var l2=l(78045);let l4={name:"You need to define a name",type:"You need to select a type",selected:"You need to select a face",update:"Unable to add boundary condition"},l5=async(e,t,l)=>{try{let i={...t},n=i.type.key;i.uuid=(0,eU.Z)();let a=tI.Z.deepCopy(e),r=a.scheme.configuration.boundaryConditions,o=r[n];o.values=[...o.values||[],i];let s={...r,done:!0};await Y.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","boundaryConditions"],value:s}]),await Y.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","run"],value:{...a.scheme.configuration.run,done:!1}}]),l.mutateOneSimulation(a)}catch(e){throw(0,N.lt)(l4.update,e),e}},l3=e=>{let{simulation:t,boundaryCondition:l,swr:i,onError:n,onClose:a}=e,[r,s]=(0,c.useState)(!1),d=(0,c.useCallback)(async()=>{s(!0);try{var e,r;if(!l.name){n(l4.name),s(!1);return}if(!(null===(e=l.type)||void 0===e?void 0:e.key)){n(l4.type),s(!1);return}if(!(null===(r=l.selected)||void 0===r?void 0:r.length)){n(l4.selected),s(!1);return}n(),await l5(t,l,i),s(!1),a()}catch(e){s(!1)}},[t,l,i,n,a]);return(0,o.tZ)(z.HS,{loading:r,onAdd:d,needMargin:!0,children:"Add"})},l8={name:"You need to define a name",type:"You need to select a type",selected:"You need to select a face",update:"Unable to edit boundary condition"},l6=async(e,t,l,i)=>{try{let n=tI.Z.deepCopy(e),a=n.scheme.configuration.boundaryConditions,r=t.type.key,o=l.type.key;if(o!==r){let e=a[o],t=e.values.findIndex(e=>e.uuid===l.uuid);e.values=[...e.values.slice(0,t),...e.values.slice(t+1)]}if(o!==r){let e=a[r];e.values=[...e.values||[],t]}else{let e=a[r],l=e.values.findIndex(e=>e.uuid===t.uuid);e.values=[...e.values.slice(0,l),t,...e.values.slice(l+1)]}let s={...a};await Y.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","boundaryConditions"],value:s}]),i.mutateOneSimulation(n)}catch(e){throw(0,N.lt)(l8.update,e),e}},l7=e=>{let{simulation:t,boundaryCondition:l,oldBoundaryCondition:i,swr:n,onError:a,onClose:r}=e,[s,d]=(0,c.useState)(!1),u=(0,c.useCallback)(async()=>{d(!0);try{var e,o;if(!l.name){a(l8.name),d(!1);return}if(!(null===(e=l.type)||void 0===e?void 0:e.key)){a(l8.type),d(!1);return}if(!(null===(o=l.selected)||void 0===o?void 0:o.length)){a(l8.selected),d(!1);return}a(),await l6(t,l,i,n),d(!1),r()}catch(e){d(!1)}},[t,l,i,n,a,r]);return(0,o.tZ)(z.w6,{loading:s,onEdit:u,primary:!0,needMargin:!0,children:"Edit"})},l9=e=>{let{boundaryCondition:t,index:l,value:i,checked:n,_onValueChange:a,_onCheckedChange:r}=e,s=(0,c.useCallback)(e=>a(l,e),[l,a]),d=(0,c.useCallback)(e=>r(l,e),[l,r]);return(0,o.tZ)(t0,{css:eo.Ml.marginBottom(10),label:t.label,defaultValue:i,defaultChecked:n,onValueChange:s,onCheckedChange:d,unit:t.unit})},ie=e=>{var t,l,i,n,a,r,s;let{visible:d,geometries:u,simulation:m,boundaryCondition:h,swr:p,onClose:v}=e,[g,f]=(0,c.useState)([]),[b,w]=(0,c.useState)([]),[C,x]=(0,c.useState)(),[P,S]=(0,c.useState)(),[E,M]=(0,c.useState)(),[O,X]=(0,c.useState)(),{dispatch:L}=(0,c.useContext)(H),A=(0,c.useMemo)(()=>m.scheme.configuration.boundaryConditions,[m]),N=(0,c.useMemo)(()=>m.scheme.configuration.dimension,[m]);(0,B.Z)(()=>{var e;L(td(null===(e=u[0])||void 0===e?void 0:e.summary.uuid)),M(null==h?void 0:h.geometry)},[u,h],[L]),(0,B.Z)(()=>{!d&&P&&S(void 0)},[d,P]),(0,B.Z)(()=>{let e=Object.keys(A).map(e=>{if("index"===e||"title"===e||"done"===e)return;let t=A[e];return{key:e,label:t.label,children:t.children,values:t.values}}).filter(e=>e);w(e)},[A]),(0,B.Z)(()=>{let e=null==b?void 0:b.map(e=>{var t;return null===(t=e.values)||void 0===t?void 0:t.length}).filter(e=>e).reduce((e,t)=>e+t,0);x(e)},[b]),(0,B.Z)(()=>{d&&!P&&h?S(h):!d||P||h||void 0===C||S(e=>{var t;return{...e,name:"Boundary condition "+(C+1),geometry:null===(t=u[0])||void 0===t?void 0:t.id}})},[d,h,P,C]),(0,B.Z)(()=>{let e=Object.keys(A).map(e=>{var t;if("index"===e||"title"===e||"done"===e)return;let l=A[e];return null==l?void 0:null===(t=l.values)||void 0===t?void 0:t.map(e=>{if(e.uuid!==(null==h?void 0:h.uuid))return{label:e.name,selected:e.selected}}).filter(e=>e)}).flat().filter(e=>e);f(e)},[A,h]);let R=(0,c.useCallback)(e=>{let t=e.target.value;S(e=>({...e,name:t}))},[]),I=(0,c.useCallback)(e=>{var t;let l=e.target.value,i=b.find(e=>e.key===l),n=A[l],a=null===(t=n.children)||void 0===t?void 0:t.map(e=>({checked:!0,value:e.default}));S(e=>({...e,type:{key:i.key,label:i.label,children:i.children},values:a}))},[A,b]),D=(0,c.useCallback)((e,t)=>{S(l=>({...l,values:[...l.values.slice(0,e),{checked:l.values[e].checked,value:t},...l.values.slice(e+1)]}))},[]),K=(0,c.useCallback)((e,t)=>{S(l=>({...l,values:[...l.values.slice(0,e),{checked:t,value:l.values[e].value},...l.values.slice(e+1)]}))},[]),U=(0,c.useCallback)(e=>{S(t=>({...t,selected:e}))},[]),W=(0,c.useMemo)(()=>{var e;return(null==P?void 0:P.type)&&(null===(e=P.type)||void 0===e?void 0:e.children)?(0,o.tZ)(j.Z,{children:P.type.children.map((e,t)=>{if(2!==N||!e.only3D)return(0,o.tZ)(l9,{boundaryCondition:e,index:t,value:String(P.values[t].value),checked:P.type.children.length>1?P.values[t].checked:void 0,_onValueChange:D,_onCheckedChange:K},e.label)})}):null},[P,N,K,D]),Y=(0,c.useCallback)(e=>{M(e);let t=u.find(t=>t.id===e);L(td(null==t?void 0:t.summary.uuid)),S(t=>({...t,geometry:e}))},[u,L]),V=(0,c.useCallback)(()=>{S(void 0),v()},[v]);return(0,o.tZ)(la.Z,{css:el.subPanel,title:"Boundary condition",placement:"left",closable:!1,open:d,mask:!1,maskClosable:!1,width:300,extra:(0,o.tZ)(Z.ZP,{type:"text",icon:(0,o.tZ)(et.Z,{}),onClick:V}),footer:(0,o.BX)("div",{style:{display:"flex",justifyContent:"flex-end"},children:[(0,o.tZ)(z.Lw,{onCancel:V}),h?(0,o.tZ)(l7,{boundaryCondition:{uuid:null!==(l=null==P?void 0:P.uuid)&&void 0!==l?l:h.uuid,name:null!==(i=null==P?void 0:P.name)&&void 0!==i?i:h.name,type:null!==(n=null==P?void 0:P.type)&&void 0!==n?n:h.type,geometry:null!==(a=null==P?void 0:P.geometry)&&void 0!==a?a:h.geometry,selected:null!==(r=null==P?void 0:P.selected)&&void 0!==r?r:h.selected,values:null!==(s=null==P?void 0:P.values)&&void 0!==s?s:h.values},oldBoundaryCondition:{uuid:h.uuid,name:h.name,type:h.type,geometry:h.geometry,selected:h.selected,values:h.values},simulation:{id:m.id,scheme:m.scheme},swr:{mutateOneSimulation:p.mutateOneSimulation},onError:X,onClose:v}):(0,o.tZ)(l3,{boundaryCondition:{name:null==P?void 0:P.name,type:null==P?void 0:P.type,geometry:null==P?void 0:P.geometry,selected:null==P?void 0:P.selected,values:null==P?void 0:P.values},simulation:{id:m.id,scheme:m.scheme},swr:{mutateOneSimulation:p.mutateOneSimulation},onError:X,onClose:v})]}),children:(0,o.BX)(T.Z,{direction:"vertical",css:eo.KP.fullWidth,children:[(0,o.tZ)(j.Z,{size:"small",children:(0,o.tZ)(ep.Z,{layout:"vertical",children:(0,o.tZ)(ep.Z.Item,{label:(0,o.tZ)(y.Z.Text,{strong:!0,children:"Boundary condition name"}),children:(0,o.tZ)(ey.Z,{value:(null==P?void 0:P.name)||"",onChange:R,maxLength:50})})})}),(0,o.tZ)(j.Z,{size:"small",children:(0,o.tZ)(ep.Z,{layout:"vertical",children:(0,o.tZ)(ep.Z.Item,{label:(0,o.tZ)(y.Z.Text,{strong:!0,children:"Boundary condition type"}),children:(0,o.tZ)(l2.ZP.Group,{optionType:"button",buttonStyle:"solid",value:null==P?void 0:null===(t=P.type)||void 0===t?void 0:t.key,onChange:I,children:null==b?void 0:b.map(e=>(0,o.tZ)(l2.ZP.Button,{value:e.key,children:e.label},e.key))})})})}),W,(0,o.tZ)(tL.Z,{items:u.map(e=>({key:e.id,label:e.name,children:(0,o.tZ)(lp,{geometry:e,alreadySelected:g,updateSelected:U})})),activeKey:E,onChange:Y}),O&&(0,o.BX)(y.Z.Text,{children:[(0,o.tZ)(k.Z,{style:{color:"red"}})," ",O]})]})})},it=e=>{let{simulation:t,geometries:l,swr:i,setVisible:n}=e,[a,r]=(0,c.useState)(),[s,d]=(0,c.useState)(!1),{dispatch:u}=(0,c.useContext)(H),m=(0,c.useMemo)(()=>t.scheme.configuration.boundaryConditions,[t]);(0,B.Z)(()=>{var e;(null===(e=l[0])||void 0===e?void 0:e.summary)&&u(ts(2===l[0].summary.dimension?"edges":"faces"))},[l],[u]);let p=(0,c.useCallback)(()=>{r(void 0),d(!0),n(!1),u(tr())},[u,n]),y=(0,c.useCallback)((e,t)=>{let l=m[e],i=l.values[t];r(i),d(!0),n(!1),u(tr())},[m,u,n]),Z=(0,c.useCallback)(()=>{u(to()),d(!1),r(void 0),n(!0)},[u,n]);return l.length?(0,o.tZ)(h.Z,{children:(0,o.tZ)(h.Z.Content,{children:(0,o.BX)(j.Z,{size:"small",children:[(0,o.tZ)(z.HS,{onAdd:p,fullWidth:!0,primary:!1,children:"Add boundary condition"}),(0,o.tZ)(l1,{geometries:l.map(e=>({id:e.id,summary:e.summary})),simulation:{id:t.id,scheme:t.scheme},swr:{mutateOneSimulation:i.mutateOneSimulation},onEdit:y}),(0,o.tZ)(ie,{visible:s,geometries:l.map(e=>({id:e.id,name:e.name,summary:e.summary})),simulation:{id:t.id,scheme:t.scheme},boundaryCondition:a&&{uuid:a.uuid,name:a.name,type:a.type,geometry:a.geometry,selected:a.selected,values:a.values},swr:{mutateOneSimulation:i.mutateOneSimulation},onClose:Z})]})})}):(0,o.tZ)(O.Z.Simple,{})};var il=l(3363),ii=l(67841),ia=l(36027),ir=l(57184);let io={name:"You need to define a name",point:"You need to select a point",formula:"You need to define a formula",update:"Unable to update simulation"},is=async(e,t,l)=>{try{let i=tI.Z.deepCopy(e),n=i.scheme.configuration.run,a=t.index;delete t.index,n.sensors[a]=t,await Y.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","run"],value:n}]),l.mutateOneSimulation(i)}catch(e){throw(0,N.lt)(io.update,e),e}},id=e=>{let{simulation:t,sensor:l,onError:i,onClose:n,swr:a}=e,[r,s]=(0,c.useState)(),d=(0,c.useCallback)(async()=>{s(!0);try{if(!l.name){i(io.name),s(!1);return}if(!l.point){i(io.point),s(!1);return}if(!l.formula){i(io.formula),s(!1);return}i(),await is(t,l,a),s(!1),n()}catch(e){s(!1)}},[t,l,i,n,a]);return(0,o.tZ)(z.w6,{loading:r,primary:!0,needMargin:!0,onEdit:d,children:"Edit"})},iu={name:"You need to define a name",point:"You need to select a point",formula:"You need to define a formula",update:"Unable to update simulation"},ic=async(e,t,l)=>{try{let i=tI.Z.deepCopy(e),n=i.scheme.configuration.run,a={...n,sensors:[...n.sensors||[],t]};await Y.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","run"],value:a}]),l.mutateOneSimulation(i)}catch(e){throw(0,N.lt)(iu.update,e),e}},im=e=>{let{simulation:t,sensor:l,onError:i,onClose:n,swr:a}=e,[r,s]=(0,c.useState)(),d=(0,c.useCallback)(async()=>{s(!0);try{if(!l.name){i(iu.name),s(!1);return}if(!l.point){i(iu.point),s(!1);return}if(!l.formula){i(iu.formula),s(!1);return}i(),await ic(t,l,a),s(!1),n()}catch(e){s(!1)}},[t,l,i,n,a]);return(0,o.tZ)(z.HS,{loading:r,needMargin:!0,onAdd:d,children:"Add"})},ih=e=>{var t,l,i,n,a,r,s,d,u;let{visible:h,geometries:p,simulation:v,sensor:g,onClose:f,swr:b}=e,[w,C]=(0,c.useState)(),[x,P]=(0,c.useState)(),[S,E]=(0,c.useState)(),[M,O]=(0,c.useState)(),{point:X,dispatch:L}=(0,c.useContext)(H);(0,B.Z)(()=>{var e;L(td(null===(e=p[0])||void 0===e?void 0:e.summary.uuid)),E(null==g?void 0:g.geometry)},[p,g],[L]),(0,B.Z)(()=>{L(ts("point"))},[L]),(0,B.Z)(()=>{if(!g){let e=v.scheme.configuration.run;P(t=>({...t,name:"Sensor "+(e.sensors?e.sensors.length+1:1)}))}},[v,g]),(0,B.Z)(()=>{g&&(P(g),L(tp({x:g.point.x,y:g.point.y,z:g.point.z})))},[g],[L]),(0,B.Z)(()=>{X&&P(e=>({...e,point:X}))},[X]);let A=(0,c.useCallback)(()=>{C(!1),L(to()),window.removeEventListener("click",A)},[L]),N=(0,c.useCallback)(()=>{w?A():(C(!0),L(tr()),setTimeout(()=>window.addEventListener("click",A),50))},[w,A,L]),R=(0,c.useCallback)(e=>{E(e);let t=p.find(t=>t.id===e);L(td(t.summary.uuid)),P(t=>({...t,geometry:e}))},[p,L]),I=(0,c.useCallback)((e,t,l)=>{L(tp({x:e,y:t,z:l}))},[L]),D=(0,c.useCallback)(e=>{P(t=>({...t,formula:e}))},[]),K=(0,c.useCallback)(()=>{P(void 0),O(void 0),L(tp()),L(to()),f()},[L,f]),U=(0,c.useCallback)(e=>{P(t=>({...t,name:e.target.value}))},[]),W=(0,c.useCallback)(e=>I(+e,null!==(n=null==X?void 0:X.y)&&void 0!==n?n:0,null!==(a=null==X?void 0:X.z)&&void 0!==a?a:0),[X,I]),Y=(0,c.useCallback)(e=>I(null!==(r=null==X?void 0:X.x)&&void 0!==r?r:0,+e,null!==(s=null==X?void 0:X.z)&&void 0!==s?s:0),[X,I]),V=(0,c.useCallback)(e=>I(null!==(d=null==X?void 0:X.x)&&void 0!==d?d:0,null!==(u=null==X?void 0:X.y)&&void 0!==u?u:0,+e),[X,I]);return(0,o.tZ)(la.Z,{title:"Sensor",placement:"left",closable:!1,open:h,mask:!1,maskClosable:!1,width:300,extra:(0,o.tZ)(Z.ZP,{type:"text",icon:(0,o.tZ)(et.Z,{}),onClick:K}),footer:(0,o.BX)("div",{style:{display:"flex",justifyContent:"flex-end"},children:[(0,o.tZ)(z.Lw,{onCancel:K}),g?(0,o.tZ)(id,{simulation:v,sensor:{...g,...x},onError:O,onClose:K,swr:b}):(0,o.tZ)(im,{simulation:v,sensor:x,onError:O,onClose:K,swr:b})]}),children:(0,o.BX)(T.Z,{direction:"vertical",css:eo.KP.fullWidth,children:[(0,o.BX)(j.Z,{size:"small",children:[(0,o.tZ)(y.Z.Text,{children:"Name"}),(0,o.tZ)(ey.Z,{value:null==x?void 0:x.name,onChange:U})]}),(0,o.BX)(j.Z,{size:"small",children:[(0,o.tZ)(tL.Z,{items:p.map(e=>({key:e.id,label:e.name})),activeKey:S,onChange:R}),(0,o.BX)(T.Z,{direction:"vertical",css:eo.KP.fullWidth,children:[(0,o.BX)(T.Z,{css:eo.KP.fullWidth,style:{justifyContent:"space-between"},children:[(0,o.tZ)(y.Z.Text,{children:"Point selection"}),(0,o.tZ)(m.Z,{title:"Pin in the geometry",children:(0,o.tZ)(Z.ZP,{size:"small",type:w?"primary":"default",icon:(0,o.tZ)(ir.Z,{}),onClick:N})})]}),(0,o.tZ)(t0,{label:"X",defaultValue:null==x?void 0:null===(t=x.point)||void 0===t?void 0:t.x,onValueChange:W}),(0,o.tZ)(t0,{label:"Y",defaultValue:null==x?void 0:null===(l=x.point)||void 0===l?void 0:l.y,onValueChange:Y}),(0,o.tZ)(t0,{label:"Z",defaultValue:null==x?void 0:null===(i=x.point)||void 0===i?void 0:i.z,onValueChange:V})]})]}),(0,o.tZ)(j.Z,{size:"small",css:eo.KP.noBorderBottom,children:(0,o.tZ)(t0,{label:"Formula",defaultValue:null==x?void 0:x.formula,onValueChange:D})}),M&&(0,o.BX)(y.Z.Text,{children:[(0,o.tZ)(k.Z,{style:{color:"red"}})," ",M]})]})})},ip={udpate:"Unable to update simulation"},iy=async(e,t,l,i)=>{try{let n=tI.Z.deepCopy(e),a=n.scheme.configuration.run;l(tp()),a.sensors=[...a.sensors.slice(0,t),...a.sensors.slice(t+1)],await Y.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","run"],value:a}]),i.mutateOneSimulation(n)}catch(e){throw(0,N.lt)(ip.udpate,e),e}},iZ=e=>{let{simulation:t,index:l,swr:i}=e,[n,a]=(0,c.useState)(),{dispatch:r}=(0,c.useContext)(H),s=(0,c.useMemo)(()=>t.scheme.configuration.run,[t]),d=(0,c.useMemo)(()=>s.sensors[l],[l,s]),u=(0,c.useCallback)(async()=>{a(!0);try{await iy(t,l,r,i)}finally{a(!1)}},[t,l,r,i]);return(0,o.tZ)(z.m1,{loading:n,text:(0,o.BX)(o.HY,{children:["Are you sure you want to delete the sensor"," ",(0,o.tZ)(y.Z.Text,{strong:!0,children:d.name})]}),onDelete:u})},iv=e=>{let{simulation:t,sensor:l,index:i,_onEdit:n,swr:a}=e,{dispatch:r}=(0,c.useContext)(H),s=(0,c.useCallback)(()=>{r(tr()),r(tp(l.point))},[l,r]),d=(0,c.useCallback)(()=>{r(to())},[r]),u=(0,c.useCallback)(()=>n({...l,index:i}),[l,i,n]);return(0,o.tZ)(j.Z,{css:(0,M.iv)([eo.KP.textAlignCenter,t3.listItem]),hoverable:!0,onMouseEnter:s,onMouseLeave:d,actions:[(0,o.tZ)(z.w6,{onEdit:u},"edit"),(0,o.tZ)(iZ,{simulation:t,index:i,swr:a},"delete")],children:(0,o.tZ)(y.Z.Text,{strong:!0,css:eo.KP.textAlignCenter,children:l.name})})},ig=e=>{var t;let{simulation:l,onEdit:i,swr:n}=e,a=(0,c.useMemo)(()=>l.scheme.configuration.run,[l]);return(0,o.tZ)(o.HY,{children:null===(t=a.sensors)||void 0===t?void 0:t.map((e,t)=>(0,o.tZ)(iv,{simulation:l,sensor:e,index:t,_onEdit:i,swr:n},e.name))})},ib=e=>{let{geometries:t,simulation:l,setVisible:i,setResult:n,setPostprocessing:a,swr:r}=e,[s,d]=(0,c.useState)(),[u,m]=(0,c.useState)(),h=(0,c.useCallback)(()=>{n(void 0),a(void 0),m(void 0),i(!1),d(!0)},[i,n,a]),p=(0,c.useCallback)(e=>{n(void 0),a(void 0),m(e),i(!1),d(!0)},[i,n,a]),y=(0,c.useCallback)(()=>{m(void 0),i(!0),d(!1)},[i]);return(0,o.BX)(j.Z,{size:"small",title:"Sensors",children:[(0,o.tZ)(ih,{visible:s,geometries:t,simulation:l,sensor:u,onClose:y,swr:r}),(0,o.BX)(T.Z,{direction:"vertical",css:eo.KP.fullWidth,children:[(0,o.tZ)(Z.ZP,{css:eo.KP.fullWidth,disabled:!1,type:"primary",icon:(0,o.tZ)(ia.Z,{}),onClick:h,children:"Add a sensor"}),(0,o.tZ)(ig,{simulation:l,onEdit:p,swr:r})]})]})};var iw=l(139),iC=l(71270);let ik={plugins:"Plugins error",pluginsLoad:"Unable to load plugins"},ix=e=>{let{plugin:t,onOk:i,setVisible:n}=e,a=d()(()=>l(64546)("./".concat(t.key,"/src/components"))),r=(0,c.useCallback)(e=>{(0,tN.merge)(t,e),i(t),n(!1)},[t,i,n]);return(0,o.tZ)(j.Z,{title:t.configuration.name.value,children:(0,o.tZ)(a,{data:t.data,onSelect:r})},t.uuid)},iP=e=>{let{pluginsList:t,plugins:l,onOk:i,setVisible:n}=e;return(null==l?void 0:l.length)?(0,o.tZ)(T.Z,{align:"start",direction:"horizontal",wrap:!0,children:l.map(e=>{let l=t.find(t=>t.key===e.key);return l?(0,o.tZ)(ix,{plugin:e,onOk:i,setVisible:n},e.key):null})}):null},iS=e=>{let{disabled:t,cloudServer:l,onOk:i}=e,[n,a]=(0,c.useState)(!1),[r,s]=(0,c.useState)([]),d=(0,u.useRouter)(),[m,{errorPlugins:h}]=iC.Z.usePlugins();(0,c.useEffect)(()=>{h&&(0,N.lt)(ik.plugins,h)},[h]),(0,c.useEffect)(()=>{tH.Z.list().then(e=>{s(e)}).catch(e=>{(0,N.lt)(ik.pluginsLoad,e)})},[]);let p=(0,c.useCallback)(()=>a(!0),[]),v=(0,c.useCallback)(()=>a(!1),[]),g=(0,c.useCallback)(()=>{d.push({pathname:"/dashboard",query:{page:"account",tab:"hpc"}})},[d]);return(0,o.BX)(j.Z,{size:"small",title:"Computational resource",children:[(0,o.tZ)(tX.Z,{open:n,title:"Computational resource",okButtonProps:{disabled:!0,style:{display:"none"}},onCancel:v,style:{width:"unset"},children:(0,o.BX)(T.Z,{direction:"vertical",children:[(0,o.BX)(y.Z.Text,{children:["Your computational resource does not appear in this list? Create one in your"," ",(0,o.tZ)(z.Qj,{onClick:g,children:"account settings"})]}),(0,o.tZ)(iP,{pluginsList:r,plugins:m,onOk:i,setVisible:a})]})}),(0,o.BX)(T.Z,{direction:"vertical",css:eo.KP.fullWidth,children:[l&&(0,o.BX)(o.HY,{children:[(0,o.BX)(y.Z.Text,{children:[(0,o.tZ)("span",{css:eo.KP.textLight,children:"Plugin:"})," ",l.name]}),(0,o.BX)(y.Z.Text,{children:[(0,o.tZ)("span",{css:eo.KP.textLight,children:"Name:"})," ",l.configuration.name.value]}),Object.keys(l.inUseConfiguration).map(e=>{let t=l.inUseConfiguration[e],i=t.value;return"boolean"==typeof i&&(i=i?"yes":"no"),(0,o.BX)(y.Z.Text,{children:[(0,o.BX)("span",{css:eo.KP.textLight,children:[t.label,":"]})," ",i]},e)})]}),(0,o.tZ)(Z.ZP,{css:eo.KP.fullWidth,disabled:t,type:l?"link":"primary",icon:(0,o.tZ)(iw.Z,{}),onClick:p,children:l?"Modify the resource":"Select a resource"})]})]})};var iE=l(15360),iM=l(25935),iB=l(48764).lW;let iO={log:"Unable to get system log"},ij=async(e,t)=>{try{let l=await Y.Z.log({id:e.id},t.systemLog),i=iB.from(l.log).toString();tX.Z.info({title:"System log",width:"unset",content:(0,o.tZ)("div",{style:{maxHeight:"70vh",overflow:"auto"},children:(0,o.tZ)("pre",{children:(0,o.tZ)("code",{children:(0,iM.ZP)(i.replace(/\n\n/g,"\n").replace(/\n/g,"<br />"))})})})})}catch(e){(0,N.lt)(iO.log,e)}},iT=e=>{var t,l;let{simulation:i,step:n,loading:a,setLoading:r}=e,s=(0,c.useCallback)(async()=>{r(!0);try{await ij(i,n)}catch(e){}finally{r(!1)}},[i,n,r]);return(0,o.BX)(o.HY,{children:[n.systemLog&&(0,o.BX)(o.HY,{children:[(0,o.tZ)(Z.ZP,{loading:a,onClick:s,children:"Complete log"}),(0,o.tZ)("br",{})]}),n.link&&(0,o.BX)(o.HY,{children:[(0,o.tZ)("a",{href:"https://"+n.link.href,target:"_blank",rel:"noreferrer",children:(0,o.tZ)(Z.ZP,{type:"primary",children:n.link.label})}),(0,o.tZ)("br",{})]}),(0,o.BX)(lM.Z,{ghost:!0,children:[n.warning&&(0,o.tZ)(lM.Z.Panel,{css:t3.warning,header:(0,o.tZ)(y.Z.Text,{type:"warning",children:"Warnings"}),children:(0,iM.ZP)(n.warning.replace(/\n\n/g,"\n").replace(/\n/g,"<br />"))},"warnings"),n.error&&(0,o.tZ)(lM.Z.Panel,{css:t3.error,header:(0,o.tZ)(y.Z.Text,{type:"danger",children:"Errors"}),children:(0,iM.ZP)(n.error.replace(/\n\n/g,"\n").replace(/\n/g,"<br />"))},"errors")]}),(0,iM.ZP)((null===(t=n.pluginLog)||void 0===t?void 0:t.replace(/\n\n/g,"\n").replace(/\n/g,"<br />"))||""),(0,iM.ZP)((null===(l=n.log)||void 0===l?void 0:l.replace(/\n\n/g,"\n").replace(/\n/g,"<br />").replace(/Info\s*:/g,'<span style="color: blue; font-weight: bold;">Info: </span>').replace(/Error:/g,'<span style="color: red; font-weight: bold;">Error:</span>'))||"")]})},iX=e=>{let{simulation:t,steps:l}=e,[i,n]=(0,c.useState)(!1),[a,r]=(0,c.useState)(!1),s=(0,c.useCallback)(()=>n(!0),[]),d=(0,c.useCallback)(()=>n(!1),[]);return(0,o.BX)(o.HY,{children:[(0,o.tZ)(la.Z,{title:"Log",open:i,onClose:d,width:"50%",children:(0,o.tZ)(tL.Z,{items:null==l?void 0:l.map((e,l)=>({key:""+l,label:e.label,children:(0,o.tZ)(iT,{simulation:t,step:e,loading:a,setLoading:r})}))})}),(0,o.tZ)(m.Z,{title:"Log",children:(0,o.tZ)(Z.ZP,{disabled:!l||!l.length,icon:(0,o.tZ)(iE.Z,{}),onClick:s})})]})};var iL=l(23430);let iA={download:"Unable to download file"},iz=async(e,t)=>{try{let l=await eS.download({id:e.id},{originPath:t.originPath,fileName:t.fileName}),i=await l.blob(),n=window.URL.createObjectURL(new Blob([i])),a=document.createElement("a");a.href=n,a.setAttribute("download",t.name+"."+t.fileName.split(".").pop()),a.click()}catch(e){(0,N.lt)(iA.download,e)}},iN=e=>{let{simulation:t,file:l}=e,[i,n]=(0,c.useState)(!1),a=(0,c.useCallback)(async()=>{n(!0);try{await iz(t,l)}catch(e){}finally{n(!1)}},[t,l]);return(0,o.tZ)(m.Z,{title:"Download",children:(0,o.tZ)(Z.ZP,{loading:i,icon:(0,o.tZ)(iL.Z,{}),onClick:a})})},iR={archive:"Unable to download archive"},iI=async e=>{try{let t=await eS.archive({id:e.id}),l=await t.blob(),i=window.URL.createObjectURL(new Blob([l])),n=document.createElement("a");n.href=i,n.setAttribute("download",e.scheme.name+".zip"),n.click()}catch(e){(0,N.lt)(iR.archive,e)}},iH=e=>{let{simulation:t}=e,[l,i]=(0,c.useState)(!1),n=(0,c.useCallback)(async()=>{i(!0);try{await iI(t)}catch(e){}finally{i(!1)}},[t]);return(0,o.tZ)(z.o6,{loading:l,onDownload:n})},iD=e=>{let{simulation:t,result:l,file:i,setResult:n}=e,a=(0,c.useCallback)(()=>n((null==l?void 0:l.fileName)===i.fileName&&l.name===i.name?void 0:i),[l,i,n]);return(0,o.BX)(T.Z,{style:{alignItems:"center"},children:[(0,o.tZ)(Z.ZP,{icon:(null==l?void 0:l.fileName)===i.fileName&&l.name===i.name?(0,o.tZ)(v.Z,{style:{color:"#fad114"}}):(0,o.tZ)(g.Z,{}),onClick:a}),(0,o.tZ)(iN,{simulation:{id:t.id},file:{name:i.name,fileName:i.fileName,originPath:i.originPath}}),i.name]})},iK=e=>{let{simulation:t,result:l,setResult:i}=e,[n,a]=(0,c.useState)(),[r,s]=(0,c.useState)(),[d,u]=(0,c.useState)(),m=(0,c.useMemo)(()=>{var e;return null==t?void 0:null===(e=t.scheme)||void 0===e?void 0:e.configuration},[t]);(0,B.Z)(()=>{var e;if(!(null==t?void 0:t.tasks)){a([]),s(void 0);return}let l=[],i=null==m?void 0:null===(e=m.run)||void 0===e?void 0:e.resultsFilter;t.tasks.forEach(e=>{if(e.file&&l.push(e.file),e.files){if(i){let t=RegExp(i.pattern),n=e.files.filter(e=>!t.test(e.fileName)),a=e.files.filter(e=>t.test(e.fileName)),r=lD(a,i),o=r.map(e=>e.number).filter((e,t,l)=>l.indexOf(e)===t).sort((e,t)=>e-t),d=lK(m,i),u=o.map((e,t)=>({label:Math.round(1e15*(d?e*d:t))/1e15,value:e}));l.push(...n),s({filtered:!0,name:i.name,files:r,options:u})}else l.push(...e.files)}}),a(l)},[t,m]),(0,B.Z)(()=>{!d&&r&&u(null==r?void 0:r.options[0].value)},[r,d]);let h=(0,c.useCallback)(e=>{let t=r.files.find(t=>t.number===e&&t.name===(null==l?void 0:l.name));i(t),u(e)},[l,r,i]);return n||r?(null==n?void 0:n.length)||r?(0,o.tZ)(j.Z,{size:"small",title:"Results",extra:(0,o.tZ)(iH,{simulation:t&&{id:t.id,scheme:t.scheme}}),children:(0,o.BX)(T.Z,{direction:"vertical",css:eo.KP.fullWidth,children:[null==n?void 0:n.map(e=>(0,o.tZ)(iD,{simulation:t,result:l,file:e,setResult:i},e.name)),r&&(0,o.BX)(o.HY,{children:[r.name,(0,o.tZ)(tT.Z,{css:eo.KP.fullWidth,options:r.options,value:d,onChange:h}),r.files.map(e=>{if(e.number===d)return(0,o.tZ)(iD,{simulation:t,result:l,file:e,setResult:i},e.name)})]})]})}):(0,o.tZ)(j.Z,{size:"small",children:"No results yet"}):(0,o.tZ)(eO.Z,{})},iU={run:"Unable to run simulation",stop:"Unable to stop simulation",update:"Unable to update simulation"},iW=async(e,t,l)=>{try{let i=tI.Z.deepCopy(e),n=e.scheme.configuration;n.run.cloudServer=t,i.scheme.configuration=n,await Y.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","run"],value:n.run}]),l.mutateOneSimulation(i),l.mutateSimulation(i)}catch(e){(0,N.lt)(iU.update,e)}},iY=async e=>{try{await Y.Z.run({id:e.id})}catch(e){throw(0,N.lt)(iU.run,e),e}},iV=async e=>{try{await Y.Z.stop({id:e.id})}catch(e){throw(0,N.lt)(iU.stop,e),e}},iF=e=>{var t;let{geometries:l,simulation:i,result:n,setResult:a,setPostprocessing:r,setVisible:s,swr:d}=e,[u,m]=(0,c.useState)(!1),[p,y]=(0,c.useState)(!1),[v,g]=(0,c.useState)([]),[f,b]=(0,c.useState)(0),[w,{mutateSimulation:C}]=Y.Z.useSimulation(i.id,2e3),k=(0,c.useMemo)(()=>i.scheme.configuration,[i]),x=(0,c.useMemo)(()=>{var e;return null==w?void 0:null===(e=w.scheme)||void 0===e?void 0:e.configuration},[w]);(0,B.Z)(()=>{if(!k){m(!0);return}let e=!0;Object.keys(k).forEach(t=>{if("dimension"!==t&&"run"!==t){let l=k[t];l.done||(e=!1)}}),k.run.cloudServer||(e=!1),m(!e)},[k]),(0,B.Z)(()=>{var e,t,l;(null==w?void 0:null===(e=w.tasks)||void 0===e?void 0:e.find(e=>(null==e?void 0:e.status)==="error"))?y(!1):(null==w?void 0:null===(t=w.tasks)||void 0===t?void 0:t.find(e=>e&&"finish"!==e.status))?y(!0):y(!1);let i=[];null==w||null===(l=w.tasks)||void 0===l||l.forEach((e,t)=>{if(e){if(t===w.tasks.length-1){var l,n,a;let t=null!==(a=null===(l=e.log)||void 0===l?void 0:l.match(/[\d\s]{3}\%/g))&&void 0!==a?a:null===(n=e.log)||void 0===n?void 0:n.match(/[\d\s]*\%/g),i=t?parseFloat(t.pop()):void 0;i&&b(i)}i[e.index]={index:e.index,label:e.label,status:e.status,log:e.log,pluginLog:e.pluginLog,warning:e.warning,error:e.error,systemLog:e.systemLog,link:e.link}}}),g(i)},[null==w?void 0:w.tasks]);let P=(0,c.useCallback)(async e=>iW(i,e,{...d,mutateSimulation:C}),[i,d,C]),S=(0,c.useCallback)(async()=>{y(!0);try{await iY(i)}catch(e){y(!1)}},[i]),E=(0,c.useCallback)(async()=>{try{await iV(i),y(!1)}catch(e){}},[i]);return i&&w&&(null==w?void 0:w.id)!=="0"?(0,o.tZ)(h.Z,{children:(0,o.tZ)(h.Z.Content,{children:(0,o.BX)(T.Z,{direction:"vertical",css:eo.KP.fullWidth,children:[(0,o.tZ)(ib,{geometries:l,simulation:i,setVisible:s,setResult:a,setPostprocessing:r,swr:{mutateOneSimulation:d.mutateOneSimulation}}),(0,o.tZ)(iS,{disabled:p,cloudServer:null==x?void 0:null===(t=x.run)||void 0===t?void 0:t.cloudServer,onOk:P}),(0,o.tZ)(j.Z,{size:"small",title:"Run",children:(0,o.BX)(T.Z,{direction:"vertical",css:eo.KP.fullWidth,size:20,children:[(0,o.BX)("div",{css:eo.KP.fullWidth,style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,o.BX)(T.Z,{children:[(0,o.tZ)(Z.ZP,{disabled:u,type:"primary",icon:(0,o.tZ)(ii.Z,{}),loading:p,onClick:S,children:"Run"}),(0,o.tZ)(Z.ZP,{disabled:!p,danger:!0,icon:(0,o.tZ)(eI.Z,{}),shape:"circle",onClick:E})]}),(0,o.tZ)(iX,{simulation:{id:i.id},steps:v})]}),(0,o.tZ)(il.Z,{direction:"vertical",current:v.length-1,percent:f,items:v.map((e,t)=>({key:t,title:e.label,description:"("+(t+1)+"/"+v.length+")",status:e.status}))})]})}),(0,o.tZ)(iK,{simulation:w&&{id:w.id,scheme:w.scheme,tasks:w.tasks},result:n&&{name:n.name,fileName:n.fileName},setResult:a})]})})}):(0,o.tZ)(h.Z,{children:(0,o.tZ)(h.Z.Content,{children:(0,o.tZ)(j.Z,{size:"small",children:(0,o.tZ)(eO.Z,{})})})})};var iG=l(1402),iJ=[{key:"warpByVector",label:"Warp by vector",parameters:[{key:"Vectors",label:"Vectors",rules:[{required:!0,message:"Vectors is required"}]},{key:"ScaleFactor",label:"Scale factor",default:"1",rules:[{required:!0,message:"Scale factor is required"}]}]},{key:"contour",label:"Contour",parameters:[{key:"ContourBy",label:"Contour by",rules:[{required:!0,message:"ContourBy by is required"}]},{key:"isosurface",label:"Isosurface",default:"0",rules:[{required:!0,message:"Isosurface is required"}]}]},{key:"streamTracer",label:"Stream tracer",parameters:[{key:"Vectors",label:"Vectors",rules:[{required:!0,message:"Vectors is required"}]}]}];let i_=async(e,t,l,i)=>{let n=await (0,F.R)("/api/postprocessing",{method:"POST",headers:{Accept:"application/json"},body:JSON.stringify({simulation:e,result:t,filter:l,parameters:i})});return n.json()};var iq={run:i_};let i$={run:"Unable to run filter"},iQ=async(e,t,l,i)=>{try{return await iq.run(e,t,l,i)}catch(e){throw(0,N.lt)(i$.run,e),e}},i0=e=>{let{simulation:t,postprocessing:l,result:i,setResult:n}=e,a=(0,c.useCallback)(()=>n((null==l?void 0:l.fileName)===i.fileName&&(null==l?void 0:l.name)===i.name?void 0:{type:"postprocessing",...i}),[l,i,n]);return(0,o.BX)(T.Z,{children:[(0,o.tZ)(Z.ZP,{icon:(null==l?void 0:l.fileName)===i.fileName&&(null==l?void 0:l.name)===i.name?(0,o.tZ)(v.Z,{css:(0,M.iv)({color:eo.Rl.colorPrimary})}):(0,o.tZ)(g.Z,{}),onClick:a}),(0,o.tZ)(iN,{simulation:{id:t.id},file:{name:i.name,fileName:i.fileName,originPath:i.originPath}}),i.name]},i.glb)},i1=e=>{let{simulation:t,postprocessing:l,results:i,setResult:n}=e;return i.length?(0,o.tZ)(T.Z,{direction:"vertical",css:eo.KP.fullWidth,children:i.map(e=>(0,o.tZ)(i0,{simulation:t,postprocessing:l,result:e,setResult:n},e.glb))}):(0,o.tZ)(o.HY,{children:"No results"})},i2=e=>{let{simulation:t,result:l,postprocessing:i,setResult:n}=e,[a,r]=(0,c.useState)(),[s,d]=(0,c.useState)(),[u,p]=(0,c.useState)(),[y,v]=(0,c.useState)();(0,c.useEffect)(()=>{!l&&a&&r(!1)},[l,a]),(0,c.useEffect)(()=>{t||(d(void 0),v(void 0))},[t,l]);let g=(0,c.useMemo)(()=>null==t?void 0:t.scheme.configuration.run.postprocessing,[t]),f=(0,c.useMemo)(()=>iJ.map(e=>{if(null==g?void 0:g.find(t=>t.key===e.key))return{label:e.label,value:e.key}}).filter(e=>e),[g]),b=(0,c.useMemo)(()=>{if(!g||!s)return;let e=iJ.find(e=>e.key===s),t=g.find(e=>e.key===s);if(null==e?void 0:e.parameters)return e.parameters.map((e,l)=>{var i;let n=null==t?void 0:null===(i=t.parameters)||void 0===i?void 0:i.find(t=>t.key===e.key);return(null==n?void 0:n.value)?(0,o.tZ)(ep.Z.Item,{label:e.label,name:["parameters",l],initialValue:n.value,rules:e.rules,children:(0,o.tZ)(ey.Z,{disabled:!0})},e.key):(null==n?void 0:n.options)?(0,o.tZ)(ep.Z.Item,{label:e.label,name:["parameters",l],rules:e.rules,children:(0,o.tZ)(tT.Z,{options:n.options.map(e=>({label:e,value:e}))})},e.key):(0,o.tZ)(ep.Z.Item,{label:e.label,name:["parameters",l],rules:e.rules,initialValue:e.default,children:(0,o.tZ)(ey.Z,{})},e.key)})},[g,s]),w=(0,c.useCallback)(()=>r(!0),[]),C=(0,c.useCallback)(()=>r(!1),[]),k=(0,c.useCallback)(async e=>{p(!0);try{let i=await iQ({id:t.id},l,s,e.parameters||[]);v({filter:s,results:i})}catch(e){}p(!1)},[t,l,s]);return t&&l&&g&&f.length?(0,o.tZ)(h.Z,{style:{position:"absolute",zIndex:101,right:25,bottom:50,backgroundColor:"rgba(255, 255, 255, 0)"},children:(0,o.BX)(h.Z.Content,{children:[(0,o.tZ)(m.Z,{title:"Post-processing",children:(0,o.tZ)(Z.ZP,{type:"primary",icon:(0,o.tZ)(iG.Z,{}),onClick:w,style:{width:40,height:40,border:"1px solid #5E14FA",borderRadius:20,marginBottom:-20}})}),(0,o.BX)(la.Z,{title:"Post-processing",closable:!0,onClose:C,open:a,mask:!1,maskClosable:!1,children:[(0,o.tZ)(ep.Z,{style:{margin:"24px 0"},children:(0,o.tZ)(ep.Z.Item,{name:"filter",label:"Filter",children:(0,o.tZ)(tT.Z,{placeholder:"Select a filter",options:f,onChange:d})})}),(0,o.BX)(ep.Z,{layout:"vertical",style:{margin:"24px 0"},onFinish:k,children:[b,(0,o.tZ)(ep.Z.Item,{children:(0,o.tZ)(Z.ZP,{type:"primary",loading:u,htmlType:"submit",icon:(0,o.tZ)(ii.Z,{}),children:"Run"})})]}),y&&(0,o.tZ)(j.Z,{size:"small",title:"Post-processing",extra:y.filter,children:(0,o.tZ)(i1,{simulation:t,postprocessing:i,results:y.results,setResult:n})})]})]})}):null},i4={plugins:"Unable to load plugins",update:"Unable to update simulation"},i5=(e,t)=>{tH.Z.list().then(l=>{let i=i3(e,tR.Z,l);t(i)}).catch(e=>{(0,N.lt)(i4.plugins,e)})},i3=(e,t,l)=>{let i=t;return l.forEach(t=>{var l;(null==e?void 0:null===(l=e.authorizedplugins)||void 0===l?void 0:l.includes(t.key))&&"Model"===t.category&&(i=[...i,...t.models])}),i},i8=e=>{let{visible:t,user:l,onOk:i,onCancel:n}=e,[a,r]=(0,c.useState)(),[s,d]=(0,c.useState)(!1),[u,m]=(0,c.useState)([]),[y,Z]=(0,c.useState)(),[v,g]=(0,c.useState)();(0,B.Z)(()=>{l&&i5(l,m)},[l]),(0,B.Z)(()=>{let e=u.map(e=>e.category).filter((e,t,l)=>l.indexOf(e)===t).map(e=>({key:e,value:e}));Z(e)},[u]);let f=(0,c.useCallback)(e=>{let{key:t}=e,l=u.find(e=>e.algorithm===t);r(tI.Z.deepCopy(l))},[u]),b=(0,c.useCallback)(e=>{let{key:t}=e,i=l.models.find(e=>e.algorithm===t);r(tI.Z.deepCopy(i))},[l]),w=(0,c.useCallback)(async()=>{if(d(!0),a)try{await i(a)}catch(e){}d(!1)},[a,i]),C=(0,c.useMemo)(()=>{let e=[{key:"category",disabled:!0,label:(0,o.tZ)(tT.Z,{css:eo.KP.fullWidth,options:y,allowClear:!0,showArrow:!1,placeholder:"Category filter",onChange:g})}];return u.forEach(t=>{v&&t.category!==v||e.push({key:t.algorithm,label:t.name})}),e},[u,y,v]),k=(0,c.useMemo)(()=>{let e=[{key:"category",disabled:!0,label:(0,o.tZ)(tT.Z,{css:eo.KP.fullWidth,options:y,allowClear:!0,showArrow:!1,placeholder:"Category filter",onChange:g})}];return null==l||l.models.forEach(t=>{v&&t.category!==v||e.push({key:t.algorithm,label:t.name})}),e},[l,y,v]);return(0,o.tZ)(tX.Z,{open:t,title:"Create simulation",okText:"Create",okButtonProps:{loading:s},onOk:w,onCancel:n,width:"80%",children:(0,o.BX)(h.Z,{children:[(0,o.tZ)(h.Z.Sider,{theme:"light",width:300,children:(0,o.tZ)(tL.Z,{items:[{key:"tanatloc",label:"Tanatloc algorithm",children:(0,o.tZ)(p.Z,{mode:"inline",items:C,onSelect:f})},{key:"personal",label:"User algorithm",children:(0,o.tZ)(p.Z,{mode:"inline",items:k,onSelect:b})}]})}),(0,o.tZ)(h.Z.Content,{css:t3.selector,children:(0,o.tZ)(en.Z.Html,{html:null==a?void 0:a.description})})]})})},i6=async(e,t,l)=>{try{let i=t.find(t=>{var l;return t.algorithm===(null==e?void 0:null===(l=e.scheme)||void 0===l?void 0:l.algorithm)}),n=tI.Z.deepCopy(e);(0,tN.merge)(n.scheme,i),await Y.Z.update({id:e.id},[{key:"scheme",value:n.scheme}]),l.mutateOneSimulation(n)}catch(e){(0,N.lt)(i4.update,e)}},i7=e=>{let{user:t,simulation:l,swr:i}=e,[n,a]=(0,c.useState)([]);return(0,B.Z)(()=>{t&&i5(t,a)},[t]),(0,B.Z)(()=>{let e=n.find(e=>{var t;return e.algorithm===(null==l?void 0:null===(t=l.scheme)||void 0===t?void 0:t.algorithm)});if(e&&(null==l?void 0:l.scheme)){let t=(0,tA.Z)(l.scheme,e),a=(0,tz.Z)(l.scheme,e);(Object.keys(t).length||Object.keys(a).length)&&(tX.Z.info({title:"Update",content:"Your model need an update, please wait.",closable:!1,okButtonProps:{hidden:!0}}),i6(l,n,i).finally(()=>tX.Z.destroyAll()))}},[l,n,i]),null};var i9={Selector:i8,Updater:i7,About:t$,Geometry:t9,Materials:lE,Parameters:lH,Initialization:l_,BoundaryConditions:it,Run:iF,Postprocessing:i2};let ne={sider:(0,M.iv)({height:"100vh",overflow:"hidden","& .ant-layout-sider-children":{height:"100vh",overflow:"hidden",borderRight:"1px solid "+eo.Rl.colorPrimary}}),menu1:(0,M.iv)({maxHeight:"calc(100vh - 195px)",overflow:"auto",overflowX:"hidden","& .ant-menu-item-divider":{border:"1px solid "+eo.Rl.colorPrimary,margin:"0 30px !important"},"& .Menu-title":{marginTop:"10px !important",lineHeight:"1.5em !important",cursor:"unset",whiteSpace:"normal",height:"4em"}}),menuScroll:(0,M.iv)({maxHeight:"calc(100vh - 200px)",overflow:"auto",overflowX:"hidden"}),menu2:(0,M.iv)({"& .SubMenu":{"& > div":{backgroundColor:"#f5f5f5",border:"1px solid #d9d9d9"},ul:{backgroundColor:"white !important",li:{paddingLeft:"24px !important","> div":{paddingLeft:"0 !important"},".ant-menu-title-content":{"> div":{display:"flex",justifyContent:"space-between"}},ul:{li:{paddingLeft:"24px !important",position:"relative !important",overflow:"visible !important",":not(:last-child)::before":{position:"absolute",content:'""',border:"1px solid #d9d9d9",backgroundColor:"#d9d9d9",height:"18px",width:"0px",top:"33px",left:"30px",zIndex:100}}}}},"& .display-none":{display:"none"}},button:{width:"100%"}})},nt=d()(()=>Promise.all([l.e(7521),l.e(70),l.e(1938)]).then(l.bind(l,61938)),{loadableGenerated:{webpack:()=>[61938]},ssr:!1}),nl={dashboard:{key:"dashboard"},geometries:{label:"GEOMETRIES",key:"geometries"},simulations:{label:"SIMULATIONS",key:"simulations"}},ni={user:"Unable to get user",project:"Unable to get project",simulations:"Unable to get simulations",geometries:"Unable to get geometries",add:"Unable to add simulation"},nn=async(e,t,l)=>{try{let i=await Y.Z.add({id:e.id},{name:t.name,scheme:t});l.addOneSimulation(i),l.mutateProject({id:e.id,simulations:[...e.simulations||[],i.id]})}catch(e){throw(0,N.lt)(ni.add,e),e}},na=e=>{let{visible:t,geometry:l,panel:i,add:n,del:a,close:r}=e,s=(0,c.useCallback)(e=>{var t,n,o;e.stopPropagation(),(null==i?void 0:null===(t=i.props)||void 0===t?void 0:null===(n=t.children)||void 0===n?void 0:null===(o=n.type)||void 0===o?void 0:o.componentName)===eC.componentName&&r(),a(l)},[l,i,a,r]),d=(0,c.useCallback)(e=>{e.stopPropagation(),n(l)},[l,n]);return(0,o.BX)("div",{children:[l.name,t?(0,o.tZ)(v.Z,{onClick:s}):(0,o.tZ)(g.Z,{onClick:d})]})},nr=e=>{let{simulation:t}=e;return t.scheme.user?(0,o.BX)(o.HY,{children:[(0,o.tZ)(m.Z,{title:"User algorithm",placement:"right",children:(0,o.tZ)(f.Z,{style:{position:"absolute",top:0,left:14,fontSize:14,color:"#fad114"}})}),t.name]}):(0,o.tZ)(o.HY,{children:t.name})},no=()=>{let e=(0,u.useRouter)(),{page:t,workspaceId:l,projectId:i}=e.query,[n,a]=(0,c.useState)(!1),[r,s]=(0,c.useState)([]),[d,m]=(0,c.useState)(!1),[v,g]=(0,c.useState)(),[f,j]=(0,c.useState)(),[T,X]=(0,c.useState)(),[L,R]=(0,c.useState)(),[I,H]=(0,c.useState)(),[D,V]=(0,c.useState)(!0),[F,{errorUser:G,loadingUser:J}]=U.Z.useUser(),[_,{mutateProject:q,errorProject:$,loadingProject:Q}]=W.Z.useProject(i),[et,{addOneSimulation:el,delOneSimulation:en,mutateOneSimulation:ea,errorSimulations:er,loadingSimulations:es}]=Y.Z.useSimulations(null==_?void 0:_.simulations),[ed,{addOneGeometry:eu,delOneGeometry:ec,mutateOneGeometry:em,errorGeometries:eh,loadingGeometries:ep}]=ee.useGeometries(null==_?void 0:_.geometries),ey=(0,c.useCallback)(()=>a(!0),[]),eZ=(0,c.useCallback)(()=>m(!0),[]),ev=(0,c.useCallback)(()=>m(!1),[]),eg=(0,c.useCallback)(e=>{s(t=>[...t,e])},[]),ef=(0,c.useCallback)(e=>{let t=r.findIndex(t=>t.id===e.id);-1!==t&&s(e=>[...e.slice(0,t),...e.slice(t+1)])},[r]),eb=(0,c.useCallback)(()=>{H(void 0),R(void 0)},[]),ew=(0,c.useCallback)(e=>{let t=ed.findIndex(t=>t.id===e);-1!==t&&s(e=>[...e.slice(0,t),{id:"0",needCleanup:!0},...e.slice(t+1)])},[ed]),ek=(0,c.useCallback)(e=>{let t=ed.find(t=>t.id===e);if(!t)return;let l=r.find(t=>t.id===e);l||s(e=>[...e,{...t,visible:!0}]),H((0,o.tZ)(ei,{visible:!0,title:"Geometry",onClose:eb,children:(0,o.tZ)(eC,{project:{id:_.id,geometries:_.geometries},geometry:{id:t.id,name:t.name,summary:t.summary},swr:{mutateProject:q,mutateOneGeometry:em,delOneGeometry:ec},close:eb,onCleanup:ew})}))},[_,ed,r,q,em,ec,ew,eb]),ex=(0,c.useCallback)(e=>{H((0,o.tZ)(ei,{visible:!0,title:"About",onClose:eb,children:(0,o.tZ)(i9.About,{project:{id:_.id,simulations:_.simulations},simulation:{id:e.id,name:e.name,scheme:e.scheme},swr:{mutateProject:q,addOneSimulation:el,delOneSimulation:en,mutateOneSimulation:ea}})}))},[_,q,el,en,ea,eb]),eP=(0,c.useCallback)(e=>{H((0,o.tZ)(ei,{visible:!0,title:"Geometry",onClose:eb,children:(0,o.tZ)(i9.Geometry,{loadedGeometries:ed,geometries:r.map(e=>({id:e.id,summary:e.summary})),simulation:{id:e.id,scheme:e.scheme},setGeometries:s,swr:{mutateOneSimulation:ea}})}))},[ed,r,ea,eb]),eS=(0,c.useCallback)(e=>{H((0,o.tZ)(ei,{visible:!0,title:"Parameters",onClose:eb,children:(0,o.tZ)(i9.Parameters,{simulation:{id:e.id,scheme:e.scheme},swr:{mutateOneSimulation:ea}})}))},[ea,eb]),eE=(0,c.useCallback)(e=>{H((0,o.tZ)(ei,{visible:D,title:"Materials",onClose:eb,children:(0,o.tZ)(i9.Materials,{geometries:r.map(e=>({id:e.id,name:e.name,summary:e.summary})),simulation:{id:e.id,scheme:e.scheme},swr:{mutateOneSimulation:ea},setVisible:V})}))},[r,D,ea,eb]),eM=(0,c.useCallback)(e=>{H((0,o.tZ)(ei,{visible:!0,title:"Initialization",onClose:eb,children:(0,o.tZ)(i9.Initialization,{simulations:et,simulation:e,swr:{mutateOneSimulation:ea}})}))},[et,ea,eb]),eB=(0,c.useCallback)(e=>{H((0,o.tZ)(ei,{visible:D,title:"Boundary conditions",onClose:eb,children:(0,o.tZ)(i9.BoundaryConditions,{geometries:r.map(e=>({id:e.id,name:e.name,summary:e.summary})),simulation:{id:e.id,scheme:e.scheme},swr:{mutateOneSimulation:ea},setVisible:V})}))},[r,D,ea,eb]),eO=(0,c.useCallback)(e=>{H((0,o.tZ)(ei,{visible:D,title:"Run",onClose:eb,children:(0,o.tZ)(i9.Run,{geometries:r,simulation:{id:e.id,scheme:e.scheme},result:f&&{name:f.name,fileName:f.fileName},setResult:j,setPostprocessing:X,setVisible:V,swr:{mutateOneSimulation:ea}})}))},[r,f,D,ea,eb]),ej=(0,c.useCallback)((e,t)=>{var l,i,n,a,r,o;let d=et.find(t=>t.id===e);if(!d)return;g(d);let u=null===(l=d.scheme)||void 0===l?void 0:null===(i=l.configuration)||void 0===i?void 0:null===(n=i.geometry)||void 0===n?void 0:n.value,c=null===(a=d.scheme)||void 0===a?void 0:null===(r=a.configuration)||void 0===r?void 0:null===(o=r.geometry)||void 0===o?void 0:o.values;if(u){let e=ed.find(e=>e.id===u);e&&s([e])}else if(c){let e=ed.filter(e=>c.includes(e.id));s(e)}switch(t){case"about":ex(d);break;case"geometry":eP(d);break;case"parameters":eS(d);break;case"materials":eE(d);break;case"initialization":eM(d);break;case"boundaryConditions":eB(d);break;case"run":eO(d);break;default:H(void 0)}},[ed,et,ex,eP,eS,eE,eM,eB,eO]),eT=(0,c.useCallback)(()=>e.push({pathname:"/dashboard",query:{page:t,workspaceId:l}}),[e,t,l]),eX=(0,c.useCallback)(e=>{let t,{keyPath:l}=e,i=l.pop(),n=l.pop(),a=l.pop();a&&(t=a.split("&").pop()),R({key:i,id:n,item:t})},[]),eL=(0,c.useCallback)(async e=>{try{await nn(_,e,{addOneSimulation:el,mutateProject:q}),m(!1)}catch(e){}},[_,el,q]),eA=(0,c.useCallback)(e=>{if(ep)return!0;let t=e.value,l=e.values,i=e.multiple,n=e.n;return(!t||!!ed.filter(e=>e.id===t).length)&&(!i||!l||(n?ed.filter(e=>l.includes(e.id)).length===e.n:!!ed.filter(e=>l.includes(e.id)).length))&&(!!t||!!l)||(e.done=!1,!1)},[ed,ep]);(0,c.useEffect)(()=>{J||F||e.replace("/login")},[F,J,e]),(0,c.useEffect)(()=>{G&&(0,N.lt)(ni.user,G),$&&(0,N.lt)(ni.project,$),er&&(0,N.lt)(ni.simulations,er),eh&&(0,N.lt)(ni.geometries,eh)},[G,$,er,eh]),(0,B.Z)(()=>{Q||ep?a(!1):ed.length?a(!1):a(!0)},[Q,ep,ed]),(0,B.Z)(()=>{if(!ep){if(r.length){let e=!1,t=r.map(t=>{let l=ed.find(e=>e.id===(null==t?void 0:t.id));return l?JSON.stringify({...l,visible:void 0})!==JSON.stringify({...t,visible:void 0})?(e=!0,l):t:(e=!0,null)}).filter(e=>e);e&&s(t)}else s(ed[0]?[ed[0]]:[])}},[ep,ed,r],[s]),(0,B.Z)(()=>{if(!es&&v){let e=et.find(e=>e.id===(null==v?void 0:v.id));e?JSON.stringify(e)!==JSON.stringify(v)&&(g(e),L&&L.key===nl.simulations.key&&ej(L.id,L.item)):(eb(),g(void 0))}},[et,es,v,L],[g,eb]),(0,B.Z)(()=>{L&&(L.key===nl.geometries.key?ek(L.id):(ej(L.id,L.item),"run"!==L.item&&(j(void 0),X(void 0))))},[L,D,f],[ek,ej,eb]),(0,c.useEffect)(()=>{!f&&T&&X(void 0)},[f,T]);let ez=(0,c.useMemo)(()=>ed.map(e=>{let t=r.find(t=>t.id===e.id);return{key:e.id,icon:(0,o.tZ)(b.Z,{}),label:(0,o.tZ)(na,{visible:!!t,geometry:e,panel:I,add:eg,del:ef,close:eb})}}),[ed,r,I,eg,ef,eb]),eN=(0,c.useMemo)(()=>et.map(e=>{let t=e.scheme.configuration||{},l=[];return Object.keys(t).forEach(i=>{if("dimension"===i)return;let n=t[i],a=(0,o.tZ)(w.Z,{style:{color:"green"}});n.error?a=(0,o.tZ)(C.Z,{style:{color:"red"}}):n.done||(a=(0,o.tZ)(k.Z,{style:{color:"orange"}})),"geometry"!==i||eA(n)||(a=(0,o.tZ)(k.Z,{style:{color:"orange"}})),l[n.index]={key:e.id+"&"+i,disabled:!r.length,icon:a,label:n.title}}),{key:e.id,icon:(0,o.tZ)(x.Z,{}),label:(0,o.tZ)(nr,{simulation:e}),children:[{key:e.id+"&about",disabled:!r.length,icon:(0,o.tZ)(w.Z,{style:{color:"green"}}),label:"About"},...l]}}),[r,et,eA]);return!F||J||Q?(0,o.tZ)(O.Z.Simple,{}):"0"===_.id?(0,o.tZ)(A,{}):(0,o.tZ)(K,{children:(0,o.BX)(h.Z,{hasSider:!0,children:[(0,o.BX)(h.Z.Sider,{theme:"light",css:ne.sider,width:256,children:[(0,o.tZ)("div",{css:eo.KP.logo,children:(0,o.tZ)("img",{src:"/images/logo.svg",alt:"Tanatloc"})}),(0,o.tZ)(p.Z,{css:ne.menu1,mode:"inline",items:[{key:"menu-go-back",disabled:!0,style:{cursor:"unset",margin:"10px 0",paddingLeft:10},label:(0,o.tZ)(z.ks,{buttonCss:eo.KP.fullWidth,onClick:eT,children:"Return to dashboard"})},{type:"divider"},{key:"title",disabled:!0,className:"Menu-title",label:(0,o.tZ)(y.Z.Paragraph,{ellipsis:{tooltip:!0,rows:2},children:_.title})}]}),(0,o.tZ)("div",{css:ne.menuScroll,children:(0,o.tZ)(p.Z,{mode:"inline",css:ne.menu2,defaultOpenKeys:[nl.geometries.key,nl.simulations.key],items:[{key:nl.geometries.key,className:"SubMenu",icon:ep?(0,o.tZ)(P.Z,{}):(0,o.tZ)(b.Z,{}),label:(0,o.BX)(y.Z.Text,{strong:!0,children:[nl.geometries.label," (",ed.length,")"]}),children:[{key:"new_geometry",disabled:!0,label:(0,o.tZ)(Z.ZP,{icon:(0,o.tZ)(S.Z,{}),onClick:ey,children:"New Geometry"})},{key:"geometry-needed",disabled:!0,className:r.length?"display-none":"",icon:(0,o.tZ)(k.Z,{style:{color:"red"}}),label:"A Geometry is needed"},...ez]},{key:nl.simulations.key,className:"SubMenu",icon:es?(0,o.tZ)(P.Z,{}):(0,o.tZ)(x.Z,{}),label:(0,o.BX)(y.Z.Text,{strong:!0,children:[nl.simulations.label," (",et.length,")"]}),children:[{key:"new_simulation",disabled:!0,label:(0,o.tZ)(Z.ZP,{disabled:!ed.length,icon:(0,o.tZ)(E.Z,{}),onClick:eZ,children:"New Simulation"})},...eN]}],onClick:eX})})]}),(0,o.BX)(h.Z.Content,{css:(0,M.iv)([eo.KP.noScroll,{position:"relative"}]),children:[(0,o.tZ)(eC.Add,{visible:n,project:{id:_.id,geometries:_.geometries},swr:{mutateProject:q,addOneGeometry:eu},setVisible:a}),(0,o.tZ)(i9.Selector,{user:{authorizedplugins:F.authorizedplugins,models:F.models},visible:d,onOk:eL,onCancel:ev}),(0,o.tZ)(i9.Updater,{user:{authorizedplugins:F.authorizedplugins},simulation:v&&{id:v.id,scheme:v.scheme},swr:{mutateOneSimulation:ea}}),I,(0,o.tZ)(tj,{project:{id:_.id,title:_.title},simulation:v&&{id:v.id},geometries:r.map(e=>({id:e.id,needCleanup:e.needCleanup})),result:f&&{glb:f.glb,originPath:f.originPath},postprocessing:T&&{glb:T.glb,originPath:T.originPath}}),(0,o.tZ)(nt,{simulation:v&&{id:v.id,name:v.name}}),(0,o.tZ)(i9.Postprocessing,{simulation:v&&{id:v.id,scheme:v.scheme},result:f&&{name:f.name,fileName:f.fileName,originPath:f.originPath},postprocessing:T&&{name:T.name,fileName:T.fileName},setResult:X})]})]})})};var ns=no},64546:function(e,t,l){var i={"./local/src/components":[94295,4295]};function n(e){if(!l.o(i,e))return Promise.resolve().then(function(){var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t});var t=i[e],n=t[0];return l.e(t[1]).then(function(){return l(n)})}n.keys=function(){return Object.keys(i)},n.id=64546,e.exports=n}}]);