(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4285],{5094:function(e,t,l){"use strict";l.d(t,{Z:function(){return a}});var i=l(11425);let n=async(e,t)=>{let l=await (0,i.R)("/api/avatar",{method:"POST",headers:{Accept:"application/json"},body:JSON.stringify({file:e,project:t})});return l.json()};var a={add:n}},71270:function(e,t,l){"use strict";l.d(t,{Z:function(){return u}});var i=l(11425);let n=async e=>{await (0,i.R)("/api/plugin",{method:"POST",body:JSON.stringify(e)})},a=async e=>{await (0,i.R)("/api/plugin",{method:"PUT",body:JSON.stringify(e)})},r=async e=>{await (0,i.R)("/api/plugin",{method:"DELETE",body:JSON.stringify(e)})};var o=l(59734),d=l(67294);let s=()=>{let{data:e,error:t,mutate:l}=(0,o.ZP)("/api/plugin",i._),n=(null==e?void 0:e.plugins)||[],a=(0,d.useCallback)(e=>{let t=[...n,e];l({plugins:t})},[n,l]),r=(0,d.useCallback)(e=>{let t=n.filter(t=>t.key!==e.key);l({plugins:t})},[n,l]),s=(0,d.useCallback)(e=>{let t=n.map(t=>(t.key===e.key&&(t={...t,...e}),t));l({plugins:t})},[n,l]);return[n,{mutatePlugins:l,addOnePlugin:a,delOnePlugin:r,mutateOnePlugin:s,errorPlugins:t,loadingPlugins:!e}]};var u={add:n,update:a,del:r,usePlugins:s}},10843:function(e,t,l){"use strict";l.d(t,{Z:function(){return r}});var i=l(11425);let n=async()=>{let e=await (0,i.R)("/api/plugins",{method:"GET",headers:{Accept:"application/json"}});return e.json()},a=async()=>{let e=await (0,i.R)("/api/plugins",{method:"POST",headers:{Accept:"application/json"}});return e.json()};var r={list:n,completeList:a}},26791:function(e,t,l){"use strict";l.d(t,{Z:function(){return y}});var i=l(59734),n=l(67294),a=l(11425);let r=e=>{let{data:t,error:l,mutate:r}=(0,i.ZP)(["/api/projects",JSON.stringify({ids:e})],e=>{let[t,l]=e;return(0,a._)(t,l)}),o=(null==t?void 0:t.projects)||[],d=(0,n.useCallback)(e=>{let t=[...o,{...e,users:[],geometries:[],simulations:[],groups:[]}];r({projects:t})},[o,r]),s=(0,n.useCallback)(e=>{let t=o.filter(t=>t.id!==e.id);r({projects:t})},[o,r]),u=(0,n.useCallback)(e=>{let t=o.map(t=>(t.id===e.id&&(t={...t,...e}),t));r({projects:t})},[o,r]);return[o,{addOneProject:d,delOneProject:s,mutateOneProject:u,errorProjects:l,loadingProjects:!t}]},o=e=>{let{data:t,error:l,mutate:r}=(0,i.ZP)("/api/project"+(e?"/"+e:""),a._),o=(null==t?void 0:t.project)||{id:"0"},d=(0,n.useCallback)(e=>{let t={...o,...e};r({project:t})},[o,r]);return[o,{mutateProject:d,errorProject:l,loadingProject:!t}]},d=async(e,t)=>{let l=await (0,a.R)("/api/project",{method:"POST",headers:{Accept:"application/json"},body:JSON.stringify({workspace:{id:e.id},project:t})});return l.json()},s=async(e,t)=>{await (0,a.R)("/api/project/"+e.id,{method:"PUT",body:JSON.stringify(t)})},u=async(e,t)=>{await (0,a.R)("/api/project/"+t.id,{method:"DELETE",body:JSON.stringify({id:e.id})})},c=async e=>(0,a.R)("/api/project/"+e.id+"/archive",{method:"GET",headers:{Accept:"application/json"}}),m=async e=>(0,a.R)("/api/project/"+e.id+"/archive",{method:"PUT"}),h=async e=>(0,a.R)("/api/project/"+e.id+"/archive",{method:"DELETE"}),p=async(e,t)=>(0,a.R)("/api/project/"+e.id+"/archive",{method:"POST",body:JSON.stringify({archive:t})});var y={useProjects:r,useProject:o,add:d,update:s,del:u,archive:c,unarchiveFromServer:m,deleteArchiveFile:h,unarchiveFromFile:p}},23853:function(e,t,l){"use strict";l.d(t,{Z:function(){return y}});var i=l(59734),n=l(67294),a=l(11425);let r=e=>{let{data:t,error:l,mutate:r}=(0,i.ZP)(["/api/simulations",JSON.stringify({ids:e})],e=>{let[t,l]=e;return(0,a._)(t,l)}),o=(null==t?void 0:t.simulations)||[],d=(0,n.useCallback)(e=>{let t=[...o,e];r({simulations:t})},[o,r]),s=(0,n.useCallback)(e=>{let t=o.filter(t=>t.id!==e.id);r({simulations:t})},[o,r]),u=(0,n.useCallback)((e,t)=>{let l=o.map(t=>(t.id===e.id&&(t={...t,...e}),t));r({simulations:l},t)},[o,r]);return[o,{addOneSimulation:d,delOneSimulation:s,mutateOneSimulation:u,errorSimulations:l,loadingSimulations:!t}]},o=(e,t)=>{let{data:l,error:r,mutate:o}=(0,i.ZP)("/api/simulation"+(e?"/"+e:""),a._,{refreshInterval:t||0}),d=(null==l?void 0:l.simulation)||{id:"0"},s=(0,n.useCallback)(e=>{o({simulation:{...d,...e}})},[d,o]);return[d,{mutateSimulation:s,errorSimulation:r,loadingSimulation:!l}]},d=async(e,t)=>{let l=await (0,a.R)("/api/simulation",{method:"POST",headers:{Accept:"application/json"},body:JSON.stringify({project:{id:e.id},simulation:t})});return l.json()},s=async(e,t)=>{await (0,a.R)("/api/simulation/"+e.id,{method:"PUT",body:JSON.stringify(t)})},u=async e=>{await (0,a.R)("/api/simulation/"+e.id,{method:"DELETE"})},c=async e=>{await (0,a.R)("/api/simulation/"+e.id+"/run",{method:"GET"})},m=async e=>{await (0,a.R)("/api/simulation/"+e.id+"/stop",{method:"GET"})},h=async e=>{let t=await (0,a.R)("/api/simulation/"+e.id+"/tasks",{method:"GET",headers:{Accept:"application/json"}});return t.json()},p=async(e,t)=>{let l=await (0,a.R)("/api/simulation/"+e.id+"/log",{method:"POST",body:JSON.stringify({file:t})});return l.json()};var y={useSimulations:r,useSimulation:o,add:d,update:s,del:u,run:c,stop:m,tasks:h,log:p}},44285:function(e,t,l){"use strict";let i;l.d(t,{ZP:function(){return i$}});var n,a,r,o=l(14288),d=l(5152),s=l.n(d),u=l(11163),c=l(67294),m=l(83062),h=l(97183),p=l(68508),y=l(25625),v=l(71577),Z=l(99611),f=l(90420),g=l(73480),b=l(48869),w=l(8751),C=l(18429),x=l(11475),k=l(22844),S=l(50888),P=l(88484),E=l(64789),O=l(70917),B=l(12935),j=l(67641),T=l(85813),M=l(26713),X=l(20280);let z={notAllowed:"You are not allowed to be here."},L=()=>{let e=(0,u.useRouter)();(0,c.useEffect)(()=>{e.prefetch("/")},[e]);let t=(0,c.useCallback)(()=>e.push("/"),[e]);return(0,o.tZ)(h.Z,{children:(0,o.tZ)(h.Z.Content,{children:(0,o.tZ)(T.Z,{title:"Not allowed",children:(0,o.BX)(M.Z,{direction:"vertical",children:[(0,o.BX)(y.Z.Text,{children:[(0,o.tZ)(X.Z,{style:{color:"red"}})," ",z.notAllowed]}),(0,o.BX)(y.Z.Text,{children:["Go back"," ",(0,o.tZ)(v.Z,{type:"link",onClick:t,children:"home"})]})]})})})})};var N=l(18436),A=l(12271);let R={enabled:!1,type:void 0,part:void 0,highlighted:void 0,selected:[],point:void 0,dispatch:()=>void 0},I={ENABLE:"ENABLE",DISABLE:"DISABLE",CLEAR:"CLEAR",SETTYPE:"SETTYPE",SETPART:"SETPART",HIGHLIGHT:"HIGHLIGHT",UNHIGHLIGHT:"UNHIGHLIGHT",SELECT:"SELECT",UNSELECT:"UNSELECT",SETPOINT:"SETPOINT"},H=(0,c.createContext)(R),D=(e,t)=>{let l;switch(t.type){case I.ENABLE:return{...e,enabled:!0};case I.DISABLE:return{...e,enabled:!1,highlighted:void 0,selected:[]};case I.CLEAR:return{...R};case I.SETTYPE:return{...e,type:t.value};case I.SETPART:return{...e,part:t.value};case I.HIGHLIGHT:return{...e,highlighted:t.value};case I.UNHIGHLIGHT:return{...e,highlighted:void 0};case I.SELECT:if(-1===(l=e.selected.findIndex(e=>e.uuid===t.value.uuid)))return{...e,selected:[...e.selected,t.value]};return e;case I.UNSELECT:if(-1===(l=e.selected.findIndex(e=>e.uuid===t.value.uuid)))return e;return{...e,selected:[...e.selected.slice(0,l),...e.selected.slice(l+1)]};case I.SETPOINT:return{...e,point:t.value};default:return e}},K=e=>{let{children:t}=e,[l,i]=(0,c.useReducer)(D,R);return(0,o.tZ)(H.Provider,{value:{...l,dispatch:i},children:t})};var U=l(55734),W=l(26791),Y=l(23853),V=l(59734),F=l(11425);let G=e=>{let{data:t,error:l,mutate:i}=(0,V.ZP)(["/api/geometries",JSON.stringify({ids:e})],e=>{let[t,l]=e;return(0,F._)(t,l)}),n=(null==t?void 0:t.geometries)||[],a=(0,c.useCallback)(e=>{let t=[...n,e];i({geometries:t})},[n,i]),r=(0,c.useCallback)(e=>{let t=n.filter(t=>t.id!==e.id);i({geometries:t})},[n,i]),o=(0,c.useCallback)(e=>{let t=n.map(t=>(t.id===e.id&&(t={...t,...e}),t));i({geometries:t})},[n,i]);return[n,{addOneGeometry:a,delOneGeometry:r,mutateOneGeometry:o,errorGeometries:l,loadingGeometries:!t}]},J=async(e,t)=>{let l=await (0,F.R)("/api/geometry",{method:"POST",body:JSON.stringify({project:e,geometry:t})});return l.json()},q=async(e,t)=>{await (0,F.R)("/api/geometry/"+e.id,{method:"PUT",body:JSON.stringify(t)})},_=async e=>{await (0,F.R)("/api/geometry/"+e.id,{method:"DELETE"})},Q=async e=>{let t=await (0,F.R)("/api/geometry/"+e.id+"/download");return t.json()},$=async e=>{let t=await (0,F.R)("/api/geometry/"+e.id+"/part");return t.json()};var ee={useGeometries:G,add:J,update:q,del:_,download:Q,getPart:$},et=l(97937);let el={panel:(0,O.iv)({position:"absolute",top:0,left:"-1px",width:"256px",maxHeight:"100vh",zIndex:100,overflow:"hidden",img:{maxWidth:"80%"},"& > .ant-card-body":{maxHeight:"calc(100vh - 65px)",overflow:"auto",padding:0},"& .ant-card-head":{height:"48px",fontSize:"20px",fontWeight:"bold",padding:"0 12px",border:"none",".ant-btn":{border:"none"}},"& .ant-card":{border:"none"},"& .ant-collapse":{border:"none"},"& .ant-collapse-item":{border:"none"},"& .ant-collapse-content-box":{padding:"0 !important",backgroundColor:"#fafafa",".ant-card-head":{backgroundColor:"#fafafa"},".ant-card-body":{backgroundColor:"#fafafa"}}}),subPanel:(0,O.iv)({"& .ant-card":{border:"none",borderBottom:"1px solid #f0f0f0"},"& .ant-card-body":{paddingRight:"0",paddingLeft:"0"},"& .ant-radio-group":{display:"flex",flexWrap:"wrap",gap:"10px"}})},ei=e=>{let{visible:t,title:l,children:i,onClose:n}=e;return(0,o.tZ)(T.Z,{css:(0,O.iv)([el.panel,{display:t?"block":"none"}]),title:l,extra:(0,o.tZ)(v.Z,{type:"text",icon:(0,o.tZ)(et.Z,{}),onClick:n}),children:i})};var en=l(35083),ea=l(31365),er=l(28345),eo=l(86159),ed=l(48764).lW;let es={add:"Unable to add geometry"},eu=e=>e.name.toLowerCase().includes(".stp")||e.name.toLowerCase().includes(".step")||e.name.toLowerCase().includes(".dxf"),ec=async e=>{let t=new FileReader;return new Promise(l=>{t.addEventListener("load",()=>{l(t.result)}),t.readAsArrayBuffer(e)})},em=async(e,t,l)=>{if("uploading"===t.file.status)return!0;if("done"===t.file.status){let i=await ec(t.file.originFileObj);try{let n=await ee.add({id:e.id},{name:t.file.name,uid:t.file.uid,buffer:ed.from(i)});l.addOneGeometry(n),l.mutateProject({id:e.id,geometries:[...e.geometries,n.id]})}catch(a){throw(0,A.lt)(es.add,a),a}}return!1},eh=e=>{let{visible:t,project:l,swr:i,setVisible:n}=e,[a,r]=(0,c.useState)(!1),d=(0,c.useCallback)(()=>n(!1),[n]),s=(0,c.useCallback)(async e=>{try{let t=await em(l,e,i);r(t),n(t)}catch(a){r(!1)}},[l,i,n]);return(0,o.tZ)(er.ZP,{title:"Upload geometry",visible:t,onCancel:d,cancelButtonProps:{loading:a},children:(0,o.BX)(M.Z,{direction:"vertical",css:eo.KP.fullWidth,children:[(0,o.tZ)(ea.Z,{css:(0,O.iv)({"& .ant-upload":{width:"100% !important",height:"100px !important"}}),action:"/api/noop",accept:".stp,.step,.dxf",showUploadList:!1,listType:"picture-card",beforeUpload:eu,onChange:s,children:(0,o.tZ)("div",{children:a?(0,o.BX)(o.HY,{children:[(0,o.tZ)(S.Z,{style:{fontSize:25}}),(0,o.BX)("div",{style:{marginTop:8},children:[(0,o.tZ)("b",{children:"Loading"}),", converting, ..."]})]}):(0,o.BX)(o.HY,{children:[(0,o.tZ)(P.Z,{style:{fontSize:25}}),(0,o.BX)("div",{style:{marginTop:8},children:[(0,o.tZ)("b",{children:"Choose a file"})," or drop it here"]})]})})}),(0,o.tZ)(y.Z.Text,{children:(0,o.tZ)("p",{style:{color:"rgba(0, 0, 0, 0.45)",textAlign:"center"},children:"Native file format preferred: STEP (3D) or DXF (2D) file"})})]})})};var ep=l(96108),ey=l(69677);let ev=e=>{let{visible:t,geometry:l,setVisible:i,onEdit:n}=e,a=(0,c.useRef)(null),[r,d]=(0,c.useState)(!1);(0,c.useEffect)(()=>{a.current&&a.current.focus()});let s=(0,c.useCallback)(()=>i(!1),[i]),u=(0,c.useCallback)(async e=>{d(!0);try{await n(e),d(!1),i(!1)}catch(t){throw d(!1),t}},[i,n]);return(0,o.tZ)(er.ZP,{title:"Edit the geometry's name",visible:t,initialValues:{name:l.name},onCancel:s,onOk:u,loading:r,children:(0,o.tZ)(ep.Z.Item,{name:"name",label:"Name:",rules:[{required:!0,message:"Name is required"}],children:(0,o.tZ)(ey.Z,{ref:a})})})};var eZ=l(48764).lW;let ef={download:"Unable to download geometry",update:"Unable to update geometry",del:"Unable to delete geometry"},eg=async e=>{try{let t=await ee.download({id:e.id}),l=new File([eZ.from(t.buffer).toString()],e.name+"."+t.extension),i=window.URL.createObjectURL(l),n=document.createElement("a");n.href=i,n.setAttribute("download",e.name+"."+t.extension),n.click(),n.remove()}catch(a){(0,A.lt)(ef.download,a)}},eb=async(e,t,l)=>{try{await ee.update({id:e.id},[{key:"name",value:t.name}]),e.name=t.name,l.mutateOneGeometry(e)}catch(i){throw(0,A.lt)(ef.update,i),i}},ew=async(e,t,l,i)=>{try{await ee.del({id:e.id});let n=t.geometries.filter(t=>t!==e.id);i.mutateProject({id:t.id,geometries:n}),i.delOneGeometry(e),l()}catch(a){throw(0,A.lt)(ef.del,a),a}},eC=e=>{var t,l,i,n,a,r;let{project:d,geometry:s,swr:u,close:m,onCleanup:p}=e,[v,Z]=(0,c.useState)(!1),[f,g]=(0,c.useState)(!1),[b,w]=(0,c.useState)(!1),C=(0,c.useCallback)(()=>g(!0),[]),x=(0,c.useCallback)(async()=>{Z(!0);try{await eg(s)}catch(e){}finally{Z(!1)}},[s]),k=(0,c.useCallback)(async e=>eb(s,e,u),[s,u]),S=(0,c.useCallback)(async()=>{w(!0);try{await ew(s,d,m,u),p(s.id)}finally{w(!1)}},[d,s,u,m,p]);return s?(0,o.tZ)(h.Z,{children:(0,o.tZ)(h.Z.Content,{children:(0,o.tZ)(T.Z,{size:"small",title:"Informations",actions:[(0,o.tZ)(N.o6,{loading:v,onDownload:x},"download"),(0,o.BX)("div",{children:[(0,o.tZ)(ev,{visible:f,geometry:{id:null==s?void 0:s.id,name:null==s?void 0:s.name},setVisible:g,onEdit:k}),(0,o.tZ)(N.w6,{onEdit:C})]},"edit"),(0,o.tZ)(N.m1,{loading:b,text:(0,o.BX)(o.HY,{children:["Are you sure you want to delete the geometry"," ",(0,o.tZ)(y.Z.Text,{strong:!0,children:s.name}),"?"]}),onDelete:S},"delete")],children:(0,o.BX)(M.Z,{direction:"vertical",css:eo.KP.fullWidth,children:[(0,o.BX)(y.Z.Text,{children:[(0,o.tZ)("span",{css:eo.KP.textLight,children:"File:"})," ",s.name," "]}),(0,o.BX)(y.Z.Text,{children:[(0,o.tZ)("span",{css:eo.KP.textLight,children:"Unit:"})," ",(0,o.tZ)(en.Z.Inline,{text:"m"})]}),(0,o.BX)(o.HY,{children:[3===s.summary.dimension&&(0,o.BX)(y.Z.Text,{children:[(0,o.tZ)("span",{css:eo.KP.textLight,children:"Number of solids:"})," ",null!==(n=null===(t=s.summary.solids)||void 0===t?void 0:t.length)&&void 0!==n?n:0]}),(0,o.BX)(y.Z.Text,{children:[(0,o.tZ)("span",{css:eo.KP.textLight,children:"Number of faces:"})," ",null!==(a=null===(l=s.summary.faces)||void 0===l?void 0:l.length)&&void 0!==a?a:0]}),2===s.summary.dimension&&(0,o.BX)(y.Z.Text,{children:[(0,o.tZ)("span",{css:eo.KP.textLight,children:"Number of edges:"})," ",null!==(r=null===(i=s.summary.edges)||void 0===i?void 0:i.length)&&void 0!==r?r:0]})]})]})})})}):(0,o.tZ)(j.Z.Simple,{})};eC.componentName="Geometry",eC.Add=eh;let ex=async(e,t)=>{let l=await (0,F.R)("/api/result",{method:"POST",headers:{Accept:"application/json"},body:JSON.stringify({simulation:e,result:t})});return l.json()},ek=async(e,t)=>(0,F.R)("/api/result/download",{method:"POST",body:JSON.stringify({simulation:e,result:t})}),eS=async e=>(0,F.R)("/api/result/archive",{method:"POST",body:JSON.stringify({simulation:e})});var eP={load:ex,download:ek,archive:eS},eE=l(71648),eO=l(20137),eB=l(72269),ej=l(57953),eT=l(41428),eM=l(38095),eX=l(86350),ez=l(15668),eL=l(35598),eN=l(74317),eA=l(49591),eR=l(19478),eI=l(87784),eH=l(75843),eD=l(15611),eK=l(99477),eU=l(57632),eW=l(79753),eY=l(54458),eV=l(58939),eF=l(24065),eG=l(54327);let eJ=e=>{let t=new eK.fHI(.025,.025,.8,50);t.translate(0,.4,0);let l=new eK.vBJ({color:e}),i=new eK.Kj0(t,l),n=new eK.b_z(.05,.2,50);n.translate(0,.9,0);let a=new eK.vBJ({color:e}),r=new eK.Kj0(n,a),o=new eK.ZAu;o.type="ArrowHelper",o.add(i),o.add(r);let d=()=>{t.dispose(),l.dispose(),n.dispose(),a.dispose()};return o.dispose=d,o},eq=(e,t,l)=>{let i=document.createElement("canvas");i.width=(null==l?void 0:l.width)||256,i.height=256;let n=i.getContext("2d");n.fillStyle="grey",n.font="50px sans-serif",n.textAlign=(null==l?void 0:l.align)||"center",n.textBaseline="middle",n.fillText(t,i.width/2,i.height/2);let a=new eK.xEZ(i);a.flipY=!0,a.needsUpdate=!0;let r=new eK.xeV({map:a,transparent:!0,depthWrite:!1});r.map.anisotropy=e.capabilities.getMaxAnisotropy();let o=new eK.jyi(r);o.type="LabelHelper",(null==l?void 0:l.position)&&o.position.copy(l.position),(null==l?void 0:l.scale)&&o.scale.setScalar(l.scale);let d=()=>{a.dispose(),r.dispose()};return o.dispose=d,o},e_=function(e,t){let{offsetWidth:l,offsetHeight:i,width:n,height:a}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{offsetWidth:0,offsetHeight:0,width:150,height:150},r=l,o=i,d=n,s=a,u=eJ("red");u.rotateZ(-Math.PI/2);let c=eq(e,"X",{position:new eK.Pa4(1.1,0,0)}),m=eJ("green"),h=eq(e,"Y",{position:new eK.Pa4(0,1.1,0)}),p=eJ("blue");p.rotateX(Math.PI/2);let y=eq(e,"Z",{position:new eK.Pa4(0,0,1.1)}),v=new eK.xo$(.05,50,50),Z=new eK.vBJ({color:"black"}),f=new eK.Kj0(v,Z),g=new eK.ZAu;g.type="AxisHelper",g.add(u),g.add(c),g.add(m),g.add(h),g.add(p),g.add(y),g.add(f);let b=new eK.xsS;b.add(g);let w=new eK.iKG(-1.2,1.2,1.2,-1.2,-2,2),C=e=>{let{newOffsetWidth:t,newOffsetHeight:l,newWidth:i,newHeight:n}=e;r=t,o=l,d=i,s=n},x=()=>{e.setViewport(r,o,d,s),w.rotation.copy(t.rotation),e.render(b,w)},k=()=>{v.dispose(),Z.dispose(),g.children.forEach(e=>{("ArrowHelper"===e.type||"LabelHelper"===e.type)&&e.dispose()}),b.remove(g)};return{dispose:k,render:x,resize:C}},eQ=function(e,t,l,i){let{offsetWidth:n,offsetHeight:a,width:r,height:o}=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{offsetWidth:0,offsetHeight:0,width:150,height:150},d="#d3d3d3",s=null,u=null,c=[{text:"FRONT",normal:new eK.Pa4(0,0,1),up:new eK.Pa4(0,1,0)},{text:"BACK",normal:new eK.Pa4(0,0,-1),up:new eK.Pa4(0,1,0)},{text:"RIGHT",normal:new eK.Pa4(1,0,0),up:new eK.Pa4(0,1,0)},{text:"LEFT",normal:new eK.Pa4(-1,0,0),up:new eK.Pa4(0,1,0)},{text:"UP",normal:new eK.Pa4(0,1,0),up:new eK.Pa4(0,0,-1)},{text:"DOWN",normal:new eK.Pa4(0,-1,0),up:new eK.Pa4(0,0,1)}],m=new eK._12(75,75),h=new eK.TOt(m),p=new eK.xo$(37.5,10,10,0,Math.PI,0),y=new eK.ZAu;c.forEach(e=>{let t=document.createElement("canvas"),l=t.getContext("2d");t.width=t.height=256,l.fillStyle=d,l.fillRect(0,0,t.width,t.height),l.font="bold 50pt sans-serif",l.fillStyle="#000000",l.textAlign="center",l.textBaseline="middle",l.fillText(e.text,t.width/2,t.height/2);let i=new eK.ROQ(t);i.needsUpdate=!0;let n=new eK.vBJ({map:i}),a=new eK.vBJ({color:d}),r=new eK.Kj0(m,n),o=new eK.Kj0(m,a);o.rotateY(Math.PI);let s=new eK.nls({color:"#ffffff"}),u=new eK.ejS(h,s),c=new eK.vBJ({color:d,transparent:!0,opacity:.2}),v=new eK.Kj0(p,c),Z=new eK.ZAu;Z.add(r,o,u,v),Z.lookAt(e.normal),Z.translateZ(50),Z.normal=e.normal,Z.up=e.up,y.add(Z)});let v=new eK.Mig("#ffffff",1),Z=new eK.xsS;Z.add(y),Z.add(v);let f=new eK.iKG(-100,100,100,-100,-100,100);f.position.z=2;let g=new eK.iMs,b=e=>{let t=w(e);C(t)?(s=x(t),k(),(null==s?void 0:s.uuid)!==(null==u?void 0:u.uuid)&&(S(),u=s)):(s=null,S())},w=e=>{let t=e.target,l=t.getBoundingClientRect(),i=e.clientX-l.left,d=e.clientY-l.top,s=new eK.FM8;return s.x=(i-n)/r*2-1,s.y=-(2*((d+o-l.height+a)/o))+1,s},C=e=>e.x>-1&&e.x<1&&e.y>-1&&e.y<1,x=e=>{let t=new eK.Pa4(e.x,e.y,-1);t.unproject(f);let l=new eK.Pa4;f.getWorldDirection(l),g.set(t,l);let i=g.intersectObjects(Z.children,!0);return i.length?i[0].object.parent:null},k=()=>{s&&s.children&&s.children.forEach(e=>{let t=e;t.material&&t.material.color&&(t.material.previousColor=t.material.color,t.material.color=new eK.Ilk("#FAD114"))})},S=()=>{u&&u.children&&u.children.forEach(e=>{let t=e;t.material&&t.material.color&&(t.material.color=new eK.Ilk(d))})},P=e=>{if(s){let n=s.normal,a=s.up,r=new eK.Pa4;t.boundingBox&&t.boundingBox.getCenter(r);let o=l.position.distanceTo(i.target),d=n.clone().multiplyScalar(o),u=r.add(d);l.position.copy(u),l.up.copy(a),s=null,S(),b(e)}};e.domElement.addEventListener("pointermove",b),e.domElement.addEventListener("pointerdown",P);let E=e=>{let{newOffsetWidth:t,newOffsetHeight:l,newWidth:i,newHeight:d}=e;n=t,a=l,r=i,o=d},O=()=>{e.setViewport(n,a,r,o),f.rotation.copy(l.rotation),e.render(Z,f)},B=()=>{e.domElement.removeEventListener("pointermove",b),e.domElement.removeEventListener("pointerdown",P),y.children.forEach(e=>{e.children.forEach(e=>{e.geometry.dispose(),e.material.dispose()})}),Z.remove(y)};return{resize:E,render:O,dispose:B}},e$=e=>1e-12>Math.abs(e)?"0":Math.abs(e)>1e3||.001>Math.abs(e)?e.toExponential(2):e.toFixed(3),e0=(e,t,l,i)=>{let n,a,r;let o=e=>{let t=Math.max(e.x,e.y,e.z),l=Math.max(Math.ceil(e.x/t*5),2),i=Math.max(Math.ceil(e.y/t*5),2),n=Math.max(Math.ceil(e.z/t*5),2);return new eK.Pa4(l,i,n)},d=(e,t,l,i,n)=>{let a=new eK.ZAu,r=new eK.nls({color:8947848}),o=new eK.Pa4(-e/2,0,-t/2),d=e/(l-1),s=t/(i-1);for(let u=0;u<i;++u){let c=new eK.u9r().setFromPoints([new eK.Pa4(o.x,0,o.z+u*s),new eK.Pa4(o.x+e,0,o.z+u*s)]);a.add(new eK.x12(c,r))}for(let m=0;m<l;++m){let h=new eK.u9r().setFromPoints([new eK.Pa4(o.x+m*d,0,o.z),new eK.Pa4(o.x+m*d,0,o.z+t)]);a.add(new eK.x12(h,r))}return null==n||n(a),a},s=(t,l,i,n)=>{let a=new eK.ZAu,r=Math.abs(l-t),o=r/(n-1),d=new eK.Pa4().copy(i).multiplyScalar(-r/2),s=new eK.Pa4().copy(i).multiplyScalar(o),u=t;for(let c=0;c<n;++c){let m=eq(e,e$(u));m.position.copy(d),a.add(m),d.add(s),u+=o}return a},u=()=>{let e=t.boundingBox,l=t.boundingSphere.center,i=new eK.Pa4(e.max.x-e.min.x,e.max.y-e.min.y,e.max.z-e.min.z),r=o(i);a=1*(n=.1*Math.max(i.x,i.y,i.z));let u=new eK.ZAu,c=d(i.x,i.z,r.x,r.z),m=d(i.x,i.y,r.x,r.y,e=>{e.rotateX(Math.PI/2)}),h=d(i.y,i.z,r.y,r.z,e=>{e.rotateZ(-Math.PI/2)});u.add(c,m,h);let p=s(e.min.x,e.max.x,new eK.Pa4(1,0,0),r.x),v=s(e.min.y,e.max.y,new eK.Pa4(0,1,0),r.y),Z=s(e.min.z,e.max.z,new eK.Pa4(0,0,1),r.z);return u.add(p,v,Z),u.position.set(l.x,l.y,l.z),u.type="GridHelper",u.dispose=y,u},c=e=>e<=0?-1:1,m=e=>.5>=Math.abs(e)?1:-1,h=()=>{let e=t.boundingBox,o=new eK.Pa4(e.max.x-e.min.x,e.max.y-e.min.y,e.max.z-e.min.z),d=!1;t.children.forEach(e=>{"GridHelper"===e.type&&(d=e.visible,t.remove(e),e.dispose())}),r=u();let s=i.object.position.distanceTo(i.target);r.traverse(e=>{"LabelHelper"===e.type&&e.scale.setScalar(.05*s)});let h=new eK.Pa4;l.getWorldDirection(h);let p=s/10/(i.minDistance+.001),y=r.children[0],v=r.children[1],Z=r.children[2];y.position.set(0,c(h.y)*(o.y/2+n),0),v.position.set(0,0,c(h.z)*(o.z/2+n)),Z.position.set(c(h.x)*(o.x/2+n),0,0);let f=r.children[3],g=r.children[4],b=r.children[5];f.position.set(0,c(h.y)*m(h.y)*(o.y/2+a),-(c(h.z)*m(h.y)*(o.z/2+a))),g.position.set(c(h.x)*m(h.x)*(o.x/2+a),0,-(c(h.z)*m(h.x)*(o.z/2+a))),b.position.set(c(h.x)*m(h.x)*(o.x/2+a),-(c(h.y)*m(h.x)*(o.y/2+a)),0);let w=.2*p,C=.3*p;f.visible=Math.abs(h.y)>w||Math.abs(h.z)>C,g.visible=Math.abs(h.x)>C||Math.abs(h.z)>C,b.visible=Math.abs(h.x)>C||Math.abs(h.y)>w,r.visible=d,t.add(r)},p=e=>{r.visible=e},y=()=>{null==r||r.children.forEach(e=>{e.children.forEach(e=>{if("Line"===e.type){let t=e.geometry;t.dispose();let l=e.material;l.dispose()}else e.dispose()})})};return{dispose:y,setVisible:p,update:h}},e1=(e,t,l,i)=>{let n=document.createElement("div");n.style.pointerEvents="none",n.style.border="1px solid #55aaff",n.style.backgroundColor="rgba(75, 160, 255, 0.3)",n.style.position="fixed";let a=new eK.FM8,r=new eK.FM8,o=new eK.FM8,d=new eK.FM8,s=!1,u=!1,c=new eK.iMs,m=()=>{s=!0},h=()=>{s=!1},p=e=>{s&&0===e.button&&(u=!0,Z(e))},y=e=>{s&&u&&f(e)},v=e=>{u=!1,s&&g(e)};e.domElement.addEventListener("pointerdown",p),e.domElement.addEventListener("pointermove",y),e.domElement.addEventListener("pointerup",v);let Z=t=>{i.enabled=!1,e.domElement.parentElement.appendChild(n),n.style.left=t.clientX+"px",n.style.top=t.clientY+"px",n.style.width="0px",n.style.height="0px",a.x=t.clientX,a.y=t.clientY},f=e=>{d.x=Math.max(a.x,e.clientX),d.y=Math.max(a.y,e.clientY),o.x=Math.min(a.x,e.clientX),o.y=Math.min(a.y,e.clientY),n.style.left=o.x+"px",n.style.top=o.y+"px",n.style.width=d.x-o.x+"px",n.style.height=d.y-o.y+"px"},g=e=>{i.enabled=!0,n.parentElement&&n.parentElement.removeChild(n),r.x=e.clientX,r.y=e.clientY;let t=new eK.TUj(a,r);b(t),h()},b=n=>{let a=new eK.FM8;if(n.getSize(a),a.x<5||a.y<5)return;let r=new eK.FM8((n.max.x+n.min.x)/2,(n.max.y+n.min.y)/2),o=e.domElement.getBoundingClientRect(),d=r.x-o.left,s=r.y-o.top,u=new eK.FM8(d/o.width*2-1,-(2*(s/o.height))+1),m=t.children.find(e=>"Part"===e.type);if(!m)return;c.setFromCamera(u,l);let h=c.intersectObject(m);if(!h.length)return;i.target.copy(h[0].point);let p=new eK.FM8(a.x/o.width,a.y/o.height),y=Math.max(p.x,p.y),v=l.position.distanceTo(i.target),Z=i.target.clone().sub(l.position).normalize().multiplyScalar(v*(1-y));l.position.add(Z)},w=()=>{e.domElement.removeEventListener("pointerdown",p),e.domElement.removeEventListener("pointermove",y),e.domElement.removeEventListener("pointerup",v)};return{dispose:w,end:h,isEnabled:()=>s,start:m}},e2=(e,t,l,i)=>{let n,a,r;let o=new eK.Ilk("#fad114"),d=new eK.Ilk("#E98A15"),s=new eK.Pa4(-1,0,0),u=new eK.JOQ(s),c={up:new eK.Pa4,forward:new eK.Pa4,right:new eK.Pa4},m=new eK.Pa4,h=new eK.Pa4,p=new eK.USm,y=new eK.Pa4,v=new eK.FM8,Z=new eK.JOQ,f=new eK.Pa4,g=new eK.Pa4,b=new eK.Zzh,w={up:new eK.Pa4,forward:new eK.Pa4,right:new eK.Pa4},C=new eK.iMs,x=new eK.ZAu;x.type="SectionViewHelper",x.visible=!1,t.add(x),(()=>{let e=new eK._12(1,1),t=new eK.vBJ({color:o,side:eK.ehD,transparent:!0,opacity:.5}),l=new eK.Kj0(e,t);l.type="Plane",x.add(l)})(),(()=>{let e=new eK.xo$(.2,32,32,Math.PI,-Math.PI),t=new eK.vBJ({color:o,side:eK.ehD,transparent:!0,opacity:.5}),l=new eK.Kj0(e,t);l.type="Dome",x.add(l)})(),(()=>{class e extends eK.Hyl{getPoint(e){return new eK.Pa4().set(this.radius*Math.cos(Math.PI*e),this.radius*Math.sin(Math.PI*e),0)}constructor(e){super(),this.radius=e}}let t=new e(.2);{let l=new eK.WXh(t,32,.020000000000000004,32),i=new eK.vBJ({color:o,side:eK.ehD,transparent:!0,opacity:.5}),n=new eK.Kj0(l,i);n.rotateX(Math.PI/2),n.type="ArcX",x.add(n)}{let a=new eK.WXh(t,32,.020000000000000004,32),r=new eK.vBJ({color:o,side:eK.ehD,transparent:!0,opacity:.5}),d=new eK.Kj0(a,r);d.rotateX(Math.PI/2),d.rotateY(Math.PI/2),d.type="ArcY",x.add(d)}})();let k=()=>{let e=new eK.Pa4;t.boundingBox.getSize(e),e.multiplyScalar(1.2);let l=Math.max(Math.max(e.x,e.y),e.z);x.scale.setScalar(l)},S=()=>{let e=new eK.Pa4;t.boundingBox.getCenter(e),x.position.copy(e)},P=()=>{let e=x.visible;x.visible=!e},E=()=>{e.localClippingEnabled=!0,x.visible=!0,k(),S();let t=new eK.Pa4().copy(x.position).sub(s);x.lookAt(t),u.setFromNormalAndCoplanarPoint(s,x.position)},O=()=>{e.localClippingEnabled=!1,x.visible=!1},B=e=>{if(S(),s.equals(e)){j();return}let t=new eK.Pa4().copy(x.position).sub(e);x.lookAt(t),u.setFromNormalAndCoplanarPoint(e,x.position),s.copy(e)},j=()=>{x.rotateX(Math.PI);let e=u.normal.multiplyScalar(-1);u.setFromNormalAndCoplanarPoint(e,x.position)},T=()=>{x.traverse(e=>{("Plane"===e.type||"Dome"===e.type||"ArcX"===e.type||"ArcY"===e.type)&&(e.geometry.dispose(),e.material.dispose())}),e.domElement.removeEventListener("pointermove",R),e.domElement.removeEventListener("pointerdown",V),e.domElement.removeEventListener("pointerup",F)},M=e=>{let t=e.target,l=t.getBoundingClientRect(),i=e.clientX-l.left,n=e.clientY-l.top,a=new eK.FM8;return a.x=i/l.width*2-1,a.y=-(2*(n/l.height))+1,a},X=e=>{n&&n.material.color.set(o),n=e,e&&e.material.color.set(d)},z=()=>{i.enabled=!0},L=()=>{i.enabled=!1},N=()=>{l.getWorldDirection(c.forward),c.forward.normalize(),c.up.copy(l.up).normalize(),c.right.crossVectors(c.up,c.forward).normalize()},A=()=>{let e=new eK.Pa4(0,0,1).applyQuaternion(x.quaternion).multiplyScalar(-1);u.setFromNormalAndCoplanarPoint(e,x.position)},R=e=>{if(!x.visible)return;let t=M(e);if(C.setFromCamera(t,l),a){let i=new eK.Pa4;C.ray.intersectPlane(Z,i),(null==r?void 0:r.type)==="Plane"?H(i):(null==r?void 0:r.type)==="Dome"?K(t):W(i),A()}else{let n=C.intersectObject(x);n.length?(L(),X(r=n[0].object),h.copy(n[0].point),N()):(r=null,X(),z())}},I=()=>{Z.setFromNormalAndCoplanarPoint(c.forward,h),m.copy(x.position);let e=new eK.Pa4;C.ray.intersectPlane(Z,e),f.copy(e).sub(m),g.copy(f).normalize(),b.set(m,new eK.Pa4().copy(m).add(u.normal))},H=e=>{e.sub(f);let t=new eK.Pa4;b.closestPointToPoint(e,!1,t),x.position.copy(t)},D=e=>{p.copy(x.rotation),v.copy(e)},K=e=>{x.rotation.copy(p),x.rotateOnWorldAxis(c.up,-(5*(v.x-e.x))),x.rotateOnWorldAxis(c.right,-(5*(v.y-e.y)))},U=()=>{r.getWorldDirection(y),p.copy(x.rotation),f.copy(h).sub(x.position),g.copy(f).normalize(),w.up.copy(g),w.right.copy(y),w.forward.crossVectors(w.right,w.up),b.set(h,new eK.Pa4().copy(h).add(w.forward)),Z.setFromNormalAndCoplanarPoint(c.forward,h)},W=e=>{let t=i.object.position.distanceTo(i.target),l=new eK.Pa4;b.closestPointToPoint(e,!1,l);let n=h.distanceTo(l);l.sub(h);let a=new eK.Pa4().copy(g).cross(l).normalize(),r=Math.sign(y.dot(a));x.rotation.copy(p),x.rotateOnWorldAxis(y,r*n*1/(t/100))},Y=e=>{switch(null==r?void 0:r.type){case"Plane":I();break;case"Dome":D(e);break;case"ArcX":case"ArcY":U()}},V=e=>{if(x.visible&&r){a=!0;let t=M(e);Y(t)}},F=()=>{x.visible&&(a=!1,X())};return e.domElement.addEventListener("pointermove",R),e.domElement.addEventListener("pointerdown",V),e.domElement.addEventListener("pointerup",F),{getClippingPlane:()=>u,toggleVisible:P,start:E,stop:O,toAxis:B,flip:j,dispose:T}};var e5=l(54104);let e4=e=>{let t=new eK.xsS,l=new eK.iKG(-1,1,1,-1,2,1);l.position.set(0,0,1);let i=new eK.ZAu;t.add(i);let n=e=>{t.children.forEach(t=>{t.children.forEach(t=>t.visible=e)})},a=()=>{t.children.forEach(e=>e.children.forEach(t=>{"LabelHelper"===t.type&&t.dispose(),"Sprite"===t.type&&t.dispose(),e.remove(t)}))},r=e=>{a();let t=new e5.A("rainbow",e.n);t.setMin(e.minV),t.setMax(e.maxV);let l=new eK.ROQ(t.createCanvas()),n=new eK.xeV({map:l,depthWrite:!1}),r=new eK.jyi(n);r.material.rotation=-Math.PI/2,r.scale.x=.2,r.scale.y=1.2,r.dispose=r.material.dispose,i.add(r),o(t)},o=t=>{let l=e$(t.minV),n=e$(t.maxV),a=eq(e,String(l),{position:new eK.Pa4(-.62,0,0),width:512,align:"right"});a.scale.x=.4,a.scale.y=2.8;let r=eq(e,String(n),{position:new eK.Pa4(.62,0,0),width:512,align:"left"});r.scale.x=.4,r.scale.y=2.8,i.add(a),i.add(r)},d=()=>{let i=e.domElement.getBoundingClientRect();e.setViewport(i.width/2-350,i.height-50,700,50),e.render(t,l)},s=()=>{a()};return{render:d,setLUT:r,setVisible:n,dispose:s}},e3=e=>{let t=new eK.ZAu;t.type="PointHelper",t.visible=!1,e.add(t);let l=()=>{var t,l;let i=(null!==(l=null===(t=e.boundingSphere)||void 0===t?void 0:t.radius)&&void 0!==l?l:1)/100,n=new eK.xo$(i),a=new eK.Wid({color:16711680});return new eK.Kj0(n,a)},i=(e,t)=>{let l=new eK.u9r().setFromPoints([e,t]),i=new eK.nls({color:16711680});return new eK.x12(l,i)},n=()=>{let t=[],l=e.boundingBox.max.x-e.boundingBox.min.x,n=e.boundingBox.max.y-e.boundingBox.min.y,a=e.boundingBox.max.z-e.boundingBox.min.z,r=Math.max(l,n,a),o=i(new eK.Pa4(-r/2,0,0),new eK.Pa4(r/2,0,0));t.push(o);let d=i(new eK.Pa4(0,-r/2,0),new eK.Pa4(0,r/2,0));t.push(d);let s=i(new eK.Pa4(0,0,-r/2),new eK.Pa4(0,0,r/2));return t.push(s),t},a=()=>{o();let e=l(),i=n();t.add(e),t.add(...i)},r=e=>{e?(t.position.set(e.x,e.y,e.z),t.visible=!0):t.visible=!1},o=()=>{t.children.forEach(e=>{t.remove(e),e.geometry.dispose(),e.material.dispose()})};return{build:a,dispose:o,update:r}};var e8=l(1217),e6=l(82854),e7=l(6648),e9=l(48764).lW;let te=(e,t)=>{e.traverse(e=>{if("Mesh"===e.type){let l=e,i=new eK.Uk6(l.geometry),n=new eK.nls({color:l.material.color,linewidth:1}),a=new eK.ejS(i,n);l.add(a),l.material.visible=!1,l.material.clippingPlanes=[t]}})},tt=(e,t)=>{e.traverse(e=>{if("Mesh"===e.type||"Line"===e.type){let l=e,i=l.geometry.getAttribute("data");if(i){let n=i.array.reduce((e,t)=>Math.min(e,t),i.array[0]),a=i.array.reduce((e,t)=>Math.max(e,t),i.array[0]);n===a&&(n-=1,a+=1);let r=new e5.A;r.setMin(n),r.setMax(a);let o=new Float32Array(3*i.count);for(let d=0;d<i.count;d++){let s=r.getColor(i.array[d]);o[3*d+0]=s.r,o[3*d+1]=s.g,o[3*d+2]=s.b}l.geometry.setAttribute("color",new eK.a$l(o,3)),l.userData={...l.userData,lut:r}}if("Mesh"===e.type){let u=new eK.Uk6(l.geometry),c=new eK.nls({linewidth:1}),m=new eK.ejS(u,c);l.add(m)}l.material.vertexColors=!0,l.material.clippingPlanes=[t]}})},tl=(e,t)=>{e.traverse(e=>{if("Mesh"===e.type){let l=e;l.material.clippingPlanes=[t],l.material.originalColor=l.material.color}})},ti=(e,t)=>{let l=new eK.Ilk("#FAD114"),i=new eK.Ilk("#EE9817"),n=async(e,t,l,i)=>{let n=new Blob([e9.from(e.buffer)]),s=URL.createObjectURL(n),u=new e8.E,c=new e6._;c.setDecoderPath("/three/libs/draco/"),u.setDRACOLoader(c);let m=new e7.a;m.setTranscoderPath("node_modules/three//examples/js/libs/basis/"),u.setKTX2Loader(m);let h=await new Promise((e,t)=>{u.load(s,t=>{e(t)},()=>void 0,e=>t(e))}),p=h.scene,g=new eK.Tme;return g.type="Part",g.uuid=e.summary.uuid,g.children=p.children,g.userData=p.userData,"mesh"===e.summary.type?te(g,i):"result"===e.summary.type?tt(g,i):("geometry3D"===e.summary.type||"geometry2D"===e.summary.type)&&tl(g,i),o(g,t),d(g,l),g.boundingBox=a(g),g.dispose=()=>r(g),g.setTransparent=e=>o(g,e),g.setDisplayMesh=e=>d(g,e),g.startSelection=(e,t,l,i)=>Z(g,e,t,l,i),g.stopSelection=()=>f(),g.getHighlighted=()=>y,g.getSelected=()=>v,g.highlight=O,g.unhighlight=B,g.select=T,g.unselect=M,g},a=e=>{let t=new eK.ZzF;return e.traverse(e=>{t.expandByObject(e)}),t},r=e=>{e.traverse(e=>{"Mesh"===e.type&&(e.geometry.dispose(),e.material.dispose())})},o=(e,t)=>{e.traverse(e=>{if("Mesh"===e.type){let l=e;l.material.transparent=t,l.material.opacity=t?.5:1,l.material.depthWrite=!t}})},d=(e,t)=>{"result"===e.userData.type&&e.traverse(e=>{e.traverse(e=>{if("LineSegments"===e.type){let l=e;l.visible=t}})})},s=new eK.iMs,u=null,c=null,m=null,h=null,p=null,y=null,v=[],Z=(e,t,l,i,n)=>{u=e,c=n,m=t,h=l,(p=i).selectedObjects=[],y=null,v.length=0,m.domElement.addEventListener("pointermove",S),m.domElement.addEventListener("pointerdown",j)},f=()=>{m&&m.domElement.removeEventListener("pointermove",S),m&&m.domElement.removeEventListener("pointerdown",j),B(),y=null,v.forEach(e=>{M(e.uuid)}),v.length=0,c=null,u=null,m=null,h=null,p=null},g=(e,t)=>{let l;if(e&&t)return e.traverse(e=>{e.userData.uuid===t&&(l=e)}),l},b=e=>{let t=e.target,l=t.getBoundingClientRect(),i=e.clientX-l.left,n=e.clientY-l.top,a=new eK.FM8;return a.x=i/l.width*2-1,a.y=-(2*(n/l.height))+1,a},w=()=>{let t=s.intersectObject(u,!0);if(t.length){let l=t[0].object,i=l.parent;i&&e(u,i.userData.uuid,i.userData.label)}else e(u)},C=()=>{let t;let l=u.userData;if(2===l.dimension){if((t=s.intersectObject(u,!0)).length){let i=t[0].object,n=i.parent;(null==n?void 0:n.type)==="Mesh"?e(u,n.userData.uuid,n.userData.label):e(u,i.userData.uuid,i.userData.label)}else e(u)}else if((t=s.intersectObject(u,!0)).length){let a=t[0].object;e(u,a.userData.uuid,a.userData.label)}else e(u)},x=()=>{let t;let l=u.userData,i=l.edges;if((t=s.intersectObject(u,!0)).length){let n=t[0].object,a=null==i?void 0:i.find(e=>e.uuid===n.userData.uuid);a?e(u,n.userData.uuid,n.userData.label):e(u)}else e(u)},k=()=>{let t=s.intersectObject(u,!0);if(t.length){let l=t[0];e(u,void 0,void 0,l.point)}else e(u)},S=e=>{let t=b(e);switch(s.setFromCamera(t,h),c){case"solids":w();break;case"faces":C();break;case"edges":x();break;case"point":k()}},P=(e,t)=>{if(t){let l=p.selectedObjects.find(t=>t.userData.uuid===e.userData.uuid);l||p.selectedObjects.push(e)}else{let i=v.find(t=>t.uuid===e.userData.uuid);i||p.selectedObjects.push(e)}},E=(e,t)=>{if(t){let l=p.selectedObjects.findIndex(t=>t.userData.uuid===e.userData.uuid);p.selectedObjects=[...p.selectedObjects.slice(0,l),...p.selectedObjects.slice(l+1)]}else{let i=v.find(t=>t.uuid===e.userData.uuid);if(!i){let n=p.selectedObjects.findIndex(t=>t.userData.uuid===e.userData.uuid);p.selectedObjects=[...p.selectedObjects.slice(0,n),...p.selectedObjects.slice(n+1)]}}},O=e=>{if(e===(null==y?void 0:y.uuid))return;B();let t=g(u,e);if(t){if(y={uuid:t.userData.uuid,label:t.userData.label},P(t),"Mesh"===t.type){let i=t;i.material.color=l}else t.traverse(e=>{if("Mesh"===e.type){let t=e;t.material.color=l}})}},B=()=>{let e=g(u,null==y?void 0:y.uuid);if(y=null,!e)return;E(e);let t=v.findIndex(t=>t.uuid===e.userData.uuid);if("Mesh"===e.type){let l=e;l.material.color=-1===t?l.material.originalColor:i}else e.traverse(e=>{if("Mesh"===e.type){let l=e;l.material.color=-1===t?l.material.originalColor:i}})},j=()=>{y&&t(u,y.uuid,y.label)},T=e=>{let t=g(u,e);if(t){if(v.push({uuid:e,label:t.userData.label}),P(t,!0),"Mesh"===t.type){let l=t;l.material.color=i}else t.traverse(e=>{if("Mesh"===e.type){let t=e;t.material.color=i}})}},M=e=>{let t=g(u,e),l=v.findIndex(t=>t.uuid===e);if(-1!==l&&(v=[...v.slice(0,l),...v.slice(l+1)]),t){if(E(t,!0),"Mesh"===t.type){let i=t;i.material.color=i.material.originalColor}else t.traverse(e=>{if("Mesh"===e.type){let t=e;t.material.color=t.material.originalColor}});t.visible=!0}};return{load:n}},tn=()=>({type:I.ENABLE}),ta=()=>({type:I.DISABLE}),tr=e=>({type:I.SETTYPE,value:e}),to=e=>({type:I.SETPART,value:e}),td=e=>{let{uuid:t,label:l}=e;return{type:I.HIGHLIGHT,value:{uuid:t,label:l}}},ts=()=>({type:I.UNHIGHLIGHT}),tu=e=>{let{uuid:t,label:l}=e;return{type:I.SELECT,value:{uuid:t,label:l}}},tc=e=>{let{uuid:t,label:l}=e;return{type:I.UNSELECT,value:{uuid:t,label:l}}},tm=e=>({type:I.SETPOINT,value:e});var th=l(5094);let tp={view:(0,O.iv)({width:"100%",height:"100%"}),head:(0,O.iv)({position:"absolute",top:"160px",right:0,bottom:0,backgroundColor:"transparent !important",zIndex:10,height:"calc(100% - 160px)",padding:"0 57px",display:"flex",flexDirection:"column",rowGap:"10px",alignItems:"center"}),content:(0,O.iv)({width:"100%",height:"100%",position:"relative"}),loading:(0,O.iv)({position:"absolute",top:0,left:0,width:"100%",height:"100%",background:"rgba(128, 128, 118, 0.1)",zIndex:100,display:"flex",justifyContent:"center",alignItems:"center"}),canvas:(0,O.iv)({position:"absolute",top:0,left:0,bottom:0,right:0})},ty={load:"Error while loading part",snapshot:"Error while taking snapshot",saveScreenshot:"Unable to save screenshot"},tv=!1,tZ=e=>{let t=new eK.ZzF;e.children.forEach(e=>{if(e.visible&&"Part"===e.type){let l=e.boundingBox,i=new eK.Pa4(Math.min(t.min.x,l.min.x),Math.min(t.min.y,l.min.y),Math.min(t.min.z,l.min.z)),n=new eK.Pa4(Math.max(t.max.x,l.max.x),Math.max(t.max.y,l.max.y),Math.max(t.max.z,l.max.z));t.set(i,n)}});let l=new eK.aLr;t.getBoundingSphere(l),e.boundingBox=t,e.boundingSphere=l},tf=(e,t,l)=>{let i=t.object.position.distanceTo(t.target),n=t.target.clone().sub(e.position).normalize().multiplyScalar(i*l*.01);e.position.add(n)},tg=(e,t,l)=>{let i=e.children.find(e=>"Part"===e.type);if(!i)return;tv=!0;let n=e.boundingSphere,a=n.center,r=2*n.radius,o=r/(2*Math.atan(Math.PI*t.fov/360)),d=o/t.aspect,s=1.1*Math.max(o,d),u=l.target.clone().sub(t.position).normalize().multiplyScalar(s);l.target.copy(a),l.minDistance=s/10,l.maxDistance=10*s,t.position.copy(a).sub(u),t.near=s/100,t.far=100*s,t.updateProjectionMatrix()},tb=async(e,t,l,i,n,a,r)=>{let o=(e,t,l,i)=>{t?(e.highlight(t),setTimeout(()=>r(td({uuid:t,label:l})),1)):i?r(tm({x:i.x,y:i.y,z:i.z})):(e.unhighlight(),setTimeout(()=>r(ts()),1))},d=(e,t,l)=>{let i=e.getSelected();i.find(e=>e.uuid===t)?(e.unselect(t),setTimeout(()=>r(tc({uuid:t,label:l})),1)):(e.select(t),setTimeout(()=>r(tu({uuid:t,label:l})),1))},s=ti(o,d),u=await s.load(e,n.transparent,n.displayMesh,a.sectionViewHelper.getClippingPlane());t.add(u),tZ(t),tv||tg(t,l,i),a.gridHelper.update(),a.gridHelper.update(),a.gridHelper.setVisible(!0),u.children[0].userData.lut?(a.colorbarHelper.setLUT(u.children[0].userData.lut),a.colorbarHelper.setVisible(!0)):a.colorbarHelper.setVisible(!1),a.pointHelper.build()},tw=async(e,t,l,i)=>{try{let n=i.domElement.width,a=i.domElement.height,r=l.aspect;i.domElement.width=520,i.domElement.height=312,l.aspect=520/312,l.updateProjectionMatrix(),i.clear(),i.setViewport(0,0,520,312),i.render(t,l);let o=i.domElement.toDataURL();i.domElement.width=n,i.domElement.height=a,l.aspect=r,l.updateProjectionMatrix(),await th.Z.add({name:"snapshot",uid:"snapshot_"+(0,eU.Z)(),data:o},{id:e.id})}catch(d){(0,A.lt)(ty.snapshot,d)}},tC=(e,t,l,i)=>{try{let n=i.domElement.width,a=i.domElement.height;i.clear(),i.setViewport(0,0,n,a),i.render(t,l);let r=i.domElement.toDataURL(),o=document.createElement("a");o.href=r.replace("image/png","image/octet-stream"),o.download=e.title+"_"+new Date().toLocaleDateString()+".png",o.click()}catch(d){(0,A.lt)(ty.saveScreenshot,d)}},tx=e=>{var t,l,n;let{loading:a,project:r,parts:d}=e,s=(0,c.useRef)(null),p=(0,c.useRef)(),y=(0,c.useRef)(),Z=(0,c.useRef)(),g=(0,c.useRef)(),b=(0,c.useRef)(),w=(0,c.useRef)(),C=(0,c.useRef)(),x=(0,c.useRef)(),k=(0,c.useRef)(),P=(0,c.useRef)(),E=(0,c.useRef)(),[j,T]=(0,c.useState)(!1),[M,X]=(0,c.useState)(!0),[z,L]=(0,c.useState)(!1),[N,R]=(0,c.useState)(!1),[I,D]=(0,c.useState)(!1),K=(0,u.useRouter)(),{enabled:U,part:W,highlighted:Y,selected:V,point:F,type:G,dispatch:J}=(0,c.useContext)(H);(0,c.useEffect)(()=>{if(!eG.Z.isWebGLAvailable()){K.push("/webgl");return}let e=s.current,t=e.clientWidth,l=e.clientHeight;p.current=new eK.xsS,p.current.boundingBox=new eK.ZzF,p.current.boundingSphere=new eK.aLr,y.current=new eK.cPb(50,t/l,.1,1e3),y.current.position.z=10;let i=new eK.Mig("#aaa",.75);p.current.add(i);let n=new eK.cek("#fff",.5);n.decay=2,y.current.add(n),p.current.add(y.current),Z.current=new eK.CP7({antialias:!0,alpha:!0}),Z.current.setClearColor("#ffffff"),Z.current.setSize(t,l),Z.current.setPixelRatio(window.devicePixelRatio||1),Z.current.shadowMap.enabled=!0,Z.current.autoClear=!1,e.appendChild(Z.current.domElement);let a=new eY.C(p.current,y.current);g.current=new eV.f(new eK.FM8(t,l),p.current,y.current),g.current.visibleEdgeColor.set("#FAD114"),g.current.hiddenEdgeColor.set("#FAD114"),b.current=new eF.xC(Z.current),b.current.addPass(a),b.current.addPass(g.current),w.current=new eW.$(y.current,e),w.current.rotateSpeed=3,w.current.panSpeed=.1;let r=e_(Z.current,y.current,{offsetWidth:t-155,offsetHeight:l-155,width:150,height:150}),o=eQ(Z.current,p.current,y.current,w.current,{offsetWidth:t-155,offsetHeight:l-155,width:150,height:150});C.current=e0(Z.current,p.current,y.current,w.current),x.current=e1(Z.current,p.current,y.current,w.current),k.current=e2(Z.current,p.current,y.current,w.current),P.current=e4(Z.current),P.current.setVisible(!1),E.current=e3(p.current);let d=()=>{w.current.update(),Z.current.setViewport(0,0,t,l),Z.current.render(p.current,y.current),C.current.update(),b.current.render(),r.render(),o.render(),P.current.render()},u=()=>{t=e.clientWidth,l=e.clientHeight,y.current.aspect=t/l,y.current.updateProjectionMatrix(),Z.current.setSize(t,l),b.current.setSize(t,l),r.resize({newOffsetWidth:t-155,newOffsetHeight:l-155,newWidth:150,newHeight:150}),o.resize({newOffsetWidth:t-155,newOffsetHeight:l-155,newWidth:150,newHeight:150}),d()},c=()=>{d(),setTimeout(()=>requestAnimationFrame(c),1e3/30)};return window.addEventListener("resize",u),requestAnimationFrame(c),()=>{tv=!1,window.removeEventListener("resize",u),e.removeChild(Z.current.domElement),p.current.children.forEach(e=>{p.current.remove(e)}),r.dispose(),o.dispose(),C.current.dispose(),k.current.dispose(),x.current.dispose(),P.current.dispose(),E.current.dispose()}},[K]),(0,B.Z)(()=>{if(!p.current)return;let e=p.current.children;if(!d.length){var t;tZ(p.current),C.current.update(),null===(t=E.current)||void 0===t||t.build()}let l=d.filter(t=>!e.find(e=>e.uuid===t.summary.uuid)),i=e.filter(e=>!d.find(t=>t.summary.uuid===e.uuid)).filter(e=>"Part"===e.type);i.forEach(e=>{var t;null===(t=p.current)||void 0===t||t.remove(e),e.dispose()}),l.forEach(e=>{tb(e,p.current,y.current,w.current,{transparent:j,displayMesh:M},{gridHelper:C.current,sectionViewHelper:k.current,colorbarHelper:P.current,pointHelper:E.current},J).catch(e=>{(0,A.lt)(ty.load,e),tZ(p.current)})})},[d,j,M,J]),(0,B.Z)(()=>{var e;if(p.current){if((null===(e=d[0])||void 0===e?void 0:e.summary.dimension)===2){tZ(p.current);let t=new eK.Pa4(0,0,1),l=new eK.Pa4(0,1,0),i=new eK.Pa4;p.current.boundingBox.getCenter(i);let n=y.current.position.distanceTo(w.current.target),a=t.clone().multiplyScalar(n),r=i.add(a);y.current.position.copy(r),y.current.up.copy(l),w.current.noRotate=!0}else w.current.noRotate=!1}},[d]),(0,c.useEffect)(()=>{p.current&&p.current.children.forEach(e=>{"Part"===e.type&&e.userData.uuid===W&&(U?e.startSelection(Z.current,y.current,g.current,G):e.stopSelection())})},[U,W,G]),(0,c.useEffect)(()=>{p.current&&p.current.children.forEach(e=>{if("Part"===e.type&&e.uuid===W){e.highlight(null==Y?void 0:Y.uuid);let t=e.getSelected(),l=V.filter(e=>!t.find(t=>t.uuid===e.uuid));l.forEach(t=>{t.uuid&&e.select(t.uuid)});let i=t.filter(e=>!V.find(t=>t.uuid===e.uuid));i.forEach(t=>{e.unselect(t.uuid)})}})},[W,Y,V]),(0,c.useEffect)(()=>{var e;p.current&&(null===(e=E.current)||void 0===e||e.update(F?new eK.Pa4(F.x,F.y,F.z):void 0))},[F]);let q=(0,c.useCallback)(e=>{T(e),p.current.children.forEach(t=>{"Part"===t.type&&t.setTransparent(e)})},[]),_=(0,c.useCallback)(e=>{X(e),p.current.children.forEach(t=>{"Part"===t.type&&t.setDisplayMesh(e)})},[]),Q=(0,c.useCallback)(()=>{let e=!z;L(e),e?k.current.start():k.current.stop()},[z]),$=(0,c.useCallback)(async()=>{R(!0);try{await tw(r,p.current,y.current,Z.current)}finally{R(!1)}},[r]),ee=(0,c.useCallback)(()=>{D(!0);try{tC(r,p.current,y.current,Z.current)}finally{D(!1)}},[r]),et=(0,c.useCallback)(e=>{var t;null===(t=C.current)||void 0===t||t.setVisible(e)},[]),el=(0,c.useCallback)(()=>{tf(y.current,w.current,1);let e=()=>el();i=requestAnimationFrame(e)},[]),ei=(0,c.useCallback)(()=>{tf(y.current,w.current,-1);let e=()=>ei();i=requestAnimationFrame(e)},[]),en=(0,c.useCallback)(()=>{i&&cancelAnimationFrame(i),i=void 0},[]),ea=(0,c.useCallback)(()=>{tg(p.current,y.current,w.current)},[]),er=(0,c.useCallback)(()=>{k.current.toAxis(new eK.Pa4(-1,0,0))},[]),ed=(0,c.useCallback)(()=>{k.current.toAxis(new eK.Pa4(0,-1,0))},[]),es=(0,c.useCallback)(()=>{k.current.toAxis(new eK.Pa4(0,0,-1))},[]);return(0,o.BX)(h.Z,{css:(0,O.iv)([eo.KP.noScroll,tp.view]),children:[(0,o.BX)(h.Z.Header,{css:tp.head,children:[(0,o.tZ)(m.Z,{title:"Take snasphot",placement:"left",children:(0,o.tZ)(eE.Z,{placement:"bottom",menu:{items:[{key:"project",label:(0,o.tZ)(v.Z,{type:"text",css:eo.KP.fullWidth,loading:N,onClick:$,children:"Project snapshot"})},{key:"image",label:(0,o.tZ)(v.Z,{type:"text",css:eo.KP.fullWidth,loading:I,onClick:ee,children:"Export image"})}]},children:(0,o.tZ)(v.Z,{icon:(0,o.tZ)(eT.Z,{})})})}),(0,o.tZ)(eO.Z,{css:eo.Ml.margin(0)}),(0,o.tZ)(m.Z,{title:"Display grid",placement:"left",children:(0,o.tZ)(eB.Z,{defaultChecked:!0,checkedChildren:(0,o.tZ)(eM.Z,{}),unCheckedChildren:(0,o.tZ)(eM.Z,{}),onChange:et})}),(0,o.tZ)(m.Z,{title:"Set transparency",placement:"left",children:(0,o.tZ)(eB.Z,{checked:j,checkedChildren:(0,o.tZ)(eX.Z,{}),unCheckedChildren:(0,o.tZ)(eX.Z,{}),onChange:q})}),(0,o.tZ)(eO.Z,{css:eo.Ml.margin(0)}),(0,o.tZ)(m.Z,{title:"Zoom out",placement:"left",children:(0,o.tZ)(v.Z,{icon:(0,o.tZ)(ez.Z,{}),onMouseDown:ei,onMouseUp:en,onMouseOut:en})}),(0,o.tZ)(m.Z,{title:"Zoom in",placement:"left",children:(0,o.tZ)(v.Z,{icon:(0,o.tZ)(eL.Z,{}),onMouseDown:el,onMouseUp:en,onMouseOut:en})}),(0,o.tZ)(m.Z,{title:"Zoom to fit",placement:"left",children:(0,o.tZ)(v.Z,{icon:(0,o.tZ)(eN.Z,{}),onClick:ea})}),(0,o.tZ)(m.Z,{title:"Zoom to selection",placement:"left",children:(0,o.tZ)(v.Z,{icon:(0,o.tZ)(eA.Z,{}),onClick:(null===(t=x.current)||void 0===t?void 0:t.isEnabled())?null===(l=x.current)||void 0===l?void 0:l.end:null===(n=x.current)||void 0===n?void 0:n.start})}),(0,o.tZ)(eO.Z,{css:eo.Ml.margin(0)}),!z&&(0,o.tZ)(m.Z,{title:"Section view",children:(0,o.tZ)(v.Z,{icon:(0,o.tZ)(eR.Z,{}),onClick:Q})}),z&&(0,o.BX)(o.HY,{children:[(0,o.tZ)(m.Z,{title:"Stop",placement:"left",children:(0,o.tZ)(v.Z,{icon:(0,o.tZ)(eI.Z,{}),onClick:Q})}),(0,o.tZ)(m.Z,{title:"Hide plane",placement:"left",children:(0,o.tZ)(v.Z,{icon:(0,o.tZ)(f.Z,{}),onClick:k.current.toggleVisible})}),(0,o.tZ)(m.Z,{title:"Snap to X",placement:"left",children:(0,o.tZ)(v.Z,{className:"ant-btn-icon-only",onClick:er,children:"X"})}),(0,o.tZ)(m.Z,{title:"Snap to Y",placement:"left",children:(0,o.tZ)(v.Z,{className:"ant-btn-icon-only",onClick:ed,children:"Y"})}),(0,o.tZ)(m.Z,{title:"Snap to Z",placement:"left",children:(0,o.tZ)(v.Z,{className:"ant-btn-icon-only",onClick:es,children:"Z"})}),(0,o.tZ)(m.Z,{title:"Flip",placement:"left",children:(0,o.tZ)(v.Z,{onClick:k.current.flip,icon:(0,o.tZ)(eH.Z,{})})})]}),(0,o.tZ)("div",{children:d.filter(e=>"result"===e.summary.type).length?(0,o.BX)(o.HY,{children:[(0,o.tZ)(eO.Z,{className:"no-margin"}),(0,o.tZ)(m.Z,{title:"Display result mesh",placement:"right",children:(0,o.tZ)(eB.Z,{checked:M,checkedChildren:(0,o.tZ)(eD.Z,{}),unCheckedChildren:(0,o.tZ)(eD.Z,{}),onChange:_})})]}):null})]}),(0,o.BX)(h.Z.Content,{css:(0,O.iv)([eo.KP.noScroll,tp.content]),children:[(0,o.tZ)("div",{style:{display:a?"flex":"none"},css:eo.KP.loading,children:(0,o.tZ)(ej.Z,{indicator:(0,o.tZ)(S.Z,{css:{color:eo.Rl.colorPrimary},style:{fontSize:80},spin:!0})})}),(0,o.tZ)("div",{ref:s,css:tp.canvas})]})]})},tk={part:"Unable to load part"},tS=async(e,t,l)=>{try{if("geometry"===l){let i=await ee.getPart({id:t.id});return{...i,extra:{id:t.id}}}{let n=await eP.load({id:e.id},{originPath:t.originPath,glb:t.glb});return{...n,extra:{glb:t.glb}}}}catch(a){throw(0,A.lt)(tk.part,a),a}},tP=async(e,t,l,i)=>{if(!i&&l){let n=t.find(e=>{var t;return(null===(t=e.extra)||void 0===t?void 0:t.glb)===l.glb});if(n)return n;{let a=await tS(e,l,"result");return a}}},tE=async(e,t,l)=>{if(l){let i=t.find(e=>{var t;return(null===(t=e.extra)||void 0===t?void 0:t.glb)===l.glb});if(i)return i;{let n=await tS(e,l,"result");return n}}},tO=async(e,t,l)=>Promise.all(l.map(async l=>{let i=t.find(e=>{var t;return(null===(t=e.extra)||void 0===t?void 0:t.id)===l.id});if(i)return i;{let n=await tS(e,l,"geometry");return n}})),tB=e=>{let{project:t,simulation:l,geometries:i,result:n,postprocessing:a}=e,[r,d]=(0,c.useState)([]),[s,u]=(0,c.useState)(!1);return(0,B.Z)(()=>{(async()=>{u(!0);try{let e=[];if(l){let t=await tP(l,r,n,a);t&&e.push(t)}if(l){let o=await tE(l,r,a);o&&e.push(o)}let s=await tO(l,r,i);e.push(...s),d(e)}catch(c){}finally{u(!1)}})()},[l,i,n,a,r]),(0,o.tZ)(tx,{loading:s,project:{id:t.id,title:t.title},parts:r})};var tj=l(34041),tT=l(60974),tM=l(67875),tX=l(23389),tz=l(93398),tL=l(96486),tN=l(39553),tA=l(64376),tR=l(10843);let tI={selector:(0,O.iv)({padding:"20px",height:"60vh",overflow:"auto",figure:{maxWidth:"80%",border:"1px solid #f0f0f0",margin:"auto",display:"flex",flexDirection:"column",alignItems:"center"},figcaption:{textAlign:"center",color:"#9c9c9c"},img:{maxWidth:"80%"}}),geometriesList:(0,O.iv)({width:"100%",padding:"12px","> .ant-select":{width:"100%"}}),waring:(0,O.iv)({"& .ant-collapse-content":{backgroundColor:"rgba(250, 173, 20, 0.5) !important"}}),error:(0,O.iv)({"& .ant-collapse-content":{backgroundColor:"rgba(255, 77, 79, 0.5) !important"}}),listItem:(0,O.iv)({marginTop:"12px !important",border:"1px solid #f0f0f0 !important",cursor:"default","& .ant-card-body":{padding:"12px !important"}})};var tH=l(99138),tD=l(57132);let tK={copy:"Unable to copy simulation"},tU=async(e,t,l)=>{try{let i=tA.Z.deepCopy(t.scheme);i.configuration.run.done=!1,i.configuration.run.error=void 0;let n=await Y.Z.add({id:e.id},{name:t.name+" (copy)",scheme:i});l.addOneSimulation(n),l.mutateProject({id:e.id,simulations:[...e.simulations,n.id]})}catch(a){(0,A.lt)(tK.copy,a)}},tW=e=>{let{project:t,simulation:l,swr:i}=e,[n,a]=(0,c.useState)(!1);return(0,o.tZ)(m.Z,{title:"Copy simulation",children:(0,o.tZ)(v.Z,{css:eo.KP.noBorder,loading:n,icon:(0,o.tZ)(tD.Z,{}),async onClick(){a(!0);try{await tU(t,l,i)}finally{a(!1)}}})})},tY={update:"Unable to update simulation"},tV=async(e,t,l)=>{try{await Y.Z.update({id:e.id},[{key:"name",value:t.name}]),l.mutateOneSimulation({id:e.id,name:t.name})}catch(i){throw(0,A.lt)(tY.update,i),i}},tF=e=>{let{simulation:t,swr:l}=e,i=(0,c.useRef)(null),[n,a]=(0,c.useState)(!1),[r,d]=(0,c.useState)(!1);return(0,c.useEffect)(()=>{i.current&&i.current.focus()}),(0,o.BX)(o.HY,{children:[(0,o.tZ)(N.w6,{onEdit:()=>a(!0)}),(0,o.tZ)(er.ZP,{title:"Edit the simulation's name",visible:n,initialValues:{name:t.name},onCancel:()=>a(!1),async onOk(e){d(!0);try{await tV(t,e,l),d(!1),a(!1)}catch(i){throw d(!1),i}},loading:r,children:(0,o.tZ)(ep.Z.Item,{name:"name",label:"Name:",rules:[{required:!0,message:"Name is required"}],children:(0,o.tZ)(ey.Z,{ref:i})})})]})},tG={del:"Unable to delete simulation"},tJ=async(e,t,l)=>{try{await Y.Z.del(t);let i=e.simulations.filter(e=>e!==t.id);l.mutateProject({id:e.id,simulations:i}),l.delOneSimulation({id:t.id})}catch(n){throw(0,A.lt)(tG.del,n),n}},tq=e=>{let{project:t,simulation:l,swr:i}=e,[n,a]=(0,c.useState)(!1);return(0,o.tZ)(N.m1,{loading:n,text:(0,o.BX)(o.HY,{children:["Are you sure you want to delete the simulation"," ",(0,o.tZ)(y.Z.Text,{strong:!0,children:l.name}),"?"]}),async onDelete(){a(!0);try{await tJ(t,l,i)}finally{a(!1)}}})},t_=e=>{let{project:t,simulation:l,swr:i}=e;return t&&l?(0,o.tZ)(h.Z,{children:(0,o.tZ)(h.Z.Content,{children:(0,o.tZ)(T.Z,{size:"small",title:(0,o.tZ)(y.Z.Title,{level:5,ellipsis:!0,children:l.name}),actions:[(0,o.tZ)(tW,{project:{id:t.id,simulations:t.simulations},simulation:l,swr:{mutateProject:i.mutateProject,addOneSimulation:i.addOneSimulation}},"copy"),(0,o.tZ)(tF,{simulation:{id:l.id,name:l.name},swr:{mutateOneSimulation:i.mutateOneSimulation}},"edit"),(0,o.tZ)(tq,{project:{id:t.id,simulations:t.simulations},simulation:{id:l.id,name:l.name},swr:{mutateProject:i.mutateProject,delOneSimulation:i.delOneSimulation}},"delete")],children:(0,o.BX)(M.Z,{direction:"vertical",css:eo.KP.fullWidth,children:[l.scheme.user&&(0,o.tZ)(tH.Z,{message:"User algorithm",type:"info",showIcon:!0}),(0,o.BX)(y.Z.Text,{children:[(0,o.tZ)("span",{css:eo.KP.textLight,children:"Category:"})," ",l.scheme.category]}),(0,o.BX)(y.Z.Text,{children:[(0,o.tZ)("span",{css:eo.KP.textLight,children:"Algorithm:"})," ",l.scheme.algorithm]}),(0,o.BX)(y.Z.Text,{children:[(0,o.tZ)("span",{css:eo.KP.textLight,children:"Code:"})," ",l.scheme.code]}),(0,o.BX)(y.Z.Text,{children:[(0,o.tZ)("span",{css:eo.KP.textLight,children:"Version:"})," ",l.scheme.version]}),(0,o.tZ)("div",{css:(0,O.iv)([eo.KP.fullWidth,eo.KP.scroll]),children:(0,o.tZ)(en.Z.Html,{html:l.scheme.description})})]})})})}):(0,o.tZ)(T.Z,{children:(0,o.tZ)(ej.Z,{})})};var tQ=l(32808);let t$=e=>{let{label:t,css:l,defaultValue:i,defaultChecked:n,onValueChange:a,onCheckedChange:r,unit:d}=e,[s,u]=(0,c.useState)(String(null!=i?i:0)),[m,h]=(0,c.useState)(!!n),[p,y]=(0,c.useState)(void 0!==n&&!n),[v,Z]=(0,c.useState)(0),[f,g]=(0,c.useState)(!1);(0,c.useEffect)(()=>{u(String(null!=i?i:0))},[i]),(0,c.useEffect)(()=>{h(!!n)},[n]);let b=(0,c.useCallback)(e=>{let t=e.target.checked;h(t),g(!0),null==r||r(t),y(!t)},[r]),C=(0,c.useCallback)(e=>{v&&clearTimeout(v);let t=setTimeout(()=>{a(e),g(!1)},500);Z(+t)},[v,a]),x=(0,c.useCallback)(e=>{let t=e.target.value;u(t),g(!0),C(t)},[C]);return(0,o.tZ)(M.Z,{css:(0,O.iv)({...eo.KP.fullWidth,...l||{}}),align:"start",children:(0,o.tZ)(ep.Z,{layout:"vertical",children:(0,o.tZ)(ep.Z.Item,{label:(0,o.BX)(o.HY,{children:[void 0!==n&&(0,o.tZ)(tQ.Z,{checked:m,onChange:b,style:{marginRight:"5px"}}),t]}),children:(0,o.tZ)(ey.Z,{disabled:p,value:s,onChange:x,addonAfter:(0,o.BX)(M.Z,{css:eo.KP.fullWidth,children:[(0,o.tZ)(en.Z.Inline,{text:d}),f?(0,o.tZ)(S.Z,{spin:!0,css:eo.KP.textOrange}):(0,o.tZ)(w.Z,{css:eo.KP.textGreen})]})})})})})},t0={update:"Unable to update simulation"},t1=async(e,t,l)=>{try{let i=tA.Z.deepCopy(e);i.scheme.configuration.geometry.meshParameters={type:t,value:"auto"===t?"normal":"1"};let n={...i.scheme.configuration.geometry,done:!0};await Y.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","geometry"],value:n}]),await Y.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","run"],value:{...i.scheme.configuration.run,done:!1}}]),l.mutateOneSimulation(i)}catch(a){throw(0,A.lt)(t0.update,a),a}},t2=async(e,t,l,i)=>{try{let n=tA.Z.deepCopy(e);n.scheme.configuration.geometry.meshParameters={...n.scheme.configuration.geometry.meshParameters,type:t,value:l};let a={...n.scheme.configuration.geometry,done:!0};await Y.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","geometry"],value:a}]),await Y.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","run"],value:{...n.scheme.configuration.run,done:!1}}]),i.mutateOneSimulation(n)}catch(r){throw(0,A.lt)(t0.update,r),r}},t5=e=>{let{simulation:t,swr:l}=e,[i,n]=(0,c.useState)(),[a,r]=(0,c.useState)();(0,c.useEffect)(()=>{let e=t.scheme.configuration.geometry.meshParameters;e?(n(e.type),r(e.value)):(n("auto"),r("normal"))},[t]);let d=(0,c.useCallback)(async e=>{try{await t2(t,i,e,l),r(e)}catch(n){}},[t,i,l]);return(0,o.tZ)(T.Z,{size:"small",title:"Mesh refinement",children:(0,o.BX)(M.Z,{direction:"vertical",css:eo.KP.fullWidth,children:[(0,o.tZ)(ep.Z,{layout:"vertical",children:(0,o.tZ)(ep.Z.Item,{label:"Type",children:(0,o.BX)(tj.Z,{css:eo.KP.fullWidth,value:i,async onChange(e){try{await t1(t,e,l),n(e),"auto"===e?r("normal"):r("1")}catch(i){}},children:[(0,o.tZ)(tj.Z.Option,{value:"auto",children:"Automatic"}),(0,o.tZ)(tj.Z.Option,{value:"manual",children:"Manual"})]})})}),"auto"===i&&(0,o.tZ)(ep.Z,{layout:"vertical",children:(0,o.tZ)(ep.Z.Item,{label:"Size",children:(0,o.BX)(tj.Z,{css:eo.KP.fullWidth,value:a,onChange:d,children:[(0,o.tZ)(tj.Z.Option,{value:"veryfine",children:"Very fine"}),(0,o.tZ)(tj.Z.Option,{value:"fine",children:"Fine"}),(0,o.tZ)(tj.Z.Option,{value:"normal",children:"Normal"}),(0,o.tZ)(tj.Z.Option,{value:"coarse",children:"Coarse"}),(0,o.tZ)(tj.Z.Option,{value:"verycoarse",children:"Very coarse"})]})})}),"manual"===i&&(0,o.tZ)(t$,{label:"Size",defaultValue:a,onValueChange:d,unit:"m"})]})})},t4={update:"Unable to update simulation"},t3=async(e,t,l,i,n)=>{try{var a;let r=tA.Z.deepCopy(e),o=t.find(e=>e.id===l);r.scheme.configuration.geometry.value=l,r.scheme.configuration.geometry.values=void 0;let d={...r.scheme.configuration,dimension:null!==(a=o.summary.dimension)&&void 0!==a?a:3,geometry:{...r.scheme.configuration.geometry,done:!0},run:{...r.scheme.configuration.run,done:!1}};await Y.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration"],value:d}]),n.mutateOneSimulation(r),i([o])}catch(s){(0,A.lt)(t4.update,s)}},t8=async(e,t,l,i,n)=>{try{var a;if(!l.length)return;let r=tA.Z.deepCopy(e),o=t.filter(e=>l.includes(e.id));r.scheme.configuration.geometry.value=void 0,r.scheme.configuration.geometry.values=l;let d={...r.scheme.configuration,dimension:null!==(a=o[0].summary.dimension)&&void 0!==a?a:3,geometry:{...r.scheme.configuration.geometry,done:!0},run:{...r.scheme.configuration.run,done:!1}};await Y.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration"],value:d}]),n.mutateOneSimulation(r),i(o)}catch(s){(0,A.lt)(t4.update,s)}},t6=e=>{let{loadedGeometries:t,geometries:l,simulation:i,setGeometries:n,swr:a}=e,r=i.scheme.configuration.geometry.multiple,d=i.scheme.configuration.geometry.n,s=i.scheme.configuration.geometry.value,u=i.scheme.configuration.geometry.values;r||s||!l.length?r&&!u&&l.length&&t8(i,t,l.map(e=>e.id),n,a):t3(i,t,l[0].id,n,a);let c=(0,o.tZ)("div",{css:tI.geometriesList,children:(0,o.tZ)(tj.Z,{mode:r?"multiple":void 0,options:t.map(e=>({value:e.id,label:e.name})),value:r?u:s,onChange(e){r?t8(i,t,e,n,a):t3(i,t,e,n,a)}})});return(0,o.BX)(o.HY,{children:[(0,o.tZ)(T.Z,{size:"small",children:(0,o.tZ)(y.Z.Text,{children:"When changing the simulation domain, you might lose your topological entity assignments"})}),(0,o.BX)(T.Z,{size:"small",children:[(0,o.tZ)(y.Z.Text,{strong:!0,children:"Select a simulation domain"}),d?(0,o.BX)(o.HY,{children:[(0,o.tZ)("br",{}),(0,o.BX)(y.Z.Text,{children:[d," geometries needed"]})]}):null]}),c,i.scheme.configuration.geometry.meshable&&(0,o.tZ)(t5,{simulation:{id:i.id,scheme:i.scheme},swr:{mutateOneSimulation:a.mutateOneSimulation}})]})},t7={update:"Unable to delete material"},t9=async(e,t,l,i)=>{try{let n=tA.Z.deepCopy(e),a=n.scheme.configuration.materials,r=a.values[t];r.selected.forEach(e=>{l(tc(e))}),a.values=[...a.values.slice(0,t),...a.values.slice(t+1)];let o={...a,done:!!a.values.length};await Y.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","materials"],value:o}]),i.mutateOneSimulation(n)}catch(d){throw(0,A.lt)(t7.update,d),d}},le=e=>{let{simulation:t,index:l,swr:i}=e,[n,a]=(0,c.useState)(!1),{dispatch:r}=(0,c.useContext)(H),d=t.scheme.configuration.materials,s=d.values[l];return(0,o.tZ)(N.m1,{loading:n,text:(0,o.BX)(o.HY,{children:["Are you sure you want to delete the material"," ",(0,o.tZ)(y.Z.Text,{strong:!0,children:s.material.label})]}),async onDelete(){a(!0);try{await t9(t,l,r,i)}finally{a(!1)}}})},lt=e=>{var t;let{geometries:l,simulation:i,swr:n,onEdit:a}=e,[r,d]=(0,c.useState)(!0),{dispatch:s}=(0,c.useContext)(H),u=i.scheme.configuration.materials,m=(0,c.useCallback)(e=>{s(tn());let t=u.values[e].geometry,i=l.find(e=>e.id===t);s(to(null==i?void 0:i.summary.uuid));let n=u.values[e].selected;null==n||n.forEach(e=>{s(tu(e))})},["".concat(l),u,s]),h=(0,c.useCallback)(()=>{s(ta())},[s]);return(0,o.tZ)(o.HY,{children:null===(t=u.values)||void 0===t?void 0:t.map((e,t)=>(0,o.tZ)(T.Z,{css:(0,O.iv)([eo.KP.textAlignCenter,tI.listItem]),hoverable:!0,onMouseEnter:()=>m(t),onMouseLeave(){r&&h()},actions:[(0,o.tZ)(N.w6,{onEdit(){d(!1),a(t),setTimeout(()=>d(!0),500)}},"edit"),(0,o.tZ)(le,{index:t,simulation:{id:i.id,scheme:i.scheme},swr:{mutateOneSimulation:n.mutateOneSimulation}},"delete")],children:(0,o.tZ)(y.Z.Text,{strong:!0,css:eo.KP.textAlignCenter,children:e.material.label})},t)).filter(e=>e)})};var ll=l(85265),li=l(51904),ln=l(13982),la=l(14618),lr=l(94668),lo=l(68795);let ld=e=>{var t;let{geometry:l,alreadySelected:i,updateSelected:n}=e,[a,r]=(0,c.useState)([]),[d,s]=(0,c.useState)(),[u,h]=(0,c.useState)(),{type:p,highlighted:Z,selected:f,dispatch:g}=(0,c.useContext)(H);(0,B.Z)(()=>{n(f)},[f],[n]),(0,c.useEffect)(()=>{var e;let t=[];p&&(null===(e=l.summary[p])||void 0===e||e.forEach(e=>{if(e.color){let l=t.find(t=>t.r===e.color.r&&t.g===e.color.g&&t.b===e.color.b);l||t.push(e.color)}})),r(t)},[l,p]);let b=(0,c.useCallback)(e=>{g(td(e))},[g]),w=(0,c.useCallback)(()=>{g(ts())},[g]),C=(0,c.useCallback)(e=>{f.find(t=>t.uuid===e.uuid)?g(tc(e)):g(tu(e))},[f,g]),x=(0,c.useCallback)(e=>{s(e)},[]),k=(0,c.useCallback)(()=>{s(void 0)},[]),S=(0,c.useCallback)(()=>{var e;null===(e=l.summary[p])||void 0===e||e.forEach(e=>{var t,l,i;(!d||d&&d.r===(null===(t=e.color)||void 0===t?void 0:t.r)&&d.g===(null===(l=e.color)||void 0===l?void 0:l.g)&&d.b===(null===(i=e.color)||void 0===i?void 0:i.b))&&g(tu({uuid:e.uuid,label:e.label}))})},[l,p,d,g]),P=(0,c.useCallback)(()=>{var e;null===(e=l.summary[p])||void 0===e||e.forEach(e=>{var t,l,i;(!d||d&&d.r===(null===(t=e.color)||void 0===t?void 0:t.r)&&d.g===(null===(l=e.color)||void 0===l?void 0:l.g)&&d.b===(null===(i=e.color)||void 0===i?void 0:i.b))&&g(tc({uuid:e.uuid,label:e.label}))})},[l,p,d,g]),E=(0,c.useCallback)(()=>{var e;null===(e=l.summary[p])||void 0===e||e.forEach(e=>{var t,l,i;(!d||d&&d.r===(null===(t=e.color)||void 0===t?void 0:t.r)&&d.g===(null===(l=e.color)||void 0===l?void 0:l.g)&&d.b===(null===(i=e.color)||void 0===i?void 0:i.b))&&f.find(t=>t.uuid===e.uuid)?g(tc({uuid:e.uuid,label:e.label})):g(tu({uuid:e.uuid,label:e.label}))})},[l,f,p,d,g]),j=(0,c.useCallback)(e=>{let t=e.target.value;h(t)},[]),X=(0,c.useCallback)(e=>{var t,l,i;return(!d||d.r===(null===(t=e.color)||void 0===t?void 0:t.r)&&d.g===(null===(l=e.color)||void 0===l?void 0:l.g)&&d.b===(null===(i=e.color)||void 0===i?void 0:i.b))&&(!u||!e.name||!!e.name.includes(u))},[d,u]);return(0,o.BX)(T.Z,{size:"small",css:eo.KP.noBorderBottom,children:[(0,o.BX)(M.Z,{direction:"vertical",css:eo.KP.fullWidth,children:[(0,o.tZ)(y.Z.Text,{strong:!0,children:"Filters"}),(0,o.BX)(M.Z,{direction:"horizontal",wrap:!0,children:[a.length>1&&(0,o.BX)(o.HY,{children:[(0,o.tZ)(m.Z,{title:"Reset",children:(0,o.tZ)(v.Z,{icon:(0,o.tZ)(et.Z,{}),onClick:k})}),a.map(e=>(0,o.tZ)(m.Z,{title:"Color",children:(0,o.tZ)(v.Z,{style:{backgroundColor:tA.Z.rgbToHex(e)},onClick:()=>x(e),children:" "})},JSON.stringify(e)))]}),(0,o.tZ)(m.Z,{title:"Select all",children:(0,o.tZ)(v.Z,{icon:(0,o.tZ)(ln.Z,{}),onClick:S})}),(0,o.tZ)(m.Z,{title:"Unselect all",children:(0,o.tZ)(v.Z,{icon:(0,o.tZ)(la.Z,{}),onClick:P})}),(0,o.tZ)(m.Z,{title:"Swap",children:(0,o.tZ)(v.Z,{icon:(0,o.tZ)(lr.Z,{}),onClick:E})})]}),(0,o.tZ)(ey.Z,{placeholder:"Search",value:u,onChange:j,suffix:(0,o.tZ)(lo.Z,{css:eo.KP.textLight})})]}),(0,o.tZ)("div",{css:(0,O.iv)([eo.KP.fullWidth,eo.Ml.marginTop(20)]),children:p?null===(t=l.summary[p])||void 0===t?void 0:t.map((e,t)=>{if(X(e)){let l="transparent",n="transparent";return f.find(t=>t.uuid===e.uuid)?(l="#EE9817",n="rgba(238, 152, 23, 0.3)"):(null==Z?void 0:Z.uuid)===e.uuid&&(l="#FAD114",n="rgba(250, 209, 20, 0.3)"),(0,o.tZ)(T.Z,{css:eo.Ml.marginBottom(10),bodyStyle:{position:"relative",padding:"10px 10px 10px 40px",borderWidth:"2px",borderStyle:"solid",borderColor:l,backgroundColor:n},onMouseEnter:()=>b({uuid:e.uuid,label:e.label}),onMouseLeave:w,onClick:()=>C({uuid:e.uuid,label:e.label}),children:(0,o.BX)(M.Z,{direction:"vertical",children:[(0,o.BX)("div",{children:[(0,o.tZ)("div",{style:{position:"absolute",left:"-2px",top:"-2px",bottom:"-2px",width:"30px",backgroundColor:tA.Z.rgbToRgba(e.color,1)}}),e.name]}),null==i?void 0:i.map(t=>{if(t.selected.find(t=>t.uuid===e.uuid))return(0,o.tZ)(li.Z,{color:tA.Z.stringToColor(t.label),children:t.label},e.uuid)})]})},t)}}):[]})]})};var ls=l(51158),lu=l(13520),lc=l(23226);let lm=e=>{let{onSelect:t}=e,[l,i]=(0,c.useState)(),[n,a]=(0,c.useState)(),[r,d]=(0,c.useState)(),[s,u]=(0,c.useState)(),m=Object.keys(lc.E),y=(0,c.useCallback)(e=>{let{key:t}=e,l=lc.E[t];a({key:t,children:l.children}),d(void 0),u(void 0)},[]),Z=(0,c.useCallback)(e=>{let{key:t}=e,l=lc.E[n.key],i=l.children.find(e=>e.key===t);d({key:t}),u(i)},[n]),f=(0,c.useCallback)(e=>{t(e),i(!1)},[t]);return(0,o.BX)(o.HY,{children:[(0,o.tZ)(v.Z,{icon:(0,o.tZ)(lu.Z,{}),onClick:()=>i(!0),css:eo.KP.fullWidth,children:"Pick a material"}),(0,o.tZ)(tT.Z,{open:l,title:"Material database",onCancel:()=>i(!1),onOk:()=>f(s),okText:"Choose",okButtonProps:{disabled:!s},width:"50%",children:(0,o.tZ)(h.Z,{children:(0,o.tZ)(h.Z.Content,{children:(0,o.BX)(M.Z,{style:{alignItems:"stretch"},children:[(0,o.tZ)(p.Z,{mode:"inline",items:m.map(e=>({key:e,label:lc.E[e].label})),onClick:y}),(0,o.tZ)(p.Z,{mode:"inline",items:null==n?void 0:n.children.map(e=>({key:e.key,label:e.label})),selectedKeys:(null==r?void 0:r.key)?[null==r?void 0:r.key]:[],onClick:Z}),s&&(0,o.tZ)(ls.ZP,{itemLayout:"vertical",children:s.children.map(e=>(0,o.BX)(ls.ZP.Item,{children:[e.label,": ",e.symbol," = ",e.value]},e.label))})]})})})})]})},lh={material:"You need to define a material",selected:"You need to select a solid",update:"Unable to add material"},lp=async(e,t,l)=>{try{let i=tA.Z.deepCopy(t);i.uuid=(0,eU.Z)();let n=tA.Z.deepCopy(e),a=n.scheme.configuration.materials;a.values=[...a.values||[],i];let r={...a,done:!0};await Y.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","materials"],value:r}]),await Y.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","run"],value:{...n.scheme.configuration.run,done:!1}}]),l.mutateOneSimulation(n)}catch(o){throw(0,A.lt)(lh.update,o),o}},ly=e=>{let{simulation:t,material:l,swr:i,onError:n,onClose:a}=e,[r,d]=(0,c.useState)(!1);return(0,o.tZ)(N.HS,{loading:r,needMargin:!0,async onAdd(){d(!0);try{var e;if(!l.material){n(lh.material),d(!1);return}if(!(null===(e=l.selected)||void 0===e?void 0:e.length)){n(lh.selected),d(!1);return}n(),await lp(t,l,i),d(!1),a()}catch(r){d(!1)}},children:"Add"})},lv={material:"You need to define a material",selected:"You need to select a solid",update:"Unable to edit material"},lZ=async(e,t,l)=>{try{let i=tA.Z.deepCopy(e),n=i.scheme.configuration.materials,a=n.values.findIndex(e=>e.uuid===t.uuid);n.values=[...n.values.slice(0,a),t,...n.values.slice(a+1)];let r={...n};await Y.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","materials"],value:r}]),l.mutateOneSimulation(i)}catch(o){throw(0,A.lt)(lv.update,o),o}},lf=e=>{let{simulation:t,material:l,swr:i,onError:n,onClose:a}=e,[r,d]=(0,c.useState)(!1);return(0,o.tZ)(N.w6,{loading:r,primary:!0,needMargin:!0,async onEdit(){d(!0);try{var e;if(!l.material){n(lv.material),d(!1);return}if(!(null===(e=l.selected)||void 0===e?void 0:e.length)){n(lv.selected),d(!1);return}n(),await lZ(t,l,i),d(!1),a()}catch(r){d(!1)}},children:"Edit"})},lg=e=>{var t,l,i,n,a,r,d;let{visible:s,geometries:u,simulation:m,material:h,swr:p,onClose:Z}=e,[f,g]=(0,c.useState)(),[b,w]=(0,c.useState)(),[C,k]=(0,c.useState)(),[S,P]=(0,c.useState)(),{dispatch:E}=(0,c.useContext)(H),O=m.scheme.configuration.materials;(0,B.Z)(()=>{var e;E(to(null===(e=u[0])||void 0===e?void 0:e.summary.uuid)),k(null==h?void 0:h.geometry)},[u,h],[E]),(0,B.Z)(()=>{!s&&b&&w(void 0)},[s,b]),(0,B.Z)(()=>{var e;s&&!b&&h?w(h):!s||b||h||w({material:{label:"Default",children:(null==O?void 0:O.children.map(e=>({label:e.label,symbol:e.name,value:e.default})))||[]},geometry:null===(e=u[0])||void 0===e?void 0:e.id})},[s,u,O,b]),(0,B.Z)(()=>{var e;let t=null==O?void 0:null===(e=O.values)||void 0===e?void 0:e.map(e=>{if(e.uuid!==(null==h?void 0:h.uuid))return{label:e.material.label,selected:e.selected}}).filter(e=>e);g(t||[])},[m,h,O]);let j=(0,c.useCallback)(e=>{w(t=>({...t,material:e}))},[]),X=(0,c.useCallback)((e,t,l)=>{w(i=>{var n,a,r,o;return{...i,material:{label:"Custom",children:[...(null==i?void 0:null===(n=i.material)||void 0===n?void 0:null===(a=n.children)||void 0===a?void 0:a.slice(0,t))||[],{label:e.label,symbol:e.name,value:l},...(null==i?void 0:null===(r=i.material)||void 0===r?void 0:null===(o=r.children)||void 0===o?void 0:o.slice(t+1))||[]]}}})},[]),z=(0,c.useCallback)(e=>{w(t=>({...t,selected:e}))},[]),L=(0,c.useCallback)(e=>{k(e);let t=u.find(t=>t.id===e);E(to(t.summary.uuid)),w(t=>({...t,geometry:e}))},[u,E]);return(0,o.tZ)(ll.Z,{css:el.subPanel,title:"Material",placement:"left",closable:!1,open:s,mask:!1,maskClosable:!1,width:300,extra:(0,o.tZ)(v.Z,{type:"text",icon:(0,o.tZ)(et.Z,{}),onClick(){w(void 0),Z()}}),footer:(0,o.BX)("div",{style:{display:"flex",justifyContent:"flex-end"},children:[(0,o.tZ)(N.Lw,{onCancel(){w(void 0),Z()}}),h?(0,o.tZ)(lf,{material:{uuid:null!==(i=null==b?void 0:b.uuid)&&void 0!==i?i:h.uuid,material:null!==(n=null==b?void 0:b.material)&&void 0!==n?n:h.material,geometry:null!==(a=null==b?void 0:b.geometry)&&void 0!==a?a:h.geometry,selected:null!==(r=null==b?void 0:b.selected)&&void 0!==r?r:h.selected},simulation:{id:m.id,scheme:m.scheme},swr:{mutateOneSimulation:p.mutateOneSimulation},onError:e=>P(e),onClose(){w(void 0),Z()}}):(0,o.tZ)(ly,{material:{material:null==b?void 0:b.material,geometry:null==b?void 0:b.geometry,selected:null==b?void 0:b.selected},simulation:{id:m.id,scheme:m.scheme},swr:{mutateOneSimulation:p.mutateOneSimulation},onError:e=>P(e),onClose(){w(void 0),Z()}})]}),children:(0,o.BX)(M.Z,{direction:"vertical",css:eo.KP.fullWidth,children:[(0,o.tZ)(T.Z,{size:"small",children:(0,o.BX)(M.Z,{direction:"vertical",css:eo.KP.fullWidth,children:[(0,o.tZ)(lm,{onSelect:j}),(0,o.BX)(y.Z.Text,{children:["Material: ",null!==(d=null==b?void 0:null===(t=b.material)||void 0===t?void 0:t.label)&&void 0!==d?d:"default"]}),null==O?void 0:null===(l=O.children)||void 0===l?void 0:l.map((e,t)=>{var l,i;let n=null==b?void 0:null===(l=b.material)||void 0===l?void 0:null===(i=l.children)||void 0===i?void 0:i.find(t=>t.symbol===e.name);return(0,o.tZ)(t$,{label:e.name,defaultValue:n?n.value:String(e.default),unit:e.unit,onValueChange(l){X(e,t,l)}},e.name)})]})}),(0,o.tZ)(tM.Z,{items:u.map(e=>({key:e.id,label:e.name,children:(0,o.tZ)(ld,{geometry:e,alreadySelected:f,updateSelected:z})})),activeKey:C,onChange:L}),S&&(0,o.BX)(y.Z.Text,{children:[(0,o.tZ)(x.Z,{style:{color:"red"}})," ",S]})]})})},lb=e=>{let{geometries:t,simulation:l,swr:i,setVisible:n}=e,[a,r]=(0,c.useState)(),[d,s]=(0,c.useState)(!1),{dispatch:u}=(0,c.useContext)(H),m=l.scheme.configuration.materials;(0,B.Z)(()=>{var e;(null===(e=t[0])||void 0===e?void 0:e.summary)&&u(tr(2===t[0].summary.dimension?"faces":"solids"))},[t],[u]);let p=(0,c.useCallback)(()=>{r(void 0),s(!0),n(!1),u(tn())},[u,n]),y=(0,c.useCallback)(e=>{let t=m.values[e];r(t),s(!0),n(!1),u(tn())},[m,u,n]),v=(0,c.useCallback)(()=>{u(ta()),s(!1),r(void 0),n(!0)},[u,n]);return t.length?(0,o.tZ)(h.Z,{children:(0,o.tZ)(h.Z.Content,{children:(0,o.BX)(T.Z,{size:"small",children:[(0,o.tZ)(N.HS,{onAdd:p,fullWidth:!0,primary:!1,children:"Add material"}),(0,o.tZ)(lt,{geometries:t.map(e=>({id:e.id,summary:e.summary})),simulation:{id:l.id,scheme:l.scheme},swr:i,onEdit:y}),(0,o.tZ)(lg,{visible:d,geometries:t.map(e=>({id:e.id,name:e.name,summary:e.summary})),simulation:{id:l.id,scheme:l.scheme},material:a&&{uuid:a.uuid,material:a.material,geometry:a.geometry,selected:a.selected},swr:{mutateOneSimulation:i.mutateOneSimulation},onClose:v})]})})}):(0,o.tZ)(j.Z.Simple,{})};var lw=l(15045);let lC={update:"Unable to update simulation"},lx=(e,t,l)=>(0,o.tZ)(t$,{label:t.label2D||t.label,defaultValue:null!==(n=t.value)&&void 0!==n?n:t.default,onValueChange:l,unit:t.unit},e),lk=(e,t,l)=>{var i;return(0,o.tZ)(ep.Z,{layout:"vertical",children:(0,o.tZ)(ep.Z.Item,{label:t.label2D||t.label,children:(0,o.tZ)(tj.Z,{options:null===(i=t.options)||void 0===i?void 0:i.map(e=>({label:e.label,value:null!==(a=e.value2D)&&void 0!==a?a:e.value})),defaultValue:t.value||t.default2D||t.default,onChange:l})})},e)},lS=(e,t,l)=>(0,o.tZ)(ep.Z,{layout:"horizontal",children:(0,o.tZ)(ep.Z.Item,{label:t.label2D||t.label,children:(0,o.tZ)(tQ.Z,{defaultChecked:t.value,onChange:l})})},e),lP=(e,t,l)=>(0,o.tZ)(t$,{label:t.label,defaultValue:null!==(r=t.value)&&void 0!==r?r:t.default,onValueChange:l,unit:t.unit},e),lE=(e,t,l)=>(0,o.tZ)(ep.Z,{layout:"vertical",children:(0,o.tZ)(ep.Z.Item,{label:t.label,children:(0,o.tZ)(tj.Z,{options:t.options,defaultValue:t.value||t.default,onChange:l})})},e),lO=(e,t,l)=>(0,o.tZ)(ep.Z,{layout:"horizontal",children:(0,o.tZ)(ep.Z.Item,{label:t.label,children:(0,o.tZ)(tQ.Z,{defaultChecked:t.value,onChange:l})})},e),lB=async(e,t)=>{try{let l=tA.Z.deepCopy(e),i=l.scheme.configuration.parameters,n={...i,done:!0};await Y.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","parameters"],value:n}]),await Y.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","run"],value:{...l.scheme.configuration.run,done:!1}}]),t.mutateOneSimulation(l)}catch(a){(0,A.lt)(lC.update,a)}},lj=async(e,t,l,i,n)=>{try{let a=tA.Z.deepCopy(e),r=a.scheme.configuration.parameters,o=r[t];o.children[l].value=i;let d={...r,done:!0};await Y.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","parameters"],value:d}]),await Y.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","run"],value:{...a.scheme.configuration.run,done:!1}}]),n.mutateOneSimulation(a)}catch(s){(0,A.lt)(lC.update,s)}},lT=e=>{let{simulation:t,swr:l}=e,i=null==t?void 0:t.scheme.configuration.parameters,n=null==t?void 0:t.scheme.configuration.dimension;(0,c.useEffect)(()=>{(null==i?void 0:i.done)||lB(t,l)},[t,i,l]);let a=[],r=[];return 2===n?Object.keys(i).forEach(e=>{if("index"===e||"title"===e||"done"==e)return;let n=i[e],d=null==n?void 0:n.children.map((i,n)=>{if(!i.only3D){if("formula"===i.htmlEntity)return lx(e+"&"+n,i,i=>lj(t,e,n,i,l));if("select"===i.htmlEntity)return lk(e+"&"+n,i,i=>lj(t,e,n,i,l));if("checkbox"===i.htmlEntity)return lS(e+"&"+n,i,i=>lj(t,e,n,i.target.checked,l))}});(null==n?void 0:n.advanced)?r.push((0,o.tZ)(T.Z,{size:"small",title:null==n?void 0:n.label,children:(0,o.tZ)(M.Z,{direction:"vertical",children:d})},e)):a.push((0,o.tZ)(T.Z,{size:"small",title:null==n?void 0:n.label,children:(0,o.tZ)(M.Z,{direction:"vertical",children:d})},e))}):Object.keys(i).forEach(e=>{if("index"===e||"title"===e||"done"==e)return;let n=i[e],d=null==n?void 0:n.children.map((i,n)=>"formula"===i.htmlEntity?lP(e+"&"+n,i,i=>lj(t,e,n,i,l)):"select"===i.htmlEntity?lE(e+"&"+n,i,i=>lj(t,e,n,i,l)):"checkbox"===i.htmlEntity?lO(e+"&"+n,i,i=>lj(t,e,n,i.target.checked,l)):void 0);(null==n?void 0:n.advanced)?r.push((0,o.tZ)(T.Z,{size:"small",title:null==n?void 0:n.label,children:(0,o.tZ)(M.Z,{direction:"vertical",children:d})},e)):a.push((0,o.tZ)(T.Z,{size:"small",title:null==n?void 0:n.label,children:(0,o.tZ)(M.Z,{direction:"vertical",children:d})},e))}),(0,o.tZ)(h.Z,{children:(0,o.tZ)(h.Z.Content,{children:(0,o.BX)(M.Z,{direction:"vertical",children:[a,(0,o.tZ)(lw.Z,{children:(0,o.tZ)(lw.Z.Panel,{header:"Advanced",children:(0,o.tZ)(M.Z,{direction:"vertical",children:r})},"advanced")})]})})})},lM=(e,t)=>e.map(e=>{let l=e.fileName.replace(RegExp(t.prefixPattern),"").replace(RegExp(t.suffixPattern),"");return{...e,number:+l}}),lX=(e,t)=>{let l=t.multiplicator;if(l){var i;let n=l.reduce((e,t)=>e[t],e);return null!==(i=n.value)&&void 0!==i?i:n.default}},lz={update:"Unable to update simulation"},lL=async(e,t,l)=>{try{let i=tA.Z.deepCopy(e),n=i.scheme.configuration.initialization;n.value={type:t},await Y.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","initialization"],value:n}]),l.mutateOneSimulation(i)}catch(a){throw(0,A.lt)(lz.update,a),a}},lN=async(e,t,l,i)=>{try{var n;let a=await lI(e,l),r=tA.Z.deepCopy(t),o=r.scheme.configuration.initialization;o.value={...o.value,simulation:l,result:null==a?void 0:null===(n=a[0])||void 0===n?void 0:n.value},await Y.Z.update({id:t.id},[{key:"scheme",type:"json",method:"set",path:["configuration","initialization"],value:o}]),i.mutateOneSimulation(r)}catch(d){throw(0,A.lt)(lz.update,d),d}},lA=async(e,t,l,i)=>{try{let n=tA.Z.deepCopy(e),a=n.scheme.configuration.initialization;a.value={...a.value,number:+t,result:l.file},await Y.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","initialization"],value:a}]),i.mutateOneSimulation(n)}catch(r){(0,A.lt)(lz.update,r)}},lR=async(e,t,l,i)=>{try{let n=tA.Z.deepCopy(e),a=n.scheme.configuration.initialization;a.value.values||(a.value.values=[]),a.value.values[t]=l,await Y.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","initialization"],value:a}]),i.mutateOneSimulation(n)}catch(r){(0,A.lt)(lz.update,r)}},lI=async(e,t)=>{var l;let i=await Y.Z.tasks({id:t}),n=e.find(e=>e.id===t),a=n.scheme.configuration,r=null==a?void 0:null===(l=a.run)||void 0===l?void 0:l.resultsFilter,o=[];return i.forEach(e=>{if(e.file&&"result"===e.file.type&&o.push({label:e.file.fileName,value:e.file.fileName,file:e.file.fileName}),e.files){if(r){let t=RegExp(r.pattern),l=e.files.filter(e=>!t.test(e.fileName)).filter(e=>"result"===e.type),i=e.files.filter(e=>t.test(e.fileName)),n=lM(i,r),d=n.map(e=>({number:e.number,fileName:e.fileName.replace(RegExp(r.suffixPattern),"")})).filter((e,t,l)=>l.findIndex(t=>t.number===e.number)===t).sort((e,t)=>e.number-t.number),s=lX(a,r),u=d.map((e,t)=>{let l=s?e.number*s:t;return{label:String(Math.round(1e15*l)/1e15),value:e.fileName,file:e.fileName}});o.push(...l.map(e=>({label:e.fileName,value:e.fileName,file:e.fileName})).filter(e=>e)),o.push(...u)}else e.files.forEach(e=>{"result"===e.type&&o.push({label:e.fileName,value:e.fileName,file:e.fileName})})}}),o},lH=e=>{let{simulations:t,simulation:l,swr:i}=e,[n,a]=(0,c.useState)(!1),[r,d]=(0,c.useState)(),[s,u]=(0,c.useState)(),[m,p]=(0,c.useState)(),v=null==l?void 0:l.scheme.configuration.initialization,Z=null==l?void 0:l.scheme.configuration.dimension,f=(0,c.useCallback)(e=>{let l=t.find(t=>t.id===e);u(l)},[t]);(0,c.useEffect)(()=>{var e,t;!r&&v.value&&d(v.value.type),!s&&(null===(e=v.value)||void 0===e?void 0:e.simulation)&&f(null===(t=v.value)||void 0===t?void 0:t.simulation)},[v,r,s,f]),(0,c.useEffect)(()=>{s&&lI(t,s.id).then(e=>p(e))},[t,s]);let g=[{label:"None",value:"none"}];v.coupling&&g.push({label:v.coupling.label,value:"coupling"}),v.direct&&g.push({label:v.direct.label,value:"direct"});let b={none:(0,o.tZ)("div",{})},w=v.value;{let C=v.coupling;if(null==C?void 0:C.compatibility){let x=t.map(e=>{let t=e.id===l.id||!C.compatibility.find(t=>t.algorithm===e.scheme.algorithm);return{label:e.name,value:e.id,disabled:t}}),k=C.compatibility.find(e=>{var t;return e.algorithm===(null==s?void 0:null===(t=s.scheme)||void 0===t?void 0:t.algorithm)}),S=null==k?void 0:k.filter;b.coupling=(0,o.BX)(o.HY,{children:[(0,o.tZ)(y.Z.Text,{children:"If you use coupling, the selected simulation mesh will be used, at least for the first iteration."}),(0,o.BX)(M.Z,{direction:"vertical",css:(0,O.iv)([eo.KP.fullWidth,eo.Ml.marginTop(10)]),children:[(0,o.tZ)(tj.Z,{css:eo.KP.fullWidth,options:x,placeholder:"Select a simulation",value:null==w?void 0:w.simulation,async onChange(e){a(!0);try{await lN(t,l,e,i),f(e)}catch(n){}finally{a(!1)}}}),n&&(0,o.tZ)(ej.Z,{}),(null==m?void 0:m.length)?(0,o.BX)(o.HY,{children:[(0,o.BX)(y.Z.Text,{children:[null==S?void 0:S.name,":"]},"simulation"),(0,o.tZ)(tj.Z,{css:eo.KP.fullWidth,options:m,placeholder:"Select a "+S.name,value:null==w?void 0:w.result,async onChange(e,t){lA(l,e,t,i)}})]}):(0,o.tZ)(y.Z.Text,{type:"danger",children:"No results, please select an other simulation."})]})]})}let P=v.direct;(null==P?void 0:P.children)&&(b.direct=(0,o.tZ)(M.Z,{direction:"vertical",css:eo.KP.fullWidth,children:P.children.map((e,t)=>{var n,a;if(2!==Z||!e.only3D)return(0,o.tZ)(t$,{label:e.label,defaultValue:(null!==(a=null==w?void 0:null===(n=w.values)||void 0===n?void 0:n[t])&&void 0!==a?a:e.default).toString(),unit:e.unit,onValueChange:e=>lR(l,t,e,i)},t)})}))}return(0,o.tZ)(h.Z,{children:(0,o.tZ)(h.Z.Content,{children:(0,o.BX)(T.Z,{size:"small",children:[(0,o.tZ)(tj.Z,{css:(0,O.iv)([eo.KP.fullWidth,eo.Ml.marginTop(10)]),defaultValue:"none",value:r,options:g,async onChange(e){try{await lL(l,e,i),d(e)}catch(t){}}}),b[r||"none"]]})})})},lD={update:"Unable to delete boundary condition"},lK=async(e,t,l,i,n)=>{try{let a=tA.Z.deepCopy(e),r=a.scheme.configuration.boundaryConditions,o=r[t],d=o.values[l];d.selected.forEach(e=>{i(tc(e))}),o.values=[...o.values.slice(0,l),...o.values.slice(l+1)];let s=!1;Object.keys(r).forEach(e=>{var t;if("index"===e||"title"===e||"done"===e)return;let l=r[e];(null===(t=l.values)||void 0===t?void 0:t.length)&&(s=!0)});let u={...r,done:s};await Y.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","boundaryConditions"],value:u}]),n.mutateOneSimulation(a)}catch(c){throw(0,A.lt)(lD.update,c),c}},lU=e=>{let{type:t,index:l,simulation:i,swr:n}=e,[a,r]=(0,c.useState)(!1),{dispatch:d}=(0,c.useContext)(H),s=i.scheme.configuration.boundaryConditions,u=s[t],m=u.values[l];return(0,o.tZ)(N.m1,{loading:a,async onDelete(){r(!0);try{await lK(i,t,l,d,n)}finally{r(!1)}},text:(0,o.BX)(o.HY,{children:["Are you sure you want to delete the condition"," ",(0,o.tZ)(y.Z.Text,{strong:!0,children:null==m?void 0:m.name}),"?"]})})},lW=e=>{let{geometries:t,simulation:l,swr:i,onEdit:n}=e,[a,r]=(0,c.useState)(!0),{dispatch:d}=(0,c.useContext)(H),s=l.scheme.configuration.boundaryConditions,u=(0,c.useCallback)((e,l)=>{d(tn());let i=s[e],n=i.values[l].geometry,a=t.find(e=>e.id===n);d(to(null==a?void 0:a.summary.uuid));let r=i.values[l].selected;null==r||r.forEach(e=>{d(tu(e))})},["".concat(t),s,d]),m=(0,c.useCallback)(()=>{d(ta())},[d]);return(0,o.tZ)(o.HY,{children:Object.keys(s).map(e=>{var t;if("index"===e||"title"===e||"done"===e)return;let d=s[e];return null===(t=d.values)||void 0===t?void 0:t.map((t,s)=>(0,o.BX)(T.Z,{css:tI.listItem,hoverable:!0,onMouseEnter:()=>u(e,s),onMouseLeave(){a&&m()},actions:[(0,o.tZ)(N.w6,{onEdit(){r(!1),n(e,s),setTimeout(()=>r(!0),500)}},"edit"),(0,o.tZ)(lU,{simulation:{id:l.id,scheme:l.scheme},type:e,index:s,swr:{mutateOneSimulation:i.mutateOneSimulation}},"delete")],children:[(0,o.tZ)(y.Z.Text,{strong:!0,children:t.name})," ",(0,o.BX)(y.Z.Text,{children:["(",d.label,")"]})]},s))}).filter(e=>e)})};var lY=l(78045);let lV={name:"You need to define a name",type:"You need to select a type",selected:"You need to select a face",update:"Unable to add boundary condition"},lF=async(e,t,l)=>{try{let i={...t},n=i.type.key;i.uuid=(0,eU.Z)();let a=tA.Z.deepCopy(e),r=a.scheme.configuration.boundaryConditions,o=r[n];o.values=[...o.values||[],i];let d={...r,done:!0};await Y.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","boundaryConditions"],value:d}]),await Y.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","run"],value:{...a.scheme.configuration.run,done:!1}}]),l.mutateOneSimulation(a)}catch(s){throw(0,A.lt)(lV.update,s),s}},lG=e=>{let{simulation:t,boundaryCondition:l,swr:i,onError:n,onClose:a}=e,[r,d]=(0,c.useState)(!1);return(0,o.tZ)(N.HS,{loading:r,async onAdd(){d(!0);try{var e,r;if(!l.name){n(lV.name),d(!1);return}if(!(null===(e=l.type)||void 0===e?void 0:e.key)){n(lV.type),d(!1);return}if(!(null===(r=l.selected)||void 0===r?void 0:r.length)){n(lV.selected),d(!1);return}n(),await lF(t,l,i),d(!1),a()}catch(o){d(!1)}},needMargin:!0,children:"Add"})},lJ={name:"You need to define a name",type:"You need to select a type",selected:"You need to select a face",update:"Unable to edit boundary condition"},lq=async(e,t,l,i)=>{try{let n=tA.Z.deepCopy(e),a=n.scheme.configuration.boundaryConditions,r=t.type.key,o=l.type.key;if(o!==r){let d=a[o],s=d.values.findIndex(e=>e.uuid===l.uuid);d.values=[...d.values.slice(0,s),...d.values.slice(s+1)]}if(o!==r){let u=a[r];u.values=[...u.values||[],t]}else{let c=a[r],m=c.values.findIndex(e=>e.uuid===t.uuid);c.values=[...c.values.slice(0,m),t,...c.values.slice(m+1)]}let h={...a};await Y.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","boundaryConditions"],value:h}]),i.mutateOneSimulation(n)}catch(p){throw(0,A.lt)(lJ.update,p),p}},l_=e=>{let{simulation:t,boundaryCondition:l,oldBoundaryCondition:i,swr:n,onError:a,onClose:r}=e,[d,s]=(0,c.useState)(!1);return(0,o.tZ)(N.w6,{loading:d,async onEdit(){s(!0);try{var e,o;if(!l.name){a(lJ.name),s(!1);return}if(!(null===(e=l.type)||void 0===e?void 0:e.key)){a(lJ.type),s(!1);return}if(!(null===(o=l.selected)||void 0===o?void 0:o.length)){a(lJ.selected),s(!1);return}a(),await lq(t,l,i,n),s(!1),r()}catch(d){s(!1)}},primary:!0,needMargin:!0,children:"Edit"})},lQ=e=>{var t,l,i,n,a,r,d;let{visible:s,geometries:u,simulation:m,boundaryCondition:h,swr:p,onClose:Z}=e,[f,g]=(0,c.useState)([]),[b,w]=(0,c.useState)([]),[C,k]=(0,c.useState)(),[S,P]=(0,c.useState)(),[E,O]=(0,c.useState)(),[j,X]=(0,c.useState)(),{dispatch:z}=(0,c.useContext)(H),L=m.scheme.configuration.boundaryConditions,A=m.scheme.configuration.dimension;(0,B.Z)(()=>{var e;z(to(null===(e=u[0])||void 0===e?void 0:e.summary.uuid)),O(null==h?void 0:h.geometry)},[u,h],[z]),(0,B.Z)(()=>{!s&&S&&P(void 0)},[s,S]),(0,B.Z)(()=>{let e=Object.keys(L).map(e=>{if("index"===e||"title"===e||"done"===e)return;let t=L[e];return{key:e,label:t.label,children:t.children,values:t.values}}).filter(e=>e);w(e)},[L]),(0,B.Z)(()=>{let e=null==b?void 0:b.map(e=>{var t;return null===(t=e.values)||void 0===t?void 0:t.length}).filter(e=>e).reduce((e,t)=>e+t,0);k(e)},[b]),(0,B.Z)(()=>{s&&!S&&h?P(h):!s||S||h||void 0===C||P(e=>{var t;return{...e,name:"Boundary condition "+(C+1),geometry:null===(t=u[0])||void 0===t?void 0:t.id}})},[s,h,S,C]),(0,B.Z)(()=>{let e=Object.keys(L).map(e=>{var t;if("index"===e||"title"===e||"done"===e)return;let l=L[e];return null==l?void 0:null===(t=l.values)||void 0===t?void 0:t.map(e=>{if(e.uuid!==(null==h?void 0:h.uuid))return{label:e.name,selected:e.selected}}).filter(e=>e)}).flat().filter(e=>e);g(e)},[L,h]);let R=(0,c.useCallback)(e=>{let t=e.target.value;P(e=>({...e,name:t}))},[]),I=(0,c.useCallback)(e=>{var t;let l=e.target.value,i=b.find(e=>e.key===l),n=L[l],a=null===(t=n.children)||void 0===t?void 0:t.map(e=>({checked:!0,value:e.default}));P(e=>({...e,type:{key:i.key,label:i.label,children:i.children},values:a}))},["".concat(L),b]),D=(0,c.useCallback)((e,t)=>{P(l=>({...l,values:[...l.values.slice(0,e),{checked:l.values[e].checked,value:t},...l.values.slice(e+1)]}))},[]),K=(0,c.useCallback)((e,t)=>{P(l=>({...l,values:[...l.values.slice(0,e),{checked:t,value:l.values[e].value},...l.values.slice(e+1)]}))},[]),U=(0,c.useCallback)(e=>{P(t=>({...t,selected:e}))},[]),W=(0,c.useMemo)(()=>{var e;return(null==S?void 0:S.type)&&(null===(e=S.type)||void 0===e?void 0:e.children)?(0,o.tZ)(T.Z,{children:S.type.children.map((e,t)=>{if(2!==A||!e.only3D)return(0,o.tZ)(t$,{css:eo.Ml.marginBottom(10),label:e.label,defaultValue:String(S.values[t].value),defaultChecked:S.type.children.length>1?S.values[t].checked:void 0,onValueChange:e=>D(t,e),onCheckedChange:e=>K(t,e),unit:e.unit},t)})}):null},[S,A,K,D]),Y=(0,c.useCallback)(e=>{O(e);let t=u.find(t=>t.id===e);z(to(null==t?void 0:t.summary.uuid)),P(t=>({...t,geometry:e}))},["".concat(u),z]);return(0,o.tZ)(ll.Z,{css:el.subPanel,title:"Boundary condition",placement:"left",closable:!1,open:s,mask:!1,maskClosable:!1,width:300,extra:(0,o.tZ)(v.Z,{type:"text",icon:(0,o.tZ)(et.Z,{}),onClick(){P(void 0),Z()}}),footer:(0,o.BX)("div",{style:{display:"flex",justifyContent:"flex-end"},children:[(0,o.tZ)(N.Lw,{onCancel(){P(void 0),Z()}}),h?(0,o.tZ)(l_,{boundaryCondition:{uuid:null!==(l=null==S?void 0:S.uuid)&&void 0!==l?l:h.uuid,name:null!==(i=null==S?void 0:S.name)&&void 0!==i?i:h.name,type:null!==(n=null==S?void 0:S.type)&&void 0!==n?n:h.type,geometry:null!==(a=null==S?void 0:S.geometry)&&void 0!==a?a:h.geometry,selected:null!==(r=null==S?void 0:S.selected)&&void 0!==r?r:h.selected,values:null!==(d=null==S?void 0:S.values)&&void 0!==d?d:h.values},oldBoundaryCondition:{uuid:h.uuid,name:h.name,type:h.type,geometry:h.geometry,selected:h.selected,values:h.values},simulation:{id:m.id,scheme:m.scheme},swr:{mutateOneSimulation:p.mutateOneSimulation},onError:e=>X(e),onClose:Z}):(0,o.tZ)(lG,{boundaryCondition:{name:null==S?void 0:S.name,type:null==S?void 0:S.type,geometry:null==S?void 0:S.geometry,selected:null==S?void 0:S.selected,values:null==S?void 0:S.values},simulation:{id:m.id,scheme:m.scheme},swr:{mutateOneSimulation:p.mutateOneSimulation},onError:e=>X(e),onClose:Z})]}),children:(0,o.BX)(M.Z,{direction:"vertical",css:eo.KP.fullWidth,children:[(0,o.tZ)(T.Z,{size:"small",children:(0,o.tZ)(ep.Z,{layout:"vertical",children:(0,o.tZ)(ep.Z.Item,{label:(0,o.tZ)(y.Z.Text,{strong:!0,children:"Boundary condition name"}),children:(0,o.tZ)(ey.Z,{value:(null==S?void 0:S.name)||"",onChange:R,maxLength:50})})})}),(0,o.tZ)(T.Z,{size:"small",children:(0,o.tZ)(ep.Z,{layout:"vertical",children:(0,o.tZ)(ep.Z.Item,{label:(0,o.tZ)(y.Z.Text,{strong:!0,children:"Boundary condition type"}),children:(0,o.tZ)(lY.ZP.Group,{optionType:"button",buttonStyle:"solid",value:null==S?void 0:null===(t=S.type)||void 0===t?void 0:t.key,onChange:I,children:null==b?void 0:b.map(e=>(0,o.tZ)(lY.ZP.Button,{value:e.key,children:e.label},e.key))})})})}),W,(0,o.tZ)(tM.Z,{items:u.map(e=>({key:e.id,label:e.name,children:(0,o.tZ)(ld,{geometry:e,alreadySelected:f,updateSelected:U})})),activeKey:E,onChange:Y}),j&&(0,o.BX)(y.Z.Text,{children:[(0,o.tZ)(x.Z,{style:{color:"red"}})," ",j]})]})})},l$=e=>{let{simulation:t,geometries:l,swr:i,setVisible:n}=e,[a,r]=(0,c.useState)(),[d,s]=(0,c.useState)(!1),{dispatch:u}=(0,c.useContext)(H),m=t.scheme.configuration.boundaryConditions;(0,B.Z)(()=>{var e;(null===(e=l[0])||void 0===e?void 0:e.summary)&&u(tr(2===l[0].summary.dimension?"edges":"faces"))},[l],[u]);let p=(0,c.useCallback)(()=>{r(void 0),s(!0),n(!1),u(tn())},[u,n]),y=(0,c.useCallback)((e,t)=>{let l=m[e],i=l.values[t];r(i),s(!0),n(!1),u(tn())},[m,u,n]),v=(0,c.useCallback)(()=>{u(ta()),s(!1),r(void 0),n(!0)},[u,n]);return l.length?(0,o.tZ)(h.Z,{children:(0,o.tZ)(h.Z.Content,{children:(0,o.BX)(T.Z,{size:"small",children:[(0,o.tZ)(N.HS,{onAdd:p,fullWidth:!0,primary:!1,children:"Add boundary condition"}),(0,o.tZ)(lW,{geometries:l.map(e=>({id:e.id,summary:e.summary})),simulation:{id:t.id,scheme:t.scheme},swr:{mutateOneSimulation:i.mutateOneSimulation},onEdit:y}),(0,o.tZ)(lQ,{visible:d,geometries:l.map(e=>({id:e.id,name:e.name,summary:e.summary})),simulation:{id:t.id,scheme:t.scheme},boundaryCondition:a&&{uuid:a.uuid,name:a.name,type:a.type,geometry:a.geometry,selected:a.selected,values:a.values},swr:{mutateOneSimulation:i.mutateOneSimulation},onClose:v})]})})}):(0,o.tZ)(j.Z.Simple,{})};var l0=l(3363),l1=l(67841),l2=l(36027),l5=l(57184);let l4={name:"You need to define a name",point:"You need to select a point",formula:"You need to define a formula",update:"Unable to update simulation"},l3=async(e,t,l)=>{try{let i=tA.Z.deepCopy(e),n=i.scheme.configuration.run,a=t.index;n.sensors[a]={name:t.name,point:t.point,formula:t.formula},await Y.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","run"],value:n}]),l.mutateOneSimulation(i)}catch(r){throw(0,A.lt)(l4.update,r),r}},l8=e=>{let{simulation:t,sensor:l,onError:i,onClose:n,swr:a}=e,[r,d]=(0,c.useState)();return(0,o.tZ)(N.w6,{loading:r,primary:!0,needMargin:!0,async onEdit(){d(!0);try{if(!l.name){i(l4.name),d(!1);return}if(!l.point){i(l4.point),d(!1);return}if(!l.formula){i(l4.formula),d(!1);return}i(),await l3(t,l,a),d(!1),n()}catch(e){d(!1)}},children:"Edit"})},l6={name:"You need to define a name",point:"You need to select a point",formula:"You need to define a formula",update:"Unable to update simulation"},l7=async(e,t,l)=>{try{let i=tA.Z.deepCopy(e),n=i.scheme.configuration.run,a={...n,sensors:[...n.sensors||[],t]};await Y.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","run"],value:a}]),l.mutateOneSimulation(i)}catch(r){throw(0,A.lt)(l6.update,r),r}},l9=e=>{let{simulation:t,sensor:l,onError:i,onClose:n,swr:a}=e,[r,d]=(0,c.useState)();return(0,o.tZ)(N.HS,{loading:r,needMargin:!0,async onAdd(){d(!0);try{if(!l.name){i(l6.name),d(!1);return}if(!l.point){i(l6.point),d(!1);return}if(!l.formula){i(l6.formula),d(!1);return}i(),await l7(t,l,a),d(!1),n()}catch(e){d(!1)}},children:"Add"})},ie=e=>{var t,l,i,n,a,r;let{visible:d,simulation:s,sensor:u,onClose:h,swr:p}=e,[Z,f]=(0,c.useState)(),[g,b]=(0,c.useState)(),[w,C]=(0,c.useState)(),[k,S]=(0,c.useState)(),{point:P,dispatch:E}=(0,c.useContext)(H);(0,B.Z)(()=>{E(tr("point"))},[E]),(0,B.Z)(()=>{if(!u){let e=s.scheme.configuration.run;b("Sensor "+(e.sensors?e.sensors.length+1:1))}},[s,u]),(0,B.Z)(()=>{u&&(b(u.name),E(tm({x:u.point.x,y:u.point.y,z:u.point.z})),C(u.formula))},[u],[E]);let O=(0,c.useCallback)(()=>{f(!1),E(ta()),window.removeEventListener("click",O)},[E]),j=(0,c.useCallback)(()=>{Z?O():(f(!0),E(tn()),setTimeout(()=>window.addEventListener("click",O),50))},[Z,O,E]),X=(0,c.useCallback)((e,t,l)=>{E(tm({x:e,y:t,z:l}))},[E]),z=(0,c.useCallback)(e=>{C(e)},[]),L=(0,c.useCallback)(()=>{b(void 0),C(void 0),S(void 0),E(tm()),h()},[E,h]);return(0,o.tZ)(ll.Z,{title:"Sensor",placement:"left",closable:!1,open:d,mask:!1,maskClosable:!1,width:300,extra:(0,o.tZ)(v.Z,{type:"text",icon:(0,o.tZ)(et.Z,{}),onClick:L}),footer:(0,o.BX)("div",{style:{display:"flex",justifyContent:"flex-end"},children:[(0,o.tZ)(N.Lw,{onCancel:L}),u?(0,o.tZ)(l8,{simulation:s,sensor:{...u,name:g,point:P,formula:w},onError:S,onClose:L,swr:p}):(0,o.tZ)(l9,{simulation:s,sensor:{name:g,point:P,formula:w},onError:S,onClose:L,swr:p})]}),children:(0,o.BX)(M.Z,{direction:"vertical",css:eo.KP.fullWidth,children:[(0,o.BX)(T.Z,{size:"small",children:[(0,o.tZ)(y.Z.Text,{children:"Name"}),(0,o.tZ)(ey.Z,{value:g,onChange:e=>b(e.target.value)})]}),(0,o.tZ)(T.Z,{size:"small",children:(0,o.BX)(M.Z,{direction:"vertical",css:eo.KP.fullWidth,children:[(0,o.BX)(M.Z,{css:eo.KP.fullWidth,style:{justifyContent:"space-between"},children:[(0,o.tZ)(y.Z.Text,{children:"Point selection"}),(0,o.tZ)(m.Z,{title:"Pin in the geometry",children:(0,o.tZ)(v.Z,{size:"small",type:Z?"primary":"default",icon:(0,o.tZ)(l5.Z,{}),onClick:j})})]}),(0,o.tZ)(t$,{label:"X",defaultValue:null==P?void 0:P.x,onValueChange:e=>X(+e,null!==(t=null==P?void 0:P.y)&&void 0!==t?t:0,null!==(l=null==P?void 0:P.z)&&void 0!==l?l:0)}),(0,o.tZ)(t$,{label:"Y",defaultValue:null==P?void 0:P.y,onValueChange:e=>X(null!==(i=null==P?void 0:P.x)&&void 0!==i?i:0,+e,null!==(n=null==P?void 0:P.z)&&void 0!==n?n:0)}),(0,o.tZ)(t$,{label:"Z",defaultValue:null==P?void 0:P.z,onValueChange:e=>X(null!==(a=null==P?void 0:P.x)&&void 0!==a?a:0,null!==(r=null==P?void 0:P.y)&&void 0!==r?r:0,+e)})]})}),(0,o.tZ)(T.Z,{size:"small",css:eo.KP.noBorderBottom,children:(0,o.tZ)(t$,{label:"Formula",defaultValue:w,onValueChange:z})}),k&&(0,o.BX)(y.Z.Text,{children:[(0,o.tZ)(x.Z,{style:{color:"red"}})," ",k]})]})})},it={udpate:"Unable to update simulation"},il=async(e,t,l,i)=>{try{let n=tA.Z.deepCopy(e),a=n.scheme.configuration.run;l(tm()),a.sensors=[...a.sensors.slice(0,t),...a.sensors.slice(t+1)],await Y.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","run"],value:a}]),i.mutateOneSimulation(n)}catch(r){throw(0,A.lt)(it.udpate,r),r}},ii=e=>{let{simulation:t,index:l,swr:i}=e,[n,a]=(0,c.useState)(),{dispatch:r}=(0,c.useContext)(H),d=t.scheme.configuration.run,s=d.sensors[l];return(0,o.tZ)(N.m1,{loading:n,text:(0,o.BX)(o.HY,{children:["Are you sure you want to delete the sensor"," ",(0,o.tZ)(y.Z.Text,{strong:!0,children:s.name})]}),async onDelete(){a(!0);try{await il(t,l,r,i)}finally{a(!1)}}})},ia=e=>{var t;let{simulation:l,onEdit:i,swr:n}=e,[a,r]=(0,c.useState)(!0),d=l.scheme.configuration.run,{dispatch:s}=(0,c.useContext)(H),u=(0,c.useCallback)(e=>{s(tn()),s(tm(e.point))},[s]),m=(0,c.useCallback)(()=>{a&&s(tm()),s(ta())},[a,s]);return(0,o.tZ)(o.HY,{children:null===(t=d.sensors)||void 0===t?void 0:t.map((e,t)=>(0,o.tZ)(T.Z,{css:(0,O.iv)([eo.KP.textAlignCenter,tI.listItem]),hoverable:!0,onMouseEnter:()=>u(e),onMouseLeave:m,actions:[(0,o.tZ)(N.w6,{onEdit(){r(!1),i({...e,index:t}),setTimeout(()=>r(!0),500)}},"edit"),(0,o.tZ)(ii,{simulation:l,index:t,swr:n},"delete")],children:(0,o.tZ)(y.Z.Text,{strong:!0,css:eo.KP.textAlignCenter,children:e.name})},t))})},ir=e=>{let{simulation:t,setVisible:l,setResult:i,setPostprocessing:n,swr:a}=e,[r,d]=(0,c.useState)(),[s,u]=(0,c.useState)(),m=(0,c.useCallback)(()=>{i(void 0),n(void 0),u(void 0),l(!1),d(!0)},[l,i,n]),h=(0,c.useCallback)(e=>{i(void 0),n(void 0),u(e),l(!1),d(!0)},[l,i,n]),p=(0,c.useCallback)(()=>{u(void 0),l(!0),d(!1)},[l]);return(0,o.BX)(T.Z,{size:"small",title:"Sensors",children:[(0,o.tZ)(ie,{visible:r,simulation:t,sensor:s,onClose:p,swr:a}),(0,o.BX)(M.Z,{direction:"vertical",css:eo.KP.fullWidth,children:[(0,o.tZ)(v.Z,{css:eo.KP.fullWidth,disabled:!1,type:"primary",icon:(0,o.tZ)(l2.Z,{}),onClick:m,children:"Add a sensor"}),(0,o.tZ)(ia,{simulation:t,onEdit:h,swr:a})]})]})};var io=l(139),id=l(71270);let is={plugins:"Plugins error",pluginsLoad:"Unable to load plugins"},iu=e=>{let{disabled:t,cloudServer:i,onOk:n}=e,[a,r]=(0,c.useState)(!1),[d,m]=(0,c.useState)([]),h=(0,u.useRouter)(),[p,{errorPlugins:Z}]=id.Z.usePlugins();return(0,c.useEffect)(()=>{Z&&(0,A.lt)(is.plugins,Z)},[Z]),(0,c.useEffect)(()=>{tR.Z.list().then(e=>{m(e)}).catch(e=>{(0,A.lt)(is.pluginsLoad,e)})},[]),(0,o.BX)(T.Z,{size:"small",title:"Computational resource",children:[(0,o.tZ)(tT.Z,{open:a,title:"Computational resource",okButtonProps:{disabled:!0,style:{display:"none"}},onCancel:()=>r(!1),style:{width:"unset"},children:(0,o.BX)(M.Z,{direction:"vertical",children:[(0,o.BX)(y.Z.Text,{children:["Your computational resource does not appear in this list? Create one in your"," ",(0,o.tZ)(N.Qj,{onClick:()=>h.push({pathname:"/dashboard",query:{page:"account",tab:"hpc"}}),children:"account settings"})]}),(0,o.tZ)(M.Z,{align:"start",direction:"horizontal",wrap:!0,children:null==p?void 0:p.map(e=>{let t=d.find(t=>t.key===e.key);if(!t)return;let i=s()(()=>l(64546)("./".concat(t.key,"/src/components")));return(0,o.tZ)(T.Z,{title:e.configuration.name.value,children:(0,o.tZ)(i,{data:e.data,onSelect(t){(0,tL.merge)(e,t),n(e),r(!1)}})},e.uuid)})})]})}),(0,o.BX)(M.Z,{direction:"vertical",css:eo.KP.fullWidth,children:[i&&(0,o.BX)(o.HY,{children:[(0,o.BX)(y.Z.Text,{children:[(0,o.tZ)("span",{css:eo.KP.textLight,children:"Plugin:"})," ",i.name]}),(0,o.BX)(y.Z.Text,{children:[(0,o.tZ)("span",{css:eo.KP.textLight,children:"Name:"})," ",i.configuration.name.value]}),Object.keys(i.inUseConfiguration).map(e=>{let t=i.inUseConfiguration[e],l=t.value;return"boolean"==typeof l&&(l=l?"yes":"no"),(0,o.BX)(y.Z.Text,{children:[(0,o.BX)("span",{css:eo.KP.textLight,children:[t.label,":"]})," ",l]},e)})]}),(0,o.tZ)(v.Z,{css:eo.KP.fullWidth,disabled:t,type:i?"link":"primary",icon:(0,o.tZ)(io.Z,{}),onClick:()=>r(!0),children:i?"Modify the resource":"Select a resource"})]})]})};var ic=l(15360),im=l(25935),ih=l(48764).lW;let ip={log:"Unable to get system log"},iy=async(e,t)=>{try{let l=await Y.Z.log({id:e.id},t.systemLog),i=ih.from(l.log).toString();tT.Z.info({title:"System log",width:"unset",content:(0,o.tZ)("div",{style:{maxHeight:"70vh",overflow:"auto"},children:(0,o.tZ)("pre",{children:(0,o.tZ)("code",{children:(0,im.ZP)(i.replace(/\n\n/g,"\n").replace(/\n/g,"<br />"))})})})})}catch(n){(0,A.lt)(ip.log,n)}},iv=e=>{let{simulation:t,steps:l}=e,[i,n]=(0,c.useState)(!1),[a,r]=(0,c.useState)(!1);return(0,o.BX)(o.HY,{children:[(0,o.tZ)(ll.Z,{title:"Log",open:i,onClose:()=>n(!1),width:"50%",children:(0,o.tZ)(tM.Z,{items:null==l?void 0:l.map((e,l)=>{var i,n;return{key:""+l,label:e.label,children:(0,o.BX)(o.HY,{children:[e.systemLog&&(0,o.BX)(o.HY,{children:[(0,o.tZ)(v.Z,{loading:a,async onClick(){r(!0);try{await iy(t,e)}catch(l){}finally{r(!1)}},children:"Complete log"}),(0,o.tZ)("br",{})]}),e.link&&(0,o.BX)(o.HY,{children:[(0,o.tZ)("a",{href:"https://"+e.link.href,target:"_blank",rel:"noreferrer",children:(0,o.tZ)(v.Z,{type:"primary",children:e.link.label})}),(0,o.tZ)("br",{})]}),(0,o.BX)(lw.Z,{ghost:!0,children:[e.warning&&(0,o.tZ)(lw.Z.Panel,{css:tI.warning,header:(0,o.tZ)(y.Z.Text,{type:"warning",children:"Warnings"}),children:(0,im.ZP)(e.warning.replace(/\n\n/g,"\n").replace(/\n/g,"<br />"))},"warnings"),e.error&&(0,o.tZ)(lw.Z.Panel,{css:tI.error,header:(0,o.tZ)(y.Z.Text,{type:"danger",children:"Errors"}),children:(0,im.ZP)(e.error.replace(/\n\n/g,"\n").replace(/\n/g,"<br />"))},"errors")]}),(0,im.ZP)((null===(i=e.pluginLog)||void 0===i?void 0:i.replace(/\n\n/g,"\n").replace(/\n/g,"<br />"))||""),(0,im.ZP)((null===(n=e.log)||void 0===n?void 0:n.replace(/\n\n/g,"\n").replace(/\n/g,"<br />"))||"")]})}})})}),(0,o.tZ)(m.Z,{title:"Log",children:(0,o.tZ)(v.Z,{disabled:!l||!l.length,icon:(0,o.tZ)(ic.Z,{}),onClick:()=>n(!0)})})]})};var iZ=l(23430);let ig={download:"Unable to download file"},ib=async(e,t)=>{try{let l=await eP.download({id:e.id},{originPath:t.originPath,fileName:t.fileName}),i=await l.blob(),n=window.URL.createObjectURL(new Blob([i])),a=document.createElement("a");a.href=n,a.setAttribute("download",t.name+"."+t.fileName.split(".").pop()),a.click()}catch(r){(0,A.lt)(ig.download,r)}},iw=e=>{let{simulation:t,file:l}=e,[i,n]=(0,c.useState)(!1);return(0,o.tZ)(m.Z,{title:"Download",children:(0,o.tZ)(v.Z,{loading:i,icon:(0,o.tZ)(iZ.Z,{}),async onClick(){n(!0);try{await ib(t,l)}catch(e){}finally{n(!1)}}})})},iC={archive:"Unable to download archive"},ix=async e=>{try{let t=await eP.archive({id:e.id}),l=await t.blob(),i=window.URL.createObjectURL(new Blob([l])),n=document.createElement("a");n.href=i,n.setAttribute("download",e.scheme.name+".zip"),n.click()}catch(a){(0,A.lt)(iC.archive,a)}},ik=e=>{let{simulation:t}=e,[l,i]=(0,c.useState)(!1);return(0,o.tZ)(N.o6,{loading:l,async onDownload(){i(!0);try{await ix(t)}catch(e){}finally{i(!1)}}})},iS=e=>{var t;let{simulation:l,result:i,setResult:n}=e,[a,r]=(0,c.useState)(),[d,s]=(0,c.useState)(),[u,m]=(0,c.useState)(),h=null==l?void 0:null===(t=l.scheme)||void 0===t?void 0:t.configuration;return((0,B.Z)(()=>{var e;if(!(null==l?void 0:l.tasks)){r([]),s(void 0);return}let t=[],i=null==h?void 0:null===(e=h.run)||void 0===e?void 0:e.resultsFilter;l.tasks.forEach(e=>{if(e.file&&t.push(e.file),e.files){if(i){let l=RegExp(i.pattern),n=e.files.filter(e=>!l.test(e.fileName)),a=e.files.filter(e=>l.test(e.fileName)),r=lM(a,i),o=r.map(e=>e.number).filter((e,t,l)=>l.indexOf(e)===t).sort((e,t)=>e-t),d=lX(h,i),u=o.map((e,t)=>({label:Math.round(1e15*(d?e*d:t))/1e15,value:e}));t.push(...n),s({filtered:!0,name:i.name,files:r,options:u})}else t.push(...e.files)}}),r(t)},[l,h]),(0,B.Z)(()=>{!u&&d&&m(null==d?void 0:d.options[0].value)},[d,u]),a||d)?(null==a?void 0:a.length)||d?(0,o.tZ)(T.Z,{size:"small",title:"Results",extra:(0,o.tZ)(ik,{simulation:l&&{id:l.id,scheme:l.scheme}}),children:(0,o.BX)(M.Z,{direction:"vertical",css:eo.KP.fullWidth,children:[null==a?void 0:a.map((e,t)=>(0,o.BX)(M.Z,{style:{alignItems:"center"},children:[(0,o.tZ)(v.Z,{icon:(null==i?void 0:i.fileName)===(null==e?void 0:e.fileName)&&(null==i?void 0:i.name)===(null==e?void 0:e.name)?(0,o.tZ)(Z.Z,{style:{color:"#fad114"}}):(0,o.tZ)(f.Z,{}),onClick:()=>n((null==i?void 0:i.fileName)===(null==e?void 0:e.fileName)&&(null==i?void 0:i.name)===(null==e?void 0:e.name)?void 0:e)}),(0,o.tZ)(iw,{simulation:l&&{id:l.id},file:e&&{name:e.name,fileName:e.fileName,originPath:e.originPath}}),e.name]},t)),d&&(0,o.BX)(o.HY,{children:[d.name,(0,o.tZ)(tj.Z,{css:eo.KP.fullWidth,options:d.options,value:u,onChange(e){let t=d.files.find(t=>t.number===e&&t.name===(null==i?void 0:i.name));n(t),m(e)}}),d.files.map(e=>{if(e.number===u)return(0,o.BX)(M.Z,{style:{alignItems:"center"},children:[(0,o.tZ)(v.Z,{icon:(null==i?void 0:i.fileName)===(null==e?void 0:e.fileName)&&(null==i?void 0:i.name)===(null==e?void 0:e.name)?(0,o.tZ)(Z.Z,{style:{color:"#fad114"}}):(0,o.tZ)(f.Z,{}),onClick:()=>n((null==i?void 0:i.fileName)===(null==e?void 0:e.fileName)&&(null==i?void 0:i.name)===(null==e?void 0:e.name)?void 0:e)}),(0,o.tZ)(iw,{simulation:l&&{id:l.id},file:e&&{name:e.name,fileName:e.fileName,originPath:e.originPath}}),e.name]},e.name)})]})]})}):(0,o.tZ)(T.Z,{size:"small",children:"No results yet"}):(0,o.tZ)(ej.Z,{})},iP={run:"Unable to run simulation",stop:"Unable to stop simulation",update:"Unable to update simulation"},iE=async(e,t,l)=>{try{let i=tA.Z.deepCopy(e),n=e.scheme.configuration;n.run.cloudServer=t,i.scheme.configuration=n,await Y.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","run"],value:n.run}]),l.mutateOneSimulation(i),l.mutateSimulation(i)}catch(a){(0,A.lt)(iP.update,a)}},iO=async e=>{try{await Y.Z.run({id:e.id})}catch(t){throw(0,A.lt)(iP.run,t),t}},iB=async e=>{try{await Y.Z.stop({id:e.id})}catch(t){throw(0,A.lt)(iP.stop,t),t}},ij=e=>{var t,l;let{simulation:i,result:n,setResult:a,setPostprocessing:r,setVisible:d,swr:s}=e,[u,m]=(0,c.useState)(!1),[p,y]=(0,c.useState)(!1),[Z,f]=(0,c.useState)([]),[g,{mutateSimulation:b}]=Y.Z.useSimulation(i.id,2e3),w=i.scheme.configuration,C=null==g?void 0:null===(t=g.scheme)||void 0===t?void 0:t.configuration;return((0,B.Z)(()=>{if(!w){m(!0);return}let e=!0;Object.keys(w).forEach(t=>{if("dimension"!==t&&"run"!==t){let l=w[t];l.done||(e=!1)}}),w.run.cloudServer||(e=!1),m(!e)},[w]),(0,B.Z)(()=>{var e,t,l;(null==g?void 0:null===(e=g.tasks)||void 0===e?void 0:e.find(e=>(null==e?void 0:e.status)==="error"))?y(!1):(null==g?void 0:null===(t=g.tasks)||void 0===t?void 0:t.find(e=>e&&"finish"!==e.status))?y(!0):y(!1);let i=[];null==g||null===(l=g.tasks)||void 0===l||l.forEach(e=>{e&&(i[e.index]={index:e.index,label:e.label,status:e.status,log:e.log,pluginLog:e.pluginLog,warning:e.warning,error:e.error,systemLog:e.systemLog,link:e.link})}),f(i)},[null==g?void 0:g.tasks]),i&&g&&(null==g?void 0:g.id)!=="0")?(0,o.tZ)(h.Z,{children:(0,o.tZ)(h.Z.Content,{children:(0,o.BX)(M.Z,{direction:"vertical",css:eo.KP.fullWidth,children:[(0,o.tZ)(ir,{simulation:i,setVisible:d,setResult:a,setPostprocessing:r,swr:{mutateOneSimulation:s.mutateOneSimulation}}),(0,o.tZ)(iu,{disabled:p,cloudServer:null==C?void 0:null===(l=C.run)||void 0===l?void 0:l.cloudServer,onOk:async e=>iE(i,e,{...s,mutateSimulation:b})}),(0,o.tZ)(T.Z,{size:"small",title:"Run",children:(0,o.BX)(M.Z,{direction:"vertical",css:eo.KP.fullWidth,size:20,children:[(0,o.BX)("div",{css:eo.KP.fullWidth,style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,o.BX)(M.Z,{children:[(0,o.tZ)(v.Z,{disabled:u,type:"primary",icon:(0,o.tZ)(l1.Z,{}),loading:p,async onClick(){y(!0);try{await iO(i)}catch(e){y(!1)}},children:"Run"}),(0,o.tZ)(v.Z,{disabled:!p,danger:!0,icon:(0,o.tZ)(eI.Z,{}),shape:"circle",async onClick(){try{await iB(i),y(!1)}catch(e){}}})]}),(0,o.tZ)(iv,{simulation:{id:i.id},steps:Z})]}),(0,o.tZ)(l0.Z,{direction:"vertical",items:Z.map((e,t)=>({key:t,title:e.label,description:"("+(t+1)+"/"+Z.length+")",status:e.status}))})]})}),(0,o.tZ)(iS,{simulation:g&&{id:g.id,scheme:g.scheme,tasks:g.tasks},result:n&&{name:n.name,fileName:n.fileName},setResult:a})]})})}):(0,o.tZ)(h.Z,{children:(0,o.tZ)(h.Z.Content,{children:(0,o.tZ)(T.Z,{size:"small",children:(0,o.tZ)(ej.Z,{})})})})};var iT=l(1402),iM=[{key:"warpByVector",label:"Warp by vector",parameters:[{key:"Vectors",label:"Vectors",rules:[{required:!0,message:"Vectors is required"}]},{key:"ScaleFactor",label:"Scale factor",default:"1",rules:[{required:!0,message:"Scale factor is required"}]}]},{key:"contour",label:"Contour",parameters:[{key:"ContourBy",label:"Contour by",rules:[{required:!0,message:"ContourBy by is required"}]},{key:"isosurface",label:"Isosurface",default:"0",rules:[{required:!0,message:"Isosurface is required"}]}]},{key:"streamTracer",label:"Stream tracer",parameters:[{key:"Vectors",label:"Vectors",rules:[{required:!0,message:"Vectors is required"}]}]}];let iX=async(e,t,l,i)=>{let n=await (0,F.R)("/api/postprocessing",{method:"POST",headers:{Accept:"application/json"},body:JSON.stringify({simulation:e,result:t,filter:l,parameters:i})});return n.json()};var iz={run:iX};let iL={run:"Unable to run filter"},iN=async(e,t,l,i)=>{try{return await iz.run(e,t,l,i)}catch(n){(0,A.lt)(iL.run,n)}},iA=e=>{let{simulation:t,result:l,postprocessing:i,setResult:n}=e,[a,r]=(0,c.useState)(),[d,s]=(0,c.useState)(),[u,p]=(0,c.useState)(),[y,g]=(0,c.useState)();if((0,c.useEffect)(()=>{!l&&a&&r(!1)},[l,a]),(0,c.useEffect)(()=>{t||(s(void 0),g(void 0))},[t,l]),!t||!l)return null;let b=t.scheme.configuration.run.postprocessing;if(!b)return null;let w=iM.map(e=>{if(b.find(t=>t.key===e.key))return{label:e.label,value:e.key}}).filter(e=>e);if(!w.length)return null;let C=null;if(d){let x=iM.find(e=>e.key===d),k=b.find(e=>e.key===d);(null==x?void 0:x.parameters)&&(C=x.parameters.map((e,t)=>{var l;let i=null==k?void 0:null===(l=k.parameters)||void 0===l?void 0:l.find(t=>t.key===e.key);return(null==i?void 0:i.value)?(0,o.tZ)(ep.Z.Item,{label:e.label,name:["parameters",t],initialValue:i.value,rules:e.rules,children:(0,o.tZ)(ey.Z,{disabled:!0})},e.key):(null==i?void 0:i.options)?(0,o.tZ)(ep.Z.Item,{label:e.label,name:["parameters",t],rules:e.rules,children:(0,o.tZ)(tj.Z,{options:i.options.map(e=>({label:e,value:e}))})},e.key):(0,o.tZ)(ep.Z.Item,{label:e.label,name:["parameters",t],rules:e.rules,initialValue:e.default,children:(0,o.tZ)(ey.Z,{})},e.key)}))}return(0,o.tZ)(h.Z,{style:{position:"absolute",zIndex:101,right:25,bottom:50,backgroundColor:"rgba(255, 255, 255, 0)"},children:(0,o.BX)(h.Z.Content,{children:[(0,o.tZ)(m.Z,{title:"Post-processing",children:(0,o.tZ)(v.Z,{type:"primary",icon:(0,o.tZ)(iT.Z,{}),onClick:()=>r(!0),style:{width:40,height:40,border:"1px solid #5E14FA",borderRadius:20,marginBottom:-20}})}),(0,o.BX)(ll.Z,{title:"Post-processing",closable:!0,onClose:()=>r(!1),open:a,mask:!1,maskClosable:!1,children:[(0,o.tZ)(ep.Z,{style:{margin:"24px 0"},children:(0,o.tZ)(ep.Z.Item,{name:"filter",label:"Filter",children:(0,o.tZ)(tj.Z,{placeholder:"Select a filter",options:w,onChange:s})})}),(0,o.BX)(ep.Z,{layout:"vertical",style:{margin:"24px 0"},async onFinish(e){p(!0);try{let i=await iN({id:t.id},l,d,e.parameters||[]);g(i)}catch(n){}p(!1)},children:[C,(0,o.tZ)(ep.Z.Item,{children:(0,o.tZ)(v.Z,{type:"primary",loading:u,htmlType:"submit",icon:(0,o.tZ)(l1.Z,{}),children:"Run"})})]}),y&&(0,o.tZ)(T.Z,{size:"small",title:"Post-processing",extra:d,children:(0,o.tZ)(M.Z,{direction:"vertical",css:eo.KP.fullWidth,children:y.length?y.map(e=>(0,o.BX)(M.Z,{children:[(0,o.tZ)(v.Z,{icon:(null==i?void 0:i.fileName)===e.fileName&&(null==i?void 0:i.name)===e.name?(0,o.tZ)(Z.Z,{style:{color:"#fad114"}}):(0,o.tZ)(f.Z,{}),onClick:()=>n((null==i?void 0:i.fileName)===e.fileName&&(null==i?void 0:i.name)===e.name?void 0:{type:"postprocessing",...e})}),(0,o.tZ)(iw,{simulation:{id:t.id},file:{name:e.name,fileName:e.fileName,originPath:e.originPath}}),e.name]},e.glb)):"No results"})})]})]})})},iR={plugins:"Unable to load plugins",update:"Unable to update simulation"},iI=(e,t)=>{tR.Z.list().then(l=>{let i=iH(e,tN.Z,l);t(i)}).catch(e=>{(0,A.lt)(iR.plugins,e)})},iH=(e,t,l)=>{let i=t;return l.forEach(t=>{var l;(null==e?void 0:null===(l=e.authorizedplugins)||void 0===l?void 0:l.includes(t.key))&&"Model"===t.category&&(i=[...i,...t.models])}),i},iD=e=>{let{visible:t,user:l,onOk:i,onCancel:n}=e,[a,r]=(0,c.useState)(),[d,s]=(0,c.useState)(!1),[u,m]=(0,c.useState)([]),[y,v]=(0,c.useState)(),[Z,f]=(0,c.useState)();(0,c.useEffect)(()=>{l&&iI(l,m)},[l]),(0,c.useEffect)(()=>{let e=u.map(e=>e.category).filter((e,t,l)=>l.indexOf(e)===t).map(e=>({key:e,value:e}));v(e)},[u]);let g=(0,c.useCallback)(e=>{let{key:t}=e,l=u.find(e=>e.algorithm===t);r(tA.Z.deepCopy(l))},[u]),b=(0,c.useCallback)(e=>{let{key:t}=e,i=l.models.find(e=>e.algorithm===t);r(tA.Z.deepCopy(i))},[l]),w=[{key:"category",disabled:!0,label:(0,o.tZ)(tj.Z,{css:eo.KP.fullWidth,options:y,allowClear:!0,showArrow:!1,placeholder:"Category filter",onChange:e=>f(e)})}];u.forEach(e=>{Z&&e.category!==Z||w.push({key:e.algorithm,label:e.name})});let C=[{key:"category",disabled:!0,label:(0,o.tZ)(tj.Z,{css:eo.KP.fullWidth,options:y,allowClear:!0,showArrow:!1,placeholder:"Category filter",onChange:e=>f(e)})}];return l&&l.models.forEach(e=>{Z&&e.category!==Z||C.push({key:e.algorithm,label:e.name})}),(0,o.tZ)(tT.Z,{open:t,title:"Create simulation",okText:"Create",okButtonProps:{loading:d},async onOk(){if(s(!0),a)try{await i(a)}catch(e){}s(!1)},onCancel:()=>n(),width:"80%",children:(0,o.BX)(h.Z,{children:[(0,o.tZ)(h.Z.Sider,{theme:"light",width:300,children:(0,o.tZ)(tM.Z,{items:[{key:"tanatloc",label:"Tanatloc algorithm",children:(0,o.tZ)(p.Z,{mode:"inline",items:w,onSelect:g})},{key:"personal",label:"User algorithm",children:(0,o.tZ)(p.Z,{mode:"inline",items:C,onSelect:b})}]})}),(0,o.tZ)(h.Z.Content,{css:tI.selector,children:(0,o.tZ)(en.Z.Html,{html:null==a?void 0:a.description})})]})})},iK=async(e,t,l)=>{try{let i=t.find(t=>{var l;return t.algorithm===(null==e?void 0:null===(l=e.scheme)||void 0===l?void 0:l.algorithm)}),n=tA.Z.deepCopy(e);(0,tL.merge)(n.scheme,i),await Y.Z.update({id:e.id},[{key:"scheme",value:n.scheme}]),l.mutateOneSimulation(n)}catch(a){(0,A.lt)(iR.update,a)}},iU=e=>{let{user:t,simulation:l,swr:i}=e,[n,a]=(0,c.useState)([]);return(0,c.useEffect)(()=>{t&&iI(t,a)},[t]),(0,c.useEffect)(()=>{let e=n.find(e=>{var t;return e.algorithm===(null==l?void 0:null===(t=l.scheme)||void 0===t?void 0:t.algorithm)});if(e&&(null==l?void 0:l.scheme)){let t=(0,tX.Z)(l.scheme,e),a=(0,tz.Z)(l.scheme,e);(Object.keys(t).length||Object.keys(a).length)&&(tT.Z.info({title:"Update",content:"Your model need an update, please wait.",closable:!1,okButtonProps:{hidden:!0}}),iK(l,n,i).finally(()=>tT.Z.destroyAll()))}},[l,n,i]),null};var iW={Selector:iD,Updater:iU,About:t_,Geometry:t6,Materials:lb,Parameters:lT,Initialization:lH,BoundaryConditions:l$,Run:ij,Postprocessing:iA};let iY={sider:(0,O.iv)({height:"100vh",overflow:"hidden","& .ant-layout-sider-children":{height:"100vh",overflow:"hidden",borderRight:"1px solid "+eo.Rl.colorPrimary}}),menu1:(0,O.iv)({maxHeight:"calc(100vh - 195px)",overflow:"auto",overflowX:"hidden","& .ant-menu-item-divider":{border:"1px solid "+eo.Rl.colorPrimary,margin:"0 30px !important"},"& .Menu-title":{marginTop:"10px !important",lineHeight:"1.5em !important",cursor:"unset",whiteSpace:"normal",height:"4em"}}),menuScroll:(0,O.iv)({maxHeight:"calc(100vh - 200px)",overflow:"auto",overflowX:"hidden"}),menu2:(0,O.iv)({"& .SubMenu":{"& > div":{backgroundColor:"#f5f5f5",border:"1px solid #d9d9d9"},ul:{backgroundColor:"white !important",li:{paddingLeft:"24px !important","> div":{paddingLeft:"0 !important"},".ant-menu-title-content":{"> div":{display:"flex",justifyContent:"space-between"}},ul:{li:{paddingLeft:"24px !important",position:"relative !important",overflow:"visible !important",":not(:last-child)::before":{position:"absolute",content:'""',border:"1px solid #d9d9d9",backgroundColor:"#d9d9d9",height:"18px",width:"0px",top:"33px",left:"30px",zIndex:100}}}}},"& .display-none":{display:"none"}},button:{width:"100%"}})},iV=s()(()=>Promise.all([l.e(2893),l.e(2073),l.e(1938)]).then(l.bind(l,61938)),{loadableGenerated:{webpack:()=>[61938]},ssr:!1}),iF={dashboard:{key:"dashboard"},geometries:{label:"GEOMETRIES",key:"geometries"},simulations:{label:"SIMULATIONS",key:"simulations"}},iG={user:"Unable to get user",project:"Unable to get project",simulations:"Unable to get simulations",geometries:"Unable to get geometries",add:"Unable to add simulation"},iJ=async(e,t,l)=>{try{let i=await Y.Z.add({id:e.id},{name:t.name,scheme:t});l.addOneSimulation(i),l.mutateProject({id:e.id,simulations:[...e.simulations||[],i.id]})}catch(n){throw(0,A.lt)(iG.add,n),n}},iq=e=>{let{visible:t,geometry:l,panel:i,add:n,del:a,close:r}=e,d=(0,c.useCallback)(e=>{var t,n,o;e.stopPropagation(),(null==i?void 0:null===(t=i.props)||void 0===t?void 0:null===(n=t.children)||void 0===n?void 0:null===(o=n.type)||void 0===o?void 0:o.componentName)===eC.componentName&&r(),a(l)},[l,i,a,r]),s=(0,c.useCallback)(e=>{e.stopPropagation(),n(l)},[l,n]);return(0,o.BX)("div",{children:[l.name,t?(0,o.tZ)(Z.Z,{onClick:d}):(0,o.tZ)(f.Z,{onClick:s})]})},i_=e=>{let{simulation:t}=e;return t.scheme.user?(0,o.BX)(o.HY,{children:[(0,o.tZ)(m.Z,{title:"User algorithm",placement:"right",children:(0,o.tZ)(g.Z,{style:{position:"absolute",top:0,left:14,fontSize:14,color:"#fad114"}})}),t.name]}):(0,o.tZ)(o.HY,{children:t.name})},iQ=()=>{let e=(0,u.useRouter)(),{page:t,workspaceId:l,projectId:i}=e.query,[n,a]=(0,c.useState)(!1),[r,d]=(0,c.useState)([]),[s,m]=(0,c.useState)(!1),[Z,f]=(0,c.useState)(),[g,T]=(0,c.useState)(),[M,X]=(0,c.useState)(),[z,R]=(0,c.useState)(),[I,H]=(0,c.useState)(),[D,V]=(0,c.useState)(!0),[F,{errorUser:G,loadingUser:J}]=U.Z.useUser(),[q,{mutateProject:_,errorProject:Q,loadingProject:$}]=W.Z.useProject(i),[et,{addOneSimulation:el,delOneSimulation:en,mutateOneSimulation:ea,errorSimulations:er,loadingSimulations:ed}]=Y.Z.useSimulations(null==q?void 0:q.simulations),[es,{addOneGeometry:eu,delOneGeometry:ec,mutateOneGeometry:em,errorGeometries:eh,loadingGeometries:ep}]=ee.useGeometries(null==q?void 0:q.geometries),ey=(0,c.useCallback)(()=>a(!0),[]),ev=(0,c.useCallback)(()=>m(!0),[]),eZ=(0,c.useCallback)(()=>m(!1),[]),ef=(0,c.useCallback)(e=>{d(t=>[...t,e])},[]),eg=(0,c.useCallback)(e=>{let t=r.findIndex(t=>t.id===e.id);-1!==t&&d(e=>[...e.slice(0,t),...e.slice(t+1)])},[r]),eb=(0,c.useCallback)(()=>{H(void 0),R(void 0)},[]),ew=(0,c.useCallback)(e=>{let t=es.findIndex(t=>t.id===e);-1!==t&&d(e=>[...e.slice(0,t),{id:"0",needCleanup:!0},...e.slice(t+1)])},[es]),ex=(0,c.useCallback)(e=>{let t=es.find(t=>t.id===e);if(!t)return;let l=r.find(t=>t.id===e);l||d(e=>[...e,{...t,visible:!0}]),H((0,o.tZ)(ei,{visible:!0,title:"Geometry",onClose:eb,children:(0,o.tZ)(eC,{project:{id:q.id,geometries:q.geometries},geometry:{id:t.id,name:t.name,summary:t.summary},swr:{mutateProject:_,mutateOneGeometry:em,delOneGeometry:ec},close:eb,onCleanup:ew})}))},[q,es,r,_,em,ec,ew,eb]),ek=(0,c.useCallback)(e=>{H((0,o.tZ)(ei,{visible:!0,title:"About",onClose:eb,children:(0,o.tZ)(iW.About,{project:{id:q.id,simulations:q.simulations},simulation:{id:e.id,name:e.name,scheme:e.scheme},swr:{mutateProject:_,addOneSimulation:el,delOneSimulation:en,mutateOneSimulation:ea}})}))},[q,_,el,en,ea,eb]),eS=(0,c.useCallback)(e=>{H((0,o.tZ)(ei,{visible:!0,title:"Geometry",onClose:eb,children:(0,o.tZ)(iW.Geometry,{loadedGeometries:es,geometries:r.map(e=>({id:e.id,summary:e.summary})),simulation:{id:e.id,scheme:e.scheme},setGeometries:d,swr:{mutateOneSimulation:ea}})}))},[es,r,ea,eb]),eP=(0,c.useCallback)(e=>{H((0,o.tZ)(ei,{visible:!0,title:"Parameters",onClose:eb,children:(0,o.tZ)(iW.Parameters,{simulation:{id:e.id,scheme:e.scheme},swr:{mutateOneSimulation:ea}})}))},[ea,eb]),eE=(0,c.useCallback)(e=>{H((0,o.tZ)(ei,{visible:D,title:"Materials",onClose:eb,children:(0,o.tZ)(iW.Materials,{geometries:r.map(e=>({id:e.id,name:e.name,summary:e.summary})),simulation:{id:e.id,scheme:e.scheme},swr:{mutateOneSimulation:ea},setVisible:V})}))},[r,D,ea,eb]),eO=(0,c.useCallback)(e=>{H((0,o.tZ)(ei,{visible:!0,title:"Initialization",onClose:eb,children:(0,o.tZ)(iW.Initialization,{simulations:et,simulation:e,swr:{mutateOneSimulation:ea}})}))},[et,ea,eb]),eB=(0,c.useCallback)(e=>{H((0,o.tZ)(ei,{visible:D,title:"Boundary conditions",onClose:eb,children:(0,o.tZ)(iW.BoundaryConditions,{geometries:r.map(e=>({id:e.id,name:e.name,summary:e.summary})),simulation:{id:e.id,scheme:e.scheme},swr:{mutateOneSimulation:ea},setVisible:V})}))},[r,D,ea,eb]),ej=(0,c.useCallback)(e=>{H((0,o.tZ)(ei,{visible:D,title:"Run",onClose:eb,children:(0,o.tZ)(iW.Run,{simulation:{id:e.id,scheme:e.scheme},result:g&&{name:g.name,fileName:g.fileName},setResult:T,setPostprocessing:X,setVisible:V,swr:{mutateOneSimulation:ea}})}))},[g,D,ea,eb]),eT=(0,c.useCallback)((e,t)=>{var l,i,n,a,r,o;let s=et.find(t=>t.id===e);if(!s)return;f(s);let u=null===(l=s.scheme)||void 0===l?void 0:null===(i=l.configuration)||void 0===i?void 0:null===(n=i.geometry)||void 0===n?void 0:n.value,c=null===(a=s.scheme)||void 0===a?void 0:null===(r=a.configuration)||void 0===r?void 0:null===(o=r.geometry)||void 0===o?void 0:o.values;if(u){let m=es.find(e=>e.id===u);m&&d([m])}else if(c){let h=es.filter(e=>c.includes(e.id));d(h)}switch(t){case"about":ek(s);break;case"geometry":eS(s);break;case"parameters":eP(s);break;case"materials":eE(s);break;case"initialization":eO(s);break;case"boundaryConditions":eB(s);break;case"run":ej(s);break;default:H(void 0)}},[es,et,ek,eS,eP,eE,eO,eB,ej]),eM=(0,c.useCallback)(()=>e.push({pathname:"/dashboard",query:{page:t,workspaceId:l}}),[e,t,l]),eX=(0,c.useCallback)(e=>{let t,{keyPath:l}=e,i=l.pop(),n=l.pop(),a=l.pop();a&&(t=a.split("&").pop()),R({key:i,id:n,item:t})},[]),ez=(0,c.useCallback)(async e=>{try{await iJ(q,e,{addOneSimulation:el,mutateProject:_}),m(!1)}catch(t){}},[q,el,_]),eL=(0,c.useCallback)(e=>{if(ep)return!0;let t=e.value,l=e.values,i=e.multiple,n=e.n;return(!t||!!es.filter(e=>e.id===t).length)&&(!i||!l||(n?es.filter(e=>l.includes(e.id)).length===e.n:!!es.filter(e=>l.includes(e.id)).length))&&(!!t||!!l)||(e.done=!1,!1)},[es,ep]);(0,c.useEffect)(()=>{J||F||e.replace("/login")},[F,J,e]),(0,c.useEffect)(()=>{G&&(0,A.lt)(iG.user,G),Q&&(0,A.lt)(iG.project,Q),er&&(0,A.lt)(iG.simulations,er),eh&&(0,A.lt)(iG.geometries,eh)},[G,Q,er,eh]),(0,B.Z)(()=>{$||ep?a(!1):es.length?a(!1):a(!0)},[$,ep,es]),(0,B.Z)(()=>{if(!ep){if(r.length){let e=!1,t=r.map(t=>{let l=es.find(e=>e.id===(null==t?void 0:t.id));return l?JSON.stringify({...l,visible:void 0})!==JSON.stringify({...t,visible:void 0})?(e=!0,l):t:(e=!0,null)}).filter(e=>e);e&&d(t)}else d(es[0]?[es[0]]:[])}},[ep,es,r],[d]),(0,B.Z)(()=>{if(!ed&&Z){let e=et.find(e=>e.id===(null==Z?void 0:Z.id));e?JSON.stringify(e)!==JSON.stringify(Z)&&(f(e),z&&z.key===iF.simulations.key&&eT(z.id,z.item)):(eb(),f(void 0))}},[et,ed,Z,z],[f,eb]),(0,B.Z)(()=>{z&&(z.key===iF.geometries.key?ex(z.id):(eT(z.id,z.item),"run"!==z.item&&(T(void 0),X(void 0))))},[z,D,g],[ex,eT,eb]),(0,c.useEffect)(()=>{!g&&M&&X(void 0)},[g,M]);let eN=(0,c.useMemo)(()=>es.map(e=>{let t=r.find(t=>t.id===e.id);return{key:e.id,icon:(0,o.tZ)(b.Z,{}),label:(0,o.tZ)(iq,{visible:!!t,geometry:e,panel:I,add:ef,del:eg,close:eb})}}),[es,r,I,ef,eg,eb]),eA=(0,c.useMemo)(()=>et.map(e=>{let t=e.scheme.configuration||{},l=[];return Object.keys(t).forEach(i=>{if("dimension"===i)return;let n=t[i],a=(0,o.tZ)(w.Z,{style:{color:"green"}});n.error?a=(0,o.tZ)(C.Z,{style:{color:"red"}}):n.done||(a=(0,o.tZ)(x.Z,{style:{color:"orange"}})),"geometry"!==i||eL(n)||(a=(0,o.tZ)(x.Z,{style:{color:"orange"}})),l[n.index]={key:e.id+"&"+i,disabled:!r.length,icon:a,label:n.title}}),{key:e.id,icon:(0,o.tZ)(k.Z,{}),label:(0,o.tZ)(i_,{simulation:e}),children:[{key:e.id+"&about",disabled:!r.length,icon:(0,o.tZ)(w.Z,{style:{color:"green"}}),label:"About"},...l]}}),[r,et,eL]);return!F||J||$?(0,o.tZ)(j.Z.Simple,{}):"0"===q.id?(0,o.tZ)(L,{}):(0,o.tZ)(K,{children:(0,o.BX)(h.Z,{hasSider:!0,children:[(0,o.BX)(h.Z.Sider,{theme:"light",css:iY.sider,width:256,children:[(0,o.tZ)("div",{css:eo.KP.logo,children:(0,o.tZ)("img",{src:"/images/logo.svg",alt:"Tanatloc"})}),(0,o.tZ)(p.Z,{css:iY.menu1,mode:"inline",items:[{key:"menu-go-back",disabled:!0,style:{cursor:"unset",margin:"10px 0",paddingLeft:10},label:(0,o.tZ)(N.ks,{buttonCss:eo.KP.fullWidth,onClick:eM,children:"Return to dashboard"})},{type:"divider"},{key:"title",disabled:!0,className:"Menu-title",label:(0,o.tZ)(y.Z.Paragraph,{ellipsis:{tooltip:!0,rows:2},children:q.title})}]}),(0,o.tZ)("div",{css:iY.menuScroll,children:(0,o.tZ)(p.Z,{mode:"inline",css:iY.menu2,defaultOpenKeys:[iF.geometries.key,iF.simulations.key],items:[{key:iF.geometries.key,className:"SubMenu",icon:ep?(0,o.tZ)(S.Z,{}):(0,o.tZ)(b.Z,{}),label:(0,o.BX)(y.Z.Text,{strong:!0,children:[iF.geometries.label," (",es.length,")"]}),children:[{key:"new_geometry",disabled:!0,label:(0,o.tZ)(v.Z,{icon:(0,o.tZ)(P.Z,{}),onClick:ey,children:"New Geometry"})},{key:"geometry-needed",disabled:!0,className:r.length?"display-none":"",icon:(0,o.tZ)(x.Z,{style:{color:"red"}}),label:"A Geometry is needed"},...eN]},{key:iF.simulations.key,className:"SubMenu",icon:ed?(0,o.tZ)(S.Z,{}):(0,o.tZ)(k.Z,{}),label:(0,o.BX)(y.Z.Text,{strong:!0,children:[iF.simulations.label," (",et.length,")"]}),children:[{key:"new_simulation",disabled:!0,label:(0,o.tZ)(v.Z,{disabled:!es.length,icon:(0,o.tZ)(E.Z,{}),onClick:ev,children:"New Simulation"})},...eA]}],onClick:eX})})]}),(0,o.BX)(h.Z.Content,{css:(0,O.iv)([eo.KP.noScroll,{position:"relative"}]),children:[(0,o.tZ)(eC.Add,{visible:n,project:{id:q.id,geometries:q.geometries},swr:{mutateProject:_,addOneGeometry:eu},setVisible:a}),(0,o.tZ)(iW.Selector,{user:{authorizedplugins:F.authorizedplugins,models:F.models},visible:s,onOk:ez,onCancel:eZ}),(0,o.tZ)(iW.Updater,{user:{authorizedplugins:F.authorizedplugins},simulation:Z&&{id:Z.id,scheme:Z.scheme},swr:{mutateOneSimulation:ea}}),I,(0,o.tZ)(tB,{project:{id:q.id,title:q.title},simulation:Z&&{id:Z.id},geometries:r.map(e=>({id:e.id,needCleanup:e.needCleanup})),result:g&&{glb:g.glb,originPath:g.originPath},postprocessing:M&&{glb:M.glb,originPath:M.originPath}}),(0,o.tZ)(iV,{simulation:Z&&{id:Z.id,name:Z.name}}),(0,o.tZ)(iW.Postprocessing,{simulation:Z&&{id:Z.id,scheme:Z.scheme},result:g&&{name:g.name,fileName:g.fileName,originPath:g.originPath},postprocessing:M&&{name:M.name,fileName:M.fileName},setResult:X})]})]})})};var i$=iQ},64546:function(e,t,l){var i={"./local/src/components":[94295,4295]};function n(e){if(!l.o(i,e))return Promise.resolve().then(function(){var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t});var t=i[e],n=t[0];return l.e(t[1]).then(function(){return l(n)})}n.keys=function(){return Object.keys(i)},n.id=64546,e.exports=n}}]);