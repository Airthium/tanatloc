(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4535],{5957:function(e,t,i){"use strict";i.d(t,{Z:function(){return a}});var l=i(948);let s=async(e,t)=>{let i=await (0,l.R)("/api/avatar",{method:"POST",headers:{Accept:"application/json"},body:JSON.stringify({file:e,project:t})});return i.json()};var a={add:s}},37119:function(e,t,i){"use strict";i.d(t,{Z:function(){return m}});var l=i(59734),s=i(67294),a=i(948);let n=async(e,t)=>{let i=await (0,a.R)("/api/geometry",{method:"POST",body:JSON.stringify({project:e,geometry:t})});return i.json()},r=async(e,t)=>{await (0,a.R)("/api/geometry/"+e.id,{method:"PUT",body:JSON.stringify(t)})},o=async e=>{await (0,a.R)("/api/geometry/"+e.id,{method:"DELETE"})},d=async e=>{let t=await (0,a.R)("/api/geometry/"+e.id+"/download");return t.json()},c=async e=>{let t=await (0,a.R)("/api/geometry/"+e.id+"/part");return t.json()},u=async(e,t)=>{let i=await (0,a.R)("/api/geometry/"+t.id+"/splitStep",{method:"POST",body:JSON.stringify({project:e})});return i.json()};var m={useGeometries:e=>{var t;let{data:i,error:n,mutate:r}=(0,l.ZP)(["/api/geometries",JSON.stringify({ids:e})],e=>{let[t,i]=e;return(0,a._)(t,i)}),o=null!==(t=null==i?void 0:i.geometries)&&void 0!==t?t:[],d=(0,s.useCallback)(async e=>{let t=[...o,e];await r({geometries:t})},[o,r]),c=(0,s.useCallback)(async e=>{let t=o.filter(t=>t.id!==e.id);await r({geometries:t})},[o,r]),u=(0,s.useCallback)(async e=>{let t=o.map(t=>(t.id===e.id&&(t={...t,...e}),t));await r({geometries:t})},[o,r]);return[o,{addOneGeometry:d,delOneGeometry:c,mutateOneGeometry:u,errorGeometries:n,loadingGeometries:!i}]},add:n,update:r,del:o,download:d,getPart:c,splitStep:u}},24535:function(e,t,i){"use strict";i.d(t,{ZP:function(){return eL}});var l=i(85893),s=i(5152),a=i.n(s),n=i(11163),r=i(67294),o=i(65400),d=i.n(o),c=i(16373),u=i(12386),m=i(94055),h=i(53740),y=i(50685),g=i(96621),x=i(48138),p=i(92018),b=i(3855),j=i(4851),f=i(35855),v=i(61093),k=i(14552),w=i(42419),C=i(34265),Z=i(8061),S=i(54509),N=i(95590),P=i(40561),T=i(70302),O=i(74048),_=i(14527),U=()=>{let e=(0,n.useRouter)(),t=(0,r.useCallback)(()=>{(async()=>{await e.push("/")})()},[e]);return(0,l.jsx)(c.Z,{children:(0,l.jsx)(c.Z.Content,{children:(0,l.jsx)(T.Z,{title:"Not allowed",children:(0,l.jsxs)(O.default,{direction:"vertical",children:[(0,l.jsxs)(h.Z.Text,{children:[(0,l.jsx)(_.Z,{style:{color:"red"}})," ","You are not allowed to be here."]}),(0,l.jsxs)(h.Z.Text,{children:["Go back"," ",(0,l.jsx)(d(),{type:"link",onClick:t,children:"home"})]})]})})})})},G=i(88053),E=i(54523),R=i(40144),z=i(8798),L=i(81229),A=i(37119),F=i(83482),I=i(64098),M=i.n(I),J=e=>{let{visible:t,title:i,children:s,onClose:a}=e;return(0,l.jsx)(T.Z,{className:M().panel,style:{display:t?"block":"none"},title:i,extra:(0,l.jsx)(d(),{type:"text",icon:(0,l.jsx)(F.default,{}),onClick:a}),children:s})},D=i(8418),B=i(28465),V=i(51274),q=i(35304),W=i.n(q),Y=i(95361),H=i.n(Y),K=i(48764).lW;let Q={add:"Unable to add geometry"},X=e=>e.name.toLowerCase().includes(".stp")||e.name.toLowerCase().includes(".step")||e.name.toLowerCase().includes(".dxf"),$=async e=>{let t=new FileReader;return new Promise(i=>{t.addEventListener("load",()=>{i(t.result)}),t.readAsArrayBuffer(e)})},ee=async(e,t,i,l)=>{if("uploading"===t.file.status)return!0;if("done"===t.file.status){let s=await $(t.file.originFileObj);try{let l=await A.Z.add({id:e.id},{name:t.file.name,uid:t.file.uid,buffer:K.from(s)});await i.addOneGeometry(l),await i.mutateProject({id:e.id,geometries:[...e.geometries,l.id]})}catch(e){throw l((0,S.iT)({title:Q.add,err:e})),e}}return!1};var et=i(97538),ei=i(51024),el=e=>{let{visible:t,geometry:i,setVisible:s,onEdit:a}=e,n=(0,r.useRef)(null),[o,d]=(0,r.useState)(!1);(0,r.useEffect)(()=>{n.current&&n.current.focus()});let c=(0,r.useCallback)(()=>s(!1),[s]),u=(0,r.useCallback)(async e=>{d(!0);try{await a(e),d(!1),s(!1)}catch(e){throw d(!1),e}},[s,a]);return(0,l.jsx)(V.ZP,{title:"Edit the geometry's name",visible:t,initialValues:{name:i.name},onCancel:c,onOk:u,loading:o,children:(0,l.jsx)(et.Z.Item,{name:"name",label:"Name:",rules:[{required:!0,message:"Name is required"}],children:(0,l.jsx)(ei.default,{ref:n})})})},es=i(93959);let ea=async(e,t)=>{let{message:i}=await A.Z.splitStep(e,t);return i};var en=e=>{let{project:t,geometry:i}=e,[s,a]=(0,r.useState)(!1),{dispatch:n}=(0,r.useContext)(Z.uj),o=(0,r.useMemo)(()=>3!==i.summary.dimension,[i.summary.dimension]),c=(0,r.useCallback)(()=>{a(!0),ea(t,i).then(e=>{e.length&&n((0,S.iT)({title:e}))}).catch(e=>{n((0,S.iT)({title:"Unable to split geoemtry",err:e}))}).finally(()=>a(!1))},[t,i,n]);return(0,l.jsx)(m.default,{title:"Split volumes",children:(0,l.jsx)(d(),{disabled:o,loading:s,className:W().noBorder,icon:(0,l.jsx)(es.Z,{}),onClick:c})})},er=i(48764).lW;let eo={download:"Unable to download geometry",update:"Unable to update geometry",del:"Unable to delete geometry"},ed=async(e,t)=>{try{let t=await A.Z.download({id:e.id}),i=new File([er.from(t.buffer).toString()],e.name+"."+t.extension),l=window.URL.createObjectURL(i),s=document.createElement("a");s.href=l,s.setAttribute("download",e.name+"."+t.extension),s.click(),s.remove()}catch(e){t((0,S.iT)({title:eo.download,err:e}))}},ec=async(e,t,i,l)=>{try{await A.Z.update({id:e.id},[{key:"name",value:t.name}]),e.name=t.name,await i.mutateOneGeometry(e)}catch(e){throw l((0,S.iT)({title:eo.update,err:e})),e}},eu=async(e,t,i,l,s)=>{try{await A.Z.del({id:e.id});let s=t.geometries.filter(t=>t!==e.id);await l.mutateProject({id:t.id,geometries:s}),await l.delOneGeometry(e),i()}catch(e){throw s((0,S.iT)({title:eo.del,err:e})),e}},em=e=>{var t,i,s,a,n,o;let{project:d,geometry:u,swr:m,close:y,onCleanup:g}=e,[x,p]=(0,r.useState)(!1),[b,j]=(0,r.useState)(!1),[f,v]=(0,r.useState)(!1),{dispatch:k}=(0,r.useContext)(Z.uj),w=(0,r.useCallback)(()=>j(!0),[]),C=(0,r.useCallback)(()=>{(async()=>{p(!0);try{await ed(u,k)}catch(e){}finally{p(!1)}})()},[u,k]),S=(0,r.useCallback)(async e=>ec(u,e,m,k),[u,m,k]),N=(0,r.useCallback)(async()=>{v(!0);try{await eu(u,d,y,m,k),g(u.id)}finally{v(!1)}},[d,u,m,y,g,k]);return u?(0,l.jsx)(c.Z,{children:(0,l.jsx)(c.Z.Content,{children:(0,l.jsx)(T.Z,{size:"small",title:"Informations",actions:[(0,l.jsx)(en,{project:{id:d.id},geometry:{id:u.id,summary:u.summary}},"split"),(0,l.jsx)(G.o6,{loading:x,onDownload:C},"download"),(0,l.jsxs)("div",{children:[(0,l.jsx)(el,{visible:b,geometry:{id:null==u?void 0:u.id,name:null==u?void 0:u.name},setVisible:j,onEdit:S}),(0,l.jsx)(G.w6,{onEdit:w})]},"edit"),(0,l.jsx)(G.m1,{loading:f,text:(0,l.jsxs)(l.Fragment,{children:["Are you sure you want to delete the geometry"," ",(0,l.jsx)(h.Z.Text,{strong:!0,children:u.name}),"?"]}),onDelete:N},"delete")],children:(0,l.jsxs)(O.default,{direction:"vertical",className:W().fullWidth,children:[(0,l.jsxs)(h.Z.Text,{children:[(0,l.jsx)("span",{className:W().textLight,children:"File:"})," ",u.name," "]}),(0,l.jsxs)(h.Z.Text,{children:[(0,l.jsx)("span",{className:W().textLight,children:"Unit:"})," ",(0,l.jsx)(D.Z.Inline,{text:"m"})]}),(0,l.jsxs)(l.Fragment,{children:[3===u.summary.dimension&&(0,l.jsxs)(h.Z.Text,{children:[(0,l.jsx)("span",{className:W().textLight,children:"Number of solids:"})," ",null!==(a=null===(t=u.summary.solids)||void 0===t?void 0:t.length)&&void 0!==a?a:0]}),(0,l.jsxs)(h.Z.Text,{children:[(0,l.jsx)("span",{className:W().textLight,children:"Number of faces:"})," ",null!==(n=null===(i=u.summary.faces)||void 0===i?void 0:i.length)&&void 0!==n?n:0]}),2===u.summary.dimension&&(0,l.jsxs)(h.Z.Text,{children:[(0,l.jsx)("span",{className:W().textLight,children:"Number of edges:"})," ",null!==(o=null===(s=u.summary.edges)||void 0===s?void 0:s.length)&&void 0!==o?o:0]})]})]})})})}):(0,l.jsx)(P.Z.Simple,{})};em.componentName="Geometry",em.Add=e=>{let{visible:t,project:i,swr:s,setVisible:a}=e,[n,o]=(0,r.useState)(!1),{dispatch:d}=(0,r.useContext)(Z.uj),c=(0,r.useCallback)(()=>a(!1),[a]),u=(0,r.useCallback)(e=>{(async()=>{try{let t=await ee(i,e,s,d);o(t),a(t)}catch(e){o(!1)}})()},[i,s,a,d]);return(0,l.jsx)(V.ZP,{title:"Upload geometry",visible:t,onCancel:c,cancelButtonProps:{loading:n},children:(0,l.jsxs)(O.default,{direction:"vertical",className:W().fullWidth,children:[(0,l.jsx)(B.Z,{className:H().upload,action:"/api/noop",accept:".stp,.step,.dxf",showUploadList:!1,listType:"picture-card",beforeUpload:X,onChange:u,children:(0,l.jsx)("div",{children:n?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(j.default,{style:{fontSize:25}}),(0,l.jsxs)("div",{style:{marginTop:8},children:[(0,l.jsx)("b",{children:"Loading"}),", converting, ..."]})]}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(f.Z,{style:{fontSize:25}}),(0,l.jsxs)("div",{style:{marginTop:8},children:[(0,l.jsx)("b",{children:"Choose a file"})," or drop it here"]})]})})}),(0,l.jsx)(h.Z.Text,{children:(0,l.jsx)("p",{style:{color:"rgba(0, 0, 0, 0.45)",textAlign:"center"},children:"Native file format preferred: STEP (3D) or DXF (2D) file"})})]})})};var eh=i(89552),ey=i(57632),eg=i(78804),ex=i(5957),ep=i(85615),eb=i(73116),ej=i.n(eb),ef=i(1244);let ev=a()(()=>Promise.all([i.e(3737),i.e(1059),i.e(7836),i.e(1275)]).then(i.bind(i,51275)).then(e=>e.default.Renderer),{loadableGenerated:{webpack:()=>[51275]},ssr:!1}),ek={part:"Unable to load part",snapshot:"Unable to save snapshot"},ew=async(e,t,i,l)=>{try{if("geometry"===i){let e=await A.Z.getPart({id:t.id});return{...e,extra:{id:t.id}}}{let i=await ep.Z.load({id:e.id},{originPath:t.originPath,glb:t.glb});return{...i,extra:{name:t.name,glb:t.glb,fields:t.extra}}}}catch(e){throw l((0,S.iT)({title:ek.part,err:e})),e}},eC=async(e,t,i,l)=>{let s=[];for(let a of i){let i=t.find(e=>{var t;return(null===(t=e.extra)||void 0===t?void 0:t.glb)===a.glb});if(i){s.push(i);continue}let n=await ew(e,a,"result",l);s.push(n)}return s},eZ=async(e,t,i,l)=>{if(!l)return;let s=t.find(e=>{var t;return(null===(t=e.extra)||void 0===t?void 0:t.glb)===l.glb});if(s)return s;let a=await ew(e,l,"result",i);return a},eS=async(e,t,i,l)=>{let s=[];for(let a of i){let i=t.find(e=>{var t;return(null===(t=e.extra)||void 0===t?void 0:t.id)===a.id});if(i){s.push(i);continue}let n=await ew(e,a,"geometry",l);s.push(n)}return s};var eN=e=>{let{project:t,simulation:i,geometries:s,results:a,postprocessing:n}=e,[o,d]=(0,r.useState)([]),[c,u]=(0,r.useState)(!1),[m,h]=(0,r.useState)(!1),[y,g]=(0,r.useState)(!1),{enabled:x,part:p,highlighted:b,selected:f,point:v,type:k,dispatch:w}=(0,r.useContext)(E.ZB),{dispatch:C}=(0,r.useContext)(Z.uj),[P]=L.Z.useSimulation(null==i?void 0:i.id);(0,N.Z)(()=>{let e=async()=>{u(!0);let e=[];if(i&&!n){let t=await eC(i,o,a,C);e.push(...t)}if(i){let t=await eZ(i,o,C,n);t&&e.push(t)}if(!a.length&&!n){let t=await eS(i,o,s,C);e.push(...t)}d(e)};e().catch(e=>{u(!1)}).finally(()=>u(!1))},[i,s,a,n,o,C]),(0,r.useEffect)(()=>{let e=P.tasks,t=null==e?void 0:e.map(e=>e.datas).filter(e=>e).flat();(null==t?void 0:t.length)?h(!0):h(!1)},[P]),(0,r.useEffect)(()=>{if(null==i?void 0:i.scheme.configuration.run.postprocessing){let e=!1;o.forEach(t=>{"result"===t.summary.type&&(e=!0)}),e?g(!0):g(!1)}else g(!1)},[i,o]);let T=(0,r.useCallback)(async e=>{try{await ex.Z.add({name:"snapshot",uid:"snapshot_"+(0,ey.Z)(),data:e},{id:t.id})}catch(e){C((0,S.iT)({title:ek.snapshot,err:e}))}},[t.id,C]),O=(0,r.useCallback)(e=>{w((0,eg.CH)(e))},[w]),_=(0,r.useCallback)(e=>{w((0,eg.Ys)(e))},[w]),U=(0,r.useCallback)(e=>{w((0,eg.N7)(e))},[w]),G=(0,r.useCallback)(()=>{w((0,eg.a_)(!0))},[w]),R=(0,r.useCallback)(()=>{w((0,eg.Ud)(!0))},[w]);return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{style:{display:c?"flex":"none"},className:ej().loading,children:(0,l.jsx)(eh.default,{indicator:(0,l.jsx)(j.default,{style:{fontSize:80},spin:!0})})}),(0,l.jsx)(ev,{theme:ef.Z,style:{width:"calc(100vw - 256px)"},parts:o,selection:{enabled:x,part:p,type:k,highlighted:b,selected:f,point:v,onHighlight:O,onSelect:_,onPoint:U},data:m,postProcessing:y,snapshot:{project:{apiRoute:T,size:{width:520,height:312}}},onData:G,onPostProcessing:R})]})},eP=i(15753),eT=i(13156),eO=i.n(eT);let e_=a()(()=>Promise.all([i.e(88),i.e(9305)]).then(i.bind(i,29305)),{loadableGenerated:{webpack:()=>[29305]},ssr:!1}),eU={geometries:{label:"GEOMETRIES",key:"geometries"},simulations:{label:"SIMULATIONS",key:"simulations"}},eG={user:"Unable to get user",project:"Unable to get project",simulations:"Unable to get simulations",geometries:"Unable to get geometries",add:"Unable to add simulation"},eE=async(e,t,i,l)=>{try{var s;let l=await L.Z.add({id:e.id},{name:t.name,scheme:t});await i.addOneSimulation(l),await i.mutateProject({id:e.id,simulations:[...null!==(s=e.simulations)&&void 0!==s?s:[],l.id]})}catch(e){throw l((0,S.iT)({title:eG.add,err:e})),e}},eR=e=>{let{visible:t,geometry:i,panel:s,add:a,del:n,close:o}=e,d=(0,r.useCallback)(e=>{var t,l,a;e.stopPropagation(),(null==s?void 0:null===(a=s.props)||void 0===a?void 0:null===(l=a.children)||void 0===l?void 0:null===(t=l.type)||void 0===t?void 0:t.componentName)===em.componentName&&o(),n(i)},[i,s,n,o]),c=(0,r.useCallback)(e=>{e.stopPropagation(),a(i)},[i,a]);return(0,l.jsxs)("div",{children:[(0,l.jsx)(h.Z.Text,{ellipsis:{tooltip:!0},children:i.name}),t?(0,l.jsx)(w.default,{onClick:d}):(0,l.jsx)(C.default,{onClick:c})]})},ez=e=>{let{simulation:t}=e;return t.scheme.userModelId?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(m.default,{title:"User algorithm",placement:"right",children:(0,l.jsx)(k.Z,{style:{position:"absolute",top:0,left:14,fontSize:14,color:"#fad114"}})}),(0,l.jsx)(h.Z.Text,{ellipsis:!0,children:t.name})]}):(0,l.jsx)(l.Fragment,{children:t.name})};var eL=()=>{let e=(0,n.useRouter)(),{page:t,workspaceId:i,projectId:s}=e.query,[a,o]=(0,r.useState)(!1),[m,k]=(0,r.useState)([]),[w,C]=(0,r.useState)(!1),[T,O]=(0,r.useState)(),[_,F]=(0,r.useState)([]),[I,M]=(0,r.useState)(),[D,B]=(0,r.useState)(),[V,q]=(0,r.useState)(),[Y,H]=(0,r.useState)(!0),{dispatch:K}=(0,r.useContext)(Z.uj),[Q,{errorUser:X,loadingUser:$}]=R.Z.useUser(),[ee,{mutateProject:et,errorProject:ei,loadingProject:el}]=z.Z.useProject(s),[es,{addOneSimulation:ea,delOneSimulation:en,mutateOneSimulation:er,errorSimulations:eo,loadingSimulations:ed}]=L.Z.useSimulations(null==ee?void 0:ee.simulations),[ec,{addOneGeometry:eu,delOneGeometry:eh,mutateOneGeometry:ey,errorGeometries:eg,loadingGeometries:ex}]=A.Z.useGeometries(null==ee?void 0:ee.geometries),ep=(0,r.useCallback)(()=>o(!0),[]),eb=(0,r.useCallback)(()=>C(!0),[]),ej=(0,r.useCallback)(()=>C(!1),[]),ef=(0,r.useCallback)(e=>{k(t=>[...t,e])},[]),ev=(0,r.useCallback)(e=>{let t=m.findIndex(t=>t.id===e.id);-1!==t&&k(e=>[...e.slice(0,t),...e.slice(t+1)])},[m]),ek=(0,r.useCallback)(()=>{q(void 0),B(void 0)},[]),ew=(0,r.useCallback)(e=>{let t=ec.findIndex(t=>t.id===e);-1!==t&&k(e=>[...e.slice(0,t),{id:"0",needCleanup:!0},...e.slice(t+1)])},[ec]),eC=(0,r.useCallback)(e=>{let t=ec.find(t=>t.id===e);if(!t)return;let i=m.find(t=>t.id===e);i||k(e=>[...e,{...t,visible:!0}]),q((0,l.jsx)(J,{visible:!0,title:"Geometry",onClose:ek,children:(0,l.jsx)(em,{project:{id:ee.id,geometries:ee.geometries},geometry:{id:t.id,name:t.name,summary:t.summary},swr:{mutateProject:et,mutateOneGeometry:ey,delOneGeometry:eh},close:ek,onCleanup:ew})}))},[ee,ec,m,et,ey,eh,ew,ek]),eZ=(0,r.useCallback)(e=>{q((0,l.jsx)(J,{visible:!0,title:"About",onClose:ek,children:(0,l.jsx)(eP.ZP.About,{project:{id:ee.id,simulations:ee.simulations},simulation:{id:e.id,name:e.name,scheme:e.scheme},swr:{mutateProject:et,addOneSimulation:ea,delOneSimulation:en,mutateOneSimulation:er}})}))},[ee,et,ea,en,er,ek]),eS=(0,r.useCallback)(e=>{q((0,l.jsx)(J,{visible:!0,title:"Geometry",onClose:ek,children:(0,l.jsx)(eP.ZP.Geometry,{geometries:ec,simulation:{id:e.id,scheme:e.scheme},setGeometries:k,swr:{mutateOneSimulation:er}})}))},[ec,er,ek]),eT=(0,r.useCallback)(e=>{q((0,l.jsx)(J,{visible:!0,title:"Parameters",onClose:ek,children:(0,l.jsx)(eP.ZP.Parameters,{simulation:{id:e.id,scheme:e.scheme},swr:{mutateOneSimulation:er}})}))},[er,ek]),eL=(0,r.useCallback)(e=>{q((0,l.jsx)(J,{visible:Y,title:"Materials",onClose:ek,children:(0,l.jsx)(eP.ZP.Materials,{geometries:m.map(e=>({id:e.id,name:e.name,summary:e.summary})),simulation:{id:e.id,scheme:e.scheme},swr:{mutateOneSimulation:er},setVisible:H})}))},[m,Y,er,ek]),eA=(0,r.useCallback)(e=>{q((0,l.jsx)(J,{visible:!0,title:"Initialization",onClose:ek,children:(0,l.jsx)(eP.ZP.Initialization,{simulations:es,simulation:e,swr:{mutateOneSimulation:er}})}))},[es,er,ek]),eF=(0,r.useCallback)(e=>{q((0,l.jsx)(J,{visible:Y,title:"Boundary conditions",onClose:ek,children:(0,l.jsx)(eP.ZP.BoundaryConditions,{geometries:m.map(e=>({id:e.id,name:e.name,summary:e.summary})),simulation:{id:e.id,scheme:e.scheme},swr:{mutateOneSimulation:er},setVisible:H})}))},[m,Y,er,ek]),eI=(0,r.useCallback)(e=>{q((0,l.jsx)(J,{visible:Y,title:"Run",onClose:ek,children:(0,l.jsx)(eP.ZP.Run,{geometries:m,simulation:{id:e.id,scheme:e.scheme},results:_,setResults:F,setPostprocessing:M,setVisible:H,swr:{mutateOneSimulation:er}})}))},[m,_,Y,er,ek]),eM=(0,r.useCallback)((e,t)=>{var i,l;let s=es.find(t=>t.id===e);if(!s)return;O(s);let a=null!==(l=null===(i=s.scheme.configuration)||void 0===i?void 0:i.geometry.children)&&void 0!==l?l:[],n=a.map(e=>{let t=e.value;if(t)return ec.find(e=>e.id===t)}).filter(e=>e);switch(n.length&&k(n),t){case"about":eZ(s);break;case"geometry":eS(s);break;case"parameters":eT(s);break;case"materials":eL(s);break;case"initialization":eA(s);break;case"boundaryConditions":eF(s);break;case"run":eI(s);break;default:q(void 0)}},[ec,es,eZ,eS,eT,eL,eA,eF,eI]),eJ=(0,r.useCallback)(()=>{(async()=>{await e.push({pathname:"/dashboard",query:{page:t,workspaceId:i}})})()},[e,t,i]),eD=(0,r.useCallback)(e=>{let t,{keyPath:i}=e,l=i.pop(),s=i.pop(),a=i.pop();a&&(t=a.split("&").pop()),B({key:l,id:s,item:t})},[]),eB=(0,r.useCallback)(async e=>{try{await eE(ee,e.model,{addOneSimulation:ea,mutateProject:et},K),C(!1)}catch(e){}},[ee,ea,et,K]),eV=(0,r.useCallback)(e=>{if(ex)return!0;let t=!0,i=e.children;for(let l of i){let i=l.value;i&&!ec.filter(e=>e.id===i).length&&(e.done=!1,t=!1)}return t},[ec,ex]);(0,r.useEffect)(()=>{(async()=>{$||Q||await e.replace("/login")})()},[Q,$,e]),(0,r.useEffect)(()=>{X&&K((0,S.iT)({title:eG.user,err:X})),ei&&K((0,S.iT)({title:eG.project,err:ei})),eo&&K((0,S.iT)({title:eG.simulations,err:eo})),eg&&K((0,S.iT)({title:eG.geometries,err:eg}))},[X,ei,eo,eg,K]),(0,N.Z)(()=>{el||ex?o(!1):ec.length?o(!1):o(!0)},[el,ex,ec]),(0,N.Z)(()=>{if(!ex){if(m.length){let e=!1,t=m.map(t=>{let i=ec.find(e=>e.id===(null==t?void 0:t.id));return i?JSON.stringify({...i,visible:void 0})!==JSON.stringify({...t,visible:void 0})?(e=!0,i):t:(e=!0,null)}).filter(e=>e);e&&k(t)}else k(ec[0]?[ec[0]]:[])}},[ex,ec,m],[k]),(0,N.Z)(()=>{if(!ed&&T){let e=es.find(e=>e.id===(null==T?void 0:T.id));e?JSON.stringify(e)!==JSON.stringify(T)&&(O(e),D&&D.key===eU.simulations.key&&eM(D.id,D.item)):(ek(),O(void 0))}},[es,ed,T,D],[O,ek]),(0,N.Z)(()=>{D&&(D.key===eU.geometries.key?eC(D.id):(eM(D.id,D.item),"run"!==D.item&&(F([]),M(void 0))))},[D,Y,_],[eC,eM,ek]),(0,r.useEffect)(()=>{!_.length&&I&&M(void 0)},[_,I]);let eq=(0,r.useMemo)(()=>ec.map(e=>{let t=m.find(t=>t.id===e.id);return{key:e.id,icon:(0,l.jsx)(g.Z,{}),label:(0,l.jsx)(eR,{visible:!!t,geometry:e,panel:V,add:ef,del:ev,close:ek})}}),[ec,m,V,ef,ev,ek]),eW=(0,r.useMemo)(()=>es.map(e=>{let t=e.scheme.configuration||{},i=[];return Object.keys(t).forEach(s=>{if("dimension"===s)return;let a=t[s],n=(0,l.jsx)(x.Z,{style:{color:"green"}});a.error?n=(0,l.jsx)(p.Z,{style:{color:"red"}}):a.done||(n=(0,l.jsx)(b.Z,{style:{color:"orange"}})),"geometry"!==s||eV(a)||(n=(0,l.jsx)(b.Z,{style:{color:"orange"}})),i[a.index]={key:e.id+"&"+s,disabled:!m.length,icon:n,label:a.title}}),{key:e.id,icon:(0,l.jsx)(y.Z,{}),label:(0,l.jsx)(ez,{simulation:e}),children:[{key:e.id+"&about",disabled:!m.length,icon:(0,l.jsx)(x.Z,{style:{color:"green"}}),label:"About"},...i]}}),[m,es,eV]);return!Q||$||el?(0,l.jsx)(P.Z.Simple,{}):"0"===ee.id?(0,l.jsx)(U,{}):(0,l.jsx)(E.ZP,{children:(0,l.jsxs)(c.Z,{hasSider:!0,children:[(0,l.jsxs)(c.Z.Sider,{theme:"light",className:eO().sider,width:256,children:[(0,l.jsx)("div",{className:W().logo,children:(0,l.jsx)("img",{src:"/images/logo.svg",alt:"Tanatloc"})}),(0,l.jsx)(u.default,{className:eO().menu1,mode:"inline",items:[{key:"menu-go-back",disabled:!0,style:{cursor:"unset",margin:"10px 0",paddingLeft:10},label:(0,l.jsx)(G.ks,{className:W().fullWidth,onClick:eJ,children:"Return to dashboard"})},{type:"divider"},{key:"title",disabled:!0,className:"Menu-title",label:(0,l.jsx)(h.Z.Paragraph,{ellipsis:{tooltip:!0,rows:2},children:ee.title})}]}),(0,l.jsx)("div",{className:eO().menuScroll,children:(0,l.jsx)(u.default,{mode:"inline",className:eO().menu2,defaultOpenKeys:[eU.geometries.key,eU.simulations.key],items:[{key:eU.geometries.key,className:"SubMenu",icon:ex?(0,l.jsx)(j.default,{}):(0,l.jsx)(g.Z,{}),label:(0,l.jsxs)(h.Z.Text,{strong:!0,children:[eU.geometries.label," (",ec.length,")"]}),children:[{key:"new_geometry",disabled:!0,label:(0,l.jsx)(d(),{icon:(0,l.jsx)(f.Z,{}),onClick:ep,children:"New Geometry"})},{key:"geometry-needed",disabled:!0,className:m.length?"display-none":"",icon:(0,l.jsx)(b.Z,{style:{color:"red"}}),label:"A Geometry is needed"},...eq]},{key:eU.simulations.key,className:"SubMenu",icon:ed?(0,l.jsx)(j.default,{}):(0,l.jsx)(y.Z,{}),label:(0,l.jsxs)(h.Z.Text,{strong:!0,children:[eU.simulations.label," (",es.length,")"]}),children:[{key:"new_simulation",disabled:!0,label:(0,l.jsx)(d(),{disabled:!ec.length,icon:(0,l.jsx)(v.Z,{}),onClick:eb,children:"New Simulation"})},...eW]}],onClick:eD})})]}),(0,l.jsxs)(c.Z.Content,{className:W().noScroll,style:{position:"relative"},children:[(0,l.jsx)(em.Add,{visible:a,project:{id:ee.id,geometries:ee.geometries},swr:{mutateProject:et,addOneGeometry:eu},setVisible:o}),(0,l.jsx)(eP.ZP.Selector,{user:{id:Q.id,authorizedplugins:Q.authorizedplugins,usermodels:Q.usermodels},visible:w,onOk:eB,onCancel:ej}),(0,l.jsx)(eP.ZP.Updater,{user:{authorizedplugins:Q.authorizedplugins},simulation:T&&{id:T.id,scheme:T.scheme},swr:{mutateOneSimulation:er}}),V,(0,l.jsx)(eN,{project:{id:ee.id,title:ee.title},simulation:T&&{id:T.id,scheme:T.scheme},geometries:m.map(e=>({id:e.id,needCleanup:e.needCleanup})),results:_.map(e=>({name:e.name,glb:e.glb,originPath:e.originPath,extra:e.extra})),postprocessing:I&&{glb:I.glb,originPath:I.originPath}}),(0,l.jsx)(e_,{simulation:T&&{id:T.id,name:T.name}}),(0,l.jsx)(eP.ZP.Postprocessing,{simulation:T&&{id:T.id,scheme:T.scheme},results:_.map(e=>({name:e.name,fileName:e.fileName,originPath:e.originPath})),postprocessing:I&&{name:I.name,fileName:I.fileName},setResult:M})]})]})})}},95361:function(e){e.exports={upload:"add_upload__OHzcC"}},13156:function(e){e.exports={variables:'"@/styles/variables.css"',colorPrimary:"#fad114",sider:"project_sider__KGpqG",menu1:"project_menu1__iUy_z",menuScroll:"project_menuScroll__d4eJz",menu2:"project_menu2__uQFdm"}},73116:function(e){e.exports={loading:"view_loading__rcZQY"}}}]);