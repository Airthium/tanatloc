(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4535],{5957:function(e,t,i){"use strict";i.d(t,{Z:function(){return a}});var l=i(948);let s=async(e,t)=>{let i=await (0,l.R)("/api/avatar",{method:"POST",headers:{Accept:"application/json"},body:JSON.stringify({file:e,project:t})});return i.json()};var a={add:s}},37119:function(e,t,i){"use strict";i.d(t,{Z:function(){return m}});var l=i(59734),s=i(67294),a=i(948);let n=async(e,t)=>{let i=await (0,a.R)("/api/geometry",{method:"POST",body:JSON.stringify({project:e,geometry:t})});return i.json()},r=async(e,t)=>{await (0,a.R)("/api/geometry/"+e.id,{method:"PUT",body:JSON.stringify(t)})},o=async e=>{await (0,a.R)("/api/geometry/"+e.id,{method:"DELETE"})},d=async e=>{let t=await (0,a.R)("/api/geometry/"+e.id+"/download");return t.json()},u=async e=>{let t=await (0,a.R)("/api/geometry/"+e.id+"/part");return t.json()},c=async(e,t)=>{let i=await (0,a.R)("/api/geometry/"+t.id+"/splitStep",{method:"POST",body:JSON.stringify({project:e})});return i.json()};var m={useGeometries:e=>{var t;let{data:i,error:n,mutate:r}=(0,l.ZP)(["/api/geometries",JSON.stringify({ids:e})],e=>{let[t,i]=e;return(0,a._)(t,i)}),o=null!==(t=null==i?void 0:i.geometries)&&void 0!==t?t:[],d=(0,s.useCallback)(async e=>{let t=[...o,e];await r({geometries:t})},[o,r]),u=(0,s.useCallback)(async e=>{let t=o.filter(t=>t.id!==e.id);await r({geometries:t})},[o,r]),c=(0,s.useCallback)(async e=>{let t=o.map(t=>(t.id===e.id&&(t={...t,...e}),t));await r({geometries:t})},[o,r]);return[o,{addOneGeometry:d,delOneGeometry:u,mutateOneGeometry:c,errorGeometries:n,loadingGeometries:!i}]},add:n,update:r,del:o,download:d,getPart:u,splitStep:c}},24535:function(e,t,i){"use strict";i.d(t,{ZP:function(){return eA}});var l=i(85893),s=i(67294),a=i(5152),n=i.n(a),r=i(11163),o=i(65400),d=i.n(o),u=i(16373),c=i(12386),m=i(94055),h=i(53740),g=i(50685),x=i(96621),p=i(48138),y=i(92018),b=i(3855),j=i(4851),f=i(35855),v=i(61093),k=i(14552),w=i(42419),C=i(34265),Z=i(8061),S=i(54509),P=i(95590),N=i(64352),T=i(40561),O=i(70302),_=i(74048),U=i(14527),E=()=>{let e=(0,r.useRouter)(),t=(0,s.useCallback)(()=>{(0,N.u)(async()=>{await e.push("/")})},[e]);return(0,l.jsx)(u.Z,{children:(0,l.jsx)(u.Z.Content,{children:(0,l.jsx)(O.Z,{title:"Not allowed",children:(0,l.jsxs)(_.default,{direction:"vertical",children:[(0,l.jsxs)(h.Z.Text,{children:[(0,l.jsx)(U.Z,{style:{color:"red"}})," ","You are not allowed to be here."]}),(0,l.jsxs)(h.Z.Text,{children:["Go back"," ",(0,l.jsx)(d(),{type:"link",onClick:t,children:"home"})]})]})})})})},G=i(88053),R=i(54523),z=i(40144),L=i(8798),F=i(81229),M=i(37119),A=i(83482),I=i(64098),J=i.n(I),D=e=>{let{visible:t,title:i,children:s,onClose:a}=e;return(0,l.jsx)(O.Z,{className:J().panel,style:{display:t?"block":"none"},title:i,extra:(0,l.jsx)(d(),{type:"text",icon:(0,l.jsx)(A.default,{}),onClick:a}),children:s})},B=i(8418),V=i(97538),q=i(51024),W=i(51274),Y=e=>{let{visible:t,geometry:i,setVisible:a,onEdit:n}=e,r=(0,s.useRef)(null),[o,d]=(0,s.useState)(!1);(0,s.useEffect)(()=>{r.current&&r.current.focus()});let u=(0,s.useCallback)(()=>a(!1),[a]),c=(0,s.useCallback)(async e=>{d(!0);try{await n(e),d(!1),a(!1)}catch(e){throw d(!1),e}},[a,n]);return(0,l.jsx)(W.ZP,{title:"Edit the geometry's name",visible:t,initialValues:{name:i.name},onCancel:u,onOk:c,loading:o,children:(0,l.jsx)(V.Z.Item,{name:"name",label:"Name:",rules:[{required:!0,message:"Name is required"}],children:(0,l.jsx)(q.default,{ref:r})})})},H=i(93959),K=i(35304),Q=i.n(K);let X={split:"Unable to split geoemtry"},$=async(e,t)=>{let{message:i}=await M.Z.splitStep(e,t);return i};var ee=e=>{let{project:t,geometry:i}=e,[a,n]=(0,s.useState)(!1),{dispatch:r}=(0,s.useContext)(Z.uj),o=(0,s.useMemo)(()=>3!==i.summary.dimension,[i.summary.dimension]),u=(0,s.useCallback)(()=>{let e=async()=>{n(!0);try{let e=await $(t,i);e.length&&r((0,S.iT)({title:e}))}catch(e){r((0,S.iT)({title:X.split,err:e}))}finally{n(!1)}};e().catch(console.error)},[t,i,r]);return(0,l.jsx)(m.default,{title:"Split volumes",children:(0,l.jsx)(d(),{disabled:o,loading:a,className:Q().noBorder,icon:(0,l.jsx)(H.Z,{}),onClick:u})})},et=i(48764).lW;let ei={download:"Unable to download geometry",update:"Unable to update geometry",del:"Unable to delete geometry"},el=async e=>{let t=await M.Z.download({id:e.id}),i=new File([et.from(t.buffer).toString()],e.name+"."+t.extension),l=window.URL.createObjectURL(i),s=document.createElement("a");s.href=l,s.setAttribute("download",e.name+"."+t.extension),s.click(),s.remove()},es=async(e,t,i)=>{await M.Z.update({id:e.id},[{key:"name",value:t.name}]),e.name=t.name,await i.mutateOneGeometry(e)},ea=async(e,t,i,l)=>{await M.Z.del({id:t.id});let s=e.geometries.filter(e=>e!==t.id);await l.mutateProject({id:e.id,geometries:s}),await l.delOneGeometry(t),i()};var en=e=>{var t,i,a,n,r,o;let{project:d,geometry:c,swr:m,close:g,onCleanup:x}=e,[p,y]=(0,s.useState)(!1),[b,j]=(0,s.useState)(!1),[f,v]=(0,s.useState)(!1),{dispatch:k}=(0,s.useContext)(Z.uj),w=(0,s.useCallback)(()=>j(!0),[]),C=(0,s.useCallback)(()=>{(0,N.u)(async()=>{y(!0);try{await el(c)}catch(e){k((0,S.iT)({title:ei.download,err:e}))}finally{y(!1)}})},[c,k]),P=(0,s.useCallback)(async e=>{try{await es(c,e,m)}catch(e){throw k((0,S.iT)({title:ei.update,err:e})),e}},[c,m,k]),U=(0,s.useCallback)(async()=>{v(!0);try{await ea(d,c,g,m),x(c.id)}catch(e){throw k((0,S.iT)({title:ei.del,err:e})),e}finally{v(!1)}},[d,c,m,g,x,k]);return c?(0,l.jsx)(u.Z,{children:(0,l.jsx)(u.Z.Content,{children:(0,l.jsx)(O.Z,{size:"small",title:"Informations",actions:[(0,l.jsx)(ee,{project:{id:d.id},geometry:{id:c.id,summary:c.summary}},"split"),(0,l.jsx)(G.o6,{loading:p,onDownload:C},"download"),(0,l.jsxs)("div",{children:[(0,l.jsx)(Y,{visible:b,geometry:{id:null==c?void 0:c.id,name:null==c?void 0:c.name},setVisible:j,onEdit:P}),(0,l.jsx)(G.w6,{onEdit:w})]},"edit"),(0,l.jsx)(G.m1,{loading:f,text:(0,l.jsxs)(l.Fragment,{children:["Are you sure you want to delete the geometry"," ",(0,l.jsx)(h.Z.Text,{strong:!0,children:c.name}),"?"]}),onDelete:U},"delete")],children:(0,l.jsxs)(_.default,{direction:"vertical",className:Q().fullWidth,children:[(0,l.jsxs)(h.Z.Text,{children:[(0,l.jsx)("span",{className:Q().textLight,children:"File:"})," ",c.name," "]}),(0,l.jsxs)(h.Z.Text,{children:[(0,l.jsx)("span",{className:Q().textLight,children:"Unit:"})," ",(0,l.jsx)(B.Z.Inline,{text:"m"})]}),(0,l.jsxs)(l.Fragment,{children:[3===c.summary.dimension&&(0,l.jsxs)(h.Z.Text,{children:[(0,l.jsx)("span",{className:Q().textLight,children:"Number of solids:"})," ",null!==(n=null===(t=c.summary.solids)||void 0===t?void 0:t.length)&&void 0!==n?n:0]}),(0,l.jsxs)(h.Z.Text,{children:[(0,l.jsx)("span",{className:Q().textLight,children:"Number of faces:"})," ",null!==(r=null===(i=c.summary.faces)||void 0===i?void 0:i.length)&&void 0!==r?r:0]}),2===c.summary.dimension&&(0,l.jsxs)(h.Z.Text,{children:[(0,l.jsx)("span",{className:Q().textLight,children:"Number of edges:"})," ",null!==(o=null===(a=c.summary.edges)||void 0===a?void 0:a.length)&&void 0!==o?o:0]})]})]})})})}):(0,l.jsx)(T.Z.Simple,{})},er=i(28465),eo=i(95361),ed=i.n(eo),eu=i(48764).lW;let ec={add:"Unable to add geometry"},em=e=>e.name.toLowerCase().includes(".stp")||e.name.toLowerCase().includes(".step")||e.name.toLowerCase().includes(".dxf"),eh=async e=>{let t=new FileReader;return new Promise(i=>{t.addEventListener("load",()=>{i(t.result)}),t.readAsArrayBuffer(e)})},eg=async(e,t,i)=>{if("uploading"===t.file.status)return!0;if("done"===t.file.status){let l=await eh(t.file.originFileObj),s=await M.Z.add({id:e.id},{name:t.file.name,uid:t.file.uid,buffer:eu.from(l)});await i.addOneGeometry(s),await i.mutateProject({id:e.id,geometries:[...e.geometries,s.id]})}return!1};var ex=e=>{let{visible:t,project:i,swr:a,setVisible:n}=e,[r,o]=(0,s.useState)(!1),{dispatch:d}=(0,s.useContext)(Z.uj),u=(0,s.useCallback)(()=>n(!1),[n]),c=(0,s.useCallback)(e=>{(0,N.u)(async()=>{try{let t=await eg(i,e,a);o(t),n(t)}catch(e){d((0,S.iT)({title:ec.add,err:e})),o(!1)}})},[i,a,n,d]);return(0,l.jsx)(W.ZP,{title:"Upload geometry",visible:t,onCancel:u,cancelButtonProps:{loading:r},children:(0,l.jsxs)(_.default,{direction:"vertical",className:Q().fullWidth,children:[(0,l.jsx)(er.Z,{className:ed().upload,action:"/api/noop",accept:".stp,.step,.dxf",showUploadList:!1,listType:"picture-card",beforeUpload:em,onChange:c,children:(0,l.jsx)("div",{children:r?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(j.default,{style:{fontSize:25}}),(0,l.jsxs)("div",{style:{marginTop:8},children:[(0,l.jsx)("b",{children:"Loading"}),", converting, ..."]})]}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(f.Z,{style:{fontSize:25}}),(0,l.jsxs)("div",{style:{marginTop:8},children:[(0,l.jsx)("b",{children:"Choose a file"})," or drop it here"]})]})})}),(0,l.jsx)(h.Z.Text,{children:(0,l.jsx)("p",{style:{color:"rgba(0, 0, 0, 0.45)",textAlign:"center"},children:"Native file format preferred: STEP (3D) or DXF (2D) file"})})]})})},ep=i(89552),ey=i(57632),eb=i(78804),ej=i(5957),ef=i(85615),ev=i(73116),ek=i.n(ev),ew=i(1244);let eC=n()(()=>Promise.all([i.e(3737),i.e(1059),i.e(9390)]).then(i.bind(i,89390)).then(e=>e.default.Renderer),{loadableGenerated:{webpack:()=>[89390]},ssr:!1}),eZ={part:"Unable to load part",snapshot:"Unable to save snapshot"},eS=async(e,t,i)=>{if("geometry"===i){let e=await M.Z.getPart({id:t.id});return{...e,extra:{id:t.id}}}{let i=await ef.Z.load({id:e.id},{originPath:t.originPath,glb:t.glb});return{...i,extra:{name:t.name,glb:t.glb,fields:t.extra}}}},eP=async(e,t,i)=>{let l=[];for(let s of i){let i=t.find(e=>{var t;return(null===(t=e.extra)||void 0===t?void 0:t.glb)===s.glb});if(i){l.push(i);continue}let a=await eS(e,s,"result");l.push(a)}return l},eN=async(e,t,i)=>{if(!i)return;let l=t.find(e=>{var t;return(null===(t=e.extra)||void 0===t?void 0:t.glb)===i.glb});if(l)return l;let s=await eS(e,i,"result");return s},eT=async(e,t,i)=>{let l=[];for(let s of i){let i=t.find(e=>{var t;return(null===(t=e.extra)||void 0===t?void 0:t.id)===s.id});if(i){l.push(i);continue}let a=await eS(e,s,"geometry");l.push(a)}return l};var eO=e=>{let{project:t,simulation:i,geometries:a,results:n,postprocessing:r}=e,[o,d]=(0,s.useState)([]),[u,c]=(0,s.useState)(!1),[m,h]=(0,s.useState)(!1),[g,x]=(0,s.useState)(!1),{enabled:p,part:y,highlighted:b,selected:f,point:v,type:k,dispatch:w}=(0,s.useContext)(R.ZB),{dispatch:C}=(0,s.useContext)(Z.uj),[N]=F.Z.useSimulation(null==i?void 0:i.id);(0,P.Z)(()=>{let e=async()=>{c(!0);let e=[];if(i&&!r){let t=await eP(i,o,n);e.push(...t)}if(i){let t=await eN(i,o,r);t&&e.push(t)}if(!n.length&&!r){let t=await eT(i,o,a);e.push(...t)}d(e)};e().catch(e=>{C((0,S.iT)({title:eZ.part,err:e})),c(!1)}).finally(()=>c(!1))},[i,a,n,r,o,C]),(0,s.useEffect)(()=>{if("0"===N.id){h(!1);return}let e=N.tasks,t=null==e?void 0:e.map(e=>e.datas).filter(e=>e).flat();(null==t?void 0:t.length)?h(!0):h(!1)},[N]),(0,s.useEffect)(()=>{if(null==i?void 0:i.scheme.configuration.run.postprocessing){let e=!1;o.forEach(t=>{"result"===t.summary.type&&(e=!0)}),e?x(!0):x(!1)}else x(!1)},[i,o]);let T=(0,s.useCallback)(async e=>{try{await ej.Z.add({name:"snapshot",uid:"snapshot_"+(0,ey.Z)(),data:e},{id:t.id})}catch(e){C((0,S.iT)({title:eZ.snapshot,err:e}))}},[t.id,C]),O=(0,s.useCallback)(e=>{w((0,eb.CH)(e))},[w]),_=(0,s.useCallback)(e=>{w((0,eb.Ys)(e))},[w]),U=(0,s.useCallback)(e=>{w((0,eb.N7)(e))},[w]),E=(0,s.useCallback)(()=>{w((0,eb.a_)(!0))},[w]),G=(0,s.useCallback)(()=>{w((0,eb.Ud)(!0))},[w]);return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{style:{display:u?"flex":"none"},className:ek().loading,children:(0,l.jsx)(ep.default,{indicator:(0,l.jsx)(j.default,{style:{fontSize:80},spin:!0})})}),(0,l.jsx)(eC,{theme:ew.Z,style:{width:"calc(100vw - 256px)"},parts:o,selection:{enabled:p,part:y,type:k,highlighted:b,selected:f,point:v,onHighlight:O,onSelect:_,onPoint:U},data:m,postProcessing:g,snapshot:{project:{apiRoute:T,size:{width:520,height:312}}},onData:E,onPostProcessing:G})]})},e_=i(15753),eU=i(13156),eE=i.n(eU);let eG=n()(()=>Promise.all([i.e(6631),i.e(9305)]).then(i.bind(i,29305)),{loadableGenerated:{webpack:()=>[29305]},ssr:!1}),eR={geometries:{label:"GEOMETRIES",key:"geometries"},simulations:{label:"SIMULATIONS",key:"simulations"}},ez={user:"Unable to get user",project:"Unable to get project",simulations:"Unable to get simulations",geometries:"Unable to get geometries",add:"Unable to add simulation"},eL=async(e,t,i)=>{var l;let s=await F.Z.add({id:e.id},{name:t.name,scheme:t});await i.addOneSimulation(s),await i.mutateProject({id:e.id,simulations:[...null!==(l=e.simulations)&&void 0!==l?l:[],s.id]})},eF=e=>{let{visible:t,geometry:i,panel:a,add:n,del:r,close:o}=e,d=(0,s.useCallback)(e=>{var t,l,s;e.stopPropagation(),(null==a?void 0:null===(s=a.props)||void 0===s?void 0:null===(l=s.children)||void 0===l?void 0:null===(t=l.type)||void 0===t?void 0:t.name)===en.name&&o(),r(i)},[i,a,r,o]),u=(0,s.useCallback)(e=>{e.stopPropagation(),n(i)},[i,n]);return(0,l.jsxs)("div",{children:[(0,l.jsx)(h.Z.Text,{ellipsis:{tooltip:!0},children:i.name}),t?(0,l.jsx)(w.default,{onClick:d}):(0,l.jsx)(C.default,{onClick:u})]})},eM=e=>{let{simulation:t}=e;return t.scheme.userModelId?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(m.default,{title:"User algorithm",placement:"right",children:(0,l.jsx)(k.Z,{style:{position:"absolute",top:0,left:14,fontSize:14,color:"#fad114"}})}),(0,l.jsx)(h.Z.Text,{ellipsis:!0,children:t.name})]}):(0,l.jsx)(l.Fragment,{children:t.name})};var eA=()=>{let e=(0,r.useRouter)(),{page:t,workspaceId:i,projectId:a}=e.query,[n,o]=(0,s.useState)(!1),[m,k]=(0,s.useState)([]),[w,C]=(0,s.useState)(!1),[O,_]=(0,s.useState)(),[U,A]=(0,s.useState)([]),[I,J]=(0,s.useState)(),[B,V]=(0,s.useState)(),[q,W]=(0,s.useState)(),[Y,H]=(0,s.useState)(!0),{dispatch:K}=(0,s.useContext)(Z.uj),[X,{errorUser:$,loadingUser:ee}]=z.Z.useUser(),[et,{mutateProject:ei,errorProject:el,loadingProject:es}]=L.Z.useProject(a),ea=(0,s.useMemo)(()=>"0"===et.id?void 0:et,[et]),[er,{addOneSimulation:eo,delOneSimulation:ed,mutateOneSimulation:eu,errorSimulations:ec,loadingSimulations:em}]=F.Z.useSimulations(null==ea?void 0:ea.simulations),[eh,{addOneGeometry:eg,delOneGeometry:ep,mutateOneGeometry:ey,errorGeometries:eb,loadingGeometries:ej}]=M.Z.useGeometries(null==ea?void 0:ea.geometries),ef=(0,s.useCallback)(()=>o(!0),[]),ev=(0,s.useCallback)(()=>C(!0),[]),ek=(0,s.useCallback)(()=>C(!1),[]),ew=(0,s.useCallback)(e=>{k(t=>[...t,e])},[]),eC=(0,s.useCallback)(e=>{let t=m.findIndex(t=>t.id===e.id);-1!==t&&k(e=>[...e.slice(0,t),...e.slice(t+1)])},[m]),eZ=(0,s.useCallback)(()=>{W(void 0),V(void 0)},[]),eS=(0,s.useCallback)(e=>{let t=eh.findIndex(t=>t.id===e);-1!==t&&k(e=>[...e.slice(0,t),{id:"0",needCleanup:!0},...e.slice(t+1)])},[eh]),eP=(0,s.useCallback)(e=>{let t=eh.find(t=>t.id===e);if(!t)return;let i=m.find(t=>t.id===e);i||k(e=>[...e,{...t,visible:!0}]),W((0,l.jsx)(D,{visible:!0,title:"Geometry",onClose:eZ,children:(0,l.jsx)(en,{project:{id:ea.id,geometries:ea.geometries},geometry:{id:t.id,name:t.name,summary:t.summary},swr:{mutateProject:ei,mutateOneGeometry:ey,delOneGeometry:ep},close:eZ,onCleanup:eS})}))},[ea,eh,m,ei,ey,ep,eS,eZ]),eN=(0,s.useCallback)(e=>{W((0,l.jsx)(D,{visible:!0,title:"About",onClose:eZ,children:(0,l.jsx)(e_.ZP.About,{project:{id:ea.id,simulations:ea.simulations},simulation:{id:e.id,name:e.name,scheme:e.scheme},swr:{mutateProject:ei,addOneSimulation:eo,delOneSimulation:ed,mutateOneSimulation:eu}})}))},[ea,ei,eo,ed,eu,eZ]),eT=(0,s.useCallback)(e=>{W((0,l.jsx)(D,{visible:!0,title:"Geometry",onClose:eZ,children:(0,l.jsx)(e_.ZP.Geometry,{geometries:eh,simulation:{id:e.id,scheme:e.scheme},setGeometries:k,swr:{mutateOneSimulation:eu}})}))},[eh,eu,eZ]),eU=(0,s.useCallback)(e=>{W((0,l.jsx)(D,{visible:!0,title:"Parameters",onClose:eZ,children:(0,l.jsx)(e_.ZP.Parameters,{simulation:{id:e.id,scheme:e.scheme},swr:{mutateOneSimulation:eu}})}))},[eu,eZ]),eA=(0,s.useCallback)((e,t)=>{W((0,l.jsx)(D,{visible:Y,title:"Materials",onClose:eZ,children:(0,l.jsx)(e_.ZP.Materials,{geometries:t,simulation:{id:e.id,scheme:e.scheme},swr:{mutateOneSimulation:eu},setVisible:H})}))},[Y,eu,eZ]),eI=(0,s.useCallback)(e=>{W((0,l.jsx)(D,{visible:!0,title:"Initialization",onClose:eZ,children:(0,l.jsx)(e_.ZP.Initialization,{simulations:er,simulation:e,swr:{mutateOneSimulation:eu}})}))},[er,eu,eZ]),eJ=(0,s.useCallback)((e,t)=>{W((0,l.jsx)(D,{visible:Y,title:"Boundary conditions",onClose:eZ,children:(0,l.jsx)(e_.ZP.BoundaryConditions,{geometries:t,simulation:{id:e.id,scheme:e.scheme},swr:{mutateOneSimulation:eu},setVisible:H})}))},[Y,eu,eZ]),eD=(0,s.useCallback)(e=>{W((0,l.jsx)(D,{visible:Y,title:"Run",onClose:eZ,children:(0,l.jsx)(e_.ZP.Run,{geometries:m,simulation:{id:e.id,scheme:e.scheme},results:U,setResults:A,setPostprocessing:J,setVisible:H,swr:{mutateOneSimulation:eu}})}))},[m,U,Y,eu,eZ]),eB=(0,s.useCallback)((e,t)=>{var i,l;let s=er.find(t=>t.id===e);if(!s)return;_(s);let a=null!==(l=null===(i=s.scheme.configuration)||void 0===i?void 0:i.geometry.children)&&void 0!==l?l:[],n=a.map(e=>{let t=e.value;if(t)return eh.find(e=>e.id===t)}).filter(e=>e);switch(n.length&&k(n),t){case"about":eN(s);break;case"geometry":eT(s);break;case"parameters":eU(s);break;case"materials":eA(s,n);break;case"initialization":eI(s);break;case"boundaryConditions":eJ(s,n);break;case"run":eD(s);break;default:W(void 0)}},[eh,er,eN,eT,eU,eA,eI,eJ,eD]),eV=(0,s.useCallback)(()=>{(0,N.u)(async()=>{await e.push({pathname:"/dashboard",query:{page:t,workspaceId:i}})})},[e,t,i]),eq=(0,s.useCallback)(e=>{let t,{keyPath:i}=e,l=i.pop(),s=i.pop(),a=i.pop();a&&(t=a.split("&").pop()),V({key:l,id:s,item:t})},[]),eW=(0,s.useCallback)(async e=>{try{await eL(ea,e.model,{addOneSimulation:eo,mutateProject:ei}),C(!1)}catch(e){K((0,S.iT)({title:ez.add,err:e}))}},[ea,eo,ei,K]),eY=(0,s.useCallback)(e=>{if(ej)return!0;let t=!0,i=e.children;for(let l of i){let i=l.value;i&&!eh.filter(e=>e.id===i).length&&(e.done=!1,t=!1)}return t},[eh,ej]);(0,s.useEffect)(()=>{(0,N.u)(async()=>{ee||X||await e.replace("/login")})},[X,ee,e]),(0,s.useEffect)(()=>{$&&K((0,S.iT)({title:ez.user,err:$})),el&&K((0,S.iT)({title:ez.project,err:el})),ec&&K((0,S.iT)({title:ez.simulations,err:ec})),eb&&K((0,S.iT)({title:ez.geometries,err:eb}))},[$,el,ec,eb,K]),(0,P.Z)(()=>{es||ej?o(!1):eh.length?o(!1):o(!0)},[es,ej,eh]),(0,P.Z)(()=>{if(!ej){if(m.length){let e=!1,t=m.map(t=>{let i=eh.find(e=>e.id===(null==t?void 0:t.id));return i?JSON.stringify({...i,visible:void 0})!==JSON.stringify({...t,visible:void 0})?(e=!0,i):t:(e=!0,null)}).filter(e=>e);e&&k(t)}else k(eh[0]?[eh[0]]:[])}},[ej,eh,m],[k]),(0,P.Z)(()=>{if(!em&&O){let e=er.find(e=>e.id===(null==O?void 0:O.id));e?JSON.stringify(e)!==JSON.stringify(O)&&(_(e),B&&B.key===eR.simulations.key&&eB(B.id,B.item)):(eZ(),_(void 0))}},[er,em,O,B],[_,eZ]),(0,P.Z)(()=>{B&&(B.key===eR.geometries.key?eP(B.id):(eB(B.id,B.item),"run"!==B.item&&(A([]),J(void 0))))},[B,Y,U],[eP,eB,eZ]),(0,s.useEffect)(()=>{!U.length&&I&&J(void 0)},[U,I]);let eH=(0,s.useMemo)(()=>eh.map(e=>{let t=m.find(t=>t.id===e.id);return{key:e.id,icon:(0,l.jsx)(x.Z,{}),label:(0,l.jsx)(eF,{visible:!!t,geometry:e,panel:q,add:ew,del:eC,close:eZ})}}),[eh,m,q,ew,eC,eZ]),eK=(0,s.useMemo)(()=>er.map(e=>{let t=e.scheme.configuration||{},i=[];return Object.keys(t).forEach(s=>{if("dimension"===s)return;let a=t[s],n=(0,l.jsx)(p.Z,{style:{color:"green"}});a.error?n=(0,l.jsx)(y.Z,{style:{color:"red"}}):a.done||(n=(0,l.jsx)(b.Z,{style:{color:"orange"}})),"geometry"!==s||eY(a)||(n=(0,l.jsx)(b.Z,{style:{color:"orange"}})),i[a.index]={key:e.id+"&"+s,disabled:!m.length,icon:n,label:a.title}}),{key:e.id,icon:(0,l.jsx)(g.Z,{}),label:(0,l.jsx)(eM,{simulation:e}),children:[{key:e.id+"&about",disabled:!m.length,icon:(0,l.jsx)(p.Z,{style:{color:"green"}}),label:"About"},...i]}}),[m,er,eY]);return!X||ee||es?(0,l.jsx)(T.Z.Simple,{}):ea?(0,l.jsx)(R.ZP,{children:(0,l.jsxs)(u.Z,{hasSider:!0,children:[(0,l.jsxs)(u.Z.Sider,{theme:"light",className:eE().sider,width:256,children:[(0,l.jsx)("div",{className:Q().logo,children:(0,l.jsx)("img",{src:"/images/logo.svg",alt:"Tanatloc"})}),(0,l.jsx)(c.default,{className:eE().menu1,mode:"inline",items:[{key:"menu-go-back",disabled:!0,style:{cursor:"unset",margin:"10px 0",paddingLeft:10},label:(0,l.jsx)(G.ks,{className:Q().fullWidth,onClick:eV,children:"Return to dashboard"})},{type:"divider"},{key:"title",disabled:!0,className:"Menu-title",label:(0,l.jsx)(h.Z.Paragraph,{ellipsis:{tooltip:!0,rows:2},children:ea.title})}]}),(0,l.jsx)("div",{className:eE().menuScroll,children:(0,l.jsx)(c.default,{mode:"inline",className:eE().menu2,defaultOpenKeys:[eR.geometries.key,eR.simulations.key],items:[{key:eR.geometries.key,className:"SubMenu",icon:ej?(0,l.jsx)(j.default,{}):(0,l.jsx)(x.Z,{}),label:(0,l.jsxs)(h.Z.Text,{strong:!0,children:[eR.geometries.label," (",eh.length,")"]}),children:[{key:"new_geometry",disabled:!0,label:(0,l.jsx)(d(),{icon:(0,l.jsx)(f.Z,{}),onClick:ef,children:"New Geometry"})},{key:"geometry-needed",disabled:!0,className:m.length?"display-none":"",icon:(0,l.jsx)(b.Z,{style:{color:"red"}}),label:"A Geometry is needed"},...eH]},{key:eR.simulations.key,className:"SubMenu",icon:em?(0,l.jsx)(j.default,{}):(0,l.jsx)(g.Z,{}),label:(0,l.jsxs)(h.Z.Text,{strong:!0,children:[eR.simulations.label," (",er.length,")"]}),children:[{key:"new_simulation",disabled:!0,label:(0,l.jsx)(d(),{disabled:!eh.length,icon:(0,l.jsx)(v.Z,{}),onClick:ev,children:"New Simulation"})},...eK]}],onClick:eq})})]}),(0,l.jsxs)(u.Z.Content,{className:Q().noScroll,style:{position:"relative"},children:[(0,l.jsx)(ex,{visible:n,project:{id:ea.id,geometries:ea.geometries},swr:{mutateProject:ei,addOneGeometry:eg},setVisible:o}),(0,l.jsx)(e_.ZP.Selector,{user:{id:X.id,authorizedplugins:X.authorizedplugins,usermodels:X.usermodels},visible:w,onOk:eW,onCancel:ek}),(0,l.jsx)(e_.ZP.Updater,{user:{authorizedplugins:X.authorizedplugins},simulation:O&&{id:O.id,scheme:O.scheme},swr:{mutateOneSimulation:eu}}),q,(0,l.jsx)(eO,{project:{id:ea.id,title:ea.title},simulation:O&&{id:O.id,scheme:O.scheme},geometries:m.map(e=>{if("0"!==e.id)return{id:e.id,needCleanup:e.needCleanup}}).filter(e=>e),results:U.map(e=>({name:e.name,glb:e.glb,originPath:e.originPath,extra:e.extra})),postprocessing:I&&{glb:I.glb,originPath:I.originPath}}),(0,l.jsx)(eG,{simulation:O&&{id:O.id,name:O.name}}),(0,l.jsx)(e_.ZP.Postprocessing,{simulation:O&&{id:O.id,scheme:O.scheme},results:U.map(e=>({name:e.name,fileName:e.fileName,originPath:e.originPath})),postprocessing:I&&{name:I.name,fileName:I.fileName},setResult:J})]})]})}):(0,l.jsx)(E,{})}},95361:function(e){e.exports={upload:"add_upload__OHzcC"}},13156:function(e){e.exports={variables:'"@/styles/variables.css"',colorPrimary:"#fad114",sider:"project_sider__KGpqG",menu1:"project_menu1__iUy_z",menuScroll:"project_menuScroll__d4eJz",menu2:"project_menu2__uQFdm"}},73116:function(e){e.exports={loading:"view_loading__rcZQY"}}}]);