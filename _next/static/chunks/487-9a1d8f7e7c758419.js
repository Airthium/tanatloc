(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[487],{72735:function(e,t,n){"use strict";n.d(t,{Z:function(){return a}});var i=n(83755);let l=async(e,t)=>{let n=await (0,i.R)("/api/avatar",{method:"POST",headers:{Accept:"application/json"},body:JSON.stringify({file:e,project:t})});return n.json()};var a={add:l}},80487:function(e,t,n){"use strict";let i;n.d(t,{ZP:function(){return tM}});var l=n(85893),a=n(5152),r=n.n(a),s=n(11163),o=n(67294),d=n(83062),c=n(97183),u=n(68508),m=n(22850),p=n(71577),h=n(99611),y=n(90420),x=n(73480),g=n(48869),w=n(8751),b=n(18429),f=n(11475),v=n(22844),j=n(50888),P=n(88484),Z=n(64789),C=n(36642),k=n(94725),M=n(85813),E=n(42075),S=n(20280);let A={notAllowed:"You are not allowed to be here."};var z=()=>{let e=(0,s.useRouter)(),t=(0,o.useCallback)(()=>{(async()=>{await e.push("/")})()},[e]);return(0,l.jsx)(c.Z,{children:(0,l.jsx)(c.Z.Content,{children:(0,l.jsx)(M.Z,{title:"Not allowed",children:(0,l.jsxs)(E.Z,{direction:"vertical",children:[(0,l.jsxs)(m.Z.Text,{children:[(0,l.jsx)(S.Z,{style:{color:"red"}})," ",A.notAllowed]}),(0,l.jsxs)(m.Z.Text,{children:["Go back"," ",(0,l.jsx)(p.ZP,{type:"link",onClick:t,children:"home"})]})]})})})})},N=n(51302),L=n(9242),D=n(48474),O=n(42661),R=n(77149),F=n(72616),T=n(59734),_=n(83755);let V=async(e,t)=>{let n=await (0,_.R)("/api/geometry",{method:"POST",body:JSON.stringify({project:e,geometry:t})});return n.json()},B=async(e,t)=>{await (0,_.R)("/api/geometry/"+e.id,{method:"PUT",body:JSON.stringify(t)})},U=async e=>{await (0,_.R)("/api/geometry/"+e.id,{method:"DELETE"})},I=async e=>{let t=await (0,_.R)("/api/geometry/"+e.id+"/download");return t.json()},H=async e=>{let t=await (0,_.R)("/api/geometry/"+e.id+"/part");return t.json()};var W={useGeometries:e=>{var t;let{data:n,error:i,mutate:l}=(0,T.ZP)(["/api/geometries",JSON.stringify({ids:e})],e=>{let[t,n]=e;return(0,_._)(t,n)}),a=null!==(t=null==n?void 0:n.geometries)&&void 0!==t?t:[],r=(0,o.useCallback)(async e=>{let t=[...a,e];await l({geometries:t})},[a,l]),s=(0,o.useCallback)(async e=>{let t=a.filter(t=>t.id!==e.id);await l({geometries:t})},[a,l]),d=(0,o.useCallback)(async e=>{let t=a.map(t=>(t.id===e.id&&(t={...t,...e}),t));await l({geometries:t})},[a,l]);return[a,{addOneGeometry:r,delOneGeometry:s,mutateOneGeometry:d,errorGeometries:i,loadingGeometries:!n}]},add:V,update:B,del:U,download:I,getPart:H},X=n(97937),G=n(68847),J=n.n(G),Y=e=>{let{visible:t,title:n,children:i,onClose:a}=e;return(0,l.jsx)(M.Z,{className:J().panel,style:{display:t?"block":"none"},title:n,extra:(0,l.jsx)(p.ZP,{type:"text",icon:(0,l.jsx)(X.Z,{}),onClick:a}),children:i})},K=n(62585),q=n(31365),$=n(86373),Q=n(14856),ee=n.n(Q),et=n(87819),en=n.n(et),ei=n(48764).lW;let el={add:"Unable to add geometry"},ea=e=>e.name.toLowerCase().includes(".stp")||e.name.toLowerCase().includes(".step")||e.name.toLowerCase().includes(".dxf"),er=async e=>{let t=new FileReader;return new Promise(n=>{t.addEventListener("load",()=>{n(t.result)}),t.readAsArrayBuffer(e)})},es=async(e,t,n)=>{if("uploading"===t.file.status)return!0;if("done"===t.file.status){let i=await er(t.file.originFileObj);try{let l=await W.add({id:e.id},{name:t.file.name,uid:t.file.uid,buffer:ei.from(i)});await n.addOneGeometry(l),await n.mutateProject({id:e.id,geometries:[...e.geometries,l.id]})}catch(e){throw(0,L.lt)(el.add,e),e}}return!1};var eo=n(638),ed=n(69677),ec=e=>{let{visible:t,geometry:n,setVisible:i,onEdit:a}=e,r=(0,o.useRef)(null),[s,d]=(0,o.useState)(!1);(0,o.useEffect)(()=>{r.current&&r.current.focus()});let c=(0,o.useCallback)(()=>i(!1),[i]),u=(0,o.useCallback)(async e=>{d(!0);try{await a(e),d(!1),i(!1)}catch(e){throw d(!1),e}},[i,a]);return(0,l.jsx)($.ZP,{title:"Edit the geometry's name",visible:t,initialValues:{name:n.name},onCancel:c,onOk:u,loading:s,children:(0,l.jsx)(eo.Z.Item,{name:"name",label:"Name:",rules:[{required:!0,message:"Name is required"}],children:(0,l.jsx)(ed.Z,{ref:r})})})},eu=n(48764).lW;let em={download:"Unable to download geometry",update:"Unable to update geometry",del:"Unable to delete geometry"},ep=async e=>{try{let t=await W.download({id:e.id}),n=new File([eu.from(t.buffer).toString()],e.name+"."+t.extension),i=window.URL.createObjectURL(n),l=document.createElement("a");l.href=i,l.setAttribute("download",e.name+"."+t.extension),l.click(),l.remove()}catch(e){(0,L.lt)(em.download,e)}},eh=async(e,t,n)=>{try{await W.update({id:e.id},[{key:"name",value:t.name}]),e.name=t.name,await n.mutateOneGeometry(e)}catch(e){throw(0,L.lt)(em.update,e),e}},ey=async(e,t,n,i)=>{try{await W.del({id:e.id});let l=t.geometries.filter(t=>t!==e.id);await i.mutateProject({id:t.id,geometries:l}),await i.delOneGeometry(e),n()}catch(e){throw(0,L.lt)(em.del,e),e}},ex=e=>{var t,n,i,a,r,s;let{project:d,geometry:u,swr:p,close:h,onCleanup:y}=e,[x,g]=(0,o.useState)(!1),[w,b]=(0,o.useState)(!1),[f,v]=(0,o.useState)(!1),j=(0,o.useCallback)(()=>b(!0),[]),P=(0,o.useCallback)(()=>{(async()=>{g(!0);try{await ep(u)}catch(e){}finally{g(!1)}})()},[u]),Z=(0,o.useCallback)(async e=>eh(u,e,p),[u,p]),C=(0,o.useCallback)(async()=>{v(!0);try{await ey(u,d,h,p),y(u.id)}finally{v(!1)}},[d,u,p,h,y]);return u?(0,l.jsx)(c.Z,{children:(0,l.jsx)(c.Z.Content,{children:(0,l.jsx)(M.Z,{size:"small",title:"Informations",actions:[(0,l.jsx)(N.o6,{loading:x,onDownload:P},"download"),(0,l.jsxs)("div",{children:[(0,l.jsx)(ec,{visible:w,geometry:{id:null==u?void 0:u.id,name:null==u?void 0:u.name},setVisible:b,onEdit:Z}),(0,l.jsx)(N.w6,{onEdit:j})]},"edit"),(0,l.jsx)(N.m1,{loading:f,text:(0,l.jsxs)(l.Fragment,{children:["Are you sure you want to delete the geometry"," ",(0,l.jsx)(m.Z.Text,{strong:!0,children:u.name}),"?"]}),onDelete:C},"delete")],children:(0,l.jsxs)(E.Z,{direction:"vertical",className:ee().fullWidth,children:[(0,l.jsxs)(m.Z.Text,{children:[(0,l.jsx)("span",{className:ee().textLight,children:"File:"})," ",u.name," "]}),(0,l.jsxs)(m.Z.Text,{children:[(0,l.jsx)("span",{className:ee().textLight,children:"Unit:"})," ",(0,l.jsx)(K.Z.Inline,{text:"m"})]}),(0,l.jsxs)(l.Fragment,{children:[3===u.summary.dimension&&(0,l.jsxs)(m.Z.Text,{children:[(0,l.jsx)("span",{className:ee().textLight,children:"Number of solids:"})," ",null!==(a=null===(t=u.summary.solids)||void 0===t?void 0:t.length)&&void 0!==a?a:0]}),(0,l.jsxs)(m.Z.Text,{children:[(0,l.jsx)("span",{className:ee().textLight,children:"Number of faces:"})," ",null!==(r=null===(n=u.summary.faces)||void 0===n?void 0:n.length)&&void 0!==r?r:0]}),2===u.summary.dimension&&(0,l.jsxs)(m.Z.Text,{children:[(0,l.jsx)("span",{className:ee().textLight,children:"Number of edges:"})," ",null!==(s=null===(i=u.summary.edges)||void 0===i?void 0:i.length)&&void 0!==s?s:0]})]})]})})})}):(0,l.jsx)(k.Z.Simple,{})};ex.componentName="Geometry",ex.Add=e=>{let{visible:t,project:n,swr:i,setVisible:a}=e,[r,s]=(0,o.useState)(!1),d=(0,o.useCallback)(()=>a(!1),[a]),c=(0,o.useCallback)(e=>{(async()=>{try{let t=await es(n,e,i);s(t),a(t)}catch(e){s(!1)}})()},[n,i,a]);return(0,l.jsx)($.ZP,{title:"Upload geometry",visible:t,onCancel:d,cancelButtonProps:{loading:r},children:(0,l.jsxs)(E.Z,{direction:"vertical",className:ee().fullWidth,children:[(0,l.jsx)(q.Z,{className:en().upload,action:"/api/noop",accept:".stp,.step,.dxf",showUploadList:!1,listType:"picture-card",beforeUpload:ea,onChange:c,children:(0,l.jsx)("div",{children:r?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(j.Z,{style:{fontSize:25}}),(0,l.jsxs)("div",{style:{marginTop:8},children:[(0,l.jsx)("b",{children:"Loading"}),", converting, ..."]})]}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(P.Z,{style:{fontSize:25}}),(0,l.jsxs)("div",{style:{marginTop:8},children:[(0,l.jsx)("b",{children:"Choose a file"})," or drop it here"]})]})})}),(0,l.jsx)(m.Z.Text,{children:(0,l.jsx)("p",{style:{color:"rgba(0, 0, 0, 0.45)",textAlign:"center"},children:"Native file format preferred: STEP (3D) or DXF (2D) file"})})]})})};var eg=n(10739),ew=n(83159),eb=n(96074),ef=n(72269),ev=n(57953),ej=n(41428),eP=n(38095),eZ=n(86350),eC=n(15668),ek=n(35598),eM=n(74317),eE=n(49591),eS=n(19478),eA=n(87784),ez=n(75843),eN=n(15611),eL=n(69980),eD=n(62992),eO=n(53073),eR=n(99477),eF=n(57632),eT=n(79753),e_=n(54327),eV=e=>{let t=new eR.fHI(.025,.025,.8,50);t.translate(0,.4,0);let n=new eR.vBJ({color:e}),i=new eR.Kj0(t,n),l=new eR.b_z(.05,.2,50);l.translate(0,.9,0);let a=new eR.vBJ({color:e}),r=new eR.Kj0(l,a),s=new eR.ZAu;return s.type="ArrowHelper",s.add(i),s.add(r),s.dispose=()=>{t.dispose(),n.dispose(),l.dispose(),a.dispose()},s};let eB=(e,t,n)=>{var i,l;let a=document.createElement("canvas");a.width=null!==(i=null==n?void 0:n.width)&&void 0!==i?i:256,a.height=256;let r=a.getContext("2d");(null==n?void 0:n.background)&&(r.fillStyle=n.background,r.fillRect(0,0,a.width,a.height)),r.fillStyle="grey",r.font="50px sans-serif",r.textAlign=null!==(l=null==n?void 0:n.align)&&void 0!==l?l:"center",r.textBaseline="middle",r.fillText(t,a.width/2,a.height/2);let s=new eR.xEZ(a);s.flipY=!0,s.needsUpdate=!0;let o=new eR.xeV({map:s,transparent:!0,depthWrite:!1});o.map.anisotropy=e.capabilities.getMaxAnisotropy();let d=new eR.jyi(o);return d.type="LabelHelper",(null==n?void 0:n.position)&&d.position.copy(n.position),(null==n?void 0:n.scale)&&d.scale.setScalar(n.scale),d.dispose=()=>{s.dispose(),o.dispose()},d},eU=function(e,t){let{offsetWidth:n,offsetHeight:i,width:l,height:a}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{offsetWidth:0,offsetHeight:0,width:150,height:150},r=n,s=i,o=l,d=a,c=eV("red");c.rotateZ(-Math.PI/2);let u=eB(e,"X",{position:new eR.Pa4(1.1,0,0)}),m=eV("green"),p=eB(e,"Y",{position:new eR.Pa4(0,1.1,0)}),h=eV("blue");h.rotateX(Math.PI/2);let y=eB(e,"Z",{position:new eR.Pa4(0,0,1.1)}),x=new eR.xo$(.05,50,50),g=new eR.vBJ({color:"black"}),w=new eR.Kj0(x,g),b=new eR.ZAu;b.type="AxisHelper",b.add(c),b.add(u),b.add(m),b.add(p),b.add(h),b.add(y),b.add(w);let f=new eR.xsS;f.add(b);let v=new eR.iKG(-1.2,1.2,1.2,-1.2,-2,2);return{dispose:()=>{x.dispose(),g.dispose(),b.children.forEach(e=>{("ArrowHelper"===e.type||"LabelHelper"===e.type)&&e.dispose()}),f.remove(b)},render:()=>{e.setViewport(r,s,o,d),v.rotation.copy(t.rotation),e.render(f,v)},resize:e=>{let{newOffsetWidth:t,newOffsetHeight:n,newWidth:i,newHeight:l}=e;r=t,s=n,o=i,d=l}}},eI=(e,t,n,i,l,a)=>{let{smooth:r,radius:s,left:o,down:d}=l,{xc:c,yc:u,uc:m,vc:p}=a;for(let l=0;l<=r;l++){let a=Math.PI/2*(e+l/r),h=Math.cos(a),y=Math.sin(a);if(t.push(c+s*h,u+s*y,0),n.push(m+o*h,p+d*y),l<r){let t=(r+1)*e+l+4;i.push(e,t,t+1)}}},eH=(e,t,n,i)=>{let l=e/2-n,a=t/2-n,r=n/e,s=(e-n)/e,o=n/t,d=(t-n)/t,c=[l,a,0,-l,a,0,-l,-a,0,l,-a,0],u=[s,d,r,d,r,o,s,o],m=[3*(i+1)+3,3*(i+1)+4,i+4,i+5,2*(i+1)+4,2,1,2*(i+1)+3,3,4*(i+1)+3,4,0],p=[m[0],m[1],m[2],m[0],m[2],m[3],m[4],m[5],m[6],m[4],m[6],m[7],m[8],m[9],m[10],m[8],m[10],m[11]];for(let e=0;e<4;e++){let t=e<1||e>2?l:-l,m=e<2?a:-a,h=e<1||e>2?s:r,y=e<2?d:o;eI(e,c,u,p,{smooth:i,radius:n,left:r,down:o},{xc:t,yc:m,uc:h,vc:y})}let h=new eR.u9r;return h.setIndex(new eR.lCJ(p,1)),h.setAttribute("position",new eR.a$l(c,3)),h.setAttribute("uv",new eR.a$l(u,2)),h},eW=function(e,t,n,i){let{offsetWidth:l,offsetHeight:a,width:r,height:s}=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{offsetWidth:0,offsetHeight:0,width:150,height:150},o="#d3d3d3",d=null,c=null,u=[{text:"FRONT",normal:new eR.Pa4(0,0,1),up:new eR.Pa4(0,1,0)},{text:"BACK",normal:new eR.Pa4(0,0,-1),up:new eR.Pa4(0,1,0)},{text:"RIGHT",normal:new eR.Pa4(1,0,0),up:new eR.Pa4(0,1,0)},{text:"LEFT",normal:new eR.Pa4(-1,0,0),up:new eR.Pa4(0,1,0)},{text:"UP",normal:new eR.Pa4(0,1,0),up:new eR.Pa4(0,0,-1)},{text:"DOWN",normal:new eR.Pa4(0,-1,0),up:new eR.Pa4(0,0,1)}],m=eH(75,75,25,20),p=new eR.xo$(37.5,10,10,0,Math.PI,0),h=new eR.ZAu;u.forEach(e=>{let t=document.createElement("canvas"),n=t.getContext("2d");t.width=t.height=256,n.fillStyle=o,n.fillRect(0,0,t.width,t.height),n.font="bold 50pt sans-serif",n.fillStyle="#000000",n.textAlign="center",n.textBaseline="middle",n.fillText(e.text,t.width/2,t.height/2);let i=new eR.ROQ(t);i.needsUpdate=!0;let l=new eR.vBJ({map:i,transparent:!0,opacity:.75}),a=new eR.vBJ({color:o}),r=new eR.Kj0(m,l),s=new eR.Kj0(m,a);s.rotateY(Math.PI);let d=new eR.vBJ({color:o,transparent:!0,opacity:.2}),c=new eR.Kj0(p,d),u=new eR.ZAu;u.add(r,s,c),u.lookAt(e.normal),u.translateZ(50),u.normal=e.normal,u.up=e.up,h.add(u)});let y=new eR.Mig("#ffffff",1),x=new eR.xsS;x.add(h),x.add(y);let g=new eR.iKG(-100,100,100,-100,-100,100);g.position.z=2;let w=new eR.iMs,b=e=>{let t=f(e);v(t)?(d=j(t),P(),(null==d?void 0:d.uuid)!==(null==c?void 0:c.uuid)&&(Z(),c=d)):(d=null,Z())},f=e=>{let t=e.target,n=t.getBoundingClientRect(),i=e.clientX-n.left,o=e.clientY-n.top,d=new eR.FM8;return d.x=(i-l)/r*2-1,d.y=-(2*((o+s-n.height+a)/s))+1,d},v=e=>e.x>-1&&e.x<1&&e.y>-1&&e.y<1,j=e=>{let t=new eR.Pa4(e.x,e.y,-1);t.unproject(g);let n=new eR.Pa4;g.getWorldDirection(n),w.set(t,n);let i=w.intersectObjects(x.children,!0);return i.length?i[0].object.parent:null},P=()=>{var e;null==d||null===(e=d.children)||void 0===e||e.forEach(e=>{var t;(null===(t=e.material)||void 0===t?void 0:t.color)&&(e.material.previousColor=e.material.color,e.material.color=new eR.Ilk("#FAD114"))})},Z=()=>{var e;null==c||null===(e=c.children)||void 0===e||e.forEach(e=>{var t;(null===(t=e.material)||void 0===t?void 0:t.color)&&(e.material.color=new eR.Ilk(o))})},C=e=>{if(d){var l;let a=d.normal,r=d.up,s=new eR.Pa4;null===(l=t.boundingBox)||void 0===l||l.getCenter(s);let o=n.position.distanceTo(i.target),c=a.clone().multiplyScalar(o),u=s.add(c);n.position.copy(u),n.up.copy(r),d=null,Z(),b(e)}};return e.domElement.addEventListener("pointermove",b),e.domElement.addEventListener("pointerdown",C),{resize:e=>{let{newOffsetWidth:t,newOffsetHeight:n,newWidth:i,newHeight:o}=e;l=t,a=n,r=i,s=o},render:()=>{e.setViewport(l,a,r,s),g.rotation.copy(n.rotation),e.render(x,g)},dispose:()=>{e.domElement.removeEventListener("pointermove",b),e.domElement.removeEventListener("pointerdown",C),h.children.forEach(e=>{e.children.forEach(e=>{e.geometry.dispose(),e.material.dispose()})}),x.remove(h)}}};var eX=e=>1e-12>Math.abs(e)?"0":Math.abs(e)>1e3||.001>Math.abs(e)?e.toExponential(2):e.toFixed(3);let eG=(e,t,n,i)=>{let l,a,r;let s=e=>{let t=Math.max(e.x,e.y,e.z),n=Math.max(Math.ceil(e.x/t*5),2),i=Math.max(Math.ceil(e.y/t*5),2),l=Math.max(Math.ceil(e.z/t*5),2);return new eR.Pa4(n,i,l)},o=(e,t,n,i,l)=>{let a=new eR.ZAu,r=new eR.nls({color:8947848}),s=new eR.Pa4(-e/2,0,-t/2),o=e/(n-1),d=t/(i-1);for(let t=0;t<i;++t){let n=new eR.u9r().setFromPoints([new eR.Pa4(s.x,0,s.z+t*d),new eR.Pa4(s.x+e,0,s.z+t*d)]);a.add(new eR.x12(n,r))}for(let e=0;e<n;++e){let n=new eR.u9r().setFromPoints([new eR.Pa4(s.x+e*o,0,s.z),new eR.Pa4(s.x+e*o,0,s.z+t)]);a.add(new eR.x12(n,r))}return null==l||l(a),a},d=(t,n,i,l)=>{let a=new eR.ZAu,r=Math.abs(n-t),s=r/(l-1),o=new eR.Pa4().copy(i).multiplyScalar(-r/2),d=new eR.Pa4().copy(i).multiplyScalar(s),c=t;for(let t=0;t<l;++t){let t=eB(e,eX(c));t.position.copy(o),a.add(t),o.add(d),c+=s}return a},c=()=>{let e=t.boundingBox,n=t.boundingSphere.center,i=new eR.Pa4(e.max.x-e.min.x,e.max.y-e.min.y,e.max.z-e.min.z),r=s(i);a=1*(l=.1*Math.max(i.x,i.y,i.z));let c=new eR.ZAu,u=o(i.x,i.z,r.x,r.z),m=o(i.x,i.y,r.x,r.y,e=>{e.rotateX(Math.PI/2)}),h=o(i.y,i.z,r.y,r.z,e=>{e.rotateZ(-Math.PI/2)});c.add(u,m,h);let y=d(e.min.x,e.max.x,new eR.Pa4(1,0,0),r.x),x=d(e.min.y,e.max.y,new eR.Pa4(0,1,0),r.y),g=d(e.min.z,e.max.z,new eR.Pa4(0,0,1),r.z);return c.add(y,x,g),c.position.set(n.x,n.y,n.z),c.type="GridHelper",c.dispose=p,c},u=e=>e<=0?-1:1,m=e=>.5>=Math.abs(e)?1:-1,p=()=>{null==r||r.children.forEach(e=>{e.children.forEach(e=>{if("Line"===e.type){let t=e.geometry;t.dispose();let n=e.material;n.dispose()}else e.dispose()})})};return{dispose:p,setVisible:e=>{r.visible=e},update:()=>{let e=t.boundingBox,s=new eR.Pa4(e.max.x-e.min.x,e.max.y-e.min.y,e.max.z-e.min.z),o=!1;t.children.forEach(e=>{"GridHelper"===e.type&&(o=e.visible,t.remove(e),e.dispose())}),r=c();let d=i.object.position.distanceTo(i.target);r.traverse(e=>{"LabelHelper"===e.type&&e.scale.setScalar(.05*d)});let p=new eR.Pa4;n.getWorldDirection(p);let h=d/10/(i.minDistance+.001),y=r.children[0],x=r.children[1],g=r.children[2];y.position.set(0,u(p.y)*(s.y/2+l),0),x.position.set(0,0,u(p.z)*(s.z/2+l)),g.position.set(u(p.x)*(s.x/2+l),0,0);let w=r.children[3],b=r.children[4],f=r.children[5];w.position.set(0,u(p.y)*m(p.y)*(s.y/2+a),-(u(p.z)*m(p.y)*(s.z/2+a))),b.position.set(u(p.x)*m(p.x)*(s.x/2+a),0,-(u(p.z)*m(p.x)*(s.z/2+a))),f.position.set(u(p.x)*m(p.x)*(s.x/2+a),-(u(p.y)*m(p.x)*(s.y/2+a)),0);let v=.2*h,j=.3*h;w.visible=Math.abs(p.y)>v||Math.abs(p.z)>j,b.visible=Math.abs(p.x)>j||Math.abs(p.z)>j,f.visible=Math.abs(p.x)>j||Math.abs(p.y)>v,r.visible=o,t.add(r)}}},eJ=(e,t,n,i)=>{let l=document.createElement("div");l.style.pointerEvents="none",l.style.border="1px solid #55aaff",l.style.backgroundColor="rgba(75, 160, 255, 0.3)",l.style.position="fixed";let a=new eR.FM8,r=new eR.FM8,s=new eR.FM8,o=new eR.FM8,d=!1,c=!1,u=new eR.iMs,m=()=>{d=!1},p=e=>{d&&0===e.button&&(c=!0,x(e))},h=e=>{d&&c&&g(e)},y=e=>{c=!1,d&&w(e)};e.domElement.addEventListener("pointerdown",p),e.domElement.addEventListener("pointermove",h),e.domElement.addEventListener("pointerup",y);let x=t=>{i.enabled=!1,e.domElement.parentElement.appendChild(l),l.style.left=t.clientX+"px",l.style.top=t.clientY+"px",l.style.width="0px",l.style.height="0px",a.x=t.clientX,a.y=t.clientY},g=e=>{o.x=Math.max(a.x,e.clientX),o.y=Math.max(a.y,e.clientY),s.x=Math.min(a.x,e.clientX),s.y=Math.min(a.y,e.clientY),l.style.left=s.x+"px",l.style.top=s.y+"px",l.style.width=o.x-s.x+"px",l.style.height=o.y-s.y+"px"},w=e=>{i.enabled=!0,l.parentElement&&l.parentElement.removeChild(l),r.x=e.clientX,r.y=e.clientY;let t=new eR.TUj(a,r);b(t),m()},b=l=>{let a=new eR.FM8(Math.abs(l.max.x-l.min.x),Math.abs(l.max.y-l.min.y));if(a.x<5||a.y<5)return;let r=new eR.FM8((l.max.x+l.min.x)/2,(l.max.y+l.min.y)/2),s=e.domElement.getBoundingClientRect(),o=r.x-s.left,d=r.y-s.top,c=new eR.FM8(o/s.width*2-1,-(2*(d/s.height))+1),m=t.children.find(e=>"Part"===e.type);if(!m)return;u.setFromCamera(c,n);let p=u.intersectObject(m);if(!p.length)return;i.target.copy(p[0].point);let h=new eR.FM8(a.x/s.width,a.y/s.height),y=Math.max(h.x,h.y),x=n.position.distanceTo(i.target),g=i.target.clone().sub(n.position).normalize().multiplyScalar(x*(1-y));n.position.add(g)};return{dispose:()=>{e.domElement.removeEventListener("pointerdown",p),e.domElement.removeEventListener("pointermove",h),e.domElement.removeEventListener("pointerup",y)},end:m,isEnabled:()=>d,start:()=>{d=!0}}},eY=(e,t,n,i)=>{let l,a,r;let s=new eR.Ilk("#fad114"),o=new eR.Ilk("#E98A15"),d=new eR.Pa4(-1,0,0),c=new eR.JOQ(d),u={up:new eR.Pa4,forward:new eR.Pa4,right:new eR.Pa4},m=new eR.Pa4,p=new eR.Pa4,h=new eR.USm,y=new eR.Pa4,x=new eR.FM8,g=new eR.JOQ,w=new eR.Pa4,b=new eR.Pa4,f=new eR.Zzh,v={up:new eR.Pa4,forward:new eR.Pa4,right:new eR.Pa4},j=new eR.iMs,P=new eR.ZAu;P.type="SectionViewHelper",P.visible=!1,t.add(P),(()=>{let e=new eR._12(1,1),t=new eR.vBJ({color:s,side:eR.ehD,transparent:!0,opacity:.5}),n=new eR.Kj0(e,t);n.type="Plane",P.add(n)})(),(()=>{let e=new eR.xo$(.2,32,32,Math.PI,-Math.PI),t=new eR.vBJ({color:s,side:eR.ehD,transparent:!0,opacity:.5}),n=new eR.Kj0(e,t);n.type="Dome",P.add(n)})(),(()=>{class e extends eR.Hyl{getPoint(e){return new eR.Pa4().set(this.radius*Math.cos(Math.PI*e),this.radius*Math.sin(Math.PI*e),0)}constructor(e){super(),this.radius=e}}let t=new e(.2);{let e=new eR.WXh(t,32,.020000000000000004,32),n=new eR.vBJ({color:s,side:eR.ehD,transparent:!0,opacity:.5}),i=new eR.Kj0(e,n);i.rotateX(Math.PI/2),i.type="ArcX",P.add(i)}{let e=new eR.WXh(t,32,.020000000000000004,32),n=new eR.vBJ({color:s,side:eR.ehD,transparent:!0,opacity:.5}),i=new eR.Kj0(e,n);i.rotateX(Math.PI/2),i.rotateY(Math.PI/2),i.type="ArcY",P.add(i)}})();let Z=()=>{let e=new eR.Pa4;t.boundingBox.getSize(e),e.multiplyScalar(1.2);let n=Math.max(Math.max(e.x,e.y),e.z);P.scale.setScalar(n)},C=()=>{let e=new eR.Pa4;t.boundingBox.getCenter(e),P.position.copy(e)},k=()=>{P.rotateX(Math.PI);let e=c.normal.multiplyScalar(-1);c.setFromNormalAndCoplanarPoint(e,P.position)},M=e=>{let t=e.target,n=t.getBoundingClientRect(),i=e.clientX-n.left,l=e.clientY-n.top,a=new eR.FM8;return a.x=i/n.width*2-1,a.y=-(2*(l/n.height))+1,a},E=e=>{l&&l.material.color.set(s),l=e,e&&e.material.color.set(o)},S=()=>{i.enabled=!0},A=()=>{i.enabled=!1},z=()=>{n.getWorldDirection(u.forward),u.forward.normalize(),u.up.copy(n.up).normalize(),u.right.crossVectors(u.up,u.forward).normalize()},N=()=>{let e=new eR.Pa4(0,0,1).applyQuaternion(P.quaternion).multiplyScalar(-1);c.setFromNormalAndCoplanarPoint(e,P.position)},L=e=>{if(!P.visible)return;let t=M(e);if(j.setFromCamera(t,n),a){let e=new eR.Pa4;j.ray.intersectPlane(g,e),(null==r?void 0:r.type)==="Plane"?O(e):(null==r?void 0:r.type)==="Dome"?F(t):_(e),N()}else{let e=j.intersectObject(P);e.length?(A(),E(r=e[0].object),p.copy(e[0].point),z()):(r=null,E(),S())}},D=()=>{g.setFromNormalAndCoplanarPoint(u.forward,p),m.copy(P.position);let e=new eR.Pa4;j.ray.intersectPlane(g,e),w.copy(e).sub(m),b.copy(w).normalize(),f.set(m,new eR.Pa4().copy(m).add(c.normal))},O=e=>{e.sub(w);let t=new eR.Pa4;f.closestPointToPoint(e,!1,t),P.position.copy(t)},R=e=>{h.copy(P.rotation),x.copy(e)},F=e=>{P.rotation.copy(h),P.rotateOnWorldAxis(u.up,-(5*(x.x-e.x))),P.rotateOnWorldAxis(u.right,-(5*(x.y-e.y)))},T=()=>{r.getWorldDirection(y),h.copy(P.rotation),w.copy(p).sub(P.position),b.copy(w).normalize(),v.up.copy(b),v.right.copy(y),v.forward.crossVectors(v.right,v.up),f.set(p,new eR.Pa4().copy(p).add(v.forward)),g.setFromNormalAndCoplanarPoint(u.forward,p)},_=e=>{let t=i.object.position.distanceTo(i.target),n=new eR.Pa4;f.closestPointToPoint(e,!1,n);let l=p.distanceTo(n);n.sub(p);let a=new eR.Pa4().copy(b).cross(n).normalize(),r=Math.sign(y.dot(a));P.rotation.copy(h),P.rotateOnWorldAxis(y,r*l*1/(t/100))},V=e=>{switch(null==r?void 0:r.type){case"Plane":D();break;case"Dome":R(e);break;case"ArcX":case"ArcY":T()}},B=e=>{if(P.visible&&r){a=!0;let t=M(e);V(t)}},U=()=>{P.visible&&(a=!1,E())};return e.domElement.addEventListener("pointermove",L),e.domElement.addEventListener("pointerdown",B),e.domElement.addEventListener("pointerup",U),{getClippingPlane:()=>c,toggleVisible:()=>{let e=P.visible;P.visible=!e},start:()=>{e.localClippingEnabled=!0,P.visible=!0,Z(),C();let t=new eR.Pa4().copy(P.position).sub(d);P.lookAt(t),c.setFromNormalAndCoplanarPoint(d,P.position)},stop:()=>{e.localClippingEnabled=!1,P.visible=!1},toAxis:e=>{if(C(),d.equals(e)){k();return}let t=new eR.Pa4().copy(P.position).sub(e);P.lookAt(t),c.setFromNormalAndCoplanarPoint(e,P.position),d.copy(e)},flip:k,dispose:()=>{P.traverse(e=>{("Plane"===e.type||"Dome"===e.type||"ArcX"===e.type||"ArcY"===e.type)&&(e.geometry.dispose(),e.material.dispose())}),e.domElement.removeEventListener("pointermove",L),e.domElement.removeEventListener("pointerdown",B),e.domElement.removeEventListener("pointerup",U)}}};var eK=n(54104);let eq=e=>{let t=new eK.A("rainbow",512);t.setMin(Number.MAX_VALUE),t.setMax(-Number.MAX_VALUE);let n=new eR.xsS,i=new eR.iKG(-1,1,1,-1,2,1);i.position.set(0,0,1);let l=new eR.ZAu;n.add(l);let a=!1,r=()=>{n.children.forEach(e=>{e.children.forEach(t=>{"LabelHelper"===t.type&&t.dispose(),"Sprite"===t.type&&t.dispose(),e.remove(t)})})},s=t=>{let n=eX(t.minV),i=eX(t.maxV),a=eB(e,String(n),{background:"white",position:new eR.Pa4(-.62,0,0),width:512,align:"right"});a.scale.x=.4,a.scale.y=2.8,a.renderOrder=0;let r=eB(e,String(i),{background:"white",position:new eR.Pa4(.62,0,0),width:512,align:"left"});r.scale.x=.4,r.scale.y=2.8,r.renderOrder=0,l.add(a),l.add(r)};return{render:()=>{let t=e.domElement.getBoundingClientRect();e.setViewport(t.width/2-350,t.height-50,700,50),e.render(n,i)},addLUT:e=>{if(!a){let n=t.minV,i=t.maxV;t.setMin(Math.min(n,e.minV)),t.setMax(Math.max(i,e.maxV))}let n=new eR.ROQ(t.createCanvas()),i=new eR.xeV({map:n,depthWrite:!1}),r=new eR.jyi(i);r.material.rotation=-Math.PI/2,r.scale.x=.2,r.scale.y=1.2,r.renderOrder=1,r.dispose=r.material.dispose,l.add(r),s(t)},getMinV:()=>t.minV,getMaxV:()=>t.maxV,getColor:e=>t.getColor(e),setVisible:e=>{n.children.forEach(t=>{t.children.forEach(t=>t.visible=e)})},setColorMap:e=>{t.setColorMap(e,512)},setRange:(e,n)=>{a=!0,t.setMin(e),t.setMax(n)},setAutomaticRange:()=>{a=!1,t.setMin(Number.MAX_VALUE),t.setMax(-Number.MAX_VALUE)},dispose:()=>{a||(t.setMin(Number.MAX_VALUE),t.setMax(-Number.MAX_VALUE)),r()}}},e$=e=>{let t=new eR.ZAu;t.type="PointHelper",t.visible=!1,e.add(t);let n=()=>{var t,n;let i=(null!==(n=null===(t=e.boundingSphere)||void 0===t?void 0:t.radius)&&void 0!==n?n:1)/100,l=new eR.xo$(i),a=new eR.Wid({color:16711680});return new eR.Kj0(l,a)},i=(e,t)=>{let n=new eR.u9r().setFromPoints([e,t]),i=new eR.nls({color:16711680});return new eR.x12(n,i)},l=()=>{let t=[],n=e.boundingBox.max.x-e.boundingBox.min.x,l=e.boundingBox.max.y-e.boundingBox.min.y,a=e.boundingBox.max.z-e.boundingBox.min.z,r=Math.max(n,l,a),s=i(new eR.Pa4(-r/2,0,0),new eR.Pa4(r/2,0,0));t.push(s);let o=i(new eR.Pa4(0,-r/2,0),new eR.Pa4(0,r/2,0));t.push(o);let d=i(new eR.Pa4(0,0,-r/2),new eR.Pa4(0,0,r/2));return t.push(d),t},a=()=>{t.children.forEach(e=>{t.remove(e),e.geometry.dispose(),e.material.dispose()})};return{build:()=>{a();let e=n(),i=l();t.add(e),t.add(...i)},dispose:a,update:e=>{e?(t.position.set(e.x,e.y,e.z),t.visible=!0):t.visible=!1}}};var eQ=n(77836),e0=n(82854),e1=n(6648),e2=n(48764).lW;let e4=(e,t)=>{e.traverse(e=>{if("Mesh"===e.type){let n=new eR.Uk6(e.geometry),i=new eR.nls({color:e.material.color,linewidth:1}),l=new eR.ejS(n,i);e.add(l),e.material.visible=!1,e.material.clippingPlanes=[t]}})},e5=(e,t)=>{e.traverse(e=>{if("Mesh"===e.type||"Line"===e.type){let n=e.geometry.getAttribute("data");if(n){let t=n.array.reduce((e,t)=>Math.min(e,t),n.array[0]),i=n.array.reduce((e,t)=>Math.max(e,t),n.array[0]);t===i&&(t-=1,i+=1);let l=new eK.A;l.setMin(t),l.setMax(i),e.userData={...e.userData,lut:l}}if("Mesh"===e.type){let t=new eR.Uk6(e.geometry),n=new eR.nls({linewidth:1}),i=new eR.ejS(t,n);e.add(i)}e.material.vertexColors=!0,e.material.clippingPlanes=[t]}})},e8=(e,t)=>{e.traverse(e=>{"Mesh"===e.type&&(e.material.clippingPlanes=[t],e.material.originalColor=e.material.color)})},e3=(e,t)=>{let n=new eR.Ilk("#FAD114"),i=new eR.Ilk("#EE9817"),l=async(e,t,n,i)=>{let l=new Blob([e2.from(e.buffer)]),d=URL.createObjectURL(l),c=new eQ.E,u=new e0._;u.setDecoderPath("/three/libs/draco/"),c.setDRACOLoader(u);let m=new e1.a;m.setTranscoderPath("node_modules/three//examples/js/libs/basis/"),c.setKTX2Loader(m);let p=await new Promise((e,t)=>{c.load(d,t=>{e(t)},()=>void 0,e=>t(e))}),w=p.scene,b=new eR.Tme;return b.type="Part",b.uuid=e.summary.uuid,b.children=w.children,b.userData=w.userData,"mesh"===e.summary.type?e4(b,i):"result"===e.summary.type?e5(b,i):("geometry3D"===e.summary.type||"geometry2D"===e.summary.type)&&e8(b,i),s(b,t),o(b,n),b.boundingBox=a(b),b.dispose=()=>r(b),b.setTransparent=e=>s(b,e),b.setDisplayMesh=e=>o(b,e),b.startSelection=(e,t,n)=>x(b,e,t,n),b.stopSelection=()=>g(),b.getHighlighted=()=>h,b.getSelected=()=>y,b.highlight=C,b.unhighlight=k,b.select=E,b.unselect=S,b},a=e=>{let t=new eR.ZzF;return e.traverse(e=>{t.expandByObject(e)}),t},r=e=>{e.traverse(e=>{"Mesh"===e.type&&(e.geometry.dispose(),e.material.dispose())})},s=(e,t)=>{e.traverse(e=>{"Mesh"===e.type&&(e.material.transparent=t,e.material.opacity=t?.5:1,e.material.depthWrite=!t)})},o=(e,t)=>{"result"===e.userData.type&&e.traverse(e=>{e.traverse(e=>{"LineSegments"===e.type&&(e.visible=t)})})},d=new eR.iMs,c=null,u=null,m=null,p=null,h=null,y=[],x=(e,t,n,i)=>{c=e,u=i,m=t,p=n,h=null,y.length=0,m.domElement.addEventListener("pointermove",Z),m.domElement.addEventListener("pointerdown",M)},g=()=>{null==m||m.domElement.removeEventListener("pointermove",Z),null==m||m.domElement.removeEventListener("pointerdown",M),k(),h=null,y.forEach(e=>{S(e.uuid)}),y.length=0,u=null,c=null,m=null,p=null},w=(e,t)=>{let n;if(e&&t)return e.traverse(e=>{e.userData.uuid===t&&(n=e)}),n},b=e=>{let t=e.target,n=t.getBoundingClientRect(),i=e.clientX-n.left,l=e.clientY-n.top,a=new eR.FM8;return a.x=i/n.width*2-1,a.y=-(2*(l/n.height))+1,a},f=()=>{let t=d.intersectObject(c,!0);if(t.length){let n=t[0].object,i=n.parent;i&&e(c,i.userData.uuid,i.userData.label)}else e(c)},v=()=>{let t;let n=c.userData;if(2===n.dimension){if((t=d.intersectObject(c,!0)).length){let n=t[0].object,i=n.parent;(null==i?void 0:i.type)==="Mesh"?e(c,i.userData.uuid,i.userData.label):e(c,n.userData.uuid,n.userData.label)}else e(c)}else if((t=d.intersectObject(c,!0)).length){let n=t[0].object;e(c,n.userData.uuid,n.userData.label)}else e(c)},j=()=>{let t;let n=c.userData,i=n.edges;if((t=d.intersectObject(c,!0)).length){let n=t[0].object,l=null==i?void 0:i.find(e=>e.uuid===n.userData.uuid);l?e(c,n.userData.uuid,n.userData.label):e(c)}else e(c)},P=()=>{let t=d.intersectObject(c,!0);if(t.length){let n=t[0];e(c,void 0,void 0,n.point)}else e(c)},Z=e=>{let t=b(e);switch(d.setFromCamera(t,p),u){case"solids":f();break;case"faces":v();break;case"edges":j();break;case"point":P()}},C=e=>{if(e===(null==h?void 0:h.uuid))return;k();let t=w(c,e);t&&(h={uuid:t.userData.uuid,label:t.userData.label},"Mesh"===t.type?t.material.color=n:t.traverse(e=>{"Mesh"===e.type&&(e.material.color=n)}))},k=()=>{let e=w(c,null==h?void 0:h.uuid);if(h=null,!e)return;let t=y.findIndex(t=>t.uuid===e.userData.uuid);"Mesh"===e.type?e.material.color=-1===t?e.material.originalColor:i:e.traverse(e=>{"Mesh"===e.type&&(e.material.color=-1===t?e.material.originalColor:i)})},M=()=>{h&&t(c,h.uuid,h.label)},E=e=>{let t=w(c,e);t&&(y.push({uuid:e,label:t.userData.label}),"Mesh"===t.type?t.material.color=i:t.traverse(e=>{"Mesh"===e.type&&(e.material.color=i)}))},S=e=>{let t=w(c,e),n=y.findIndex(t=>t.uuid===e);-1!==n&&(y=[...y.slice(0,n),...y.slice(n+1)]),t&&("Mesh"===t.type?t.material.color=t.material.originalColor:t.traverse(e=>{"Mesh"===e.type&&(e.material.color=e.material.originalColor)}))};return{load:l}};var e7=n(40782),e6=n(72735),e9=n(60968),te=n.n(e9);let tt={load:"Error while loading part",snapshot:"Error while taking snapshot",saveScreenshot:"Unable to save screenshot"},tn=!1,ti=e=>{let t=new eR.ZzF;e.children.forEach(e=>{if(e.visible&&"Part"===e.type){let n=e.boundingBox,i=new eR.Pa4(Math.min(t.min.x,n.min.x),Math.min(t.min.y,n.min.y),Math.min(t.min.z,n.min.z)),l=new eR.Pa4(Math.max(t.max.x,n.max.x),Math.max(t.max.y,n.max.y),Math.max(t.max.z,n.max.z));t.set(i,l)}});let n=new eR.aLr;t.getBoundingSphere(n),e.boundingBox=t,e.boundingSphere=n},tl=(e,t,n)=>{let i=t.object.position.distanceTo(t.target),l=t.target.clone().sub(e.position).normalize().multiplyScalar(i*n*.01);e.position.add(l)},ta=(e,t,n)=>{let i=e.children.find(e=>"Part"===e.type);if(!i)return;tn=!0;let l=e.boundingSphere,a=l.center,r=2*l.radius,s=r/(2*Math.atan(Math.PI*t.fov/360)),o=s/t.aspect,d=1.1*Math.max(s,o),c=n.target.clone().sub(t.position).normalize().multiplyScalar(d);n.target.copy(a),n.minDistance=d/10,n.maxDistance=10*d,t.position.copy(a).sub(c),t.near=d/100,t.far=100*d,t.updateProjectionMatrix()},tr=async(e,t,n,i,l,a,r)=>{let s=e3((e,t,n,i)=>{t?(e.highlight(t),setTimeout(()=>r((0,e7.CH)({uuid:t,label:n})),1)):i?r((0,e7.N7)({x:i.x,y:i.y,z:i.z})):(e.unhighlight(),setTimeout(()=>r((0,e7.HW)()),1))},(e,t,n)=>{let i=e.getSelected();i.find(e=>e.uuid===t)?(e.unselect(t),setTimeout(()=>r((0,e7.hF)({uuid:t,label:n})),1)):(e.select(t),setTimeout(()=>r((0,e7.Ys)({uuid:t,label:n})),1))}),o=await s.load(e,l.transparent,l.displayMesh,a.sectionViewHelper.getClippingPlane());t.add(o),ti(t),tn||ta(t,n,i),a.gridHelper.update(),a.gridHelper.update(),a.gridHelper.setVisible(!0),a.pointHelper.build()},ts=(e,t)=>{for(let n of(t.dispose(),t.setVisible(!1),e.children))"Part"===n.type&&"result"===n.userData.type&&n.traverse(e=>{("Mesh"===e.type||"Line"===e.type)&&(t.addLUT(e.userData.lut),t.setVisible(!0))})},to=(e,t)=>{for(let n of(ts(e,t),e.children))"Part"===n.type&&"result"===n.userData.type&&n.traverse(e=>{if("Mesh"===e.type||"Line"===e.type){let n=e.geometry.getAttribute("data"),i=new Float32Array(3*n.count);for(let e=0;e<n.count;e++){let l=t.getColor(n.array[e]);i[3*e+0]=l.r,i[3*e+1]=l.g,i[3*e+2]=l.b}e.geometry.setAttribute("color",new eR.a$l(i,3))}})},td=async(e,t,n,i)=>{try{let l=i.domElement.width,a=i.domElement.height,r=n.aspect;i.domElement.width=520,i.domElement.height=312,n.aspect=520/312,n.updateProjectionMatrix(),i.clear(),i.setViewport(0,0,520,312),i.render(t,n);let s=i.domElement.toDataURL();i.domElement.width=l,i.domElement.height=a,n.aspect=r,n.updateProjectionMatrix(),await e6.Z.add({name:"snapshot",uid:"snapshot_"+(0,eF.Z)(),data:s},{id:e.id})}catch(e){(0,L.lt)(tt.snapshot,e)}},tc=(e,t,n,i)=>{try{let l=i.domElement.width,a=i.domElement.height;i.clear(),i.setViewport(0,0,l,a),i.render(t,n);let r=i.domElement.toDataURL(),s=document.createElement("a");s.href=r.replace("image/png","image/octet-stream"),s.download=e.title+"_"+new Date().toLocaleDateString()+".png",s.click()}catch(e){(0,L.lt)(tt.saveScreenshot,e)}};var tu=e=>{var t,n,a,r,u;let{loading:m,project:h,parts:x}=e,g=(0,o.useRef)(null),w=(0,o.useRef)(),b=(0,o.useRef)(),f=(0,o.useRef)(),v=(0,o.useRef)(),P=(0,o.useRef)(),Z=(0,o.useRef)(),k=(0,o.useRef)(),M=(0,o.useRef)(),E=(0,o.useRef)(),[S,A]=(0,o.useState)(!1),[z,N]=(0,o.useState)(!0),[O,R]=(0,o.useState)(!1),[F,T]=(0,o.useState)(!1),[_,V]=(0,o.useState)(!1),[B,U]=(0,o.useState)(!1),I=(0,s.useRouter)(),{enabled:H,part:W,highlighted:X,selected:G,point:J,type:Y,dispatch:K}=(0,o.useContext)(D.ZB);(0,o.useEffect)(()=>{var e;if(!e_.Z.isWebGLAvailable()){(async()=>{await I.push("/webgl")})();return}let t=g.current,n=t.clientWidth,i=t.clientHeight;w.current=new eR.xsS,w.current.boundingBox=new eR.ZzF,w.current.boundingSphere=new eR.aLr,b.current=new eR.cPb(50,n/i,.1,1e3),b.current.position.z=10;let l=new eR.Mig("#aaa",.75);w.current.add(l);let a=new eR.cek("#fff",.5);a.decay=2,b.current.add(a),w.current.add(b.current),f.current=new eR.CP7({antialias:!0,alpha:!0}),f.current.setClearColor("#ffffff"),f.current.setSize(n,i),f.current.setPixelRatio(null!==(e=window.devicePixelRatio)&&void 0!==e?e:1),f.current.shadowMap.enabled=!0,f.current.autoClear=!1,t.appendChild(f.current.domElement),v.current=new eT.$(b.current,t),v.current.rotateSpeed=3,v.current.panSpeed=.1;let r=eU(f.current,b.current,{offsetWidth:n-155,offsetHeight:i-155,width:150,height:150}),s=eW(f.current,w.current,b.current,v.current,{offsetWidth:n-155,offsetHeight:i-155,width:150,height:150});P.current=eG(f.current,w.current,b.current,v.current),Z.current=eJ(f.current,w.current,b.current,v.current),k.current=eY(f.current,w.current,b.current,v.current),M.current=eq(f.current),M.current.setVisible(!1),E.current=e$(w.current);let o=()=>{v.current.update(),f.current.setViewport(0,0,n,i),f.current.render(w.current,b.current),P.current.update(),r.render(),s.render(),M.current.render()},d=()=>{n=t.clientWidth,i=t.clientHeight,b.current.aspect=n/i,b.current.updateProjectionMatrix(),f.current.setSize(n,i),r.resize({newOffsetWidth:n-155,newOffsetHeight:i-155,newWidth:150,newHeight:150}),s.resize({newOffsetWidth:n-155,newOffsetHeight:i-155,newWidth:150,newHeight:150}),o()},c=()=>{o(),setTimeout(()=>requestAnimationFrame(c),1e3/30)};return window.addEventListener("resize",d),requestAnimationFrame(c),()=>{tn=!1,window.removeEventListener("resize",d),t.removeChild(f.current.domElement),w.current.children.forEach(e=>{w.current.remove(e)}),r.dispose(),s.dispose(),P.current.dispose(),k.current.dispose(),Z.current.dispose(),M.current.dispose(),E.current.dispose()}},[I]),(0,C.Z)(()=>{if(!w.current)return;let e=w.current.children;if(!x.length){var t;ti(w.current),P.current.update(),null===(t=E.current)||void 0===t||t.build()}let n=x.filter(t=>!e.find(e=>e.uuid===t.summary.uuid)),i=e.filter(e=>!x.find(t=>t.summary.uuid===e.uuid)).filter(e=>"Part"===e.type);i.forEach(e=>{var t;null===(t=w.current)||void 0===t||t.remove(e),e.dispose()}),(async()=>{await Promise.all(n.map(async e=>{try{await tr(e,w.current,b.current,v.current,{transparent:S,displayMesh:z},{gridHelper:P.current,sectionViewHelper:k.current,pointHelper:E.current},K)}catch(e){(0,L.lt)(tt.load,e),ti(w.current)}})),to(w.current,M.current)})()},[x,S,z,K]),(0,C.Z)(()=>{var e;if(w.current){if((null===(e=x[0])||void 0===e?void 0:e.summary.dimension)===2){ti(w.current);let e=new eR.Pa4(0,0,1),t=new eR.Pa4(0,1,0),n=new eR.Pa4;w.current.boundingBox.getCenter(n);let i=b.current.position.distanceTo(v.current.target),l=e.clone().multiplyScalar(i),a=n.add(l);b.current.position.copy(a),b.current.up.copy(t),v.current.noRotate=!0}else v.current.noRotate=!1}},[x]),(0,o.useEffect)(()=>{w.current&&w.current.children.forEach(e=>{"Part"===e.type&&e.userData.uuid===W&&(H?e.startSelection(f.current,b.current,Y):e.stopSelection())})},[H,W,Y]),(0,o.useEffect)(()=>{w.current&&w.current.children.forEach(e=>{if("Part"===e.type&&e.uuid===W){e.highlight(null==X?void 0:X.uuid);let t=e.getSelected(),n=G.filter(e=>!t.find(t=>t.uuid===e.uuid));n.forEach(t=>{t.uuid&&e.select(t.uuid)});let i=t.filter(e=>!G.find(t=>t.uuid===e.uuid));i.forEach(t=>{e.unselect(t.uuid)})}})},[W,X,G]),(0,o.useEffect)(()=>{var e;w.current&&(null===(e=E.current)||void 0===e||e.update(J?new eR.Pa4(J.x,J.y,J.z):void 0))},[J]);let q=(0,o.useCallback)(e=>{A(e),w.current.children.forEach(t=>{"Part"===t.type&&t.setTransparent(e)})},[]),Q=(0,o.useCallback)(e=>{N(e),w.current.children.forEach(t=>{"Part"===t.type&&t.setDisplayMesh(e)})},[]),et=(0,o.useCallback)(()=>{let e=!O;R(e),e?k.current.start():k.current.stop()},[O]),en=(0,o.useCallback)(()=>{(async()=>{T(!0);try{await td(h,w.current,b.current,f.current)}finally{T(!1)}})()},[h]),ei=(0,o.useCallback)(()=>{V(!0);try{tc(h,w.current,b.current,f.current)}finally{V(!1)}},[h]),el=(0,o.useCallback)(e=>{var t;null===(t=P.current)||void 0===t||t.setVisible(e)},[]),ea=(0,o.useCallback)(()=>{tl(b.current,v.current,1),i=requestAnimationFrame(()=>ea())},[]),er=(0,o.useCallback)(()=>{tl(b.current,v.current,-1),i=requestAnimationFrame(()=>er())},[]),es=(0,o.useCallback)(()=>{i&&cancelAnimationFrame(i),i=void 0},[]),ec=(0,o.useCallback)(()=>{ta(w.current,b.current,v.current)},[]),eu=(0,o.useCallback)(()=>{k.current.toAxis(new eR.Pa4(-1,0,0))},[]),em=(0,o.useCallback)(()=>{k.current.toAxis(new eR.Pa4(0,-1,0))},[]),ep=(0,o.useCallback)(()=>{k.current.toAxis(new eR.Pa4(0,0,-1))},[]),eh=(0,o.useCallback)(e=>{var t;null===(t=M.current)||void 0===t||t.setColorMap(e.key),to(w.current,M.current)},[]),ey=(0,o.useCallback)(()=>{U(!0)},[]),ex=(0,o.useCallback)(()=>{U(!1)},[]),eg=(0,o.useCallback)(async e=>{var t;null===(t=M.current)||void 0===t||t.setRange(+e.min,+e.max),to(w.current,M.current),ex()},[ex]),eF=(0,o.useCallback)(()=>{var e;null===(e=M.current)||void 0===e||e.setAutomaticRange(),to(w.current,M.current)},[]);return(0,l.jsxs)(c.Z,{className:"".concat(ee().noScroll," ").concat(te().view),children:[(0,l.jsxs)($.ZP,{visible:B,title:"Custom range",initialValues:{min:null===(t=M.current)||void 0===t?void 0:t.getMinV(),max:null===(n=M.current)||void 0===n?void 0:n.getMaxV()},onCancel:ex,onOk:eg,children:[(0,l.jsx)(eo.Z.Item,{label:"Min",name:"min",children:(0,l.jsx)(ed.Z,{})}),(0,l.jsx)(eo.Z.Item,{label:"Max",name:"max",children:(0,l.jsx)(ed.Z,{})})]}),(0,l.jsxs)(c.Z.Header,{className:te().head,children:[(0,l.jsx)(d.Z,{title:"Take snapshot",placement:"left",children:(0,l.jsx)(ew.Z,{placement:"bottom",menu:{items:[{key:"project",label:(0,l.jsx)(p.ZP,{type:"text",className:"".concat(ee().fullWidth," ").concat(ee().noBackground),loading:F,onClick:en,children:"Project snapshot"})},{key:"image",label:(0,l.jsx)(p.ZP,{type:"text",className:"".concat(ee().fullWidth," ").concat(ee().noBackground),loading:_,onClick:ei,children:"Export image"})}]},children:(0,l.jsx)(p.ZP,{icon:(0,l.jsx)(ej.Z,{})})})}),(0,l.jsx)(eb.Z,{style:{margin:0}}),(0,l.jsx)(d.Z,{title:"Display grid",placement:"left",children:(0,l.jsx)(ef.Z,{defaultChecked:!0,checkedChildren:(0,l.jsx)(eP.Z,{}),unCheckedChildren:(0,l.jsx)(eP.Z,{}),onChange:el})}),(0,l.jsx)(d.Z,{title:"Set transparency",placement:"left",children:(0,l.jsx)(ef.Z,{checked:S,checkedChildren:(0,l.jsx)(eZ.Z,{}),unCheckedChildren:(0,l.jsx)(eZ.Z,{}),onChange:q})}),(0,l.jsx)(eb.Z,{style:{margin:0}}),(0,l.jsx)(d.Z,{title:"Zoom out",placement:"left",children:(0,l.jsx)(p.ZP,{icon:(0,l.jsx)(eC.Z,{}),onMouseDown:er,onMouseUp:es,onMouseOut:es})}),(0,l.jsx)(d.Z,{title:"Zoom in",placement:"left",children:(0,l.jsx)(p.ZP,{icon:(0,l.jsx)(ek.Z,{}),onMouseDown:ea,onMouseUp:es,onMouseOut:es})}),(0,l.jsx)(d.Z,{title:"Zoom to fit",placement:"left",children:(0,l.jsx)(p.ZP,{icon:(0,l.jsx)(eM.Z,{}),onClick:ec})}),(0,l.jsx)(d.Z,{title:"Zoom to selection",placement:"left",children:(0,l.jsx)(p.ZP,{icon:(0,l.jsx)(eE.Z,{}),onClick:(null===(a=Z.current)||void 0===a?void 0:a.isEnabled())?null===(r=Z.current)||void 0===r?void 0:r.end:null===(u=Z.current)||void 0===u?void 0:u.start})}),(0,l.jsx)(eb.Z,{style:{margin:0}}),!O&&(0,l.jsx)(d.Z,{title:"Section view",placement:"left",children:(0,l.jsx)(p.ZP,{icon:(0,l.jsx)(eS.Z,{}),onClick:et})}),O&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(d.Z,{title:"Stop",placement:"left",children:(0,l.jsx)(p.ZP,{icon:(0,l.jsx)(eA.Z,{}),onClick:et})}),(0,l.jsx)(d.Z,{title:"Hide plane",placement:"left",children:(0,l.jsx)(p.ZP,{icon:(0,l.jsx)(y.Z,{}),onClick:k.current.toggleVisible})}),(0,l.jsx)(d.Z,{title:"Snap to X",placement:"left",children:(0,l.jsx)(p.ZP,{className:"ant-btn-icon-only",onClick:eu,children:"X"})}),(0,l.jsx)(d.Z,{title:"Snap to Y",placement:"left",children:(0,l.jsx)(p.ZP,{className:"ant-btn-icon-only",onClick:em,children:"Y"})}),(0,l.jsx)(d.Z,{title:"Snap to Z",placement:"left",children:(0,l.jsx)(p.ZP,{className:"ant-btn-icon-only",onClick:ep,children:"Z"})}),(0,l.jsx)(d.Z,{title:"Flip",placement:"left",children:(0,l.jsx)(p.ZP,{onClick:k.current.flip,icon:(0,l.jsx)(ez.Z,{})})})]}),x.filter(e=>"result"===e.summary.type).length?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(eb.Z,{className:"no-margin"}),(0,l.jsx)(d.Z,{title:"Display result mesh",placement:"left",children:(0,l.jsx)(ef.Z,{checked:z,checkedChildren:(0,l.jsx)(eN.Z,{}),unCheckedChildren:(0,l.jsx)(eN.Z,{}),onChange:Q})}),(0,l.jsx)(d.Z,{title:"Colormap",placement:"left",children:(0,l.jsx)(ew.Z,{placement:"bottom",menu:{items:[{key:"rainbow",label:"Rainbow"},{key:"cooltowarm",label:"Cool to warm"},{key:"blackbody",label:"Black body"},{key:"grayscale",label:"Gray scale"}],onClick:eh},children:(0,l.jsx)(p.ZP,{icon:(0,l.jsx)(eL.Z,{})})})}),(0,l.jsx)(d.Z,{title:"Custom range",placement:"left",children:(0,l.jsx)(p.ZP,{icon:(0,l.jsx)(eD.Z,{}),onClick:ey})}),(0,l.jsx)(d.Z,{title:"Automatic range",placement:"left",children:(0,l.jsx)(p.ZP,{icon:(0,l.jsx)(eO.Z,{}),onClick:eF})})]}):null]}),(0,l.jsxs)(c.Z.Content,{className:"".concat(ee().noScroll," ").concat(te().content),children:[(0,l.jsx)("div",{style:{display:m?"flex":"none"},className:te().loading,children:(0,l.jsx)(ev.Z,{indicator:(0,l.jsx)(j.Z,{style:{fontSize:80},spin:!0})})}),(0,l.jsx)("div",{ref:g,className:te().canvas})]})]})};let tm={part:"Unable to load part"},tp=async(e,t,n)=>{try{if("geometry"===n){let e=await W.getPart({id:t.id});return{...e,extra:{id:t.id}}}{let n=await eg.Z.load({id:e.id},{originPath:t.originPath,glb:t.glb});return{...n,extra:{glb:t.glb}}}}catch(e){throw(0,L.lt)(tm.part,e),e}},th=async(e,t,n)=>Promise.all(n.map(async n=>{let i=t.find(e=>{var t;return(null===(t=e.extra)||void 0===t?void 0:t.glb)===n.glb});if(i)return i;let l=await tp(e,n,"result");return l})),ty=async(e,t,n)=>{if(!n)return;let i=t.find(e=>{var t;return(null===(t=e.extra)||void 0===t?void 0:t.glb)===n.glb});if(i)return i;let l=await tp(e,n,"result");return l},tx=async(e,t,n)=>Promise.all(n.map(async n=>{let i=t.find(e=>{var t;return(null===(t=e.extra)||void 0===t?void 0:t.id)===n.id});if(i)return i;let l=await tp(e,n,"geometry");return l}));var tg=e=>{let{project:t,simulation:n,geometries:i,results:a,postprocessing:r}=e,[s,d]=(0,o.useState)([]),[c,u]=(0,o.useState)(!1);return(0,C.Z)(()=>{(async()=>{u(!0);try{let e=[];if(n&&!r){let t=await th(n,s,a);e.push(...t)}if(n){let t=await ty(n,s,r);t&&e.push(t)}if(!a.length&&!r){let t=await tx(n,s,i);e.push(...t)}d(e)}catch(e){}finally{u(!1)}})()},[n,i,a,r,s]),(0,l.jsx)(tu,{loading:c,project:{id:t.id,title:t.title},parts:s})},tw=n(28913),tb=n(39095),tf=n.n(tb);let tv=r()(()=>Promise.all([n.e(2210),n.e(8824),n.e(5731),n.e(4830)]).then(n.bind(n,4830)),{loadableGenerated:{webpack:()=>[4830]},ssr:!1}),tj={dashboard:{key:"dashboard"},geometries:{label:"GEOMETRIES",key:"geometries"},simulations:{label:"SIMULATIONS",key:"simulations"}},tP={user:"Unable to get user",project:"Unable to get project",simulations:"Unable to get simulations",geometries:"Unable to get geometries",add:"Unable to add simulation"},tZ=async(e,t,n)=>{try{var i;let l=await F.Z.add({id:e.id},{name:t.name,scheme:t});await n.addOneSimulation(l),await n.mutateProject({id:e.id,simulations:[...null!==(i=e.simulations)&&void 0!==i?i:[],l.id]})}catch(e){throw(0,L.lt)(tP.add,e),e}},tC=e=>{let{visible:t,geometry:n,panel:i,add:a,del:r,close:s}=e,d=(0,o.useCallback)(e=>{var t,l,a;e.stopPropagation(),(null==i?void 0:null===(t=i.props)||void 0===t?void 0:null===(l=t.children)||void 0===l?void 0:null===(a=l.type)||void 0===a?void 0:a.componentName)===ex.componentName&&s(),r(n)},[n,i,r,s]),c=(0,o.useCallback)(e=>{e.stopPropagation(),a(n)},[n,a]);return(0,l.jsxs)("div",{children:[n.name,t?(0,l.jsx)(h.Z,{onClick:d}):(0,l.jsx)(y.Z,{onClick:c})]})},tk=e=>{let{simulation:t}=e;return t.scheme.userModelId?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(d.Z,{title:"User algorithm",placement:"right",children:(0,l.jsx)(x.Z,{style:{position:"absolute",top:0,left:14,fontSize:14,color:"#fad114"}})}),t.name]}):(0,l.jsx)(l.Fragment,{children:t.name})};var tM=()=>{let e=(0,s.useRouter)(),{page:t,workspaceId:n,projectId:i}=e.query,[a,r]=(0,o.useState)(!1),[d,h]=(0,o.useState)([]),[y,x]=(0,o.useState)(!1),[M,E]=(0,o.useState)(),[S,A]=(0,o.useState)([]),[T,_]=(0,o.useState)(),[V,B]=(0,o.useState)(),[U,I]=(0,o.useState)(),[H,X]=(0,o.useState)(!0),[G,{errorUser:J,loadingUser:K}]=O.Z.useUser(),[q,{mutateProject:$,errorProject:Q,loadingProject:et}]=R.Z.useProject(i),[en,{addOneSimulation:ei,delOneSimulation:el,mutateOneSimulation:ea,errorSimulations:er,loadingSimulations:es}]=F.Z.useSimulations(null==q?void 0:q.simulations),[eo,{addOneGeometry:ed,delOneGeometry:ec,mutateOneGeometry:eu,errorGeometries:em,loadingGeometries:ep}]=W.useGeometries(null==q?void 0:q.geometries),eh=(0,o.useCallback)(()=>r(!0),[]),ey=(0,o.useCallback)(()=>x(!0),[]),eg=(0,o.useCallback)(()=>x(!1),[]),ew=(0,o.useCallback)(e=>{h(t=>[...t,e])},[]),eb=(0,o.useCallback)(e=>{let t=d.findIndex(t=>t.id===e.id);-1!==t&&h(e=>[...e.slice(0,t),...e.slice(t+1)])},[d]),ef=(0,o.useCallback)(()=>{I(void 0),B(void 0)},[]),ev=(0,o.useCallback)(e=>{let t=eo.findIndex(t=>t.id===e);-1!==t&&h(e=>[...e.slice(0,t),{id:"0",needCleanup:!0},...e.slice(t+1)])},[eo]),ej=(0,o.useCallback)(e=>{let t=eo.find(t=>t.id===e);if(!t)return;let n=d.find(t=>t.id===e);n||h(e=>[...e,{...t,visible:!0}]),I((0,l.jsx)(Y,{visible:!0,title:"Geometry",onClose:ef,children:(0,l.jsx)(ex,{project:{id:q.id,geometries:q.geometries},geometry:{id:t.id,name:t.name,summary:t.summary},swr:{mutateProject:$,mutateOneGeometry:eu,delOneGeometry:ec},close:ef,onCleanup:ev})}))},[q,eo,d,$,eu,ec,ev,ef]),eP=(0,o.useCallback)(e=>{I((0,l.jsx)(Y,{visible:!0,title:"About",onClose:ef,children:(0,l.jsx)(tw.ZP.About,{project:{id:q.id,simulations:q.simulations},simulation:{id:e.id,name:e.name,scheme:e.scheme},swr:{mutateProject:$,addOneSimulation:ei,delOneSimulation:el,mutateOneSimulation:ea}})}))},[q,$,ei,el,ea,ef]),eZ=(0,o.useCallback)(e=>{I((0,l.jsx)(Y,{visible:!0,title:"Geometry",onClose:ef,children:(0,l.jsx)(tw.ZP.Geometry,{loadedGeometries:eo,geometries:d.map(e=>({id:e.id,summary:e.summary})),simulation:{id:e.id,scheme:e.scheme},setGeometries:h,swr:{mutateOneSimulation:ea}})}))},[eo,d,ea,ef]),eC=(0,o.useCallback)(e=>{I((0,l.jsx)(Y,{visible:!0,title:"Parameters",onClose:ef,children:(0,l.jsx)(tw.ZP.Parameters,{simulation:{id:e.id,scheme:e.scheme},swr:{mutateOneSimulation:ea}})}))},[ea,ef]),ek=(0,o.useCallback)(e=>{I((0,l.jsx)(Y,{visible:H,title:"Materials",onClose:ef,children:(0,l.jsx)(tw.ZP.Materials,{geometries:d.map(e=>({id:e.id,name:e.name,summary:e.summary})),simulation:{id:e.id,scheme:e.scheme},swr:{mutateOneSimulation:ea},setVisible:X})}))},[d,H,ea,ef]),eM=(0,o.useCallback)(e=>{I((0,l.jsx)(Y,{visible:!0,title:"Initialization",onClose:ef,children:(0,l.jsx)(tw.ZP.Initialization,{simulations:en,simulation:e,swr:{mutateOneSimulation:ea}})}))},[en,ea,ef]),eE=(0,o.useCallback)(e=>{I((0,l.jsx)(Y,{visible:H,title:"Boundary conditions",onClose:ef,children:(0,l.jsx)(tw.ZP.BoundaryConditions,{geometries:d.map(e=>({id:e.id,name:e.name,summary:e.summary})),simulation:{id:e.id,scheme:e.scheme},swr:{mutateOneSimulation:ea},setVisible:X})}))},[d,H,ea,ef]),eS=(0,o.useCallback)(e=>{I((0,l.jsx)(Y,{visible:H,title:"Run",onClose:ef,children:(0,l.jsx)(tw.ZP.Run,{geometries:d,simulation:{id:e.id,scheme:e.scheme},results:S,setResults:A,setPostprocessing:_,setVisible:X,swr:{mutateOneSimulation:ea}})}))},[d,S,H,ea,ef]),eA=(0,o.useCallback)((e,t)=>{var n,i,l,a,r,s;let o=en.find(t=>t.id===e);if(!o)return;E(o);let d=null===(n=o.scheme)||void 0===n?void 0:null===(i=n.configuration)||void 0===i?void 0:null===(l=i.geometry)||void 0===l?void 0:l.value,c=null===(a=o.scheme)||void 0===a?void 0:null===(r=a.configuration)||void 0===r?void 0:null===(s=r.geometry)||void 0===s?void 0:s.values;if(d){let e=eo.find(e=>e.id===d);e&&h([e])}else if(c){let e=eo.filter(e=>c.includes(e.id));h(e)}switch(t){case"about":eP(o);break;case"geometry":eZ(o);break;case"parameters":eC(o);break;case"materials":ek(o);break;case"initialization":eM(o);break;case"boundaryConditions":eE(o);break;case"run":eS(o);break;default:I(void 0)}},[eo,en,eP,eZ,eC,ek,eM,eE,eS]),ez=(0,o.useCallback)(()=>{(async()=>{await e.push({pathname:"/dashboard",query:{page:t,workspaceId:n}})})()},[e,t,n]),eN=(0,o.useCallback)(e=>{let t,{keyPath:n}=e,i=n.pop(),l=n.pop(),a=n.pop();a&&(t=a.split("&").pop()),B({key:i,id:l,item:t})},[]),eL=(0,o.useCallback)(async e=>{try{await tZ(q,e.model,{addOneSimulation:ei,mutateProject:$}),x(!1)}catch(e){}},[q,ei,$]),eD=(0,o.useCallback)(e=>{if(ep)return!0;let t=e.value,n=e.values,i=e.multiple,l=e.n;return(!t||!!eo.filter(e=>e.id===t).length)&&(!i||!n||(l?eo.filter(e=>n.includes(e.id)).length===e.n:!!eo.filter(e=>n.includes(e.id)).length))&&(!!t||!!n)||(e.done=!1,!1)},[eo,ep]);(0,o.useEffect)(()=>{(async()=>{K||G||await e.replace("/login")})()},[G,K,e]),(0,o.useEffect)(()=>{J&&(0,L.lt)(tP.user,J),Q&&(0,L.lt)(tP.project,Q),er&&(0,L.lt)(tP.simulations,er),em&&(0,L.lt)(tP.geometries,em)},[J,Q,er,em]),(0,C.Z)(()=>{et||ep?r(!1):eo.length?r(!1):r(!0)},[et,ep,eo]),(0,C.Z)(()=>{if(!ep){if(d.length){let e=!1,t=d.map(t=>{let n=eo.find(e=>e.id===(null==t?void 0:t.id));return n?JSON.stringify({...n,visible:void 0})!==JSON.stringify({...t,visible:void 0})?(e=!0,n):t:(e=!0,null)}).filter(e=>e);e&&h(t)}else h(eo[0]?[eo[0]]:[])}},[ep,eo,d],[h]),(0,C.Z)(()=>{if(!es&&M){let e=en.find(e=>e.id===(null==M?void 0:M.id));e?JSON.stringify(e)!==JSON.stringify(M)&&(E(e),V&&V.key===tj.simulations.key&&eA(V.id,V.item)):(ef(),E(void 0))}},[en,es,M,V],[E,ef]),(0,C.Z)(()=>{V&&(V.key===tj.geometries.key?ej(V.id):(eA(V.id,V.item),"run"!==V.item&&(A([]),_(void 0))))},[V,H,S],[ej,eA,ef]),(0,o.useEffect)(()=>{!S.length&&T&&_(void 0)},[S,T]);let eO=(0,o.useMemo)(()=>eo.map(e=>{let t=d.find(t=>t.id===e.id);return{key:e.id,icon:(0,l.jsx)(g.Z,{}),label:(0,l.jsx)(tC,{visible:!!t,geometry:e,panel:U,add:ew,del:eb,close:ef})}}),[eo,d,U,ew,eb,ef]),eR=(0,o.useMemo)(()=>en.map(e=>{let t=e.scheme.configuration||{},n=[];return Object.keys(t).forEach(i=>{if("dimension"===i)return;let a=t[i],r=(0,l.jsx)(w.Z,{style:{color:"green"}});a.error?r=(0,l.jsx)(b.Z,{style:{color:"red"}}):a.done||(r=(0,l.jsx)(f.Z,{style:{color:"orange"}})),"geometry"!==i||eD(a)||(r=(0,l.jsx)(f.Z,{style:{color:"orange"}})),n[a.index]={key:e.id+"&"+i,disabled:!d.length,icon:r,label:a.title}}),{key:e.id,icon:(0,l.jsx)(v.Z,{}),label:(0,l.jsx)(tk,{simulation:e}),children:[{key:e.id+"&about",disabled:!d.length,icon:(0,l.jsx)(w.Z,{style:{color:"green"}}),label:"About"},...n]}}),[d,en,eD]);return!G||K||et?(0,l.jsx)(k.Z.Simple,{}):"0"===q.id?(0,l.jsx)(z,{}):(0,l.jsx)(D.ZP,{children:(0,l.jsxs)(c.Z,{hasSider:!0,children:[(0,l.jsxs)(c.Z.Sider,{theme:"light",className:tf().sider,width:256,children:[(0,l.jsx)("div",{className:ee().logo,children:(0,l.jsx)("img",{src:"/images/logo.svg",alt:"Tanatloc"})}),(0,l.jsx)(u.Z,{className:tf().menu1,mode:"inline",items:[{key:"menu-go-back",disabled:!0,style:{cursor:"unset",margin:"10px 0",paddingLeft:10},label:(0,l.jsx)(N.ks,{className:ee().fullWidth,onClick:ez,children:"Return to dashboard"})},{type:"divider"},{key:"title",disabled:!0,className:"Menu-title",label:(0,l.jsx)(m.Z.Paragraph,{ellipsis:{tooltip:!0,rows:2},children:q.title})}]}),(0,l.jsx)("div",{className:tf().menuScroll,children:(0,l.jsx)(u.Z,{mode:"inline",className:tf().menu2,defaultOpenKeys:[tj.geometries.key,tj.simulations.key],items:[{key:tj.geometries.key,className:"SubMenu",icon:ep?(0,l.jsx)(j.Z,{}):(0,l.jsx)(g.Z,{}),label:(0,l.jsxs)(m.Z.Text,{strong:!0,children:[tj.geometries.label," (",eo.length,")"]}),children:[{key:"new_geometry",disabled:!0,label:(0,l.jsx)(p.ZP,{icon:(0,l.jsx)(P.Z,{}),onClick:eh,children:"New Geometry"})},{key:"geometry-needed",disabled:!0,className:d.length?"display-none":"",icon:(0,l.jsx)(f.Z,{style:{color:"red"}}),label:"A Geometry is needed"},...eO]},{key:tj.simulations.key,className:"SubMenu",icon:es?(0,l.jsx)(j.Z,{}):(0,l.jsx)(v.Z,{}),label:(0,l.jsxs)(m.Z.Text,{strong:!0,children:[tj.simulations.label," (",en.length,")"]}),children:[{key:"new_simulation",disabled:!0,label:(0,l.jsx)(p.ZP,{disabled:!eo.length,icon:(0,l.jsx)(Z.Z,{}),onClick:ey,children:"New Simulation"})},...eR]}],onClick:eN})})]}),(0,l.jsxs)(c.Z.Content,{className:ee().noScroll,style:{position:"relative"},children:[(0,l.jsx)(ex.Add,{visible:a,project:{id:q.id,geometries:q.geometries},swr:{mutateProject:$,addOneGeometry:ed},setVisible:r}),(0,l.jsx)(tw.ZP.Selector,{user:{id:G.id,authorizedplugins:G.authorizedplugins,usermodels:G.usermodels},visible:y,onOk:eL,onCancel:eg}),(0,l.jsx)(tw.ZP.Updater,{user:{authorizedplugins:G.authorizedplugins},simulation:M&&{id:M.id,scheme:M.scheme},swr:{mutateOneSimulation:ea}}),U,(0,l.jsx)(tg,{project:{id:q.id,title:q.title},simulation:M&&{id:M.id},geometries:d.map(e=>({id:e.id,needCleanup:e.needCleanup})),results:S.map(e=>({glb:e.glb,originPath:e.originPath})),postprocessing:T&&{glb:T.glb,originPath:T.originPath}}),(0,l.jsx)(tv,{simulation:M&&{id:M.id,name:M.name}}),(0,l.jsx)(tw.ZP.Postprocessing,{simulation:M&&{id:M.id,scheme:M.scheme},results:S.map(e=>({name:e.name,fileName:e.fileName,originPath:e.originPath})),postprocessing:T&&{name:T.name,fileName:T.fileName},setResult:_})]})]})})}},87819:function(e){e.exports={upload:"add_upload__gI0Tw"}},39095:function(e){e.exports={variables:'"@/styles/variables.css"',colorPrimary:"#fad114",sider:"project_sider__iUhsS",menu1:"project_menu1__XdM_R",menuScroll:"project_menuScroll__78_Ce",menu2:"project_menu2__Txzic"}},60968:function(e){e.exports={variables:'"@/styles/variables.css"',colorPrimary:"#fad114",view:"three_view__MDbup",head:"three_head__fY_4c",content:"three_content__FaWcm",loading:"three_loading__B2ZAP",canvas:"three_canvas__LLX1q"}}}]);