(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[487],{72735:function(e,t,i){"use strict";i.d(t,{Z:function(){return a}});var n=i(83755);let l=async(e,t)=>{let i=await (0,n.R)("/api/avatar",{method:"POST",headers:{Accept:"application/json"},body:JSON.stringify({file:e,project:t})});return i.json()};var a={add:l}},77149:function(e,t,i){"use strict";i.d(t,{Z:function(){return x}});var n=i(59734),l=i(67294),a=i(83755);let r=e=>{var t;let{data:i,error:r,mutate:s}=(0,n.ZP)(["/api/projects",JSON.stringify({ids:e})],e=>{let[t,i]=e;return(0,a._)(t,i)}),o=null!==(t=null==i?void 0:i.projects)&&void 0!==t?t:[],d=(0,l.useCallback)(async e=>{let t=[...o,{...e,users:[],geometries:[],simulations:[],groups:[]}];await s({projects:t})},[o,s]),c=(0,l.useCallback)(async e=>{let t=o.filter(t=>t.id!==e.id);await s({projects:t})},[o,s]),u=(0,l.useCallback)(async e=>{let t=o.map(t=>(t.id===e.id&&(t={...t,...e}),t));await s({projects:t})},[o,s]);return[o,{addOneProject:d,delOneProject:c,mutateOneProject:u,errorProjects:r,loadingProjects:!i}]},s=e=>{var t;let{data:i,error:r,mutate:s}=(0,n.ZP)("/api/project"+(e?"/"+e:""),a._),o=null!==(t=null==i?void 0:i.project)&&void 0!==t?t:{id:"0"},d=(0,l.useCallback)(async e=>{let t={...o,...e};await s({project:t})},[o,s]);return[o,{mutateProject:d,errorProject:r,loadingProject:!i}]},o=async(e,t)=>{let i=await (0,a.R)("/api/project",{method:"POST",headers:{Accept:"application/json"},body:JSON.stringify({workspace:{id:e.id},project:t})});return i.json()},d=async(e,t)=>{await (0,a.R)("/api/project/"+e.id,{method:"PUT",body:JSON.stringify(t)})},c=async(e,t)=>{await (0,a.R)("/api/project/"+t.id,{method:"DELETE",body:JSON.stringify({id:e.id})})},u=async e=>(0,a.R)("/api/project/"+e.id+"/archive",{method:"GET",headers:{Accept:"application/json"}}),m=async e=>(0,a.R)("/api/project/"+e.id+"/archive",{method:"PUT"}),p=async e=>(0,a.R)("/api/project/"+e.id+"/archive",{method:"DELETE"}),h=async(e,t)=>(0,a.R)("/api/project/"+e.id+"/archive",{method:"POST",body:JSON.stringify({archive:t})}),y=async(e,t)=>{let i=await (0,a.R)("/api/project/"+t.id+"/copy",{method:"POST",headers:{Accept:"application/json"},body:JSON.stringify({workspace:{id:e.id}})});return i.json()};var x={useProjects:r,useProject:s,add:o,update:d,del:c,archive:u,unarchiveFromServer:m,deleteArchiveFile:p,unarchiveFromFile:h,copy:y}},80487:function(e,t,i){"use strict";let n;i.d(t,{ZP:function(){return tA}});var l=i(85893),a=i(5152),r=i.n(a),s=i(11163),o=i(67294),d=i(83062),c=i(97183),u=i(68508),m=i(22850),p=i(71577),h=i(99611),y=i(90420),x=i(73480),g=i(48869),w=i(8751),b=i(18429),f=i(11475),v=i(22844),j=i(50888),P=i(88484),Z=i(64789),C=i(36642),k=i(94725),M=i(85813),E=i(26713),S=i(20280);let A={notAllowed:"You are not allowed to be here."},N=()=>{let e=(0,s.useRouter)(),t=(0,o.useCallback)(()=>{(async()=>{await e.push("/")})()},[e]);return(0,l.jsx)(c.Z,{children:(0,l.jsx)(c.Z.Content,{children:(0,l.jsx)(M.Z,{title:"Not allowed",children:(0,l.jsxs)(E.Z,{direction:"vertical",children:[(0,l.jsxs)(m.Z.Text,{children:[(0,l.jsx)(S.Z,{style:{color:"red"}})," ",A.notAllowed]}),(0,l.jsxs)(m.Z.Text,{children:["Go back"," ",(0,l.jsx)(p.ZP,{type:"link",onClick:t,children:"home"})]})]})})})})};var z=i(51302),L=i(9242),D=i(48474),O=i(42661),R=i(77149),T=i(72616),F=i(59734),_=i(83755);let B=e=>{var t;let{data:i,error:n,mutate:l}=(0,F.ZP)(["/api/geometries",JSON.stringify({ids:e})],e=>{let[t,i]=e;return(0,_._)(t,i)}),a=null!==(t=null==i?void 0:i.geometries)&&void 0!==t?t:[],r=(0,o.useCallback)(async e=>{let t=[...a,e];await l({geometries:t})},[a,l]),s=(0,o.useCallback)(async e=>{let t=a.filter(t=>t.id!==e.id);await l({geometries:t})},[a,l]),d=(0,o.useCallback)(async e=>{let t=a.map(t=>(t.id===e.id&&(t={...t,...e}),t));await l({geometries:t})},[a,l]);return[a,{addOneGeometry:r,delOneGeometry:s,mutateOneGeometry:d,errorGeometries:n,loadingGeometries:!i}]},U=async(e,t)=>{let i=await (0,_.R)("/api/geometry",{method:"POST",body:JSON.stringify({project:e,geometry:t})});return i.json()},V=async(e,t)=>{await (0,_.R)("/api/geometry/"+e.id,{method:"PUT",body:JSON.stringify(t)})},I=async e=>{await (0,_.R)("/api/geometry/"+e.id,{method:"DELETE"})},H=async e=>{let t=await (0,_.R)("/api/geometry/"+e.id+"/download");return t.json()},W=async e=>{let t=await (0,_.R)("/api/geometry/"+e.id+"/part");return t.json()};var X={useGeometries:B,add:U,update:V,del:I,download:H,getPart:W},G=i(97937),J=i(68847),Y=i.n(J);let K=e=>{let{visible:t,title:i,children:n,onClose:a}=e;return(0,l.jsx)(M.Z,{className:Y().panel,style:{display:t?"block":"none"},title:i,extra:(0,l.jsx)(p.ZP,{type:"text",icon:(0,l.jsx)(G.Z,{}),onClick:a}),children:n})};var q=i(62585),$=i(31365),Q=i(86373),ee=i(14856),et=i.n(ee),ei=i(87819),en=i.n(ei),el=i(48764).lW;let ea={add:"Unable to add geometry"},er=e=>e.name.toLowerCase().includes(".stp")||e.name.toLowerCase().includes(".step")||e.name.toLowerCase().includes(".dxf"),es=async e=>{let t=new FileReader;return new Promise(i=>{t.addEventListener("load",()=>{i(t.result)}),t.readAsArrayBuffer(e)})},eo=async(e,t,i)=>{if("uploading"===t.file.status)return!0;if("done"===t.file.status){let n=await es(t.file.originFileObj);try{let l=await X.add({id:e.id},{name:t.file.name,uid:t.file.uid,buffer:el.from(n)});await i.addOneGeometry(l),await i.mutateProject({id:e.id,geometries:[...e.geometries,l.id]})}catch(e){throw(0,L.lt)(ea.add,e),e}}return!1},ed=e=>{let{visible:t,project:i,swr:n,setVisible:a}=e,[r,s]=(0,o.useState)(!1),d=(0,o.useCallback)(()=>a(!1),[a]),c=(0,o.useCallback)(e=>{(async()=>{try{let t=await eo(i,e,n);s(t),a(t)}catch(e){s(!1)}})()},[i,n,a]);return(0,l.jsx)(Q.ZP,{title:"Upload geometry",visible:t,onCancel:d,cancelButtonProps:{loading:r},children:(0,l.jsxs)(E.Z,{direction:"vertical",className:et().fullWidth,children:[(0,l.jsx)($.Z,{className:en().upload,action:"/api/noop",accept:".stp,.step,.dxf",showUploadList:!1,listType:"picture-card",beforeUpload:er,onChange:c,children:(0,l.jsx)("div",{children:r?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(j.Z,{style:{fontSize:25}}),(0,l.jsxs)("div",{style:{marginTop:8},children:[(0,l.jsx)("b",{children:"Loading"}),", converting, ..."]})]}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(P.Z,{style:{fontSize:25}}),(0,l.jsxs)("div",{style:{marginTop:8},children:[(0,l.jsx)("b",{children:"Choose a file"})," or drop it here"]})]})})}),(0,l.jsx)(m.Z.Text,{children:(0,l.jsx)("p",{style:{color:"rgba(0, 0, 0, 0.45)",textAlign:"center"},children:"Native file format preferred: STEP (3D) or DXF (2D) file"})})]})})};var ec=i(638),eu=i(69677);let em=e=>{let{visible:t,geometry:i,setVisible:n,onEdit:a}=e,r=(0,o.useRef)(null),[s,d]=(0,o.useState)(!1);(0,o.useEffect)(()=>{r.current&&r.current.focus()});let c=(0,o.useCallback)(()=>n(!1),[n]),u=(0,o.useCallback)(async e=>{d(!0);try{await a(e),d(!1),n(!1)}catch(e){throw d(!1),e}},[n,a]);return(0,l.jsx)(Q.ZP,{title:"Edit the geometry's name",visible:t,initialValues:{name:i.name},onCancel:c,onOk:u,loading:s,children:(0,l.jsx)(ec.Z.Item,{name:"name",label:"Name:",rules:[{required:!0,message:"Name is required"}],children:(0,l.jsx)(eu.Z,{ref:r})})})};var ep=i(48764).lW;let eh={download:"Unable to download geometry",update:"Unable to update geometry",del:"Unable to delete geometry"},ey=async e=>{try{let t=await X.download({id:e.id}),i=new File([ep.from(t.buffer).toString()],e.name+"."+t.extension),n=window.URL.createObjectURL(i),l=document.createElement("a");l.href=n,l.setAttribute("download",e.name+"."+t.extension),l.click(),l.remove()}catch(e){(0,L.lt)(eh.download,e)}},ex=async(e,t,i)=>{try{await X.update({id:e.id},[{key:"name",value:t.name}]),e.name=t.name,await i.mutateOneGeometry(e)}catch(e){throw(0,L.lt)(eh.update,e),e}},eg=async(e,t,i,n)=>{try{await X.del({id:e.id});let l=t.geometries.filter(t=>t!==e.id);await n.mutateProject({id:t.id,geometries:l}),await n.delOneGeometry(e),i()}catch(e){throw(0,L.lt)(eh.del,e),e}},ew=e=>{var t,i,n,a,r,s;let{project:d,geometry:u,swr:p,close:h,onCleanup:y}=e,[x,g]=(0,o.useState)(!1),[w,b]=(0,o.useState)(!1),[f,v]=(0,o.useState)(!1),j=(0,o.useCallback)(()=>b(!0),[]),P=(0,o.useCallback)(()=>{(async()=>{g(!0);try{await ey(u)}catch(e){}finally{g(!1)}})()},[u]),Z=(0,o.useCallback)(async e=>ex(u,e,p),[u,p]),C=(0,o.useCallback)(async()=>{v(!0);try{await eg(u,d,h,p),y(u.id)}finally{v(!1)}},[d,u,p,h,y]);return u?(0,l.jsx)(c.Z,{children:(0,l.jsx)(c.Z.Content,{children:(0,l.jsx)(M.Z,{size:"small",title:"Informations",actions:[(0,l.jsx)(z.o6,{loading:x,onDownload:P},"download"),(0,l.jsxs)("div",{children:[(0,l.jsx)(em,{visible:w,geometry:{id:null==u?void 0:u.id,name:null==u?void 0:u.name},setVisible:b,onEdit:Z}),(0,l.jsx)(z.w6,{onEdit:j})]},"edit"),(0,l.jsx)(z.m1,{loading:f,text:(0,l.jsxs)(l.Fragment,{children:["Are you sure you want to delete the geometry"," ",(0,l.jsx)(m.Z.Text,{strong:!0,children:u.name}),"?"]}),onDelete:C},"delete")],children:(0,l.jsxs)(E.Z,{direction:"vertical",className:et().fullWidth,children:[(0,l.jsxs)(m.Z.Text,{children:[(0,l.jsx)("span",{className:et().textLight,children:"File:"})," ",u.name," "]}),(0,l.jsxs)(m.Z.Text,{children:[(0,l.jsx)("span",{className:et().textLight,children:"Unit:"})," ",(0,l.jsx)(q.Z.Inline,{text:"m"})]}),(0,l.jsxs)(l.Fragment,{children:[3===u.summary.dimension&&(0,l.jsxs)(m.Z.Text,{children:[(0,l.jsx)("span",{className:et().textLight,children:"Number of solids:"})," ",null!==(a=null===(t=u.summary.solids)||void 0===t?void 0:t.length)&&void 0!==a?a:0]}),(0,l.jsxs)(m.Z.Text,{children:[(0,l.jsx)("span",{className:et().textLight,children:"Number of faces:"})," ",null!==(r=null===(i=u.summary.faces)||void 0===i?void 0:i.length)&&void 0!==r?r:0]}),2===u.summary.dimension&&(0,l.jsxs)(m.Z.Text,{children:[(0,l.jsx)("span",{className:et().textLight,children:"Number of edges:"})," ",null!==(s=null===(n=u.summary.edges)||void 0===n?void 0:n.length)&&void 0!==s?s:0]})]})]})})})}):(0,l.jsx)(k.Z.Simple,{})};ew.componentName="Geometry",ew.Add=ed;var eb=i(10739),ef=i(83159),ev=i(96074),ej=i(72269),eP=i(57953),eZ=i(41428),eC=i(38095),ek=i(86350),eM=i(15668),eE=i(35598),eS=i(74317),eA=i(49591),eN=i(19478),ez=i(87784),eL=i(75843),eD=i(15611),eO=i(69980),eR=i(62992),eT=i(53073),eF=i(99477),e_=i(57632),eB=i(79753),eU=i(54327);let eV=e=>{let t=new eF.fHI(.025,.025,.8,50);t.translate(0,.4,0);let i=new eF.vBJ({color:e}),n=new eF.Kj0(t,i),l=new eF.b_z(.05,.2,50);l.translate(0,.9,0);let a=new eF.vBJ({color:e}),r=new eF.Kj0(l,a),s=new eF.ZAu;s.type="ArrowHelper",s.add(n),s.add(r);let o=()=>{t.dispose(),i.dispose(),l.dispose(),a.dispose()};return s.dispose=o,s},eI=(e,t,i)=>{var n,l;let a=document.createElement("canvas");a.width=null!==(n=null==i?void 0:i.width)&&void 0!==n?n:256,a.height=256;let r=a.getContext("2d");(null==i?void 0:i.background)&&(r.fillStyle=i.background,r.fillRect(0,0,a.width,a.height)),r.fillStyle="grey",r.font="50px sans-serif",r.textAlign=null!==(l=null==i?void 0:i.align)&&void 0!==l?l:"center",r.textBaseline="middle",r.fillText(t,a.width/2,a.height/2);let s=new eF.xEZ(a);s.flipY=!0,s.needsUpdate=!0;let o=new eF.xeV({map:s,transparent:!0,depthWrite:!1});o.map.anisotropy=e.capabilities.getMaxAnisotropy();let d=new eF.jyi(o);d.type="LabelHelper",(null==i?void 0:i.position)&&d.position.copy(i.position),(null==i?void 0:i.scale)&&d.scale.setScalar(i.scale);let c=()=>{s.dispose(),o.dispose()};return d.dispose=c,d},eH=function(e,t){let{offsetWidth:i,offsetHeight:n,width:l,height:a}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{offsetWidth:0,offsetHeight:0,width:150,height:150},r=i,s=n,o=l,d=a,c=eV("red");c.rotateZ(-Math.PI/2);let u=eI(e,"X",{position:new eF.Pa4(1.1,0,0)}),m=eV("green"),p=eI(e,"Y",{position:new eF.Pa4(0,1.1,0)}),h=eV("blue");h.rotateX(Math.PI/2);let y=eI(e,"Z",{position:new eF.Pa4(0,0,1.1)}),x=new eF.xo$(.05,50,50),g=new eF.vBJ({color:"black"}),w=new eF.Kj0(x,g),b=new eF.ZAu;b.type="AxisHelper",b.add(c),b.add(u),b.add(m),b.add(p),b.add(h),b.add(y),b.add(w);let f=new eF.xsS;f.add(b);let v=new eF.iKG(-1.2,1.2,1.2,-1.2,-2,2),j=e=>{let{newOffsetWidth:t,newOffsetHeight:i,newWidth:n,newHeight:l}=e;r=t,s=i,o=n,d=l},P=()=>{e.setViewport(r,s,o,d),v.rotation.copy(t.rotation),e.render(f,v)},Z=()=>{x.dispose(),g.dispose(),b.children.forEach(e=>{("ArrowHelper"===e.type||"LabelHelper"===e.type)&&e.dispose()}),f.remove(b)};return{dispose:Z,render:P,resize:j}},eW=(e,t,i,n,l,a)=>{let{smooth:r,radius:s,left:o,down:d}=l,{xc:c,yc:u,uc:m,vc:p}=a;for(let l=0;l<=r;l++){let a=Math.PI/2*(e+l/r),h=Math.cos(a),y=Math.sin(a);if(t.push(c+s*h,u+s*y,0),i.push(m+o*h,p+d*y),l<r){let t=(r+1)*e+l+4;n.push(e,t,t+1)}}},eX=(e,t,i,n)=>{let l=e/2-i,a=t/2-i,r=i/e,s=(e-i)/e,o=i/t,d=(t-i)/t,c=[l,a,0,-l,a,0,-l,-a,0,l,-a,0],u=[s,d,r,d,r,o,s,o],m=[3*(n+1)+3,3*(n+1)+4,n+4,n+5,2*(n+1)+4,2,1,2*(n+1)+3,3,4*(n+1)+3,4,0],p=[m[0],m[1],m[2],m[0],m[2],m[3],m[4],m[5],m[6],m[4],m[6],m[7],m[8],m[9],m[10],m[8],m[10],m[11]];for(let e=0;e<4;e++){let t=e<1||e>2?l:-l,m=e<2?a:-a,h=e<1||e>2?s:r,y=e<2?d:o;eW(e,c,u,p,{smooth:n,radius:i,left:r,down:o},{xc:t,yc:m,uc:h,vc:y})}let h=new eF.u9r;return h.setIndex(new eF.lCJ(p,1)),h.setAttribute("position",new eF.a$l(c,3)),h.setAttribute("uv",new eF.a$l(u,2)),h},eG=function(e,t,i,n){let{offsetWidth:l,offsetHeight:a,width:r,height:s}=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{offsetWidth:0,offsetHeight:0,width:150,height:150},o="#d3d3d3",d=null,c=null,u=[{text:"FRONT",normal:new eF.Pa4(0,0,1),up:new eF.Pa4(0,1,0)},{text:"BACK",normal:new eF.Pa4(0,0,-1),up:new eF.Pa4(0,1,0)},{text:"RIGHT",normal:new eF.Pa4(1,0,0),up:new eF.Pa4(0,1,0)},{text:"LEFT",normal:new eF.Pa4(-1,0,0),up:new eF.Pa4(0,1,0)},{text:"UP",normal:new eF.Pa4(0,1,0),up:new eF.Pa4(0,0,-1)},{text:"DOWN",normal:new eF.Pa4(0,-1,0),up:new eF.Pa4(0,0,1)}],m=eX(75,75,25,20),p=new eF.xo$(37.5,10,10,0,Math.PI,0),h=new eF.ZAu;u.forEach(e=>{let t=document.createElement("canvas"),i=t.getContext("2d");t.width=t.height=256,i.fillStyle=o,i.fillRect(0,0,t.width,t.height),i.font="bold 50pt sans-serif",i.fillStyle="#000000",i.textAlign="center",i.textBaseline="middle",i.fillText(e.text,t.width/2,t.height/2);let n=new eF.ROQ(t);n.needsUpdate=!0;let l=new eF.vBJ({map:n,transparent:!0,opacity:.75}),a=new eF.vBJ({color:o}),r=new eF.Kj0(m,l),s=new eF.Kj0(m,a);s.rotateY(Math.PI);let d=new eF.vBJ({color:o,transparent:!0,opacity:.2}),c=new eF.Kj0(p,d),u=new eF.ZAu;u.add(r,s,c),u.lookAt(e.normal),u.translateZ(50),u.normal=e.normal,u.up=e.up,h.add(u)});let y=new eF.Mig("#ffffff",1),x=new eF.xsS;x.add(h),x.add(y);let g=new eF.iKG(-100,100,100,-100,-100,100);g.position.z=2;let w=new eF.iMs,b=e=>{let t=f(e);v(t)?(d=j(t),P(),(null==d?void 0:d.uuid)!==(null==c?void 0:c.uuid)&&(Z(),c=d)):(d=null,Z())},f=e=>{let t=e.target,i=t.getBoundingClientRect(),n=e.clientX-i.left,o=e.clientY-i.top,d=new eF.FM8;return d.x=(n-l)/r*2-1,d.y=-(2*((o+s-i.height+a)/s))+1,d},v=e=>e.x>-1&&e.x<1&&e.y>-1&&e.y<1,j=e=>{let t=new eF.Pa4(e.x,e.y,-1);t.unproject(g);let i=new eF.Pa4;g.getWorldDirection(i),w.set(t,i);let n=w.intersectObjects(x.children,!0);return n.length?n[0].object.parent:null},P=()=>{var e;null==d||null===(e=d.children)||void 0===e||e.forEach(e=>{var t;let i=e;(null===(t=i.material)||void 0===t?void 0:t.color)&&(i.material.previousColor=i.material.color,i.material.color=new eF.Ilk("#FAD114"))})},Z=()=>{var e;null==c||null===(e=c.children)||void 0===e||e.forEach(e=>{var t;let i=e;(null===(t=i.material)||void 0===t?void 0:t.color)&&(i.material.color=new eF.Ilk(o))})},C=e=>{if(d){var l;let a=d.normal,r=d.up,s=new eF.Pa4;null===(l=t.boundingBox)||void 0===l||l.getCenter(s);let o=i.position.distanceTo(n.target),c=a.clone().multiplyScalar(o),u=s.add(c);i.position.copy(u),i.up.copy(r),d=null,Z(),b(e)}};e.domElement.addEventListener("pointermove",b),e.domElement.addEventListener("pointerdown",C);let k=e=>{let{newOffsetWidth:t,newOffsetHeight:i,newWidth:n,newHeight:o}=e;l=t,a=i,r=n,s=o},M=()=>{e.setViewport(l,a,r,s),g.rotation.copy(i.rotation),e.render(x,g)},E=()=>{e.domElement.removeEventListener("pointermove",b),e.domElement.removeEventListener("pointerdown",C),h.children.forEach(e=>{e.children.forEach(e=>{e.geometry.dispose(),e.material.dispose()})}),x.remove(h)};return{resize:k,render:M,dispose:E}},eJ=e=>1e-12>Math.abs(e)?"0":Math.abs(e)>1e3||.001>Math.abs(e)?e.toExponential(2):e.toFixed(3),eY=(e,t,i,n)=>{let l,a,r;let s=e=>{let t=Math.max(e.x,e.y,e.z),i=Math.max(Math.ceil(e.x/t*5),2),n=Math.max(Math.ceil(e.y/t*5),2),l=Math.max(Math.ceil(e.z/t*5),2);return new eF.Pa4(i,n,l)},o=(e,t,i,n,l)=>{let a=new eF.ZAu,r=new eF.nls({color:8947848}),s=new eF.Pa4(-e/2,0,-t/2),o=e/(i-1),d=t/(n-1);for(let t=0;t<n;++t){let i=new eF.u9r().setFromPoints([new eF.Pa4(s.x,0,s.z+t*d),new eF.Pa4(s.x+e,0,s.z+t*d)]);a.add(new eF.x12(i,r))}for(let e=0;e<i;++e){let i=new eF.u9r().setFromPoints([new eF.Pa4(s.x+e*o,0,s.z),new eF.Pa4(s.x+e*o,0,s.z+t)]);a.add(new eF.x12(i,r))}return null==l||l(a),a},d=(t,i,n,l)=>{let a=new eF.ZAu,r=Math.abs(i-t),s=r/(l-1),o=new eF.Pa4().copy(n).multiplyScalar(-r/2),d=new eF.Pa4().copy(n).multiplyScalar(s),c=t;for(let t=0;t<l;++t){let t=eI(e,eJ(c));t.position.copy(o),a.add(t),o.add(d),c+=s}return a},c=()=>{let e=t.boundingBox,i=t.boundingSphere.center,n=new eF.Pa4(e.max.x-e.min.x,e.max.y-e.min.y,e.max.z-e.min.z),r=s(n);a=1*(l=.1*Math.max(n.x,n.y,n.z));let c=new eF.ZAu,u=o(n.x,n.z,r.x,r.z),m=o(n.x,n.y,r.x,r.y,e=>{e.rotateX(Math.PI/2)}),p=o(n.y,n.z,r.y,r.z,e=>{e.rotateZ(-Math.PI/2)});c.add(u,m,p);let h=d(e.min.x,e.max.x,new eF.Pa4(1,0,0),r.x),x=d(e.min.y,e.max.y,new eF.Pa4(0,1,0),r.y),g=d(e.min.z,e.max.z,new eF.Pa4(0,0,1),r.z);return c.add(h,x,g),c.position.set(i.x,i.y,i.z),c.type="GridHelper",c.dispose=y,c},u=e=>e<=0?-1:1,m=e=>.5>=Math.abs(e)?1:-1,p=()=>{let e=t.boundingBox,s=new eF.Pa4(e.max.x-e.min.x,e.max.y-e.min.y,e.max.z-e.min.z),o=!1;t.children.forEach(e=>{"GridHelper"===e.type&&(o=e.visible,t.remove(e),e.dispose())}),r=c();let d=n.object.position.distanceTo(n.target);r.traverse(e=>{"LabelHelper"===e.type&&e.scale.setScalar(.05*d)});let p=new eF.Pa4;i.getWorldDirection(p);let h=d/10/(n.minDistance+.001),y=r.children[0],x=r.children[1],g=r.children[2];y.position.set(0,u(p.y)*(s.y/2+l),0),x.position.set(0,0,u(p.z)*(s.z/2+l)),g.position.set(u(p.x)*(s.x/2+l),0,0);let w=r.children[3],b=r.children[4],f=r.children[5];w.position.set(0,u(p.y)*m(p.y)*(s.y/2+a),-(u(p.z)*m(p.y)*(s.z/2+a))),b.position.set(u(p.x)*m(p.x)*(s.x/2+a),0,-(u(p.z)*m(p.x)*(s.z/2+a))),f.position.set(u(p.x)*m(p.x)*(s.x/2+a),-(u(p.y)*m(p.x)*(s.y/2+a)),0);let v=.2*h,j=.3*h;w.visible=Math.abs(p.y)>v||Math.abs(p.z)>j,b.visible=Math.abs(p.x)>j||Math.abs(p.z)>j,f.visible=Math.abs(p.x)>j||Math.abs(p.y)>v,r.visible=o,t.add(r)},h=e=>{r.visible=e},y=()=>{null==r||r.children.forEach(e=>{e.children.forEach(e=>{if("Line"===e.type){let t=e.geometry;t.dispose();let i=e.material;i.dispose()}else e.dispose()})})};return{dispose:y,setVisible:h,update:p}},eK=(e,t,i,n)=>{let l=document.createElement("div");l.style.pointerEvents="none",l.style.border="1px solid #55aaff",l.style.backgroundColor="rgba(75, 160, 255, 0.3)",l.style.position="fixed";let a=new eF.FM8,r=new eF.FM8,s=new eF.FM8,o=new eF.FM8,d=!1,c=!1,u=new eF.iMs,m=()=>{d=!0},p=()=>{d=!1},h=e=>{d&&0===e.button&&(c=!0,g(e))},y=e=>{d&&c&&w(e)},x=e=>{c=!1,d&&b(e)};e.domElement.addEventListener("pointerdown",h),e.domElement.addEventListener("pointermove",y),e.domElement.addEventListener("pointerup",x);let g=t=>{n.enabled=!1,e.domElement.parentElement.appendChild(l),l.style.left=t.clientX+"px",l.style.top=t.clientY+"px",l.style.width="0px",l.style.height="0px",a.x=t.clientX,a.y=t.clientY},w=e=>{o.x=Math.max(a.x,e.clientX),o.y=Math.max(a.y,e.clientY),s.x=Math.min(a.x,e.clientX),s.y=Math.min(a.y,e.clientY),l.style.left=s.x+"px",l.style.top=s.y+"px",l.style.width=o.x-s.x+"px",l.style.height=o.y-s.y+"px"},b=e=>{n.enabled=!0,l.parentElement&&l.parentElement.removeChild(l),r.x=e.clientX,r.y=e.clientY;let t=new eF.TUj(a,r);f(t),p()},f=l=>{let a=new eF.FM8(Math.abs(l.max.x-l.min.x),Math.abs(l.max.y-l.min.y));if(a.x<5||a.y<5)return;let r=new eF.FM8((l.max.x+l.min.x)/2,(l.max.y+l.min.y)/2),s=e.domElement.getBoundingClientRect(),o=r.x-s.left,d=r.y-s.top,c=new eF.FM8(o/s.width*2-1,-(2*(d/s.height))+1),m=t.children.find(e=>"Part"===e.type);if(!m)return;u.setFromCamera(c,i);let p=u.intersectObject(m);if(!p.length)return;n.target.copy(p[0].point);let h=new eF.FM8(a.x/s.width,a.y/s.height),y=Math.max(h.x,h.y),x=i.position.distanceTo(n.target),g=n.target.clone().sub(i.position).normalize().multiplyScalar(x*(1-y));i.position.add(g)},v=()=>{e.domElement.removeEventListener("pointerdown",h),e.domElement.removeEventListener("pointermove",y),e.domElement.removeEventListener("pointerup",x)};return{dispose:v,end:p,isEnabled:()=>d,start:m}},eq=(e,t,i,n)=>{let l,a,r;let s=new eF.Ilk("#fad114"),o=new eF.Ilk("#E98A15"),d=new eF.Pa4(-1,0,0),c=new eF.JOQ(d),u={up:new eF.Pa4,forward:new eF.Pa4,right:new eF.Pa4},m=new eF.Pa4,p=new eF.Pa4,h=new eF.USm,y=new eF.Pa4,x=new eF.FM8,g=new eF.JOQ,w=new eF.Pa4,b=new eF.Pa4,f=new eF.Zzh,v={up:new eF.Pa4,forward:new eF.Pa4,right:new eF.Pa4},j=new eF.iMs,P=new eF.ZAu;P.type="SectionViewHelper",P.visible=!1,t.add(P),(()=>{let e=new eF._12(1,1),t=new eF.vBJ({color:s,side:eF.ehD,transparent:!0,opacity:.5}),i=new eF.Kj0(e,t);i.type="Plane",P.add(i)})(),(()=>{let e=new eF.xo$(.2,32,32,Math.PI,-Math.PI),t=new eF.vBJ({color:s,side:eF.ehD,transparent:!0,opacity:.5}),i=new eF.Kj0(e,t);i.type="Dome",P.add(i)})(),(()=>{class e extends eF.Hyl{getPoint(e){return new eF.Pa4().set(this.radius*Math.cos(Math.PI*e),this.radius*Math.sin(Math.PI*e),0)}constructor(e){super(),this.radius=e}}let t=new e(.2);{let e=new eF.WXh(t,32,.020000000000000004,32),i=new eF.vBJ({color:s,side:eF.ehD,transparent:!0,opacity:.5}),n=new eF.Kj0(e,i);n.rotateX(Math.PI/2),n.type="ArcX",P.add(n)}{let e=new eF.WXh(t,32,.020000000000000004,32),i=new eF.vBJ({color:s,side:eF.ehD,transparent:!0,opacity:.5}),n=new eF.Kj0(e,i);n.rotateX(Math.PI/2),n.rotateY(Math.PI/2),n.type="ArcY",P.add(n)}})();let Z=()=>{let e=new eF.Pa4;t.boundingBox.getSize(e),e.multiplyScalar(1.2);let i=Math.max(Math.max(e.x,e.y),e.z);P.scale.setScalar(i)},C=()=>{let e=new eF.Pa4;t.boundingBox.getCenter(e),P.position.copy(e)},k=()=>{let e=P.visible;P.visible=!e},M=()=>{e.localClippingEnabled=!0,P.visible=!0,Z(),C();let t=new eF.Pa4().copy(P.position).sub(d);P.lookAt(t),c.setFromNormalAndCoplanarPoint(d,P.position)},E=()=>{e.localClippingEnabled=!1,P.visible=!1},S=e=>{if(C(),d.equals(e)){A();return}let t=new eF.Pa4().copy(P.position).sub(e);P.lookAt(t),c.setFromNormalAndCoplanarPoint(e,P.position),d.copy(e)},A=()=>{P.rotateX(Math.PI);let e=c.normal.multiplyScalar(-1);c.setFromNormalAndCoplanarPoint(e,P.position)},N=()=>{P.traverse(e=>{("Plane"===e.type||"Dome"===e.type||"ArcX"===e.type||"ArcY"===e.type)&&(e.geometry.dispose(),e.material.dispose())}),e.domElement.removeEventListener("pointermove",F),e.domElement.removeEventListener("pointerdown",X),e.domElement.removeEventListener("pointerup",G)},z=e=>{let t=e.target,i=t.getBoundingClientRect(),n=e.clientX-i.left,l=e.clientY-i.top,a=new eF.FM8;return a.x=n/i.width*2-1,a.y=-(2*(l/i.height))+1,a},L=e=>{l&&l.material.color.set(s),l=e,e&&e.material.color.set(o)},D=()=>{n.enabled=!0},O=()=>{n.enabled=!1},R=()=>{i.getWorldDirection(u.forward),u.forward.normalize(),u.up.copy(i.up).normalize(),u.right.crossVectors(u.up,u.forward).normalize()},T=()=>{let e=new eF.Pa4(0,0,1).applyQuaternion(P.quaternion).multiplyScalar(-1);c.setFromNormalAndCoplanarPoint(e,P.position)},F=e=>{if(!P.visible)return;let t=z(e);if(j.setFromCamera(t,i),a){let e=new eF.Pa4;j.ray.intersectPlane(g,e),(null==r?void 0:r.type)==="Plane"?B(e):(null==r?void 0:r.type)==="Dome"?V(t):H(e),T()}else{let e=j.intersectObject(P);e.length?(O(),L(r=e[0].object),p.copy(e[0].point),R()):(r=null,L(),D())}},_=()=>{g.setFromNormalAndCoplanarPoint(u.forward,p),m.copy(P.position);let e=new eF.Pa4;j.ray.intersectPlane(g,e),w.copy(e).sub(m),b.copy(w).normalize(),f.set(m,new eF.Pa4().copy(m).add(c.normal))},B=e=>{e.sub(w);let t=new eF.Pa4;f.closestPointToPoint(e,!1,t),P.position.copy(t)},U=e=>{h.copy(P.rotation),x.copy(e)},V=e=>{P.rotation.copy(h),P.rotateOnWorldAxis(u.up,-(5*(x.x-e.x))),P.rotateOnWorldAxis(u.right,-(5*(x.y-e.y)))},I=()=>{r.getWorldDirection(y),h.copy(P.rotation),w.copy(p).sub(P.position),b.copy(w).normalize(),v.up.copy(b),v.right.copy(y),v.forward.crossVectors(v.right,v.up),f.set(p,new eF.Pa4().copy(p).add(v.forward)),g.setFromNormalAndCoplanarPoint(u.forward,p)},H=e=>{let t=n.object.position.distanceTo(n.target),i=new eF.Pa4;f.closestPointToPoint(e,!1,i);let l=p.distanceTo(i);i.sub(p);let a=new eF.Pa4().copy(b).cross(i).normalize(),r=Math.sign(y.dot(a));P.rotation.copy(h),P.rotateOnWorldAxis(y,r*l*1/(t/100))},W=e=>{switch(null==r?void 0:r.type){case"Plane":_();break;case"Dome":U(e);break;case"ArcX":case"ArcY":I()}},X=e=>{if(P.visible&&r){a=!0;let t=z(e);W(t)}},G=()=>{P.visible&&(a=!1,L())};return e.domElement.addEventListener("pointermove",F),e.domElement.addEventListener("pointerdown",X),e.domElement.addEventListener("pointerup",G),{getClippingPlane:()=>c,toggleVisible:k,start:M,stop:E,toAxis:S,flip:A,dispose:N}};var e$=i(54104);let eQ=e=>{let t=new e$.A("rainbow",512);t.setMin(Number.MAX_VALUE),t.setMax(-Number.MAX_VALUE);let i=new eF.xsS,n=new eF.iKG(-1,1,1,-1,2,1);n.position.set(0,0,1);let l=new eF.ZAu;i.add(l);let a=!1,r=e=>{i.children.forEach(t=>{t.children.forEach(t=>t.visible=e)})},s=()=>{i.children.forEach(e=>{e.children.forEach(t=>{"LabelHelper"===t.type&&t.dispose(),"Sprite"===t.type&&t.dispose(),e.remove(t)})})},o=e=>{if(!a){let i=t.minV,n=t.maxV;t.setMin(Math.min(i,e.minV)),t.setMax(Math.max(n,e.maxV))}let i=new eF.ROQ(t.createCanvas()),n=new eF.xeV({map:i,depthWrite:!1}),r=new eF.jyi(n);r.material.rotation=-Math.PI/2,r.scale.x=.2,r.scale.y=1.2,r.renderOrder=1,r.dispose=r.material.dispose,l.add(r),d(t)},d=t=>{let i=eJ(t.minV),n=eJ(t.maxV),a=eI(e,String(i),{background:"white",position:new eF.Pa4(-.62,0,0),width:512,align:"right"});a.scale.x=.4,a.scale.y=2.8,a.renderOrder=0;let r=eI(e,String(n),{background:"white",position:new eF.Pa4(.62,0,0),width:512,align:"left"});r.scale.x=.4,r.scale.y=2.8,r.renderOrder=0,l.add(a),l.add(r)},c=e=>{t.setColorMap(e,512)},u=(e,i)=>{a=!0,t.setMin(e),t.setMax(i)},m=()=>{a=!1,t.setMin(Number.MAX_VALUE),t.setMax(-Number.MAX_VALUE)},p=e=>t.getColor(e),h=()=>{let t=e.domElement.getBoundingClientRect();e.setViewport(t.width/2-350,t.height-50,700,50),e.render(i,n)},y=()=>{a||(t.setMin(Number.MAX_VALUE),t.setMax(-Number.MAX_VALUE)),s()};return{render:h,addLUT:o,getMinV:()=>t.minV,getMaxV:()=>t.maxV,getColor:p,setVisible:r,setColorMap:c,setRange:u,setAutomaticRange:m,dispose:y}},e0=e=>{let t=new eF.ZAu;t.type="PointHelper",t.visible=!1,e.add(t);let i=()=>{var t,i;let n=(null!==(i=null===(t=e.boundingSphere)||void 0===t?void 0:t.radius)&&void 0!==i?i:1)/100,l=new eF.xo$(n),a=new eF.Wid({color:16711680});return new eF.Kj0(l,a)},n=(e,t)=>{let i=new eF.u9r().setFromPoints([e,t]),n=new eF.nls({color:16711680});return new eF.x12(i,n)},l=()=>{let t=[],i=e.boundingBox.max.x-e.boundingBox.min.x,l=e.boundingBox.max.y-e.boundingBox.min.y,a=e.boundingBox.max.z-e.boundingBox.min.z,r=Math.max(i,l,a),s=n(new eF.Pa4(-r/2,0,0),new eF.Pa4(r/2,0,0));t.push(s);let o=n(new eF.Pa4(0,-r/2,0),new eF.Pa4(0,r/2,0));t.push(o);let d=n(new eF.Pa4(0,0,-r/2),new eF.Pa4(0,0,r/2));return t.push(d),t},a=()=>{s();let e=i(),n=l();t.add(e),t.add(...n)},r=e=>{e?(t.position.set(e.x,e.y,e.z),t.visible=!0):t.visible=!1},s=()=>{t.children.forEach(e=>{t.remove(e),e.geometry.dispose(),e.material.dispose()})};return{build:a,dispose:s,update:r}};var e1=i(77836),e2=i(82854),e4=i(6648),e5=i(48764).lW;let e8=(e,t)=>{e.traverse(e=>{if("Mesh"===e.type){let i=e,n=new eF.Uk6(i.geometry),l=new eF.nls({color:i.material.color,linewidth:1}),a=new eF.ejS(n,l);i.add(a),i.material.visible=!1,i.material.clippingPlanes=[t]}})},e3=(e,t)=>{e.traverse(e=>{if("Mesh"===e.type||"Line"===e.type){let i=e,n=i.geometry.getAttribute("data");if(n){let e=n.array.reduce((e,t)=>Math.min(e,t),n.array[0]),t=n.array.reduce((e,t)=>Math.max(e,t),n.array[0]);e===t&&(e-=1,t+=1);let l=new e$.A;l.setMin(e),l.setMax(t),i.userData={...i.userData,lut:l}}if("Mesh"===e.type){let e=new eF.Uk6(i.geometry),t=new eF.nls({linewidth:1}),n=new eF.ejS(e,t);i.add(n)}i.material.vertexColors=!0,i.material.clippingPlanes=[t]}})},e7=(e,t)=>{e.traverse(e=>{if("Mesh"===e.type){let i=e;i.material.clippingPlanes=[t],i.material.originalColor=i.material.color}})},e6=(e,t)=>{let i=new eF.Ilk("#FAD114"),n=new eF.Ilk("#EE9817"),l=async(e,t,i,n)=>{let l=new Blob([e5.from(e.buffer)]),d=URL.createObjectURL(l),c=new e1.E,u=new e2._;u.setDecoderPath("/three/libs/draco/"),c.setDRACOLoader(u);let m=new e4.a;m.setTranscoderPath("node_modules/three//examples/js/libs/basis/"),c.setKTX2Loader(m);let p=await new Promise((e,t)=>{c.load(d,t=>{e(t)},()=>void 0,e=>t(e))}),w=p.scene,b=new eF.Tme;return b.type="Part",b.uuid=e.summary.uuid,b.children=w.children,b.userData=w.userData,"mesh"===e.summary.type?e8(b,n):"result"===e.summary.type?e3(b,n):("geometry3D"===e.summary.type||"geometry2D"===e.summary.type)&&e7(b,n),s(b,t),o(b,i),b.boundingBox=a(b),b.dispose=()=>r(b),b.setTransparent=e=>s(b,e),b.setDisplayMesh=e=>o(b,e),b.startSelection=(e,t,i)=>x(b,e,t,i),b.stopSelection=()=>g(),b.getHighlighted=()=>h,b.getSelected=()=>y,b.highlight=C,b.unhighlight=k,b.select=E,b.unselect=S,b},a=e=>{let t=new eF.ZzF;return e.traverse(e=>{t.expandByObject(e)}),t},r=e=>{e.traverse(e=>{"Mesh"===e.type&&(e.geometry.dispose(),e.material.dispose())})},s=(e,t)=>{e.traverse(e=>{if("Mesh"===e.type){let i=e;i.material.transparent=t,i.material.opacity=t?.5:1,i.material.depthWrite=!t}})},o=(e,t)=>{"result"===e.userData.type&&e.traverse(e=>{e.traverse(e=>{if("LineSegments"===e.type){let i=e;i.visible=t}})})},d=new eF.iMs,c=null,u=null,m=null,p=null,h=null,y=[],x=(e,t,i,n)=>{c=e,u=n,m=t,p=i,h=null,y.length=0,m.domElement.addEventListener("pointermove",Z),m.domElement.addEventListener("pointerdown",M)},g=()=>{null==m||m.domElement.removeEventListener("pointermove",Z),null==m||m.domElement.removeEventListener("pointerdown",M),k(),h=null,y.forEach(e=>{S(e.uuid)}),y.length=0,u=null,c=null,m=null,p=null},w=(e,t)=>{let i;if(e&&t)return e.traverse(e=>{e.userData.uuid===t&&(i=e)}),i},b=e=>{let t=e.target,i=t.getBoundingClientRect(),n=e.clientX-i.left,l=e.clientY-i.top,a=new eF.FM8;return a.x=n/i.width*2-1,a.y=-(2*(l/i.height))+1,a},f=()=>{let t=d.intersectObject(c,!0);if(t.length){let i=t[0].object,n=i.parent;n&&e(c,n.userData.uuid,n.userData.label)}else e(c)},v=()=>{let t;let i=c.userData;if(2===i.dimension){if((t=d.intersectObject(c,!0)).length){let i=t[0].object,n=i.parent;(null==n?void 0:n.type)==="Mesh"?e(c,n.userData.uuid,n.userData.label):e(c,i.userData.uuid,i.userData.label)}else e(c)}else if((t=d.intersectObject(c,!0)).length){let i=t[0].object;e(c,i.userData.uuid,i.userData.label)}else e(c)},j=()=>{let t;let i=c.userData,n=i.edges;if((t=d.intersectObject(c,!0)).length){let i=t[0].object,l=null==n?void 0:n.find(e=>e.uuid===i.userData.uuid);l?e(c,i.userData.uuid,i.userData.label):e(c)}else e(c)},P=()=>{let t=d.intersectObject(c,!0);if(t.length){let i=t[0];e(c,void 0,void 0,i.point)}else e(c)},Z=e=>{let t=b(e);switch(d.setFromCamera(t,p),u){case"solids":f();break;case"faces":v();break;case"edges":j();break;case"point":P()}},C=e=>{if(e===(null==h?void 0:h.uuid))return;k();let t=w(c,e);if(t){if(h={uuid:t.userData.uuid,label:t.userData.label},"Mesh"===t.type){let e=t;e.material.color=i}else t.traverse(e=>{if("Mesh"===e.type){let t=e;t.material.color=i}})}},k=()=>{let e=w(c,null==h?void 0:h.uuid);if(h=null,!e)return;let t=y.findIndex(t=>t.uuid===e.userData.uuid);if("Mesh"===e.type){let i=e;i.material.color=-1===t?i.material.originalColor:n}else e.traverse(e=>{if("Mesh"===e.type){let i=e;i.material.color=-1===t?i.material.originalColor:n}})},M=()=>{h&&t(c,h.uuid,h.label)},E=e=>{let t=w(c,e);if(t){if(y.push({uuid:e,label:t.userData.label}),"Mesh"===t.type){let e=t;e.material.color=n}else t.traverse(e=>{if("Mesh"===e.type){let t=e;t.material.color=n}})}},S=e=>{let t=w(c,e),i=y.findIndex(t=>t.uuid===e);if(-1!==i&&(y=[...y.slice(0,i),...y.slice(i+1)]),t){if("Mesh"===t.type){let e=t;e.material.color=e.material.originalColor}else t.traverse(e=>{if("Mesh"===e.type){let t=e;t.material.color=t.material.originalColor}})}};return{load:l}};var e9=i(40782),te=i(72735),tt=i(60968),ti=i.n(tt);let tn={load:"Error while loading part",snapshot:"Error while taking snapshot",saveScreenshot:"Unable to save screenshot"},tl=!1,ta=e=>{let t=new eF.ZzF;e.children.forEach(e=>{if(e.visible&&"Part"===e.type){let i=e.boundingBox,n=new eF.Pa4(Math.min(t.min.x,i.min.x),Math.min(t.min.y,i.min.y),Math.min(t.min.z,i.min.z)),l=new eF.Pa4(Math.max(t.max.x,i.max.x),Math.max(t.max.y,i.max.y),Math.max(t.max.z,i.max.z));t.set(n,l)}});let i=new eF.aLr;t.getBoundingSphere(i),e.boundingBox=t,e.boundingSphere=i},tr=(e,t,i)=>{let n=t.object.position.distanceTo(t.target),l=t.target.clone().sub(e.position).normalize().multiplyScalar(n*i*.01);e.position.add(l)},ts=(e,t,i)=>{let n=e.children.find(e=>"Part"===e.type);if(!n)return;tl=!0;let l=e.boundingSphere,a=l.center,r=2*l.radius,s=r/(2*Math.atan(Math.PI*t.fov/360)),o=s/t.aspect,d=1.1*Math.max(s,o),c=i.target.clone().sub(t.position).normalize().multiplyScalar(d);i.target.copy(a),i.minDistance=d/10,i.maxDistance=10*d,t.position.copy(a).sub(c),t.near=d/100,t.far=100*d,t.updateProjectionMatrix()},to=async(e,t,i,n,l,a,r)=>{let s=(e,t,i,n)=>{t?(e.highlight(t),setTimeout(()=>r((0,e9.CH)({uuid:t,label:i})),1)):n?r((0,e9.N7)({x:n.x,y:n.y,z:n.z})):(e.unhighlight(),setTimeout(()=>r((0,e9.HW)()),1))},o=(e,t,i)=>{let n=e.getSelected();n.find(e=>e.uuid===t)?(e.unselect(t),setTimeout(()=>r((0,e9.hF)({uuid:t,label:i})),1)):(e.select(t),setTimeout(()=>r((0,e9.Ys)({uuid:t,label:i})),1))},d=e6(s,o),c=await d.load(e,l.transparent,l.displayMesh,a.sectionViewHelper.getClippingPlane());t.add(c),ta(t),tl||ts(t,i,n),a.gridHelper.update(),a.gridHelper.update(),a.gridHelper.setVisible(!0),a.pointHelper.build()},td=(e,t)=>{for(let i of(t.dispose(),t.setVisible(!1),e.children))"Part"===i.type&&"result"===i.userData.type&&i.traverse(e=>{("Mesh"===e.type||"Line"===e.type)&&(t.addLUT(e.userData.lut),t.setVisible(!0))})},tc=(e,t)=>{for(let i of(td(e,t),e.children))"Part"===i.type&&"result"===i.userData.type&&i.traverse(e=>{if("Mesh"===e.type||"Line"===e.type){let i=e.geometry.getAttribute("data"),n=new Float32Array(3*i.count);for(let e=0;e<i.count;e++){let l=t.getColor(i.array[e]);n[3*e+0]=l.r,n[3*e+1]=l.g,n[3*e+2]=l.b}e.geometry.setAttribute("color",new eF.a$l(n,3))}})},tu=async(e,t,i,n)=>{try{let l=n.domElement.width,a=n.domElement.height,r=i.aspect;n.domElement.width=520,n.domElement.height=312,i.aspect=520/312,i.updateProjectionMatrix(),n.clear(),n.setViewport(0,0,520,312),n.render(t,i);let s=n.domElement.toDataURL();n.domElement.width=l,n.domElement.height=a,i.aspect=r,i.updateProjectionMatrix(),await te.Z.add({name:"snapshot",uid:"snapshot_"+(0,e_.Z)(),data:s},{id:e.id})}catch(e){(0,L.lt)(tn.snapshot,e)}},tm=(e,t,i,n)=>{try{let l=n.domElement.width,a=n.domElement.height;n.clear(),n.setViewport(0,0,l,a),n.render(t,i);let r=n.domElement.toDataURL(),s=document.createElement("a");s.href=r.replace("image/png","image/octet-stream"),s.download=e.title+"_"+new Date().toLocaleDateString()+".png",s.click()}catch(e){(0,L.lt)(tn.saveScreenshot,e)}},tp=e=>{var t,i,a,r,u;let{loading:m,project:h,parts:x}=e,g=(0,o.useRef)(null),w=(0,o.useRef)(),b=(0,o.useRef)(),f=(0,o.useRef)(),v=(0,o.useRef)(),P=(0,o.useRef)(),Z=(0,o.useRef)(),k=(0,o.useRef)(),M=(0,o.useRef)(),E=(0,o.useRef)(),[S,A]=(0,o.useState)(!1),[N,z]=(0,o.useState)(!0),[O,R]=(0,o.useState)(!1),[T,F]=(0,o.useState)(!1),[_,B]=(0,o.useState)(!1),[U,V]=(0,o.useState)(!1),I=(0,s.useRouter)(),{enabled:H,part:W,highlighted:X,selected:G,point:J,type:Y,dispatch:K}=(0,o.useContext)(D.ZB);(0,o.useEffect)(()=>{var e;if(!eU.Z.isWebGLAvailable()){(async()=>{await I.push("/webgl")})();return}let t=g.current,i=t.clientWidth,n=t.clientHeight;w.current=new eF.xsS,w.current.boundingBox=new eF.ZzF,w.current.boundingSphere=new eF.aLr,b.current=new eF.cPb(50,i/n,.1,1e3),b.current.position.z=10;let l=new eF.Mig("#aaa",.75);w.current.add(l);let a=new eF.cek("#fff",.5);a.decay=2,b.current.add(a),w.current.add(b.current),f.current=new eF.CP7({antialias:!0,alpha:!0}),f.current.setClearColor("#ffffff"),f.current.setSize(i,n),f.current.setPixelRatio(null!==(e=window.devicePixelRatio)&&void 0!==e?e:1),f.current.shadowMap.enabled=!0,f.current.autoClear=!1,t.appendChild(f.current.domElement),v.current=new eB.$(b.current,t),v.current.rotateSpeed=3,v.current.panSpeed=.1;let r=eH(f.current,b.current,{offsetWidth:i-155,offsetHeight:n-155,width:150,height:150}),s=eG(f.current,w.current,b.current,v.current,{offsetWidth:i-155,offsetHeight:n-155,width:150,height:150});P.current=eY(f.current,w.current,b.current,v.current),Z.current=eK(f.current,w.current,b.current,v.current),k.current=eq(f.current,w.current,b.current,v.current),M.current=eQ(f.current),M.current.setVisible(!1),E.current=e0(w.current);let o=()=>{v.current.update(),f.current.setViewport(0,0,i,n),f.current.render(w.current,b.current),P.current.update(),r.render(),s.render(),M.current.render()},d=()=>{i=t.clientWidth,n=t.clientHeight,b.current.aspect=i/n,b.current.updateProjectionMatrix(),f.current.setSize(i,n),r.resize({newOffsetWidth:i-155,newOffsetHeight:n-155,newWidth:150,newHeight:150}),s.resize({newOffsetWidth:i-155,newOffsetHeight:n-155,newWidth:150,newHeight:150}),o()},c=()=>{o(),setTimeout(()=>requestAnimationFrame(c),1e3/30)};return window.addEventListener("resize",d),requestAnimationFrame(c),()=>{tl=!1,window.removeEventListener("resize",d),t.removeChild(f.current.domElement),w.current.children.forEach(e=>{w.current.remove(e)}),r.dispose(),s.dispose(),P.current.dispose(),k.current.dispose(),Z.current.dispose(),M.current.dispose(),E.current.dispose()}},[I]),(0,C.Z)(()=>{if(!w.current)return;let e=w.current.children;if(!x.length){var t;ta(w.current),P.current.update(),null===(t=E.current)||void 0===t||t.build()}let i=x.filter(t=>!e.find(e=>e.uuid===t.summary.uuid)),n=e.filter(e=>!x.find(t=>t.summary.uuid===e.uuid)).filter(e=>"Part"===e.type);n.forEach(e=>{var t;null===(t=w.current)||void 0===t||t.remove(e),e.dispose()}),(async()=>{await Promise.all(i.map(async e=>{try{await to(e,w.current,b.current,v.current,{transparent:S,displayMesh:N},{gridHelper:P.current,sectionViewHelper:k.current,pointHelper:E.current},K)}catch(e){(0,L.lt)(tn.load,e),ta(w.current)}})),tc(w.current,M.current)})()},[x,S,N,K]),(0,C.Z)(()=>{var e;if(w.current){if((null===(e=x[0])||void 0===e?void 0:e.summary.dimension)===2){ta(w.current);let e=new eF.Pa4(0,0,1),t=new eF.Pa4(0,1,0),i=new eF.Pa4;w.current.boundingBox.getCenter(i);let n=b.current.position.distanceTo(v.current.target),l=e.clone().multiplyScalar(n),a=i.add(l);b.current.position.copy(a),b.current.up.copy(t),v.current.noRotate=!0}else v.current.noRotate=!1}},[x]),(0,o.useEffect)(()=>{w.current&&w.current.children.forEach(e=>{"Part"===e.type&&e.userData.uuid===W&&(H?e.startSelection(f.current,b.current,Y):e.stopSelection())})},[H,W,Y]),(0,o.useEffect)(()=>{w.current&&w.current.children.forEach(e=>{if("Part"===e.type&&e.uuid===W){e.highlight(null==X?void 0:X.uuid);let t=e.getSelected(),i=G.filter(e=>!t.find(t=>t.uuid===e.uuid));i.forEach(t=>{t.uuid&&e.select(t.uuid)});let n=t.filter(e=>!G.find(t=>t.uuid===e.uuid));n.forEach(t=>{e.unselect(t.uuid)})}})},[W,X,G]),(0,o.useEffect)(()=>{var e;w.current&&(null===(e=E.current)||void 0===e||e.update(J?new eF.Pa4(J.x,J.y,J.z):void 0))},[J]);let q=(0,o.useCallback)(e=>{A(e),w.current.children.forEach(t=>{"Part"===t.type&&t.setTransparent(e)})},[]),$=(0,o.useCallback)(e=>{z(e),w.current.children.forEach(t=>{"Part"===t.type&&t.setDisplayMesh(e)})},[]),ee=(0,o.useCallback)(()=>{let e=!O;R(e),e?k.current.start():k.current.stop()},[O]),ei=(0,o.useCallback)(()=>{(async()=>{F(!0);try{await tu(h,w.current,b.current,f.current)}finally{F(!1)}})()},[h]),en=(0,o.useCallback)(()=>{B(!0);try{tm(h,w.current,b.current,f.current)}finally{B(!1)}},[h]),el=(0,o.useCallback)(e=>{var t;null===(t=P.current)||void 0===t||t.setVisible(e)},[]),ea=(0,o.useCallback)(()=>{tr(b.current,v.current,1);let e=()=>ea();n=requestAnimationFrame(e)},[]),er=(0,o.useCallback)(()=>{tr(b.current,v.current,-1);let e=()=>er();n=requestAnimationFrame(e)},[]),es=(0,o.useCallback)(()=>{n&&cancelAnimationFrame(n),n=void 0},[]),eo=(0,o.useCallback)(()=>{ts(w.current,b.current,v.current)},[]),ed=(0,o.useCallback)(()=>{k.current.toAxis(new eF.Pa4(-1,0,0))},[]),em=(0,o.useCallback)(()=>{k.current.toAxis(new eF.Pa4(0,-1,0))},[]),ep=(0,o.useCallback)(()=>{k.current.toAxis(new eF.Pa4(0,0,-1))},[]),eh=(0,o.useCallback)(e=>{var t;null===(t=M.current)||void 0===t||t.setColorMap(e.key),tc(w.current,M.current)},[]),ey=(0,o.useCallback)(()=>{V(!0)},[]),ex=(0,o.useCallback)(()=>{V(!1)},[]),eg=(0,o.useCallback)(async e=>{var t;null===(t=M.current)||void 0===t||t.setRange(+e.min,+e.max),tc(w.current,M.current),ex()},[ex]),ew=(0,o.useCallback)(()=>{var e;null===(e=M.current)||void 0===e||e.setAutomaticRange(),tc(w.current,M.current)},[]);return(0,l.jsxs)(c.Z,{className:"".concat(et().noScroll," ").concat(ti().view),children:[(0,l.jsxs)(Q.ZP,{visible:U,title:"Custom range",initialValues:{min:null===(t=M.current)||void 0===t?void 0:t.getMinV(),max:null===(i=M.current)||void 0===i?void 0:i.getMaxV()},onCancel:ex,onOk:eg,children:[(0,l.jsx)(ec.Z.Item,{label:"Min",name:"min",children:(0,l.jsx)(eu.Z,{})}),(0,l.jsx)(ec.Z.Item,{label:"Max",name:"max",children:(0,l.jsx)(eu.Z,{})})]}),(0,l.jsxs)(c.Z.Header,{className:ti().head,children:[(0,l.jsx)(d.Z,{title:"Take snapshot",placement:"left",children:(0,l.jsx)(ef.Z,{placement:"bottom",menu:{items:[{key:"project",label:(0,l.jsx)(p.ZP,{type:"text",className:"".concat(et().fullWidth," ").concat(et().noBackground),loading:T,onClick:ei,children:"Project snapshot"})},{key:"image",label:(0,l.jsx)(p.ZP,{type:"text",className:"".concat(et().fullWidth," ").concat(et().noBackground),loading:_,onClick:en,children:"Export image"})}]},children:(0,l.jsx)(p.ZP,{icon:(0,l.jsx)(eZ.Z,{})})})}),(0,l.jsx)(ev.Z,{style:{margin:0}}),(0,l.jsx)(d.Z,{title:"Display grid",placement:"left",children:(0,l.jsx)(ej.Z,{defaultChecked:!0,checkedChildren:(0,l.jsx)(eC.Z,{}),unCheckedChildren:(0,l.jsx)(eC.Z,{}),onChange:el})}),(0,l.jsx)(d.Z,{title:"Set transparency",placement:"left",children:(0,l.jsx)(ej.Z,{checked:S,checkedChildren:(0,l.jsx)(ek.Z,{}),unCheckedChildren:(0,l.jsx)(ek.Z,{}),onChange:q})}),(0,l.jsx)(ev.Z,{style:{margin:0}}),(0,l.jsx)(d.Z,{title:"Zoom out",placement:"left",children:(0,l.jsx)(p.ZP,{icon:(0,l.jsx)(eM.Z,{}),onMouseDown:er,onMouseUp:es,onMouseOut:es})}),(0,l.jsx)(d.Z,{title:"Zoom in",placement:"left",children:(0,l.jsx)(p.ZP,{icon:(0,l.jsx)(eE.Z,{}),onMouseDown:ea,onMouseUp:es,onMouseOut:es})}),(0,l.jsx)(d.Z,{title:"Zoom to fit",placement:"left",children:(0,l.jsx)(p.ZP,{icon:(0,l.jsx)(eS.Z,{}),onClick:eo})}),(0,l.jsx)(d.Z,{title:"Zoom to selection",placement:"left",children:(0,l.jsx)(p.ZP,{icon:(0,l.jsx)(eA.Z,{}),onClick:(null===(a=Z.current)||void 0===a?void 0:a.isEnabled())?null===(r=Z.current)||void 0===r?void 0:r.end:null===(u=Z.current)||void 0===u?void 0:u.start})}),(0,l.jsx)(ev.Z,{style:{margin:0}}),!O&&(0,l.jsx)(d.Z,{title:"Section view",placement:"left",children:(0,l.jsx)(p.ZP,{icon:(0,l.jsx)(eN.Z,{}),onClick:ee})}),O&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(d.Z,{title:"Stop",placement:"left",children:(0,l.jsx)(p.ZP,{icon:(0,l.jsx)(ez.Z,{}),onClick:ee})}),(0,l.jsx)(d.Z,{title:"Hide plane",placement:"left",children:(0,l.jsx)(p.ZP,{icon:(0,l.jsx)(y.Z,{}),onClick:k.current.toggleVisible})}),(0,l.jsx)(d.Z,{title:"Snap to X",placement:"left",children:(0,l.jsx)(p.ZP,{className:"ant-btn-icon-only",onClick:ed,children:"X"})}),(0,l.jsx)(d.Z,{title:"Snap to Y",placement:"left",children:(0,l.jsx)(p.ZP,{className:"ant-btn-icon-only",onClick:em,children:"Y"})}),(0,l.jsx)(d.Z,{title:"Snap to Z",placement:"left",children:(0,l.jsx)(p.ZP,{className:"ant-btn-icon-only",onClick:ep,children:"Z"})}),(0,l.jsx)(d.Z,{title:"Flip",placement:"left",children:(0,l.jsx)(p.ZP,{onClick:k.current.flip,icon:(0,l.jsx)(eL.Z,{})})})]}),x.filter(e=>"result"===e.summary.type).length?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(ev.Z,{className:"no-margin"}),(0,l.jsx)(d.Z,{title:"Display result mesh",placement:"left",children:(0,l.jsx)(ej.Z,{checked:N,checkedChildren:(0,l.jsx)(eD.Z,{}),unCheckedChildren:(0,l.jsx)(eD.Z,{}),onChange:$})}),(0,l.jsx)(d.Z,{title:"Colormap",placement:"left",children:(0,l.jsx)(ef.Z,{placement:"bottom",menu:{items:[{key:"rainbow",label:"Rainbow"},{key:"cooltowarm",label:"Cool to warm"},{key:"blackbody",label:"Black body"},{key:"grayscale",label:"Gray scale"}],onClick:eh},children:(0,l.jsx)(p.ZP,{icon:(0,l.jsx)(eO.Z,{})})})}),(0,l.jsx)(d.Z,{title:"Custom range",placement:"left",children:(0,l.jsx)(p.ZP,{icon:(0,l.jsx)(eR.Z,{}),onClick:ey})}),(0,l.jsx)(d.Z,{title:"Automatic range",placement:"left",children:(0,l.jsx)(p.ZP,{icon:(0,l.jsx)(eT.Z,{}),onClick:ew})})]}):null]}),(0,l.jsxs)(c.Z.Content,{className:"".concat(et().noScroll," ").concat(ti().content),children:[(0,l.jsx)("div",{style:{display:m?"flex":"none"},className:ti().loading,children:(0,l.jsx)(eP.Z,{indicator:(0,l.jsx)(j.Z,{style:{fontSize:80},spin:!0})})}),(0,l.jsx)("div",{ref:g,className:ti().canvas})]})]})},th={part:"Unable to load part"},ty=async(e,t,i)=>{try{if("geometry"===i){let e=await X.getPart({id:t.id});return{...e,extra:{id:t.id}}}{let i=await eb.Z.load({id:e.id},{originPath:t.originPath,glb:t.glb});return{...i,extra:{glb:t.glb}}}}catch(e){throw(0,L.lt)(th.part,e),e}},tx=async(e,t,i)=>Promise.all(i.map(async i=>{let n=t.find(e=>{var t;return(null===(t=e.extra)||void 0===t?void 0:t.glb)===i.glb});if(n)return n;let l=await ty(e,i,"result");return l})),tg=async(e,t,i)=>{if(!i)return;let n=t.find(e=>{var t;return(null===(t=e.extra)||void 0===t?void 0:t.glb)===i.glb});if(n)return n;let l=await ty(e,i,"result");return l},tw=async(e,t,i)=>Promise.all(i.map(async i=>{let n=t.find(e=>{var t;return(null===(t=e.extra)||void 0===t?void 0:t.id)===i.id});if(n)return n;let l=await ty(e,i,"geometry");return l})),tb=e=>{let{project:t,simulation:i,geometries:n,results:a,postprocessing:r}=e,[s,d]=(0,o.useState)([]),[c,u]=(0,o.useState)(!1);return(0,C.Z)(()=>{(async()=>{u(!0);try{let e=[];if(i&&!r){let t=await tx(i,s,a);e.push(...t)}if(i){let t=await tg(i,s,r);t&&e.push(t)}if(!a.length&&!r){let t=await tw(i,s,n);e.push(...t)}d(e)}catch(e){}finally{u(!1)}})()},[i,n,a,r,s]),(0,l.jsx)(tp,{loading:c,project:{id:t.id,title:t.title},parts:s})};var tf=i(28913),tv=i(39095),tj=i.n(tv);let tP=r()(()=>Promise.all([i.e(7521),i.e(5731),i.e(4830)]).then(i.bind(i,4830)),{loadableGenerated:{webpack:()=>[4830]},ssr:!1}),tZ={dashboard:{key:"dashboard"},geometries:{label:"GEOMETRIES",key:"geometries"},simulations:{label:"SIMULATIONS",key:"simulations"}},tC={user:"Unable to get user",project:"Unable to get project",simulations:"Unable to get simulations",geometries:"Unable to get geometries",add:"Unable to add simulation"},tk=async(e,t,i)=>{try{var n;let l=await T.Z.add({id:e.id},{name:t.name,scheme:t});await i.addOneSimulation(l),await i.mutateProject({id:e.id,simulations:[...null!==(n=e.simulations)&&void 0!==n?n:[],l.id]})}catch(e){throw(0,L.lt)(tC.add,e),e}},tM=e=>{let{visible:t,geometry:i,panel:n,add:a,del:r,close:s}=e,d=(0,o.useCallback)(e=>{var t,l,a;e.stopPropagation(),(null==n?void 0:null===(t=n.props)||void 0===t?void 0:null===(l=t.children)||void 0===l?void 0:null===(a=l.type)||void 0===a?void 0:a.componentName)===ew.componentName&&s(),r(i)},[i,n,r,s]),c=(0,o.useCallback)(e=>{e.stopPropagation(),a(i)},[i,a]);return(0,l.jsxs)("div",{children:[i.name,t?(0,l.jsx)(h.Z,{onClick:d}):(0,l.jsx)(y.Z,{onClick:c})]})},tE=e=>{let{simulation:t}=e;return t.scheme.user?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(d.Z,{title:"User algorithm",placement:"right",children:(0,l.jsx)(x.Z,{style:{position:"absolute",top:0,left:14,fontSize:14,color:"#fad114"}})}),t.name]}):(0,l.jsx)(l.Fragment,{children:t.name})},tS=()=>{let e=(0,s.useRouter)(),{page:t,workspaceId:i,projectId:n}=e.query,[a,r]=(0,o.useState)(!1),[d,h]=(0,o.useState)([]),[y,x]=(0,o.useState)(!1),[M,E]=(0,o.useState)(),[S,A]=(0,o.useState)([]),[F,_]=(0,o.useState)(),[B,U]=(0,o.useState)(),[V,I]=(0,o.useState)(),[H,W]=(0,o.useState)(!0),[G,{errorUser:J,loadingUser:Y}]=O.Z.useUser(),[q,{mutateProject:$,errorProject:Q,loadingProject:ee}]=R.Z.useProject(n),[ei,{addOneSimulation:en,delOneSimulation:el,mutateOneSimulation:ea,errorSimulations:er,loadingSimulations:es}]=T.Z.useSimulations(null==q?void 0:q.simulations),[eo,{addOneGeometry:ed,delOneGeometry:ec,mutateOneGeometry:eu,errorGeometries:em,loadingGeometries:ep}]=X.useGeometries(null==q?void 0:q.geometries),eh=(0,o.useCallback)(()=>r(!0),[]),ey=(0,o.useCallback)(()=>x(!0),[]),ex=(0,o.useCallback)(()=>x(!1),[]),eg=(0,o.useCallback)(e=>{h(t=>[...t,e])},[]),eb=(0,o.useCallback)(e=>{let t=d.findIndex(t=>t.id===e.id);-1!==t&&h(e=>[...e.slice(0,t),...e.slice(t+1)])},[d]),ef=(0,o.useCallback)(()=>{I(void 0),U(void 0)},[]),ev=(0,o.useCallback)(e=>{let t=eo.findIndex(t=>t.id===e);-1!==t&&h(e=>[...e.slice(0,t),{id:"0",needCleanup:!0},...e.slice(t+1)])},[eo]),ej=(0,o.useCallback)(e=>{let t=eo.find(t=>t.id===e);if(!t)return;let i=d.find(t=>t.id===e);i||h(e=>[...e,{...t,visible:!0}]),I((0,l.jsx)(K,{visible:!0,title:"Geometry",onClose:ef,children:(0,l.jsx)(ew,{project:{id:q.id,geometries:q.geometries},geometry:{id:t.id,name:t.name,summary:t.summary},swr:{mutateProject:$,mutateOneGeometry:eu,delOneGeometry:ec},close:ef,onCleanup:ev})}))},[q,eo,d,$,eu,ec,ev,ef]),eP=(0,o.useCallback)(e=>{I((0,l.jsx)(K,{visible:!0,title:"About",onClose:ef,children:(0,l.jsx)(tf.ZP.About,{project:{id:q.id,simulations:q.simulations},simulation:{id:e.id,name:e.name,scheme:e.scheme},swr:{mutateProject:$,addOneSimulation:en,delOneSimulation:el,mutateOneSimulation:ea}})}))},[q,$,en,el,ea,ef]),eZ=(0,o.useCallback)(e=>{I((0,l.jsx)(K,{visible:!0,title:"Geometry",onClose:ef,children:(0,l.jsx)(tf.ZP.Geometry,{loadedGeometries:eo,geometries:d.map(e=>({id:e.id,summary:e.summary})),simulation:{id:e.id,scheme:e.scheme},setGeometries:h,swr:{mutateOneSimulation:ea}})}))},[eo,d,ea,ef]),eC=(0,o.useCallback)(e=>{I((0,l.jsx)(K,{visible:!0,title:"Parameters",onClose:ef,children:(0,l.jsx)(tf.ZP.Parameters,{simulation:{id:e.id,scheme:e.scheme},swr:{mutateOneSimulation:ea}})}))},[ea,ef]),ek=(0,o.useCallback)(e=>{I((0,l.jsx)(K,{visible:H,title:"Materials",onClose:ef,children:(0,l.jsx)(tf.ZP.Materials,{geometries:d.map(e=>({id:e.id,name:e.name,summary:e.summary})),simulation:{id:e.id,scheme:e.scheme},swr:{mutateOneSimulation:ea},setVisible:W})}))},[d,H,ea,ef]),eM=(0,o.useCallback)(e=>{I((0,l.jsx)(K,{visible:!0,title:"Initialization",onClose:ef,children:(0,l.jsx)(tf.ZP.Initialization,{simulations:ei,simulation:e,swr:{mutateOneSimulation:ea}})}))},[ei,ea,ef]),eE=(0,o.useCallback)(e=>{I((0,l.jsx)(K,{visible:H,title:"Boundary conditions",onClose:ef,children:(0,l.jsx)(tf.ZP.BoundaryConditions,{geometries:d.map(e=>({id:e.id,name:e.name,summary:e.summary})),simulation:{id:e.id,scheme:e.scheme},swr:{mutateOneSimulation:ea},setVisible:W})}))},[d,H,ea,ef]),eS=(0,o.useCallback)(e=>{I((0,l.jsx)(K,{visible:H,title:"Run",onClose:ef,children:(0,l.jsx)(tf.ZP.Run,{geometries:d,simulation:{id:e.id,scheme:e.scheme},results:S,setResults:A,setPostprocessing:_,setVisible:W,swr:{mutateOneSimulation:ea}})}))},[d,S,H,ea,ef]),eA=(0,o.useCallback)((e,t)=>{var i,n,l,a,r,s;let o=ei.find(t=>t.id===e);if(!o)return;E(o);let d=null===(i=o.scheme)||void 0===i?void 0:null===(n=i.configuration)||void 0===n?void 0:null===(l=n.geometry)||void 0===l?void 0:l.value,c=null===(a=o.scheme)||void 0===a?void 0:null===(r=a.configuration)||void 0===r?void 0:null===(s=r.geometry)||void 0===s?void 0:s.values;if(d){let e=eo.find(e=>e.id===d);e&&h([e])}else if(c){let e=eo.filter(e=>c.includes(e.id));h(e)}switch(t){case"about":eP(o);break;case"geometry":eZ(o);break;case"parameters":eC(o);break;case"materials":ek(o);break;case"initialization":eM(o);break;case"boundaryConditions":eE(o);break;case"run":eS(o);break;default:I(void 0)}},[eo,ei,eP,eZ,eC,ek,eM,eE,eS]),eN=(0,o.useCallback)(()=>{(async()=>{await e.push({pathname:"/dashboard",query:{page:t,workspaceId:i}})})()},[e,t,i]),ez=(0,o.useCallback)(e=>{let t,{keyPath:i}=e,n=i.pop(),l=i.pop(),a=i.pop();a&&(t=a.split("&").pop()),U({key:n,id:l,item:t})},[]),eL=(0,o.useCallback)(async e=>{try{await tk(q,e,{addOneSimulation:en,mutateProject:$}),x(!1)}catch(e){}},[q,en,$]),eD=(0,o.useCallback)(e=>{if(ep)return!0;let t=e.value,i=e.values,n=e.multiple,l=e.n;return(!t||!!eo.filter(e=>e.id===t).length)&&(!n||!i||(l?eo.filter(e=>i.includes(e.id)).length===e.n:!!eo.filter(e=>i.includes(e.id)).length))&&(!!t||!!i)||(e.done=!1,!1)},[eo,ep]);(0,o.useEffect)(()=>{(async()=>{Y||G||await e.replace("/login")})()},[G,Y,e]),(0,o.useEffect)(()=>{J&&(0,L.lt)(tC.user,J),Q&&(0,L.lt)(tC.project,Q),er&&(0,L.lt)(tC.simulations,er),em&&(0,L.lt)(tC.geometries,em)},[J,Q,er,em]),(0,C.Z)(()=>{ee||ep?r(!1):eo.length?r(!1):r(!0)},[ee,ep,eo]),(0,C.Z)(()=>{if(!ep){if(d.length){let e=!1,t=d.map(t=>{let i=eo.find(e=>e.id===(null==t?void 0:t.id));return i?JSON.stringify({...i,visible:void 0})!==JSON.stringify({...t,visible:void 0})?(e=!0,i):t:(e=!0,null)}).filter(e=>e);e&&h(t)}else h(eo[0]?[eo[0]]:[])}},[ep,eo,d],[h]),(0,C.Z)(()=>{if(!es&&M){let e=ei.find(e=>e.id===(null==M?void 0:M.id));e?JSON.stringify(e)!==JSON.stringify(M)&&(E(e),B&&B.key===tZ.simulations.key&&eA(B.id,B.item)):(ef(),E(void 0))}},[ei,es,M,B],[E,ef]),(0,C.Z)(()=>{B&&(B.key===tZ.geometries.key?ej(B.id):(eA(B.id,B.item),"run"!==B.item&&(A([]),_(void 0))))},[B,H,S],[ej,eA,ef]),(0,o.useEffect)(()=>{!S.length&&F&&_(void 0)},[S,F]);let eO=(0,o.useMemo)(()=>eo.map(e=>{let t=d.find(t=>t.id===e.id);return{key:e.id,icon:(0,l.jsx)(g.Z,{}),label:(0,l.jsx)(tM,{visible:!!t,geometry:e,panel:V,add:eg,del:eb,close:ef})}}),[eo,d,V,eg,eb,ef]),eR=(0,o.useMemo)(()=>ei.map(e=>{let t=e.scheme.configuration||{},i=[];return Object.keys(t).forEach(n=>{if("dimension"===n)return;let a=t[n],r=(0,l.jsx)(w.Z,{style:{color:"green"}});a.error?r=(0,l.jsx)(b.Z,{style:{color:"red"}}):a.done||(r=(0,l.jsx)(f.Z,{style:{color:"orange"}})),"geometry"!==n||eD(a)||(r=(0,l.jsx)(f.Z,{style:{color:"orange"}})),i[a.index]={key:e.id+"&"+n,disabled:!d.length,icon:r,label:a.title}}),{key:e.id,icon:(0,l.jsx)(v.Z,{}),label:(0,l.jsx)(tE,{simulation:e}),children:[{key:e.id+"&about",disabled:!d.length,icon:(0,l.jsx)(w.Z,{style:{color:"green"}}),label:"About"},...i]}}),[d,ei,eD]);return!G||Y||ee?(0,l.jsx)(k.Z.Simple,{}):"0"===q.id?(0,l.jsx)(N,{}):(0,l.jsx)(D.ZP,{children:(0,l.jsxs)(c.Z,{hasSider:!0,children:[(0,l.jsxs)(c.Z.Sider,{theme:"light",className:tj().sider,width:256,children:[(0,l.jsx)("div",{className:et().logo,children:(0,l.jsx)("img",{src:"/images/logo.svg",alt:"Tanatloc"})}),(0,l.jsx)(u.Z,{className:tj().menu1,mode:"inline",items:[{key:"menu-go-back",disabled:!0,style:{cursor:"unset",margin:"10px 0",paddingLeft:10},label:(0,l.jsx)(z.ks,{className:et().fullWidth,onClick:eN,children:"Return to dashboard"})},{type:"divider"},{key:"title",disabled:!0,className:"Menu-title",label:(0,l.jsx)(m.Z.Paragraph,{ellipsis:{tooltip:!0,rows:2},children:q.title})}]}),(0,l.jsx)("div",{className:tj().menuScroll,children:(0,l.jsx)(u.Z,{mode:"inline",className:tj().menu2,defaultOpenKeys:[tZ.geometries.key,tZ.simulations.key],items:[{key:tZ.geometries.key,className:"SubMenu",icon:ep?(0,l.jsx)(j.Z,{}):(0,l.jsx)(g.Z,{}),label:(0,l.jsxs)(m.Z.Text,{strong:!0,children:[tZ.geometries.label," (",eo.length,")"]}),children:[{key:"new_geometry",disabled:!0,label:(0,l.jsx)(p.ZP,{icon:(0,l.jsx)(P.Z,{}),onClick:eh,children:"New Geometry"})},{key:"geometry-needed",disabled:!0,className:d.length?"display-none":"",icon:(0,l.jsx)(f.Z,{style:{color:"red"}}),label:"A Geometry is needed"},...eO]},{key:tZ.simulations.key,className:"SubMenu",icon:es?(0,l.jsx)(j.Z,{}):(0,l.jsx)(v.Z,{}),label:(0,l.jsxs)(m.Z.Text,{strong:!0,children:[tZ.simulations.label," (",ei.length,")"]}),children:[{key:"new_simulation",disabled:!0,label:(0,l.jsx)(p.ZP,{disabled:!eo.length,icon:(0,l.jsx)(Z.Z,{}),onClick:ey,children:"New Simulation"})},...eR]}],onClick:ez})})]}),(0,l.jsxs)(c.Z.Content,{className:et().noScroll,style:{position:"relative"},children:[(0,l.jsx)(ew.Add,{visible:a,project:{id:q.id,geometries:q.geometries},swr:{mutateProject:$,addOneGeometry:ed},setVisible:r}),(0,l.jsx)(tf.ZP.Selector,{user:{authorizedplugins:G.authorizedplugins,models:G.models},visible:y,onOk:eL,onCancel:ex}),(0,l.jsx)(tf.ZP.Updater,{user:{authorizedplugins:G.authorizedplugins},simulation:M&&{id:M.id,scheme:M.scheme},swr:{mutateOneSimulation:ea}}),V,(0,l.jsx)(tb,{project:{id:q.id,title:q.title},simulation:M&&{id:M.id},geometries:d.map(e=>({id:e.id,needCleanup:e.needCleanup})),results:S.map(e=>({glb:e.glb,originPath:e.originPath})),postprocessing:F&&{glb:F.glb,originPath:F.originPath}}),(0,l.jsx)(tP,{simulation:M&&{id:M.id,name:M.name}}),(0,l.jsx)(tf.ZP.Postprocessing,{simulation:M&&{id:M.id,scheme:M.scheme},results:S.map(e=>({name:e.name,fileName:e.fileName,originPath:e.originPath})),postprocessing:F&&{name:F.name,fileName:F.fileName},setResult:_})]})]})})};var tA=tS},87819:function(e){e.exports={upload:"add_upload__gI0Tw"}},39095:function(e){e.exports={variables:'"@/styles/variables.css"',colorPrimary:"#fad114",sider:"project_sider__iUhsS",menu1:"project_menu1__XdM_R",menuScroll:"project_menuScroll__78_Ce",menu2:"project_menu2__Txzic"}},60968:function(e){e.exports={variables:'"@/styles/variables.css"',colorPrimary:"#fad114",view:"three_view__MDbup",head:"three_head__fY_4c",content:"three_content__FaWcm",loading:"three_loading__B2ZAP",canvas:"three_canvas__LLX1q"}}}]);