(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[549],{5094:function(e,t,l){"use strict";l.d(t,{Z:function(){return a}});var i=l(11425);let n=async(e,t)=>{let l=await (0,i.R)("/api/avatar",{method:"POST",headers:{Accept:"application/json"},body:JSON.stringify({file:e,project:t})});return l.json()};var a={add:n}},71270:function(e,t,l){"use strict";l.d(t,{Z:function(){return u}});var i=l(11425);let n=async e=>{await (0,i.R)("/api/plugin",{method:"POST",body:JSON.stringify(e)})},a=async e=>{await (0,i.R)("/api/plugin",{method:"PUT",body:JSON.stringify(e)})},s=async e=>{await (0,i.R)("/api/plugin",{method:"DELETE",body:JSON.stringify(e)})};var r=l(8100),o=l(67294);let d=()=>{let{data:e,error:t,mutate:l}=(0,r.ZP)("/api/plugin",i._),n=(null==e?void 0:e.plugins)||[],a=(0,o.useCallback)(e=>{let t=[...n,e];l({plugins:t})},[n,l]),s=(0,o.useCallback)(e=>{let t=n.filter(t=>t.key!==e.key);l({plugins:t})},[n,l]),d=(0,o.useCallback)(e=>{let t=n.map(t=>(t.key===e.key&&(t={...t,...e}),t));l({plugins:t})},[n,l]);return[n,{mutatePlugins:l,addOnePlugin:a,delOnePlugin:s,mutateOnePlugin:d,errorPlugins:t,loadingPlugins:!e}]};var u={add:n,update:a,del:s,usePlugins:d}},10843:function(e,t,l){"use strict";l.d(t,{Z:function(){return s}});var i=l(11425);let n=async()=>{let e=await (0,i.R)("/api/plugins",{method:"GET",headers:{Accept:"application/json"}});return e.json()},a=async()=>{let e=await (0,i.R)("/api/plugins",{method:"POST",headers:{Accept:"application/json"}});return e.json()};var s={list:n,completeList:a}},26791:function(e,t,l){"use strict";l.d(t,{Z:function(){return y}});var i=l(8100),n=l(67294),a=l(11425);let s=e=>{let{data:t,error:l,mutate:s}=(0,i.ZP)(["/api/projects",JSON.stringify({ids:e})],a._),r=(null==t?void 0:t.projects)||[],o=(0,n.useCallback)(e=>{let t=[...r,{...e,users:[],geometries:[],simulations:[],groups:[]}];s({projects:t})},[r,s]),d=(0,n.useCallback)(e=>{let t=r.filter(t=>t.id!==e.id);s({projects:t})},[r,s]),u=(0,n.useCallback)(e=>{let t=r.map(t=>(t.id===e.id&&(t={...t,...e}),t));s({projects:t})},[r,s]);return[r,{addOneProject:o,delOneProject:d,mutateOneProject:u,errorProjects:l,loadingProjects:!t}]},r=e=>{let{data:t,error:l,mutate:s}=(0,i.ZP)("/api/project"+(e?"/"+e:""),a._),r=(null==t?void 0:t.project)||{id:"0"},o=(0,n.useCallback)(e=>{let t={...r,...e};s({project:t})},[r,s]);return[r,{mutateProject:o,errorProject:l,loadingProject:!t}]},o=async(e,t)=>{let l=await (0,a.R)("/api/project",{method:"POST",headers:{Accept:"application/json"},body:JSON.stringify({workspace:{id:e.id},project:t})});return l.json()},d=async(e,t)=>{await (0,a.R)("/api/project/"+e.id,{method:"PUT",body:JSON.stringify(t)})},u=async(e,t)=>{await (0,a.R)("/api/project/"+t.id,{method:"DELETE",body:JSON.stringify({id:e.id})})},c=async e=>(0,a.R)("/api/project/"+e.id+"/archive",{method:"GET",headers:{Accept:"application/json"}}),m=async e=>(0,a.R)("/api/project/"+e.id+"/archive",{method:"PUT"}),h=async e=>(0,a.R)("/api/project/"+e.id+"/archive",{method:"DELETE"}),p=async(e,t)=>(0,a.R)("/api/project/"+e.id+"/archive",{method:"POST",body:JSON.stringify({archive:t})});var y={useProjects:s,useProject:r,add:o,update:d,del:u,archive:c,unarchiveFromServer:m,deleteArchiveFile:h,unarchiveFromFile:p}},23853:function(e,t,l){"use strict";l.d(t,{Z:function(){return y}});var i=l(8100),n=l(67294),a=l(11425);let s=e=>{let{data:t,error:l,mutate:s}=(0,i.ZP)(["/api/simulations",JSON.stringify({ids:e})],a._),r=(null==t?void 0:t.simulations)||[],o=(0,n.useCallback)(e=>{let t=[...r,e];s({simulations:t})},[r,s]),d=(0,n.useCallback)(e=>{let t=r.filter(t=>t.id!==e.id);s({simulations:t})},[r,s]),u=(0,n.useCallback)((e,t)=>{let l=r.map(t=>(t.id===e.id&&(t={...t,...e}),t));s({simulations:l},t)},[r,s]);return[r,{addOneSimulation:o,delOneSimulation:d,mutateOneSimulation:u,errorSimulations:l,loadingSimulations:!t}]},r=(e,t)=>{let{data:l,error:s,mutate:r}=(0,i.ZP)("/api/simulation"+(e?"/"+e:""),a._,{refreshInterval:t||0}),o=(null==l?void 0:l.simulation)||{id:"0"},d=(0,n.useCallback)(e=>{r({simulation:{...o,...e}})},[o,r]);return[o,{mutateSimulation:d,errorSimulation:s,loadingSimulation:!l}]},o=async(e,t)=>{let l=await (0,a.R)("/api/simulation",{method:"POST",headers:{Accept:"application/json"},body:JSON.stringify({project:{id:e.id},simulation:t})});return l.json()},d=async(e,t)=>{await (0,a.R)("/api/simulation/"+e.id,{method:"PUT",body:JSON.stringify(t)})},u=async e=>{await (0,a.R)("/api/simulation/"+e.id,{method:"DELETE"})},c=async e=>{await (0,a.R)("/api/simulation/"+e.id+"/run",{method:"GET"})},m=async e=>{await (0,a.R)("/api/simulation/"+e.id+"/stop",{method:"GET"})},h=async e=>{let t=await (0,a.R)("/api/simulation/"+e.id+"/tasks",{method:"GET",headers:{Accept:"application/json"}});return t.json()},p=async(e,t)=>{let l=await (0,a.R)("/api/simulation/"+e.id+"/log",{method:"POST",body:JSON.stringify({file:t})});return l.json()};var y={useSimulations:s,useSimulation:r,add:o,update:d,del:u,run:c,stop:m,tasks:h,log:p}},89549:function(e,t,l){"use strict";let i;l.d(t,{ZP:function(){return iJ}});var n,a,s,r=l(85893),o=l(5152),d=l.n(o),u=l(11163),c=l(67294),m=l(84908),h=l(97183),p=l(66516),y=l(6880),x=l(71577),v=l(48869),f=l(8751),g=l(18429),j=l(11475),b=l(73480),w=l(22844),Z=l(50888),C=l(88484),S=l(64789),k=l(18436),E=l(67582),P=l(54666),N=l(81474),O=l(26713),T=l(20280);let M={notAllowed:"You are not allowed to be here."},z=e=>{e.push("/")},A=()=>{let e=(0,u.useRouter)();return(0,c.useEffect)(()=>{e.prefetch("/")},[e]),(0,r.jsx)(h.Z,{children:(0,r.jsx)(h.Z.Content,{children:(0,r.jsx)(N.Z,{title:"Not allowed",children:(0,r.jsxs)(O.Z,{direction:"vertical",children:[(0,r.jsxs)(y.Z.Text,{children:[(0,r.jsx)(T.Z,{style:{color:"red"}})," ",M.notAllowed]}),(0,r.jsxs)(y.Z.Text,{children:["Go back"," ",(0,r.jsx)(x.Z,{type:"link",onClick:()=>z(e),children:"home"})]})]})})})})},L={enabled:!1,type:void 0,part:void 0,highlighted:void 0,selected:[],point:void 0,dispatch:()=>void 0},R={ENABLE:"ENABLE",DISABLE:"DISABLE",CLEAR:"CLEAR",SETTYPE:"SETTYPE",SETPART:"SETPART",HIGHLIGHT:"HIGHLIGHT",UNHIGHLIGHT:"UNHIGHLIGHT",SELECT:"SELECT",UNSELECT:"UNSELECT",SETPOINT:"SETPOINT"},D=(0,c.createContext)(L),F=(e,t)=>{let l;switch(t.type){case R.ENABLE:return{...e,enabled:!0};case R.DISABLE:return{...e,enabled:!1,highlighted:void 0,selected:[]};case R.CLEAR:return{...L};case R.SETTYPE:return{...e,type:t.value};case R.SETPART:return{...e,part:t.value};case R.HIGHLIGHT:return{...e,highlighted:t.value};case R.UNHIGHLIGHT:return{...e,highlighted:void 0};case R.SELECT:if(-1===(l=e.selected.findIndex(e=>e.uuid===t.value.uuid)))return{...e,selected:[...e.selected,t.value]};return e;case R.UNSELECT:if(-1===(l=e.selected.findIndex(e=>e.uuid===t.value.uuid)))return e;return{...e,selected:[...e.selected.slice(0,l),...e.selected.slice(l+1)]};case R.SETPOINT:return{...e,point:t.value};default:return e}},I=e=>{let{children:t}=e,[l,i]=(0,c.useReducer)(F,L);return(0,r.jsx)(D.Provider,{value:{...l,dispatch:i},children:t})};var U=l(55734),B=l(26791),V=l(23853),H=l(8100),G=l(11425);let Y=e=>{let{data:t,error:l,mutate:i}=(0,H.ZP)(["/api/geometries",JSON.stringify({ids:e})],G._),n=(null==t?void 0:t.geometries)||[],a=(0,c.useCallback)(e=>{let t=[...n,e];i({geometries:t})},[n,i]),s=(0,c.useCallback)(e=>{let t=n.filter(t=>t.id!==e.id);i({geometries:t})},[n,i]),r=(0,c.useCallback)(e=>{let t=n.map(t=>(t.id===e.id&&(t={...t,...e}),t));i({geometries:t})},[n,i]);return[n,{addOneGeometry:a,delOneGeometry:s,mutateOneGeometry:r,errorGeometries:l,loadingGeometries:!t}]},J=async(e,t)=>{let l=await (0,G.R)("/api/geometry",{method:"POST",body:JSON.stringify({project:e,geometry:t})});return l.json()},W=async(e,t)=>{await (0,G.R)("/api/geometry/"+e.id,{method:"PUT",body:JSON.stringify(t)})},X=async e=>{await (0,G.R)("/api/geometry/"+e.id,{method:"DELETE"})},q=async e=>{let t=await (0,G.R)("/api/geometry/"+e.id+"/download");return t.json()},_=async e=>{let t=await (0,G.R)("/api/geometry/"+e.id+"/part");return t.json()};var K={useGeometries:Y,add:J,update:W,del:X,download:q,getPart:_},Q=l(97937);let $=e=>{let{visible:t,title:l,children:i,onClose:n}=e;return(0,r.jsx)(N.Z,{className:"panel",bodyStyle:{maxHeight:"calc(100vh - 65px)",overflow:"auto",padding:0},title:l,extra:(0,r.jsx)(x.Z,{type:"text",icon:(0,r.jsx)(Q.Z,{}),onClick:()=>n()}),style:{display:t?"block":"none"},children:i})};var ee=l(35083),et=l(78116),el=l(28345),ei=l(48764).lW;let en={add:"Unable to add geometry"},ea=e=>e.name.toLowerCase().includes(".stp")||e.name.toLowerCase().includes(".step")||e.name.toLowerCase().includes(".dxf"),es=async e=>{let t=new FileReader;return new Promise(l=>{t.addEventListener("load",()=>{l(t.result)}),t.readAsArrayBuffer(e)})},er=async(e,t,l)=>{if("uploading"===t.file.status)return!0;if("done"===t.file.status){let i=await es(t.file.originFileObj);try{let n=await K.add({id:e.id},{name:t.file.name,uid:t.file.uid,buffer:ei.from(i)});l.addOneGeometry(n),l.mutateProject({id:e.id,geometries:[...e.geometries,n.id]})}catch(a){throw(0,E.lt)(en.add,a),a}}return!1},eo=e=>{let{visible:t,project:l,swr:i,setVisible:n}=e,[a,s]=(0,c.useState)(!1);return(0,r.jsx)(el.ZP,{title:"Upload geometry",visible:t,onCancel:()=>n(!1),cancelButtonProps:{loading:a},children:(0,r.jsxs)(O.Z,{direction:"vertical",className:"full-width",children:[(0,r.jsx)(et.Z,{className:"upload",action:"/api/noop",accept:".stp,.step,.dxf",showUploadList:!1,listType:"picture-card",beforeUpload:ea,async onChange(e){try{let t=await er(l,e,i);s(t),n(t)}catch(a){s(!1)}},children:(0,r.jsx)("div",{children:a?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(Z.Z,{style:{fontSize:25}}),(0,r.jsxs)("div",{style:{marginTop:8},children:[(0,r.jsx)("b",{children:"Loading"}),", converting, ..."]})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(C.Z,{style:{fontSize:25}}),(0,r.jsxs)("div",{style:{marginTop:8},children:[(0,r.jsx)("b",{children:"Choose a file"})," or drop it here"]})]})})}),(0,r.jsx)(y.Z.Text,{children:(0,r.jsx)("p",{style:{color:"rgba(0, 0, 0, 0.45)",textAlign:"center"},children:"Native file format preferred: STEP (3D) or DXF (2D) file"})})]})})};var ed=l(81579),eu=l(69677);let ec=e=>{let{visible:t,geometry:l,setVisible:i,onEdit:n}=e,[a,s]=(0,c.useState)(!1);return(0,r.jsx)(el.ZP,{title:"Edit the geometry's name",visible:t,initialValues:{name:l.name},onCancel:()=>i(!1),async onOk(e){s(!0);try{await n(e),s(!1),i(!1)}catch(t){throw s(!1),t}},loading:a,children:(0,r.jsx)(ed.Z.Item,{name:"name",label:"Name:",rules:[{required:!0,message:"Name is required"}],children:(0,r.jsx)(eu.Z,{})})})};var em=l(48764).lW;let eh={download:"Unable to download geometry",update:"Unable to update geometry",del:"Unable to delete geometry"},ep=async e=>{try{let t=await K.download({id:e.id}),l=new File([em.from(t.buffer).toString()],e.name+"."+t.extension),i=window.URL.createObjectURL(l),n=document.createElement("a");n.href=i,n.setAttribute("download",e.name+"."+t.extension),n.click(),n.remove()}catch(a){(0,E.lt)(eh.download,a)}},ey=async(e,t,l)=>{try{await K.update({id:e.id},[{key:"name",value:t.name}]),e.name=t.name,l.mutateOneGeometry(e)}catch(i){throw(0,E.lt)(eh.update,i),i}},ex=async(e,t,l,i)=>{try{await K.del({id:e.id});let n=t.geometries.filter(t=>t!==e.id);i.mutateProject({id:t.id,geometries:n}),i.delOneGeometry(e),l()}catch(a){throw(0,E.lt)(eh.del,a),a}},ev=e=>{var t,l,i,n,a,s;let{project:o,geometry:d,swr:u,close:m,onCleanup:p}=e,[x,v]=(0,c.useState)(!1),[f,g]=(0,c.useState)(!1),[j,b]=(0,c.useState)(!1);return d?(0,r.jsx)(h.Z,{children:(0,r.jsx)(h.Z.Content,{children:(0,r.jsx)(N.Z,{size:"small",title:"Informations",actions:[(0,r.jsx)(k.o6,{loading:x,async onDownload(){v(!0);try{await ep(d)}catch(e){}finally{v(!1)}}},"download"),(0,r.jsxs)("div",{children:[(0,r.jsx)(ec,{visible:f,geometry:{id:null==d?void 0:d.id,name:null==d?void 0:d.name},setVisible:g,onEdit:async e=>ey(d,e,u)}),(0,r.jsx)(k.w6,{onEdit:()=>g(!0)})]},"edit"),(0,r.jsx)(k.m1,{loading:j,text:(0,r.jsxs)(r.Fragment,{children:["Are you sure you want to delete the geometry"," ",(0,r.jsx)(y.Z.Text,{strong:!0,children:d.name}),"?"]}),async onDelete(){b(!0);try{await ex(d,o,m,u),p()}finally{b(!1)}}},"delete")],children:(0,r.jsxs)(O.Z,{direction:"vertical",className:"full-width",children:[(0,r.jsxs)(y.Z.Text,{children:[(0,r.jsx)("span",{className:"text-light",children:"File:"})," ",d.name," "]}),(0,r.jsxs)(y.Z.Text,{children:[(0,r.jsx)("span",{className:"text-light",children:"Unit:"})," ",(0,r.jsx)(ee.Z.Inline,{text:"m"})]}),(0,r.jsxs)(r.Fragment,{children:[3===d.summary.dimension&&(0,r.jsxs)(y.Z.Text,{children:[(0,r.jsx)("span",{className:"text-light",children:"Number of solids:"})," ",null!==(n=null===(t=d.summary.solids)||void 0===t?void 0:t.length)&&void 0!==n?n:0]}),(0,r.jsxs)(y.Z.Text,{children:[(0,r.jsx)("span",{className:"text-light",children:"Number of faces:"})," ",null!==(a=null===(l=d.summary.faces)||void 0===l?void 0:l.length)&&void 0!==a?a:0]}),2===d.summary.dimension&&(0,r.jsxs)(y.Z.Text,{children:[(0,r.jsx)("span",{className:"text-light",children:"Number of edges:"})," ",null!==(s=null===(i=d.summary.edges)||void 0===i?void 0:i.length)&&void 0!==s?s:0]})]})]})})})}):(0,r.jsx)(P.Z.Simple,{})};ev.Add=eo;let ef=async(e,t)=>{let l=await (0,G.R)("/api/result",{method:"POST",headers:{Accept:"application/json"},body:JSON.stringify({simulation:e,result:t})});return l.json()},eg=async(e,t)=>(0,G.R)("/api/result/download",{method:"POST",body:JSON.stringify({simulation:e,result:t})}),ej=async e=>(0,G.R)("/api/result/archive",{method:"POST",body:JSON.stringify({simulation:e})});var eb={load:ef,download:eg,archive:ej},ew=l(13013),eZ=l(27049),eC=l(94594),eS=l(11382),ek=l(41428),eE=l(38095),eP=l(86350),eN=l(15668),eO=l(74317),eT=l(35598),eM=l(49591),ez=l(19478),eA=l(87784),eL=l(90420),eR=l(75843),eD=l(15611),eF=l(99477),eI=l(57632),eU=l(79753),eB=l(54458),eV=l(58939),eH=l(24065),eG=l(54327);let eY=e=>{let t=new eF.fHI(.025,.025,.8,50);t.translate(0,.4,0);let l=new eF.vBJ({color:e}),i=new eF.Kj0(t,l),n=new eF.b_z(.05,.2,50);n.translate(0,.9,0);let a=new eF.vBJ({color:e}),s=new eF.Kj0(n,a),r=new eF.ZAu;r.type="ArrowHelper",r.add(i),r.add(s);let o=()=>{t.dispose(),l.dispose(),n.dispose(),a.dispose()};return r.dispose=o,r},eJ=(e,t,l)=>{let i=document.createElement("canvas");i.width=(null==l?void 0:l.width)||256,i.height=256;let n=i.getContext("2d");n.fillStyle="grey",n.font="50px sans-serif",n.textAlign=(null==l?void 0:l.align)||"center",n.textBaseline="middle",n.fillText(t,i.width/2,i.height/2);let a=new eF.xEZ(i);a.flipY=!0,a.needsUpdate=!0;let s=new eF.xeV({map:a,transparent:!0,depthWrite:!1});s.map.anisotropy=e.capabilities.getMaxAnisotropy();let r=new eF.jyi(s);r.type="LabelHelper",(null==l?void 0:l.position)&&r.position.copy(l.position),(null==l?void 0:l.scale)&&r.scale.setScalar(l.scale);let o=()=>{a.dispose(),s.dispose()};return r.dispose=o,r},eW=function(e,t){let{offsetWidth:l,offsetHeight:i,width:n,height:a}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{offsetWidth:0,offsetHeight:0,width:150,height:150},s=l,r=i,o=n,d=a,u=eY("red");u.rotateZ(-Math.PI/2);let c=eJ(e,"X",{position:new eF.Pa4(1.1,0,0)}),m=eY("green"),h=eJ(e,"Y",{position:new eF.Pa4(0,1.1,0)}),p=eY("blue");p.rotateX(Math.PI/2);let y=eJ(e,"Z",{position:new eF.Pa4(0,0,1.1)}),x=new eF.xo$(.05,50,50),v=new eF.vBJ({color:"black"}),f=new eF.Kj0(x,v),g=new eF.ZAu;g.type="AxisHelper",g.add(u),g.add(c),g.add(m),g.add(h),g.add(p),g.add(y),g.add(f);let j=new eF.xsS;j.add(g);let b=new eF.iKG(-1.2,1.2,1.2,-1.2,-2,2),w=e=>{let{newOffsetWidth:t,newOffsetHeight:l,newWidth:i,newHeight:n}=e;s=t,r=l,o=i,d=n},Z=()=>{e.setViewport(s,r,o,d),b.rotation.copy(t.rotation),e.render(j,b)},C=()=>{x.dispose(),v.dispose(),g.children.forEach(e=>{("ArrowHelper"===e.type||"LabelHelper"===e.type)&&e.dispose()}),j.remove(g)};return{dispose:C,render:Z,resize:w}},eX=function(e,t,l,i){let{offsetWidth:n,offsetHeight:a,width:s,height:r}=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{offsetWidth:0,offsetHeight:0,width:150,height:150},o="#d3d3d3",d=null,u=null,c=[{text:"FRONT",normal:new eF.Pa4(0,0,1),up:new eF.Pa4(0,1,0)},{text:"BACK",normal:new eF.Pa4(0,0,-1),up:new eF.Pa4(0,1,0)},{text:"RIGHT",normal:new eF.Pa4(1,0,0),up:new eF.Pa4(0,1,0)},{text:"LEFT",normal:new eF.Pa4(-1,0,0),up:new eF.Pa4(0,1,0)},{text:"UP",normal:new eF.Pa4(0,1,0),up:new eF.Pa4(0,0,-1)},{text:"DOWN",normal:new eF.Pa4(0,-1,0),up:new eF.Pa4(0,0,1)}],m=new eF._12(75,75),h=new eF.TOt(m),p=new eF.xo$(37.5,10,10,0,Math.PI,0),y=new eF.ZAu;c.forEach(e=>{let t=document.createElement("canvas"),l=t.getContext("2d");t.width=t.height=256,l.fillStyle=o,l.fillRect(0,0,t.width,t.height),l.font="bold 50pt sans-serif",l.fillStyle="#000000",l.textAlign="center",l.textBaseline="middle",l.fillText(e.text,t.width/2,t.height/2);let i=new eF.ROQ(t);i.needsUpdate=!0;let n=new eF.vBJ({map:i}),a=new eF.vBJ({color:o}),s=new eF.Kj0(m,n),r=new eF.Kj0(m,a);r.rotateY(Math.PI);let d=new eF.nls({color:"#ffffff"}),u=new eF.ejS(h,d),c=new eF.vBJ({color:o,transparent:!0,opacity:.2}),x=new eF.Kj0(p,c),v=new eF.ZAu;v.add(s,r,u,x),v.lookAt(e.normal),v.translateZ(50),v.normal=e.normal,v.up=e.up,y.add(v)});let x=new eF.Mig("#ffffff",1),v=new eF.xsS;v.add(y),v.add(x);let f=new eF.iKG(-100,100,100,-100,-100,100);f.position.z=2;let g=new eF.iMs,j=e=>{let t=b(e);w(t)?(d=Z(t),C(),(null==d?void 0:d.uuid)!==(null==u?void 0:u.uuid)&&(S(),u=d)):(d=null,S())},b=e=>{let t=e.target,l=t.getBoundingClientRect(),i=e.clientX-l.left,o=e.clientY-l.top,d=new eF.FM8;return d.x=(i-n)/s*2-1,d.y=-(2*((o+r-l.height+a)/r))+1,d},w=e=>e.x>-1&&e.x<1&&e.y>-1&&e.y<1,Z=e=>{let t=new eF.Pa4(e.x,e.y,-1);t.unproject(f);let l=new eF.Pa4;f.getWorldDirection(l),g.set(t,l);let i=g.intersectObjects(v.children,!0);return i.length?i[0].object.parent:null},C=()=>{d&&d.children&&d.children.forEach(e=>{let t=e;t.material&&t.material.color&&(t.material.previousColor=t.material.color,t.material.color=new eF.Ilk("#FAD114"))})},S=()=>{u&&u.children&&u.children.forEach(e=>{let t=e;t.material&&t.material.color&&(t.material.color=new eF.Ilk(o))})},k=e=>{if(d){let n=d.normal,a=d.up,s=new eF.Pa4;t.boundingBox&&t.boundingBox.getCenter(s);let r=l.position.distanceTo(i.target),o=n.clone().multiplyScalar(r),u=s.add(o);l.position.copy(u),l.up.copy(a),d=null,S(),j(e)}};e.domElement.addEventListener("pointermove",j),e.domElement.addEventListener("pointerdown",k);let E=e=>{let{newOffsetWidth:t,newOffsetHeight:l,newWidth:i,newHeight:o}=e;n=t,a=l,s=i,r=o},P=()=>{e.setViewport(n,a,s,r),f.rotation.copy(l.rotation),e.render(v,f)},N=()=>{e.domElement.removeEventListener("pointermove",j),e.domElement.removeEventListener("pointerdown",k),y.children.forEach(e=>{e.children.forEach(e=>{e.geometry.dispose(),e.material.dispose()})}),v.remove(y)};return{resize:E,render:P,dispose:N}},eq=e=>1e-12>Math.abs(e)?"0":Math.abs(e)>1e3||.001>Math.abs(e)?e.toExponential(2):e.toFixed(3),e_=(e,t,l,i)=>{let n,a,s;let r=e=>{let t=Math.max(e.x,e.y,e.z),l=Math.max(Math.ceil(e.x/t*5),2),i=Math.max(Math.ceil(e.y/t*5),2),n=Math.max(Math.ceil(e.z/t*5),2);return new eF.Pa4(l,i,n)},o=(e,t,l,i,n)=>{let a=new eF.ZAu,s=new eF.nls({color:8947848}),r=new eF.Pa4(-e/2,0,-t/2),o=e/(l-1),d=t/(i-1);for(let u=0;u<i;++u){let c=new eF.u9r().setFromPoints([new eF.Pa4(r.x,0,r.z+u*d),new eF.Pa4(r.x+e,0,r.z+u*d)]);a.add(new eF.x12(c,s))}for(let m=0;m<l;++m){let h=new eF.u9r().setFromPoints([new eF.Pa4(r.x+m*o,0,r.z),new eF.Pa4(r.x+m*o,0,r.z+t)]);a.add(new eF.x12(h,s))}return null==n||n(a),a},d=(t,l,i,n)=>{let a=new eF.ZAu,s=Math.abs(l-t),r=s/(n-1),o=new eF.Pa4().copy(i).multiplyScalar(-s/2),d=new eF.Pa4().copy(i).multiplyScalar(r),u=t;for(let c=0;c<n;++c){let m=eJ(e,eq(u));m.position.copy(o),a.add(m),o.add(d),u+=r}return a},u=()=>{let e=t.boundingBox,l=t.boundingSphere.center,i=new eF.Pa4(e.max.x-e.min.x,e.max.y-e.min.y,e.max.z-e.min.z),s=r(i);a=1*(n=.1*Math.max(i.x,i.y,i.z));let u=new eF.ZAu,c=o(i.x,i.z,s.x,s.z),m=o(i.x,i.y,s.x,s.y,e=>{e.rotateX(Math.PI/2)}),h=o(i.y,i.z,s.y,s.z,e=>{e.rotateZ(-Math.PI/2)});u.add(c,m,h);let p=d(e.min.x,e.max.x,new eF.Pa4(1,0,0),s.x),x=d(e.min.y,e.max.y,new eF.Pa4(0,1,0),s.y),v=d(e.min.z,e.max.z,new eF.Pa4(0,0,1),s.z);return u.add(p,x,v),u.position.set(l.x,l.y,l.z),u.type="GridHelper",u.dispose=y,u},c=e=>e<=0?-1:1,m=e=>.5>=Math.abs(e)?1:-1,h=()=>{let e=t.boundingBox,r=new eF.Pa4(e.max.x-e.min.x,e.max.y-e.min.y,e.max.z-e.min.z),o=!1;t.children.forEach(e=>{"GridHelper"===e.type&&(o=e.visible,t.remove(e),e.dispose())}),s=u();let d=i.object.position.distanceTo(i.target);s.traverse(e=>{"LabelHelper"===e.type&&e.scale.setScalar(.05*d)});let h=new eF.Pa4;l.getWorldDirection(h);let p=d/10/(i.minDistance+.001),y=s.children[0],x=s.children[1],v=s.children[2];y.position.set(0,c(h.y)*(r.y/2+n),0),x.position.set(0,0,c(h.z)*(r.z/2+n)),v.position.set(c(h.x)*(r.x/2+n),0,0);let f=s.children[3],g=s.children[4],j=s.children[5];f.position.set(0,c(h.y)*m(h.y)*(r.y/2+a),-(c(h.z)*m(h.y)*(r.z/2+a))),g.position.set(c(h.x)*m(h.x)*(r.x/2+a),0,-(c(h.z)*m(h.x)*(r.z/2+a))),j.position.set(c(h.x)*m(h.x)*(r.x/2+a),-(c(h.y)*m(h.x)*(r.y/2+a)),0);let b=.2*p,w=.3*p;f.visible=Math.abs(h.y)>b||Math.abs(h.z)>w,g.visible=Math.abs(h.x)>w||Math.abs(h.z)>w,j.visible=Math.abs(h.x)>w||Math.abs(h.y)>b,s.visible=o,t.add(s)},p=e=>{s.visible=e},y=()=>{null==s||s.children.forEach(e=>{e.children.forEach(e=>{if("Line"===e.type){let t=e.geometry;t.dispose();let l=e.material;l.dispose()}else e.dispose()})})};return{dispose:y,setVisible:p,update:h}},eK=(e,t,l,i)=>{let n=document.createElement("div");n.style.pointerEvents="none",n.style.border="1px solid #55aaff",n.style.backgroundColor="rgba(75, 160, 255, 0.3)",n.style.position="fixed";let a=new eF.FM8,s=new eF.FM8,r=new eF.FM8,o=new eF.FM8,d=!1,u=!1,c=new eF.iMs,m=()=>{d=!0},h=()=>{d=!1},p=e=>{d&&0===e.button&&(u=!0,v(e))},y=e=>{d&&u&&f(e)},x=e=>{u=!1,d&&g(e)};e.domElement.addEventListener("pointerdown",p),e.domElement.addEventListener("pointermove",y),e.domElement.addEventListener("pointerup",x);let v=t=>{i.enabled=!1,e.domElement.parentElement.appendChild(n),n.style.left=t.clientX+"px",n.style.top=t.clientY+"px",n.style.width="0px",n.style.height="0px",a.x=t.clientX,a.y=t.clientY},f=e=>{o.x=Math.max(a.x,e.clientX),o.y=Math.max(a.y,e.clientY),r.x=Math.min(a.x,e.clientX),r.y=Math.min(a.y,e.clientY),n.style.left=r.x+"px",n.style.top=r.y+"px",n.style.width=o.x-r.x+"px",n.style.height=o.y-r.y+"px"},g=e=>{i.enabled=!0,n.parentElement&&n.parentElement.removeChild(n),s.x=e.clientX,s.y=e.clientY;let t=new eF.TUj(a,s);j(t),h()},j=n=>{let a=new eF.FM8;if(n.getSize(a),a.x<5||a.y<5)return;let s=new eF.FM8((n.max.x+n.min.x)/2,(n.max.y+n.min.y)/2),r=e.domElement.getBoundingClientRect(),o=s.x-r.left,d=s.y-r.top,u=new eF.FM8(o/r.width*2-1,-(2*(d/r.height))+1),m=t.children.find(e=>"Part"===e.type);if(!m)return;c.setFromCamera(u,l);let h=c.intersectObject(m);if(!h.length)return;i.target.copy(h[0].point);let p=new eF.FM8(a.x/r.width,a.y/r.height),y=Math.max(p.x,p.y),x=l.position.distanceTo(i.target),v=i.target.clone().sub(l.position).normalize().multiplyScalar(x*(1-y));l.position.add(v)},b=()=>{e.domElement.removeEventListener("pointerdown",p),e.domElement.removeEventListener("pointermove",y),e.domElement.removeEventListener("pointerup",x)};return{dispose:b,end:h,isEnabled:()=>d,start:m}},eQ=(e,t,l,i)=>{let n,a,s;let r=new eF.Ilk("#fad114"),o=new eF.Ilk("#E98A15"),d=new eF.Pa4(-1,0,0),u=new eF.JOQ(d),c={up:new eF.Pa4,forward:new eF.Pa4,right:new eF.Pa4},m=new eF.Pa4,h=new eF.Pa4,p=new eF.USm,y=new eF.Pa4,x=new eF.FM8,v=new eF.JOQ,f=new eF.Pa4,g=new eF.Pa4,j=new eF.Zzh,b={up:new eF.Pa4,forward:new eF.Pa4,right:new eF.Pa4},w=new eF.iMs,Z=new eF.ZAu;Z.type="SectionViewHelper",Z.visible=!1,t.add(Z),(()=>{let e=new eF._12(1,1),t=new eF.vBJ({color:r,side:eF.ehD,transparent:!0,opacity:.5}),l=new eF.Kj0(e,t);l.type="Plane",Z.add(l)})(),(()=>{let e=new eF.xo$(.2,32,32,Math.PI,-Math.PI),t=new eF.vBJ({color:r,side:eF.ehD,transparent:!0,opacity:.5}),l=new eF.Kj0(e,t);l.type="Dome",Z.add(l)})(),(()=>{class e extends eF.Hyl{getPoint(e){return new eF.Pa4().set(this.radius*Math.cos(Math.PI*e),this.radius*Math.sin(Math.PI*e),0)}constructor(e){super(),this.radius=e}}let t=new e(.2);{let l=new eF.WXh(t,32,.020000000000000004,32),i=new eF.vBJ({color:r,side:eF.ehD,transparent:!0,opacity:.5}),n=new eF.Kj0(l,i);n.rotateX(Math.PI/2),n.type="ArcX",Z.add(n)}{let a=new eF.WXh(t,32,.020000000000000004,32),s=new eF.vBJ({color:r,side:eF.ehD,transparent:!0,opacity:.5}),o=new eF.Kj0(a,s);o.rotateX(Math.PI/2),o.rotateY(Math.PI/2),o.type="ArcY",Z.add(o)}})();let C=()=>{let e=new eF.Pa4;t.boundingBox.getSize(e),e.multiplyScalar(1.2);let l=Math.max(Math.max(e.x,e.y),e.z);Z.scale.setScalar(l)},S=()=>{let e=new eF.Pa4;t.boundingBox.getCenter(e),Z.position.copy(e)},k=()=>{let e=Z.visible;Z.visible=!e},E=()=>{e.localClippingEnabled=!0,Z.visible=!0,C(),S();let t=new eF.Pa4().copy(Z.position).sub(d);Z.lookAt(t),u.setFromNormalAndCoplanarPoint(d,Z.position)},P=()=>{e.localClippingEnabled=!1,Z.visible=!1},N=e=>{if(S(),d.equals(e)){O();return}let t=new eF.Pa4().copy(Z.position).sub(e);Z.lookAt(t),u.setFromNormalAndCoplanarPoint(e,Z.position),d.copy(e)},O=()=>{Z.rotateX(Math.PI);let e=u.normal.multiplyScalar(-1);u.setFromNormalAndCoplanarPoint(e,Z.position)},T=()=>{Z.traverse(e=>{("Plane"===e.type||"Dome"===e.type||"ArcX"===e.type||"ArcY"===e.type)&&(e.geometry.dispose(),e.material.dispose())}),e.domElement.removeEventListener("pointermove",F),e.domElement.removeEventListener("pointerdown",J),e.domElement.removeEventListener("pointerup",W)},M=e=>{let t=e.target,l=t.getBoundingClientRect(),i=e.clientX-l.left,n=e.clientY-l.top,a=new eF.FM8;return a.x=i/l.width*2-1,a.y=-(2*(n/l.height))+1,a},z=e=>{n&&n.material.color.set(r),n=e,e&&e.material.color.set(o)},A=()=>{i.enabled=!0},L=()=>{i.enabled=!1},R=()=>{l.getWorldDirection(c.forward),c.forward.normalize(),c.up.copy(l.up).normalize(),c.right.crossVectors(c.up,c.forward).normalize()},D=()=>{let e=new eF.Pa4(0,0,1).applyQuaternion(Z.quaternion).multiplyScalar(-1);u.setFromNormalAndCoplanarPoint(e,Z.position)},F=e=>{if(!Z.visible)return;let t=M(e);if(w.setFromCamera(t,l),a){let i=new eF.Pa4;w.ray.intersectPlane(v,i),(null==s?void 0:s.type)==="Plane"?U(i):(null==s?void 0:s.type)==="Dome"?V(t):G(i),D()}else{let n=w.intersectObject(Z);n.length?(L(),z(s=n[0].object),h.copy(n[0].point),R()):(s=null,z(),A())}},I=()=>{v.setFromNormalAndCoplanarPoint(c.forward,h),m.copy(Z.position);let e=new eF.Pa4;w.ray.intersectPlane(v,e),f.copy(e).sub(m),g.copy(f).normalize(),j.set(m,new eF.Pa4().copy(m).add(u.normal))},U=e=>{e.sub(f);let t=new eF.Pa4;j.closestPointToPoint(e,!1,t),Z.position.copy(t)},B=e=>{p.copy(Z.rotation),x.copy(e)},V=e=>{Z.rotation.copy(p),Z.rotateOnWorldAxis(c.up,-(5*(x.x-e.x))),Z.rotateOnWorldAxis(c.right,-(5*(x.y-e.y)))},H=()=>{s.getWorldDirection(y),p.copy(Z.rotation),f.copy(h).sub(Z.position),g.copy(f).normalize(),b.up.copy(g),b.right.copy(y),b.forward.crossVectors(b.right,b.up),j.set(h,new eF.Pa4().copy(h).add(b.forward)),v.setFromNormalAndCoplanarPoint(c.forward,h)},G=e=>{let t=i.object.position.distanceTo(i.target),l=new eF.Pa4;j.closestPointToPoint(e,!1,l);let n=h.distanceTo(l);l.sub(h);let a=new eF.Pa4().copy(g).cross(l).normalize(),s=Math.sign(y.dot(a));Z.rotation.copy(p),Z.rotateOnWorldAxis(y,s*n*1/(t/100))},Y=e=>{switch(null==s?void 0:s.type){case"Plane":I();break;case"Dome":B(e);break;case"ArcX":case"ArcY":H()}},J=e=>{if(Z.visible&&s){a=!0;let t=M(e);Y(t)}},W=()=>{Z.visible&&(a=!1,z())};return e.domElement.addEventListener("pointermove",F),e.domElement.addEventListener("pointerdown",J),e.domElement.addEventListener("pointerup",W),{getClippingPlane:()=>u,toggleVisible:k,start:E,stop:P,toAxis:N,flip:O,dispose:T}};var e$=l(54104);let e0=e=>{let t=new eF.xsS,l=new eF.iKG(-1,1,1,-1,2,1);l.position.set(0,0,1);let i=new eF.ZAu;t.add(i);let n=e=>{t.children.forEach(t=>{t.children.forEach(t=>t.visible=e)})},a=()=>{t.children.forEach(e=>e.children.forEach(t=>{"LabelHelper"===t.type&&t.dispose(),"Sprite"===t.type&&t.dispose(),e.remove(t)}))},s=e=>{a();let t=new e$.A("rainbow",e.n);t.setMin(e.minV),t.setMax(e.maxV);let l=new eF.ROQ(t.createCanvas()),n=new eF.xeV({map:l,depthWrite:!1}),s=new eF.jyi(n);s.material.rotation=-Math.PI/2,s.scale.x=.2,s.scale.y=1.2,s.dispose=s.material.dispose,i.add(s),r(t)},r=t=>{let l=eq(t.minV),n=eq(t.maxV),a=eJ(e,String(l),{position:new eF.Pa4(-.62,0,0),width:512,align:"right"});a.scale.x=.4,a.scale.y=2.8;let s=eJ(e,String(n),{position:new eF.Pa4(.62,0,0),width:512,align:"left"});s.scale.x=.4,s.scale.y=2.8,i.add(a),i.add(s)},o=()=>{let i=e.domElement.getBoundingClientRect();e.setViewport(i.width/2-350,i.height-50,700,50),e.render(t,l)},d=()=>{a()};return{render:o,setLUT:s,setVisible:n,dispose:d}},e1=e=>{let t=new eF.ZAu;t.type="PointHelper",t.visible=!1,e.add(t);let l=()=>{var t,l;let i=(null!==(l=null===(t=e.boundingSphere)||void 0===t?void 0:t.radius)&&void 0!==l?l:1)/100,n=new eF.xo$(i),a=new eF.Wid({color:16711680});return new eF.Kj0(n,a)},i=(e,t)=>{let l=new eF.u9r().setFromPoints([e,t]),i=new eF.nls({color:16711680});return new eF.x12(l,i)},n=()=>{let t=[],l=e.boundingBox.max.x-e.boundingBox.min.x,n=e.boundingBox.max.y-e.boundingBox.min.y,a=e.boundingBox.max.z-e.boundingBox.min.z,s=Math.max(l,n,a),r=i(new eF.Pa4(-s/2,0,0),new eF.Pa4(s/2,0,0));t.push(r);let o=i(new eF.Pa4(0,-s/2,0),new eF.Pa4(0,s/2,0));t.push(o);let d=i(new eF.Pa4(0,0,-s/2),new eF.Pa4(0,0,s/2));return t.push(d),t},a=()=>{r();let e=l(),i=n();t.add(e),t.add(...i)},s=e=>{e?(t.position.set(e.x,e.y,e.z),t.visible=!0):t.visible=!1},r=()=>{t.children.forEach(e=>{t.remove(e),e.geometry.dispose(),e.material.dispose()})};return{build:a,dispose:r,update:s}};var e2=l(1217),e4=l(82854),e5=l(6648),e8=l(48764).lW;let e3=(e,t)=>{e.traverse(e=>{if("Mesh"===e.type){let l=e,i=new eF.Uk6(l.geometry),n=new eF.nls({color:l.material.color,linewidth:1}),a=new eF.ejS(i,n);l.add(a),l.material.visible=!1,l.material.clippingPlanes=[t]}})},e6=(e,t)=>{e.traverse(e=>{if("Mesh"===e.type||"Line"===e.type){let l=e,i=l.geometry.getAttribute("data");if(i){let n=i.array.reduce((e,t)=>Math.min(e,t),i.array[0]),a=i.array.reduce((e,t)=>Math.max(e,t),i.array[0]);n===a&&(n-=1,a+=1);let s=new e$.A;s.setMin(n),s.setMax(a);let r=new Float32Array(3*i.count);for(let o=0;o<i.count;o++){let d=s.getColor(i.array[o]);r[3*o+0]=d.r,r[3*o+1]=d.g,r[3*o+2]=d.b}l.geometry.setAttribute("color",new eF.a$l(r,3)),l.userData={...l.userData,lut:s}}if("Mesh"===e.type){let u=new eF.Uk6(l.geometry),c=new eF.nls({linewidth:1}),m=new eF.ejS(u,c);l.add(m)}l.material.vertexColors=!0,l.material.clippingPlanes=[t]}})},e7=(e,t)=>{e.traverse(e=>{if("Mesh"===e.type){let l=e;l.material.clippingPlanes=[t],l.material.originalColor=l.material.color}})},e9=(e,t)=>{let l=new eF.Ilk("#FAD114"),i=new eF.Ilk("#EE9817"),n=async(e,t,l,i)=>{let n=new Blob([e8.from(e.buffer)]),d=URL.createObjectURL(n),u=new e2.E,c=new e4._;c.setDecoderPath("/three/libs/draco/"),u.setDRACOLoader(c);let m=new e5.a;m.setTranscoderPath("node_modules/three//examples/js/libs/basis/"),u.setKTX2Loader(m);let h=await new Promise((e,t)=>{u.load(d,t=>{e(t)},()=>void 0,e=>t(e))}),p=h.scene,g=new eF.Tme;return g.type="Part",g.uuid=e.summary.uuid,g.children=p.children,g.userData=p.userData,"mesh"===e.summary.type?e3(g,i):"result"===e.summary.type?e6(g,i):("geometry3D"===e.summary.type||"geometry2D"===e.summary.type)&&e7(g,i),r(g,t),o(g,l),g.boundingBox=a(g),g.dispose=()=>s(g),g.setTransparent=e=>r(g,e),g.setDisplayMesh=e=>o(g,e),g.startSelection=(e,t,l,i)=>v(g,e,t,l,i),g.stopSelection=()=>f(),g.getHighlighted=()=>y,g.getSelected=()=>x,g.highlight=P,g.unhighlight=N,g.select=T,g.unselect=M,g},a=e=>{let t=new eF.ZzF;return e.traverse(e=>{t.expandByObject(e)}),t},s=e=>{e.traverse(e=>{"Mesh"===e.type&&(e.geometry.dispose(),e.material.dispose())})},r=(e,t)=>{e.traverse(e=>{if("Mesh"===e.type){let l=e;l.material.transparent=t,l.material.opacity=t?.5:1,l.material.depthWrite=!t}})},o=(e,t)=>{"result"===e.userData.type&&e.traverse(e=>{e.traverse(e=>{if("LineSegments"===e.type){let l=e;l.visible=t}})})},d=new eF.iMs,u=null,c=null,m=null,h=null,p=null,y=null,x=[],v=(e,t,l,i,n)=>{u=e,c=n,m=t,h=l,(p=i).selectedObjects=[],y=null,x.length=0,m.domElement.addEventListener("pointermove",S),m.domElement.addEventListener("pointerdown",O)},f=()=>{m&&m.domElement.removeEventListener("pointermove",S),m&&m.domElement.removeEventListener("pointerdown",O),N(),y=null,x.forEach(e=>{M(e.uuid)}),x.length=0,c=null,u=null,m=null,h=null,p=null},g=(e,t)=>{let l;if(e&&t)return e.traverse(e=>{e.userData.uuid===t&&(l=e)}),l},j=e=>{let t=e.target,l=t.getBoundingClientRect(),i=e.clientX-l.left,n=e.clientY-l.top,a=new eF.FM8;return a.x=i/l.width*2-1,a.y=-(2*(n/l.height))+1,a},b=()=>{let t=d.intersectObject(u,!0);if(t.length){let l=t[0].object,i=l.parent;i&&e(u,i.userData.uuid,i.userData.label)}else e(u)},w=()=>{let t;let l=u.userData;if(2===l.dimension){if((t=d.intersectObject(u,!0)).length){let i=t[0].object,n=i.parent;(null==n?void 0:n.type)==="Mesh"?e(u,n.userData.uuid,n.userData.label):e(u,i.userData.uuid,i.userData.label)}else e(u)}else if((t=d.intersectObject(u,!0)).length){let a=t[0].object;e(u,a.userData.uuid,a.userData.label)}else e(u)},Z=()=>{let t;let l=u.userData,i=l.edges;if((t=d.intersectObject(u,!0)).length){let n=t[0].object,a=null==i?void 0:i.find(e=>e.uuid===n.userData.uuid);a?e(u,n.userData.uuid,n.userData.label):e(u)}else e(u)},C=()=>{let t=d.intersectObject(u,!0);if(t.length){let l=t[0];e(u,void 0,void 0,l.point)}else e(u)},S=e=>{let t=j(e);switch(d.setFromCamera(t,h),c){case"solids":b();break;case"faces":w();break;case"edges":Z();break;case"point":C()}},k=(e,t)=>{if(t){let l=p.selectedObjects.find(t=>t.userData.uuid===e.userData.uuid);l||p.selectedObjects.push(e)}else{let i=x.find(t=>t.uuid===e.userData.uuid);i||p.selectedObjects.push(e)}},E=(e,t)=>{if(t){let l=p.selectedObjects.findIndex(t=>t.userData.uuid===e.userData.uuid);p.selectedObjects=[...p.selectedObjects.slice(0,l),...p.selectedObjects.slice(l+1)]}else{let i=x.find(t=>t.uuid===e.userData.uuid);if(!i){let n=p.selectedObjects.findIndex(t=>t.userData.uuid===e.userData.uuid);p.selectedObjects=[...p.selectedObjects.slice(0,n),...p.selectedObjects.slice(n+1)]}}},P=e=>{if(e===(null==y?void 0:y.uuid))return;N();let t=g(u,e);if(t){if(y={uuid:t.userData.uuid,label:t.userData.label},k(t),"Mesh"===t.type){let i=t;i.material.color=l}else t.traverse(e=>{if("Mesh"===e.type){let t=e;t.material.color=l}})}},N=()=>{let e=g(u,null==y?void 0:y.uuid);if(y=null,!e)return;E(e);let t=x.findIndex(t=>t.uuid===e.userData.uuid);if("Mesh"===e.type){let l=e;l.material.color=-1===t?l.material.originalColor:i}else e.traverse(e=>{if("Mesh"===e.type){let l=e;l.material.color=-1===t?l.material.originalColor:i}})},O=()=>{y&&t(u,y.uuid,y.label)},T=e=>{let t=g(u,e);if(t){if(x.push({uuid:e,label:t.userData.label}),k(t,!0),"Mesh"===t.type){let l=t;l.material.color=i}else t.traverse(e=>{if("Mesh"===e.type){let t=e;t.material.color=i}})}},M=e=>{let t=g(u,e),l=x.findIndex(t=>t.uuid===e);if(-1!==l&&(x=[...x.slice(0,l),...x.slice(l+1)]),t){if(E(t,!0),"Mesh"===t.type){let i=t;i.material.color=i.material.originalColor}else t.traverse(e=>{if("Mesh"===e.type){let t=e;t.material.color=t.material.originalColor}});t.visible=!0}};return{load:n}},te=()=>({type:R.ENABLE}),tt=()=>({type:R.DISABLE}),tl=e=>({type:R.SETTYPE,value:e}),ti=e=>({type:R.SETPART,value:e}),tn=e=>{let{uuid:t,label:l}=e;return{type:R.HIGHLIGHT,value:{uuid:t,label:l}}},ta=()=>({type:R.UNHIGHLIGHT}),ts=e=>{let{uuid:t,label:l}=e;return{type:R.SELECT,value:{uuid:t,label:l}}},tr=e=>{let{uuid:t,label:l}=e;return{type:R.UNSELECT,value:{uuid:t,label:l}}},to=e=>({type:R.SETPOINT,value:e});var td=l(5094);let tu={load:"Error while loading part",snapshot:"Error while taking snapshot",saveScreenshot:"Unable to save screenshot"},tc=!1,tm=e=>{let t=new eF.ZzF;e.children.forEach(e=>{if(e.visible&&"Part"===e.type){let l=e.boundingBox,i=new eF.Pa4(Math.min(t.min.x,l.min.x),Math.min(t.min.y,l.min.y),Math.min(t.min.z,l.min.z)),n=new eF.Pa4(Math.max(t.max.x,l.max.x),Math.max(t.max.y,l.max.y),Math.max(t.max.z,l.max.z));t.set(i,n)}});let l=new eF.aLr;t.getBoundingSphere(l),e.boundingBox=t,e.boundingSphere=l},th=(e,t,l)=>{let i=t.object.position.distanceTo(t.target),n=t.target.clone().sub(e.position).normalize().multiplyScalar(i*l*.01);e.position.add(n)},tp=(e,t)=>{th(e,t,1);let l=()=>tp(e,t);i=requestAnimationFrame(l)},ty=(e,t)=>{th(e,t,-1);let l=()=>ty(e,t);i=requestAnimationFrame(l)},tx=()=>{i&&cancelAnimationFrame(i),i=void 0},tv=(e,t,l)=>{let i=e.children.find(e=>"Part"===e.type);if(!i)return;tc=!0;let n=e.boundingSphere,a=n.center,s=2*n.radius,r=s/(2*Math.atan(Math.PI*t.fov/360)),o=r/t.aspect,d=1.1*Math.max(r,o),u=l.target.clone().sub(t.position).normalize().multiplyScalar(d);l.target.copy(a),l.minDistance=d/10,l.maxDistance=10*d,t.position.copy(a).sub(u),t.near=d/100,t.far=100*d,t.updateProjectionMatrix()},tf=async(e,t,l,i,n,a,s)=>{let r=(e,t,l,i)=>{t?(e.highlight(t),setTimeout(()=>s(tn({uuid:t,label:l})),1)):i?s(to({x:i.x,y:i.y,z:i.z})):(e.unhighlight(),setTimeout(()=>s(ta()),1))},o=(e,t,l)=>{let i=e.getSelected();i.find(e=>e.uuid===t)?(e.unselect(t),setTimeout(()=>s(tr({uuid:t,label:l})),1)):(e.select(t),setTimeout(()=>s(ts({uuid:t,label:l})),1))},d=e9(r,o),u=await d.load(e,n.transparent,n.displayMesh,a.sectionViewHelper.getClippingPlane());s(ti(u)),t.add(u),tm(t),tc||tv(t,l,i),a.gridHelper.update(),a.gridHelper.update(),a.gridHelper.setVisible(!0),u.children[0].userData.lut?(a.colorbarHelper.setLUT(u.children[0].userData.lut),a.colorbarHelper.setVisible(!0)):a.colorbarHelper.setVisible(!1),a.pointHelper.build()},tg=(e,t)=>{e.setVisible(t)},tj=async(e,t,l,i)=>{try{let n=i.domElement.width,a=i.domElement.height,s=l.aspect;i.domElement.width=520,i.domElement.height=312,l.aspect=520/312,l.updateProjectionMatrix(),i.clear(),i.setViewport(0,0,520,312),i.render(t,l);let r=i.domElement.toDataURL();i.domElement.width=n,i.domElement.height=a,l.aspect=s,l.updateProjectionMatrix(),await td.Z.add({name:"snapshot",uid:"snapshot_"+(0,eI.Z)(),data:r},{id:e.id})}catch(o){(0,E.lt)(tu.snapshot,o)}},tb=(e,t,l,i)=>{try{let n=i.domElement.width,a=i.domElement.height;i.clear(),i.setViewport(0,0,n,a),i.render(t,l);let s=i.domElement.toDataURL(),r=document.createElement("a");r.href=s.replace("image/png","image/octet-stream"),r.download=e.title+"_"+new Date().toLocaleDateString()+".png",r.click()}catch(o){(0,E.lt)(tu.saveScreenshot,o)}},tw=e=>{let{loading:t,project:l,part:i}=e,n=(0,c.useRef)(null),a=(0,c.useRef)(),s=(0,c.useRef)(),o=(0,c.useRef)(),d=(0,c.useRef)(),y=(0,c.useRef)(),v=(0,c.useRef)(),f=(0,c.useRef)(),g=(0,c.useRef)(),j=(0,c.useRef)(),b=(0,c.useRef)(),w=(0,c.useRef)(),[C,S]=(0,c.useState)(!1),[k,P]=(0,c.useState)(!0),[N,O]=(0,c.useState)(!1),[T,M]=(0,c.useState)(!1),[z,A]=(0,c.useState)(!1),L=(0,u.useRouter)(),{enabled:R,part:F,highlighted:I,selected:U,point:B,type:V,dispatch:H}=(0,c.useContext)(D);(0,c.useEffect)(()=>{let e;if(!eG.Z.isWebGLAvailable()){L.push("/webgl");return}let t=n.current,l=t.clientWidth,i=t.clientHeight;a.current=new eF.xsS,a.current.boundingBox=new eF.ZzF,a.current.boundingSphere=new eF.aLr,s.current=new eF.cPb(50,l/i,.1,1e3),s.current.position.z=10;let r=new eF.Mig("#aaa",.75);a.current.add(r);let u=new eF.cek("#fff",.5);u.decay=2,s.current.add(u),a.current.add(s.current),o.current=new eF.CP7({antialias:!0,alpha:!0}),o.current.setClearColor("#ffffff"),o.current.setSize(l,i),o.current.setPixelRatio(window.devicePixelRatio||1),o.current.shadowMap.enabled=!0,o.current.autoClear=!1,t.appendChild(o.current.domElement);let c=new eB.C(a.current,s.current);d.current=new eV.f(new eF.FM8(l,i),a.current,s.current),d.current.visibleEdgeColor.set("#FAD114"),d.current.hiddenEdgeColor.set("#FAD114"),y.current=new eH.xC(o.current),y.current.addPass(c),y.current.addPass(d.current),v.current=new eU.$(s.current,t),v.current.rotateSpeed=3,v.current.panSpeed=.1;let m=eW(o.current,s.current,{offsetWidth:l-155,offsetHeight:i-155,width:150,height:150}),h=eX(o.current,a.current,s.current,v.current,{offsetWidth:l-155,offsetHeight:i-155,width:150,height:150});f.current=e_(o.current,a.current,s.current,v.current),g.current=eK(o.current,a.current,s.current,v.current),j.current=eQ(o.current,a.current,s.current,v.current),b.current=e0(o.current),b.current.setVisible(!1),w.current=e1(a.current);let p=()=>{v.current.update(),o.current.setViewport(0,0,l,i),o.current.render(a.current,s.current),f.current.update(),y.current.render(),m.render(),h.render(),b.current.render()},x=()=>{l=t.clientWidth,i=t.clientHeight,s.current.aspect=l/i,s.current.updateProjectionMatrix(),o.current.setSize(l,i),y.current.setSize(l,i),m.resize({newOffsetWidth:l-155,newOffsetHeight:i-155,newWidth:150,newHeight:150}),h.resize({newOffsetWidth:l-155,newOffsetHeight:i-155,newWidth:150,newHeight:150}),p()},Z=()=>{C(),p(),e=requestAnimationFrame(Z)},C=()=>{cancelAnimationFrame(e)};return window.addEventListener("resize",x),e=requestAnimationFrame(Z),()=>{C(),tc=!1,window.removeEventListener("resize",x),t.removeChild(o.current.domElement),a.current.children.forEach(e=>{a.current.remove(e)}),m.dispose(),h.dispose(),f.current.dispose(),j.current.dispose(),g.current.dispose(),b.current.dispose(),w.current.dispose()}},[L]),(0,c.useEffect)(()=>{if(!a.current)return;let e=a.current.children.find(e=>"Part"===e.type&&e.uuid===(null==i?void 0:i.summary.uuid));if(!e){if(a.current.children.forEach(e=>{"Part"===e.type&&(a.current.remove(e),e.dispose())}),i)tf(i,a.current,s.current,v.current,{transparent:C,displayMesh:k},{gridHelper:f.current,sectionViewHelper:j.current,colorbarHelper:b.current,pointHelper:w.current},H).catch(e=>{(0,E.lt)(tu.load,e),tm(a.current)});else{var t;tm(a.current),f.current.update(),null===(t=w.current)||void 0===t||t.build()}}},[i,C,k,H]),(0,c.useEffect)(()=>{if(a.current){if((null==i?void 0:i.summary.dimension)===2){tm(a.current);let e=new eF.Pa4(0,0,1),t=new eF.Pa4(0,1,0),l=new eF.Pa4;a.current.boundingBox.getCenter(l);let n=s.current.position.distanceTo(v.current.target),r=e.clone().multiplyScalar(n),o=l.add(r);s.current.position.copy(o),s.current.up.copy(t),v.current.noRotate=!0}else v.current.noRotate=!1}},[i]),(0,c.useEffect)(()=>{a.current&&a.current.children.forEach(e=>{"Part"===e.type&&e.uuid===(null==F?void 0:F.uuid)&&(R?e.startSelection(o.current,s.current,d.current,V):e.stopSelection())})},[R,F,V]),(0,c.useEffect)(()=>{a.current&&a.current.children.forEach(e=>{if("Part"===e.type&&e.uuid===(null==F?void 0:F.uuid)){e.highlight(null==I?void 0:I.uuid);let t=e.getSelected(),l=U.filter(e=>!t.find(t=>t.uuid===e.uuid));l.forEach(t=>{t.uuid&&e.select(t.uuid)});let i=t.filter(e=>!U.find(t=>t.uuid===e.uuid));i.forEach(t=>{e.unselect(t.uuid)})}})},[F,I,U]),(0,c.useEffect)(()=>{var e;a.current&&(null===(e=w.current)||void 0===e||e.update(B?new eF.Pa4(B.x,B.y,B.z):void 0))},[B]);let G=(0,c.useCallback)(e=>{S(e),a.current.children.forEach(t=>{"Part"===t.type&&t.setTransparent(e)})},[]),Y=(0,c.useCallback)(e=>{P(e),a.current.children.forEach(t=>{"Part"===t.type&&t.setDisplayMesh(e)})},[]),J=(0,c.useCallback)(()=>{let e=!N;O(e),e?j.current.start():j.current.stop()},[N]);return(0,r.jsxs)(h.Z,{className:"View no-scroll",children:[(0,r.jsx)(h.Z.Header,{className:"View-header",children:(0,r.jsxs)("div",{className:"View-controls-main",children:[(0,r.jsx)(m.Z,{title:"Take snasphot",placement:"right",children:(0,r.jsx)(ew.Z,{placement:"bottom",overlay:(0,r.jsx)(p.Z,{items:[{key:"project",label:(0,r.jsx)(x.Z,{type:"text",loading:T,async onClick(){M(!0);try{await tj(l,a.current,s.current,o.current)}finally{M(!1)}},children:"Project snapshot"})},{key:"image",label:(0,r.jsx)(x.Z,{type:"text",loading:z,onClick(){A(!0);try{tb(l,a.current,s.current,o.current)}finally{A(!1)}},children:"Export image"})}]}),children:(0,r.jsx)(x.Z,{icon:(0,r.jsx)(ek.Z,{})})})}),(0,r.jsx)(eZ.Z,{className:"no-margin"}),(0,r.jsx)(m.Z,{title:"Display grid",placement:"right",children:(0,r.jsx)(eC.Z,{defaultChecked:!0,checkedChildren:(0,r.jsx)(eE.Z,{}),unCheckedChildren:(0,r.jsx)(eE.Z,{}),onChange:e=>tg(f.current,e)})}),(0,r.jsx)(m.Z,{title:"Set transparency",placement:"right",children:(0,r.jsx)(eC.Z,{checked:C,checkedChildren:(0,r.jsx)(eP.Z,{}),unCheckedChildren:(0,r.jsx)(eP.Z,{}),onChange:G})}),(0,r.jsx)(eZ.Z,{className:"no-margin"}),(0,r.jsx)(m.Z,{title:"Zoom out",placement:"right",children:(0,r.jsx)(x.Z,{icon:(0,r.jsx)(eN.Z,{}),onMouseDown:()=>ty(s.current,v.current),onMouseUp:tx,onMouseOut:tx})}),(0,r.jsx)(m.Z,{title:"Zoom to fit",placement:"right",children:(0,r.jsx)(x.Z,{icon:(0,r.jsx)(eO.Z,{}),onClick:()=>tv(a.current,s.current,v.current)})}),(0,r.jsx)(m.Z,{title:"Zoom in",placement:"right",children:(0,r.jsx)(x.Z,{icon:(0,r.jsx)(eT.Z,{}),onMouseDown:()=>tp(s.current,v.current),onMouseUp:tx,onMouseOut:tx})}),(0,r.jsx)(m.Z,{title:"Zoom to selection",placement:"right",children:(0,r.jsx)(x.Z,{icon:(0,r.jsx)(eM.Z,{}),onClick:()=>g.current.isEnabled()?g.current.end():g.current.start()})}),(0,r.jsx)(eZ.Z,{className:"no-margin"}),!N&&(0,r.jsx)(m.Z,{title:"Section view",placement:"right",children:(0,r.jsx)(x.Z,{icon:(0,r.jsx)(ez.Z,{}),onClick:J})}),N&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(m.Z,{title:"Stop",placement:"left",children:(0,r.jsx)(x.Z,{icon:(0,r.jsx)(eA.Z,{}),onClick:J})}),(0,r.jsx)(m.Z,{title:"Hide plane",placement:"left",children:(0,r.jsx)(x.Z,{icon:(0,r.jsx)(eL.Z,{}),onClick:()=>j.current.toggleVisible()})}),(0,r.jsx)(m.Z,{title:"Snap to X",placement:"left",children:(0,r.jsx)(x.Z,{className:"ant-btn-icon-only",onClick:()=>j.current.toAxis(new eF.Pa4(-1,0,0)),children:"X"})}),(0,r.jsx)(m.Z,{title:"Snap to Y",placement:"left",children:(0,r.jsx)(x.Z,{className:"ant-btn-icon-only",onClick:()=>j.current.toAxis(new eF.Pa4(0,-1,0)),children:"Y"})}),(0,r.jsx)(m.Z,{title:"Snap to Z",placement:"left",children:(0,r.jsx)(x.Z,{className:"ant-btn-icon-only",onClick:()=>j.current.toAxis(new eF.Pa4(0,0,-1)),children:"Z"})}),(0,r.jsx)(m.Z,{title:"Flip",placement:"left",children:(0,r.jsx)(x.Z,{onClick:()=>j.current.flip(),icon:(0,r.jsx)(eR.Z,{})})})]}),(0,r.jsx)(eZ.Z,{className:"no-margin"}),(0,r.jsx)(m.Z,{title:"Display mesh",placement:"right",children:(0,r.jsx)(eC.Z,{checked:k,checkedChildren:(0,r.jsx)(eD.Z,{}),unCheckedChildren:(0,r.jsx)(eD.Z,{}),onChange:Y})})]})}),(0,r.jsxs)(h.Z.Content,{className:"View-content no-scroll",children:[(0,r.jsx)("div",{style:{display:t?"flex":"none"},className:"View-loading",children:(0,r.jsx)(eS.Z,{indicator:(0,r.jsx)(Z.Z,{className:"View-loading-spin",style:{fontSize:80},spin:!0})})}),(0,r.jsx)("div",{ref:n,className:"View-canvas"})]})]})},tZ={part:"Unable to load part"},tC=async(e,t,l)=>{try{if("geometry"===l)return await K.getPart({id:t.id});return await eb.load({id:e.id},{originPath:t.originPath,glb:t.glb})}catch(i){throw(0,E.lt)(tZ.part,i),i}},tS=e=>{let{project:t,simulation:l,geometry:i,result:n,postprocessing:a}=e,[s,o]=(0,c.useState)(),[d,u]=(0,c.useState)(),[m,h]=(0,c.useState)(!1);return(0,c.useEffect)(()=>{l&&a?a.glb!==(null==d?void 0:d.glb)&&(u(a),h(!0),tC(l,a,"result").then(e=>o(e)).catch(e=>void 0).finally(()=>h(!1))):l&&n?n.glb!==(null==d?void 0:d.glb)&&(u(n),h(!0),tC(l,n,"result").then(e=>o(e)).catch(e=>void 0).finally(()=>h(!1))):i&&i.id!==(null==d?void 0:d.id)&&(u(i),h(!0),i.needCleanup?(o(void 0),h(!1)):tC(void 0,i,"geometry").then(e=>o(e)).catch(e=>void 0).finally(()=>h(!1)))},[l,i,n,a,d]),(0,r.jsx)(tw,{loading:m,project:{id:t.id,title:t.title},part:s})};var tk=l(40038),tE=l(67040),tP=l(90575),tN=l(23389),tO=l(93398),tT=l(96486),tM=l(52402),tz=l(64376),tA=l(10843),tL=l(14670),tR=l(57132);let tD={copy:"Unable to copy simulation"},tF=async(e,t,l)=>{try{let i=tz.Z.deepCopy(t.scheme);i.configuration.run.done=!1,i.configuration.run.error=void 0;let n=await V.Z.add({id:e.id},{name:t.name+" (copy)",scheme:i});l.addOneSimulation(n),l.mutateProject({id:e.id,simulations:[...e.simulations,n.id]})}catch(a){(0,E.lt)(tD.copy,a)}},tI=e=>{let{project:t,simulation:l,swr:i}=e,[n,a]=(0,c.useState)(!1);return(0,r.jsx)(m.Z,{title:"Copy simulation",children:(0,r.jsx)(x.Z,{className:"no-border",loading:n,icon:(0,r.jsx)(tR.Z,{}),async onClick(){a(!0);try{await tF(t,l,i)}finally{a(!1)}}})})},tU={update:"Unable to update simulation"},tB=async(e,t,l)=>{try{await V.Z.update({id:e.id},[{key:"name",value:t.name}]),l.mutateOneSimulation({id:e.id,name:t.name})}catch(i){throw(0,E.lt)(tU.update,i),i}},tV=e=>{let{simulation:t,swr:l}=e,[i,n]=(0,c.useState)(!1),[a,s]=(0,c.useState)(!1);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(k.w6,{onEdit:()=>n(!0)}),(0,r.jsx)(el.ZP,{title:"Edit the simulation's name",visible:i,initialValues:{name:t.name},onCancel:()=>n(!1),async onOk(e){s(!0);try{await tB(t,e,l),s(!1),n(!1)}catch(i){throw s(!1),i}},loading:a,children:(0,r.jsx)(ed.Z.Item,{name:"name",label:"Name:",rules:[{required:!0,message:"Name is required"}],children:(0,r.jsx)(eu.Z,{})})})]})},tH={del:"Unable to delete simulation"},tG=async(e,t,l)=>{try{await V.Z.del(t);let i=e.simulations.filter(e=>e!==t.id);l.mutateProject({id:e.id,simulations:i}),l.delOneSimulation({id:t.id})}catch(n){throw(0,E.lt)(tH.del,n),n}},tY=e=>{let{project:t,simulation:l,swr:i}=e,[n,a]=(0,c.useState)(!1);return(0,r.jsx)(k.m1,{loading:n,text:(0,r.jsxs)(r.Fragment,{children:["Are you sure you want to delete the simulation"," ",(0,r.jsx)(y.Z.Text,{strong:!0,children:l.name}),"?"]}),async onDelete(){a(!0);try{await tG(t,l,i)}finally{a(!1)}}})},tJ=e=>{let{project:t,simulation:l,swr:i}=e;return t&&l?(0,r.jsx)(h.Z,{children:(0,r.jsx)(h.Z.Content,{children:(0,r.jsx)(N.Z,{size:"small",title:(0,r.jsx)(y.Z.Title,{level:5,ellipsis:!0,children:l.name}),actions:[(0,r.jsx)(tI,{project:{id:t.id,simulations:t.simulations},simulation:l,swr:{mutateProject:i.mutateProject,addOneSimulation:i.addOneSimulation}},"copy"),(0,r.jsx)(tV,{simulation:{id:l.id,name:l.name},swr:{mutateOneSimulation:i.mutateOneSimulation}},"edit"),(0,r.jsx)(tY,{project:{id:t.id,simulations:t.simulations},simulation:{id:l.id,name:l.name},swr:{mutateProject:i.mutateProject,delOneSimulation:i.delOneSimulation}},"delete")],children:(0,r.jsxs)(O.Z,{direction:"vertical",className:"full-width",children:[l.scheme.user&&(0,r.jsx)(tL.Z,{message:"User algorithm",type:"info",showIcon:!0}),(0,r.jsxs)(y.Z.Text,{children:[(0,r.jsx)("span",{className:"text-light",children:"Category:"})," ",l.scheme.category]}),(0,r.jsxs)(y.Z.Text,{children:[(0,r.jsx)("span",{className:"text-light",children:"Algorithm:"})," ",l.scheme.algorithm]}),(0,r.jsxs)(y.Z.Text,{children:[(0,r.jsx)("span",{className:"text-light",children:"Code:"})," ",l.scheme.code]}),(0,r.jsxs)(y.Z.Text,{children:[(0,r.jsx)("span",{className:"text-light",children:"Version:"})," ",l.scheme.version]}),(0,r.jsx)("div",{className:"full-wdith scroll",children:(0,r.jsx)(ee.Z.Html,{html:l.scheme.description})})]})})})}):(0,r.jsx)(N.Z,{children:(0,r.jsx)(eS.Z,{})})};var tW=l(32808);let tX=e=>{let{label:t,className:l,defaultValue:i,defaultChecked:n,onValueChange:a,onCheckedChange:s,unit:o}=e,[d,u]=(0,c.useState)(String(null!=i?i:0)),[m,h]=(0,c.useState)(!!n),[p,y]=(0,c.useState)(void 0!==n&&!n),[x,v]=(0,c.useState)(0),[g,j]=(0,c.useState)(!1);(0,c.useEffect)(()=>{u(String(null!=i?i:0))},[i]),(0,c.useEffect)(()=>{h(!!n)},[n]);let b=(0,c.useCallback)(e=>{let t=e.target.checked;h(t),j(!0),null==s||s(t),y(!t)},[s]),w=(0,c.useCallback)(e=>{x&&clearTimeout(x);let t=setTimeout(()=>{a(e),j(!1)},500);v(+t)},[x,a]),C=(0,c.useCallback)(e=>{let t=e.target.value;u(t),j(!0),w(t)},[w]);return(0,r.jsx)(O.Z,{className:"full-width space-full-width "+l,align:"start",children:(0,r.jsx)(ed.Z,{layout:"vertical",children:(0,r.jsx)(ed.Z.Item,{label:(0,r.jsxs)(r.Fragment,{children:[void 0!==n&&(0,r.jsx)(tW.Z,{checked:m,onChange:b,style:{marginRight:"5px"}}),t]}),children:(0,r.jsx)(eu.Z,{disabled:p,value:d,onChange:C,addonAfter:(0,r.jsxs)(O.Z,{className:"full-width",children:[(0,r.jsx)(ee.Z.Inline,{text:o}),g?(0,r.jsx)(Z.Z,{spin:!0,className:"color-orange"}):(0,r.jsx)(f.Z,{className:"color-green"})]})})})})})},tq={update:"Unable to update simulation"},t_=async(e,t,l)=>{try{let i=tz.Z.deepCopy(e);i.scheme.configuration.geometry.meshParameters={type:t,value:"auto"===t?"normal":"1"};let n={...i.scheme.configuration.geometry,done:!0};await V.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","geometry"],value:n}]),await V.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","run"],value:{...i.scheme.configuration.run,done:!1}}]),l.mutateOneSimulation(i)}catch(a){throw(0,E.lt)(tq.update,a),a}},tK=async(e,t,l,i)=>{try{let n=tz.Z.deepCopy(e);n.scheme.configuration.geometry.meshParameters={...n.scheme.configuration.geometry.meshParameters,type:t,value:l};let a={...n.scheme.configuration.geometry,done:!0};await V.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","geometry"],value:a}]),await V.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","run"],value:{...n.scheme.configuration.run,done:!1}}]),i.mutateOneSimulation(n)}catch(s){throw(0,E.lt)(tq.update,s),s}},tQ=e=>{let{simulation:t,swr:l}=e,[i,n]=(0,c.useState)(),[a,s]=(0,c.useState)();(0,c.useEffect)(()=>{let e=t.scheme.configuration.geometry.meshParameters;e?(n(e.type),s(e.value)):(n("auto"),s("normal"))},[t]);let o=(0,c.useCallback)(async e=>{try{await tK(t,i,e,l),s(e)}catch(n){}},[t,i,l]);return(0,r.jsx)(N.Z,{size:"small",title:"Mesh refinement",children:(0,r.jsxs)(O.Z,{direction:"vertical",className:"full-width",children:[(0,r.jsx)(ed.Z,{layout:"vertical",children:(0,r.jsx)(ed.Z.Item,{label:"Type",children:(0,r.jsxs)(tk.Z,{className:"full-width",value:i,async onChange(e){try{await t_(t,e,l),n(e),"auto"===e?s("normal"):s("1")}catch(i){}},children:[(0,r.jsx)(tk.Z.Option,{value:"auto",children:"Automatic"}),(0,r.jsx)(tk.Z.Option,{value:"manual",children:"Manual"})]})})}),"auto"===i&&(0,r.jsx)(ed.Z,{layout:"vertical",children:(0,r.jsx)(ed.Z.Item,{label:"Size",children:(0,r.jsxs)(tk.Z,{className:"full-width",value:a,onChange:o,children:[(0,r.jsx)(tk.Z.Option,{value:"veryfine",children:"Very fine"}),(0,r.jsx)(tk.Z.Option,{value:"fine",children:"Fine"}),(0,r.jsx)(tk.Z.Option,{value:"normal",children:"Normal"}),(0,r.jsx)(tk.Z.Option,{value:"coarse",children:"Coarse"}),(0,r.jsx)(tk.Z.Option,{value:"verycoarse",children:"Very coarse"})]})})}),"manual"===i&&(0,r.jsx)(tX,{label:"Size",defaultValue:a,onValueChange:o,unit:"m"})]})})},t$={update:"Unable to update simulation"},t0=async(e,t,l,i,n)=>{try{var a;let s=tz.Z.deepCopy(e);s.scheme.configuration.geometry.value=l.id;let r={...s.scheme.configuration,dimension:null!==(a=l.summary.dimension)&&void 0!==a?a:3,geometry:{...s.scheme.configuration.geometry,done:!0},run:{...s.scheme.configuration.run,done:!1}};await V.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration"],value:r}]),n.mutateOneSimulation(s);let o=t.find(e=>e.id===l.id);i(o)}catch(d){(0,E.lt)(t$.update,d)}},t1=e=>{let{geometries:t,geometry:l,simulation:i,setGeometry:n,swr:a}=e,s=i.scheme.configuration.geometry.value;!s&&l&&t0(i,t,l,n,a);let o=t.map(e=>(0,r.jsx)("div",{className:"Geometry-list",style:{backgroundColor:e.id===(null==l?void 0:l.id)?"#FFFBE6":"#FAFAFA"},onClick:()=>t0(i,t,e,n,a),children:(0,r.jsx)(y.Z.Text,{children:e.name})},e.id));return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(N.Z,{size:"small",children:(0,r.jsx)(y.Z.Text,{children:"When changing the simulation domain, you might lose your topological entity assignments"})}),(0,r.jsx)(N.Z,{size:"small",children:(0,r.jsx)(y.Z.Text,{strong:!0,children:"Select a simulation domain"})}),o,i.scheme.configuration.geometry.meshable&&(0,r.jsx)(tQ,{simulation:{id:i.id,scheme:i.scheme},swr:{mutateOneSimulation:a.mutateOneSimulation}})]})},t2={update:"Unable to delete material"},t4=async(e,t,l,i)=>{try{let n=tz.Z.deepCopy(e),a=n.scheme.configuration.materials,s=a.values[t];s.selected.forEach(e=>{l(tr(e))}),a.values=[...a.values.slice(0,t),...a.values.slice(t+1)];let r={...a,done:!!a.values.length};await V.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","materials"],value:r}]),i.mutateOneSimulation(n)}catch(o){throw(0,E.lt)(t2.update,o),o}},t5=e=>{let{simulation:t,index:l,swr:i}=e,[n,a]=(0,c.useState)(!1),{dispatch:s}=(0,c.useContext)(D),o=t.scheme.configuration.materials,d=o.values[l];return(0,r.jsx)(k.m1,{loading:n,text:(0,r.jsxs)(r.Fragment,{children:["Are you sure you want to delete the material"," ",(0,r.jsx)(y.Z.Text,{strong:!0,children:d.material.label})]}),async onDelete(){a(!0);try{await t4(t,l,s,i)}finally{a(!1)}}})},t8=e=>{var t;let{simulation:l,swr:i,onEdit:n}=e,[a,s]=(0,c.useState)(!0),o=l.scheme.configuration.materials,{dispatch:d}=(0,c.useContext)(D),u=(0,c.useCallback)(e=>{d(te());let t=o.values[e].selected;null==t||t.forEach(e=>{d(ts(e))})},[o,d]),m=(0,c.useCallback)(()=>{d(tt())},[d]);return(0,r.jsx)(r.Fragment,{children:null===(t=o.values)||void 0===t?void 0:t.map((e,t)=>(0,r.jsx)(N.Z,{className:"material-item text-center",hoverable:!0,onMouseEnter:()=>u(t),onMouseLeave(){a&&m()},actions:[(0,r.jsx)(k.w6,{onEdit(){s(!1),n(t),setTimeout(()=>s(!0),500)}},"edit"),(0,r.jsx)(t5,{index:t,simulation:{id:l.id,scheme:l.scheme},swr:{mutateOneSimulation:i.mutateOneSimulation}},"delete")],children:(0,r.jsx)(y.Z.Text,{strong:!0,className:"text-center",children:e.material.label})},t)).filter(e=>e)})};var t3=l(63463),t6=l(20550),t7=l(13982),t9=l(14618),le=l(94668),lt=l(68795);let ll=e=>{var t;let{geometry:l,alreadySelected:i,updateSelected:n}=e,[a,s]=(0,c.useState)([]),[o,d]=(0,c.useState)(),[u,h]=(0,c.useState)(),{type:p,highlighted:v,selected:f,dispatch:g}=(0,c.useContext)(D);(0,c.useEffect)(()=>{n(f)},[n,f]),(0,c.useEffect)(()=>{var e;let t=[];p&&(null===(e=l.summary[p])||void 0===e||e.forEach(e=>{if(e.color){let l=t.find(t=>t.r===e.color.r&&t.g===e.color.g&&t.b===e.color.b);l||t.push(e.color)}})),s(t)},[l,p]);let j=e=>{g(tn(e))},b=()=>{g(ta())},w=e=>{f.find(t=>t.uuid===e.uuid)?g(tr(e)):g(ts(e))},Z=(0,c.useCallback)(e=>{d(e)},[]),C=()=>{var e;null===(e=l.summary[p])||void 0===e||e.forEach(e=>{var t,l,i;(!o||o&&o.r===(null===(t=e.color)||void 0===t?void 0:t.r)&&o.g===(null===(l=e.color)||void 0===l?void 0:l.g)&&o.b===(null===(i=e.color)||void 0===i?void 0:i.b))&&g(ts({uuid:e.uuid,label:e.label}))})},S=()=>{var e;null===(e=l.summary[p])||void 0===e||e.forEach(e=>{var t,l,i;(!o||o&&o.r===(null===(t=e.color)||void 0===t?void 0:t.r)&&o.g===(null===(l=e.color)||void 0===l?void 0:l.g)&&o.b===(null===(i=e.color)||void 0===i?void 0:i.b))&&g(tr({uuid:e.uuid,label:e.label}))})},k=()=>{var e;null===(e=l.summary[p])||void 0===e||e.forEach(e=>{var t,l,i;(!o||o&&o.r===(null===(t=e.color)||void 0===t?void 0:t.r)&&o.g===(null===(l=e.color)||void 0===l?void 0:l.g)&&o.b===(null===(i=e.color)||void 0===i?void 0:i.b))&&f.find(t=>t.uuid===e.uuid)?g(tr({uuid:e.uuid,label:e.label})):g(ts({uuid:e.uuid,label:e.label}))})},E=(0,c.useCallback)(e=>{let t=e.target.value;h(t)},[]),P=(0,c.useCallback)(e=>{var t,l,i;return(!o||o.r===(null===(t=e.color)||void 0===t?void 0:t.r)&&o.g===(null===(l=e.color)||void 0===l?void 0:l.g)&&o.b===(null===(i=e.color)||void 0===i?void 0:i.b))&&(!u||!e.name||!!e.name.includes(u))},[o,u]);return(0,r.jsxs)(N.Z,{size:"small",className:"no-border-bottom",children:[(0,r.jsxs)(O.Z,{direction:"vertical",className:"full-width",children:[(0,r.jsx)(y.Z.Text,{strong:!0,children:"Filters"}),(0,r.jsxs)(O.Z,{direction:"horizontal",wrap:!0,children:[a.length>1&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(m.Z,{title:"Reset",children:(0,r.jsx)(x.Z,{icon:(0,r.jsx)(Q.Z,{}),onClick:()=>Z()})}),a.map(e=>(0,r.jsx)(m.Z,{title:"Color",children:(0,r.jsx)(x.Z,{style:{backgroundColor:tz.Z.rgbToHex(e)},onClick:()=>Z(e),children:" "})},JSON.stringify(e)))]}),(0,r.jsx)(m.Z,{title:"Select all",children:(0,r.jsx)(x.Z,{icon:(0,r.jsx)(t7.Z,{}),onClick:C})}),(0,r.jsx)(m.Z,{title:"Unselect all",children:(0,r.jsx)(x.Z,{icon:(0,r.jsx)(t9.Z,{}),onClick:S})}),(0,r.jsx)(m.Z,{title:"Swap",children:(0,r.jsx)(x.Z,{icon:(0,r.jsx)(le.Z,{}),onClick:k})})]}),(0,r.jsx)(eu.Z,{placeholder:"Search",value:u,onChange:E,suffix:(0,r.jsx)(lt.Z,{className:"text-light"})})]}),(0,r.jsx)("div",{className:"full-width marginTop-20",children:p?null===(t=l.summary[p])||void 0===t?void 0:t.map((e,t)=>{if(P(e)){let l="transparent",n="transparent";return f.find(t=>t.uuid===e.uuid)&&(null==v?void 0:v.uuid)!==e.uuid?(l="#FAD114",n="rgba(255, 251, 230, 0.3)"):(null==v?void 0:v.uuid)===e.uuid&&(l="#FAD114",n="#FFFBE6"),(0,r.jsx)(N.Z,{className:"marginBottom-10",bodyStyle:{position:"relative",padding:"10px 10px 10px 40px",borderWidth:"2px",borderStyle:"solid",borderColor:l,backgroundColor:n},onMouseEnter:()=>j({uuid:e.uuid,label:e.label}),onMouseLeave:b,onClick:()=>w({uuid:e.uuid,label:e.label}),children:(0,r.jsxs)(O.Z,{direction:"vertical",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{style:{position:"absolute",left:"-2px",top:"-2px",bottom:"-2px",width:"30px",backgroundColor:tz.Z.rgbToRgba(e.color,1)}}),e.name]}),null==i?void 0:i.map(t=>{if(t.selected.find(t=>t.uuid===e.uuid))return(0,r.jsx)(t6.Z,{color:tz.Z.stringToColor(t.label),children:t.label},e.uuid)})]})},t)}}):[]})]})};var li=l(95507),ln=l(13520),la=l(23226);let ls=e=>{let{onSelect:t}=e,[l,i]=(0,c.useState)(),[n,a]=(0,c.useState)(),[s,o]=(0,c.useState)(),[d,u]=(0,c.useState)(),m=Object.keys(la.E),y=(0,c.useCallback)(e=>{let{key:t}=e,l=la.E[t];a({key:t,children:l.children}),o(void 0),u(void 0)},[]),v=(0,c.useCallback)(e=>{let{key:t}=e,l=la.E[n.key],i=l.children.find(e=>e.key===t);o({key:t}),u(i)},[n]),f=(0,c.useCallback)(e=>{t(e),i(!1)},[t]);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(x.Z,{icon:(0,r.jsx)(ln.Z,{}),onClick:()=>i(!0),className:"full-width",children:"Pick a material"}),(0,r.jsx)(tE.Z,{open:l,title:"Material database",onCancel:()=>i(!1),onOk:()=>f(d),okText:"Choose",okButtonProps:{disabled:!d},width:"50%",children:(0,r.jsx)(h.Z,{children:(0,r.jsx)(h.Z.Content,{children:(0,r.jsxs)(O.Z,{style:{alignItems:"stretch"},children:[(0,r.jsx)(p.Z,{mode:"inline",items:m.map(e=>({key:e,label:la.E[e].label})),onClick:y}),(0,r.jsx)(p.Z,{mode:"inline",items:null==n?void 0:n.children.map(e=>({key:e.key,label:e.label})),selectedKeys:(null==s?void 0:s.key)?[null==s?void 0:s.key]:[],onClick:v}),d&&(0,r.jsx)(li.ZP,{itemLayout:"vertical",children:d.children.map(e=>(0,r.jsxs)(li.ZP.Item,{children:[e.label,": ",e.symbol," = ",e.value]},e.label))})]})})})})]})},lr={material:"You need to define a material",selected:"You need to select a solid",update:"Unable to add material"},lo=async(e,t,l)=>{try{let i=tz.Z.deepCopy(t);i.uuid=(0,eI.Z)();let n=tz.Z.deepCopy(e),a=n.scheme.configuration.materials;a.values=[...a.values||[],i];let s={...a,done:!0};await V.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","materials"],value:s}]),await V.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","run"],value:{...n.scheme.configuration.run,done:!1}}]),l.mutateOneSimulation(n)}catch(r){throw(0,E.lt)(lr.update,r),r}},ld=e=>{let{simulation:t,material:l,swr:i,onError:n,onClose:a}=e,[s,o]=(0,c.useState)(!1);return(0,r.jsx)(k.HS,{loading:s,needMargin:!0,async onAdd(){o(!0);try{var e;if(!l.material){n(lr.material),o(!1);return}if(!(null===(e=l.selected)||void 0===e?void 0:e.length)){n(lr.selected),o(!1);return}n(),await lo(t,l,i),o(!1),a()}catch(s){o(!1)}},children:"Add"})},lu={material:"You need to define a material",selected:"You need to select a solid",update:"Unable to edit material"},lc=async(e,t,l)=>{try{let i=tz.Z.deepCopy(e),n=i.scheme.configuration.materials,a=n.values.findIndex(e=>e.uuid===t.uuid);n.values=[...n.values.slice(0,a),t,...n.values.slice(a+1)];let s={...n};await V.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","materials"],value:s}]),l.mutateOneSimulation(i)}catch(r){throw(0,E.lt)(lu.update,r),r}},lm=e=>{let{simulation:t,material:l,swr:i,onError:n,onClose:a}=e,[s,o]=(0,c.useState)(!1);return(0,r.jsx)(k.w6,{loading:s,primary:!0,needMargin:!0,async onEdit(){o(!0);try{var e;if(!l.material){n(lu.material),o(!1);return}if(!(null===(e=l.selected)||void 0===e?void 0:e.length)){n(lu.selected),o(!1);return}n(),await lc(t,l,i),o(!1),a()}catch(s){o(!1)}},children:"Edit"})},lh=e=>{var t,l,i,n,a,s;let{visible:o,geometry:d,simulation:u,material:m,swr:h,onClose:p}=e,[v,f]=(0,c.useState)(),[g,b]=(0,c.useState)(),[w,Z]=(0,c.useState)(),C=u.scheme.configuration.materials;(0,c.useEffect)(()=>{!o&&g&&b(void 0)}),(0,c.useEffect)(()=>{o&&!g&&m&&b(m)},[g,o,m]),(0,c.useEffect)(()=>{var e;let t=null==C?void 0:null===(e=C.values)||void 0===e?void 0:e.map(e=>{if(e.uuid!==(null==m?void 0:m.uuid))return{label:e.material.label,selected:e.selected}}).filter(e=>e);f(t||[])},[u,m,C]);let S=(0,c.useCallback)(e=>{b(t=>({...t,material:e}))},[]),E=(0,c.useCallback)(e=>{b(t=>({...t,selected:e}))},[]),P=(0,c.useCallback)((e,t,l)=>{b(i=>{var n,a,s,r;return{...i,material:{label:"Custom",children:[...(null==i?void 0:null===(n=i.material)||void 0===n?void 0:null===(a=n.children)||void 0===a?void 0:a.slice(0,t))||[],{label:e.label,symbol:e.name,value:l},...(null==i?void 0:null===(s=i.material)||void 0===s?void 0:null===(r=s.children)||void 0===r?void 0:r.slice(t+1))||[]]}}})},[]);return(0,r.jsx)(t3.Z,{className:"material",title:"Material",placement:"left",closable:!1,open:o,mask:!1,maskClosable:!1,width:300,extra:(0,r.jsx)(x.Z,{type:"text",icon:(0,r.jsx)(Q.Z,{}),onClick(){b(void 0),p()}}),footer:(0,r.jsxs)("div",{style:{display:"flex",justifyContent:"flex-end"},children:[(0,r.jsx)(k.Lw,{onCancel(){b(void 0),p()}}),m?(0,r.jsx)(lm,{material:{uuid:null!==(i=null==g?void 0:g.uuid)&&void 0!==i?i:m.uuid,material:null!==(n=null==g?void 0:g.material)&&void 0!==n?n:m.material,selected:null!==(a=null==g?void 0:g.selected)&&void 0!==a?a:m.selected},simulation:{id:u.id,scheme:u.scheme},swr:{mutateOneSimulation:h.mutateOneSimulation},onError:e=>Z(e),onClose:p}):(0,r.jsx)(ld,{material:{material:null==g?void 0:g.material,selected:null==g?void 0:g.selected},simulation:{id:u.id,scheme:u.scheme},swr:{mutateOneSimulation:h.mutateOneSimulation},onError:e=>Z(e),onClose:p})]}),children:(0,r.jsxs)(O.Z,{direction:"vertical",className:"full-width",children:[(0,r.jsx)(N.Z,{size:"small",children:(0,r.jsxs)(O.Z,{direction:"vertical",className:"full-width",children:[(0,r.jsx)(ls,{onSelect:S}),(0,r.jsxs)(y.Z.Text,{children:["Material: ",null!==(s=null==g?void 0:null===(t=g.material)||void 0===t?void 0:t.label)&&void 0!==s?s:"default"]}),null==C?void 0:null===(l=C.children)||void 0===l?void 0:l.map((e,t)=>{var l,i;let n=null==g?void 0:null===(l=g.material)||void 0===l?void 0:null===(i=l.children)||void 0===i?void 0:i.find(t=>t.symbol===e.name);return(0,r.jsx)(tX,{label:e.name,defaultValue:n?n.value:String(e.default),unit:e.unit,onValueChange(l){P(e,t,l)}},e.name)})]})}),(0,r.jsx)(ll,{geometry:d,alreadySelected:v,updateSelected:E}),w&&(0,r.jsxs)(y.Z.Text,{children:[(0,r.jsx)(j.Z,{style:{color:"red"}})," ",w]})]})})},lp=e=>{let{geometry:t,simulation:l,swr:i,setVisible:n}=e,[a,s]=(0,c.useState)(),[o,d]=(0,c.useState)(!1),{dispatch:u}=(0,c.useContext)(D),m=l.scheme.configuration.materials;(0,c.useEffect)(()=>{(null==t?void 0:t.summary)&&u(tl(2===t.summary.dimension?"faces":"solids"))},[t,u]);let p=(0,c.useCallback)(()=>{s(void 0),d(!0),n(!1),u(te())},[u,n]),y=(0,c.useCallback)(e=>{let t=m.values[e];s(t),d(!0),n(!1),u(te())},[m,u,n]),x=(0,c.useCallback)(()=>{u(tt()),d(!1),s(void 0),n(!0)},[u,n]);return t?(0,r.jsx)(h.Z,{children:(0,r.jsx)(h.Z.Content,{children:(0,r.jsxs)(N.Z,{size:"small",children:[(0,r.jsx)(k.HS,{onAdd:p,fullWidth:!0,primary:!1,children:"Add material"}),(0,r.jsx)(t8,{simulation:{id:l.id,scheme:l.scheme},swr:i,onEdit:y}),(0,r.jsx)(lh,{visible:o,geometry:{summary:t.summary},simulation:{id:l.id,scheme:l.scheme},material:a&&{uuid:a.uuid,material:a.material,selected:a.selected},swr:{mutateOneSimulation:i.mutateOneSimulation},onClose:x})]})})}):(0,r.jsx)(P.Z.Simple,{})};var ly=l(54907);let lx={update:"Unable to update simulation"},lv=(e,t,l)=>(0,r.jsx)(tX,{label:t.label2D||t.label,defaultValue:null!==(n=t.value)&&void 0!==n?n:t.default,onValueChange:l,unit:t.unit},e),lf=(e,t,l)=>{var i;return(0,r.jsx)(ed.Z,{layout:"vertical",children:(0,r.jsx)(ed.Z.Item,{label:t.label2D||t.label,children:(0,r.jsx)(tk.Z,{options:null===(i=t.options)||void 0===i?void 0:i.map(e=>({label:e.label,value:null!==(a=e.value2D)&&void 0!==a?a:e.value})),defaultValue:t.value||t.default2D||t.default,onChange:l})})},e)},lg=(e,t,l)=>(0,r.jsx)(ed.Z,{layout:"horizontal",children:(0,r.jsx)(ed.Z.Item,{label:t.label2D||t.label,children:(0,r.jsx)(tW.Z,{defaultChecked:t.value,onChange:l})})},e),lj=(e,t,l)=>(0,r.jsx)(tX,{label:t.label,defaultValue:null!==(s=t.value)&&void 0!==s?s:t.default,onValueChange:l,unit:t.unit},e),lb=(e,t,l)=>(0,r.jsx)(ed.Z,{layout:"vertical",children:(0,r.jsx)(ed.Z.Item,{label:t.label,children:(0,r.jsx)(tk.Z,{options:t.options,defaultValue:t.value||t.default,onChange:l})})},e),lw=(e,t,l)=>(0,r.jsx)(ed.Z,{layout:"horizontal",children:(0,r.jsx)(ed.Z.Item,{label:t.label,children:(0,r.jsx)(tW.Z,{defaultChecked:t.value,onChange:l})})},e),lZ=async(e,t)=>{try{let l=tz.Z.deepCopy(e),i=l.scheme.configuration.parameters,n={...i,done:!0};await V.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","parameters"],value:n}]),await V.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","run"],value:{...l.scheme.configuration.run,done:!1}}]),t.mutateOneSimulation(l)}catch(a){(0,E.lt)(lx.update,a)}},lC=async(e,t,l,i,n)=>{try{let a=tz.Z.deepCopy(e),s=a.scheme.configuration.parameters,r=s[t];r.children[l].value=i;let o={...s,done:!0};await V.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","parameters"],value:o}]),await V.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","run"],value:{...a.scheme.configuration.run,done:!1}}]),n.mutateOneSimulation(a)}catch(d){(0,E.lt)(lx.update,d)}},lS=e=>{let{simulation:t,swr:l}=e,i=null==t?void 0:t.scheme.configuration.parameters,n=null==t?void 0:t.scheme.configuration.dimension;(0,c.useEffect)(()=>{(null==i?void 0:i.done)||lZ(t,l)},[t,i,l]);let a=[],s=[];return 2===n?Object.keys(i).forEach(e=>{if("index"===e||"title"===e||"done"==e)return;let n=i[e],o=null==n?void 0:n.children.map((i,n)=>{if(!i.only3D){if("formula"===i.htmlEntity)return lv(e+"&"+n,i,i=>lC(t,e,n,i,l));if("select"===i.htmlEntity)return lf(e+"&"+n,i,i=>lC(t,e,n,i,l));if("checkbox"===i.htmlEntity)return lg(e+"&"+n,i,i=>lC(t,e,n,i.target.checked,l))}});(null==n?void 0:n.advanced)?s.push((0,r.jsx)(N.Z,{size:"small",title:null==n?void 0:n.label,children:(0,r.jsx)(O.Z,{direction:"vertical",children:o})},e)):a.push((0,r.jsx)(N.Z,{size:"small",title:null==n?void 0:n.label,children:(0,r.jsx)(O.Z,{direction:"vertical",children:o})},e))}):Object.keys(i).forEach(e=>{if("index"===e||"title"===e||"done"==e)return;let n=i[e],o=null==n?void 0:n.children.map((i,n)=>"formula"===i.htmlEntity?lj(e+"&"+n,i,i=>lC(t,e,n,i,l)):"select"===i.htmlEntity?lb(e+"&"+n,i,i=>lC(t,e,n,i,l)):"checkbox"===i.htmlEntity?lw(e+"&"+n,i,i=>lC(t,e,n,i.target.checked,l)):void 0);(null==n?void 0:n.advanced)?s.push((0,r.jsx)(N.Z,{size:"small",title:null==n?void 0:n.label,children:(0,r.jsx)(O.Z,{direction:"vertical",children:o})},e)):a.push((0,r.jsx)(N.Z,{size:"small",title:null==n?void 0:n.label,children:(0,r.jsx)(O.Z,{direction:"vertical",children:o})},e))}),(0,r.jsx)(h.Z,{children:(0,r.jsx)(h.Z.Content,{children:(0,r.jsxs)(O.Z,{direction:"vertical",children:[a,(0,r.jsx)(ly.Z,{children:(0,r.jsx)(ly.Z.Panel,{header:"Advanced",children:(0,r.jsx)(O.Z,{direction:"vertical",children:s})},"advanced")})]})})})},lk=(e,t)=>e.map(e=>{let l=e.fileName.replace(RegExp(t.prefixPattern),"").replace(RegExp(t.suffixPattern),"");return{...e,number:+l}}),lE=(e,t)=>{let l=t.multiplicator;if(l){var i;let n=l.reduce((e,t)=>e[t],e);return null!==(i=n.value)&&void 0!==i?i:n.default}},lP={update:"Unable to update simulation"},lN=async(e,t,l)=>{try{let i=tz.Z.deepCopy(e),n=i.scheme.configuration.initialization;n.value={type:t},await V.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","initialization"],value:n}]),l.mutateOneSimulation(i)}catch(a){throw(0,E.lt)(lP.update,a),a}},lO=async(e,t,l,i)=>{try{var n;let a=await lz(e,l),s=tz.Z.deepCopy(t),r=s.scheme.configuration.initialization;r.value={...r.value,simulation:l,result:null==a?void 0:null===(n=a[0])||void 0===n?void 0:n.value},await V.Z.update({id:t.id},[{key:"scheme",type:"json",method:"set",path:["configuration","initialization"],value:r}]),i.mutateOneSimulation(s)}catch(o){throw(0,E.lt)(lP.update,o),o}},lT=async(e,t,l,i)=>{try{let n=tz.Z.deepCopy(e),a=n.scheme.configuration.initialization;a.value={...a.value,number:+t,result:l.file},await V.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","initialization"],value:a}]),i.mutateOneSimulation(n)}catch(s){(0,E.lt)(lP.update,s)}},lM=async(e,t,l,i)=>{try{let n=tz.Z.deepCopy(e),a=n.scheme.configuration.initialization;a.value.values||(a.value.values=[]),a.value.values[t]=l,await V.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","initialization"],value:a}]),i.mutateOneSimulation(n)}catch(s){(0,E.lt)(lP.update,s)}},lz=async(e,t)=>{var l;let i=await V.Z.tasks({id:t}),n=e.find(e=>e.id===t),a=n.scheme.configuration,s=null==a?void 0:null===(l=a.run)||void 0===l?void 0:l.resultsFilter,r=[];return i.forEach(e=>{if(e.file&&"result"===e.file.type&&r.push({label:e.file.fileName,value:e.file.fileName,file:e.file.fileName}),e.files){if(s){let t=RegExp(s.pattern),l=e.files.filter(e=>!t.test(e.fileName)).filter(e=>"result"===e.type),i=e.files.filter(e=>t.test(e.fileName)),n=lk(i,s),o=n.map(e=>({number:e.number,fileName:e.fileName.replace(RegExp(s.suffixPattern),"")})).filter((e,t,l)=>l.findIndex(t=>t.number===e.number)===t).sort((e,t)=>e.number-t.number),d=lE(a,s),u=o.map((e,t)=>{let l=d?e.number*d:t;return{label:String(Math.round(1e15*l)/1e15),value:e.fileName,file:e.fileName}});r.push(...l.map(e=>({label:e.fileName,value:e.fileName,file:e.fileName})).filter(e=>e)),r.push(...u)}else e.files.forEach(e=>{"result"===e.type&&r.push({label:e.fileName,value:e.fileName,file:e.fileName})})}}),r},lA=e=>{let{simulations:t,simulation:l,swr:i}=e,[n,a]=(0,c.useState)(!1),[s,o]=(0,c.useState)(),[d,u]=(0,c.useState)(),[m,p]=(0,c.useState)(),x=null==l?void 0:l.scheme.configuration.initialization,v=null==l?void 0:l.scheme.configuration.dimension,f=(0,c.useCallback)(e=>{let l=t.find(t=>t.id===e);u(l)},[t]);(0,c.useEffect)(()=>{var e,t;!s&&x.value&&o(x.value.type),!d&&(null===(e=x.value)||void 0===e?void 0:e.simulation)&&f(null===(t=x.value)||void 0===t?void 0:t.simulation)},[x,s,d,f]),(0,c.useEffect)(()=>{d&&lz(t,d.id).then(e=>p(e))},[t,d]);let g=[{label:"None",value:"none"}];x.coupling&&g.push({label:x.coupling.label,value:"coupling"}),x.direct&&g.push({label:x.direct.label,value:"direct"});let j={none:(0,r.jsx)("div",{})},b=x.value;{let w=x.coupling;if(null==w?void 0:w.compatibility){let Z=t.map(e=>{let t=e.id===l.id||!w.compatibility.find(t=>t.algorithm===e.scheme.algorithm);return{label:e.name,value:e.id,disabled:t}}),C=w.compatibility.find(e=>{var t;return e.algorithm===(null==d?void 0:null===(t=d.scheme)||void 0===t?void 0:t.algorithm)}),S=null==C?void 0:C.filter;j.coupling=(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(y.Z.Text,{children:"If you use coupling, the selected simulation mesh will be used, at least for the first iteration."}),(0,r.jsxs)(O.Z,{direction:"vertical",className:"full-width marginTop-10",children:[(0,r.jsx)(tk.Z,{className:"full-width",options:Z,placeholder:"Select a simulation",value:null==b?void 0:b.simulation,async onChange(e){a(!0);try{await lO(t,l,e,i),f(e)}catch(n){}finally{a(!1)}}}),n&&(0,r.jsx)(eS.Z,{}),(null==m?void 0:m.length)?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(y.Z.Text,{children:[null==S?void 0:S.name,":"]},"simulation"),(0,r.jsx)(tk.Z,{className:"full-width",options:m,placeholder:"Select a "+S.name,value:null==b?void 0:b.result,async onChange(e,t){lT(l,e,t,i)}})]}):(0,r.jsx)(y.Z.Text,{type:"danger",children:"No results, please select an other simulation."})]})]})}let k=x.direct;(null==k?void 0:k.children)&&(j.direct=(0,r.jsx)(O.Z,{direction:"vertical",className:"full-width",children:k.children.map((e,t)=>{var n,a;if(2!==v||!e.only3D)return(0,r.jsx)(tX,{label:e.label,defaultValue:(null!==(a=null==b?void 0:null===(n=b.values)||void 0===n?void 0:n[t])&&void 0!==a?a:e.default).toString(),unit:e.unit,onValueChange:e=>lM(l,t,e,i)},t)})}))}return(0,r.jsx)(h.Z,{children:(0,r.jsx)(h.Z.Content,{children:(0,r.jsxs)(N.Z,{size:"small",children:[(0,r.jsx)(tk.Z,{className:"full-width marginBottom-10",defaultValue:"none",value:s,options:g,async onChange(e){try{await lN(l,e,i),o(e)}catch(t){}}}),j[s||"none"]]})})})},lL={update:"Unable to delete boundary condition"},lR=async(e,t,l,i,n)=>{try{let a=tz.Z.deepCopy(e),s=a.scheme.configuration.boundaryConditions,r=s[t],o=r.values[l];o.selected.forEach(e=>{i(tr(e))}),r.values=[...r.values.slice(0,l),...r.values.slice(l+1)];let d=!1;Object.keys(s).forEach(e=>{var t;if("index"===e||"title"===e||"done"===e)return;let l=s[e];(null===(t=l.values)||void 0===t?void 0:t.length)&&(d=!0)});let u={...s,done:d};await V.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","boundaryConditions"],value:u}]),n.mutateOneSimulation(a)}catch(c){throw(0,E.lt)(lL.update,c),c}},lD=e=>{let{type:t,index:l,simulation:i,swr:n}=e,[a,s]=(0,c.useState)(!1),{dispatch:o}=(0,c.useContext)(D),d=i.scheme.configuration.boundaryConditions,u=d[t],m=u.values[l];return(0,r.jsx)(k.m1,{loading:a,async onDelete(){s(!0);try{await lR(i,t,l,o,n)}finally{s(!1)}},text:(0,r.jsxs)(r.Fragment,{children:["Are you sure you want to delete the condition"," ",(0,r.jsx)(y.Z.Text,{strong:!0,children:null==m?void 0:m.name}),"?"]})})},lF=e=>{let{simulation:t,swr:l,onEdit:i}=e,[n,a]=(0,c.useState)(!0),s=t.scheme.configuration.boundaryConditions,{dispatch:o}=(0,c.useContext)(D),d=(0,c.useCallback)((e,t)=>{o(te());let l=s[e],i=l.values[t].selected;null==i||i.forEach(e=>{o(ts(e))})},[s,o]),u=(0,c.useCallback)(()=>{o(tt())},[o]);return(0,r.jsx)(r.Fragment,{children:Object.keys(s).map(e=>{var o;if("index"===e||"title"===e||"done"===e)return;let c=s[e];return null===(o=c.values)||void 0===o?void 0:o.map((s,o)=>(0,r.jsxs)(N.Z,{className:"boundaryCondition-item",hoverable:!0,onMouseEnter:()=>d(e,o),onMouseLeave(){n&&u()},actions:[(0,r.jsx)(k.w6,{onEdit(){a(!1),i(e,o),setTimeout(()=>a(!0),500)}},"edit"),(0,r.jsx)(lD,{simulation:{id:t.id,scheme:t.scheme},type:e,index:o,swr:{mutateOneSimulation:l.mutateOneSimulation}},"delete")],children:[(0,r.jsx)(y.Z.Text,{strong:!0,children:s.name})," ",(0,r.jsxs)(y.Z.Text,{children:["(",c.label,")"]})]},o))}).filter(e=>e)})};var lI=l(29924);let lU={name:"You need to define a name",type:"You need to select a type",selected:"You need to select a face",update:"Unable to add boundary condition"},lB=async(e,t,l)=>{try{let i={...t},n=i.type.key;i.uuid=(0,eI.Z)();let a=tz.Z.deepCopy(e),s=a.scheme.configuration.boundaryConditions,r=s[n];r.values=[...r.values||[],i];let o={...s,done:!0};await V.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","boundaryConditions"],value:o}]),await V.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","run"],value:{...a.scheme.configuration.run,done:!1}}]),l.mutateOneSimulation(a)}catch(d){throw(0,E.lt)(lU.update,d),d}},lV=e=>{let{simulation:t,boundaryCondition:l,swr:i,onError:n,onClose:a}=e,[s,o]=(0,c.useState)(!1);return(0,r.jsx)(k.HS,{loading:s,async onAdd(){o(!0);try{var e,s;if(!l.name){n(lU.name),o(!1);return}if(!(null===(e=l.type)||void 0===e?void 0:e.key)){n(lU.type),o(!1);return}if(!(null===(s=l.selected)||void 0===s?void 0:s.length)){n(lU.selected),o(!1);return}n(),await lB(t,l,i),o(!1),a()}catch(r){o(!1)}},needMargin:!0,children:"Add"})},lH={name:"You need to define a name",type:"You need to select a type",selected:"You need to select a face",update:"Unable to edit boundary condition"},lG=async(e,t,l,i)=>{try{let n=tz.Z.deepCopy(e),a=n.scheme.configuration.boundaryConditions,s=t.type.key,r=l.type.key;if(r!==s){let o=a[r],d=o.values.findIndex(e=>e.uuid===l.uuid);o.values=[...o.values.slice(0,d),...o.values.slice(d+1)]}if(r!==s){let u=a[s];u.values=[...u.values||[],t]}else{let c=a[s],m=c.values.findIndex(e=>e.uuid===t.uuid);c.values=[...c.values.slice(0,m),t,...c.values.slice(m+1)]}let h={...a};await V.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","boundaryConditions"],value:h}]),i.mutateOneSimulation(n)}catch(p){throw(0,E.lt)(lH.update,p),p}},lY=e=>{let{simulation:t,boundaryCondition:l,oldBoundaryCondition:i,swr:n,onError:a,onClose:s}=e,[o,d]=(0,c.useState)(!1);return(0,r.jsx)(k.w6,{loading:o,async onEdit(){d(!0);try{var e,r;if(!l.name){a(lH.name),d(!1);return}if(!(null===(e=l.type)||void 0===e?void 0:e.key)){a(lH.type),d(!1);return}if(!(null===(r=l.selected)||void 0===r?void 0:r.length)){a(lH.selected),d(!1);return}a(),await lG(t,l,i,n),d(!1),s()}catch(o){d(!1)}},primary:!0,needMargin:!0,children:"Edit"})},lJ=e=>{var t;let{visible:l,geometry:i,simulation:n,boundaryCondition:a,swr:s,onClose:o}=e,[d,u]=(0,c.useState)([]),[m,h]=(0,c.useState)([]),[p,v]=(0,c.useState)(),[f,g]=(0,c.useState)(),[b,w]=(0,c.useState)(),Z=n.scheme.configuration.boundaryConditions,C=n.scheme.configuration.dimension;(0,c.useEffect)(()=>{!l&&f&&g(void 0)}),(0,c.useEffect)(()=>{l&&!f&&a?g(a):!l||f||a||void 0===p||g(e=>({...e,name:"Boundary condition "+(p+1)}))},[f,p,l,a]),(0,c.useEffect)(()=>{let e=Object.keys(Z).map(e=>{var t;if("index"===e||"title"===e||"done"===e)return;let l=Z[e];return null==l?void 0:null===(t=l.values)||void 0===t?void 0:t.map(e=>{if(e.uuid!==(null==a?void 0:a.uuid))return{label:e.name,selected:e.selected}}).filter(e=>e)}).flat().filter(e=>e);u(e)},[Z,a]),(0,c.useEffect)(()=>{let e=Object.keys(Z).map(e=>{if("index"===e||"title"===e||"done"===e)return;let t=Z[e];return{key:e,label:t.label,children:t.children,values:t.values}}).filter(e=>e);h(e)},[Z]),(0,c.useEffect)(()=>{let e=null==m?void 0:m.map(e=>{var t;return null===(t=e.values)||void 0===t?void 0:t.length}).filter(e=>e).reduce((e,t)=>e+t,0);v(e)},[m]);let S=(0,c.useCallback)(e=>{let t=e.target.value;g(e=>({...e,name:t}))},[]),E=(0,c.useCallback)(e=>{var t;let l=e.target.value,i=m.find(e=>e.key===l),n=Z[l],a=null===(t=n.children)||void 0===t?void 0:t.map(e=>({checked:!0,value:e.default}));g(e=>({...e,type:{key:i.key,label:i.label,children:i.children},values:a}))},[Z,m]),P=(0,c.useCallback)((e,t)=>{g(l=>({...l,values:[...l.values.slice(0,e),{checked:l.values[e].checked,value:t},...l.values.slice(e+1)]}))},[]),T=(0,c.useCallback)((e,t)=>{g(l=>({...l,values:[...l.values.slice(0,e),{checked:t,value:l.values[e].value},...l.values.slice(e+1)]}))},[]),M=(0,c.useCallback)(e=>{g(t=>({...t,selected:e}))},[]),z=(0,c.useMemo)(()=>{var e;return(null==f?void 0:f.type)&&(null===(e=f.type)||void 0===e?void 0:e.children)?(0,r.jsx)(N.Z,{children:f.type.children.map((e,t)=>{if(2!==C||!e.only3D)return(0,r.jsx)(tX,{className:"marginBottom-10",label:e.label,defaultValue:String(f.values[t].value),defaultChecked:f.type.children.length>1?f.values[t].checked:void 0,onValueChange:e=>P(t,e),onCheckedChange:e=>T(t,e),unit:e.unit},t)})}):null},[f,C,T,P]);return(0,r.jsx)(t3.Z,{className:"boundaryCondition",title:"Boundary condition",placement:"left",closable:!1,open:l,mask:!1,maskClosable:!1,width:300,extra:(0,r.jsx)(x.Z,{type:"text",icon:(0,r.jsx)(Q.Z,{}),onClick(){g(void 0),o()}}),footer:(0,r.jsxs)("div",{style:{display:"flex",justifyContent:"flex-end"},children:[(0,r.jsx)(k.Lw,{onCancel(){g(void 0),o()}}),a?(0,r.jsx)(lY,{boundaryCondition:{uuid:(null==f?void 0:f.uuid)||a.uuid,name:(null==f?void 0:f.name)||a.name,type:(null==f?void 0:f.type)||a.type,selected:(null==f?void 0:f.selected)||a.selected,values:(null==f?void 0:f.values)||a.values},oldBoundaryCondition:{uuid:a.uuid,name:a.name,type:a.type,selected:a.selected,values:a.values},simulation:{id:n.id,scheme:n.scheme},swr:{mutateOneSimulation:s.mutateOneSimulation},onError:e=>w(e),onClose:o}):(0,r.jsx)(lV,{boundaryCondition:{name:null==f?void 0:f.name,type:null==f?void 0:f.type,selected:null==f?void 0:f.selected,values:null==f?void 0:f.values},simulation:{id:n.id,scheme:n.scheme},swr:{mutateOneSimulation:s.mutateOneSimulation},onError:e=>w(e),onClose:o})]}),children:(0,r.jsxs)(O.Z,{direction:"vertical",className:"full-width",children:[(0,r.jsx)(N.Z,{size:"small",children:(0,r.jsx)(ed.Z,{layout:"vertical",children:(0,r.jsx)(ed.Z.Item,{label:(0,r.jsx)(y.Z.Text,{strong:!0,children:"Boundary condition name"}),children:(0,r.jsx)(eu.Z,{value:(null==f?void 0:f.name)||"",onChange:S,maxLength:50})})})}),(0,r.jsx)(N.Z,{size:"small",children:(0,r.jsx)(ed.Z,{layout:"vertical",children:(0,r.jsx)(ed.Z.Item,{label:(0,r.jsx)(y.Z.Text,{strong:!0,children:"Boundary condition type"}),children:(0,r.jsx)(lI.ZP.Group,{className:"BoundaryCondition-types",optionType:"button",buttonStyle:"solid",value:null==f?void 0:null===(t=f.type)||void 0===t?void 0:t.key,onChange:E,children:null==m?void 0:m.map(e=>(0,r.jsx)(lI.ZP.Button,{value:e.key,children:e.label},e.key))})})})}),z,(0,r.jsx)(ll,{geometry:i,alreadySelected:d,updateSelected:M}),b&&(0,r.jsxs)(y.Z.Text,{children:[(0,r.jsx)(j.Z,{style:{color:"red"}})," ",b]})]})})},lW=e=>{let{simulation:t,geometry:l,swr:i,setVisible:n}=e,[a,s]=(0,c.useState)(),[o,d]=(0,c.useState)(!1),{dispatch:u}=(0,c.useContext)(D),m=t.scheme.configuration.boundaryConditions;(0,c.useEffect)(()=>{(null==l?void 0:l.summary)&&u(tl(2===l.summary.dimension?"edges":"faces"))},[l,u]);let p=(0,c.useCallback)(()=>{s(void 0),d(!0),n(!1),u(te())},[u,n]),y=(0,c.useCallback)((e,t)=>{let l=m[e],i=l.values[t];s(i),d(!0),n(!1),u(te())},[m,u,n]),x=(0,c.useCallback)(()=>{u(tt()),d(!1),s(void 0),n(!0)},[u,n]);return l?(0,r.jsx)(h.Z,{children:(0,r.jsx)(h.Z.Content,{children:(0,r.jsxs)(N.Z,{size:"small",children:[(0,r.jsx)(k.HS,{onAdd:p,fullWidth:!0,primary:!1,children:"Add boundary condition"}),(0,r.jsx)(lF,{simulation:{id:t.id,scheme:t.scheme},swr:{mutateOneSimulation:i.mutateOneSimulation},onEdit:y}),(0,r.jsx)(lJ,{visible:o,geometry:{summary:l.summary},simulation:{id:t.id,scheme:t.scheme},boundaryCondition:a&&{uuid:a.uuid,name:a.name,type:a.type,selected:a.selected,values:a.values},swr:{mutateOneSimulation:i.mutateOneSimulation},onClose:x})]})})}):(0,r.jsx)(P.Z.Simple,{})};var lX=l(1485),lq=l(67841),l_=l(36027),lK=l(57184);let lQ={name:"You need to define a name",point:"You need to select a point",formula:"You need to define a formula",update:"Unable to update simulation"},l$=async(e,t,l)=>{try{let i=tz.Z.deepCopy(e),n=i.scheme.configuration.run,a=t.index;n.sensors[a]={name:t.name,point:t.point,formula:t.formula},await V.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","run"],value:n}]),l.mutateOneSimulation(i)}catch(s){throw(0,E.lt)(lQ.update,s),s}},l0=e=>{let{simulation:t,sensor:l,onError:i,onClose:n,swr:a}=e,[s,o]=(0,c.useState)();return(0,r.jsx)(k.w6,{loading:s,primary:!0,needMargin:!0,async onEdit(){o(!0);try{if(!l.name){i(lQ.name),o(!1);return}if(!l.point){i(lQ.point),o(!1);return}if(!l.formula){i(lQ.formula),o(!1);return}i(),await l$(t,l,a),o(!1),n()}catch(e){o(!1)}},children:"Edit"})},l1={name:"You need to define a name",point:"You need to select a point",formula:"You need to define a formula",update:"Unable to update simulation"},l2=async(e,t,l)=>{try{let i=tz.Z.deepCopy(e),n=i.scheme.configuration.run,a={...n,sensors:[...n.sensors||[],t]};await V.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","run"],value:a}]),l.mutateOneSimulation(i)}catch(s){throw(0,E.lt)(l1.update,s),s}},l4=e=>{let{simulation:t,sensor:l,onError:i,onClose:n,swr:a}=e,[s,o]=(0,c.useState)();return(0,r.jsx)(k.HS,{loading:s,needMargin:!0,async onAdd(){o(!0);try{if(!l.name){i(l1.name),o(!1);return}if(!l.point){i(l1.point),o(!1);return}if(!l.formula){i(l1.formula),o(!1);return}i(),await l2(t,l,a),o(!1),n()}catch(e){o(!1)}},children:"Add"})},l5=e=>{var t,l,i,n,a,s;let{visible:o,simulation:d,sensor:u,onClose:h,swr:p}=e,[v,f]=(0,c.useState)(),[g,b]=(0,c.useState)(),[w,Z]=(0,c.useState)(),[C,S]=(0,c.useState)(),{point:E,dispatch:P}=(0,c.useContext)(D);(0,c.useEffect)(()=>{P(tl("point"))},[P]),(0,c.useEffect)(()=>{if(!u){let e=d.scheme.configuration.run;b("Sensor "+(e.sensors?e.sensors.length+1:1))}},[d,u]),(0,c.useEffect)(()=>{u&&(b(u.name),P(to({x:u.point.x,y:u.point.y,z:u.point.z})),Z(u.formula))},[u,P]);let T=(0,c.useCallback)(()=>{f(!1),P(tt()),window.removeEventListener("click",T)},[P]),M=(0,c.useCallback)(()=>{v?T():(f(!0),P(te()),setTimeout(()=>window.addEventListener("click",T),50))},[v,T,P]),z=(0,c.useCallback)((e,t,l)=>{P(to({x:e,y:t,z:l}))},[P]),A=(0,c.useCallback)(e=>{Z(e)},[]),L=(0,c.useCallback)(()=>{b(void 0),Z(void 0),S(void 0),P(to()),h()},[P,h]);return(0,r.jsx)(t3.Z,{className:"sensor",title:"Sensor",placement:"left",closable:!1,open:o,mask:!1,maskClosable:!1,width:300,extra:(0,r.jsx)(x.Z,{type:"text",icon:(0,r.jsx)(Q.Z,{}),onClick:L}),footer:(0,r.jsxs)("div",{style:{display:"flex",justifyContent:"flex-end"},children:[(0,r.jsx)(k.Lw,{onCancel:L}),u?(0,r.jsx)(l0,{simulation:d,sensor:{...u,name:g,point:E,formula:w},onError:S,onClose:L,swr:p}):(0,r.jsx)(l4,{simulation:d,sensor:{name:g,point:E,formula:w},onError:S,onClose:L,swr:p})]}),children:(0,r.jsxs)(O.Z,{direction:"vertical",className:"full-width",children:[(0,r.jsxs)(N.Z,{size:"small",children:[(0,r.jsx)(y.Z.Text,{children:"Name"}),(0,r.jsx)(eu.Z,{value:g,onChange:e=>b(e.target.value)})]}),(0,r.jsx)(N.Z,{size:"small",children:(0,r.jsxs)(O.Z,{direction:"vertical",className:"full-width",children:[(0,r.jsxs)(O.Z,{className:"full-width",style:{justifyContent:"space-between"},children:[(0,r.jsx)(y.Z.Text,{children:"Point selection"}),(0,r.jsx)(m.Z,{title:"Pin in the geometry",children:(0,r.jsx)(x.Z,{size:"small",type:v?"primary":"default",icon:(0,r.jsx)(lK.Z,{}),onClick:M})})]}),(0,r.jsx)(tX,{label:"X",defaultValue:null==E?void 0:E.x,onValueChange:e=>z(+e,null!==(t=null==E?void 0:E.y)&&void 0!==t?t:0,null!==(l=null==E?void 0:E.z)&&void 0!==l?l:0)}),(0,r.jsx)(tX,{label:"Y",defaultValue:null==E?void 0:E.y,onValueChange:e=>z(null!==(i=null==E?void 0:E.x)&&void 0!==i?i:0,+e,null!==(n=null==E?void 0:E.z)&&void 0!==n?n:0)}),(0,r.jsx)(tX,{label:"Z",defaultValue:null==E?void 0:E.z,onValueChange:e=>z(null!==(a=null==E?void 0:E.x)&&void 0!==a?a:0,null!==(s=null==E?void 0:E.y)&&void 0!==s?s:0,+e)})]})}),(0,r.jsx)(N.Z,{size:"small",className:"no-border-bottom",children:(0,r.jsx)(tX,{label:"Formula",defaultValue:w,onValueChange:A})}),C&&(0,r.jsxs)(y.Z.Text,{children:[(0,r.jsx)(j.Z,{style:{color:"red"}})," ",C]})]})})},l8={udpate:"Unable to update simulation"},l3=async(e,t,l,i)=>{try{let n=tz.Z.deepCopy(e),a=n.scheme.configuration.run;l(to()),a.sensors=[...a.sensors.slice(0,t),...a.sensors.slice(t+1)],await V.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","run"],value:a}]),i.mutateOneSimulation(n)}catch(s){throw(0,E.lt)(l8.udpate,s),s}},l6=e=>{let{simulation:t,index:l,swr:i}=e,[n,a]=(0,c.useState)(),{dispatch:s}=(0,c.useContext)(D),o=t.scheme.configuration.run,d=o.sensors[l];return(0,r.jsx)(k.m1,{loading:n,text:(0,r.jsxs)(r.Fragment,{children:["Are you sure you want to delete the sensor"," ",(0,r.jsx)(y.Z.Text,{strong:!0,children:d.name})]}),async onDelete(){a(!0);try{await l3(t,l,s,i)}finally{a(!1)}}})},l7=e=>{var t;let{simulation:l,onEdit:i,swr:n}=e,[a,s]=(0,c.useState)(!0),o=l.scheme.configuration.run,{dispatch:d}=(0,c.useContext)(D),u=(0,c.useCallback)(e=>{d(te()),d(to(e.point))},[d]),m=(0,c.useCallback)(()=>{a&&d(to()),d(tt())},[a,d]);return(0,r.jsx)(r.Fragment,{children:null===(t=o.sensors)||void 0===t?void 0:t.map((e,t)=>(0,r.jsx)(N.Z,{className:"sensor-item text-center",hoverable:!0,onMouseEnter:()=>u(e),onMouseLeave:m,actions:[(0,r.jsx)(k.w6,{onEdit(){s(!1),i({...e,index:t}),setTimeout(()=>s(!0),500)}},"edit"),(0,r.jsx)(l6,{simulation:l,index:t,swr:n},"delete")],children:(0,r.jsx)(y.Z.Text,{strong:!0,className:"text-center",children:e.name})},t))})},l9=e=>{let{simulation:t,setVisible:l,setResult:i,setPostprocessing:n,swr:a}=e,[s,o]=(0,c.useState)(),[d,u]=(0,c.useState)(),m=(0,c.useCallback)(()=>{i(void 0),n(void 0),u(void 0),l(!1),o(!0)},[l,i,n]),h=(0,c.useCallback)(e=>{i(void 0),n(void 0),u(e),l(!1),o(!0)},[l,i,n]),p=(0,c.useCallback)(()=>{u(void 0),l(!0),o(!1)},[l]);return(0,r.jsxs)(N.Z,{size:"small",title:"Sensors",children:[(0,r.jsx)(l5,{visible:s,simulation:t,sensor:d,onClose:p,swr:a}),(0,r.jsxs)(O.Z,{direction:"vertical",className:"full-width",children:[(0,r.jsx)(x.Z,{className:"full-width",disabled:!1,type:"primary",icon:(0,r.jsx)(l_.Z,{}),onClick:m,children:"Add a sensor"}),(0,r.jsx)(l7,{simulation:t,onEdit:h,swr:a})]})]})};var ie=l(139),it=l(71270);let il={plugins:"Plugins error",pluginsLoad:"Unable to load plugins"},ii=e=>{let{disabled:t,cloudServer:i,onOk:n}=e,[a,s]=(0,c.useState)(!1),[o,m]=(0,c.useState)([]),h=(0,u.useRouter)(),[p,{errorPlugins:v}]=it.Z.usePlugins();return(0,c.useEffect)(()=>{v&&(0,E.lt)(il.plugins,v)},[v]),(0,c.useEffect)(()=>{tA.Z.list().then(e=>{m(e)}).catch(e=>{(0,E.lt)(il.pluginsLoad,e)})},[]),(0,r.jsxs)(N.Z,{size:"small",title:"Computational resource",children:[(0,r.jsx)(tE.Z,{open:a,title:"Computational resource",okButtonProps:{disabled:!0,style:{display:"none"}},onCancel:()=>s(!1),style:{width:"unset"},children:(0,r.jsxs)(O.Z,{direction:"vertical",children:[(0,r.jsxs)(y.Z.Text,{children:["Your computational resource does not appear in this list? Create one in your"," ",(0,r.jsx)(k.Qj,{onClick:()=>h.push({pathname:"/dashboard",query:{page:"account",tab:"hpc"}}),children:"account settings"})]}),(0,r.jsx)(O.Z,{align:"start",direction:"horizontal",wrap:!0,children:null==p?void 0:p.map(e=>{let t=o.find(t=>t.key===e.key);if(!t)return;let i=d()(()=>l(64546)("./".concat(t.key,"/src/components")));return(0,r.jsx)(N.Z,{title:e.configuration.name.value,children:(0,r.jsx)(i,{data:e.data,onSelect(t){(0,tT.merge)(e,t),n(e),s(!1)}})},e.uuid)})})]})}),(0,r.jsxs)(O.Z,{direction:"vertical",className:"full-width",children:[i&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(y.Z.Text,{children:[(0,r.jsx)("span",{className:"text-light",children:"Plugin:"})," ",i.name]}),(0,r.jsxs)(y.Z.Text,{children:[(0,r.jsx)("span",{className:"text-light",children:"Name:"})," ",i.configuration.name.value]}),Object.keys(i.inUseConfiguration).map(e=>{let t=i.inUseConfiguration[e],l=t.value;return"boolean"==typeof l&&(l=l?"yes":"no"),(0,r.jsxs)(y.Z.Text,{children:[(0,r.jsxs)("span",{className:"text-light",children:[t.label,":"]})," ",l]},e)})]}),(0,r.jsx)(x.Z,{className:"full-width",disabled:t,type:i?"link":"primary",icon:(0,r.jsx)(ie.Z,{}),onClick:()=>s(!0),children:i?"Modify the resource":"Select a resource"})]})]})};var ia=l(15360),is=l(25935),ir=l(48764).lW;let io={log:"Unable to get system log"},id=async(e,t)=>{try{let l=await V.Z.log({id:e.id},t.systemLog),i=ir.from(l.log).toString();tE.Z.info({title:"System log",width:"unset",content:(0,r.jsx)("pre",{children:(0,r.jsx)("code",{children:(0,is.ZP)(i.replace(/\n\n/g,"\n").replace(/\n/g,"<br />"))})})})}catch(n){(0,E.lt)(io.log,n)}},iu=e=>{let{simulation:t,steps:l}=e,[i,n]=(0,c.useState)(!1),[a,s]=(0,c.useState)(!1);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t3.Z,{title:"Log",open:i,onClose:()=>n(!1),width:"50%",children:(0,r.jsx)(tP.Z,{items:null==l?void 0:l.map(e=>{var l,i;return{key:e.label,label:e.label,children:(0,r.jsxs)(r.Fragment,{children:[e.systemLog&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(x.Z,{loading:a,async onClick(){s(!0);try{await id(t,e)}catch(l){}finally{s(!1)}},children:"Complete log"}),(0,r.jsx)("br",{})]}),e.link&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("a",{href:"https://"+e.link.href,target:"_blank",rel:"noreferrer",children:(0,r.jsx)(x.Z,{type:"primary",children:e.link.label})}),(0,r.jsx)("br",{})]}),(0,r.jsxs)(ly.Z,{ghost:!0,children:[e.warning&&(0,r.jsx)(ly.Z.Panel,{className:"warning-collapse",header:(0,r.jsx)(y.Z.Text,{type:"warning",children:"Warnings"}),children:(0,is.ZP)(e.warning.replace(/\n\n/g,"\n").replace(/\n/g,"<br />"))},"warnings"),e.error&&(0,r.jsx)(ly.Z.Panel,{className:"error-collapse",header:(0,r.jsx)(y.Z.Text,{type:"danger",children:"Errors"}),children:(0,is.ZP)(e.error.replace(/\n\n/g,"\n").replace(/\n/g,"<br />"))},"errors")]}),(0,is.ZP)((null===(l=e.pluginLog)||void 0===l?void 0:l.replace(/\n\n/g,"\n").replace(/\n/g,"<br />"))||""),(0,is.ZP)((null===(i=e.log)||void 0===i?void 0:i.replace(/\n\n/g,"\n").replace(/\n/g,"<br />"))||"")]})}})})}),(0,r.jsx)(m.Z,{title:"Log",children:(0,r.jsx)(x.Z,{disabled:!l||!l.length,icon:(0,r.jsx)(ia.Z,{}),onClick:()=>n(!0)})})]})};var ic=l(99611),im=l(23430);let ih={download:"Unable to download file"},ip=async(e,t)=>{try{let l=await eb.download({id:e.id},{originPath:t.originPath,fileName:t.fileName}),i=await l.blob(),n=window.URL.createObjectURL(new Blob([i])),a=document.createElement("a");a.href=n,a.setAttribute("download",t.name+"."+t.fileName.split(".").pop()),a.click()}catch(s){(0,E.lt)(ih.download,s)}},iy=e=>{let{simulation:t,file:l}=e,[i,n]=(0,c.useState)(!1);return(0,r.jsx)(m.Z,{title:"Download",children:(0,r.jsx)(x.Z,{loading:i,icon:(0,r.jsx)(im.Z,{}),async onClick(){n(!0);try{await ip(t,l)}catch(e){}finally{n(!1)}}})})},ix={archive:"Unable to download archive"},iv=async e=>{try{let t=await eb.archive({id:e.id}),l=await t.blob(),i=window.URL.createObjectURL(new Blob([l])),n=document.createElement("a");n.href=i,n.setAttribute("download",e.scheme.name+".zip"),n.click()}catch(a){(0,E.lt)(ix.archive,a)}},ig=e=>{let{simulation:t}=e,[l,i]=(0,c.useState)(!1);return(0,r.jsx)(k.o6,{loading:l,async onDownload(){i(!0);try{await iv(t)}catch(e){}finally{i(!1)}}})},ij=e=>{var t;let{simulation:l,result:i,setResult:n}=e,[a,s]=(0,c.useState)(),[o,d]=(0,c.useState)(),[u,m]=(0,c.useState)(),h=null==l?void 0:null===(t=l.scheme)||void 0===t?void 0:t.configuration;return((0,c.useEffect)(()=>{var e;if(!(null==l?void 0:l.tasks)){s([]),d(void 0);return}let t=[],i=null==h?void 0:null===(e=h.run)||void 0===e?void 0:e.resultsFilter;l.tasks.forEach(e=>{if(e.file&&t.push(e.file),e.files){if(i){let l=RegExp(i.pattern),n=e.files.filter(e=>!l.test(e.fileName)),a=e.files.filter(e=>l.test(e.fileName)),s=lk(a,i),r=s.map(e=>e.number).filter((e,t,l)=>l.indexOf(e)===t).sort((e,t)=>e-t),o=lE(h,i),u=r.map((e,t)=>({label:Math.round(1e15*(o?e*o:t))/1e15,value:e}));t.push(...n),d({filtered:!0,name:i.name,files:s,options:u})}else t.push(...e.files)}}),s(t)},[l,h]),(0,c.useEffect)(()=>{!u&&o&&m(null==o?void 0:o.options[0].value)},[o,u]),a||o)?(null==a?void 0:a.length)||o?(0,r.jsx)(N.Z,{size:"small",title:"Results",extra:(0,r.jsx)(ig,{simulation:l&&{id:l.id,scheme:l.scheme}}),children:(0,r.jsxs)(O.Z,{direction:"vertical",className:"full-width",children:[null==a?void 0:a.map(e=>(0,r.jsxs)(O.Z,{style:{alignItems:"center"},children:[(0,r.jsx)(x.Z,{icon:(null==i?void 0:i.fileName)===(null==e?void 0:e.fileName)&&(null==i?void 0:i.name)===(null==e?void 0:e.name)?(0,r.jsx)(ic.Z,{style:{color:"#fad114"}}):(0,r.jsx)(eL.Z,{}),onClick:()=>n((null==i?void 0:i.fileName)===(null==e?void 0:e.fileName)&&(null==i?void 0:i.name)===(null==e?void 0:e.name)?void 0:e)}),(0,r.jsx)(iy,{simulation:l&&{id:l.id},file:e&&{name:e.name,fileName:e.fileName,originPath:e.originPath}}),e.name]},e.name)),o&&(0,r.jsxs)(r.Fragment,{children:[o.name,(0,r.jsx)(tk.Z,{className:"full-width",options:o.options,value:u,onChange(e){let t=o.files.find(t=>t.number===e&&t.name===(null==i?void 0:i.name));n(t),m(e)}}),o.files.map(e=>{if(e.number===u)return(0,r.jsxs)(O.Z,{style:{alignItems:"center"},children:[(0,r.jsx)(x.Z,{icon:(null==i?void 0:i.fileName)===(null==e?void 0:e.fileName)&&(null==i?void 0:i.name)===(null==e?void 0:e.name)?(0,r.jsx)(ic.Z,{style:{color:"#fad114"}}):(0,r.jsx)(eL.Z,{}),onClick:()=>n((null==i?void 0:i.fileName)===(null==e?void 0:e.fileName)&&(null==i?void 0:i.name)===(null==e?void 0:e.name)?void 0:e)}),(0,r.jsx)(iy,{simulation:l&&{id:l.id},file:e&&{name:e.name,fileName:e.fileName,originPath:e.originPath}}),e.name]},e.name)})]})]})}):(0,r.jsx)(N.Z,{size:"small",children:"No results yet"}):(0,r.jsx)(eS.Z,{})},ib={run:"Unable to run simulation",stop:"Unable to stop simulation",update:"Unable to update simulation"},iw=async(e,t,l)=>{try{let i=tz.Z.deepCopy(e),n=e.scheme.configuration;n.run.cloudServer=t,i.scheme.configuration=n,await V.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","run"],value:n.run}]),l.mutateOneSimulation(i),l.mutateSimulation(i)}catch(a){(0,E.lt)(ib.update,a)}},iZ=async e=>{try{await V.Z.run({id:e.id})}catch(t){throw(0,E.lt)(ib.run,t),t}},iC=async e=>{try{await V.Z.stop({id:e.id})}catch(t){throw(0,E.lt)(ib.stop,t),t}},iS=e=>{var t,l;let{simulation:i,result:n,setResult:a,setPostprocessing:s,setVisible:o,swr:d}=e,[u,m]=(0,c.useState)(!1),[p,y]=(0,c.useState)(!1),[v,f]=(0,c.useState)([]),[g,{mutateSimulation:j}]=V.Z.useSimulation(i.id,2e3),b=i.scheme.configuration,w=null==g?void 0:null===(t=g.scheme)||void 0===t?void 0:t.configuration;return((0,c.useEffect)(()=>{if(!b){m(!0);return}let e=!0;Object.keys(b).forEach(t=>{if("dimension"!==t&&"run"!==t){let l=b[t];l.done||(e=!1)}}),b.run.cloudServer||(e=!1),m(!e)},[b]),(0,c.useEffect)(()=>{var e,t;(null==g?void 0:null===(e=g.tasks)||void 0===e?void 0:e.find(e=>(null==e?void 0:e.status)==="error"))?y(!1):(null==g?void 0:null===(t=g.tasks)||void 0===t?void 0:t.find(e=>e&&"finish"!==e.status))?y(!0):y(!1)},[null==g?void 0:g.tasks]),(0,c.useEffect)(()=>{var e;let t=[];null==g||null===(e=g.tasks)||void 0===e||e.forEach(e=>{e&&(t[e.index]={index:e.index,label:e.label,status:e.status,log:e.log,pluginLog:e.pluginLog,warning:e.warning,error:e.error,systemLog:e.systemLog,link:e.link})}),f(t)},[null==g?void 0:g.tasks]),i&&g&&(null==g?void 0:g.id)!=="0")?(0,r.jsx)(h.Z,{children:(0,r.jsx)(h.Z.Content,{children:(0,r.jsxs)(O.Z,{direction:"vertical",className:"full-width",children:[(0,r.jsx)(l9,{simulation:i,setVisible:o,setResult:a,setPostprocessing:s,swr:{mutateOneSimulation:d.mutateOneSimulation}}),(0,r.jsx)(ii,{disabled:p,cloudServer:null==w?void 0:null===(l=w.run)||void 0===l?void 0:l.cloudServer,onOk:async e=>iw(i,e,{...d,mutateSimulation:j})}),(0,r.jsx)(N.Z,{size:"small",title:"Run",children:(0,r.jsxs)(O.Z,{direction:"vertical",className:"full-width",size:20,children:[(0,r.jsxs)("div",{className:"full-width",style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,r.jsxs)(O.Z,{children:[(0,r.jsx)(x.Z,{disabled:u,type:"primary",icon:(0,r.jsx)(lq.Z,{}),loading:p,async onClick(){y(!0);try{await iZ(i)}catch(e){y(!1)}},children:"Run"}),(0,r.jsx)(x.Z,{disabled:!p,danger:!0,icon:(0,r.jsx)(eA.Z,{}),shape:"circle",async onClick(){try{await iC(i),y(!1)}catch(e){}}})]}),(0,r.jsx)(iu,{simulation:{id:i.id},steps:v})]}),(0,r.jsx)(lX.Z,{direction:"vertical",children:v.map((e,t)=>(0,r.jsx)(lX.Z.Step,{title:e.label,description:"("+(t+1)+"/"+v.length+")",status:e.status},e.label))})]})}),(0,r.jsx)(ij,{simulation:g&&{id:g.id,scheme:g.scheme,tasks:g.tasks},result:n&&{name:n.name,fileName:n.fileName},setResult:a})]})})}):(0,r.jsx)(h.Z,{children:(0,r.jsx)(h.Z.Content,{children:(0,r.jsx)(N.Z,{size:"small",children:(0,r.jsx)(eS.Z,{})})})})};var ik=l(1402),iE=[{key:"warpByVector",label:"Warp by vector",parameters:[{key:"Vectors",label:"Vectors",rules:[{required:!0,message:"Vectors is required"}]},{key:"ScaleFactor",label:"Scale factor",default:"1",rules:[{required:!0,message:"Scale factor is required"}]}]},{key:"contour",label:"Contour",parameters:[{key:"ContourBy",label:"Contour by",rules:[{required:!0,message:"ContourBy by is required"}]},{key:"isosurface",label:"Isosurface",default:"0",rules:[{required:!0,message:"Isosurface is required"}]}]},{key:"streamTracer",label:"Stream tracer",parameters:[{key:"Vectors",label:"Vectors",rules:[{required:!0,message:"Vectors is required"}]}]}];let iP=async(e,t,l,i)=>{let n=await (0,G.R)("/api/postprocessing",{method:"POST",headers:{Accept:"application/json"},body:JSON.stringify({simulation:e,result:t,filter:l,parameters:i})});return n.json()};var iN={run:iP};let iO={run:"Unable to run filter"},iT=async(e,t,l,i)=>{try{return await iN.run(e,t,l,i)}catch(n){(0,E.lt)(iO.run,n)}},iM=e=>{let{simulation:t,result:l,postprocessing:i,setResult:n}=e,[a,s]=(0,c.useState)(),[o,d]=(0,c.useState)(),[u,p]=(0,c.useState)(),[y,v]=(0,c.useState)();if((0,c.useEffect)(()=>{!l&&a&&s(!1)},[l,a]),(0,c.useEffect)(()=>{t||(d(void 0),v(void 0))},[t,l]),!t||!l)return null;let f=t.scheme.configuration.run.postprocessing;if(!f)return null;let g=iE.map(e=>{if(f.find(t=>t.key===e.key))return{label:e.label,value:e.key}}).filter(e=>e);if(!g.length)return null;let j=null;if(o){let b=iE.find(e=>e.key===o),w=f.find(e=>e.key===o);(null==b?void 0:b.parameters)&&(j=b.parameters.map((e,t)=>{var l;let i=null==w?void 0:null===(l=w.parameters)||void 0===l?void 0:l.find(t=>t.key===e.key);return(null==i?void 0:i.value)?(0,r.jsx)(ed.Z.Item,{label:e.label,name:["parameters",t],initialValue:i.value,rules:e.rules,children:(0,r.jsx)(eu.Z,{disabled:!0})},e.key):(null==i?void 0:i.options)?(0,r.jsx)(ed.Z.Item,{label:e.label,name:["parameters",t],rules:e.rules,children:(0,r.jsx)(tk.Z,{options:i.options.map(e=>({label:e,value:e}))})},e.key):(0,r.jsx)(ed.Z.Item,{label:e.label,name:["parameters",t],rules:e.rules,initialValue:e.default,children:(0,r.jsx)(eu.Z,{})},e.key)}))}return(0,r.jsx)(h.Z,{style:{position:"absolute",zIndex:101,right:25,bottom:50,backgroundColor:"rgba(255, 255, 255, 0)"},children:(0,r.jsxs)(h.Z.Content,{children:[(0,r.jsx)(m.Z,{title:"Post-processing",children:(0,r.jsx)(x.Z,{type:"primary",icon:(0,r.jsx)(ik.Z,{}),onClick:()=>s(!0),style:{width:40,height:40,border:"1px solid #5E14FA",borderRadius:20,marginBottom:-20}})}),(0,r.jsxs)(t3.Z,{title:"Post-processing",closable:!0,onClose:()=>s(!1),open:a,mask:!1,maskClosable:!1,children:[(0,r.jsx)(ed.Z,{style:{margin:"24px 0"},children:(0,r.jsx)(ed.Z.Item,{name:"filter",label:"Filter",children:(0,r.jsx)(tk.Z,{placeholder:"Select a filter",options:g,onChange:d})})}),(0,r.jsxs)(ed.Z,{layout:"vertical",style:{margin:"24px 0"},async onFinish(e){p(!0);try{let i=await iT({id:t.id},l,o,e.parameters||[]);v(i)}catch(n){}p(!1)},children:[j,(0,r.jsx)(ed.Z.Item,{children:(0,r.jsx)(x.Z,{type:"primary",loading:u,htmlType:"submit",icon:(0,r.jsx)(lq.Z,{}),children:"Run"})})]}),y&&(0,r.jsx)(N.Z,{size:"small",title:"Post-processing",extra:o,children:(0,r.jsx)(O.Z,{direction:"vertical",className:"full-width",children:y.length?y.map(e=>(0,r.jsxs)(O.Z,{children:[(0,r.jsx)(x.Z,{icon:(null==i?void 0:i.fileName)===e.fileName&&(null==i?void 0:i.name)===e.name?(0,r.jsx)(ic.Z,{style:{color:"#fad114"}}):(0,r.jsx)(eL.Z,{}),onClick:()=>n((null==i?void 0:i.fileName)===e.fileName&&(null==i?void 0:i.name)===e.name?void 0:{type:"postprocessing",...e})}),(0,r.jsx)(iy,{simulation:{id:t.id},file:{name:e.name,fileName:e.fileName,originPath:e.originPath}}),e.name]},e.glb)):"No results"})})]})]})})},iz={plugins:"Unable to load plugins",update:"Unable to update simulation"},iA=(e,t)=>{tA.Z.list().then(l=>{let i=iL(e,tM.Z,l);t(i)}).catch(e=>{(0,E.lt)(iz.plugins,e)})},iL=(e,t,l)=>{let i=t;return l.forEach(t=>{var l;(null==e?void 0:null===(l=e.authorizedplugins)||void 0===l?void 0:l.includes(t.key))&&"Model"===t.category&&(i=[...i,...t.models])}),i},iR=e=>{let{visible:t,user:l,onOk:i,onCancel:n}=e,[a,s]=(0,c.useState)(),[o,d]=(0,c.useState)(!1),[u,m]=(0,c.useState)([]),[y,x]=(0,c.useState)(),[v,f]=(0,c.useState)();(0,c.useEffect)(()=>{l&&iA(l,m)},[l]),(0,c.useEffect)(()=>{let e=u.map(e=>e.category).filter((e,t,l)=>l.indexOf(e)===t).map(e=>({key:e,value:e}));x(e)},[u]);let g=(0,c.useCallback)(e=>{let{key:t}=e,l=u.find(e=>e.algorithm===t);s(tz.Z.deepCopy(l))},[u]),j=(0,c.useCallback)(e=>{let{key:t}=e,i=l.models.find(e=>e.algorithm===t);s(tz.Z.deepCopy(i))},[l]),b=[{key:"category",disabled:!0,label:(0,r.jsx)(tk.Z,{className:"full-width",options:y,allowClear:!0,showArrow:!1,placeholder:"Category filter",onChange:e=>f(e)})}];u.forEach(e=>{v&&e.category!==v||b.push({key:e.algorithm,label:e.name})});let w=[{key:"category",disabled:!0,label:(0,r.jsx)(tk.Z,{className:"full-width",options:y,allowClear:!0,showArrow:!1,placeholder:"Category filter",onChange:e=>f(e)})}];return l&&l.models.forEach(e=>{v&&e.category!==v||w.push({key:e.algorithm,label:e.name})}),(0,r.jsx)(tE.Z,{open:t,title:"Create simulation",okText:"Create",okButtonProps:{loading:o},async onOk(){if(d(!0),a)try{await i(a)}catch(e){}d(!1)},onCancel:()=>n(),width:"80%",children:(0,r.jsxs)(h.Z,{children:[(0,r.jsx)(h.Z.Sider,{theme:"light",width:300,children:(0,r.jsx)(tP.Z,{items:[{key:"tanatloc",label:"Tanatloc algorithm",children:(0,r.jsx)(p.Z,{mode:"inline",items:b,onSelect:g})},{key:"personal",label:"User algorithm",children:(0,r.jsx)(p.Z,{mode:"inline",items:w,onSelect:j})}]})}),(0,r.jsx)(h.Z.Content,{className:"simulation-selector",children:(0,r.jsx)(ee.Z.Html,{html:null==a?void 0:a.description})})]})})},iD=async(e,t,l)=>{try{let i=t.find(t=>{var l;return t.algorithm===(null==e?void 0:null===(l=e.scheme)||void 0===l?void 0:l.algorithm)}),n=tz.Z.deepCopy(e);(0,tT.merge)(n.scheme,i),await V.Z.update({id:e.id},[{key:"scheme",value:n.scheme}]),l.mutateOneSimulation(n)}catch(a){(0,E.lt)(iz.update,a)}},iF=e=>{let{user:t,simulation:l,swr:i}=e,[n,a]=(0,c.useState)([]);return(0,c.useEffect)(()=>{t&&iA(t,a)},[t]),(0,c.useEffect)(()=>{let e=n.find(e=>{var t;return e.algorithm===(null==l?void 0:null===(t=l.scheme)||void 0===t?void 0:t.algorithm)});if(e&&(null==l?void 0:l.scheme)){let t=(0,tN.Z)(l.scheme,e),a=(0,tO.Z)(l.scheme,e);(Object.keys(t).length||Object.keys(a).length)&&(tE.Z.info({title:"Update",content:"Your model need an update, please wait.",closable:!1,okButtonProps:{hidden:!0}}),iD(l,n,i).finally(()=>tE.Z.destroyAll()))}},[l,n,i]),null};var iI={Selector:iR,Updater:iF,About:tJ,Geometry:t1,Materials:lp,Parameters:lS,Initialization:lA,BoundaryConditions:lW,Run:iS,Postprocessing:iM};let iU=d()(()=>Promise.all([l.e(584),l.e(73),l.e(317)]).then(l.bind(l,7317)),{loadableGenerated:{webpack:()=>[7317]},ssr:!1}),iB={dashboard:{key:"dashboard"},geometries:{label:"GEOMETRIES",key:"geometries"},simulations:{label:"SIMULATIONS",key:"simulations"}},iV={user:"Unable to get user",project:"Unable to get project",simulations:"Unable to get simulations",geometries:"Unable to get geometries",add:"Unable to add simulation"},iH=(e,t,l)=>{e.push({pathname:"/dashboard",query:{page:t,workspaceId:l}})},iG=async(e,t,l)=>{try{let i=await V.Z.add({id:e.id},{name:t.name,scheme:t});l.addOneSimulation(i),l.mutateProject({id:e.id,simulations:[...e.simulations||[],i.id]})}catch(n){throw(0,E.lt)(iV.add,n),n}},iY=()=>{let e=(0,u.useRouter)(),{page:t,workspaceId:l,projectId:i}=e.query,[n,a]=(0,c.useState)(!1),[s,o]=(0,c.useState)(),[d,N]=(0,c.useState)(!1),[O,T]=(0,c.useState)(),[M,z]=(0,c.useState)(),[L,R]=(0,c.useState)(),[D,F]=(0,c.useState)(),[H,G]=(0,c.useState)(),[Y,J]=(0,c.useState)(!0),[W,{errorUser:X,loadingUser:q}]=U.Z.useUser(),[_,{mutateProject:Q,errorProject:ee,loadingProject:et}]=B.Z.useProject(i),[el,{addOneSimulation:ei,delOneSimulation:en,mutateOneSimulation:ea,errorSimulations:es,loadingSimulations:er}]=V.Z.useSimulations(null==_?void 0:_.simulations),[eo,{addOneGeometry:ed,delOneGeometry:eu,mutateOneGeometry:ec,errorGeometries:em,loadingGeometries:eh}]=K.useGeometries(null==_?void 0:_.geometries),ep=(0,c.useCallback)(()=>{G(void 0),F(void 0)},[]);(0,c.useEffect)(()=>{q||W||e.replace("/login")},[W,q,e]),(0,c.useEffect)(()=>{X&&(0,E.lt)(iV.user,X),ee&&(0,E.lt)(iV.project,ee),es&&(0,E.lt)(iV.simulations,es),em&&(0,E.lt)(iV.geometries,em)},[X,ee,es,em]),(0,c.useEffect)(()=>{et||eh?a(!1):eo.length?a(!1):a(!0)},[et,eh,eo]),(0,c.useEffect)(()=>{if(!eh&&s){let e=eo.find(e=>e.id===(null==s?void 0:s.id));e?JSON.stringify(e)!==JSON.stringify(s)&&o(e):o(void 0)}else o(eo[0])},[eo,s,eh,o]),(0,c.useEffect)(()=>{if(!er&&O){let e=el.find(e=>e.id===(null==O?void 0:O.id));e?JSON.stringify(e)!==JSON.stringify(O)&&T(e):(ep(),T(void 0))}},[el,O,er,T,ep]);let ey=(0,c.useCallback)(()=>{o({id:"0",needCleanup:!0})},[]),ex=(0,c.useCallback)(e=>{let t=eo.find(t=>t.id===e);t&&(o(t),G((0,r.jsx)($,{visible:!0,title:"Geometry",onClose:ep,children:(0,r.jsx)(ev,{project:{id:_.id,geometries:_.geometries},geometry:{id:t.id,name:t.name,summary:t.summary},swr:{mutateProject:Q,mutateOneGeometry:ec,delOneGeometry:eu},close:ep,onCleanup:ey})})))},[_,eo,Q,ec,eu,ey,ep]),ef=(0,c.useCallback)(e=>{G((0,r.jsx)($,{visible:!0,title:"About",onClose:ep,children:(0,r.jsx)(iI.About,{project:{id:_.id,simulations:_.simulations},simulation:{id:e.id,name:e.name,scheme:e.scheme},swr:{mutateProject:Q,addOneSimulation:ei,delOneSimulation:en,mutateOneSimulation:ea}})}))},[_,Q,ei,en,ea,ep]),eg=(0,c.useCallback)(e=>{G((0,r.jsx)($,{visible:!0,title:"Geometry",onClose:ep,children:(0,r.jsx)(iI.Geometry,{geometries:eo,geometry:s&&{id:s.id,summary:s.summary},simulation:{id:e.id,scheme:e.scheme},setGeometry:o,swr:{mutateOneSimulation:ea}})}))},[eo,s,ea,ep]),ej=(0,c.useCallback)(e=>{G((0,r.jsx)($,{visible:!0,title:"Parameters",onClose:ep,children:(0,r.jsx)(iI.Parameters,{simulation:{id:e.id,scheme:e.scheme},swr:{mutateOneSimulation:ea}})}))},[ea,ep]),eb=(0,c.useCallback)(e=>{G((0,r.jsx)($,{visible:Y,title:"Materials",onClose:ep,children:(0,r.jsx)(iI.Materials,{geometry:s&&{id:s.id,summary:s.summary},simulation:{id:e.id,scheme:e.scheme},swr:{mutateOneSimulation:ea},setVisible:e=>J(e)})}))},[s,Y,ea,ep]),ew=(0,c.useCallback)(e=>{G((0,r.jsx)($,{visible:!0,title:"Initialization",onClose:ep,children:(0,r.jsx)(iI.Initialization,{simulations:el,simulation:e,swr:{mutateOneSimulation:ea}})}))},[el,ea,ep]),eZ=(0,c.useCallback)(e=>{G((0,r.jsx)($,{visible:Y,title:"Boundary conditions",onClose:ep,children:(0,r.jsx)(iI.BoundaryConditions,{geometry:s&&{id:s.id,summary:s.summary},simulation:{id:e.id,scheme:e.scheme},swr:{mutateOneSimulation:ea},setVisible:e=>J(e)})}))},[s,Y,ea,ep]),eC=(0,c.useCallback)(e=>{G((0,r.jsx)($,{visible:Y,title:"Run",onClose:ep,children:(0,r.jsx)(iI.Run,{simulation:{id:e.id,scheme:e.scheme},result:M&&{name:M.name,fileName:M.fileName},setResult:z,setPostprocessing:R,setVisible:e=>J(e),swr:{mutateOneSimulation:ea}})}))},[M,Y,ea,ep]),eS=(0,c.useCallback)((e,t)=>{var l,i,n;let a=el.find(t=>t.id===e);if(!a)return;T(a);let r=null===(l=a.scheme)||void 0===l?void 0:null===(i=l.configuration)||void 0===i?void 0:null===(n=i.geometry)||void 0===n?void 0:n.value;if(r&&(null==s?void 0:s.id)!==r){let d=eo.find(e=>e.id===r);d&&o(d)}switch(t){case"about":ef(a);break;case"geometry":eg(a);break;case"parameters":ej(a);break;case"materials":eb(a);break;case"initialization":ew(a);break;case"boundaryConditions":eZ(a);break;case"run":eC(a);break;default:G(void 0)}},[s,eo,el,ef,eg,ej,eb,ew,eZ,eC]);(0,c.useEffect)(()=>{D&&(D.key===iB.geometries.key?ex(D.id):(eS(D.id,D.item),"run"!==D.item&&(z(void 0),R(void 0))))},[D,ex,eS,ep]),(0,c.useEffect)(()=>{!M&&L&&R(void 0)},[M,L]);let ek=(0,c.useCallback)(e=>{let t,{keyPath:l}=e,i=l.pop(),n=l.pop(),a=l.pop();a&&(t=a.split("&").pop()),F({key:i,id:n,item:t})},[]),eE=eo.map(e=>({key:e.id,icon:(0,r.jsx)(v.Z,{}),label:e.name})),eP=el.map(e=>{let t=e.scheme.configuration||{},l=[];Object.keys(t).forEach(i=>{if("dimension"===i)return;let n=t[i],a=(0,r.jsx)(f.Z,{style:{color:"green"}});n.error&&(a=(0,r.jsx)(g.Z,{style:{color:"red"}})),n.done||(a=(0,r.jsx)(j.Z,{style:{color:"orange"}})),"geometry"!==i||eo.filter(e=>e.id===n.value).length||eh||(a=(0,r.jsx)(j.Z,{style:{color:"orange"}}),n.done=null),l[n.index]={key:e.id+"&"+i,className:"Project-Menu-SubMenu-Simulations-SubMenu-MenuItem",disabled:!eo.length,icon:a,label:n.title}});let i=e.name;return e.scheme.user&&(i=(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(m.Z,{title:"User algorithm",placement:"right",children:(0,r.jsx)(b.Z,{style:{position:"absolute",top:0,left:14,fontSize:14,color:"#fad114"}})}),e.name]})),{key:e.id,className:"Project-Menu-SubMenu-Simulations-SubMenu",icon:(0,r.jsx)(w.Z,{}),label:i,children:[{key:e.id+"&about",className:"Project-Menu-SubMenu-Simulations-SubMenu-MenuItem",disabled:!eo.length,icon:(0,r.jsx)(f.Z,{style:{color:"green"}}),label:"About"},...l]}});return!W||q||et?(0,r.jsx)(P.Z.Simple,{}):"0"===_.id?(0,r.jsx)(A,{}):(0,r.jsx)(I,{children:(0,r.jsxs)(h.Z,{hasSider:!0,children:[(0,r.jsxs)(h.Z.Sider,{theme:"light",className:"Project-Sider",width:256,children:[(0,r.jsx)("div",{className:"logo",children:(0,r.jsx)("img",{src:"/images/logo.svg",alt:"Tanatloc"})}),(0,r.jsx)(p.Z,{mode:"inline",items:[{key:"menu-go-back",disabled:!0,className:"Project-Menu-GoBack",style:{cursor:"unset",margin:"10px 0",paddingLeft:10},label:(0,r.jsx)(k.ks,{onClick:()=>iH(e,t,l),children:"Return to dashboard"})},{type:"divider",className:"Project-Menu-Divider"},{key:"title",disabled:!0,className:"Project-Menu-Title",label:(0,r.jsx)(y.Z.Paragraph,{ellipsis:{tooltip:!0,rows:1},children:_.title})}]}),(0,r.jsx)("div",{className:"Project-Menu-scroll",children:(0,r.jsx)(p.Z,{className:"Project-Menu",mode:"inline",defaultOpenKeys:[iB.geometries.key,iB.simulations.key],items:[{key:iB.geometries.key,className:"Project-Menu-SubMenu-Geometries",icon:eh?(0,r.jsx)(Z.Z,{}):(0,r.jsx)(v.Z,{}),label:(0,r.jsxs)(y.Z.Text,{strong:!0,children:[iB.geometries.label," (",eo.length,")"]}),children:[{key:"new_geometry",className:"Project-Menu-SubMenu-Geometries-New",disabled:!0,label:(0,r.jsx)(x.Z,{icon:(0,r.jsx)(C.Z,{}),onClick:()=>a(!0),children:"New Geometry"})},{key:"geometry-needed",className:"text-dark "+(eo.length?"display-none":""),disabled:!0,icon:(0,r.jsx)(j.Z,{style:{color:"red"}}),label:"A Geometry is needed"},...eE]},{key:iB.simulations.key,className:"Project-Menu-SubMenu-Simulations",icon:er?(0,r.jsx)(Z.Z,{}):(0,r.jsx)(w.Z,{}),label:(0,r.jsxs)(y.Z.Text,{strong:!0,children:[iB.simulations.label," (",el.length,")"]}),children:[{key:"new_simulation",className:"Project-Menu-SubMenu-Simulations-New",disabled:!0,label:(0,r.jsx)(x.Z,{disabled:!eo.length,icon:(0,r.jsx)(S.Z,{}),onClick:()=>N(!0),children:"New Simulation"})},...eP]}],onClick:ek})})]}),(0,r.jsxs)(h.Z.Content,{className:"no-scroll relative",children:[(0,r.jsx)(ev.Add,{visible:n,project:{id:_.id,geometries:_.geometries},swr:{mutateProject:Q,addOneGeometry:ed},setVisible:e=>a(e)}),(0,r.jsx)(iI.Selector,{user:{authorizedplugins:W.authorizedplugins,models:W.models},visible:d,async onOk(e){try{await iG(_,e,{addOneSimulation:ei,mutateProject:Q}),N(!1)}catch(t){}},onCancel:()=>N(!1)}),(0,r.jsx)(iI.Updater,{user:{authorizedplugins:W.authorizedplugins},simulation:O&&{id:O.id,scheme:O.scheme},swr:{mutateOneSimulation:ea}}),H,(0,r.jsx)(tS,{project:{id:_.id,title:_.title},simulation:O&&{id:O.id},geometry:s&&{id:s.id,needCleanup:s.needCleanup},result:M&&{glb:M.glb,originPath:M.originPath},postprocessing:L&&{glb:L.glb,originPath:L.originPath}}),(0,r.jsx)(iU,{simulation:O&&{id:O.id,name:O.name}}),(0,r.jsx)(iI.Postprocessing,{simulation:O&&{id:O.id,scheme:O.scheme},result:M&&{name:M.name,fileName:M.fileName,originPath:M.originPath},postprocessing:L&&{name:L.name,fileName:L.fileName},setResult:R})]})]})})};var iJ=iY},64546:function(e,t,l){var i={"./local/src/components":[94295,295]};function n(e){if(!l.o(i,e))return Promise.resolve().then(function(){var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t});var t=i[e],n=t[0];return l.e(t[1]).then(function(){return l(n)})}n.keys=function(){return Object.keys(i)},n.id=64546,e.exports=n}}]);