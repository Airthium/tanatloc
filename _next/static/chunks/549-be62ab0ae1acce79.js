(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[549],{5094:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,{Z:function(){return avatar}});var call=__webpack_require__(11425);let add=async(file,project)=>{let response=await (0,call.R)("/api/avatar",{method:"POST",headers:{Accept:"application/json"},body:JSON.stringify({file,project})});return response.json()};var avatar={add:add}},71270:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,{Z:function(){return api_plugin}});var call=__webpack_require__(11425);let add=async plugin=>{await (0,call.R)("/api/plugin",{method:"POST",body:JSON.stringify(plugin)})},update=async plugin=>{await (0,call.R)("/api/plugin",{method:"PUT",body:JSON.stringify(plugin)})},del=async plugin=>{await (0,call.R)("/api/plugin",{method:"DELETE",body:JSON.stringify(plugin)})};var dist=__webpack_require__(8100),react=__webpack_require__(67294);let usePlugins=()=>{let{data,error,mutate}=(0,dist.ZP)("/api/plugin",call._),plugins=(null==data?void 0:data.plugins)||[],addOne=(0,react.useCallback)(plugin=>{let newPlugins=[...plugins,plugin];mutate({plugins:newPlugins})},[plugins,mutate]),delOne=(0,react.useCallback)(plugin=>{let filteredPlugins=plugins.filter(p=>p.key!==plugin.key);mutate({plugins:filteredPlugins})},[plugins,mutate]),mutateOne=(0,react.useCallback)(plugin=>{let mutatedPlugin=plugins.map(p=>(p.key===plugin.key&&(p={...p,...plugin}),p));mutate({plugins:mutatedPlugin})},[plugins,mutate]);return[plugins,{mutatePlugins:mutate,addOnePlugin:addOne,delOnePlugin:delOne,mutateOnePlugin:mutateOne,errorPlugins:error,loadingPlugins:!data}]};var api_plugin={add:add,update:update,del:del,usePlugins:usePlugins}},10843:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,{Z:function(){return plugins}});var call=__webpack_require__(11425);let list=async()=>{let response=await (0,call.R)("/api/plugins",{method:"GET",headers:{Accept:"application/json"}});return response.json()},completeList=async()=>{let response=await (0,call.R)("/api/plugins",{method:"POST",headers:{Accept:"application/json"}});return response.json()};var plugins={list:list,completeList:completeList}},26791:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,{Z:function(){return project}});var dist=__webpack_require__(8100),react=__webpack_require__(67294),call=__webpack_require__(11425);let useProjects=ids=>{let{data,error,mutate}=(0,dist.ZP)(["/api/projects",JSON.stringify({ids})],call._),projects=(null==data?void 0:data.projects)||[],addOne=(0,react.useCallback)(project=>{let newProjects=[...projects,{...project,users:[],geometries:[],simulations:[],groups:[]}];mutate({projects:newProjects})},[projects,mutate]),delOne=(0,react.useCallback)(project=>{let filteredProjects=projects.filter(p=>p.id!==project.id);mutate({projects:filteredProjects})},[projects,mutate]),mutateOne=(0,react.useCallback)(project=>{let mutatedProjects=projects.map(p=>(p.id===project.id&&(p={...p,...project}),p));mutate({projects:mutatedProjects})},[projects,mutate]);return[projects,{addOneProject:addOne,delOneProject:delOne,mutateOneProject:mutateOne,errorProjects:error,loadingProjects:!data}]},useProject=id=>{let{data,error,mutate}=(0,dist.ZP)("/api/project"+(id?"/"+id:""),call._),project=(null==data?void 0:data.project)||{id:"0"},localMutate=(0,react.useCallback)(update=>{let mutatedProject={...project,...update};mutate({project:mutatedProject})},[project,mutate]);return[project,{mutateProject:localMutate,errorProject:error,loadingProject:!data}]},add=async(workspace,project)=>{let response=await (0,call.R)("/api/project",{method:"POST",headers:{Accept:"application/json"},body:JSON.stringify({workspace:{id:workspace.id},project:project})});return response.json()},update=async(project,data)=>{await (0,call.R)("/api/project/"+project.id,{method:"PUT",body:JSON.stringify(data)})},del=async(workspace,project)=>{await (0,call.R)("/api/project/"+project.id,{method:"DELETE",body:JSON.stringify({id:workspace.id})})},archive=async project=>(0,call.R)("/api/project/"+project.id+"/archive",{method:"GET",headers:{Accept:"application/json"}}),unarchiveFromServer=async project=>(0,call.R)("/api/project/"+project.id+"/archive",{method:"PUT"}),deleteArchiveFile=async project=>(0,call.R)("/api/project/"+project.id+"/archive",{method:"DELETE"}),unarchiveFromFile=async(project,archive)=>(0,call.R)("/api/project/"+project.id+"/archive",{method:"POST",body:JSON.stringify({archive})});var project={useProjects:useProjects,useProject:useProject,add:add,update:update,del:del,archive:archive,unarchiveFromServer:unarchiveFromServer,deleteArchiveFile:deleteArchiveFile,unarchiveFromFile:unarchiveFromFile}},23853:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,{Z:function(){return simulation}});var dist=__webpack_require__(8100),react=__webpack_require__(67294),call=__webpack_require__(11425);let useSimulations=ids=>{let{data,error,mutate}=(0,dist.ZP)(["/api/simulations",JSON.stringify({ids})],call._),simulations=(null==data?void 0:data.simulations)||[],addOne=(0,react.useCallback)(simulation=>{let newSimulations=[...simulations,simulation];mutate({simulations:newSimulations})},[simulations,mutate]),delOne=(0,react.useCallback)(simulation=>{let filteredSimulations=simulations.filter(s=>s.id!==simulation.id);mutate({simulations:filteredSimulations})},[simulations,mutate]),mutateOne=(0,react.useCallback)((simulation,revalidate)=>{let mutatedSimulations=simulations.map(s=>(s.id===simulation.id&&(s={...s,...simulation}),s));mutate({simulations:mutatedSimulations},revalidate)},[simulations,mutate]);return[simulations,{addOneSimulation:addOne,delOneSimulation:delOne,mutateOneSimulation:mutateOne,errorSimulations:error,loadingSimulations:!data}]},useSimulation=(id,refresh)=>{let{data,error,mutate}=(0,dist.ZP)("/api/simulation"+(id?"/"+id:""),call._,{refreshInterval:refresh||0}),simulation=(null==data?void 0:data.simulation)||{id:"0"},localMutate=(0,react.useCallback)(update=>{mutate({simulation:{...simulation,...update}})},[simulation,mutate]);return[simulation,{mutateSimulation:localMutate,errorSimulation:error,loadingSimulation:!data}]},add=async(project,simulation)=>{let response=await (0,call.R)("/api/simulation",{method:"POST",headers:{Accept:"application/json"},body:JSON.stringify({project:{id:project.id},simulation:simulation})});return response.json()},update=async(simulation,data)=>{await (0,call.R)("/api/simulation/"+simulation.id,{method:"PUT",body:JSON.stringify(data)})},del=async simulation=>{await (0,call.R)("/api/simulation/"+simulation.id,{method:"DELETE"})},run=async simulation=>{await (0,call.R)("/api/simulation/"+simulation.id+"/run",{method:"GET"})},stop=async simulation=>{await (0,call.R)("/api/simulation/"+simulation.id+"/stop",{method:"GET"})},tasks=async simulation=>{let response=await (0,call.R)("/api/simulation/"+simulation.id+"/tasks",{method:"GET",headers:{Accept:"application/json"}});return response.json()},log=async(simulation,file)=>{let response=await (0,call.R)("/api/simulation/"+simulation.id+"/log",{method:"POST",body:JSON.stringify({file})});return response.json()};var simulation={useSimulations:useSimulations,useSimulation:useSimulation,add:add,update:update,del:del,run:run,stop:stop,tasks:tasks,log:log}},89549:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";let zoomInProgress;__webpack_require__.d(__webpack_exports__,{ZP:function(){return project}});var _value,_value2D,_value1,jsx_runtime=__webpack_require__(85893),dynamic=__webpack_require__(5152),dynamic_default=__webpack_require__.n(dynamic),next_router=__webpack_require__(11163),react=__webpack_require__(67294),tooltip=__webpack_require__(84908),layout=__webpack_require__(97183),menu=__webpack_require__(66516),typography=__webpack_require__(6880),es_button=__webpack_require__(71577),PieChartOutlined=__webpack_require__(48869),CheckCircleOutlined=__webpack_require__(8751),CloseCircleOutlined=__webpack_require__(18429),ExclamationCircleOutlined=__webpack_require__(11475),AuditOutlined=__webpack_require__(73480),CodeSandboxOutlined=__webpack_require__(22844),LoadingOutlined=__webpack_require__(50888),UploadOutlined=__webpack_require__(88484),PlusCircleOutlined=__webpack_require__(64789),assets_button=__webpack_require__(18436),notification=__webpack_require__(67582),loading=__webpack_require__(54666),card=__webpack_require__(81474),space=__webpack_require__(26713),AlertOutlined=__webpack_require__(20280);let errors={notAllowed:"You are not allowed to be here."},home=router=>{router.push("/")},NotAuthorized=()=>{let router=(0,next_router.useRouter)();return(0,react.useEffect)(()=>{router.prefetch("/")},[router]),(0,jsx_runtime.jsx)(layout.Z,{children:(0,jsx_runtime.jsx)(layout.Z.Content,{children:(0,jsx_runtime.jsx)(card.Z,{title:"Not allowed",children:(0,jsx_runtime.jsxs)(space.Z,{direction:"vertical",children:[(0,jsx_runtime.jsxs)(typography.Z.Text,{children:[(0,jsx_runtime.jsx)(AlertOutlined.Z,{style:{color:"red"}})," ",errors.notAllowed]}),(0,jsx_runtime.jsxs)(typography.Z.Text,{children:["Go back"," ",(0,jsx_runtime.jsx)(es_button.Z,{type:"link",onClick:()=>home(router),children:"home"})]})]})})})})},initialState={enabled:!1,type:void 0,part:void 0,highlighted:void 0,selected:[],point:void 0,dispatch:()=>void 0},select_actionTypes={ENABLE:"ENABLE",DISABLE:"DISABLE",CLEAR:"CLEAR",SETTYPE:"SETTYPE",SETPART:"SETPART",HIGHLIGHT:"HIGHLIGHT",UNHIGHLIGHT:"UNHIGHLIGHT",SELECT:"SELECT",UNSELECT:"UNSELECT",SETPOINT:"SETPOINT"},SelectContext=(0,react.createContext)(initialState),selectReducer=(state,action)=>{let index;switch(action.type){case select_actionTypes.ENABLE:return{...state,enabled:!0};case select_actionTypes.DISABLE:return{...state,enabled:!1,highlighted:void 0,selected:[]};case select_actionTypes.CLEAR:return{...initialState};case select_actionTypes.SETTYPE:return{...state,type:action.value};case select_actionTypes.SETPART:return{...state,part:action.value};case select_actionTypes.HIGHLIGHT:return{...state,highlighted:action.value};case select_actionTypes.UNHIGHLIGHT:return{...state,highlighted:void 0};case select_actionTypes.SELECT:if(-1===(index=state.selected.findIndex(item=>item.uuid===action.value.uuid)))return{...state,selected:[...state.selected,action.value]};return state;case select_actionTypes.UNSELECT:if(-1===(index=state.selected.findIndex(item=>item.uuid===action.value.uuid)))return state;return{...state,selected:[...state.selected.slice(0,index),...state.selected.slice(index+1)]};case select_actionTypes.SETPOINT:return{...state,point:action.value};default:return state}},SelectProvider=param=>{let{children}=param,[selectState,selectDispatch]=(0,react.useReducer)(selectReducer,initialState);return(0,jsx_runtime.jsx)(SelectContext.Provider,{value:{...selectState,dispatch:selectDispatch},children:children})};var api_user=__webpack_require__(55734),api_project=__webpack_require__(26791),api_simulation=__webpack_require__(23853),dist=__webpack_require__(8100),call=__webpack_require__(11425);let useGeometries=ids=>{let{data,error,mutate}=(0,dist.ZP)(["/api/geometries",JSON.stringify({ids})],call._),geometries=(null==data?void 0:data.geometries)||[],addOne=(0,react.useCallback)(geometry=>{let newGeometries=[...geometries,geometry];mutate({geometries:newGeometries})},[geometries,mutate]),delOne=(0,react.useCallback)(geometry=>{let filteredGeometries=geometries.filter(s=>s.id!==geometry.id);mutate({geometries:filteredGeometries})},[geometries,mutate]),mutateOne=(0,react.useCallback)(geometry=>{let mutatedGeometries=geometries.map(g=>(g.id===geometry.id&&(g={...g,...geometry}),g));mutate({geometries:mutatedGeometries})},[geometries,mutate]);return[geometries,{addOneGeometry:addOne,delOneGeometry:delOne,mutateOneGeometry:mutateOne,errorGeometries:error,loadingGeometries:!data}]},add=async(project,geometry)=>{let response=await (0,call.R)("/api/geometry",{method:"POST",body:JSON.stringify({project,geometry})});return response.json()},update=async(geometry,data)=>{await (0,call.R)("/api/geometry/"+geometry.id,{method:"PUT",body:JSON.stringify(data)})},del=async geometry=>{await (0,call.R)("/api/geometry/"+geometry.id,{method:"DELETE"})},download=async geometry=>{let response=await (0,call.R)("/api/geometry/"+geometry.id+"/download");return response.json()},getPart=async geometry=>{let response=await (0,call.R)("/api/geometry/"+geometry.id+"/part");return response.json()};var api_geometry={useGeometries:useGeometries,add:add,update:update,del:del,download:download,getPart:getPart},CloseOutlined=__webpack_require__(97937);let Panel=param=>{let{visible,title,children,onClose}=param;return(0,jsx_runtime.jsx)(card.Z,{className:"panel",bodyStyle:{maxHeight:"calc(100vh - 65px)",overflow:"auto",padding:0},title:title,extra:(0,jsx_runtime.jsx)(es_button.Z,{type:"text",icon:(0,jsx_runtime.jsx)(CloseOutlined.Z,{}),onClick:()=>onClose()}),style:{display:visible?"block":"none"},children:children})};var mathjax=__webpack_require__(35083),upload=__webpack_require__(78116),dialog=__webpack_require__(28345),Buffer=__webpack_require__(48764).lW;let add_errors={add:"Unable to add geometry"},beforeUpload=file=>file.name.toLowerCase().includes(".stp")||file.name.toLowerCase().includes(".step")||file.name.toLowerCase().includes(".dxf"),getFile=async file=>{let reader=new FileReader;return new Promise(resolve=>{reader.addEventListener("load",()=>{resolve(reader.result)}),reader.readAsArrayBuffer(file)})},onUpload=async(project,info,swr)=>{if("uploading"===info.file.status)return!0;if("done"===info.file.status){let buffer=await getFile(info.file.originFileObj);try{let geometry=await api_geometry.add({id:project.id},{name:info.file.name,uid:info.file.uid,buffer:Buffer.from(buffer)});swr.addOneGeometry(geometry),swr.mutateProject({id:project.id,geometries:[...project.geometries,geometry.id]})}catch(err){throw(0,notification.lt)(add_errors.add,err),err}}return!1},Add=param=>{let{visible,project,swr,setVisible}=param,[loading,setLoading]=(0,react.useState)(!1);return(0,jsx_runtime.jsx)(dialog.ZP,{title:"Upload geometry",visible:visible,onCancel:()=>setVisible(!1),cancelButtonProps:{loading:loading},children:(0,jsx_runtime.jsxs)(space.Z,{direction:"vertical",className:"full-width",children:[(0,jsx_runtime.jsx)(upload.Z,{className:"upload",action:"/api/noop",accept:".stp,.step,.dxf",showUploadList:!1,listType:"picture-card",beforeUpload:beforeUpload,async onChange(info){try{let load=await onUpload(project,info,swr);setLoading(load),setVisible(load)}catch(err){setLoading(!1)}},children:(0,jsx_runtime.jsx)("div",{children:loading?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(LoadingOutlined.Z,{style:{fontSize:25}}),(0,jsx_runtime.jsxs)("div",{style:{marginTop:8},children:[(0,jsx_runtime.jsx)("b",{children:"Loading"}),", converting, ..."]})]}):(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(UploadOutlined.Z,{style:{fontSize:25}}),(0,jsx_runtime.jsxs)("div",{style:{marginTop:8},children:[(0,jsx_runtime.jsx)("b",{children:"Choose a file"})," or drop it here"]})]})})}),(0,jsx_runtime.jsx)(typography.Z.Text,{children:(0,jsx_runtime.jsx)("p",{style:{color:"rgba(0, 0, 0, 0.45)",textAlign:"center"},children:"Native file format preferred: STEP (3D) or DXF (2D) file"})})]})})};var es_form=__webpack_require__(81579),input=__webpack_require__(69677);let Edit=param=>{let{visible,geometry,setVisible,onEdit}=param,[loading,setLoading]=(0,react.useState)(!1);return(0,jsx_runtime.jsx)(dialog.ZP,{title:"Edit the geometry's name",visible:visible,initialValues:{name:geometry.name},onCancel:()=>setVisible(!1),async onOk(values){setLoading(!0);try{await onEdit(values),setLoading(!1),setVisible(!1)}catch(err){throw setLoading(!1),err}},loading:loading,children:(0,jsx_runtime.jsx)(es_form.Z.Item,{name:"name",label:"Name:",rules:[{required:!0,message:"Name is required"}],children:(0,jsx_runtime.jsx)(input.Z,{})})})};var geometry_Buffer=__webpack_require__(48764).lW;let geometry_errors={download:"Unable to download geometry",update:"Unable to update geometry",del:"Unable to delete geometry"},onDownload=async geometry=>{try{let file=await api_geometry.download({id:geometry.id}),data=new File([geometry_Buffer.from(file.buffer).toString()],geometry.name+"."+file.extension),url=window.URL.createObjectURL(data),link=document.createElement("a");link.href=url,link.setAttribute("download",geometry.name+"."+file.extension),link.click(),link.remove()}catch(err){(0,notification.lt)(geometry_errors.download,err)}},onEdit=async(geometry,values,swr)=>{try{await api_geometry.update({id:geometry.id},[{key:"name",value:values.name}]),geometry.name=values.name,swr.mutateOneGeometry(geometry)}catch(err){throw(0,notification.lt)(geometry_errors.update,err),err}},onDelete=async(geometry,project,close,swr)=>{try{await api_geometry.del({id:geometry.id});let filteredGeometries=project.geometries.filter(g=>g!==geometry.id);swr.mutateProject({id:project.id,geometries:filteredGeometries}),swr.delOneGeometry(geometry),close()}catch(err){throw(0,notification.lt)(geometry_errors.del,err),err}},geometry_Geometry=param=>{var ref,ref1,ref2,ref3,ref4,ref5;let{project,geometry,swr,close,onCleanup}=param,[downloading,setDownloading]=(0,react.useState)(!1),[editVisible,setEditVisible]=(0,react.useState)(!1),[deleting,setDeleting]=(0,react.useState)(!1);return geometry?(0,jsx_runtime.jsx)(layout.Z,{children:(0,jsx_runtime.jsx)(layout.Z.Content,{children:(0,jsx_runtime.jsx)(card.Z,{size:"small",title:"Informations",actions:[(0,jsx_runtime.jsx)(assets_button.o6,{loading:downloading,async onDownload(){setDownloading(!0);try{await onDownload(geometry)}catch(err){}finally{setDownloading(!1)}}},"download"),(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)(Edit,{visible:editVisible,geometry:{id:null==geometry?void 0:geometry.id,name:null==geometry?void 0:geometry.name},setVisible:setEditVisible,onEdit:async value=>onEdit(geometry,value,swr)}),(0,jsx_runtime.jsx)(assets_button.w6,{onEdit:()=>setEditVisible(!0)})]},"edit"),(0,jsx_runtime.jsx)(assets_button.m1,{loading:deleting,text:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["Are you sure you want to delete the geometry"," ",(0,jsx_runtime.jsx)(typography.Z.Text,{strong:!0,children:geometry.name}),"?"]}),async onDelete(){setDeleting(!0);try{await onDelete(geometry,project,close,swr),onCleanup()}finally{setDeleting(!1)}}},"delete")],children:(0,jsx_runtime.jsxs)(space.Z,{direction:"vertical",className:"full-width",children:[(0,jsx_runtime.jsxs)(typography.Z.Text,{children:[(0,jsx_runtime.jsx)("span",{className:"text-light",children:"File:"})," ",geometry.name," "]}),(0,jsx_runtime.jsxs)(typography.Z.Text,{children:[(0,jsx_runtime.jsx)("span",{className:"text-light",children:"Unit:"})," ",(0,jsx_runtime.jsx)(mathjax.Z.Inline,{text:"m"})]}),(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[3===geometry.summary.dimension&&(0,jsx_runtime.jsxs)(typography.Z.Text,{children:[(0,jsx_runtime.jsx)("span",{className:"text-light",children:"Number of solids:"})," ",null!==(ref3=null===(ref=geometry.summary.solids)||void 0===ref?void 0:ref.length)&&void 0!==ref3?ref3:0]}),(0,jsx_runtime.jsxs)(typography.Z.Text,{children:[(0,jsx_runtime.jsx)("span",{className:"text-light",children:"Number of faces:"})," ",null!==(ref4=null===(ref1=geometry.summary.faces)||void 0===ref1?void 0:ref1.length)&&void 0!==ref4?ref4:0]}),2===geometry.summary.dimension&&(0,jsx_runtime.jsxs)(typography.Z.Text,{children:[(0,jsx_runtime.jsx)("span",{className:"text-light",children:"Number of edges:"})," ",null!==(ref5=null===(ref2=geometry.summary.edges)||void 0===ref2?void 0:ref2.length)&&void 0!==ref5?ref5:0]})]})]})})})}):(0,jsx_runtime.jsx)(loading.Z.Simple,{})};geometry_Geometry.Add=Add;let load=async(simulation,result)=>{let response=await (0,call.R)("/api/result",{method:"POST",headers:{Accept:"application/json"},body:JSON.stringify({simulation,result})});return response.json()},download_download=async(simulation,result)=>(0,call.R)("/api/result/download",{method:"POST",body:JSON.stringify({simulation,result})}),archive=async simulation=>(0,call.R)("/api/result/archive",{method:"POST",body:JSON.stringify({simulation})});var api_result={load:load,download:download_download,archive:archive},dropdown=__webpack_require__(13013),divider=__webpack_require__(27049),es_switch=__webpack_require__(94594),spin=__webpack_require__(11382),FundProjectionScreenOutlined=__webpack_require__(41428),BorderlessTableOutlined=__webpack_require__(38095),RadiusUprightOutlined=__webpack_require__(86350),ZoomOutOutlined=__webpack_require__(15668),ZoomInOutlined=__webpack_require__(35598),CompressOutlined=__webpack_require__(74317),SelectOutlined=__webpack_require__(49591),ScissorOutlined=__webpack_require__(19478),StopOutlined=__webpack_require__(87784),EyeInvisibleOutlined=__webpack_require__(90420),RetweetOutlined=__webpack_require__(75843),TableOutlined=__webpack_require__(15611),three_module=__webpack_require__(99477),v4=__webpack_require__(57632),TrackballControls=__webpack_require__(79753),RenderPass=__webpack_require__(54458),OutlinePass=__webpack_require__(58939),EffectComposer=__webpack_require__(24065),WebGL=__webpack_require__(54327);let ArrowHelper=color=>{let cylinderGeometry=new three_module.fHI(.025,.025,.8,50);cylinderGeometry.translate(0,.4,0);let cylinderMaterial=new three_module.vBJ({color:color}),cylinder=new three_module.Kj0(cylinderGeometry,cylinderMaterial),coneGeometry=new three_module.b_z(.05,.2,50);coneGeometry.translate(0,.9,0);let coneMaterial=new three_module.vBJ({color:color}),cone=new three_module.Kj0(coneGeometry,coneMaterial),arrow=new three_module.ZAu;arrow.type="ArrowHelper",arrow.add(cylinder),arrow.add(cone);let dispose=()=>{cylinderGeometry.dispose(),cylinderMaterial.dispose(),coneGeometry.dispose(),coneMaterial.dispose()};return arrow.dispose=dispose,arrow},LabelHelper=(renderer,text,parameters)=>{let canvas=document.createElement("canvas");canvas.width=(null==parameters?void 0:parameters.width)||256,canvas.height=256;let context=canvas.getContext("2d");context.fillStyle="grey",context.font="50px sans-serif",context.textAlign=(null==parameters?void 0:parameters.align)||"center",context.textBaseline="middle",context.fillText(text,canvas.width/2,canvas.height/2);let texture=new three_module.xEZ(canvas);texture.flipY=!0,texture.needsUpdate=!0;let material=new three_module.xeV({map:texture,transparent:!0,depthWrite:!1});material.map.anisotropy=renderer.capabilities.getMaxAnisotropy();let label=new three_module.jyi(material);label.type="LabelHelper",(null==parameters?void 0:parameters.position)&&label.position.copy(parameters.position),(null==parameters?void 0:parameters.scale)&&label.scale.setScalar(parameters.scale);let dispose=()=>{texture.dispose(),material.dispose()};return label.dispose=dispose,label},AxisHelper=function(renderer,camera){let{offsetWidth,offsetHeight,width,height}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{offsetWidth:0,offsetHeight:0,width:150,height:150},currentOffsetWidth=offsetWidth,currentOffsetHeight=offsetHeight,currentWidth=width,currentHeight=height,x=ArrowHelper("red");x.rotateZ(-Math.PI/2);let xLabel=LabelHelper(renderer,"X",{position:new three_module.Pa4(1.1,0,0)}),y=ArrowHelper("green"),yLabel=LabelHelper(renderer,"Y",{position:new three_module.Pa4(0,1.1,0)}),z=ArrowHelper("blue");z.rotateX(Math.PI/2);let zLabel=LabelHelper(renderer,"Z",{position:new three_module.Pa4(0,0,1.1)}),sphereGeometry=new three_module.xo$(.05,50,50),sphereMaterial=new three_module.vBJ({color:"black"}),sphere=new three_module.Kj0(sphereGeometry,sphereMaterial),mesh=new three_module.ZAu;mesh.type="AxisHelper",mesh.add(x),mesh.add(xLabel),mesh.add(y),mesh.add(yLabel),mesh.add(z),mesh.add(zLabel),mesh.add(sphere);let localScene=new three_module.xsS;localScene.add(mesh);let localCamera=new three_module.iKG(-1.2,1.2,1.2,-1.2,-2,2),resize=param=>{let{newOffsetWidth,newOffsetHeight,newWidth,newHeight}=param;currentOffsetWidth=newOffsetWidth,currentOffsetHeight=newOffsetHeight,currentWidth=newWidth,currentHeight=newHeight},render=()=>{renderer.setViewport(currentOffsetWidth,currentOffsetHeight,currentWidth,currentHeight),localCamera.rotation.copy(camera.rotation),renderer.render(localScene,localCamera)},dispose=()=>{sphereGeometry.dispose(),sphereMaterial.dispose(),mesh.children.forEach(child=>{("ArrowHelper"===child.type||"LabelHelper"===child.type)&&child.dispose()}),localScene.remove(mesh)};return{dispose,render,resize}},NavigationHelper=function(renderer,scene,camera,controls){let{offsetWidth,offsetHeight,width,height}=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{offsetWidth:0,offsetHeight:0,width:150,height:150},cubeColor="#d3d3d3",currentlyHighlighted=null,previouslyHighlighted=null,faces=[{text:"FRONT",normal:new three_module.Pa4(0,0,1),up:new three_module.Pa4(0,1,0)},{text:"BACK",normal:new three_module.Pa4(0,0,-1),up:new three_module.Pa4(0,1,0)},{text:"RIGHT",normal:new three_module.Pa4(1,0,0),up:new three_module.Pa4(0,1,0)},{text:"LEFT",normal:new three_module.Pa4(-1,0,0),up:new three_module.Pa4(0,1,0)},{text:"UP",normal:new three_module.Pa4(0,1,0),up:new three_module.Pa4(0,0,-1)},{text:"DOWN",normal:new three_module.Pa4(0,-1,0),up:new three_module.Pa4(0,0,1)}],faceGeometry=new three_module._12(75,75),edgeGeometry=new three_module.TOt(faceGeometry),hemisphereGeometry=new three_module.xo$(37.5,10,10,0,Math.PI,0),cube=new three_module.ZAu;faces.forEach(face=>{let canvas=document.createElement("canvas"),context=canvas.getContext("2d");canvas.width=canvas.height=256,context.fillStyle=cubeColor,context.fillRect(0,0,canvas.width,canvas.height),context.font="bold 50pt sans-serif",context.fillStyle="#000000",context.textAlign="center",context.textBaseline="middle",context.fillText(face.text,canvas.width/2,canvas.height/2);let texture=new three_module.ROQ(canvas);texture.needsUpdate=!0;let frontMaterial=new three_module.vBJ({map:texture}),backMaterial=new three_module.vBJ({color:cubeColor}),frontMesh=new three_module.Kj0(faceGeometry,frontMaterial),backMesh=new three_module.Kj0(faceGeometry,backMaterial);backMesh.rotateY(Math.PI);let edgeMaterial=new three_module.nls({color:"#ffffff"}),edgeMesh=new three_module.ejS(edgeGeometry,edgeMaterial),hemisphereMaterial=new three_module.vBJ({color:cubeColor,transparent:!0,opacity:.2}),hemisphereMesh=new three_module.Kj0(hemisphereGeometry,hemisphereMaterial),faceGroup=new three_module.ZAu;faceGroup.add(frontMesh,backMesh,edgeMesh,hemisphereMesh),faceGroup.lookAt(face.normal),faceGroup.translateZ(50),faceGroup.normal=face.normal,faceGroup.up=face.up,cube.add(faceGroup)});let light=new three_module.Mig("#ffffff",1),localScene=new three_module.xsS;localScene.add(cube),localScene.add(light);let localCamera=new three_module.iKG(-100,100,100,-100,-100,100);localCamera.position.z=2;let raycaster=new three_module.iMs,onMouseMove=event=>{let mouse=globalToLocal(event);isIn(mouse)?(currentlyHighlighted=intersect(mouse),highlight(),(null==currentlyHighlighted?void 0:currentlyHighlighted.uuid)!==(null==previouslyHighlighted?void 0:previouslyHighlighted.uuid)&&(unhighlight(),previouslyHighlighted=currentlyHighlighted)):(currentlyHighlighted=null,unhighlight())},globalToLocal=event=>{let node=event.target,rect=node.getBoundingClientRect(),X=event.clientX-rect.left,Y=event.clientY-rect.top,mouse=new three_module.FM8;return mouse.x=(X-offsetWidth)/width*2-1,mouse.y=-(2*((Y+height-rect.height+offsetHeight)/height))+1,mouse},isIn=mouse=>mouse.x>-1&&mouse.x<1&&mouse.y>-1&&mouse.y<1,intersect=mouse=>{let mouseCoords=new three_module.Pa4(mouse.x,mouse.y,-1);mouseCoords.unproject(localCamera);let cameraDir=new three_module.Pa4;localCamera.getWorldDirection(cameraDir),raycaster.set(mouseCoords,cameraDir);let intersects=raycaster.intersectObjects(localScene.children,!0);return intersects.length?intersects[0].object.parent:null},highlight=()=>{currentlyHighlighted&&currentlyHighlighted.children&&currentlyHighlighted.children.forEach(object=>{let mesh=object;mesh.material&&mesh.material.color&&(mesh.material.previousColor=mesh.material.color,mesh.material.color=new three_module.Ilk("#FAD114"))})},unhighlight=()=>{previouslyHighlighted&&previouslyHighlighted.children&&previouslyHighlighted.children.forEach(object=>{let mesh=object;mesh.material&&mesh.material.color&&(mesh.material.color=new three_module.Ilk(cubeColor))})},onMouseDown=event=>{if(currentlyHighlighted){let normal=currentlyHighlighted.normal,up=currentlyHighlighted.up,center=new three_module.Pa4;scene.boundingBox&&scene.boundingBox.getCenter(center);let distance=camera.position.distanceTo(controls.target),interval=normal.clone().multiplyScalar(distance),newPosition=center.add(interval);camera.position.copy(newPosition),camera.up.copy(up),currentlyHighlighted=null,unhighlight(),onMouseMove(event)}};renderer.domElement.addEventListener("pointermove",onMouseMove),renderer.domElement.addEventListener("pointerdown",onMouseDown);let resize=param=>{let{newOffsetWidth,newOffsetHeight,newWidth,newHeight}=param;offsetWidth=newOffsetWidth,offsetHeight=newOffsetHeight,width=newWidth,height=newHeight},render=()=>{renderer.setViewport(offsetWidth,offsetHeight,width,height),localCamera.rotation.copy(camera.rotation),renderer.render(localScene,localCamera)},dispose=()=>{renderer.domElement.removeEventListener("pointermove",onMouseMove),renderer.domElement.removeEventListener("pointerdown",onMouseDown),cube.children.forEach(group=>{group.children.forEach(child=>{child.geometry.dispose(),child.material.dispose()})}),localScene.remove(cube)};return{resize,render,dispose}},NumberHelper=number=>1e-12>Math.abs(number)?"0":Math.abs(number)>1e3||.001>Math.abs(number)?number.toExponential(2):number.toFixed(3),GridHelper=(renderer,scene,camera,controls)=>{let gridOffset,labelOffset,gridHelper;let getAxisDivions=size=>{let maxSize=Math.max(size.x,size.y,size.z),xDiv=Math.max(Math.ceil(size.x/maxSize*5),2),yDiv=Math.max(Math.ceil(size.y/maxSize*5),2),zDiv=Math.max(Math.ceil(size.z/maxSize*5),2);return new three_module.Pa4(xDiv,yDiv,zDiv)},createGrid=(width,height,widthDivs,heightDivs,rotate)=>{let grid=new three_module.ZAu,material=new three_module.nls({color:8947848}),og=new three_module.Pa4(-width/2,0,-height/2),stepX=width/(widthDivs-1),stepY=height/(heightDivs-1);for(let i=0;i<heightDivs;++i){let lineGeo=new three_module.u9r().setFromPoints([new three_module.Pa4(og.x,0,og.z+i*stepY),new three_module.Pa4(og.x+width,0,og.z+i*stepY)]);grid.add(new three_module.x12(lineGeo,material))}for(let i1=0;i1<widthDivs;++i1){let lineGeo1=new three_module.u9r().setFromPoints([new three_module.Pa4(og.x+i1*stepX,0,og.z),new three_module.Pa4(og.x+i1*stepX,0,og.z+height)]);grid.add(new three_module.x12(lineGeo1,material))}return null==rotate||rotate(grid),grid},createLabels=(start,end,axis,markingsNb)=>{let group=new three_module.ZAu,length=Math.abs(end-start),step=length/(markingsNb-1),pos=new three_module.Pa4().copy(axis).multiplyScalar(-length/2),stepDir=new three_module.Pa4().copy(axis).multiplyScalar(step),stepValue=start;for(let i=0;i<markingsNb;++i){let label=LabelHelper(renderer,NumberHelper(stepValue));label.position.copy(pos),group.add(label),pos.add(stepDir),stepValue+=step}return group},build=()=>{let boundingBox=scene.boundingBox,center=scene.boundingSphere.center,size=new three_module.Pa4(boundingBox.max.x-boundingBox.min.x,boundingBox.max.y-boundingBox.min.y,boundingBox.max.z-boundingBox.min.z),axisDivs=getAxisDivions(size);labelOffset=1*(gridOffset=.1*Math.max(size.x,size.y,size.z));let grid=new three_module.ZAu,gridXZ=createGrid(size.x,size.z,axisDivs.x,axisDivs.z),gridXY=createGrid(size.x,size.y,axisDivs.x,axisDivs.y,g=>{g.rotateX(Math.PI/2)}),gridYZ=createGrid(size.y,size.z,axisDivs.y,axisDivs.z,g=>{g.rotateZ(-Math.PI/2)});grid.add(gridXZ,gridXY,gridYZ);let labelsX=createLabels(boundingBox.min.x,boundingBox.max.x,new three_module.Pa4(1,0,0),axisDivs.x),labelsY=createLabels(boundingBox.min.y,boundingBox.max.y,new three_module.Pa4(0,1,0),axisDivs.y),labelsZ=createLabels(boundingBox.min.z,boundingBox.max.z,new three_module.Pa4(0,0,1),axisDivs.z);return grid.add(labelsX,labelsY,labelsZ),grid.position.set(center.x,center.y,center.z),grid.type="GridHelper",grid.dispose=dispose,grid},sign=value=>value<=0?-1:1,aMSign=value=>.5>=Math.abs(value)?1:-1,update=()=>{let boundingBox=scene.boundingBox,size=new three_module.Pa4(boundingBox.max.x-boundingBox.min.x,boundingBox.max.y-boundingBox.min.y,boundingBox.max.z-boundingBox.min.z),currentlyVisible=!1;scene.children.forEach(child=>{"GridHelper"===child.type&&(currentlyVisible=child.visible,scene.remove(child),child.dispose())}),gridHelper=build();let distanceToTarget=controls.object.position.distanceTo(controls.target);gridHelper.traverse(child=>{"LabelHelper"===child.type&&child.scale.setScalar(.05*distanceToTarget)});let camFwd=new three_module.Pa4;camera.getWorldDirection(camFwd);let scaleFactor=distanceToTarget/10/(controls.minDistance+.001),gridXZ=gridHelper.children[0],gridXY=gridHelper.children[1],gridYZ=gridHelper.children[2];gridXZ.position.set(0,sign(camFwd.y)*(size.y/2+gridOffset),0),gridXY.position.set(0,0,sign(camFwd.z)*(size.z/2+gridOffset)),gridYZ.position.set(sign(camFwd.x)*(size.x/2+gridOffset),0,0);let labelsX=gridHelper.children[3],labelsY=gridHelper.children[4],labelsZ=gridHelper.children[5];labelsX.position.set(0,sign(camFwd.y)*aMSign(camFwd.y)*(size.y/2+labelOffset),-(sign(camFwd.z)*aMSign(camFwd.y)*(size.z/2+labelOffset))),labelsY.position.set(sign(camFwd.x)*aMSign(camFwd.x)*(size.x/2+labelOffset),0,-(sign(camFwd.z)*aMSign(camFwd.x)*(size.z/2+labelOffset))),labelsZ.position.set(sign(camFwd.x)*aMSign(camFwd.x)*(size.x/2+labelOffset),-(sign(camFwd.y)*aMSign(camFwd.x)*(size.y/2+labelOffset)),0);let verticalVisibilityThreshold=.2*scaleFactor,horizontalVisibilityThreshold=.3*scaleFactor;labelsX.visible=Math.abs(camFwd.y)>verticalVisibilityThreshold||Math.abs(camFwd.z)>horizontalVisibilityThreshold,labelsY.visible=Math.abs(camFwd.x)>horizontalVisibilityThreshold||Math.abs(camFwd.z)>horizontalVisibilityThreshold,labelsZ.visible=Math.abs(camFwd.x)>horizontalVisibilityThreshold||Math.abs(camFwd.y)>verticalVisibilityThreshold,gridHelper.visible=currentlyVisible,scene.add(gridHelper)},setVisible=visible=>{gridHelper.visible=visible},dispose=()=>{null==gridHelper||gridHelper.children.forEach(group=>{group.children.forEach(child=>{if("Line"===child.type){let geometry=child.geometry;geometry.dispose();let material=child.material;material.dispose()}else child.dispose()})})};return{dispose,setVisible,update}},SelectionHelper=(renderer,scene,camera,controls)=>{let element=document.createElement("div");element.style.pointerEvents="none",element.style.border="1px solid #55aaff",element.style.backgroundColor="rgba(75, 160, 255, 0.3)",element.style.position="fixed";let startPoint=new three_module.FM8,endPoint=new three_module.FM8,pointTopLeft=new three_module.FM8,pointBottomRight=new three_module.FM8,enabled=!1,down=!1,raycaster=new three_module.iMs,start=()=>{enabled=!0},end=()=>{enabled=!1},onMouseDown=event=>{enabled&&0===event.button&&(down=!0,onSelectStart(event))},onMouseMove=event=>{enabled&&down&&onSelectMove(event)},onMouseUp=event=>{down=!1,enabled&&onSelectEnd(event)};renderer.domElement.addEventListener("pointerdown",onMouseDown),renderer.domElement.addEventListener("pointermove",onMouseMove),renderer.domElement.addEventListener("pointerup",onMouseUp);let onSelectStart=event=>{controls.enabled=!1,renderer.domElement.parentElement.appendChild(element),element.style.left=event.clientX+"px",element.style.top=event.clientY+"px",element.style.width="0px",element.style.height="0px",startPoint.x=event.clientX,startPoint.y=event.clientY},onSelectMove=event=>{pointBottomRight.x=Math.max(startPoint.x,event.clientX),pointBottomRight.y=Math.max(startPoint.y,event.clientY),pointTopLeft.x=Math.min(startPoint.x,event.clientX),pointTopLeft.y=Math.min(startPoint.y,event.clientY),element.style.left=pointTopLeft.x+"px",element.style.top=pointTopLeft.y+"px",element.style.width=pointBottomRight.x-pointTopLeft.x+"px",element.style.height=pointBottomRight.y-pointTopLeft.y+"px"},onSelectEnd=event=>{controls.enabled=!0,element.parentElement&&element.parentElement.removeChild(element),endPoint.x=event.clientX,endPoint.y=event.clientY;let selectionRect=new three_module.TUj(startPoint,endPoint);zoomToRect(selectionRect),end()},zoomToRect=rect=>{let size=new three_module.FM8;if(rect.getSize(size),size.x<5||size.y<5)return;let center=new three_module.FM8((rect.max.x+rect.min.x)/2,(rect.max.y+rect.min.y)/2),parentRect=renderer.domElement.getBoundingClientRect(),X=center.x-parentRect.left,Y=center.y-parentRect.top,raycasterCenter=new three_module.FM8(X/parentRect.width*2-1,-(2*(Y/parentRect.height))+1),object=scene.children.find(child=>"Part"===child.type);if(!object)return;raycaster.setFromCamera(raycasterCenter,camera);let intersects=raycaster.intersectObject(object);if(!intersects.length)return;controls.target.copy(intersects[0].point);let ratio=new three_module.FM8(size.x/parentRect.width,size.y/parentRect.height),maxRatio=Math.max(ratio.x,ratio.y),distance=camera.position.distanceTo(controls.target),translation=controls.target.clone().sub(camera.position).normalize().multiplyScalar(distance*(1-maxRatio));camera.position.add(translation)},dispose=()=>{renderer.domElement.removeEventListener("pointerdown",onMouseDown),renderer.domElement.removeEventListener("pointermove",onMouseMove),renderer.domElement.removeEventListener("pointerup",onMouseUp)};return{dispose,end,isEnabled:()=>enabled,start}},SectionViewHelper=(renderer,scene,camera,controls)=>{let highlighted,isDown,control;let baseColor=new three_module.Ilk("#fad114"),highlightColor=new three_module.Ilk("#E98A15"),defaultNormal=new three_module.Pa4(-1,0,0),clippingPlane=new three_module.JOQ(defaultNormal),cameraDirections={up:new three_module.Pa4,forward:new three_module.Pa4,right:new three_module.Pa4},initialPosition=new three_module.Pa4,controlIntersection=new three_module.Pa4,controlRotation=new three_module.USm,controlRotationAxis=new three_module.Pa4,controlMouse=new three_module.FM8,controlPlane=new three_module.JOQ,controlOffset=new three_module.Pa4,controlNormal=new three_module.Pa4,controlLine=new three_module.Zzh,controlLineDirections={up:new three_module.Pa4,forward:new three_module.Pa4,right:new three_module.Pa4},raycaster=new three_module.iMs,controller=new three_module.ZAu;controller.type="SectionViewHelper",controller.visible=!1,scene.add(controller),(()=>{let geometry=new three_module._12(1,1),material=new three_module.vBJ({color:baseColor,side:three_module.ehD,transparent:!0,opacity:.5}),plane=new three_module.Kj0(geometry,material);plane.type="Plane",controller.add(plane)})(),(()=>{let geometry=new three_module.xo$(.2,32,32,Math.PI,-Math.PI),material=new three_module.vBJ({color:baseColor,side:three_module.ehD,transparent:!0,opacity:.5}),dome=new three_module.Kj0(geometry,material);dome.type="Dome",controller.add(dome)})(),(()=>{class ArcCurve extends three_module.Hyl{getPoint(t){return new three_module.Pa4().set(this.radius*Math.cos(Math.PI*t),this.radius*Math.sin(Math.PI*t),0)}constructor(_radius){super(),this.radius=_radius}}let curve=new ArcCurve(.2);{let geometry=new three_module.WXh(curve,32,.020000000000000004,32),material=new three_module.vBJ({color:baseColor,side:three_module.ehD,transparent:!0,opacity:.5}),arcX=new three_module.Kj0(geometry,material);arcX.rotateX(Math.PI/2),arcX.type="ArcX",controller.add(arcX)}{let geometry1=new three_module.WXh(curve,32,.020000000000000004,32),material1=new three_module.vBJ({color:baseColor,side:three_module.ehD,transparent:!0,opacity:.5}),arcY=new three_module.Kj0(geometry1,material1);arcY.rotateX(Math.PI/2),arcY.rotateY(Math.PI/2),arcY.type="ArcY",controller.add(arcY)}})();let setScale=()=>{let size=new three_module.Pa4;scene.boundingBox.getSize(size),size.multiplyScalar(1.2);let maxSize=Math.max(Math.max(size.x,size.y),size.z);controller.scale.setScalar(maxSize)},setCenter=()=>{let center=new three_module.Pa4;scene.boundingBox.getCenter(center),controller.position.copy(center)},toggleVisible=()=>{let visible=controller.visible;controller.visible=!visible},start=()=>{renderer.localClippingEnabled=!0,controller.visible=!0,setScale(),setCenter();let lookAt=new three_module.Pa4().copy(controller.position).sub(defaultNormal);controller.lookAt(lookAt),clippingPlane.setFromNormalAndCoplanarPoint(defaultNormal,controller.position)},stop=()=>{renderer.localClippingEnabled=!1,controller.visible=!1},toAxis=normal=>{if(setCenter(),defaultNormal.equals(normal)){flip();return}let lookAt=new three_module.Pa4().copy(controller.position).sub(normal);controller.lookAt(lookAt),clippingPlane.setFromNormalAndCoplanarPoint(normal,controller.position),defaultNormal.copy(normal)},flip=()=>{controller.rotateX(Math.PI);let normal=clippingPlane.normal.multiplyScalar(-1);clippingPlane.setFromNormalAndCoplanarPoint(normal,controller.position)},dispose=()=>{controller.traverse(child=>{("Plane"===child.type||"Dome"===child.type||"ArcX"===child.type||"ArcY"===child.type)&&(child.geometry.dispose(),child.material.dispose())}),renderer.domElement.removeEventListener("pointermove",onMouseMove),renderer.domElement.removeEventListener("pointerdown",onMouseDown),renderer.domElement.removeEventListener("pointerup",onMouseUp)},globalToLocal=event=>{let node=event.target,rect=node.getBoundingClientRect(),X=event.clientX-rect.left,Y=event.clientY-rect.top,mouse=new three_module.FM8;return mouse.x=X/rect.width*2-1,mouse.y=-(2*(Y/rect.height))+1,mouse},highlight=mesh=>{highlighted&&highlighted.material.color.set(baseColor),highlighted=mesh,mesh&&mesh.material.color.set(highlightColor)},enableControls=()=>{controls.enabled=!0},disableControls=()=>{controls.enabled=!1},setCameraDirections=()=>{camera.getWorldDirection(cameraDirections.forward),cameraDirections.forward.normalize(),cameraDirections.up.copy(camera.up).normalize(),cameraDirections.right.crossVectors(cameraDirections.up,cameraDirections.forward).normalize()},updateClippingPlane=()=>{let normal=new three_module.Pa4(0,0,1).applyQuaternion(controller.quaternion).multiplyScalar(-1);clippingPlane.setFromNormalAndCoplanarPoint(normal,controller.position)},onMouseMove=event=>{if(!controller.visible)return;let mouse=globalToLocal(event);if(raycaster.setFromCamera(mouse,camera),isDown){let intersection=new three_module.Pa4;raycaster.ray.intersectPlane(controlPlane,intersection),(null==control?void 0:control.type)==="Plane"?planeMove(intersection):(null==control?void 0:control.type)==="Dome"?domeMove(mouse):arcMove(intersection),updateClippingPlane()}else{let intersects=raycaster.intersectObject(controller);intersects.length?(disableControls(),highlight(control=intersects[0].object),controlIntersection.copy(intersects[0].point),setCameraDirections()):(control=null,highlight(),enableControls())}},planeControl=()=>{controlPlane.setFromNormalAndCoplanarPoint(cameraDirections.forward,controlIntersection),initialPosition.copy(controller.position);let intersection=new three_module.Pa4;raycaster.ray.intersectPlane(controlPlane,intersection),controlOffset.copy(intersection).sub(initialPosition),controlNormal.copy(controlOffset).normalize(),controlLine.set(initialPosition,new three_module.Pa4().copy(initialPosition).add(clippingPlane.normal))},planeMove=point=>{point.sub(controlOffset);let controlPoint=new three_module.Pa4;controlLine.closestPointToPoint(point,!1,controlPoint),controller.position.copy(controlPoint)},domeControl=mouse=>{controlRotation.copy(controller.rotation),controlMouse.copy(mouse)},domeMove=mouse=>{controller.rotation.copy(controlRotation),controller.rotateOnWorldAxis(cameraDirections.up,-(5*(controlMouse.x-mouse.x))),controller.rotateOnWorldAxis(cameraDirections.right,-(5*(controlMouse.y-mouse.y)))},arcControl=()=>{control.getWorldDirection(controlRotationAxis),controlRotation.copy(controller.rotation),controlOffset.copy(controlIntersection).sub(controller.position),controlNormal.copy(controlOffset).normalize(),controlLineDirections.up.copy(controlNormal),controlLineDirections.right.copy(controlRotationAxis),controlLineDirections.forward.crossVectors(controlLineDirections.right,controlLineDirections.up),controlLine.set(controlIntersection,new three_module.Pa4().copy(controlIntersection).add(controlLineDirections.forward)),controlPlane.setFromNormalAndCoplanarPoint(cameraDirections.forward,controlIntersection)},arcMove=point=>{let distanceToTarget=controls.object.position.distanceTo(controls.target),controlPoint=new three_module.Pa4;controlLine.closestPointToPoint(point,!1,controlPoint);let distance=controlIntersection.distanceTo(controlPoint);controlPoint.sub(controlIntersection);let controlCross=new three_module.Pa4().copy(controlNormal).cross(controlPoint).normalize(),sign=Math.sign(controlRotationAxis.dot(controlCross));controller.rotation.copy(controlRotation),controller.rotateOnWorldAxis(controlRotationAxis,sign*distance*1/(distanceToTarget/100))},setControl=mouse=>{switch(null==control?void 0:control.type){case"Plane":planeControl();break;case"Dome":domeControl(mouse);break;case"ArcX":case"ArcY":arcControl()}},onMouseDown=event=>{if(controller.visible&&control){isDown=!0;let mouse=globalToLocal(event);setControl(mouse)}},onMouseUp=()=>{controller.visible&&(isDown=!1,highlight())};return renderer.domElement.addEventListener("pointermove",onMouseMove),renderer.domElement.addEventListener("pointerdown",onMouseDown),renderer.domElement.addEventListener("pointerup",onMouseUp),{getClippingPlane:()=>clippingPlane,toggleVisible,start,stop,toAxis,flip,dispose}};var Lut=__webpack_require__(54104);let ColorbarHelper=renderer=>{let colorScene=new three_module.xsS,colorCamera=new three_module.iKG(-1,1,1,-1,2,1);colorCamera.position.set(0,0,1);let group=new three_module.ZAu;colorScene.add(group);let setVisible=visible=>{colorScene.children.forEach(group=>{group.children.forEach(child=>child.visible=visible)})},clearScene=()=>{colorScene.children.forEach(group=>group.children.forEach(child=>{"LabelHelper"===child.type&&child.dispose(),"Sprite"===child.type&&child.dispose(),group.remove(child)}))},setLUT=lutData=>{clearScene();let lut=new Lut.A("rainbow",lutData.n);lut.setMin(lutData.minV),lut.setMax(lutData.maxV);let map=new three_module.ROQ(lut.createCanvas()),material=new three_module.xeV({map:map,depthWrite:!1}),sprite=new three_module.jyi(material);sprite.material.rotation=-Math.PI/2,sprite.scale.x=.2,sprite.scale.y=1.2,sprite.dispose=sprite.material.dispose,group.add(sprite),setLabels(lut)},setLabels=lut=>{let min=NumberHelper(lut.minV),max=NumberHelper(lut.maxV),minLabel=LabelHelper(renderer,String(min),{position:new three_module.Pa4(-.62,0,0),width:512,align:"right"});minLabel.scale.x=.4,minLabel.scale.y=2.8;let maxLabel=LabelHelper(renderer,String(max),{position:new three_module.Pa4(.62,0,0),width:512,align:"left"});maxLabel.scale.x=.4,maxLabel.scale.y=2.8,group.add(minLabel),group.add(maxLabel)},render=()=>{let rect=renderer.domElement.getBoundingClientRect();renderer.setViewport(rect.width/2-350,rect.height-50,700,50),renderer.render(colorScene,colorCamera)},dispose=()=>{clearScene()};return{render,setLUT,setVisible,dispose}},PointHelper=scene=>{let group=new three_module.ZAu;group.type="PointHelper",group.visible=!1,scene.add(group);let buildSphere=()=>{var ref,ref1;let radius=(null!==(ref1=null===(ref=scene.boundingSphere)||void 0===ref?void 0:ref.radius)&&void 0!==ref1?ref1:1)/100,sphereGeometry=new three_module.xo$(radius),sphereMaterial=new three_module.Wid({color:16711680});return new three_module.Kj0(sphereGeometry,sphereMaterial)},buildLine=(point1,point2)=>{let lineGeometry=new three_module.u9r().setFromPoints([point1,point2]),lineMaterial=new three_module.nls({color:16711680});return new three_module.x12(lineGeometry,lineMaterial)},buildLines=()=>{let lines=[],xLength=scene.boundingBox.max.x-scene.boundingBox.min.x,yLength=scene.boundingBox.max.y-scene.boundingBox.min.y,zLength=scene.boundingBox.max.z-scene.boundingBox.min.z,length=Math.max(xLength,yLength,zLength),lineX=buildLine(new three_module.Pa4(-length/2,0,0),new three_module.Pa4(length/2,0,0));lines.push(lineX);let lineY=buildLine(new three_module.Pa4(0,-length/2,0),new three_module.Pa4(0,length/2,0));lines.push(lineY);let lineZ=buildLine(new three_module.Pa4(0,0,-length/2),new three_module.Pa4(0,0,length/2));return lines.push(lineZ),lines},build=()=>{dispose();let sphere=buildSphere(),lines=buildLines();group.add(sphere),group.add(...lines)},update=point=>{point?(group.position.set(point.x,point.y,point.z),group.visible=!0):group.visible=!1},dispose=()=>{group.children.forEach(child=>{group.remove(child),child.geometry.dispose(),child.material.dispose()})};return{build,dispose,update}};var GLTFLoader=__webpack_require__(1217),DRACOLoader=__webpack_require__(82854),KTX2Loader=__webpack_require__(6648),PartLoader_Buffer=__webpack_require__(48764).lW;let loadMesh=(object,clippingPlane)=>{object.traverse(child=>{if("Mesh"===child.type){let mesh=child,geometry=new three_module.Uk6(mesh.geometry),material=new three_module.nls({color:mesh.material.color,linewidth:1}),wireframe=new three_module.ejS(geometry,material);mesh.add(wireframe),mesh.material.visible=!1,mesh.material.clippingPlanes=[clippingPlane]}})},loadResult=(object,clippingPlane)=>{object.traverse(child=>{if("Mesh"===child.type||"Line"===child.type){let mesh=child,data=mesh.geometry.getAttribute("data");if(data){let min=data.array.reduce((m,currentValue)=>Math.min(m,currentValue),data.array[0]),max=data.array.reduce((m,currentValue)=>Math.max(m,currentValue),data.array[0]);min===max&&(min-=1,max+=1);let lut=new Lut.A;lut.setMin(min),lut.setMax(max);let vertexColors=new Float32Array(3*data.count);for(let i=0;i<data.count;i++){let vertexColor=lut.getColor(data.array[i]);vertexColors[3*i+0]=vertexColor.r,vertexColors[3*i+1]=vertexColor.g,vertexColors[3*i+2]=vertexColor.b}mesh.geometry.setAttribute("color",new three_module.a$l(vertexColors,3)),mesh.userData={...mesh.userData,lut}}if("Mesh"===child.type){let geometry=new three_module.Uk6(mesh.geometry),material=new three_module.nls({linewidth:1}),wireframe=new three_module.ejS(geometry,material);mesh.add(wireframe)}mesh.material.vertexColors=!0,mesh.material.clippingPlanes=[clippingPlane]}})},loadGeometry=(object,clippingPlane)=>{object.traverse(child=>{if("Mesh"===child.type){let mesh=child;mesh.material.clippingPlanes=[clippingPlane],mesh.material.originalColor=mesh.material.color}})},PartLoader=(mouseMoveEvent,mouseDownEvent)=>{let highlightColor=new three_module.Ilk("#FAD114"),selectColor=new three_module.Ilk("#EE9817"),load=async(part,transparent,displayMesh,clippingPlane)=>{let blob=new Blob([PartLoader_Buffer.from(part.buffer)]),url=URL.createObjectURL(blob),loader=new GLTFLoader.E,dracoLoader=new DRACOLoader._;dracoLoader.setDecoderPath("/three/libs/draco/"),loader.setDRACOLoader(dracoLoader);let ktx2Loader=new KTX2Loader.a;ktx2Loader.setTranscoderPath("node_modules/three//examples/js/libs/basis/"),loader.setKTX2Loader(ktx2Loader);let gltf=await new Promise((resolve,reject)=>{loader.load(url,glb=>{resolve(glb)},()=>void 0,err=>reject(err))}),scene=gltf.scene,object=new three_module.Tme;return object.type="Part",object.uuid=part.summary.uuid,object.children=scene.children,object.userData=scene.userData,"mesh"===part.summary.type?loadMesh(object,clippingPlane):"result"===part.summary.type?loadResult(object,clippingPlane):("geometry3D"===part.summary.type||"geometry2D"===part.summary.type)&&loadGeometry(object,clippingPlane),setTransparent(object,transparent),setDisplayMesh(object,displayMesh),object.boundingBox=computeBoundingBox(object),object.dispose=()=>dispose(object),object.setTransparent=transp=>setTransparent(object,transp),object.setDisplayMesh=disp=>setDisplayMesh(object,disp),object.startSelection=(renderer,camera,outlinePass,type)=>startSelection(object,renderer,camera,outlinePass,type),object.stopSelection=()=>stopSelection(),object.getHighlighted=()=>highlighted,object.getSelected=()=>selected,object.highlight=highlight,object.unhighlight=unhighlight,object.select=select,object.unselect=unselect,object},computeBoundingBox=part=>{let box=new three_module.ZzF;return part.traverse(child=>{box.expandByObject(child)}),box},dispose=part=>{part.traverse(child=>{"Mesh"===child.type&&(child.geometry.dispose(),child.material.dispose())})},setTransparent=(part,transparent)=>{part.traverse(child=>{if("Mesh"===child.type){let mesh=child;mesh.material.transparent=transparent,mesh.material.opacity=transparent?.5:1,mesh.material.depthWrite=!transparent}})},setDisplayMesh=(part,displayMesh)=>{"result"===part.userData.type&&part.traverse(child=>{child.traverse(subChild=>{if("LineSegments"===subChild.type){let mesh=subChild;mesh.visible=displayMesh}})})},raycaster=new three_module.iMs,selectionPart=null,selectionType=null,selectionRenderer=null,selectionCamera=null,selectionOutlinePass=null,highlighted=null,selected=[],startSelection=(part,renderer,camera,outlinePass,type)=>{selectionPart=part,selectionType=type,selectionRenderer=renderer,selectionCamera=camera,(selectionOutlinePass=outlinePass).selectedObjects=[],highlighted=null,selected.length=0,selectionRenderer.domElement.addEventListener("pointermove",mouseMove),selectionRenderer.domElement.addEventListener("pointerdown",mouseDown)},stopSelection=()=>{selectionRenderer&&selectionRenderer.domElement.removeEventListener("pointermove",mouseMove),selectionRenderer&&selectionRenderer.domElement.removeEventListener("pointerdown",mouseDown),unhighlight(),highlighted=null,selected.forEach(s=>{unselect(s.uuid)}),selected.length=0,selectionType=null,selectionPart=null,selectionRenderer=null,selectionCamera=null,selectionOutlinePass=null},findObject=(part,uuid)=>{let found;if(part&&uuid)return part.traverse(child=>{child.userData.uuid===uuid&&(found=child)}),found},globalToLocal=event=>{let node=event.target,rect=node.getBoundingClientRect(),X=event.clientX-rect.left,Y=event.clientY-rect.top,mouse=new three_module.FM8;return mouse.x=X/rect.width*2-1,mouse.y=-(2*(Y/rect.height))+1,mouse},solidsSelect=()=>{let intersects=raycaster.intersectObject(selectionPart,!0);if(intersects.length){let intersect=intersects[0].object,parent=intersect.parent;parent&&mouseMoveEvent(selectionPart,parent.userData.uuid,parent.userData.label)}else mouseMoveEvent(selectionPart)},facesSelect=()=>{let intersects;let summary=selectionPart.userData;if(2===summary.dimension){if((intersects=raycaster.intersectObject(selectionPart,!0)).length){let intersect=intersects[0].object,parent=intersect.parent;(null==parent?void 0:parent.type)==="Mesh"?mouseMoveEvent(selectionPart,parent.userData.uuid,parent.userData.label):mouseMoveEvent(selectionPart,intersect.userData.uuid,intersect.userData.label)}else mouseMoveEvent(selectionPart)}else if((intersects=raycaster.intersectObject(selectionPart,!0)).length){let intersect1=intersects[0].object;mouseMoveEvent(selectionPart,intersect1.userData.uuid,intersect1.userData.label)}else mouseMoveEvent(selectionPart)},edgesSelect=()=>{let intersects;let summary=selectionPart.userData,edges=summary.edges;if((intersects=raycaster.intersectObject(selectionPart,!0)).length){let intersect=intersects[0].object,edge=null==edges?void 0:edges.find(e=>e.uuid===intersect.userData.uuid);edge?mouseMoveEvent(selectionPart,intersect.userData.uuid,intersect.userData.label):mouseMoveEvent(selectionPart)}else mouseMoveEvent(selectionPart)},pointSelect=()=>{let intersects=raycaster.intersectObject(selectionPart,!0);if(intersects.length){let intersect=intersects[0];mouseMoveEvent(selectionPart,void 0,void 0,intersect.point)}else mouseMoveEvent(selectionPart)},mouseMove=event=>{let mouse=globalToLocal(event);switch(raycaster.setFromCamera(mouse,selectionCamera),selectionType){case"solids":solidsSelect();break;case"faces":facesSelect();break;case"edges":edgesSelect();break;case"point":pointSelect()}},addOutlineOn=(mesh,selection)=>{if(selection){let alreadyOutlined=selectionOutlinePass.selectedObjects.find(s=>s.userData.uuid===mesh.userData.uuid);alreadyOutlined||selectionOutlinePass.selectedObjects.push(mesh)}else{let alreadySelected=selected.find(s=>s.uuid===mesh.userData.uuid);alreadySelected||selectionOutlinePass.selectedObjects.push(mesh)}},removeOutlineOn=(mesh,selection)=>{if(selection){let outlinedIndex=selectionOutlinePass.selectedObjects.findIndex(s=>s.userData.uuid===mesh.userData.uuid);selectionOutlinePass.selectedObjects=[...selectionOutlinePass.selectedObjects.slice(0,outlinedIndex),...selectionOutlinePass.selectedObjects.slice(outlinedIndex+1)]}else{let selectedMesh=selected.find(s=>s.uuid===mesh.userData.uuid);if(!selectedMesh){let outlinedIndex1=selectionOutlinePass.selectedObjects.findIndex(s=>s.userData.uuid===mesh.userData.uuid);selectionOutlinePass.selectedObjects=[...selectionOutlinePass.selectedObjects.slice(0,outlinedIndex1),...selectionOutlinePass.selectedObjects.slice(outlinedIndex1+1)]}}},highlight=uuid=>{if(uuid===(null==highlighted?void 0:highlighted.uuid))return;unhighlight();let mesh=findObject(selectionPart,uuid);if(mesh){if(highlighted={uuid:mesh.userData.uuid,label:mesh.userData.label},addOutlineOn(mesh),"Mesh"===mesh.type){let partMesh=mesh;partMesh.material.color=highlightColor}else mesh.traverse(child=>{if("Mesh"===child.type){let subMesh=child;subMesh.material.color=highlightColor}})}},unhighlight=()=>{let mesh=findObject(selectionPart,null==highlighted?void 0:highlighted.uuid);if(highlighted=null,!mesh)return;removeOutlineOn(mesh);let index=selected.findIndex(s=>s.uuid===mesh.userData.uuid);if("Mesh"===mesh.type){let partMesh=mesh;partMesh.material.color=-1===index?partMesh.material.originalColor:selectColor}else mesh.traverse(child=>{if("Mesh"===child.type){let subMesh=child;subMesh.material.color=-1===index?subMesh.material.originalColor:selectColor}})},mouseDown=()=>{highlighted&&mouseDownEvent(selectionPart,highlighted.uuid,highlighted.label)},select=uuid=>{let mesh=findObject(selectionPart,uuid);if(mesh){if(selected.push({uuid,label:mesh.userData.label}),addOutlineOn(mesh,!0),"Mesh"===mesh.type){let partMesh=mesh;partMesh.material.color=selectColor}else mesh.traverse(child=>{if("Mesh"===child.type){let subMesh=child;subMesh.material.color=selectColor}})}},unselect=uuid=>{let mesh=findObject(selectionPart,uuid),index=selected.findIndex(s=>s.uuid===uuid);if(-1!==index&&(selected=[...selected.slice(0,index),...selected.slice(index+1)]),mesh){if(removeOutlineOn(mesh,!0),"Mesh"===mesh.type){let partMesh=mesh;partMesh.material.color=partMesh.material.originalColor}else mesh.traverse(child=>{if("Mesh"===child.type){let subMesh=child;subMesh.material.color=subMesh.material.originalColor}});mesh.visible=!0}};return{load}},enable=()=>({type:select_actionTypes.ENABLE}),disable=()=>({type:select_actionTypes.DISABLE}),setType=type=>({type:select_actionTypes.SETTYPE,value:type}),setPart=part=>({type:select_actionTypes.SETPART,value:part}),highlight=param=>{let{uuid,label}=param;return{type:select_actionTypes.HIGHLIGHT,value:{uuid,label}}},unhighlight=()=>({type:select_actionTypes.UNHIGHLIGHT}),actions_select=param=>{let{uuid,label}=param;return{type:select_actionTypes.SELECT,value:{uuid,label:label}}},unselect=param=>{let{uuid,label}=param;return{type:select_actionTypes.UNSELECT,value:{uuid,label:label}}},setPoint=point=>({type:select_actionTypes.SETPOINT,value:point});var avatar=__webpack_require__(5094);let three_errors={load:"Error while loading part",snapshot:"Error while taking snapshot",saveScreenshot:"Unable to save screenshot"},alreadyZoomToFit=!1,computeSceneBoundingSphere=scene=>{let box=new three_module.ZzF;scene.children.forEach(child=>{if(child.visible&&"Part"===child.type){let childBox=child.boundingBox,min=new three_module.Pa4(Math.min(box.min.x,childBox.min.x),Math.min(box.min.y,childBox.min.y),Math.min(box.min.z,childBox.min.z)),max=new three_module.Pa4(Math.max(box.max.x,childBox.max.x),Math.max(box.max.y,childBox.max.y),Math.max(box.max.z,childBox.max.z));box.set(min,max)}});let sphere=new three_module.aLr;box.getBoundingSphere(sphere),scene.boundingBox=box,scene.boundingSphere=sphere},zoom=(camera,controls,direction)=>{let targetDistance=controls.object.position.distanceTo(controls.target),translation=controls.target.clone().sub(camera.position).normalize().multiplyScalar(targetDistance*direction*.01);camera.position.add(translation)},zoomIn=(camera,controls)=>{zoom(camera,controls,1);let zoomInAnimationFrame=()=>zoomIn(camera,controls);zoomInProgress=requestAnimationFrame(zoomInAnimationFrame)},zoomOut=(camera,controls)=>{zoom(camera,controls,-1);let zoomOutAnimationFrame=()=>zoomOut(camera,controls);zoomInProgress=requestAnimationFrame(zoomOutAnimationFrame)},zoomStop=()=>{zoomInProgress&&cancelAnimationFrame(zoomInProgress),zoomInProgress=void 0},zoomToFit=(scene,camera,controls)=>{let onePart=scene.children.find(child=>"Part"===child.type);if(!onePart)return;alreadyZoomToFit=!0;let sphere=scene.boundingSphere,center=sphere.center,maxSize=2*sphere.radius,fitHeight=maxSize/(2*Math.atan(Math.PI*camera.fov/360)),fitWidth=fitHeight/camera.aspect,distance=1.1*Math.max(fitHeight,fitWidth),direction=controls.target.clone().sub(camera.position).normalize().multiplyScalar(distance);controls.target.copy(center),controls.minDistance=distance/10,controls.maxDistance=10*distance,camera.position.copy(center).sub(direction),camera.near=distance/100,camera.far=100*distance,camera.updateProjectionMatrix()},loadPart=async(part,scene,camera,controls,options,helpers,dispatch)=>{let mouseMoveEvent=(child,uuid,label,point)=>{uuid?(child.highlight(uuid),setTimeout(()=>dispatch(highlight({uuid,label:label})),1)):point?dispatch(setPoint({x:point.x,y:point.y,z:point.z})):(child.unhighlight(),setTimeout(()=>dispatch(unhighlight()),1))},mouseDownEvent=(child,uuid,number)=>{let selected=child.getSelected();selected.find(s=>s.uuid===uuid)?(child.unselect(uuid),setTimeout(()=>dispatch(unselect({uuid,label:number})),1)):(child.select(uuid),setTimeout(()=>dispatch(actions_select({uuid,label:number})),1))},loader=PartLoader(mouseMoveEvent,mouseDownEvent),mesh=await loader.load(part,options.transparent,options.displayMesh,helpers.sectionViewHelper.getClippingPlane());dispatch(setPart(mesh)),scene.add(mesh),computeSceneBoundingSphere(scene),alreadyZoomToFit||zoomToFit(scene,camera,controls),helpers.gridHelper.update(),helpers.gridHelper.update(),helpers.gridHelper.setVisible(!0),mesh.children[0].userData.lut?(helpers.colorbarHelper.setLUT(mesh.children[0].userData.lut),helpers.colorbarHelper.setVisible(!0)):helpers.colorbarHelper.setVisible(!1),helpers.pointHelper.build()},toggleGrid=(gridHelper,checked)=>{gridHelper.setVisible(checked)},takeScreenshot=async(project,scene,camera,renderer)=>{try{let initialWidth=renderer.domElement.width,initialHeight=renderer.domElement.height,initialAspect=camera.aspect;renderer.domElement.width=520,renderer.domElement.height=312,camera.aspect=520/312,camera.updateProjectionMatrix(),renderer.clear(),renderer.setViewport(0,0,520,312),renderer.render(scene,camera);let image=renderer.domElement.toDataURL();renderer.domElement.width=initialWidth,renderer.domElement.height=initialHeight,camera.aspect=initialAspect,camera.updateProjectionMatrix(),await avatar.Z.add({name:"snapshot",uid:"snapshot_"+(0,v4.Z)(),data:image},{id:project.id})}catch(err){(0,notification.lt)(three_errors.snapshot,err)}},downloadScreenshot=(project,scene,camera,renderer)=>{try{let initialWidth=renderer.domElement.width,initialHeight=renderer.domElement.height;renderer.clear(),renderer.setViewport(0,0,initialWidth,initialHeight),renderer.render(scene,camera);let image=renderer.domElement.toDataURL(),a=document.createElement("a");a.href=image.replace("image/png","image/octet-stream"),a.download=project.title+"_"+new Date().toLocaleDateString()+".png",a.click()}catch(err){(0,notification.lt)(three_errors.saveScreenshot,err)}},ThreeView=param=>{let{loading,project,part}=param,mount=(0,react.useRef)(null),scene=(0,react.useRef)(),camera=(0,react.useRef)(),renderer=(0,react.useRef)(),outlinePass=(0,react.useRef)(),effectComposer=(0,react.useRef)(),controls=(0,react.useRef)(),gridHelper=(0,react.useRef)(),selectionHelper=(0,react.useRef)(),sectionViewHelper=(0,react.useRef)(),colorbarHelper=(0,react.useRef)(),pointHelper=(0,react.useRef)(),[transparent,setTransparent]=(0,react.useState)(!1),[displayMesh,setDisplayMesh]=(0,react.useState)(!0),[sectionView,setSectionView]=(0,react.useState)(!1),[screenshot,setScreenshot]=(0,react.useState)(!1),[savingScreenshot,setSavingScreenshot]=(0,react.useState)(!1),router=(0,next_router.useRouter)(),{enabled:selectEnabled,part:selectPart,highlighted:selectHighlighted,selected:selectSelected,point:selectPoint,type:selectType,dispatch}=(0,react.useContext)(SelectContext);(0,react.useEffect)(()=>{let frameId;if(!WebGL.Z.isWebGLAvailable()){router.push("/webgl");return}let currentMount=mount.current,width=currentMount.clientWidth,height=currentMount.clientHeight;scene.current=new three_module.xsS,scene.current.boundingBox=new three_module.ZzF,scene.current.boundingSphere=new three_module.aLr,camera.current=new three_module.cPb(50,width/height,.1,1e3),camera.current.position.z=10;let ambientLight=new three_module.Mig("#aaa",.75);scene.current.add(ambientLight);let pointLight1=new three_module.cek("#fff",.5);pointLight1.decay=2,camera.current.add(pointLight1),scene.current.add(camera.current),renderer.current=new three_module.CP7({antialias:!0,alpha:!0}),renderer.current.setClearColor("#ffffff"),renderer.current.setSize(width,height),renderer.current.setPixelRatio(window.devicePixelRatio||1),renderer.current.shadowMap.enabled=!0,renderer.current.autoClear=!1,currentMount.appendChild(renderer.current.domElement);let renderPass=new RenderPass.C(scene.current,camera.current);outlinePass.current=new OutlinePass.f(new three_module.FM8(width,height),scene.current,camera.current),outlinePass.current.visibleEdgeColor.set("#FAD114"),outlinePass.current.hiddenEdgeColor.set("#FAD114"),effectComposer.current=new EffectComposer.xC(renderer.current),effectComposer.current.addPass(renderPass),effectComposer.current.addPass(outlinePass.current),controls.current=new TrackballControls.$(camera.current,currentMount),controls.current.rotateSpeed=3,controls.current.panSpeed=.1;let axisHelper=AxisHelper(renderer.current,camera.current,{offsetWidth:width-155,offsetHeight:height-155,width:150,height:150}),navigationHelper=NavigationHelper(renderer.current,scene.current,camera.current,controls.current,{offsetWidth:width-155,offsetHeight:height-155,width:150,height:150});gridHelper.current=GridHelper(renderer.current,scene.current,camera.current,controls.current),selectionHelper.current=SelectionHelper(renderer.current,scene.current,camera.current,controls.current),sectionViewHelper.current=SectionViewHelper(renderer.current,scene.current,camera.current,controls.current),colorbarHelper.current=ColorbarHelper(renderer.current),colorbarHelper.current.setVisible(!1),pointHelper.current=PointHelper(scene.current);let renderScene=()=>{controls.current.update(),renderer.current.setViewport(0,0,width,height),renderer.current.render(scene.current,camera.current),gridHelper.current.update(),effectComposer.current.render(),axisHelper.render(),navigationHelper.render(),colorbarHelper.current.render()},handleResize=()=>{width=currentMount.clientWidth,height=currentMount.clientHeight,camera.current.aspect=width/height,camera.current.updateProjectionMatrix(),renderer.current.setSize(width,height),effectComposer.current.setSize(width,height),axisHelper.resize({newOffsetWidth:width-155,newOffsetHeight:height-155,newWidth:150,newHeight:150}),navigationHelper.resize({newOffsetWidth:width-155,newOffsetHeight:height-155,newWidth:150,newHeight:150}),renderScene()},animate=()=>{stop(),renderScene(),frameId=requestAnimationFrame(animate)},stop=()=>{cancelAnimationFrame(frameId)};return window.addEventListener("resize",handleResize),frameId=requestAnimationFrame(animate),()=>{stop(),alreadyZoomToFit=!1,window.removeEventListener("resize",handleResize),currentMount.removeChild(renderer.current.domElement),scene.current.children.forEach(child=>{scene.current.remove(child)}),axisHelper.dispose(),navigationHelper.dispose(),gridHelper.current.dispose(),sectionViewHelper.current.dispose(),selectionHelper.current.dispose(),colorbarHelper.current.dispose(),pointHelper.current.dispose()}},[router]),(0,react.useEffect)(()=>{if(!scene.current)return;let currentPart=scene.current.children.find(child=>"Part"===child.type&&child.uuid===(null==part?void 0:part.summary.uuid));if(!currentPart){if(scene.current.children.forEach(child=>{"Part"===child.type&&(scene.current.remove(child),child.dispose())}),part)loadPart(part,scene.current,camera.current,controls.current,{transparent,displayMesh},{gridHelper:gridHelper.current,sectionViewHelper:sectionViewHelper.current,colorbarHelper:colorbarHelper.current,pointHelper:pointHelper.current},dispatch).catch(err=>{(0,notification.lt)(three_errors.load,err),computeSceneBoundingSphere(scene.current)});else{var ref;computeSceneBoundingSphere(scene.current),gridHelper.current.update(),null===(ref=pointHelper.current)||void 0===ref||ref.build()}}},[part,transparent,displayMesh,dispatch]),(0,react.useEffect)(()=>{if(scene.current){if((null==part?void 0:part.summary.dimension)===2){computeSceneBoundingSphere(scene.current);let normal=new three_module.Pa4(0,0,1),up=new three_module.Pa4(0,1,0),center=new three_module.Pa4;scene.current.boundingBox.getCenter(center);let distance=camera.current.position.distanceTo(controls.current.target),interval=normal.clone().multiplyScalar(distance),newPosition=center.add(interval);camera.current.position.copy(newPosition),camera.current.up.copy(up),controls.current.noRotate=!0}else controls.current.noRotate=!1}},[part]),(0,react.useEffect)(()=>{scene.current&&scene.current.children.forEach(child=>{"Part"===child.type&&child.uuid===(null==selectPart?void 0:selectPart.uuid)&&(selectEnabled?child.startSelection(renderer.current,camera.current,outlinePass.current,selectType):child.stopSelection())})},[selectEnabled,selectPart,selectType]),(0,react.useEffect)(()=>{scene.current&&scene.current.children.forEach(child=>{if("Part"===child.type&&child.uuid===(null==selectPart?void 0:selectPart.uuid)){child.highlight(null==selectHighlighted?void 0:selectHighlighted.uuid);let selected=child.getSelected(),plus=selectSelected.filter(s=>!selected.find(ss=>ss.uuid===s.uuid));plus.forEach(p=>{p.uuid&&child.select(p.uuid)});let minus=selected.filter(s=>!selectSelected.find(ss=>ss.uuid===s.uuid));minus.forEach(m=>{child.unselect(m.uuid)})}})},[selectPart,selectHighlighted,selectSelected]),(0,react.useEffect)(()=>{var ref;scene.current&&(null===(ref=pointHelper.current)||void 0===ref||ref.update(selectPoint?new three_module.Pa4(selectPoint.x,selectPoint.y,selectPoint.z):void 0))},[selectPoint]);let toggleTransparent=(0,react.useCallback)(checked=>{setTransparent(checked),scene.current.children.forEach(child=>{"Part"===child.type&&child.setTransparent(checked)})},[]),toggleDisplayMesh=(0,react.useCallback)(checked=>{setDisplayMesh(checked),scene.current.children.forEach(child=>{"Part"===child.type&&child.setDisplayMesh(checked)})},[]),toggleSectionView=(0,react.useCallback)(()=>{let active=!sectionView;setSectionView(active),active?sectionViewHelper.current.start():sectionViewHelper.current.stop()},[sectionView]);return(0,jsx_runtime.jsxs)(layout.Z,{className:"View no-scroll",children:[(0,jsx_runtime.jsx)(layout.Z.Header,{className:"View-header",children:(0,jsx_runtime.jsxs)("div",{className:"View-controls-main",children:[(0,jsx_runtime.jsx)(tooltip.Z,{title:"Take snasphot",placement:"right",children:(0,jsx_runtime.jsx)(dropdown.Z,{placement:"bottom",overlay:(0,jsx_runtime.jsx)(menu.Z,{items:[{key:"project",label:(0,jsx_runtime.jsx)(es_button.Z,{type:"text",loading:screenshot,async onClick(){setScreenshot(!0);try{await takeScreenshot(project,scene.current,camera.current,renderer.current)}finally{setScreenshot(!1)}},children:"Project snapshot"})},{key:"image",label:(0,jsx_runtime.jsx)(es_button.Z,{type:"text",loading:savingScreenshot,onClick(){setSavingScreenshot(!0);try{downloadScreenshot(project,scene.current,camera.current,renderer.current)}finally{setSavingScreenshot(!1)}},children:"Export image"})}]}),children:(0,jsx_runtime.jsx)(es_button.Z,{icon:(0,jsx_runtime.jsx)(FundProjectionScreenOutlined.Z,{})})})}),(0,jsx_runtime.jsx)(divider.Z,{className:"no-margin"}),(0,jsx_runtime.jsx)(tooltip.Z,{title:"Display grid",placement:"right",children:(0,jsx_runtime.jsx)(es_switch.Z,{defaultChecked:!0,checkedChildren:(0,jsx_runtime.jsx)(BorderlessTableOutlined.Z,{}),unCheckedChildren:(0,jsx_runtime.jsx)(BorderlessTableOutlined.Z,{}),onChange:checked=>toggleGrid(gridHelper.current,checked)})}),(0,jsx_runtime.jsx)(tooltip.Z,{title:"Set transparency",placement:"right",children:(0,jsx_runtime.jsx)(es_switch.Z,{checked:transparent,checkedChildren:(0,jsx_runtime.jsx)(RadiusUprightOutlined.Z,{}),unCheckedChildren:(0,jsx_runtime.jsx)(RadiusUprightOutlined.Z,{}),onChange:toggleTransparent})}),(0,jsx_runtime.jsx)(divider.Z,{className:"no-margin"}),(0,jsx_runtime.jsx)(tooltip.Z,{title:"Zoom out",placement:"right",children:(0,jsx_runtime.jsx)(es_button.Z,{icon:(0,jsx_runtime.jsx)(ZoomOutOutlined.Z,{}),onMouseDown:()=>zoomOut(camera.current,controls.current),onMouseUp:zoomStop,onMouseOut:zoomStop})}),(0,jsx_runtime.jsx)(tooltip.Z,{title:"Zoom in",placement:"right",children:(0,jsx_runtime.jsx)(es_button.Z,{icon:(0,jsx_runtime.jsx)(ZoomInOutlined.Z,{}),onMouseDown:()=>zoomIn(camera.current,controls.current),onMouseUp:zoomStop,onMouseOut:zoomStop})}),(0,jsx_runtime.jsx)(tooltip.Z,{title:"Zoom to fit",placement:"right",children:(0,jsx_runtime.jsx)(es_button.Z,{icon:(0,jsx_runtime.jsx)(CompressOutlined.Z,{}),onClick:()=>zoomToFit(scene.current,camera.current,controls.current)})}),(0,jsx_runtime.jsx)(tooltip.Z,{title:"Zoom to selection",placement:"right",children:(0,jsx_runtime.jsx)(es_button.Z,{icon:(0,jsx_runtime.jsx)(SelectOutlined.Z,{}),onClick:()=>selectionHelper.current.isEnabled()?selectionHelper.current.end():selectionHelper.current.start()})}),(0,jsx_runtime.jsx)(divider.Z,{className:"no-margin"}),!sectionView&&(0,jsx_runtime.jsx)(tooltip.Z,{title:"Section view",placement:"right",children:(0,jsx_runtime.jsx)(es_button.Z,{icon:(0,jsx_runtime.jsx)(ScissorOutlined.Z,{}),onClick:toggleSectionView})}),sectionView&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(tooltip.Z,{title:"Stop",placement:"left",children:(0,jsx_runtime.jsx)(es_button.Z,{icon:(0,jsx_runtime.jsx)(StopOutlined.Z,{}),onClick:toggleSectionView})}),(0,jsx_runtime.jsx)(tooltip.Z,{title:"Hide plane",placement:"left",children:(0,jsx_runtime.jsx)(es_button.Z,{icon:(0,jsx_runtime.jsx)(EyeInvisibleOutlined.Z,{}),onClick:()=>sectionViewHelper.current.toggleVisible()})}),(0,jsx_runtime.jsx)(tooltip.Z,{title:"Snap to X",placement:"left",children:(0,jsx_runtime.jsx)(es_button.Z,{className:"ant-btn-icon-only",onClick:()=>sectionViewHelper.current.toAxis(new three_module.Pa4(-1,0,0)),children:"X"})}),(0,jsx_runtime.jsx)(tooltip.Z,{title:"Snap to Y",placement:"left",children:(0,jsx_runtime.jsx)(es_button.Z,{className:"ant-btn-icon-only",onClick:()=>sectionViewHelper.current.toAxis(new three_module.Pa4(0,-1,0)),children:"Y"})}),(0,jsx_runtime.jsx)(tooltip.Z,{title:"Snap to Z",placement:"left",children:(0,jsx_runtime.jsx)(es_button.Z,{className:"ant-btn-icon-only",onClick:()=>sectionViewHelper.current.toAxis(new three_module.Pa4(0,0,-1)),children:"Z"})}),(0,jsx_runtime.jsx)(tooltip.Z,{title:"Flip",placement:"left",children:(0,jsx_runtime.jsx)(es_button.Z,{onClick:()=>sectionViewHelper.current.flip(),icon:(0,jsx_runtime.jsx)(RetweetOutlined.Z,{})})})]}),(null==part?void 0:part.summary.type)==="result"&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(divider.Z,{className:"no-margin"}),(0,jsx_runtime.jsx)(tooltip.Z,{title:"Display mesh",placement:"right",children:(0,jsx_runtime.jsx)(es_switch.Z,{checked:displayMesh,checkedChildren:(0,jsx_runtime.jsx)(TableOutlined.Z,{}),unCheckedChildren:(0,jsx_runtime.jsx)(TableOutlined.Z,{}),onChange:toggleDisplayMesh})})]})]})}),(0,jsx_runtime.jsxs)(layout.Z.Content,{className:"View-content no-scroll",children:[(0,jsx_runtime.jsx)("div",{style:{display:loading?"flex":"none"},className:"View-loading",children:(0,jsx_runtime.jsx)(spin.Z,{indicator:(0,jsx_runtime.jsx)(LoadingOutlined.Z,{className:"View-loading-spin",style:{fontSize:80},spin:!0})})}),(0,jsx_runtime.jsx)("div",{ref:mount,className:"View-canvas"})]})]})},view_errors={part:"Unable to load part"},view_loadPart=async(simulation,file,type)=>{try{if("geometry"===type)return await api_geometry.getPart({id:file.id});return await api_result.load({id:simulation.id},{originPath:file.originPath,glb:file.glb})}catch(err){throw(0,notification.lt)(view_errors.part,err),err}},View=param=>{let{project,simulation,geometry,result,postprocessing}=param,[part,setPart]=(0,react.useState)(),[previous,setPrevious]=(0,react.useState)(),[loading,setLoading]=(0,react.useState)(!1);return(0,react.useEffect)(()=>{simulation&&postprocessing?postprocessing.glb!==(null==previous?void 0:previous.glb)&&(setPrevious(postprocessing),setLoading(!0),view_loadPart(simulation,postprocessing,"result").then(partLoaded=>setPart(partLoaded)).catch(_err=>void 0).finally(()=>setLoading(!1))):simulation&&result?result.glb!==(null==previous?void 0:previous.glb)&&(setPrevious(result),setLoading(!0),view_loadPart(simulation,result,"result").then(partLoaded=>setPart(partLoaded)).catch(_err=>void 0).finally(()=>setLoading(!1))):geometry&&geometry.id!==(null==previous?void 0:previous.id)&&(setPrevious(geometry),setLoading(!0),geometry.needCleanup?(setPart(void 0),setLoading(!1)):view_loadPart(void 0,geometry,"geometry").then(partLoaded=>setPart(partLoaded)).catch(_err=>void 0).finally(()=>setLoading(!1)))},[simulation,geometry,result,postprocessing,previous]),(0,jsx_runtime.jsx)(ThreeView,{loading:loading,project:{id:project.id,title:project.title},part:part})};var es_select=__webpack_require__(40038),modal=__webpack_require__(67040),tabs=__webpack_require__(50741),mjs_added=__webpack_require__(23389),mjs_updated=__webpack_require__(93398),lodash=__webpack_require__(96486),models=__webpack_require__(52402),utils=__webpack_require__(64376),api_plugins=__webpack_require__(10843),es_alert=__webpack_require__(14670),CopyOutlined=__webpack_require__(57132);let copy_errors={copy:"Unable to copy simulation"},onCopy=async(project,simulation,swr)=>{try{let newScheme=utils.Z.deepCopy(simulation.scheme);newScheme.configuration.run.done=!1,newScheme.configuration.run.error=void 0;let newSimulation=await api_simulation.Z.add({id:project.id},{name:simulation.name+" (copy)",scheme:newScheme});swr.addOneSimulation(newSimulation),swr.mutateProject({id:project.id,simulations:[...project.simulations,newSimulation.id]})}catch(err){(0,notification.lt)(copy_errors.copy,err)}},Copy=param=>{let{project,simulation,swr}=param,[loading,setLoading]=(0,react.useState)(!1);return(0,jsx_runtime.jsx)(tooltip.Z,{title:"Copy simulation",children:(0,jsx_runtime.jsx)(es_button.Z,{className:"no-border",loading:loading,icon:(0,jsx_runtime.jsx)(CopyOutlined.Z,{}),async onClick(){setLoading(!0);try{await onCopy(project,simulation,swr)}finally{setLoading(!1)}}})})},edit_errors={update:"Unable to update simulation"},edit_onEdit=async(simulation,values,swr)=>{try{await api_simulation.Z.update({id:simulation.id},[{key:"name",value:values.name}]),swr.mutateOneSimulation({id:simulation.id,name:values.name})}catch(err){throw(0,notification.lt)(edit_errors.update,err),err}},edit_Edit=param=>{let{simulation,swr}=param,[visible,setVisible]=(0,react.useState)(!1),[loading,setLoading]=(0,react.useState)(!1);return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(assets_button.w6,{onEdit:()=>setVisible(!0)}),(0,jsx_runtime.jsx)(dialog.ZP,{title:"Edit the simulation's name",visible:visible,initialValues:{name:simulation.name},onCancel:()=>setVisible(!1),async onOk(values){setLoading(!0);try{await edit_onEdit(simulation,values,swr),setLoading(!1),setVisible(!1)}catch(err){throw setLoading(!1),err}},loading:loading,children:(0,jsx_runtime.jsx)(es_form.Z.Item,{name:"name",label:"Name:",rules:[{required:!0,message:"Name is required"}],children:(0,jsx_runtime.jsx)(input.Z,{})})})]})},delete_errors={del:"Unable to delete simulation"},delete_onDelete=async(project,simulation,swr)=>{try{await api_simulation.Z.del(simulation);let filteredSimulations=project.simulations.filter(s=>s!==simulation.id);swr.mutateProject({id:project.id,simulations:filteredSimulations}),swr.delOneSimulation({id:simulation.id})}catch(err){throw(0,notification.lt)(delete_errors.del,err),err}},Delete=param=>{let{project,simulation,swr}=param,[loading,setLoading]=(0,react.useState)(!1);return(0,jsx_runtime.jsx)(assets_button.m1,{loading:loading,text:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["Are you sure you want to delete the simulation"," ",(0,jsx_runtime.jsx)(typography.Z.Text,{strong:!0,children:simulation.name}),"?"]}),async onDelete(){setLoading(!0);try{await delete_onDelete(project,simulation,swr)}finally{setLoading(!1)}}})},About=param=>{let{project,simulation,swr}=param;return project&&simulation?(0,jsx_runtime.jsx)(layout.Z,{children:(0,jsx_runtime.jsx)(layout.Z.Content,{children:(0,jsx_runtime.jsx)(card.Z,{size:"small",title:(0,jsx_runtime.jsx)(typography.Z.Title,{level:5,ellipsis:!0,children:simulation.name}),actions:[(0,jsx_runtime.jsx)(Copy,{project:{id:project.id,simulations:project.simulations},simulation:simulation,swr:{mutateProject:swr.mutateProject,addOneSimulation:swr.addOneSimulation}},"copy"),(0,jsx_runtime.jsx)(edit_Edit,{simulation:{id:simulation.id,name:simulation.name},swr:{mutateOneSimulation:swr.mutateOneSimulation}},"edit"),(0,jsx_runtime.jsx)(Delete,{project:{id:project.id,simulations:project.simulations},simulation:{id:simulation.id,name:simulation.name},swr:{mutateProject:swr.mutateProject,delOneSimulation:swr.delOneSimulation}},"delete")],children:(0,jsx_runtime.jsxs)(space.Z,{direction:"vertical",className:"full-width",children:[simulation.scheme.user&&(0,jsx_runtime.jsx)(es_alert.Z,{message:"User algorithm",type:"info",showIcon:!0}),(0,jsx_runtime.jsxs)(typography.Z.Text,{children:[(0,jsx_runtime.jsx)("span",{className:"text-light",children:"Category:"})," ",simulation.scheme.category]}),(0,jsx_runtime.jsxs)(typography.Z.Text,{children:[(0,jsx_runtime.jsx)("span",{className:"text-light",children:"Algorithm:"})," ",simulation.scheme.algorithm]}),(0,jsx_runtime.jsxs)(typography.Z.Text,{children:[(0,jsx_runtime.jsx)("span",{className:"text-light",children:"Code:"})," ",simulation.scheme.code]}),(0,jsx_runtime.jsxs)(typography.Z.Text,{children:[(0,jsx_runtime.jsx)("span",{className:"text-light",children:"Version:"})," ",simulation.scheme.version]}),(0,jsx_runtime.jsx)("div",{className:"full-wdith scroll",children:(0,jsx_runtime.jsx)(mathjax.Z.Html,{html:simulation.scheme.description})})]})})})}):(0,jsx_runtime.jsx)(card.Z,{children:(0,jsx_runtime.jsx)(spin.Z,{})})};var es_checkbox=__webpack_require__(32808);let Formula=param=>{let{label,className,defaultValue,defaultChecked,onValueChange,onCheckedChange,unit}=param,[internalValue,setInternalValue]=(0,react.useState)(String(null!=defaultValue?defaultValue:0)),[internalChecked,setInternalChecked]=(0,react.useState)(!!defaultChecked),[disabled,setDisabled]=(0,react.useState)(void 0!==defaultChecked&&!defaultChecked),[autoSave,setAutoSave]=(0,react.useState)(0),[saving,setSaving]=(0,react.useState)(!1);(0,react.useEffect)(()=>{setInternalValue(String(null!=defaultValue?defaultValue:0))},[defaultValue]),(0,react.useEffect)(()=>{setInternalChecked(!!defaultChecked)},[defaultChecked]);let onCheckboxChange=(0,react.useCallback)(event=>{let currentChecked=event.target.checked;setInternalChecked(currentChecked),setSaving(!0),null==onCheckedChange||onCheckedChange(currentChecked),setDisabled(!currentChecked)},[onCheckedChange]),onValueChangeDelayed=(0,react.useCallback)(value=>{autoSave&&clearTimeout(autoSave);let id=setTimeout(()=>{onValueChange(value),setSaving(!1)},500);setAutoSave(+id)},[autoSave,onValueChange]),onInputChange=(0,react.useCallback)(event=>{let currentValue=event.target.value;setInternalValue(currentValue),setSaving(!0),onValueChangeDelayed(currentValue)},[onValueChangeDelayed]);return(0,jsx_runtime.jsx)(space.Z,{className:"full-width space-full-width "+className,align:"start",children:(0,jsx_runtime.jsx)(es_form.Z,{layout:"vertical",children:(0,jsx_runtime.jsx)(es_form.Z.Item,{label:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[void 0!==defaultChecked&&(0,jsx_runtime.jsx)(es_checkbox.Z,{checked:internalChecked,onChange:onCheckboxChange,style:{marginRight:"5px"}}),label]}),children:(0,jsx_runtime.jsx)(input.Z,{disabled:disabled,value:internalValue,onChange:onInputChange,addonAfter:(0,jsx_runtime.jsxs)(space.Z,{className:"full-width",children:[(0,jsx_runtime.jsx)(mathjax.Z.Inline,{text:unit}),saving?(0,jsx_runtime.jsx)(LoadingOutlined.Z,{spin:!0,className:"color-orange"}):(0,jsx_runtime.jsx)(CheckCircleOutlined.Z,{className:"color-green"})]})})})})})},mesh_errors={update:"Unable to update simulation"},onMeshGlobalType=async(simulation,type,swr)=>{try{let newSimulation=utils.Z.deepCopy(simulation);newSimulation.scheme.configuration.geometry.meshParameters={type,value:"auto"===type?"normal":"1"};let diff={...newSimulation.scheme.configuration.geometry,done:!0};await api_simulation.Z.update({id:simulation.id},[{key:"scheme",type:"json",method:"set",path:["configuration","geometry"],value:diff}]),await api_simulation.Z.update({id:simulation.id},[{key:"scheme",type:"json",method:"set",path:["configuration","run"],value:{...newSimulation.scheme.configuration.run,done:!1}}]),swr.mutateOneSimulation(newSimulation)}catch(err){throw(0,notification.lt)(mesh_errors.update,err),err}},onMeshGlobalSize=async(simulation,type,value,swr)=>{try{let newSimulation=utils.Z.deepCopy(simulation);newSimulation.scheme.configuration.geometry.meshParameters={...newSimulation.scheme.configuration.geometry.meshParameters,type,value:value};let diff={...newSimulation.scheme.configuration.geometry,done:!0};await api_simulation.Z.update({id:simulation.id},[{key:"scheme",type:"json",method:"set",path:["configuration","geometry"],value:diff}]),await api_simulation.Z.update({id:simulation.id},[{key:"scheme",type:"json",method:"set",path:["configuration","run"],value:{...newSimulation.scheme.configuration.run,done:!1}}]),swr.mutateOneSimulation(newSimulation)}catch(err){throw(0,notification.lt)(mesh_errors.update,err),err}},Mesh=param=>{let{simulation,swr}=param,[meshGlobalType,setMeshGlobalType]=(0,react.useState)(),[meshGlobalValue,setMeshGlobalValue]=(0,react.useState)();(0,react.useEffect)(()=>{let meshParameters=simulation.scheme.configuration.geometry.meshParameters;meshParameters?(setMeshGlobalType(meshParameters.type),setMeshGlobalValue(meshParameters.value)):(setMeshGlobalType("auto"),setMeshGlobalValue("normal"))},[simulation]);let onSize=(0,react.useCallback)(async value=>{try{await onMeshGlobalSize(simulation,meshGlobalType,value,swr),setMeshGlobalValue(value)}catch(err){}},[simulation,meshGlobalType,swr]);return(0,jsx_runtime.jsx)(card.Z,{size:"small",title:"Mesh refinement",children:(0,jsx_runtime.jsxs)(space.Z,{direction:"vertical",className:"full-width",children:[(0,jsx_runtime.jsx)(es_form.Z,{layout:"vertical",children:(0,jsx_runtime.jsx)(es_form.Z.Item,{label:"Type",children:(0,jsx_runtime.jsxs)(es_select.Z,{className:"full-width",value:meshGlobalType,async onChange(type){try{await onMeshGlobalType(simulation,type,swr),setMeshGlobalType(type),"auto"===type?setMeshGlobalValue("normal"):setMeshGlobalValue("1")}catch(err){}},children:[(0,jsx_runtime.jsx)(es_select.Z.Option,{value:"auto",children:"Automatic"}),(0,jsx_runtime.jsx)(es_select.Z.Option,{value:"manual",children:"Manual"})]})})}),"auto"===meshGlobalType&&(0,jsx_runtime.jsx)(es_form.Z,{layout:"vertical",children:(0,jsx_runtime.jsx)(es_form.Z.Item,{label:"Size",children:(0,jsx_runtime.jsxs)(es_select.Z,{className:"full-width",value:meshGlobalValue,onChange:onSize,children:[(0,jsx_runtime.jsx)(es_select.Z.Option,{value:"veryfine",children:"Very fine"}),(0,jsx_runtime.jsx)(es_select.Z.Option,{value:"fine",children:"Fine"}),(0,jsx_runtime.jsx)(es_select.Z.Option,{value:"normal",children:"Normal"}),(0,jsx_runtime.jsx)(es_select.Z.Option,{value:"coarse",children:"Coarse"}),(0,jsx_runtime.jsx)(es_select.Z.Option,{value:"verycoarse",children:"Very coarse"})]})})}),"manual"===meshGlobalType&&(0,jsx_runtime.jsx)(Formula,{label:"Size",defaultValue:meshGlobalValue,onValueChange:onSize,unit:"m"})]})})},simulation_geometry_errors={update:"Unable to update simulation"},onSelect=async(simulation,geometries,geometry,setGeometry,swr)=>{try{var _dimension;let newSimulation=utils.Z.deepCopy(simulation);newSimulation.scheme.configuration.geometry.value=geometry.id;let diff={...newSimulation.scheme.configuration,dimension:null!==(_dimension=geometry.summary.dimension)&&void 0!==_dimension?_dimension:3,geometry:{...newSimulation.scheme.configuration.geometry,done:!0},run:{...newSimulation.scheme.configuration.run,done:!1}};await api_simulation.Z.update({id:simulation.id},[{key:"scheme",type:"json",method:"set",path:["configuration"],value:diff}]),swr.mutateOneSimulation(newSimulation);let newGeometry=geometries.find(g=>g.id===geometry.id);setGeometry(newGeometry)}catch(err){(0,notification.lt)(simulation_geometry_errors.update,err)}},simulation_geometry_Geometry=param=>{let{geometries,geometry,simulation,setGeometry,swr}=param,geometryId=simulation.scheme.configuration.geometry.value;!geometryId&&geometry&&onSelect(simulation,geometries,geometry,setGeometry,swr);let list=geometries.map(g=>(0,jsx_runtime.jsx)("div",{className:"Geometry-list",style:{backgroundColor:g.id===(null==geometry?void 0:geometry.id)?"#FFFBE6":"#FAFAFA"},onClick:()=>onSelect(simulation,geometries,g,setGeometry,swr),children:(0,jsx_runtime.jsx)(typography.Z.Text,{children:g.name})},g.id));return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(card.Z,{size:"small",children:(0,jsx_runtime.jsx)(typography.Z.Text,{children:"When changing the simulation domain, you might lose your topological entity assignments"})}),(0,jsx_runtime.jsx)(card.Z,{size:"small",children:(0,jsx_runtime.jsx)(typography.Z.Text,{strong:!0,children:"Select a simulation domain"})}),list,simulation.scheme.configuration.geometry.meshable&&(0,jsx_runtime.jsx)(Mesh,{simulation:{id:simulation.id,scheme:simulation.scheme},swr:{mutateOneSimulation:swr.mutateOneSimulation}})]})},materials_delete_errors={update:"Unable to delete material"},materials_delete_onDelete=async(simulation,index,dispatch,swr)=>{try{let newSimulation=utils.Z.deepCopy(simulation),materials=newSimulation.scheme.configuration.materials,material=materials.values[index];material.selected.forEach(s=>{dispatch(unselect(s))}),materials.values=[...materials.values.slice(0,index),...materials.values.slice(index+1)];let diff={...materials,done:!!materials.values.length};await api_simulation.Z.update({id:simulation.id},[{key:"scheme",type:"json",method:"set",path:["configuration","materials"],value:diff}]),swr.mutateOneSimulation(newSimulation)}catch(err){throw(0,notification.lt)(materials_delete_errors.update,err),err}},delete_Delete=param=>{let{simulation,index,swr}=param,[loading,setLoading]=(0,react.useState)(!1),{dispatch}=(0,react.useContext)(SelectContext),materials=simulation.scheme.configuration.materials,material=materials.values[index];return(0,jsx_runtime.jsx)(assets_button.m1,{loading:loading,text:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["Are you sure you want to delete the material"," ",(0,jsx_runtime.jsx)(typography.Z.Text,{strong:!0,children:material.material.label})]}),async onDelete(){setLoading(!0);try{await materials_delete_onDelete(simulation,index,dispatch,swr)}finally{setLoading(!1)}}})},List=param=>{var ref;let{simulation,swr,onEdit}=param,[enabled,setEnabled]=(0,react.useState)(!0),materials=simulation.scheme.configuration.materials,{dispatch}=(0,react.useContext)(SelectContext),highlight=(0,react.useCallback)(index=>{dispatch(enable());let currentSelected=materials.values[index].selected;null==currentSelected||currentSelected.forEach(s=>{dispatch(actions_select(s))})},[materials,dispatch]),unhighlight=(0,react.useCallback)(()=>{dispatch(disable())},[dispatch]);return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:null===(ref=materials.values)||void 0===ref?void 0:ref.map((material,index)=>(0,jsx_runtime.jsx)(card.Z,{className:"material-item text-center",hoverable:!0,onMouseEnter:()=>highlight(index),onMouseLeave(){enabled&&unhighlight()},actions:[(0,jsx_runtime.jsx)(assets_button.w6,{onEdit(){setEnabled(!1),onEdit(index),setTimeout(()=>setEnabled(!0),500)}},"edit"),(0,jsx_runtime.jsx)(delete_Delete,{index:index,simulation:{id:simulation.id,scheme:simulation.scheme},swr:{mutateOneSimulation:swr.mutateOneSimulation}},"delete")],children:(0,jsx_runtime.jsx)(typography.Z.Text,{strong:!0,className:"text-center",children:material.material.label})},index)).filter(l=>l)})};var drawer=__webpack_require__(63463),tag=__webpack_require__(20550),PlusSquareOutlined=__webpack_require__(13982),CloseSquareOutlined=__webpack_require__(14618),SwapOutlined=__webpack_require__(94668),SearchOutlined=__webpack_require__(68795);let Selector=param=>{var ref;let{geometry,alreadySelected,updateSelected}=param,[colors,setColors]=(0,react.useState)([]),[filter,setFilter]=(0,react.useState)(),[search,setSearch]=(0,react.useState)(),{type,highlighted,selected,dispatch}=(0,react.useContext)(SelectContext);(0,react.useEffect)(()=>{updateSelected(selected)},[updateSelected,selected]),(0,react.useEffect)(()=>{var ref;let colorsList=[];type&&(null===(ref=geometry.summary[type])||void 0===ref||ref.forEach(element=>{if(element.color){let existingColor=colorsList.find(c=>c.r===element.color.r&&c.g===element.color.g&&c.b===element.color.b);existingColor||colorsList.push(element.color)}})),setColors(colorsList)},[geometry,type]);let onHighlight=selection=>{dispatch(highlight(selection))},onUnhighlight=()=>{dispatch(unhighlight())},onSelect=selection=>{selected.find(s=>s.uuid===selection.uuid)?dispatch(unselect(selection)):dispatch(actions_select(selection))},onColorFilter=(0,react.useCallback)(color=>{setFilter(color)},[]),selectAll=()=>{var ref;null===(ref=geometry.summary[type])||void 0===ref||ref.forEach(element=>{var ref,ref1,ref2;(!filter||filter&&filter.r===(null===(ref=element.color)||void 0===ref?void 0:ref.r)&&filter.g===(null===(ref1=element.color)||void 0===ref1?void 0:ref1.g)&&filter.b===(null===(ref2=element.color)||void 0===ref2?void 0:ref2.b))&&dispatch(actions_select({uuid:element.uuid,label:element.label}))})},unselectAll=()=>{var ref;null===(ref=geometry.summary[type])||void 0===ref||ref.forEach(element=>{var ref,ref1,ref2;(!filter||filter&&filter.r===(null===(ref=element.color)||void 0===ref?void 0:ref.r)&&filter.g===(null===(ref1=element.color)||void 0===ref1?void 0:ref1.g)&&filter.b===(null===(ref2=element.color)||void 0===ref2?void 0:ref2.b))&&dispatch(unselect({uuid:element.uuid,label:element.label}))})},selectSwap=()=>{var ref;null===(ref=geometry.summary[type])||void 0===ref||ref.forEach(element=>{var ref,ref1,ref2;(!filter||filter&&filter.r===(null===(ref=element.color)||void 0===ref?void 0:ref.r)&&filter.g===(null===(ref1=element.color)||void 0===ref1?void 0:ref1.g)&&filter.b===(null===(ref2=element.color)||void 0===ref2?void 0:ref2.b))&&selected.find(s=>s.uuid===element.uuid)?dispatch(unselect({uuid:element.uuid,label:element.label})):dispatch(actions_select({uuid:element.uuid,label:element.label}))})},onSearch=(0,react.useCallback)(e=>{let value=e.target.value;setSearch(value)},[]),display=(0,react.useCallback)(element=>{var ref,ref1,ref2;return(!filter||filter.r===(null===(ref=element.color)||void 0===ref?void 0:ref.r)&&filter.g===(null===(ref1=element.color)||void 0===ref1?void 0:ref1.g)&&filter.b===(null===(ref2=element.color)||void 0===ref2?void 0:ref2.b))&&(!search||!element.name||!!element.name.includes(search))},[filter,search]);return(0,jsx_runtime.jsxs)(card.Z,{size:"small",className:"no-border-bottom",children:[(0,jsx_runtime.jsxs)(space.Z,{direction:"vertical",className:"full-width",children:[(0,jsx_runtime.jsx)(typography.Z.Text,{strong:!0,children:"Filters"}),(0,jsx_runtime.jsxs)(space.Z,{direction:"horizontal",wrap:!0,children:[colors.length>1&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(tooltip.Z,{title:"Reset",children:(0,jsx_runtime.jsx)(es_button.Z,{icon:(0,jsx_runtime.jsx)(CloseOutlined.Z,{}),onClick:()=>onColorFilter()})}),colors.map(color=>(0,jsx_runtime.jsx)(tooltip.Z,{title:"Color",children:(0,jsx_runtime.jsx)(es_button.Z,{style:{backgroundColor:utils.Z.rgbToHex(color)},onClick:()=>onColorFilter(color),children:" "})},JSON.stringify(color)))]}),(0,jsx_runtime.jsx)(tooltip.Z,{title:"Select all",children:(0,jsx_runtime.jsx)(es_button.Z,{icon:(0,jsx_runtime.jsx)(PlusSquareOutlined.Z,{}),onClick:selectAll})}),(0,jsx_runtime.jsx)(tooltip.Z,{title:"Unselect all",children:(0,jsx_runtime.jsx)(es_button.Z,{icon:(0,jsx_runtime.jsx)(CloseSquareOutlined.Z,{}),onClick:unselectAll})}),(0,jsx_runtime.jsx)(tooltip.Z,{title:"Swap",children:(0,jsx_runtime.jsx)(es_button.Z,{icon:(0,jsx_runtime.jsx)(SwapOutlined.Z,{}),onClick:selectSwap})})]}),(0,jsx_runtime.jsx)(input.Z,{placeholder:"Search",value:search,onChange:onSearch,suffix:(0,jsx_runtime.jsx)(SearchOutlined.Z,{className:"text-light"})})]}),(0,jsx_runtime.jsx)("div",{className:"full-width marginTop-20",children:type?null===(ref=geometry.summary[type])||void 0===ref?void 0:ref.map((element,index)=>{if(display(element)){let borderColor="transparent",backgroundColor="transparent";return selected.find(s=>s.uuid===element.uuid)?(borderColor="#EE9817",backgroundColor="rgba(238, 152, 23, 0.3)"):(null==highlighted?void 0:highlighted.uuid)===element.uuid&&(borderColor="#FAD114",backgroundColor="rgba(250, 209, 20, 0.3)"),(0,jsx_runtime.jsx)(card.Z,{className:"marginBottom-10",bodyStyle:{position:"relative",padding:"10px 10px 10px 40px",borderWidth:"2px",borderStyle:"solid",borderColor,backgroundColor},onMouseEnter:()=>onHighlight({uuid:element.uuid,label:element.label}),onMouseLeave:onUnhighlight,onClick:()=>onSelect({uuid:element.uuid,label:element.label}),children:(0,jsx_runtime.jsxs)(space.Z,{direction:"vertical",children:[(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("div",{style:{position:"absolute",left:"-2px",top:"-2px",bottom:"-2px",width:"30px",backgroundColor:utils.Z.rgbToRgba(element.color,1)}}),element.name]}),null==alreadySelected?void 0:alreadySelected.map(a=>{if(a.selected.find(s=>s.uuid===element.uuid))return(0,jsx_runtime.jsx)(tag.Z,{color:utils.Z.stringToColor(a.label),children:a.label},element.uuid)})]})},index)}}):[]})]})};var es_list=__webpack_require__(95507),DatabaseOutlined=__webpack_require__(13520),materials=__webpack_require__(23226);let DataBase=param=>{let{onSelect}=param,[visible,setVisible]=(0,react.useState)(),[firstLevel,setFirstLevel]=(0,react.useState)(),[secondLevel,setSecondLevel]=(0,react.useState)(),[current,setCurrent]=(0,react.useState)(),keys=Object.keys(materials.E),onFirstLevel=(0,react.useCallback)(param=>{let{key}=param,subDatabase=materials.E[key];setFirstLevel({key,children:subDatabase.children}),setSecondLevel(void 0),setCurrent(void 0)},[]),onSecondLevel=(0,react.useCallback)(param=>{let{key}=param,subDatabase=materials.E[firstLevel.key],child=subDatabase.children.find(c=>c.key===key);setSecondLevel({key}),setCurrent(child)},[firstLevel]),onMaterialSelect=(0,react.useCallback)(material=>{onSelect(material),setVisible(!1)},[onSelect]);return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(es_button.Z,{icon:(0,jsx_runtime.jsx)(DatabaseOutlined.Z,{}),onClick:()=>setVisible(!0),className:"full-width",children:"Pick a material"}),(0,jsx_runtime.jsx)(modal.Z,{open:visible,title:"Material database",onCancel:()=>setVisible(!1),onOk:()=>onMaterialSelect(current),okText:"Choose",okButtonProps:{disabled:!current},width:"50%",children:(0,jsx_runtime.jsx)(layout.Z,{children:(0,jsx_runtime.jsx)(layout.Z.Content,{children:(0,jsx_runtime.jsxs)(space.Z,{style:{alignItems:"stretch"},children:[(0,jsx_runtime.jsx)(menu.Z,{mode:"inline",items:keys.map(key=>({key:key,label:materials.E[key].label})),onClick:onFirstLevel}),(0,jsx_runtime.jsx)(menu.Z,{mode:"inline",items:null==firstLevel?void 0:firstLevel.children.map(child=>({key:child.key,label:child.label})),selectedKeys:(null==secondLevel?void 0:secondLevel.key)?[null==secondLevel?void 0:secondLevel.key]:[],onClick:onSecondLevel}),current&&(0,jsx_runtime.jsx)(es_list.ZP,{itemLayout:"vertical",children:current.children.map(child=>(0,jsx_runtime.jsxs)(es_list.ZP.Item,{children:[child.label,": ",child.symbol," = ",child.value]},child.label))})]})})})})]})},materials_add_errors={material:"You need to define a material",selected:"You need to select a solid",update:"Unable to add material"},onAdd=async(simulation,material,swr)=>{try{let newMaterial=utils.Z.deepCopy(material);newMaterial.uuid=(0,v4.Z)();let newSimulation=utils.Z.deepCopy(simulation),materials=newSimulation.scheme.configuration.materials;materials.values=[...materials.values||[],newMaterial];let diff={...materials,done:!0};await api_simulation.Z.update({id:simulation.id},[{key:"scheme",type:"json",method:"set",path:["configuration","materials"],value:diff}]),await api_simulation.Z.update({id:simulation.id},[{key:"scheme",type:"json",method:"set",path:["configuration","run"],value:{...newSimulation.scheme.configuration.run,done:!1}}]),swr.mutateOneSimulation(newSimulation)}catch(err){throw(0,notification.lt)(materials_add_errors.update,err),err}},add_Add=param=>{let{simulation,material,swr,onError,onClose}=param,[loading,setLoading]=(0,react.useState)(!1);return(0,jsx_runtime.jsx)(assets_button.HS,{loading:loading,needMargin:!0,async onAdd(){setLoading(!0);try{var ref;if(!material.material){onError(materials_add_errors.material),setLoading(!1);return}if(!(null===(ref=material.selected)||void 0===ref?void 0:ref.length)){onError(materials_add_errors.selected),setLoading(!1);return}onError(),await onAdd(simulation,material,swr),setLoading(!1),onClose()}catch(err){setLoading(!1)}},children:"Add"})},materials_edit_errors={material:"You need to define a material",selected:"You need to select a solid",update:"Unable to edit material"},materials_edit_onEdit=async(simulation,material,swr)=>{try{let newSimulation=utils.Z.deepCopy(simulation),materials=newSimulation.scheme.configuration.materials,index=materials.values.findIndex(m=>m.uuid===material.uuid);materials.values=[...materials.values.slice(0,index),material,...materials.values.slice(index+1)];let diff={...materials};await api_simulation.Z.update({id:simulation.id},[{key:"scheme",type:"json",method:"set",path:["configuration","materials"],value:diff}]),swr.mutateOneSimulation(newSimulation)}catch(err){throw(0,notification.lt)(materials_edit_errors.update,err),err}},materials_edit_Edit=param=>{let{simulation,material,swr,onError,onClose}=param,[loading,setLoading]=(0,react.useState)(!1);return(0,jsx_runtime.jsx)(assets_button.w6,{loading:loading,primary:!0,needMargin:!0,async onEdit(){setLoading(!0);try{var ref;if(!material.material){onError(materials_edit_errors.material),setLoading(!1);return}if(!(null===(ref=material.selected)||void 0===ref?void 0:ref.length)){onError(materials_edit_errors.selected),setLoading(!1);return}onError(),await materials_edit_onEdit(simulation,material,swr),setLoading(!1),onClose()}catch(err){setLoading(!1)}},children:"Edit"})},Material=param=>{var ref,ref1,ref2,ref3,ref4,ref5;let{visible,geometry,simulation,material,swr,onClose}=param,[alreadySelected,setAlreadySelected]=(0,react.useState)(),[current,setCurrent]=(0,react.useState)(),[error,setError]=(0,react.useState)(),materials=simulation.scheme.configuration.materials;(0,react.useEffect)(()=>{!visible&&current&&setCurrent(void 0)}),(0,react.useEffect)(()=>{visible&&!current&&material&&setCurrent(material)},[current,visible,material]),(0,react.useEffect)(()=>{var ref;let currentAlreadySelected=null==materials?void 0:null===(ref=materials.values)||void 0===ref?void 0:ref.map(m=>{if(m.uuid!==(null==material?void 0:material.uuid))return{label:m.material.label,selected:m.selected}}).filter(s=>s);setAlreadySelected(currentAlreadySelected||[])},[simulation,material,materials]);let onMaterialSelect=(0,react.useCallback)(currentMaterial=>{setCurrent(prevCurrent=>({...prevCurrent,material:currentMaterial}))},[]),onSelected=(0,react.useCallback)(selected=>{setCurrent(prevCurrent=>({...prevCurrent,selected:selected}))},[]),onMaterialChange=(0,react.useCallback)((child,index,val)=>{setCurrent(prevCurrent=>{var ref,ref1,ref2,ref3;return{...prevCurrent,material:{label:"Custom",children:[...(null==prevCurrent?void 0:null===(ref=prevCurrent.material)||void 0===ref?void 0:null===(ref1=ref.children)||void 0===ref1?void 0:ref1.slice(0,index))||[],{label:child.label,symbol:child.name,value:val},...(null==prevCurrent?void 0:null===(ref2=prevCurrent.material)||void 0===ref2?void 0:null===(ref3=ref2.children)||void 0===ref3?void 0:ref3.slice(index+1))||[]]}}})},[]);return(0,jsx_runtime.jsx)(drawer.Z,{className:"material",title:"Material",placement:"left",closable:!1,open:visible,mask:!1,maskClosable:!1,width:300,extra:(0,jsx_runtime.jsx)(es_button.Z,{type:"text",icon:(0,jsx_runtime.jsx)(CloseOutlined.Z,{}),onClick(){setCurrent(void 0),onClose()}}),footer:(0,jsx_runtime.jsxs)("div",{style:{display:"flex",justifyContent:"flex-end"},children:[(0,jsx_runtime.jsx)(assets_button.Lw,{onCancel(){setCurrent(void 0),onClose()}}),material?(0,jsx_runtime.jsx)(materials_edit_Edit,{material:{uuid:null!==(ref2=null==current?void 0:current.uuid)&&void 0!==ref2?ref2:material.uuid,material:null!==(ref3=null==current?void 0:current.material)&&void 0!==ref3?ref3:material.material,selected:null!==(ref4=null==current?void 0:current.selected)&&void 0!==ref4?ref4:material.selected},simulation:{id:simulation.id,scheme:simulation.scheme},swr:{mutateOneSimulation:swr.mutateOneSimulation},onError:desc=>setError(desc),onClose:onClose}):(0,jsx_runtime.jsx)(add_Add,{material:{material:null==current?void 0:current.material,selected:null==current?void 0:current.selected},simulation:{id:simulation.id,scheme:simulation.scheme},swr:{mutateOneSimulation:swr.mutateOneSimulation},onError:desc=>setError(desc),onClose:onClose})]}),children:(0,jsx_runtime.jsxs)(space.Z,{direction:"vertical",className:"full-width",children:[(0,jsx_runtime.jsx)(card.Z,{size:"small",children:(0,jsx_runtime.jsxs)(space.Z,{direction:"vertical",className:"full-width",children:[(0,jsx_runtime.jsx)(DataBase,{onSelect:onMaterialSelect}),(0,jsx_runtime.jsxs)(typography.Z.Text,{children:["Material: ",null!==(ref5=null==current?void 0:null===(ref=current.material)||void 0===ref?void 0:ref.label)&&void 0!==ref5?ref5:"default"]}),null==materials?void 0:null===(ref1=materials.children)||void 0===ref1?void 0:ref1.map((child,index)=>{var ref,ref1;let m=null==current?void 0:null===(ref=current.material)||void 0===ref?void 0:null===(ref1=ref.children)||void 0===ref1?void 0:ref1.find(c=>c.symbol===child.name);return(0,jsx_runtime.jsx)(Formula,{label:child.name,defaultValue:m?m.value:String(child.default),unit:child.unit,onValueChange(val){onMaterialChange(child,index,val)}},child.name)})]})}),(0,jsx_runtime.jsx)(Selector,{geometry:geometry,alreadySelected:alreadySelected,updateSelected:onSelected}),error&&(0,jsx_runtime.jsxs)(typography.Z.Text,{children:[(0,jsx_runtime.jsx)(ExclamationCircleOutlined.Z,{style:{color:"red"}})," ",error]})]})})},Materials=param=>{let{geometry,simulation,swr,setVisible}=param,[material,setMaterial]=(0,react.useState)(),[materialVisible,setMaterialVisible]=(0,react.useState)(!1),{dispatch}=(0,react.useContext)(SelectContext),materials=simulation.scheme.configuration.materials;(0,react.useEffect)(()=>{(null==geometry?void 0:geometry.summary)&&dispatch(setType(2===geometry.summary.dimension?"faces":"solids"))},[geometry,dispatch]);let onAdd=(0,react.useCallback)(()=>{setMaterial(void 0),setMaterialVisible(!0),setVisible(!1),dispatch(enable())},[dispatch,setVisible]),onEdit=(0,react.useCallback)(index=>{let materialToEdit=materials.values[index];setMaterial(materialToEdit),setMaterialVisible(!0),setVisible(!1),dispatch(enable())},[materials,dispatch,setVisible]),onClose=(0,react.useCallback)(()=>{dispatch(disable()),setMaterialVisible(!1),setMaterial(void 0),setVisible(!0)},[dispatch,setVisible]);return geometry?(0,jsx_runtime.jsx)(layout.Z,{children:(0,jsx_runtime.jsx)(layout.Z.Content,{children:(0,jsx_runtime.jsxs)(card.Z,{size:"small",children:[(0,jsx_runtime.jsx)(assets_button.HS,{onAdd:onAdd,fullWidth:!0,primary:!1,children:"Add material"}),(0,jsx_runtime.jsx)(List,{simulation:{id:simulation.id,scheme:simulation.scheme},swr:swr,onEdit:onEdit}),(0,jsx_runtime.jsx)(Material,{visible:materialVisible,geometry:{summary:geometry.summary},simulation:{id:simulation.id,scheme:simulation.scheme},material:material&&{uuid:material.uuid,material:material.material,selected:material.selected},swr:{mutateOneSimulation:swr.mutateOneSimulation},onClose:onClose})]})})}):(0,jsx_runtime.jsx)(loading.Z.Simple,{})};var collapse=__webpack_require__(54907);let parameters_errors={update:"Unable to update simulation"},build2DFormula=(key,child,onValueChange)=>(0,jsx_runtime.jsx)(Formula,{label:child.label2D||child.label,defaultValue:null!==(_value=child.value)&&void 0!==_value?_value:child.default,onValueChange:onValueChange,unit:child.unit},key),build2DSelect=(key,child,onValueChange)=>{var ref;return(0,jsx_runtime.jsx)(es_form.Z,{layout:"vertical",children:(0,jsx_runtime.jsx)(es_form.Z.Item,{label:child.label2D||child.label,children:(0,jsx_runtime.jsx)(es_select.Z,{options:null===(ref=child.options)||void 0===ref?void 0:ref.map(option=>({label:option.label,value:null!==(_value2D=option.value2D)&&void 0!==_value2D?_value2D:option.value})),defaultValue:child.value||child.default2D||child.default,onChange:onValueChange})})},key)},build2DCheckbox=(key,child,onValueChange)=>(0,jsx_runtime.jsx)(es_form.Z,{layout:"horizontal",children:(0,jsx_runtime.jsx)(es_form.Z.Item,{label:child.label2D||child.label,children:(0,jsx_runtime.jsx)(es_checkbox.Z,{defaultChecked:child.value,onChange:onValueChange})})},key),buildFormula=(key,child,onValueChange)=>(0,jsx_runtime.jsx)(Formula,{label:child.label,defaultValue:null!==(_value1=child.value)&&void 0!==_value1?_value1:child.default,onValueChange:onValueChange,unit:child.unit},key),buildSelect=(key,child,onValueChange)=>(0,jsx_runtime.jsx)(es_form.Z,{layout:"vertical",children:(0,jsx_runtime.jsx)(es_form.Z.Item,{label:child.label,children:(0,jsx_runtime.jsx)(es_select.Z,{options:child.options,defaultValue:child.value||child.default,onChange:onValueChange})})},key),buildCheckbox=(key,child,onValueChange)=>(0,jsx_runtime.jsx)(es_form.Z,{layout:"horizontal",children:(0,jsx_runtime.jsx)(es_form.Z.Item,{label:child.label,children:(0,jsx_runtime.jsx)(es_checkbox.Z,{defaultChecked:child.value,onChange:onValueChange})})},key),onDone=async(simulation,swr)=>{try{let newSimulation=utils.Z.deepCopy(simulation),parameters=newSimulation.scheme.configuration.parameters,diff={...parameters,done:!0};await api_simulation.Z.update({id:simulation.id},[{key:"scheme",type:"json",method:"set",path:["configuration","parameters"],value:diff}]),await api_simulation.Z.update({id:simulation.id},[{key:"scheme",type:"json",method:"set",path:["configuration","run"],value:{...newSimulation.scheme.configuration.run,done:!1}}]),swr.mutateOneSimulation(newSimulation)}catch(err){(0,notification.lt)(parameters_errors.update,err)}},onChange=async(simulation,key,index,value,swr)=>{try{let newSimulation=utils.Z.deepCopy(simulation),parameters=newSimulation.scheme.configuration.parameters,parameter=parameters[key];parameter.children[index].value=value;let diff={...parameters,done:!0};await api_simulation.Z.update({id:simulation.id},[{key:"scheme",type:"json",method:"set",path:["configuration","parameters"],value:diff}]),await api_simulation.Z.update({id:simulation.id},[{key:"scheme",type:"json",method:"set",path:["configuration","run"],value:{...newSimulation.scheme.configuration.run,done:!1}}]),swr.mutateOneSimulation(newSimulation)}catch(err){(0,notification.lt)(parameters_errors.update,err)}},Parameters=param=>{let{simulation,swr}=param,subScheme=null==simulation?void 0:simulation.scheme.configuration.parameters,dimension=null==simulation?void 0:simulation.scheme.configuration.dimension;(0,react.useEffect)(()=>{(null==subScheme?void 0:subScheme.done)||onDone(simulation,swr)},[simulation,subScheme,swr]);let parameters=[],advanced=[];return 2===dimension?Object.keys(subScheme).forEach(key=>{if("index"===key||"title"===key||"done"==key)return;let parameter=subScheme[key],components=null==parameter?void 0:parameter.children.map((child,index)=>{if(!child.only3D){if("formula"===child.htmlEntity)return build2DFormula(key+"&"+index,child,value=>onChange(simulation,key,index,value,swr));if("select"===child.htmlEntity)return build2DSelect(key+"&"+index,child,value=>onChange(simulation,key,index,value,swr));if("checkbox"===child.htmlEntity)return build2DCheckbox(key+"&"+index,child,e=>onChange(simulation,key,index,e.target.checked,swr))}});(null==parameter?void 0:parameter.advanced)?advanced.push((0,jsx_runtime.jsx)(card.Z,{size:"small",title:null==parameter?void 0:parameter.label,children:(0,jsx_runtime.jsx)(space.Z,{direction:"vertical",children:components})},key)):parameters.push((0,jsx_runtime.jsx)(card.Z,{size:"small",title:null==parameter?void 0:parameter.label,children:(0,jsx_runtime.jsx)(space.Z,{direction:"vertical",children:components})},key))}):Object.keys(subScheme).forEach(key=>{if("index"===key||"title"===key||"done"==key)return;let parameter=subScheme[key],components=null==parameter?void 0:parameter.children.map((child,index)=>"formula"===child.htmlEntity?buildFormula(key+"&"+index,child,value=>onChange(simulation,key,index,value,swr)):"select"===child.htmlEntity?buildSelect(key+"&"+index,child,value=>onChange(simulation,key,index,value,swr)):"checkbox"===child.htmlEntity?buildCheckbox(key+"&"+index,child,e=>onChange(simulation,key,index,e.target.checked,swr)):void 0);(null==parameter?void 0:parameter.advanced)?advanced.push((0,jsx_runtime.jsx)(card.Z,{size:"small",title:null==parameter?void 0:parameter.label,children:(0,jsx_runtime.jsx)(space.Z,{direction:"vertical",children:components})},key)):parameters.push((0,jsx_runtime.jsx)(card.Z,{size:"small",title:null==parameter?void 0:parameter.label,children:(0,jsx_runtime.jsx)(space.Z,{direction:"vertical",children:components})},key))}),(0,jsx_runtime.jsx)(layout.Z,{children:(0,jsx_runtime.jsx)(layout.Z.Content,{children:(0,jsx_runtime.jsxs)(space.Z,{direction:"vertical",children:[parameters,(0,jsx_runtime.jsx)(collapse.Z,{children:(0,jsx_runtime.jsx)(collapse.Z.Panel,{header:"Advanced",children:(0,jsx_runtime.jsx)(space.Z,{direction:"vertical",children:advanced})},"advanced")})]})})})},getFilesNumbers=(files,filter)=>files.map(file=>{let number=file.fileName.replace(RegExp(filter.prefixPattern),"").replace(RegExp(filter.suffixPattern),"");return{...file,number:+number}}),getMultiplicator=(configuration,filter)=>{let multiplicatorPath=filter.multiplicator;if(multiplicatorPath){var _value;let multiplicatorObject=multiplicatorPath.reduce((a,v)=>a[v],configuration);return null!==(_value=multiplicatorObject.value)&&void 0!==_value?_value:multiplicatorObject.default}},initialization_errors={update:"Unable to update simulation"},onSelectorChange=async(simulation,key,swr)=>{try{let newSimulation=utils.Z.deepCopy(simulation),initialization=newSimulation.scheme.configuration.initialization;initialization.value={type:key},await api_simulation.Z.update({id:simulation.id},[{key:"scheme",type:"json",method:"set",path:["configuration","initialization"],value:initialization}]),swr.mutateOneSimulation(newSimulation)}catch(err){throw(0,notification.lt)(initialization_errors.update,err),err}},onCouplingChange=async(simulations,simulation,value,swr)=>{try{var ref;let results=await loadResults(simulations,value),newSimulation=utils.Z.deepCopy(simulation),initialization=newSimulation.scheme.configuration.initialization;initialization.value={...initialization.value,simulation:value,result:null==results?void 0:null===(ref=results[0])||void 0===ref?void 0:ref.value},await api_simulation.Z.update({id:simulation.id},[{key:"scheme",type:"json",method:"set",path:["configuration","initialization"],value:initialization}]),swr.mutateOneSimulation(newSimulation)}catch(err){throw(0,notification.lt)(initialization_errors.update,err),err}},onCouplingResultChange=async(simulation,value,option,swr)=>{try{let newSimulation=utils.Z.deepCopy(simulation),initialization=newSimulation.scheme.configuration.initialization;initialization.value={...initialization.value,number:+value,result:option.file},await api_simulation.Z.update({id:simulation.id},[{key:"scheme",type:"json",method:"set",path:["configuration","initialization"],value:initialization}]),swr.mutateOneSimulation(newSimulation)}catch(err){(0,notification.lt)(initialization_errors.update,err)}},initialization_onChange=async(simulation,index,value,swr)=>{try{let newSimulation=utils.Z.deepCopy(simulation),initialization=newSimulation.scheme.configuration.initialization;initialization.value.values||(initialization.value.values=[]),initialization.value.values[index]=value,await api_simulation.Z.update({id:simulation.id},[{key:"scheme",type:"json",method:"set",path:["configuration","initialization"],value:initialization}]),swr.mutateOneSimulation(newSimulation)}catch(err){(0,notification.lt)(initialization_errors.update,err)}},loadResults=async(simulations,id)=>{var ref;let tasks=await api_simulation.Z.tasks({id}),currentSimulation=simulations.find(s=>s.id===id),configuration=currentSimulation.scheme.configuration,filter=null==configuration?void 0:null===(ref=configuration.run)||void 0===ref?void 0:ref.resultsFilter,results=[];return tasks.forEach(task=>{if(task.file&&"result"===task.file.type&&results.push({label:task.file.fileName,value:task.file.fileName,file:task.file.fileName}),task.files){if(filter){let pattern=RegExp(filter.pattern),notFilteredFiles=task.files.filter(file=>!pattern.test(file.fileName)).filter(file=>"result"===file.type),files=task.files.filter(file=>pattern.test(file.fileName)),filesWithNumbers=getFilesNumbers(files,filter),uniqueFilesWithNumbers=filesWithNumbers.map(file=>({number:file.number,fileName:file.fileName.replace(RegExp(filter.suffixPattern),"")})).filter((file,index,self1)=>self1.findIndex(s=>s.number===file.number)===index).sort((a,b)=>a.number-b.number),multiplicator=getMultiplicator(configuration,filter),options=uniqueFilesWithNumbers.map((file,index)=>{let value=multiplicator?file.number*multiplicator:index;return{label:String(Math.round(1e15*value)/1e15),value:file.fileName,file:file.fileName}});results.push(...notFilteredFiles.map(file=>({label:file.fileName,value:file.fileName,file:file.fileName})).filter(f=>f)),results.push(...options)}else task.files.forEach(file=>{"result"===file.type&&results.push({label:file.fileName,value:file.fileName,file:file.fileName})})}}),results},Initialization=param=>{let{simulations,simulation,swr}=param,[loading,setLoading]=(0,react.useState)(!1),[currentKey,setCurrentKey]=(0,react.useState)(),[couplingSimulation,setCouplingSimulation]=(0,react.useState)(),[couplingResults,setCouplingResults]=(0,react.useState)(),subScheme=null==simulation?void 0:simulation.scheme.configuration.initialization,dimension=null==simulation?void 0:simulation.scheme.configuration.dimension,setSimulation=(0,react.useCallback)(id=>{let simulationToCouple=simulations.find(s=>s.id===id);setCouplingSimulation(simulationToCouple)},[simulations]);(0,react.useEffect)(()=>{var ref,ref1;!currentKey&&subScheme.value&&setCurrentKey(subScheme.value.type),!couplingSimulation&&(null===(ref=subScheme.value)||void 0===ref?void 0:ref.simulation)&&setSimulation(null===(ref1=subScheme.value)||void 0===ref1?void 0:ref1.simulation)},[subScheme,currentKey,couplingSimulation,setSimulation]),(0,react.useEffect)(()=>{couplingSimulation&&loadResults(simulations,couplingSimulation.id).then(results=>setCouplingResults(results))},[simulations,couplingSimulation]);let selectorOptions=[{label:"None",value:"none"}];subScheme.coupling&&selectorOptions.push({label:subScheme.coupling.label,value:"coupling"}),subScheme.direct&&selectorOptions.push({label:subScheme.direct.label,value:"direct"});let initializations={none:(0,jsx_runtime.jsx)("div",{})},initializationValue=subScheme.value;{let coupling=subScheme.coupling;if(null==coupling?void 0:coupling.compatibility){let simulationsOptions=simulations.map(s=>{let disabled=s.id===simulation.id||!coupling.compatibility.find(c=>c.algorithm===s.scheme.algorithm);return{label:s.name,value:s.id,disabled}}),compatibility=coupling.compatibility.find(c=>{var ref;return c.algorithm===(null==couplingSimulation?void 0:null===(ref=couplingSimulation.scheme)||void 0===ref?void 0:ref.algorithm)}),filter=null==compatibility?void 0:compatibility.filter;initializations.coupling=(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(typography.Z.Text,{children:"If you use coupling, the selected simulation mesh will be used, at least for the first iteration."}),(0,jsx_runtime.jsxs)(space.Z,{direction:"vertical",className:"full-width marginTop-10",children:[(0,jsx_runtime.jsx)(es_select.Z,{className:"full-width",options:simulationsOptions,placeholder:"Select a simulation",value:null==initializationValue?void 0:initializationValue.simulation,async onChange(value){setLoading(!0);try{await onCouplingChange(simulations,simulation,value,swr),setSimulation(value)}catch(err){}finally{setLoading(!1)}}}),loading&&(0,jsx_runtime.jsx)(spin.Z,{}),(null==couplingResults?void 0:couplingResults.length)?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)(typography.Z.Text,{children:[null==filter?void 0:filter.name,":"]},"simulation"),(0,jsx_runtime.jsx)(es_select.Z,{className:"full-width",options:couplingResults,placeholder:"Select a "+filter.name,value:null==initializationValue?void 0:initializationValue.result,async onChange(value,option){onCouplingResultChange(simulation,value,option,swr)}})]}):(0,jsx_runtime.jsx)(typography.Z.Text,{type:"danger",children:"No results, please select an other simulation."})]})]})}let direct=subScheme.direct;(null==direct?void 0:direct.children)&&(initializations.direct=(0,jsx_runtime.jsx)(space.Z,{direction:"vertical",className:"full-width",children:direct.children.map((child,index)=>{var ref,ref1;if(2!==dimension||!child.only3D)return(0,jsx_runtime.jsx)(Formula,{label:child.label,defaultValue:(null!==(ref1=null==initializationValue?void 0:null===(ref=initializationValue.values)||void 0===ref?void 0:ref[index])&&void 0!==ref1?ref1:child.default).toString(),unit:child.unit,onValueChange:value=>initialization_onChange(simulation,index,value,swr)},index)})}))}return(0,jsx_runtime.jsx)(layout.Z,{children:(0,jsx_runtime.jsx)(layout.Z.Content,{children:(0,jsx_runtime.jsxs)(card.Z,{size:"small",children:[(0,jsx_runtime.jsx)(es_select.Z,{className:"full-width marginBottom-10",defaultValue:"none",value:currentKey,options:selectorOptions,async onChange(key){try{await onSelectorChange(simulation,key,swr),setCurrentKey(key)}catch(err){}}}),initializations[currentKey||"none"]]})})})},boundaryConditions_delete_errors={update:"Unable to delete boundary condition"},boundaryConditions_delete_onDelete=async(simulation,type,index,dispatch,swr)=>{try{let newSimulation=utils.Z.deepCopy(simulation),boundaryConditions=newSimulation.scheme.configuration.boundaryConditions,typedBoundaryCondition=boundaryConditions[type],boundaryCondition=typedBoundaryCondition.values[index];boundaryCondition.selected.forEach(s=>{dispatch(unselect(s))}),typedBoundaryCondition.values=[...typedBoundaryCondition.values.slice(0,index),...typedBoundaryCondition.values.slice(index+1)];let done=!1;Object.keys(boundaryConditions).forEach(t=>{var ref;if("index"===t||"title"===t||"done"===t)return;let ttypedBoundaryCondition=boundaryConditions[t];(null===(ref=ttypedBoundaryCondition.values)||void 0===ref?void 0:ref.length)&&(done=!0)});let diff={...boundaryConditions,done:done};await api_simulation.Z.update({id:simulation.id},[{key:"scheme",type:"json",method:"set",path:["configuration","boundaryConditions"],value:diff}]),swr.mutateOneSimulation(newSimulation)}catch(err){throw(0,notification.lt)(boundaryConditions_delete_errors.update,err),err}},boundaryConditions_delete_Delete=param=>{let{type,index,simulation,swr}=param,[loading,setLoading]=(0,react.useState)(!1),{dispatch}=(0,react.useContext)(SelectContext),boundaryConditions=simulation.scheme.configuration.boundaryConditions,typedBoundaryCondition=boundaryConditions[type],boundaryCondition=typedBoundaryCondition.values[index];return(0,jsx_runtime.jsx)(assets_button.m1,{loading:loading,async onDelete(){setLoading(!0);try{await boundaryConditions_delete_onDelete(simulation,type,index,dispatch,swr)}finally{setLoading(!1)}},text:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["Are you sure you want to delete the condition"," ",(0,jsx_runtime.jsx)(typography.Z.Text,{strong:!0,children:null==boundaryCondition?void 0:boundaryCondition.name}),"?"]})})},list_List=param=>{let{simulation,swr,onEdit}=param,[enabled,setEnabled]=(0,react.useState)(!0),boundaryConditions=simulation.scheme.configuration.boundaryConditions,{dispatch}=(0,react.useContext)(SelectContext),highlight=(0,react.useCallback)((key,index)=>{dispatch(enable());let typedBoundaryCondition=boundaryConditions[key],currentSelected=typedBoundaryCondition.values[index].selected;null==currentSelected||currentSelected.forEach(s=>{dispatch(actions_select(s))})},[boundaryConditions,dispatch]),unhighlight=(0,react.useCallback)(()=>{dispatch(disable())},[dispatch]);return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:Object.keys(boundaryConditions).map(type=>{var ref;if("index"===type||"title"===type||"done"===type)return;let typedBoundaryCondition=boundaryConditions[type];return null===(ref=typedBoundaryCondition.values)||void 0===ref?void 0:ref.map((child,index)=>(0,jsx_runtime.jsxs)(card.Z,{className:"boundaryCondition-item",hoverable:!0,onMouseEnter:()=>highlight(type,index),onMouseLeave(){enabled&&unhighlight()},actions:[(0,jsx_runtime.jsx)(assets_button.w6,{onEdit(){setEnabled(!1),onEdit(type,index),setTimeout(()=>setEnabled(!0),500)}},"edit"),(0,jsx_runtime.jsx)(boundaryConditions_delete_Delete,{simulation:{id:simulation.id,scheme:simulation.scheme},type:type,index:index,swr:{mutateOneSimulation:swr.mutateOneSimulation}},"delete")],children:[(0,jsx_runtime.jsx)(typography.Z.Text,{strong:!0,children:child.name})," ",(0,jsx_runtime.jsxs)(typography.Z.Text,{children:["(",typedBoundaryCondition.label,")"]})]},index))}).filter(l=>l)})};var es_radio=__webpack_require__(29924);let boundaryConditions_add_errors={name:"You need to define a name",type:"You need to select a type",selected:"You need to select a face",update:"Unable to add boundary condition"},add_onAdd=async(simulation,boundaryCondition,swr)=>{try{let newBoundaryCondition={...boundaryCondition},type=newBoundaryCondition.type.key;newBoundaryCondition.uuid=(0,v4.Z)();let newSimulation=utils.Z.deepCopy(simulation),boundaryConditions=newSimulation.scheme.configuration.boundaryConditions,TypedBoundaryCondition=boundaryConditions[type];TypedBoundaryCondition.values=[...TypedBoundaryCondition.values||[],newBoundaryCondition];let diff={...boundaryConditions,done:!0};await api_simulation.Z.update({id:simulation.id},[{key:"scheme",type:"json",method:"set",path:["configuration","boundaryConditions"],value:diff}]),await api_simulation.Z.update({id:simulation.id},[{key:"scheme",type:"json",method:"set",path:["configuration","run"],value:{...newSimulation.scheme.configuration.run,done:!1}}]),swr.mutateOneSimulation(newSimulation)}catch(err){throw(0,notification.lt)(boundaryConditions_add_errors.update,err),err}},boundaryConditions_add_Add=param=>{let{simulation,boundaryCondition,swr,onError,onClose}=param,[loading,setLoading]=(0,react.useState)(!1);return(0,jsx_runtime.jsx)(assets_button.HS,{loading:loading,async onAdd(){setLoading(!0);try{var ref,ref1;if(!boundaryCondition.name){onError(boundaryConditions_add_errors.name),setLoading(!1);return}if(!(null===(ref=boundaryCondition.type)||void 0===ref?void 0:ref.key)){onError(boundaryConditions_add_errors.type),setLoading(!1);return}if(!(null===(ref1=boundaryCondition.selected)||void 0===ref1?void 0:ref1.length)){onError(boundaryConditions_add_errors.selected),setLoading(!1);return}onError(),await add_onAdd(simulation,boundaryCondition,swr),setLoading(!1),onClose()}catch(err){setLoading(!1)}},needMargin:!0,children:"Add"})},boundaryConditions_edit_errors={name:"You need to define a name",type:"You need to select a type",selected:"You need to select a face",update:"Unable to edit boundary condition"},boundaryConditions_edit_onEdit=async(simulation,boundaryCondition,oldBoundaryCondition,swr)=>{try{let newSimulation=utils.Z.deepCopy(simulation),boundaryConditions=newSimulation.scheme.configuration.boundaryConditions,type=boundaryCondition.type.key,oldType=oldBoundaryCondition.type.key;if(oldType!==type){let oldtypedBoundaryCondition=boundaryConditions[oldType],index=oldtypedBoundaryCondition.values.findIndex(b=>b.uuid===oldBoundaryCondition.uuid);oldtypedBoundaryCondition.values=[...oldtypedBoundaryCondition.values.slice(0,index),...oldtypedBoundaryCondition.values.slice(index+1)]}if(oldType!==type){let typedBoundaryCondition=boundaryConditions[type];typedBoundaryCondition.values=[...typedBoundaryCondition.values||[],boundaryCondition]}else{let typedBoundaryCondition1=boundaryConditions[type],index1=typedBoundaryCondition1.values.findIndex(b=>b.uuid===boundaryCondition.uuid);typedBoundaryCondition1.values=[...typedBoundaryCondition1.values.slice(0,index1),boundaryCondition,...typedBoundaryCondition1.values.slice(index1+1)]}let diff={...boundaryConditions};await api_simulation.Z.update({id:simulation.id},[{key:"scheme",type:"json",method:"set",path:["configuration","boundaryConditions"],value:diff}]),swr.mutateOneSimulation(newSimulation)}catch(err){throw(0,notification.lt)(boundaryConditions_edit_errors.update,err),err}},boundaryConditions_edit_Edit=param=>{let{simulation,boundaryCondition,oldBoundaryCondition,swr,onError,onClose}=param,[loading,setLoading]=(0,react.useState)(!1);return(0,jsx_runtime.jsx)(assets_button.w6,{loading:loading,async onEdit(){setLoading(!0);try{var ref,ref1;if(!boundaryCondition.name){onError(boundaryConditions_edit_errors.name),setLoading(!1);return}if(!(null===(ref=boundaryCondition.type)||void 0===ref?void 0:ref.key)){onError(boundaryConditions_edit_errors.type),setLoading(!1);return}if(!(null===(ref1=boundaryCondition.selected)||void 0===ref1?void 0:ref1.length)){onError(boundaryConditions_edit_errors.selected),setLoading(!1);return}onError(),await boundaryConditions_edit_onEdit(simulation,boundaryCondition,oldBoundaryCondition,swr),setLoading(!1),onClose()}catch(err){setLoading(!1)}},primary:!0,needMargin:!0,children:"Edit"})},BoundaryCondition=param=>{var ref;let{visible,geometry,simulation,boundaryCondition,swr,onClose}=param,[alreadySelected,setAlreadySelected]=(0,react.useState)([]),[types,setTypes]=(0,react.useState)([]),[totalNumber,setTotalNumber]=(0,react.useState)(),[current,setCurrent]=(0,react.useState)(),[error,setError]=(0,react.useState)(),boundaryConditions=simulation.scheme.configuration.boundaryConditions,dimension=simulation.scheme.configuration.dimension;(0,react.useEffect)(()=>{!visible&&current&&setCurrent(void 0)}),(0,react.useEffect)(()=>{visible&&!current&&boundaryCondition?setCurrent(boundaryCondition):!visible||current||boundaryCondition||void 0===totalNumber||setCurrent(prevCurrent=>({...prevCurrent,name:"Boundary condition "+(totalNumber+1)}))},[current,totalNumber,visible,boundaryCondition]),(0,react.useEffect)(()=>{let currentAlreadySelected=Object.keys(boundaryConditions).map(type=>{var ref;if("index"===type||"title"===type||"done"===type)return;let typedBoundaryCondition=boundaryConditions[type];return null==typedBoundaryCondition?void 0:null===(ref=typedBoundaryCondition.values)||void 0===ref?void 0:ref.map(b=>{if(b.uuid!==(null==boundaryCondition?void 0:boundaryCondition.uuid))return{label:b.name,selected:b.selected}}).filter(s=>s)}).flat().filter(s=>s);setAlreadySelected(currentAlreadySelected)},[boundaryConditions,boundaryCondition]),(0,react.useEffect)(()=>{let currentTypes=Object.keys(boundaryConditions).map(type=>{if("index"===type||"title"===type||"done"===type)return;let typedBoundaryCondition=boundaryConditions[type];return{key:type,label:typedBoundaryCondition.label,children:typedBoundaryCondition.children,values:typedBoundaryCondition.values}}).filter(t=>t);setTypes(currentTypes)},[boundaryConditions]),(0,react.useEffect)(()=>{let numberOfBoundaryConditions=null==types?void 0:types.map(t=>{var ref;return null===(ref=t.values)||void 0===ref?void 0:ref.length}).filter(n=>n).reduce((a,b)=>a+b,0);setTotalNumber(numberOfBoundaryConditions)},[types]);let onName=(0,react.useCallback)(event=>{let name=event.target.value;setCurrent(prevCurrent=>({...prevCurrent,name:name}))},[]),onType=(0,react.useCallback)(event=>{var ref;let key=event.target.value,type=types.find(t=>t.key===key),typedBoundaryCondition=boundaryConditions[key],values=null===(ref=typedBoundaryCondition.children)||void 0===ref?void 0:ref.map(child=>({checked:!0,value:child.default}));setCurrent(prevCurrent=>({...prevCurrent,type:{key:type.key,label:type.label,children:type.children},values:values}))},[boundaryConditions,types]),onValueChange=(0,react.useCallback)((index,value)=>{setCurrent(prevCurrent=>({...prevCurrent,values:[...prevCurrent.values.slice(0,index),{checked:prevCurrent.values[index].checked,value},...prevCurrent.values.slice(index+1)]}))},[]),onCheckedChange=(0,react.useCallback)((index,checked)=>{setCurrent(prevCurrent=>({...prevCurrent,values:[...prevCurrent.values.slice(0,index),{checked,value:prevCurrent.values[index].value},...prevCurrent.values.slice(index+1)]}))},[]),onSelected=(0,react.useCallback)(selected=>{setCurrent(prevCurrent=>({...prevCurrent,selected:selected}))},[]),inputs=(0,react.useMemo)(()=>{var ref;return(null==current?void 0:current.type)&&(null===(ref=current.type)||void 0===ref?void 0:ref.children)?(0,jsx_runtime.jsx)(card.Z,{children:current.type.children.map((child,index)=>{if(2!==dimension||!child.only3D)return(0,jsx_runtime.jsx)(Formula,{className:"marginBottom-10",label:child.label,defaultValue:String(current.values[index].value),defaultChecked:current.type.children.length>1?current.values[index].checked:void 0,onValueChange:value=>onValueChange(index,value),onCheckedChange:checked=>onCheckedChange(index,checked),unit:child.unit},index)})}):null},[current,dimension,onCheckedChange,onValueChange]);return(0,jsx_runtime.jsx)(drawer.Z,{className:"boundaryCondition",title:"Boundary condition",placement:"left",closable:!1,open:visible,mask:!1,maskClosable:!1,width:300,extra:(0,jsx_runtime.jsx)(es_button.Z,{type:"text",icon:(0,jsx_runtime.jsx)(CloseOutlined.Z,{}),onClick(){setCurrent(void 0),onClose()}}),footer:(0,jsx_runtime.jsxs)("div",{style:{display:"flex",justifyContent:"flex-end"},children:[(0,jsx_runtime.jsx)(assets_button.Lw,{onCancel(){setCurrent(void 0),onClose()}}),boundaryCondition?(0,jsx_runtime.jsx)(boundaryConditions_edit_Edit,{boundaryCondition:{uuid:(null==current?void 0:current.uuid)||boundaryCondition.uuid,name:(null==current?void 0:current.name)||boundaryCondition.name,type:(null==current?void 0:current.type)||boundaryCondition.type,selected:(null==current?void 0:current.selected)||boundaryCondition.selected,values:(null==current?void 0:current.values)||boundaryCondition.values},oldBoundaryCondition:{uuid:boundaryCondition.uuid,name:boundaryCondition.name,type:boundaryCondition.type,selected:boundaryCondition.selected,values:boundaryCondition.values},simulation:{id:simulation.id,scheme:simulation.scheme},swr:{mutateOneSimulation:swr.mutateOneSimulation},onError:desc=>setError(desc),onClose:onClose}):(0,jsx_runtime.jsx)(boundaryConditions_add_Add,{boundaryCondition:{name:null==current?void 0:current.name,type:null==current?void 0:current.type,selected:null==current?void 0:current.selected,values:null==current?void 0:current.values},simulation:{id:simulation.id,scheme:simulation.scheme},swr:{mutateOneSimulation:swr.mutateOneSimulation},onError:desc=>setError(desc),onClose:onClose})]}),children:(0,jsx_runtime.jsxs)(space.Z,{direction:"vertical",className:"full-width",children:[(0,jsx_runtime.jsx)(card.Z,{size:"small",children:(0,jsx_runtime.jsx)(es_form.Z,{layout:"vertical",children:(0,jsx_runtime.jsx)(es_form.Z.Item,{label:(0,jsx_runtime.jsx)(typography.Z.Text,{strong:!0,children:"Boundary condition name"}),children:(0,jsx_runtime.jsx)(input.Z,{value:(null==current?void 0:current.name)||"",onChange:onName,maxLength:50})})})}),(0,jsx_runtime.jsx)(card.Z,{size:"small",children:(0,jsx_runtime.jsx)(es_form.Z,{layout:"vertical",children:(0,jsx_runtime.jsx)(es_form.Z.Item,{label:(0,jsx_runtime.jsx)(typography.Z.Text,{strong:!0,children:"Boundary condition type"}),children:(0,jsx_runtime.jsx)(es_radio.ZP.Group,{className:"BoundaryCondition-types",optionType:"button",buttonStyle:"solid",value:null==current?void 0:null===(ref=current.type)||void 0===ref?void 0:ref.key,onChange:onType,children:null==types?void 0:types.map(type=>(0,jsx_runtime.jsx)(es_radio.ZP.Button,{value:type.key,children:type.label},type.key))})})})}),inputs,(0,jsx_runtime.jsx)(Selector,{geometry:geometry,alreadySelected:alreadySelected,updateSelected:onSelected}),error&&(0,jsx_runtime.jsxs)(typography.Z.Text,{children:[(0,jsx_runtime.jsx)(ExclamationCircleOutlined.Z,{style:{color:"red"}})," ",error]})]})})},BoundaryConditions=param=>{let{simulation,geometry,swr,setVisible}=param,[boundaryCondition,setBoundaryCondition]=(0,react.useState)(),[boundaryConditionVisible,setBoundaryConditionVisible]=(0,react.useState)(!1),{dispatch}=(0,react.useContext)(SelectContext),boundaryConditions=simulation.scheme.configuration.boundaryConditions;(0,react.useEffect)(()=>{(null==geometry?void 0:geometry.summary)&&dispatch(setType(2===geometry.summary.dimension?"edges":"faces"))},[geometry,dispatch]);let onAdd=(0,react.useCallback)(()=>{setBoundaryCondition(void 0),setBoundaryConditionVisible(!0),setVisible(!1),dispatch(enable())},[dispatch,setVisible]),onEdit=(0,react.useCallback)((type,index)=>{let boundaryConditionType=boundaryConditions[type],boundaryConditionToEdit=boundaryConditionType.values[index];setBoundaryCondition(boundaryConditionToEdit),setBoundaryConditionVisible(!0),setVisible(!1),dispatch(enable())},[boundaryConditions,dispatch,setVisible]),onClose=(0,react.useCallback)(()=>{dispatch(disable()),setBoundaryConditionVisible(!1),setBoundaryCondition(void 0),setVisible(!0)},[dispatch,setVisible]);return geometry?(0,jsx_runtime.jsx)(layout.Z,{children:(0,jsx_runtime.jsx)(layout.Z.Content,{children:(0,jsx_runtime.jsxs)(card.Z,{size:"small",children:[(0,jsx_runtime.jsx)(assets_button.HS,{onAdd:onAdd,fullWidth:!0,primary:!1,children:"Add boundary condition"}),(0,jsx_runtime.jsx)(list_List,{simulation:{id:simulation.id,scheme:simulation.scheme},swr:{mutateOneSimulation:swr.mutateOneSimulation},onEdit:onEdit}),(0,jsx_runtime.jsx)(BoundaryCondition,{visible:boundaryConditionVisible,geometry:{summary:geometry.summary},simulation:{id:simulation.id,scheme:simulation.scheme},boundaryCondition:boundaryCondition&&{uuid:boundaryCondition.uuid,name:boundaryCondition.name,type:boundaryCondition.type,selected:boundaryCondition.selected,values:boundaryCondition.values},swr:{mutateOneSimulation:swr.mutateOneSimulation},onClose:onClose})]})})}):(0,jsx_runtime.jsx)(loading.Z.Simple,{})};var es_steps=__webpack_require__(1485),RocketOutlined=__webpack_require__(67841),ApiOutlined=__webpack_require__(36027),PushpinOutlined=__webpack_require__(57184);let sensors_edit_errors={name:"You need to define a name",point:"You need to select a point",formula:"You need to define a formula",update:"Unable to update simulation"},sensors_edit_onEdit=async(simulation,sensor,swr)=>{try{let newSimulation=utils.Z.deepCopy(simulation),run=newSimulation.scheme.configuration.run,index=sensor.index;run.sensors[index]={name:sensor.name,point:sensor.point,formula:sensor.formula},await api_simulation.Z.update({id:simulation.id},[{key:"scheme",type:"json",method:"set",path:["configuration","run"],value:run}]),swr.mutateOneSimulation(newSimulation)}catch(err){throw(0,notification.lt)(sensors_edit_errors.update,err),err}},sensors_edit_Edit=param=>{let{simulation,sensor,onError,onClose,swr}=param,[loading,setLoading]=(0,react.useState)();return(0,jsx_runtime.jsx)(assets_button.w6,{loading:loading,primary:!0,needMargin:!0,async onEdit(){setLoading(!0);try{if(!sensor.name){onError(sensors_edit_errors.name),setLoading(!1);return}if(!sensor.point){onError(sensors_edit_errors.point),setLoading(!1);return}if(!sensor.formula){onError(sensors_edit_errors.formula),setLoading(!1);return}onError(),await sensors_edit_onEdit(simulation,sensor,swr),setLoading(!1),onClose()}catch(err){setLoading(!1)}},children:"Edit"})},sensors_add_errors={name:"You need to define a name",point:"You need to select a point",formula:"You need to define a formula",update:"Unable to update simulation"},sensors_add_onAdd=async(simulation,sensor,swr)=>{try{let newSimulation=utils.Z.deepCopy(simulation),run=newSimulation.scheme.configuration.run,diff={...run,sensors:[...run.sensors||[],sensor]};await api_simulation.Z.update({id:simulation.id},[{key:"scheme",type:"json",method:"set",path:["configuration","run"],value:diff}]),swr.mutateOneSimulation(newSimulation)}catch(err){throw(0,notification.lt)(sensors_add_errors.update,err),err}},sensors_add_Add=param=>{let{simulation,sensor,onError,onClose,swr}=param,[loading,setLoading]=(0,react.useState)();return(0,jsx_runtime.jsx)(assets_button.HS,{loading:loading,needMargin:!0,async onAdd(){setLoading(!0);try{if(!sensor.name){onError(sensors_add_errors.name),setLoading(!1);return}if(!sensor.point){onError(sensors_add_errors.point),setLoading(!1);return}if(!sensor.formula){onError(sensors_add_errors.formula),setLoading(!1);return}onError(),await sensors_add_onAdd(simulation,sensor,swr),setLoading(!1),onClose()}catch(err){setLoading(!1)}},children:"Add"})},Sensor=param=>{var ref,ref1,ref2,ref3,ref4,ref5;let{visible,simulation,sensor,onClose,swr}=param,[selectionEnabled,setSelectionEnabled]=(0,react.useState)(),[name,setName]=(0,react.useState)(),[formula,setFormula]=(0,react.useState)(),[error,setError]=(0,react.useState)(),{point,dispatch}=(0,react.useContext)(SelectContext);(0,react.useEffect)(()=>{dispatch(setType("point"))},[dispatch]),(0,react.useEffect)(()=>{if(!sensor){let run=simulation.scheme.configuration.run;setName("Sensor "+(run.sensors?run.sensors.length+1:1))}},[simulation,sensor]),(0,react.useEffect)(()=>{sensor&&(setName(sensor.name),dispatch(setPoint({x:sensor.point.x,y:sensor.point.y,z:sensor.point.z})),setFormula(sensor.formula))},[sensor,dispatch]);let stopSelection=(0,react.useCallback)(()=>{setSelectionEnabled(!1),dispatch(disable()),window.removeEventListener("click",stopSelection)},[dispatch]),startSelection=(0,react.useCallback)(()=>{selectionEnabled?stopSelection():(setSelectionEnabled(!0),dispatch(enable()),setTimeout(()=>window.addEventListener("click",stopSelection),50))},[selectionEnabled,stopSelection,dispatch]),onPosition=(0,react.useCallback)((x,y,z)=>{dispatch(setPoint({x,y,z}))},[dispatch]),onFormula=(0,react.useCallback)(newFormula=>{setFormula(newFormula)},[]),close=(0,react.useCallback)(()=>{setName(void 0),setFormula(void 0),setError(void 0),dispatch(setPoint()),onClose()},[dispatch,onClose]);return(0,jsx_runtime.jsx)(drawer.Z,{className:"sensor",title:"Sensor",placement:"left",closable:!1,open:visible,mask:!1,maskClosable:!1,width:300,extra:(0,jsx_runtime.jsx)(es_button.Z,{type:"text",icon:(0,jsx_runtime.jsx)(CloseOutlined.Z,{}),onClick:close}),footer:(0,jsx_runtime.jsxs)("div",{style:{display:"flex",justifyContent:"flex-end"},children:[(0,jsx_runtime.jsx)(assets_button.Lw,{onCancel:close}),sensor?(0,jsx_runtime.jsx)(sensors_edit_Edit,{simulation:simulation,sensor:{...sensor,name:name,point:point,formula:formula},onError:setError,onClose:close,swr:swr}):(0,jsx_runtime.jsx)(sensors_add_Add,{simulation:simulation,sensor:{name:name,point:point,formula:formula},onError:setError,onClose:close,swr:swr})]}),children:(0,jsx_runtime.jsxs)(space.Z,{direction:"vertical",className:"full-width",children:[(0,jsx_runtime.jsxs)(card.Z,{size:"small",children:[(0,jsx_runtime.jsx)(typography.Z.Text,{children:"Name"}),(0,jsx_runtime.jsx)(input.Z,{value:name,onChange:e=>setName(e.target.value)})]}),(0,jsx_runtime.jsx)(card.Z,{size:"small",children:(0,jsx_runtime.jsxs)(space.Z,{direction:"vertical",className:"full-width",children:[(0,jsx_runtime.jsxs)(space.Z,{className:"full-width",style:{justifyContent:"space-between"},children:[(0,jsx_runtime.jsx)(typography.Z.Text,{children:"Point selection"}),(0,jsx_runtime.jsx)(tooltip.Z,{title:"Pin in the geometry",children:(0,jsx_runtime.jsx)(es_button.Z,{size:"small",type:selectionEnabled?"primary":"default",icon:(0,jsx_runtime.jsx)(PushpinOutlined.Z,{}),onClick:startSelection})})]}),(0,jsx_runtime.jsx)(Formula,{label:"X",defaultValue:null==point?void 0:point.x,onValueChange:value=>onPosition(+value,null!==(ref=null==point?void 0:point.y)&&void 0!==ref?ref:0,null!==(ref1=null==point?void 0:point.z)&&void 0!==ref1?ref1:0)}),(0,jsx_runtime.jsx)(Formula,{label:"Y",defaultValue:null==point?void 0:point.y,onValueChange:value=>onPosition(null!==(ref2=null==point?void 0:point.x)&&void 0!==ref2?ref2:0,+value,null!==(ref3=null==point?void 0:point.z)&&void 0!==ref3?ref3:0)}),(0,jsx_runtime.jsx)(Formula,{label:"Z",defaultValue:null==point?void 0:point.z,onValueChange:value=>onPosition(null!==(ref4=null==point?void 0:point.x)&&void 0!==ref4?ref4:0,null!==(ref5=null==point?void 0:point.y)&&void 0!==ref5?ref5:0,+value)})]})}),(0,jsx_runtime.jsx)(card.Z,{size:"small",className:"no-border-bottom",children:(0,jsx_runtime.jsx)(Formula,{label:"Formula",defaultValue:formula,onValueChange:onFormula})}),error&&(0,jsx_runtime.jsxs)(typography.Z.Text,{children:[(0,jsx_runtime.jsx)(ExclamationCircleOutlined.Z,{style:{color:"red"}})," ",error]})]})})},sensors_delete_errors={udpate:"Unable to update simulation"},sensors_delete_onDelete=async(simulation,index,dispatch,swr)=>{try{let newSimulation=utils.Z.deepCopy(simulation),run=newSimulation.scheme.configuration.run;dispatch(setPoint()),run.sensors=[...run.sensors.slice(0,index),...run.sensors.slice(index+1)],await api_simulation.Z.update({id:simulation.id},[{key:"scheme",type:"json",method:"set",path:["configuration","run"],value:run}]),swr.mutateOneSimulation(newSimulation)}catch(err){throw(0,notification.lt)(sensors_delete_errors.udpate,err),err}},sensors_delete_Delete=param=>{let{simulation,index,swr}=param,[loading,setLoading]=(0,react.useState)(),{dispatch}=(0,react.useContext)(SelectContext),run=simulation.scheme.configuration.run,sensor=run.sensors[index];return(0,jsx_runtime.jsx)(assets_button.m1,{loading:loading,text:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["Are you sure you want to delete the sensor"," ",(0,jsx_runtime.jsx)(typography.Z.Text,{strong:!0,children:sensor.name})]}),async onDelete(){setLoading(!0);try{await sensors_delete_onDelete(simulation,index,dispatch,swr)}finally{setLoading(!1)}}})},sensors_list_List=param=>{var ref;let{simulation,onEdit,swr}=param,[enabled,setEnabled]=(0,react.useState)(!0),run=simulation.scheme.configuration.run,{dispatch}=(0,react.useContext)(SelectContext),highlight=(0,react.useCallback)(sensor=>{dispatch(enable()),dispatch(setPoint(sensor.point))},[dispatch]),unhighlight=(0,react.useCallback)(()=>{enabled&&dispatch(setPoint()),dispatch(disable())},[enabled,dispatch]);return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:null===(ref=run.sensors)||void 0===ref?void 0:ref.map((sensor,index)=>(0,jsx_runtime.jsx)(card.Z,{className:"sensor-item text-center",hoverable:!0,onMouseEnter:()=>highlight(sensor),onMouseLeave:unhighlight,actions:[(0,jsx_runtime.jsx)(assets_button.w6,{onEdit(){setEnabled(!1),onEdit({...sensor,index}),setTimeout(()=>setEnabled(!0),500)}},"edit"),(0,jsx_runtime.jsx)(sensors_delete_Delete,{simulation:simulation,index:index,swr:swr},"delete")],children:(0,jsx_runtime.jsx)(typography.Z.Text,{strong:!0,className:"text-center",children:sensor.name})},index))})},Sensors=param=>{let{simulation,setVisible,setResult,setPostprocessing,swr}=param,[sensorVisible,setSensorVisible]=(0,react.useState)(),[sensor,setSensor]=(0,react.useState)(),onAdd=(0,react.useCallback)(()=>{setResult(void 0),setPostprocessing(void 0),setSensor(void 0),setVisible(!1),setSensorVisible(!0)},[setVisible,setResult,setPostprocessing]),onEdit=(0,react.useCallback)(toEdit=>{setResult(void 0),setPostprocessing(void 0),setSensor(toEdit),setVisible(!1),setSensorVisible(!0)},[setVisible,setResult,setPostprocessing]),onClose=(0,react.useCallback)(()=>{setSensor(void 0),setVisible(!0),setSensorVisible(!1)},[setVisible]);return(0,jsx_runtime.jsxs)(card.Z,{size:"small",title:"Sensors",children:[(0,jsx_runtime.jsx)(Sensor,{visible:sensorVisible,simulation:simulation,sensor:sensor,onClose:onClose,swr:swr}),(0,jsx_runtime.jsxs)(space.Z,{direction:"vertical",className:"full-width",children:[(0,jsx_runtime.jsx)(es_button.Z,{className:"full-width",disabled:!1,type:"primary",icon:(0,jsx_runtime.jsx)(ApiOutlined.Z,{}),onClick:onAdd,children:"Add a sensor"}),(0,jsx_runtime.jsx)(sensors_list_List,{simulation:simulation,onEdit:onEdit,swr:swr})]})]})};var CloudServerOutlined=__webpack_require__(139),api_plugin=__webpack_require__(71270);let cloudServer_errors={plugins:"Plugins error",pluginsLoad:"Unable to load plugins"},CloudServer=param=>{let{disabled,cloudServer,onOk}=param,[visible,setVisible]=(0,react.useState)(!1),[Plugins,setPlugins]=(0,react.useState)([]),router=(0,next_router.useRouter)(),[plugins,{errorPlugins}]=api_plugin.Z.usePlugins();return(0,react.useEffect)(()=>{errorPlugins&&(0,notification.lt)(cloudServer_errors.plugins,errorPlugins)},[errorPlugins]),(0,react.useEffect)(()=>{api_plugins.Z.list().then(list=>{setPlugins(list)}).catch(err=>{(0,notification.lt)(cloudServer_errors.pluginsLoad,err)})},[]),(0,jsx_runtime.jsxs)(card.Z,{size:"small",title:"Computational resource",children:[(0,jsx_runtime.jsx)(modal.Z,{open:visible,title:"Computational resource",okButtonProps:{disabled:!0,style:{display:"none"}},onCancel:()=>setVisible(!1),style:{width:"unset"},children:(0,jsx_runtime.jsxs)(space.Z,{direction:"vertical",children:[(0,jsx_runtime.jsxs)(typography.Z.Text,{children:["Your computational resource does not appear in this list? Create one in your"," ",(0,jsx_runtime.jsx)(assets_button.Qj,{onClick:()=>router.push({pathname:"/dashboard",query:{page:"account",tab:"hpc"}}),children:"account settings"})]}),(0,jsx_runtime.jsx)(space.Z,{align:"start",direction:"horizontal",wrap:!0,children:null==plugins?void 0:plugins.map(plugin=>{let Plugin=Plugins.find(p=>p.key===plugin.key);if(!Plugin)return;let Renderer=dynamic_default()(()=>__webpack_require__(64546)("./".concat(Plugin.key,"/src/components")));return(0,jsx_runtime.jsx)(card.Z,{title:plugin.configuration.name.value,children:(0,jsx_runtime.jsx)(Renderer,{data:plugin.data,onSelect(diff){(0,lodash.merge)(plugin,diff),onOk(plugin),setVisible(!1)}})},plugin.uuid)})})]})}),(0,jsx_runtime.jsxs)(space.Z,{direction:"vertical",className:"full-width",children:[cloudServer&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)(typography.Z.Text,{children:[(0,jsx_runtime.jsx)("span",{className:"text-light",children:"Plugin:"})," ",cloudServer.name]}),(0,jsx_runtime.jsxs)(typography.Z.Text,{children:[(0,jsx_runtime.jsx)("span",{className:"text-light",children:"Name:"})," ",cloudServer.configuration.name.value]}),Object.keys(cloudServer.inUseConfiguration).map(key=>{let item=cloudServer.inUseConfiguration[key],value=item.value;return"boolean"==typeof value&&(value=value?"yes":"no"),(0,jsx_runtime.jsxs)(typography.Z.Text,{children:[(0,jsx_runtime.jsxs)("span",{className:"text-light",children:[item.label,":"]})," ",value]},key)})]}),(0,jsx_runtime.jsx)(es_button.Z,{className:"full-width",disabled:disabled,type:cloudServer?"link":"primary",icon:(0,jsx_runtime.jsx)(CloudServerOutlined.Z,{}),onClick:()=>setVisible(!0),children:cloudServer?"Modify the resource":"Select a resource"})]})]})};var FileTextOutlined=__webpack_require__(15360),html_react_parser=__webpack_require__(25935),log_Buffer=__webpack_require__(48764).lW;let log_errors={log:"Unable to get system log"},getCompleteLog=async(simulation,step)=>{try{let res=await api_simulation.Z.log({id:simulation.id},step.systemLog),log=log_Buffer.from(res.log).toString();modal.Z.info({title:"System log",width:"unset",content:(0,jsx_runtime.jsx)("div",{style:{maxHeight:"70vh",overflow:"auto"},children:(0,jsx_runtime.jsx)("pre",{children:(0,jsx_runtime.jsx)("code",{children:(0,html_react_parser.ZP)(log.replace(/\n\n/g,"\n").replace(/\n/g,"<br />"))})})})})}catch(err){(0,notification.lt)(log_errors.log,err)}},Log=param=>{let{simulation,steps}=param,[visible,setVisible]=(0,react.useState)(!1),[loading,setLoading]=(0,react.useState)(!1);return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(drawer.Z,{title:"Log",open:visible,onClose:()=>setVisible(!1),width:"50%",children:(0,jsx_runtime.jsx)(tabs.Z,{items:null==steps?void 0:steps.map(step=>{var ref,ref1;return{key:step.label,label:step.label,children:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[step.systemLog&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(es_button.Z,{loading:loading,async onClick(){setLoading(!0);try{await getCompleteLog(simulation,step)}catch(err){}finally{setLoading(!1)}},children:"Complete log"}),(0,jsx_runtime.jsx)("br",{})]}),step.link&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("a",{href:"https://"+step.link.href,target:"_blank",rel:"noreferrer",children:(0,jsx_runtime.jsx)(es_button.Z,{type:"primary",children:step.link.label})}),(0,jsx_runtime.jsx)("br",{})]}),(0,jsx_runtime.jsxs)(collapse.Z,{ghost:!0,children:[step.warning&&(0,jsx_runtime.jsx)(collapse.Z.Panel,{className:"warning-collapse",header:(0,jsx_runtime.jsx)(typography.Z.Text,{type:"warning",children:"Warnings"}),children:(0,html_react_parser.ZP)(step.warning.replace(/\n\n/g,"\n").replace(/\n/g,"<br />"))},"warnings"),step.error&&(0,jsx_runtime.jsx)(collapse.Z.Panel,{className:"error-collapse",header:(0,jsx_runtime.jsx)(typography.Z.Text,{type:"danger",children:"Errors"}),children:(0,html_react_parser.ZP)(step.error.replace(/\n\n/g,"\n").replace(/\n/g,"<br />"))},"errors")]}),(0,html_react_parser.ZP)((null===(ref=step.pluginLog)||void 0===ref?void 0:ref.replace(/\n\n/g,"\n").replace(/\n/g,"<br />"))||""),(0,html_react_parser.ZP)((null===(ref1=step.log)||void 0===ref1?void 0:ref1.replace(/\n\n/g,"\n").replace(/\n/g,"<br />"))||"")]})}})})}),(0,jsx_runtime.jsx)(tooltip.Z,{title:"Log",children:(0,jsx_runtime.jsx)(es_button.Z,{disabled:!steps||!steps.length,icon:(0,jsx_runtime.jsx)(FileTextOutlined.Z,{}),onClick:()=>setVisible(!0)})})]})};var EyeOutlined=__webpack_require__(99611),DownloadOutlined=__webpack_require__(23430);let download_errors={download:"Unable to download file"},download_onDownload=async(simulation,file)=>{try{let content=await api_result.download({id:simulation.id},{originPath:file.originPath,fileName:file.fileName}),blob=await content.blob(),url=window.URL.createObjectURL(new Blob([blob])),link=document.createElement("a");link.href=url,link.setAttribute("download",file.name+"."+file.fileName.split(".").pop()),link.click()}catch(err){(0,notification.lt)(download_errors.download,err)}},Download=param=>{let{simulation,file}=param,[loading,setLoading]=(0,react.useState)(!1);return(0,jsx_runtime.jsx)(tooltip.Z,{title:"Download",children:(0,jsx_runtime.jsx)(es_button.Z,{loading:loading,icon:(0,jsx_runtime.jsx)(DownloadOutlined.Z,{}),async onClick(){setLoading(!0);try{await download_onDownload(simulation,file)}catch(err){}finally{setLoading(!1)}}})})},archive_errors={archive:"Unable to download archive"},onArchive=async simulation=>{try{let archive=await api_result.archive({id:simulation.id}),content=await archive.blob(),url=window.URL.createObjectURL(new Blob([content])),link=document.createElement("a");link.href=url,link.setAttribute("download",simulation.scheme.name+".zip"),link.click()}catch(err){(0,notification.lt)(archive_errors.archive,err)}},Archive=param=>{let{simulation}=param,[loading,setLoading]=(0,react.useState)(!1);return(0,jsx_runtime.jsx)(assets_button.o6,{loading:loading,async onDownload(){setLoading(!0);try{await onArchive(simulation)}catch(err){}finally{setLoading(!1)}}})},Results=param=>{var ref;let{simulation,result,setResult}=param,[singleFiles,setSingleFiles]=(0,react.useState)(),[filteredFiles,setFilteredFiles]=(0,react.useState)(),[currentNumber,setCurrentNumber]=(0,react.useState)(),configuration=null==simulation?void 0:null===(ref=simulation.scheme)||void 0===ref?void 0:ref.configuration;return((0,react.useEffect)(()=>{var ref;if(!(null==simulation?void 0:simulation.tasks)){setSingleFiles([]),setFilteredFiles(void 0);return}let newSingleFiles=[],filter=null==configuration?void 0:null===(ref=configuration.run)||void 0===ref?void 0:ref.resultsFilter;simulation.tasks.forEach(task=>{if(task.file&&newSingleFiles.push(task.file),task.files){if(filter){let pattern=RegExp(filter.pattern),notFilteredFiles=task.files.filter(file=>!pattern.test(file.fileName)),files=task.files.filter(file=>pattern.test(file.fileName)),filesWithNumbers=getFilesNumbers(files,filter),numbers=filesWithNumbers.map(file=>file.number).filter((n,i,s)=>s.indexOf(n)===i).sort((a,b)=>a-b),multiplicator=getMultiplicator(configuration,filter),options=numbers.map((n,i)=>({label:Math.round(1e15*(multiplicator?n*multiplicator:i))/1e15,value:n}));newSingleFiles.push(...notFilteredFiles),setFilteredFiles({filtered:!0,name:filter.name,files:filesWithNumbers,options})}else newSingleFiles.push(...task.files)}}),setSingleFiles(newSingleFiles)},[simulation,configuration]),(0,react.useEffect)(()=>{!currentNumber&&filteredFiles&&setCurrentNumber(null==filteredFiles?void 0:filteredFiles.options[0].value)},[filteredFiles,currentNumber]),singleFiles||filteredFiles)?(null==singleFiles?void 0:singleFiles.length)||filteredFiles?(0,jsx_runtime.jsx)(card.Z,{size:"small",title:"Results",extra:(0,jsx_runtime.jsx)(Archive,{simulation:simulation&&{id:simulation.id,scheme:simulation.scheme}}),children:(0,jsx_runtime.jsxs)(space.Z,{direction:"vertical",className:"full-width",children:[null==singleFiles?void 0:singleFiles.map(file=>(0,jsx_runtime.jsxs)(space.Z,{style:{alignItems:"center"},children:[(0,jsx_runtime.jsx)(es_button.Z,{icon:(null==result?void 0:result.fileName)===(null==file?void 0:file.fileName)&&(null==result?void 0:result.name)===(null==file?void 0:file.name)?(0,jsx_runtime.jsx)(EyeOutlined.Z,{style:{color:"#fad114"}}):(0,jsx_runtime.jsx)(EyeInvisibleOutlined.Z,{}),onClick:()=>setResult((null==result?void 0:result.fileName)===(null==file?void 0:file.fileName)&&(null==result?void 0:result.name)===(null==file?void 0:file.name)?void 0:file)}),(0,jsx_runtime.jsx)(Download,{simulation:simulation&&{id:simulation.id},file:file&&{name:file.name,fileName:file.fileName,originPath:file.originPath}}),file.name]},file.name)),filteredFiles&&(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[filteredFiles.name,(0,jsx_runtime.jsx)(es_select.Z,{className:"full-width",options:filteredFiles.options,value:currentNumber,onChange(value){let nextResult=filteredFiles.files.find(file=>file.number===value&&file.name===(null==result?void 0:result.name));setResult(nextResult),setCurrentNumber(value)}}),filteredFiles.files.map(filteredFile=>{if(filteredFile.number===currentNumber)return(0,jsx_runtime.jsxs)(space.Z,{style:{alignItems:"center"},children:[(0,jsx_runtime.jsx)(es_button.Z,{icon:(null==result?void 0:result.fileName)===(null==filteredFile?void 0:filteredFile.fileName)&&(null==result?void 0:result.name)===(null==filteredFile?void 0:filteredFile.name)?(0,jsx_runtime.jsx)(EyeOutlined.Z,{style:{color:"#fad114"}}):(0,jsx_runtime.jsx)(EyeInvisibleOutlined.Z,{}),onClick:()=>setResult((null==result?void 0:result.fileName)===(null==filteredFile?void 0:filteredFile.fileName)&&(null==result?void 0:result.name)===(null==filteredFile?void 0:filteredFile.name)?void 0:filteredFile)}),(0,jsx_runtime.jsx)(Download,{simulation:simulation&&{id:simulation.id},file:filteredFile&&{name:filteredFile.name,fileName:filteredFile.fileName,originPath:filteredFile.originPath}}),filteredFile.name]},filteredFile.name)})]})]})}):(0,jsx_runtime.jsx)(card.Z,{size:"small",children:"No results yet"}):(0,jsx_runtime.jsx)(spin.Z,{})},run_errors={run:"Unable to run simulation",stop:"Unable to stop simulation",update:"Unable to update simulation"},onCloudServer=async(simulation,cloudServer,swr)=>{try{let newSimulation=utils.Z.deepCopy(simulation),configuration=simulation.scheme.configuration;configuration.run.cloudServer=cloudServer,newSimulation.scheme.configuration=configuration,await api_simulation.Z.update({id:simulation.id},[{key:"scheme",type:"json",method:"set",path:["configuration","run"],value:configuration.run}]),swr.mutateOneSimulation(newSimulation),swr.mutateSimulation(newSimulation)}catch(err){(0,notification.lt)(run_errors.update,err)}},onRun=async simulation=>{try{await api_simulation.Z.run({id:simulation.id})}catch(err){throw(0,notification.lt)(run_errors.run,err),err}},onStop=async simulation=>{try{await api_simulation.Z.stop({id:simulation.id})}catch(err){throw(0,notification.lt)(run_errors.stop,err),err}},Run=param=>{var ref,ref1;let{simulation,result,setResult,setPostprocessing,setVisible,swr}=param,[disabled,setDisabled]=(0,react.useState)(!1),[running,setRunning]=(0,react.useState)(!1),[steps,setSteps]=(0,react.useState)([]),[currentSimulation,{mutateSimulation}]=api_simulation.Z.useSimulation(simulation.id,2e3),configuration=simulation.scheme.configuration,currentConfiguration=null==currentSimulation?void 0:null===(ref=currentSimulation.scheme)||void 0===ref?void 0:ref.configuration;return((0,react.useEffect)(()=>{if(!configuration){setDisabled(!0);return}let done=!0;Object.keys(configuration).forEach(key=>{if("dimension"!==key&&"run"!==key){let item=configuration[key];item.done||(done=!1)}}),configuration.run.cloudServer||(done=!1),setDisabled(!done)},[configuration]),(0,react.useEffect)(()=>{var ref,ref1;(null==currentSimulation?void 0:null===(ref=currentSimulation.tasks)||void 0===ref?void 0:ref.find(t=>(null==t?void 0:t.status)==="error"))?setRunning(!1):(null==currentSimulation?void 0:null===(ref1=currentSimulation.tasks)||void 0===ref1?void 0:ref1.find(t=>t&&"finish"!==t.status))?setRunning(!0):setRunning(!1)},[null==currentSimulation?void 0:currentSimulation.tasks]),(0,react.useEffect)(()=>{var ref;let newSteps=[];null==currentSimulation||null===(ref=currentSimulation.tasks)||void 0===ref||ref.forEach(task=>{task&&(newSteps[task.index]={index:task.index,label:task.label,status:task.status,log:task.log,pluginLog:task.pluginLog,warning:task.warning,error:task.error,systemLog:task.systemLog,link:task.link})}),setSteps(newSteps)},[null==currentSimulation?void 0:currentSimulation.tasks]),simulation&&currentSimulation&&(null==currentSimulation?void 0:currentSimulation.id)!=="0")?(0,jsx_runtime.jsx)(layout.Z,{children:(0,jsx_runtime.jsx)(layout.Z.Content,{children:(0,jsx_runtime.jsxs)(space.Z,{direction:"vertical",className:"full-width",children:[(0,jsx_runtime.jsx)(Sensors,{simulation:simulation,setVisible:setVisible,setResult:setResult,setPostprocessing:setPostprocessing,swr:{mutateOneSimulation:swr.mutateOneSimulation}}),(0,jsx_runtime.jsx)(CloudServer,{disabled:running,cloudServer:null==currentConfiguration?void 0:null===(ref1=currentConfiguration.run)||void 0===ref1?void 0:ref1.cloudServer,onOk:async cloudServer=>onCloudServer(simulation,cloudServer,{...swr,mutateSimulation})}),(0,jsx_runtime.jsx)(card.Z,{size:"small",title:"Run",children:(0,jsx_runtime.jsxs)(space.Z,{direction:"vertical",className:"full-width",size:20,children:[(0,jsx_runtime.jsxs)("div",{className:"full-width",style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,jsx_runtime.jsxs)(space.Z,{children:[(0,jsx_runtime.jsx)(es_button.Z,{disabled:disabled,type:"primary",icon:(0,jsx_runtime.jsx)(RocketOutlined.Z,{}),loading:running,async onClick(){setRunning(!0);try{await onRun(simulation)}catch(err){setRunning(!1)}},children:"Run"}),(0,jsx_runtime.jsx)(es_button.Z,{disabled:!running,danger:!0,icon:(0,jsx_runtime.jsx)(StopOutlined.Z,{}),shape:"circle",async onClick(){try{await onStop(simulation),setRunning(!1)}catch(err){}}})]}),(0,jsx_runtime.jsx)(Log,{simulation:{id:simulation.id},steps:steps})]}),(0,jsx_runtime.jsx)(es_steps.Z,{direction:"vertical",children:steps.map((step,index)=>(0,jsx_runtime.jsx)(es_steps.Z.Step,{title:step.label,description:"("+(index+1)+"/"+steps.length+")",status:step.status},step.label))})]})}),(0,jsx_runtime.jsx)(Results,{simulation:currentSimulation&&{id:currentSimulation.id,scheme:currentSimulation.scheme,tasks:currentSimulation.tasks},result:result&&{name:result.name,fileName:result.fileName},setResult:setResult})]})})}):(0,jsx_runtime.jsx)(layout.Z,{children:(0,jsx_runtime.jsx)(layout.Z.Content,{children:(0,jsx_runtime.jsx)(card.Z,{size:"small",children:(0,jsx_runtime.jsx)(spin.Z,{})})})})};var RadarChartOutlined=__webpack_require__(1402),postprocessing_0=[{key:"warpByVector",label:"Warp by vector",parameters:[{key:"Vectors",label:"Vectors",rules:[{required:!0,message:"Vectors is required"}]},{key:"ScaleFactor",label:"Scale factor",default:"1",rules:[{required:!0,message:"Scale factor is required"}]}]},{key:"contour",label:"Contour",parameters:[{key:"ContourBy",label:"Contour by",rules:[{required:!0,message:"ContourBy by is required"}]},{key:"isosurface",label:"Isosurface",default:"0",rules:[{required:!0,message:"Isosurface is required"}]}]},{key:"streamTracer",label:"Stream tracer",parameters:[{key:"Vectors",label:"Vectors",rules:[{required:!0,message:"Vectors is required"}]}]}];let run_run=async(simulation,result,filter,parameters)=>{let response=await (0,call.R)("/api/postprocessing",{method:"POST",headers:{Accept:"application/json"},body:JSON.stringify({simulation,result,filter,parameters})});return response.json()};var api_postprocessing={run:run_run};let postprocessing_errors={run:"Unable to run filter"},postprocessing_run=async(simulation,result,filter,parameters)=>{try{return await api_postprocessing.run(simulation,result,filter,parameters)}catch(err){(0,notification.lt)(postprocessing_errors.run,err)}},postprocessing_Postprocessing=param=>{let{simulation,result,postprocessing,setResult}=param,[visible,setVisible]=(0,react.useState)(),[filter,setFilter]=(0,react.useState)(),[loading,setLoading]=(0,react.useState)(),[results,setResults]=(0,react.useState)();if((0,react.useEffect)(()=>{!result&&visible&&setVisible(!1)},[result,visible]),(0,react.useEffect)(()=>{simulation||(setFilter(void 0),setResults(void 0))},[simulation,result]),!simulation||!result)return null;let postprocess=simulation.scheme.configuration.run.postprocessing;if(!postprocess)return null;let options=postprocessing_0.map(p=>{if(postprocess.find(pp=>pp.key===p.key))return{label:p.label,value:p.key}}).filter(p=>p);if(!options.length)return null;let parameters=null;if(filter){let post=postprocessing_0.find(pp=>pp.key===filter),defaultPost=postprocess.find(pp=>pp.key===filter);(null==post?void 0:post.parameters)&&(parameters=post.parameters.map((parameter,index)=>{var ref;let defaultParameter=null==defaultPost?void 0:null===(ref=defaultPost.parameters)||void 0===ref?void 0:ref.find(param=>param.key===parameter.key);return(null==defaultParameter?void 0:defaultParameter.value)?(0,jsx_runtime.jsx)(es_form.Z.Item,{label:parameter.label,name:["parameters",index],initialValue:defaultParameter.value,rules:parameter.rules,children:(0,jsx_runtime.jsx)(input.Z,{disabled:!0})},parameter.key):(null==defaultParameter?void 0:defaultParameter.options)?(0,jsx_runtime.jsx)(es_form.Z.Item,{label:parameter.label,name:["parameters",index],rules:parameter.rules,children:(0,jsx_runtime.jsx)(es_select.Z,{options:defaultParameter.options.map(option=>({label:option,value:option}))})},parameter.key):(0,jsx_runtime.jsx)(es_form.Z.Item,{label:parameter.label,name:["parameters",index],rules:parameter.rules,initialValue:parameter.default,children:(0,jsx_runtime.jsx)(input.Z,{})},parameter.key)}))}return(0,jsx_runtime.jsx)(layout.Z,{style:{position:"absolute",zIndex:101,right:25,bottom:50,backgroundColor:"rgba(255, 255, 255, 0)"},children:(0,jsx_runtime.jsxs)(layout.Z.Content,{children:[(0,jsx_runtime.jsx)(tooltip.Z,{title:"Post-processing",children:(0,jsx_runtime.jsx)(es_button.Z,{type:"primary",icon:(0,jsx_runtime.jsx)(RadarChartOutlined.Z,{}),onClick:()=>setVisible(!0),style:{width:40,height:40,border:"1px solid #5E14FA",borderRadius:20,marginBottom:-20}})}),(0,jsx_runtime.jsxs)(drawer.Z,{title:"Post-processing",closable:!0,onClose:()=>setVisible(!1),open:visible,mask:!1,maskClosable:!1,children:[(0,jsx_runtime.jsx)(es_form.Z,{style:{margin:"24px 0"},children:(0,jsx_runtime.jsx)(es_form.Z.Item,{name:"filter",label:"Filter",children:(0,jsx_runtime.jsx)(es_select.Z,{placeholder:"Select a filter",options:options,onChange:setFilter})})}),(0,jsx_runtime.jsxs)(es_form.Z,{layout:"vertical",style:{margin:"24px 0"},async onFinish(values){setLoading(!0);try{let newResults=await postprocessing_run({id:simulation.id},result,filter,values.parameters||[]);setResults(newResults)}catch(err){}setLoading(!1)},children:[parameters,(0,jsx_runtime.jsx)(es_form.Z.Item,{children:(0,jsx_runtime.jsx)(es_button.Z,{type:"primary",loading:loading,htmlType:"submit",icon:(0,jsx_runtime.jsx)(RocketOutlined.Z,{}),children:"Run"})})]}),results&&(0,jsx_runtime.jsx)(card.Z,{size:"small",title:"Post-processing",extra:filter,children:(0,jsx_runtime.jsx)(space.Z,{direction:"vertical",className:"full-width",children:results.length?results.map(res=>(0,jsx_runtime.jsxs)(space.Z,{children:[(0,jsx_runtime.jsx)(es_button.Z,{icon:(null==postprocessing?void 0:postprocessing.fileName)===res.fileName&&(null==postprocessing?void 0:postprocessing.name)===res.name?(0,jsx_runtime.jsx)(EyeOutlined.Z,{style:{color:"#fad114"}}):(0,jsx_runtime.jsx)(EyeInvisibleOutlined.Z,{}),onClick:()=>setResult((null==postprocessing?void 0:postprocessing.fileName)===res.fileName&&(null==postprocessing?void 0:postprocessing.name)===res.name?void 0:{type:"postprocessing",...res})}),(0,jsx_runtime.jsx)(Download,{simulation:{id:simulation.id},file:{name:res.name,fileName:res.fileName,originPath:res.originPath}}),res.name]},res.glb)):"No results"})})]})]})})},simulation_errors={plugins:"Unable to load plugins",update:"Unable to update simulation"},pluginsList=(user,setModels)=>{api_plugins.Z.list().then(plugins=>{let allModels=loadModels(user,models.Z,plugins);setModels(allModels)}).catch(err=>{(0,notification.lt)(simulation_errors.plugins,err)})},loadModels=(user,models,plugins)=>{let allModels=models;return plugins.forEach(plugin=>{var ref;(null==user?void 0:null===(ref=user.authorizedplugins)||void 0===ref?void 0:ref.includes(plugin.key))&&"Model"===plugin.category&&(allModels=[...allModels,...plugin.models])}),allModels},simulation_Selector=param=>{let{visible,user,onOk,onCancel}=param,[current,setCurrent]=(0,react.useState)(),[loading,setLoading]=(0,react.useState)(!1),[models,setModels]=(0,react.useState)([]),[categories,setCategories]=(0,react.useState)(),[category,setCategory]=(0,react.useState)();(0,react.useEffect)(()=>{user&&pluginsList(user,setModels)},[user]),(0,react.useEffect)(()=>{let newCategories=models.map(m=>m.category).filter((value,index,self1)=>self1.indexOf(value)===index).map(c=>({key:c,value:c}));setCategories(newCategories)},[models]);let onTanatlocSelect=(0,react.useCallback)(param=>{let{key}=param,model=models.find(m=>m.algorithm===key);setCurrent(utils.Z.deepCopy(model))},[models]),onUserSelect=(0,react.useCallback)(param=>{let{key}=param,model=user.models.find(m=>m.algorithm===key);setCurrent(utils.Z.deepCopy(model))},[user]),tanatlocMenuItems=[{key:"category",disabled:!0,label:(0,jsx_runtime.jsx)(es_select.Z,{className:"full-width",options:categories,allowClear:!0,showArrow:!1,placeholder:"Category filter",onChange:value=>setCategory(value)})}];models.forEach(model=>{category&&model.category!==category||tanatlocMenuItems.push({key:model.algorithm,label:model.name})});let userMenuItems=[{key:"category",disabled:!0,label:(0,jsx_runtime.jsx)(es_select.Z,{className:"full-width",options:categories,allowClear:!0,showArrow:!1,placeholder:"Category filter",onChange:value=>setCategory(value)})}];return user&&user.models.forEach(model=>{category&&model.category!==category||userMenuItems.push({key:model.algorithm,label:model.name})}),(0,jsx_runtime.jsx)(modal.Z,{open:visible,title:"Create simulation",okText:"Create",okButtonProps:{loading:loading},async onOk(){if(setLoading(!0),current)try{await onOk(current)}catch(err){}setLoading(!1)},onCancel:()=>onCancel(),width:"80%",children:(0,jsx_runtime.jsxs)(layout.Z,{children:[(0,jsx_runtime.jsx)(layout.Z.Sider,{theme:"light",width:300,children:(0,jsx_runtime.jsx)(tabs.Z,{items:[{key:"tanatloc",label:"Tanatloc algorithm",children:(0,jsx_runtime.jsx)(menu.Z,{mode:"inline",items:tanatlocMenuItems,onSelect:onTanatlocSelect})},{key:"personal",label:"User algorithm",children:(0,jsx_runtime.jsx)(menu.Z,{mode:"inline",items:userMenuItems,onSelect:onUserSelect})}]})}),(0,jsx_runtime.jsx)(layout.Z.Content,{className:"simulation-selector",children:(0,jsx_runtime.jsx)(mathjax.Z.Html,{html:null==current?void 0:current.description})})]})})},onUpdate=async(simulation,models,swr)=>{try{let currentModel=models.find(m=>{var ref;return m.algorithm===(null==simulation?void 0:null===(ref=simulation.scheme)||void 0===ref?void 0:ref.algorithm)}),newSimulation=utils.Z.deepCopy(simulation);(0,lodash.merge)(newSimulation.scheme,currentModel),await api_simulation.Z.update({id:simulation.id},[{key:"scheme",value:newSimulation.scheme}]),swr.mutateOneSimulation(newSimulation)}catch(err){(0,notification.lt)(simulation_errors.update,err)}},Updater=param=>{let{user,simulation,swr}=param,[models,setModels]=(0,react.useState)([]);return(0,react.useEffect)(()=>{user&&pluginsList(user,setModels)},[user]),(0,react.useEffect)(()=>{let currentModel=models.find(m=>{var ref;return m.algorithm===(null==simulation?void 0:null===(ref=simulation.scheme)||void 0===ref?void 0:ref.algorithm)});if(currentModel&&(null==simulation?void 0:simulation.scheme)){let added=(0,mjs_added.Z)(simulation.scheme,currentModel),updated=(0,mjs_updated.Z)(simulation.scheme,currentModel);(Object.keys(added).length||Object.keys(updated).length)&&(modal.Z.info({title:"Update",content:"Your model need an update, please wait.",closable:!1,okButtonProps:{hidden:!0}}),onUpdate(simulation,models,swr).finally(()=>modal.Z.destroyAll()))}},[simulation,models,swr]),null};var project_simulation={Selector:simulation_Selector,Updater,About:About,Geometry:simulation_geometry_Geometry,Materials:Materials,Parameters:Parameters,Initialization:Initialization,BoundaryConditions:BoundaryConditions,Run:Run,Postprocessing:postprocessing_Postprocessing};let Data=dynamic_default()(()=>Promise.all([__webpack_require__.e(584),__webpack_require__.e(73),__webpack_require__.e(317)]).then(__webpack_require__.bind(__webpack_require__,7317)),{loadableGenerated:{webpack:()=>[7317]},ssr:!1}),menuItems={dashboard:{key:"dashboard"},geometries:{label:"GEOMETRIES",key:"geometries"},simulations:{label:"SIMULATIONS",key:"simulations"}},project_errors={user:"Unable to get user",project:"Unable to get project",simulations:"Unable to get simulations",geometries:"Unable to get geometries",add:"Unable to add simulation"},handleDashboard=(router,page,workspaceId)=>{router.push({pathname:"/dashboard",query:{page,workspaceId}})},onSelector=async(project,scheme,swr)=>{try{let simulation=await api_simulation.Z.add({id:project.id},{name:scheme.name,scheme});swr.addOneSimulation(simulation),swr.mutateProject({id:project.id,simulations:[...project.simulations||[],simulation.id]})}catch(err){throw(0,notification.lt)(project_errors.add,err),err}},Project=()=>{let router=(0,next_router.useRouter)(),{page,workspaceId,projectId}=router.query,[geometryAddVisible,setGeometryAddVisible]=(0,react.useState)(!1),[geometry,setGeometry]=(0,react.useState)(),[simulationSelectorVisible,setSimulationSelectorVisible]=(0,react.useState)(!1),[simulation,setSimulation]=(0,react.useState)(),[result,setResult]=(0,react.useState)(),[postprocessing,setPostprocessing]=(0,react.useState)(),[menuKey,setMenuKey]=(0,react.useState)(),[panel,setPanel]=(0,react.useState)(),[panelVisible,setPanelVisible]=(0,react.useState)(!0),[user,{errorUser,loadingUser}]=api_user.Z.useUser(),[project,{mutateProject,errorProject,loadingProject}]=api_project.Z.useProject(projectId),[simulations,{addOneSimulation,delOneSimulation,mutateOneSimulation,errorSimulations,loadingSimulations}]=api_simulation.Z.useSimulations(null==project?void 0:project.simulations),[geometries,{addOneGeometry,delOneGeometry,mutateOneGeometry,errorGeometries,loadingGeometries}]=api_geometry.useGeometries(null==project?void 0:project.geometries),onPanelClose=(0,react.useCallback)(()=>{setPanel(void 0),setMenuKey(void 0)},[]);(0,react.useEffect)(()=>{loadingUser||user||router.replace("/login")},[user,loadingUser,router]),(0,react.useEffect)(()=>{errorUser&&(0,notification.lt)(project_errors.user,errorUser),errorProject&&(0,notification.lt)(project_errors.project,errorProject),errorSimulations&&(0,notification.lt)(project_errors.simulations,errorSimulations),errorGeometries&&(0,notification.lt)(project_errors.geometries,errorGeometries)},[errorUser,errorProject,errorSimulations,errorGeometries]),(0,react.useEffect)(()=>{loadingProject||loadingGeometries?setGeometryAddVisible(!1):geometries.length?setGeometryAddVisible(!1):setGeometryAddVisible(!0)},[loadingProject,loadingGeometries,geometries]),(0,react.useEffect)(()=>{if(!loadingGeometries&&geometry){let current=geometries.find(g=>g.id===(null==geometry?void 0:geometry.id));current?JSON.stringify(current)!==JSON.stringify(geometry)&&setGeometry(current):setGeometry(void 0)}else setGeometry(geometries[0])},[geometries,geometry,loadingGeometries,setGeometry]),(0,react.useEffect)(()=>{if(!loadingSimulations&&simulation){let current=simulations.find(s=>s.id===(null==simulation?void 0:simulation.id));current?JSON.stringify(current)!==JSON.stringify(simulation)&&setSimulation(current):(onPanelClose(),setSimulation(void 0))}},[simulations,simulation,loadingSimulations,setSimulation,onPanelClose]);let onGeometryCleanup=(0,react.useCallback)(()=>{setGeometry({id:"0",needCleanup:!0})},[]),setGeometryPanel=(0,react.useCallback)(id=>{let current=geometries.find(g=>g.id===id);current&&(setGeometry(current),setPanel((0,jsx_runtime.jsx)(Panel,{visible:!0,title:"Geometry",onClose:onPanelClose,children:(0,jsx_runtime.jsx)(geometry_Geometry,{project:{id:project.id,geometries:project.geometries},geometry:{id:current.id,name:current.name,summary:current.summary},swr:{mutateProject,mutateOneGeometry,delOneGeometry},close:onPanelClose,onCleanup:onGeometryCleanup})})))},[project,geometries,mutateProject,mutateOneGeometry,delOneGeometry,onGeometryCleanup,onPanelClose]),setSimulationPanelAbout=(0,react.useCallback)(current=>{setPanel((0,jsx_runtime.jsx)(Panel,{visible:!0,title:"About",onClose:onPanelClose,children:(0,jsx_runtime.jsx)(project_simulation.About,{project:{id:project.id,simulations:project.simulations},simulation:{id:current.id,name:current.name,scheme:current.scheme},swr:{mutateProject,addOneSimulation,delOneSimulation,mutateOneSimulation}})}))},[project,mutateProject,addOneSimulation,delOneSimulation,mutateOneSimulation,onPanelClose]),setSimulationPanelGeometry=(0,react.useCallback)(current=>{setPanel((0,jsx_runtime.jsx)(Panel,{visible:!0,title:"Geometry",onClose:onPanelClose,children:(0,jsx_runtime.jsx)(project_simulation.Geometry,{geometries:geometries,geometry:geometry&&{id:geometry.id,summary:geometry.summary},simulation:{id:current.id,scheme:current.scheme},setGeometry:setGeometry,swr:{mutateOneSimulation}})}))},[geometries,geometry,mutateOneSimulation,onPanelClose]),setSimulationPanelParameters=(0,react.useCallback)(current=>{setPanel((0,jsx_runtime.jsx)(Panel,{visible:!0,title:"Parameters",onClose:onPanelClose,children:(0,jsx_runtime.jsx)(project_simulation.Parameters,{simulation:{id:current.id,scheme:current.scheme},swr:{mutateOneSimulation}})}))},[mutateOneSimulation,onPanelClose]),setSimulationPanelMaterials=(0,react.useCallback)(current=>{setPanel((0,jsx_runtime.jsx)(Panel,{visible:panelVisible,title:"Materials",onClose:onPanelClose,children:(0,jsx_runtime.jsx)(project_simulation.Materials,{geometry:geometry&&{id:geometry.id,summary:geometry.summary},simulation:{id:current.id,scheme:current.scheme},swr:{mutateOneSimulation},setVisible:visible=>setPanelVisible(visible)})}))},[geometry,panelVisible,mutateOneSimulation,onPanelClose]),setSimulationPanelInitialization=(0,react.useCallback)(current=>{setPanel((0,jsx_runtime.jsx)(Panel,{visible:!0,title:"Initialization",onClose:onPanelClose,children:(0,jsx_runtime.jsx)(project_simulation.Initialization,{simulations:simulations,simulation:current,swr:{mutateOneSimulation}})}))},[simulations,mutateOneSimulation,onPanelClose]),setSimulationPanelBoundaryConditions=(0,react.useCallback)(current=>{setPanel((0,jsx_runtime.jsx)(Panel,{visible:panelVisible,title:"Boundary conditions",onClose:onPanelClose,children:(0,jsx_runtime.jsx)(project_simulation.BoundaryConditions,{geometry:geometry&&{id:geometry.id,summary:geometry.summary},simulation:{id:current.id,scheme:current.scheme},swr:{mutateOneSimulation},setVisible:visible=>setPanelVisible(visible)})}))},[geometry,panelVisible,mutateOneSimulation,onPanelClose]),setSimulationPanelRun=(0,react.useCallback)(current=>{setPanel((0,jsx_runtime.jsx)(Panel,{visible:panelVisible,title:"Run",onClose:onPanelClose,children:(0,jsx_runtime.jsx)(project_simulation.Run,{simulation:{id:current.id,scheme:current.scheme},result:result&&{name:result.name,fileName:result.fileName},setResult:setResult,setPostprocessing:setPostprocessing,setVisible:visible=>setPanelVisible(visible),swr:{mutateOneSimulation}})}))},[result,panelVisible,mutateOneSimulation,onPanelClose]),setSimulationPanel=(0,react.useCallback)((id,item)=>{var ref,ref1,ref2;let current=simulations.find(s=>s.id===id);if(!current)return;setSimulation(current);let geometryId=null===(ref=current.scheme)||void 0===ref?void 0:null===(ref1=ref.configuration)||void 0===ref1?void 0:null===(ref2=ref1.geometry)||void 0===ref2?void 0:ref2.value;if(geometryId&&(null==geometry?void 0:geometry.id)!==geometryId){let currentGeometry=geometries.find(g=>g.id===geometryId);currentGeometry&&setGeometry(currentGeometry)}switch(item){case"about":setSimulationPanelAbout(current);break;case"geometry":setSimulationPanelGeometry(current);break;case"parameters":setSimulationPanelParameters(current);break;case"materials":setSimulationPanelMaterials(current);break;case"initialization":setSimulationPanelInitialization(current);break;case"boundaryConditions":setSimulationPanelBoundaryConditions(current);break;case"run":setSimulationPanelRun(current);break;default:setPanel(void 0)}},[geometry,geometries,simulations,setSimulationPanelAbout,setSimulationPanelGeometry,setSimulationPanelParameters,setSimulationPanelMaterials,setSimulationPanelInitialization,setSimulationPanelBoundaryConditions,setSimulationPanelRun]);(0,react.useEffect)(()=>{menuKey&&(menuKey.key===menuItems.geometries.key?setGeometryPanel(menuKey.id):(setSimulationPanel(menuKey.id,menuKey.item),"run"!==menuKey.item&&(setResult(void 0),setPostprocessing(void 0))))},[menuKey,setGeometryPanel,setSimulationPanel,onPanelClose]),(0,react.useEffect)(()=>{!result&&postprocessing&&setPostprocessing(void 0)},[result,postprocessing]);let onMenuClick=(0,react.useCallback)(param=>{let item,{keyPath}=param,key=keyPath.pop(),subKey=keyPath.pop(),subSubKey=keyPath.pop();subSubKey&&(item=subSubKey.split("&").pop()),setMenuKey({key,id:subKey,item})},[]),geometriesRender=geometries.map(g=>({key:g.id,icon:(0,jsx_runtime.jsx)(PieChartOutlined.Z,{}),label:g.name})),simulationsRender=simulations.map(s=>{let configuration=s.scheme.configuration||{},categories=[];Object.keys(configuration).forEach(key=>{if("dimension"===key)return;let child=configuration[key],icon=(0,jsx_runtime.jsx)(CheckCircleOutlined.Z,{style:{color:"green"}});child.error&&(icon=(0,jsx_runtime.jsx)(CloseCircleOutlined.Z,{style:{color:"red"}})),child.done||(icon=(0,jsx_runtime.jsx)(ExclamationCircleOutlined.Z,{style:{color:"orange"}})),"geometry"!==key||geometries.filter(g=>g.id===child.value).length||loadingGeometries||(icon=(0,jsx_runtime.jsx)(ExclamationCircleOutlined.Z,{style:{color:"orange"}}),child.done=null),categories[child.index]={key:s.id+"&"+key,className:"Project-Menu-SubMenu-Simulations-SubMenu-MenuItem",disabled:!geometries.length,icon:icon,label:child.title}});let label=s.name;return s.scheme.user&&(label=(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(tooltip.Z,{title:"User algorithm",placement:"right",children:(0,jsx_runtime.jsx)(AuditOutlined.Z,{style:{position:"absolute",top:0,left:14,fontSize:14,color:"#fad114"}})}),s.name]})),{key:s.id,className:"Project-Menu-SubMenu-Simulations-SubMenu",icon:(0,jsx_runtime.jsx)(CodeSandboxOutlined.Z,{}),label:label,children:[{key:s.id+"&about",className:"Project-Menu-SubMenu-Simulations-SubMenu-MenuItem",disabled:!geometries.length,icon:(0,jsx_runtime.jsx)(CheckCircleOutlined.Z,{style:{color:"green"}}),label:"About"},...categories]}});return!user||loadingUser||loadingProject?(0,jsx_runtime.jsx)(loading.Z.Simple,{}):"0"===project.id?(0,jsx_runtime.jsx)(NotAuthorized,{}):(0,jsx_runtime.jsx)(SelectProvider,{children:(0,jsx_runtime.jsxs)(layout.Z,{hasSider:!0,children:[(0,jsx_runtime.jsxs)(layout.Z.Sider,{theme:"light",className:"Project-Sider",width:256,children:[(0,jsx_runtime.jsx)("div",{className:"logo",children:(0,jsx_runtime.jsx)("img",{src:"/images/logo.svg",alt:"Tanatloc"})}),(0,jsx_runtime.jsx)(menu.Z,{mode:"inline",items:[{key:"menu-go-back",disabled:!0,className:"Project-Menu-GoBack",style:{cursor:"unset",margin:"10px 0",paddingLeft:10},label:(0,jsx_runtime.jsx)(assets_button.ks,{onClick:()=>handleDashboard(router,page,workspaceId),children:"Return to dashboard"})},{type:"divider",className:"Project-Menu-Divider"},{key:"title",disabled:!0,className:"Project-Menu-Title",label:(0,jsx_runtime.jsx)(typography.Z.Paragraph,{ellipsis:{tooltip:!0,rows:1},children:project.title})}]}),(0,jsx_runtime.jsx)("div",{className:"Project-Menu-scroll",children:(0,jsx_runtime.jsx)(menu.Z,{className:"Project-Menu",mode:"inline",defaultOpenKeys:[menuItems.geometries.key,menuItems.simulations.key],items:[{key:menuItems.geometries.key,className:"Project-Menu-SubMenu-Geometries",icon:loadingGeometries?(0,jsx_runtime.jsx)(LoadingOutlined.Z,{}):(0,jsx_runtime.jsx)(PieChartOutlined.Z,{}),label:(0,jsx_runtime.jsxs)(typography.Z.Text,{strong:!0,children:[menuItems.geometries.label," (",geometries.length,")"]}),children:[{key:"new_geometry",className:"Project-Menu-SubMenu-Geometries-New",disabled:!0,label:(0,jsx_runtime.jsx)(es_button.Z,{icon:(0,jsx_runtime.jsx)(UploadOutlined.Z,{}),onClick:()=>setGeometryAddVisible(!0),children:"New Geometry"})},{key:"geometry-needed",className:"text-dark "+(geometries.length?"display-none":""),disabled:!0,icon:(0,jsx_runtime.jsx)(ExclamationCircleOutlined.Z,{style:{color:"red"}}),label:"A Geometry is needed"},...geometriesRender]},{key:menuItems.simulations.key,className:"Project-Menu-SubMenu-Simulations",icon:loadingSimulations?(0,jsx_runtime.jsx)(LoadingOutlined.Z,{}):(0,jsx_runtime.jsx)(CodeSandboxOutlined.Z,{}),label:(0,jsx_runtime.jsxs)(typography.Z.Text,{strong:!0,children:[menuItems.simulations.label," (",simulations.length,")"]}),children:[{key:"new_simulation",className:"Project-Menu-SubMenu-Simulations-New",disabled:!0,label:(0,jsx_runtime.jsx)(es_button.Z,{disabled:!geometries.length,icon:(0,jsx_runtime.jsx)(PlusCircleOutlined.Z,{}),onClick:()=>setSimulationSelectorVisible(!0),children:"New Simulation"})},...simulationsRender]}],onClick:onMenuClick})})]}),(0,jsx_runtime.jsxs)(layout.Z.Content,{className:"no-scroll relative",children:[(0,jsx_runtime.jsx)(geometry_Geometry.Add,{visible:geometryAddVisible,project:{id:project.id,geometries:project.geometries},swr:{mutateProject,addOneGeometry},setVisible:visible=>setGeometryAddVisible(visible)}),(0,jsx_runtime.jsx)(project_simulation.Selector,{user:{authorizedplugins:user.authorizedplugins,models:user.models},visible:simulationSelectorVisible,async onOk(scheme){try{await onSelector(project,scheme,{addOneSimulation,mutateProject}),setSimulationSelectorVisible(!1)}catch(err){}},onCancel:()=>setSimulationSelectorVisible(!1)}),(0,jsx_runtime.jsx)(project_simulation.Updater,{user:{authorizedplugins:user.authorizedplugins},simulation:simulation&&{id:simulation.id,scheme:simulation.scheme},swr:{mutateOneSimulation}}),panel,(0,jsx_runtime.jsx)(View,{project:{id:project.id,title:project.title},simulation:simulation&&{id:simulation.id},geometry:geometry&&{id:geometry.id,needCleanup:geometry.needCleanup},result:result&&{glb:result.glb,originPath:result.originPath},postprocessing:postprocessing&&{glb:postprocessing.glb,originPath:postprocessing.originPath}}),(0,jsx_runtime.jsx)(Data,{simulation:simulation&&{id:simulation.id,name:simulation.name}}),(0,jsx_runtime.jsx)(project_simulation.Postprocessing,{simulation:simulation&&{id:simulation.id,scheme:simulation.scheme},result:result&&{name:result.name,fileName:result.fileName,originPath:result.originPath},postprocessing:postprocessing&&{name:postprocessing.name,fileName:postprocessing.fileName},setResult:setPostprocessing})]})]})})};var project=Project},64546:function(module,__unused_webpack_exports,__webpack_require__){var map={"./local/src/components":[94295,295]};function webpackAsyncContext(req){if(!__webpack_require__.o(map,req))return Promise.resolve().then(function(){var e=Error("Cannot find module '"+req+"'");throw e.code="MODULE_NOT_FOUND",e});var ids=map[req],id=ids[0];return __webpack_require__.e(ids[1]).then(function(){return __webpack_require__(id)})}webpackAsyncContext.keys=function(){return Object.keys(map)},webpackAsyncContext.id=64546,module.exports=webpackAsyncContext}}]);