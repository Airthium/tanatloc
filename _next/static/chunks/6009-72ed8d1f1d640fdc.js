(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6009],{72735:function(e,t,l){"use strict";l.d(t,{Z:function(){return n}});var i=l(83755);let a=async(e,t)=>{let l=await (0,i.R)("/api/avatar",{method:"POST",headers:{Accept:"application/json"},body:JSON.stringify({file:e,project:t})});return l.json()};var n={add:a}},33997:function(e,t,l){"use strict";l.d(t,{Z:function(){return d}});var i=l(83755);let a=async e=>{await (0,i.R)("/api/plugin",{method:"POST",body:JSON.stringify(e)})},n=async e=>{await (0,i.R)("/api/plugin",{method:"PUT",body:JSON.stringify(e)})},s=async e=>{await (0,i.R)("/api/plugin",{method:"DELETE",body:JSON.stringify(e)})};var r=l(59734),o=l(67294);let u=()=>{let{data:e,error:t,mutate:l}=(0,r.ZP)("/api/plugin",i._),a=(null==e?void 0:e.plugins)||[],n=(0,o.useCallback)(e=>{let t=[...a,e];l({plugins:t})},[a,l]),s=(0,o.useCallback)(e=>{let t=a.filter(t=>t.key!==e.key);l({plugins:t})},[a,l]),u=(0,o.useCallback)(e=>{let t=a.map(t=>(t.key===e.key&&(t={...t,...e}),t));l({plugins:t})},[a,l]);return[a,{mutatePlugins:l,addOnePlugin:n,delOnePlugin:s,mutateOnePlugin:u,errorPlugins:t,loadingPlugins:!e}]};var d={add:a,update:n,del:s,usePlugins:u}},55276:function(e,t,l){"use strict";l.d(t,{Z:function(){return s}});var i=l(83755);let a=async()=>{let e=await (0,i.R)("/api/plugins",{method:"GET",headers:{Accept:"application/json"}});return e.json()},n=async()=>{let e=await (0,i.R)("/api/plugins",{method:"POST",headers:{Accept:"application/json"}});return e.json()};var s={list:a,completeList:n}},55369:function(e,t,l){"use strict";l.d(t,{Z:function(){return y}});var i=l(59734),a=l(67294),n=l(83755);let s=e=>{let{data:t,error:l,mutate:s}=(0,i.ZP)(["/api/projects",JSON.stringify({ids:e})],e=>{let[t,l]=e;return(0,n._)(t,l)}),r=(null==t?void 0:t.projects)||[],o=(0,a.useCallback)(e=>{let t=[...r,{...e,users:[],geometries:[],simulations:[],groups:[]}];s({projects:t})},[r,s]),u=(0,a.useCallback)(e=>{let t=r.filter(t=>t.id!==e.id);s({projects:t})},[r,s]),d=(0,a.useCallback)(e=>{let t=r.map(t=>(t.id===e.id&&(t={...t,...e}),t));s({projects:t})},[r,s]);return[r,{addOneProject:o,delOneProject:u,mutateOneProject:d,errorProjects:l,loadingProjects:!t}]},r=e=>{let{data:t,error:l,mutate:s}=(0,i.ZP)("/api/project"+(e?"/"+e:""),n._),r=(null==t?void 0:t.project)||{id:"0"},o=(0,a.useCallback)(e=>{let t={...r,...e};s({project:t})},[r,s]);return[r,{mutateProject:o,errorProject:l,loadingProject:!t}]},o=async(e,t)=>{let l=await (0,n.R)("/api/project",{method:"POST",headers:{Accept:"application/json"},body:JSON.stringify({workspace:{id:e.id},project:t})});return l.json()},u=async(e,t)=>{await (0,n.R)("/api/project/"+e.id,{method:"PUT",body:JSON.stringify(t)})},d=async(e,t)=>{await (0,n.R)("/api/project/"+t.id,{method:"DELETE",body:JSON.stringify({id:e.id})})},c=async e=>(0,n.R)("/api/project/"+e.id+"/archive",{method:"GET",headers:{Accept:"application/json"}}),m=async e=>(0,n.R)("/api/project/"+e.id+"/archive",{method:"PUT"}),h=async e=>(0,n.R)("/api/project/"+e.id+"/archive",{method:"DELETE"}),p=async(e,t)=>(0,n.R)("/api/project/"+e.id+"/archive",{method:"POST",body:JSON.stringify({archive:t})});var y={useProjects:s,useProject:r,add:o,update:u,del:d,archive:c,unarchiveFromServer:m,deleteArchiveFile:h,unarchiveFromFile:p}},35636:function(e,t,l){"use strict";l.d(t,{Z:function(){return y}});var i=l(59734),a=l(67294),n=l(83755);let s=e=>{let{data:t,error:l,mutate:s}=(0,i.ZP)(["/api/simulations",JSON.stringify({ids:e})],e=>{let[t,l]=e;return(0,n._)(t,l)}),r=(null==t?void 0:t.simulations)||[],o=(0,a.useCallback)(e=>{let t=[...r,e];s({simulations:t})},[r,s]),u=(0,a.useCallback)(e=>{let t=r.filter(t=>t.id!==e.id);s({simulations:t})},[r,s]),d=(0,a.useCallback)((e,t)=>{let l=r.map(t=>(t.id===e.id&&(t={...t,...e}),t));s({simulations:l},t)},[r,s]);return[r,{addOneSimulation:o,delOneSimulation:u,mutateOneSimulation:d,errorSimulations:l,loadingSimulations:!t}]},r=(e,t)=>{let{data:l,error:s,mutate:r}=(0,i.ZP)("/api/simulation"+(e?"/"+e:""),n._,{refreshInterval:t||0}),o=(null==l?void 0:l.simulation)||{id:"0"},u=(0,a.useCallback)(e=>{r({simulation:{...o,...e}})},[o,r]);return[o,{mutateSimulation:u,errorSimulation:s,loadingSimulation:!l}]},o=async(e,t)=>{let l=await (0,n.R)("/api/simulation",{method:"POST",headers:{Accept:"application/json"},body:JSON.stringify({project:{id:e.id},simulation:t})});return l.json()},u=async(e,t)=>{await (0,n.R)("/api/simulation/"+e.id,{method:"PUT",body:JSON.stringify(t)})},d=async e=>{await (0,n.R)("/api/simulation/"+e.id,{method:"DELETE"})},c=async e=>{await (0,n.R)("/api/simulation/"+e.id+"/run",{method:"GET"})},m=async e=>{await (0,n.R)("/api/simulation/"+e.id+"/stop",{method:"GET"})},h=async e=>{let t=await (0,n.R)("/api/simulation/"+e.id+"/tasks",{method:"GET",headers:{Accept:"application/json"}});return t.json()},p=async(e,t)=>{let l=await (0,n.R)("/api/simulation/"+e.id+"/log",{method:"POST",body:JSON.stringify({file:t})});return l.json()};var y={useSimulations:s,useSimulation:r,add:o,update:u,del:d,run:c,stop:m,tasks:h,log:p}},56009:function(e,t,l){"use strict";let i;l.d(t,{ZP:function(){return av}});var a,n,s,r=l(85893),o=l(5152),u=l.n(o),d=l(11163),c=l(67294),m=l(83062),h=l(97183),p=l(68508),y=l(22850),x=l(71577),v=l(99611),g=l(90420),f=l(73480),b=l(48869),j=l(8751),w=l(18429),Z=l(11475),C=l(22844),k=l(50888),S=l(88484),P=l(64789),E=l(26231),M=l(94725),N=l(85813),O=l(26713),T=l(20280);let A={notAllowed:"You are not allowed to be here."},L=()=>{let e=(0,d.useRouter)(),t=(0,c.useCallback)(()=>e.push("/"),[e]);return(0,r.jsx)(h.Z,{children:(0,r.jsx)(h.Z.Content,{children:(0,r.jsx)(N.Z,{title:"Not allowed",children:(0,r.jsxs)(O.Z,{direction:"vertical",children:[(0,r.jsxs)(y.Z.Text,{children:[(0,r.jsx)(T.Z,{style:{color:"red"}})," ",A.notAllowed]}),(0,r.jsxs)(y.Z.Text,{children:["Go back"," ",(0,r.jsx)(x.ZP,{type:"link",onClick:t,children:"home"})]})]})})})})};var z=l(51302),R=l(9242);let I={enabled:!1,type:void 0,part:void 0,highlighted:void 0,selected:[],point:void 0,dispatch:()=>void 0},_={ENABLE:"ENABLE",DISABLE:"DISABLE",CLEAR:"CLEAR",SETTYPE:"SETTYPE",SETPART:"SETPART",HIGHLIGHT:"HIGHLIGHT",UNHIGHLIGHT:"UNHIGHLIGHT",SELECT:"SELECT",UNSELECT:"UNSELECT",SETPOINT:"SETPOINT"},F=(0,c.createContext)(I),D=(e,t)=>{let l;switch(t.type){case _.ENABLE:return{...e,enabled:!0};case _.DISABLE:return{...e,enabled:!1,highlighted:void 0,selected:[],point:void 0};case _.CLEAR:return{...I};case _.SETTYPE:return{...e,type:t.value};case _.SETPART:return{...e,part:t.value};case _.HIGHLIGHT:return{...e,highlighted:t.value};case _.UNHIGHLIGHT:return{...e,highlighted:void 0};case _.SELECT:if(-1===(l=e.selected.findIndex(e=>e.uuid===t.value.uuid)))return{...e,selected:[...e.selected,t.value]};return e;case _.UNSELECT:if(-1===(l=e.selected.findIndex(e=>e.uuid===t.value.uuid)))return e;return{...e,selected:[...e.selected.slice(0,l),...e.selected.slice(l+1)]};case _.SETPOINT:return{...e,point:t.value};default:return e}},U=e=>{let{children:t}=e,[l,i]=(0,c.useReducer)(D,I),a=(0,c.useMemo)(()=>({...l,dispatch:i}),[l]);return(0,r.jsx)(F.Provider,{value:a,children:t})};var V=l(42661),B=l(55369),W=l(35636),H=l(59734),G=l(83755);let Y=e=>{let{data:t,error:l,mutate:i}=(0,H.ZP)(["/api/geometries",JSON.stringify({ids:e})],e=>{let[t,l]=e;return(0,G._)(t,l)}),a=(null==t?void 0:t.geometries)||[],n=(0,c.useCallback)(e=>{let t=[...a,e];i({geometries:t})},[a,i]),s=(0,c.useCallback)(e=>{let t=a.filter(t=>t.id!==e.id);i({geometries:t})},[a,i]),r=(0,c.useCallback)(e=>{let t=a.map(t=>(t.id===e.id&&(t={...t,...e}),t));i({geometries:t})},[a,i]);return[a,{addOneGeometry:n,delOneGeometry:s,mutateOneGeometry:r,errorGeometries:l,loadingGeometries:!t}]},J=async(e,t)=>{let l=await (0,G.R)("/api/geometry",{method:"POST",body:JSON.stringify({project:e,geometry:t})});return l.json()},X=async(e,t)=>{await (0,G.R)("/api/geometry/"+e.id,{method:"PUT",body:JSON.stringify(t)})},q=async e=>{await (0,G.R)("/api/geometry/"+e.id,{method:"DELETE"})},K=async e=>{let t=await (0,G.R)("/api/geometry/"+e.id+"/download");return t.json()},$=async e=>{let t=await (0,G.R)("/api/geometry/"+e.id+"/part");return t.json()};var Q={useGeometries:Y,add:J,update:X,del:q,download:K,getPart:$},ee=l(97937),et=l(68847),el=l.n(et);let ei=e=>{let{visible:t,title:l,children:i,onClose:a}=e;return(0,r.jsx)(N.Z,{className:el().panel,style:{display:t?"block":"none"},title:l,extra:(0,r.jsx)(x.ZP,{type:"text",icon:(0,r.jsx)(ee.Z,{}),onClick:a}),children:i})};var ea=l(62585),en=l(31365),es=l(86373),er=l(14856),eo=l.n(er),eu=l(87819),ed=l.n(eu),ec=l(48764).lW;let em={add:"Unable to add geometry"},eh=e=>e.name.toLowerCase().includes(".stp")||e.name.toLowerCase().includes(".step")||e.name.toLowerCase().includes(".dxf"),ep=async e=>{let t=new FileReader;return new Promise(l=>{t.addEventListener("load",()=>{l(t.result)}),t.readAsArrayBuffer(e)})},ey=async(e,t,l)=>{if("uploading"===t.file.status)return!0;if("done"===t.file.status){let i=await ep(t.file.originFileObj);try{let a=await Q.add({id:e.id},{name:t.file.name,uid:t.file.uid,buffer:ec.from(i)});l.addOneGeometry(a),l.mutateProject({id:e.id,geometries:[...e.geometries,a.id]})}catch(e){throw(0,R.lt)(em.add,e),e}}return!1},ex=e=>{let{visible:t,project:l,swr:i,setVisible:a}=e,[n,s]=(0,c.useState)(!1),o=(0,c.useCallback)(()=>a(!1),[a]),u=(0,c.useCallback)(async e=>{try{let t=await ey(l,e,i);s(t),a(t)}catch(e){s(!1)}},[l,i,a]);return(0,r.jsx)(es.ZP,{title:"Upload geometry",visible:t,onCancel:o,cancelButtonProps:{loading:n},children:(0,r.jsxs)(O.Z,{direction:"vertical",className:eo().fullWidth,children:[(0,r.jsx)(en.Z,{className:ed().upload,action:"/api/noop",accept:".stp,.step,.dxf",showUploadList:!1,listType:"picture-card",beforeUpload:eh,onChange:u,children:(0,r.jsx)("div",{children:n?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(k.Z,{style:{fontSize:25}}),(0,r.jsxs)("div",{style:{marginTop:8},children:[(0,r.jsx)("b",{children:"Loading"}),", converting, ..."]})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(S.Z,{style:{fontSize:25}}),(0,r.jsxs)("div",{style:{marginTop:8},children:[(0,r.jsx)("b",{children:"Choose a file"})," or drop it here"]})]})})}),(0,r.jsx)(y.Z.Text,{children:(0,r.jsx)("p",{style:{color:"rgba(0, 0, 0, 0.45)",textAlign:"center"},children:"Native file format preferred: STEP (3D) or DXF (2D) file"})})]})})};var ev=l(96108),eg=l(69677);let ef=e=>{let{visible:t,geometry:l,setVisible:i,onEdit:a}=e,n=(0,c.useRef)(null),[s,o]=(0,c.useState)(!1);(0,c.useEffect)(()=>{n.current&&n.current.focus()});let u=(0,c.useCallback)(()=>i(!1),[i]),d=(0,c.useCallback)(async e=>{o(!0);try{await a(e),o(!1),i(!1)}catch(e){throw o(!1),e}},[i,a]);return(0,r.jsx)(es.ZP,{title:"Edit the geometry's name",visible:t,initialValues:{name:l.name},onCancel:u,onOk:d,loading:s,children:(0,r.jsx)(ev.Z.Item,{name:"name",label:"Name:",rules:[{required:!0,message:"Name is required"}],children:(0,r.jsx)(eg.Z,{ref:n})})})};var eb=l(48764).lW;let ej={download:"Unable to download geometry",update:"Unable to update geometry",del:"Unable to delete geometry"},ew=async e=>{try{let t=await Q.download({id:e.id}),l=new File([eb.from(t.buffer).toString()],e.name+"."+t.extension),i=window.URL.createObjectURL(l),a=document.createElement("a");a.href=i,a.setAttribute("download",e.name+"."+t.extension),a.click(),a.remove()}catch(e){(0,R.lt)(ej.download,e)}},eZ=async(e,t,l)=>{try{await Q.update({id:e.id},[{key:"name",value:t.name}]),e.name=t.name,l.mutateOneGeometry(e)}catch(e){throw(0,R.lt)(ej.update,e),e}},eC=async(e,t,l,i)=>{try{await Q.del({id:e.id});let a=t.geometries.filter(t=>t!==e.id);i.mutateProject({id:t.id,geometries:a}),i.delOneGeometry(e),l()}catch(e){throw(0,R.lt)(ej.del,e),e}},ek=e=>{var t,l,i,a,n,s;let{project:o,geometry:u,swr:d,close:m,onCleanup:p}=e,[x,v]=(0,c.useState)(!1),[g,f]=(0,c.useState)(!1),[b,j]=(0,c.useState)(!1),w=(0,c.useCallback)(()=>f(!0),[]),Z=(0,c.useCallback)(async()=>{v(!0);try{await ew(u)}catch(e){}finally{v(!1)}},[u]),C=(0,c.useCallback)(async e=>eZ(u,e,d),[u,d]),k=(0,c.useCallback)(async()=>{j(!0);try{await eC(u,o,m,d),p(u.id)}finally{j(!1)}},[o,u,d,m,p]);return u?(0,r.jsx)(h.Z,{children:(0,r.jsx)(h.Z.Content,{children:(0,r.jsx)(N.Z,{size:"small",title:"Informations",actions:[(0,r.jsx)(z.o6,{loading:x,onDownload:Z},"download"),(0,r.jsxs)("div",{children:[(0,r.jsx)(ef,{visible:g,geometry:{id:null==u?void 0:u.id,name:null==u?void 0:u.name},setVisible:f,onEdit:C}),(0,r.jsx)(z.w6,{onEdit:w})]},"edit"),(0,r.jsx)(z.m1,{loading:b,text:(0,r.jsxs)(r.Fragment,{children:["Are you sure you want to delete the geometry"," ",(0,r.jsx)(y.Z.Text,{strong:!0,children:u.name}),"?"]}),onDelete:k},"delete")],children:(0,r.jsxs)(O.Z,{direction:"vertical",className:eo().fullWidth,children:[(0,r.jsxs)(y.Z.Text,{children:[(0,r.jsx)("span",{className:eo().textLight,children:"File:"})," ",u.name," "]}),(0,r.jsxs)(y.Z.Text,{children:[(0,r.jsx)("span",{className:eo().textLight,children:"Unit:"})," ",(0,r.jsx)(ea.Z.Inline,{text:"m"})]}),(0,r.jsxs)(r.Fragment,{children:[3===u.summary.dimension&&(0,r.jsxs)(y.Z.Text,{children:[(0,r.jsx)("span",{className:eo().textLight,children:"Number of solids:"})," ",null!==(a=null===(t=u.summary.solids)||void 0===t?void 0:t.length)&&void 0!==a?a:0]}),(0,r.jsxs)(y.Z.Text,{children:[(0,r.jsx)("span",{className:eo().textLight,children:"Number of faces:"})," ",null!==(n=null===(l=u.summary.faces)||void 0===l?void 0:l.length)&&void 0!==n?n:0]}),2===u.summary.dimension&&(0,r.jsxs)(y.Z.Text,{children:[(0,r.jsx)("span",{className:eo().textLight,children:"Number of edges:"})," ",null!==(s=null===(i=u.summary.edges)||void 0===i?void 0:i.length)&&void 0!==s?s:0]})]})]})})})}):(0,r.jsx)(M.Z.Simple,{})};ek.componentName="Geometry",ek.Add=ex;let eS=async(e,t)=>{let l=await (0,G.R)("/api/result",{method:"POST",headers:{Accept:"application/json"},body:JSON.stringify({simulation:e,result:t})});return l.json()},eP=async(e,t)=>(0,G.R)("/api/result/download",{method:"POST",body:JSON.stringify({simulation:e,result:t})}),eE=async e=>(0,G.R)("/api/result/archive",{method:"POST",body:JSON.stringify({simulation:e})});var eM={load:eS,download:eP,archive:eE},eN=l(83159),eO=l(96074),eT=l(72269),eA=l(57953),eL=l(41428),ez=l(38095),eR=l(86350),eI=l(15668),e_=l(35598),eF=l(74317),eD=l(49591),eU=l(19478),eV=l(87784),eB=l(75843),eW=l(15611),eH=l(69980),eG=l(62992),eY=l(53073),eJ=l(99477),eX=l(57632),eq=l(79753),eK=l(54327);let e$=e=>{let t=new eJ.fHI(.025,.025,.8,50);t.translate(0,.4,0);let l=new eJ.vBJ({color:e}),i=new eJ.Kj0(t,l),a=new eJ.b_z(.05,.2,50);a.translate(0,.9,0);let n=new eJ.vBJ({color:e}),s=new eJ.Kj0(a,n),r=new eJ.ZAu;r.type="ArrowHelper",r.add(i),r.add(s);let o=()=>{t.dispose(),l.dispose(),a.dispose(),n.dispose()};return r.dispose=o,r},eQ=(e,t,l)=>{let i=document.createElement("canvas");i.width=(null==l?void 0:l.width)||256,i.height=256;let a=i.getContext("2d");(null==l?void 0:l.background)&&(a.fillStyle=l.background,a.fillRect(0,0,i.width,i.height)),a.fillStyle="grey",a.font="50px sans-serif",a.textAlign=(null==l?void 0:l.align)||"center",a.textBaseline="middle",a.fillText(t,i.width/2,i.height/2);let n=new eJ.xEZ(i);n.flipY=!0,n.needsUpdate=!0;let s=new eJ.xeV({map:n,transparent:!0,depthWrite:!1});s.map.anisotropy=e.capabilities.getMaxAnisotropy();let r=new eJ.jyi(s);r.type="LabelHelper",(null==l?void 0:l.position)&&r.position.copy(l.position),(null==l?void 0:l.scale)&&r.scale.setScalar(l.scale);let o=()=>{n.dispose(),s.dispose()};return r.dispose=o,r},e0=function(e,t){let{offsetWidth:l,offsetHeight:i,width:a,height:n}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{offsetWidth:0,offsetHeight:0,width:150,height:150},s=l,r=i,o=a,u=n,d=e$("red");d.rotateZ(-Math.PI/2);let c=eQ(e,"X",{position:new eJ.Pa4(1.1,0,0)}),m=e$("green"),h=eQ(e,"Y",{position:new eJ.Pa4(0,1.1,0)}),p=e$("blue");p.rotateX(Math.PI/2);let y=eQ(e,"Z",{position:new eJ.Pa4(0,0,1.1)}),x=new eJ.xo$(.05,50,50),v=new eJ.vBJ({color:"black"}),g=new eJ.Kj0(x,v),f=new eJ.ZAu;f.type="AxisHelper",f.add(d),f.add(c),f.add(m),f.add(h),f.add(p),f.add(y),f.add(g);let b=new eJ.xsS;b.add(f);let j=new eJ.iKG(-1.2,1.2,1.2,-1.2,-2,2),w=e=>{let{newOffsetWidth:t,newOffsetHeight:l,newWidth:i,newHeight:a}=e;s=t,r=l,o=i,u=a},Z=()=>{e.setViewport(s,r,o,u),j.rotation.copy(t.rotation),e.render(b,j)},C=()=>{x.dispose(),v.dispose(),f.children.forEach(e=>{("ArrowHelper"===e.type||"LabelHelper"===e.type)&&e.dispose()}),b.remove(f)};return{dispose:C,render:Z,resize:w}},e1=(e,t,l,i,a,n)=>{let{smooth:s,radius:r,left:o,down:u}=a,{xc:d,yc:c,uc:m,vc:h}=n;for(let a=0;a<=s;a++){let n=Math.PI/2*(e+a/s),p=Math.cos(n),y=Math.sin(n);if(t.push(d+r*p,c+r*y,0),l.push(m+o*p,h+u*y),a<s){let t=(s+1)*e+a+4;i.push(e,t,t+1)}}},e2=(e,t,l,i)=>{let a=e/2-l,n=t/2-l,s=l/e,r=(e-l)/e,o=l/t,u=(t-l)/t,d=[a,n,0,-a,n,0,-a,-n,0,a,-n,0],c=[r,u,s,u,s,o,r,o],m=[3*(i+1)+3,3*(i+1)+4,i+4,i+5,2*(i+1)+4,2,1,2*(i+1)+3,3,4*(i+1)+3,4,0],h=[m[0],m[1],m[2],m[0],m[2],m[3],m[4],m[5],m[6],m[4],m[6],m[7],m[8],m[9],m[10],m[8],m[10],m[11]];for(let e=0;e<4;e++){let t=e<1||e>2?a:-a,m=e<2?n:-n,p=e<1||e>2?r:s,y=e<2?u:o;e1(e,d,c,h,{smooth:i,radius:l,left:s,down:o},{xc:t,yc:m,uc:p,vc:y})}let p=new eJ.u9r;return p.setIndex(new eJ.lCJ(h,1)),p.setAttribute("position",new eJ.a$l(d,3)),p.setAttribute("uv",new eJ.a$l(c,2)),p},e5=function(e,t,l,i){let{offsetWidth:a,offsetHeight:n,width:s,height:r}=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{offsetWidth:0,offsetHeight:0,width:150,height:150},o="#d3d3d3",u=null,d=null,c=[{text:"FRONT",normal:new eJ.Pa4(0,0,1),up:new eJ.Pa4(0,1,0)},{text:"BACK",normal:new eJ.Pa4(0,0,-1),up:new eJ.Pa4(0,1,0)},{text:"RIGHT",normal:new eJ.Pa4(1,0,0),up:new eJ.Pa4(0,1,0)},{text:"LEFT",normal:new eJ.Pa4(-1,0,0),up:new eJ.Pa4(0,1,0)},{text:"UP",normal:new eJ.Pa4(0,1,0),up:new eJ.Pa4(0,0,-1)},{text:"DOWN",normal:new eJ.Pa4(0,-1,0),up:new eJ.Pa4(0,0,1)}],m=e2(75,75,25,20),h=new eJ.xo$(37.5,10,10,0,Math.PI,0),p=new eJ.ZAu;c.forEach(e=>{let t=document.createElement("canvas"),l=t.getContext("2d");t.width=t.height=256,l.fillStyle=o,l.fillRect(0,0,t.width,t.height),l.font="bold 50pt sans-serif",l.fillStyle="#000000",l.textAlign="center",l.textBaseline="middle",l.fillText(e.text,t.width/2,t.height/2);let i=new eJ.ROQ(t);i.needsUpdate=!0;let a=new eJ.vBJ({map:i,transparent:!0,opacity:.75}),n=new eJ.vBJ({color:o}),s=new eJ.Kj0(m,a),r=new eJ.Kj0(m,n);r.rotateY(Math.PI);let u=new eJ.vBJ({color:o,transparent:!0,opacity:.2}),d=new eJ.Kj0(h,u),c=new eJ.ZAu;c.add(s,r,d),c.lookAt(e.normal),c.translateZ(50),c.normal=e.normal,c.up=e.up,p.add(c)});let y=new eJ.Mig("#ffffff",1),x=new eJ.xsS;x.add(p),x.add(y);let v=new eJ.iKG(-100,100,100,-100,-100,100);v.position.z=2;let g=new eJ.iMs,f=e=>{let t=b(e);j(t)?(u=w(t),Z(),(null==u?void 0:u.uuid)!==(null==d?void 0:d.uuid)&&(C(),d=u)):(u=null,C())},b=e=>{let t=e.target,l=t.getBoundingClientRect(),i=e.clientX-l.left,o=e.clientY-l.top,u=new eJ.FM8;return u.x=(i-a)/s*2-1,u.y=-(2*((o+r-l.height+n)/r))+1,u},j=e=>e.x>-1&&e.x<1&&e.y>-1&&e.y<1,w=e=>{let t=new eJ.Pa4(e.x,e.y,-1);t.unproject(v);let l=new eJ.Pa4;v.getWorldDirection(l),g.set(t,l);let i=g.intersectObjects(x.children,!0);return i.length?i[0].object.parent:null},Z=()=>{u&&u.children&&u.children.forEach(e=>{let t=e;t.material&&t.material.color&&(t.material.previousColor=t.material.color,t.material.color=new eJ.Ilk("#FAD114"))})},C=()=>{d&&d.children&&d.children.forEach(e=>{let t=e;t.material&&t.material.color&&(t.material.color=new eJ.Ilk(o))})},k=e=>{if(u){let a=u.normal,n=u.up,s=new eJ.Pa4;t.boundingBox&&t.boundingBox.getCenter(s);let r=l.position.distanceTo(i.target),o=a.clone().multiplyScalar(r),d=s.add(o);l.position.copy(d),l.up.copy(n),u=null,C(),f(e)}};e.domElement.addEventListener("pointermove",f),e.domElement.addEventListener("pointerdown",k);let S=e=>{let{newOffsetWidth:t,newOffsetHeight:l,newWidth:i,newHeight:o}=e;a=t,n=l,s=i,r=o},P=()=>{e.setViewport(a,n,s,r),v.rotation.copy(l.rotation),e.render(x,v)},E=()=>{e.domElement.removeEventListener("pointermove",f),e.domElement.removeEventListener("pointerdown",k),p.children.forEach(e=>{e.children.forEach(e=>{e.geometry.dispose(),e.material.dispose()})}),x.remove(p)};return{resize:S,render:P,dispose:E}},e4=e=>1e-12>Math.abs(e)?"0":Math.abs(e)>1e3||.001>Math.abs(e)?e.toExponential(2):e.toFixed(3),e3=(e,t,l,i)=>{let a,n,s;let r=e=>{let t=Math.max(e.x,e.y,e.z),l=Math.max(Math.ceil(e.x/t*5),2),i=Math.max(Math.ceil(e.y/t*5),2),a=Math.max(Math.ceil(e.z/t*5),2);return new eJ.Pa4(l,i,a)},o=(e,t,l,i,a)=>{let n=new eJ.ZAu,s=new eJ.nls({color:8947848}),r=new eJ.Pa4(-e/2,0,-t/2),o=e/(l-1),u=t/(i-1);for(let t=0;t<i;++t){let l=new eJ.u9r().setFromPoints([new eJ.Pa4(r.x,0,r.z+t*u),new eJ.Pa4(r.x+e,0,r.z+t*u)]);n.add(new eJ.x12(l,s))}for(let e=0;e<l;++e){let l=new eJ.u9r().setFromPoints([new eJ.Pa4(r.x+e*o,0,r.z),new eJ.Pa4(r.x+e*o,0,r.z+t)]);n.add(new eJ.x12(l,s))}return null==a||a(n),n},u=(t,l,i,a)=>{let n=new eJ.ZAu,s=Math.abs(l-t),r=s/(a-1),o=new eJ.Pa4().copy(i).multiplyScalar(-s/2),u=new eJ.Pa4().copy(i).multiplyScalar(r),d=t;for(let t=0;t<a;++t){let t=eQ(e,e4(d));t.position.copy(o),n.add(t),o.add(u),d+=r}return n},d=()=>{let e=t.boundingBox,l=t.boundingSphere.center,i=new eJ.Pa4(e.max.x-e.min.x,e.max.y-e.min.y,e.max.z-e.min.z),s=r(i);n=1*(a=.1*Math.max(i.x,i.y,i.z));let d=new eJ.ZAu,c=o(i.x,i.z,s.x,s.z),m=o(i.x,i.y,s.x,s.y,e=>{e.rotateX(Math.PI/2)}),h=o(i.y,i.z,s.y,s.z,e=>{e.rotateZ(-Math.PI/2)});d.add(c,m,h);let p=u(e.min.x,e.max.x,new eJ.Pa4(1,0,0),s.x),x=u(e.min.y,e.max.y,new eJ.Pa4(0,1,0),s.y),v=u(e.min.z,e.max.z,new eJ.Pa4(0,0,1),s.z);return d.add(p,x,v),d.position.set(l.x,l.y,l.z),d.type="GridHelper",d.dispose=y,d},c=e=>e<=0?-1:1,m=e=>.5>=Math.abs(e)?1:-1,h=()=>{let e=t.boundingBox,r=new eJ.Pa4(e.max.x-e.min.x,e.max.y-e.min.y,e.max.z-e.min.z),o=!1;t.children.forEach(e=>{"GridHelper"===e.type&&(o=e.visible,t.remove(e),e.dispose())}),s=d();let u=i.object.position.distanceTo(i.target);s.traverse(e=>{"LabelHelper"===e.type&&e.scale.setScalar(.05*u)});let h=new eJ.Pa4;l.getWorldDirection(h);let p=u/10/(i.minDistance+.001),y=s.children[0],x=s.children[1],v=s.children[2];y.position.set(0,c(h.y)*(r.y/2+a),0),x.position.set(0,0,c(h.z)*(r.z/2+a)),v.position.set(c(h.x)*(r.x/2+a),0,0);let g=s.children[3],f=s.children[4],b=s.children[5];g.position.set(0,c(h.y)*m(h.y)*(r.y/2+n),-(c(h.z)*m(h.y)*(r.z/2+n))),f.position.set(c(h.x)*m(h.x)*(r.x/2+n),0,-(c(h.z)*m(h.x)*(r.z/2+n))),b.position.set(c(h.x)*m(h.x)*(r.x/2+n),-(c(h.y)*m(h.x)*(r.y/2+n)),0);let j=.2*p,w=.3*p;g.visible=Math.abs(h.y)>j||Math.abs(h.z)>w,f.visible=Math.abs(h.x)>w||Math.abs(h.z)>w,b.visible=Math.abs(h.x)>w||Math.abs(h.y)>j,s.visible=o,t.add(s)},p=e=>{s.visible=e},y=()=>{null==s||s.children.forEach(e=>{e.children.forEach(e=>{if("Line"===e.type){let t=e.geometry;t.dispose();let l=e.material;l.dispose()}else e.dispose()})})};return{dispose:y,setVisible:p,update:h}},e8=(e,t,l,i)=>{let a=document.createElement("div");a.style.pointerEvents="none",a.style.border="1px solid #55aaff",a.style.backgroundColor="rgba(75, 160, 255, 0.3)",a.style.position="fixed";let n=new eJ.FM8,s=new eJ.FM8,r=new eJ.FM8,o=new eJ.FM8,u=!1,d=!1,c=new eJ.iMs,m=()=>{u=!0},h=()=>{u=!1},p=e=>{u&&0===e.button&&(d=!0,v(e))},y=e=>{u&&d&&g(e)},x=e=>{d=!1,u&&f(e)};e.domElement.addEventListener("pointerdown",p),e.domElement.addEventListener("pointermove",y),e.domElement.addEventListener("pointerup",x);let v=t=>{i.enabled=!1,e.domElement.parentElement.appendChild(a),a.style.left=t.clientX+"px",a.style.top=t.clientY+"px",a.style.width="0px",a.style.height="0px",n.x=t.clientX,n.y=t.clientY},g=e=>{o.x=Math.max(n.x,e.clientX),o.y=Math.max(n.y,e.clientY),r.x=Math.min(n.x,e.clientX),r.y=Math.min(n.y,e.clientY),a.style.left=r.x+"px",a.style.top=r.y+"px",a.style.width=o.x-r.x+"px",a.style.height=o.y-r.y+"px"},f=e=>{i.enabled=!0,a.parentElement&&a.parentElement.removeChild(a),s.x=e.clientX,s.y=e.clientY;let t=new eJ.TUj(n,s);b(t),h()},b=a=>{let n=new eJ.FM8(Math.abs(a.max.x-a.min.x),Math.abs(a.max.y-a.min.y));if(n.x<5||n.y<5)return;let s=new eJ.FM8((a.max.x+a.min.x)/2,(a.max.y+a.min.y)/2),r=e.domElement.getBoundingClientRect(),o=s.x-r.left,u=s.y-r.top,d=new eJ.FM8(o/r.width*2-1,-(2*(u/r.height))+1),m=t.children.find(e=>"Part"===e.type);if(!m)return;c.setFromCamera(d,l);let h=c.intersectObject(m);if(!h.length)return;i.target.copy(h[0].point);let p=new eJ.FM8(n.x/r.width,n.y/r.height),y=Math.max(p.x,p.y),x=l.position.distanceTo(i.target),v=i.target.clone().sub(l.position).normalize().multiplyScalar(x*(1-y));l.position.add(v)},j=()=>{e.domElement.removeEventListener("pointerdown",p),e.domElement.removeEventListener("pointermove",y),e.domElement.removeEventListener("pointerup",x)};return{dispose:j,end:h,isEnabled:()=>u,start:m}},e6=(e,t,l,i)=>{let a,n,s;let r=new eJ.Ilk("#fad114"),o=new eJ.Ilk("#E98A15"),u=new eJ.Pa4(-1,0,0),d=new eJ.JOQ(u),c={up:new eJ.Pa4,forward:new eJ.Pa4,right:new eJ.Pa4},m=new eJ.Pa4,h=new eJ.Pa4,p=new eJ.USm,y=new eJ.Pa4,x=new eJ.FM8,v=new eJ.JOQ,g=new eJ.Pa4,f=new eJ.Pa4,b=new eJ.Zzh,j={up:new eJ.Pa4,forward:new eJ.Pa4,right:new eJ.Pa4},w=new eJ.iMs,Z=new eJ.ZAu;Z.type="SectionViewHelper",Z.visible=!1,t.add(Z),(()=>{let e=new eJ._12(1,1),t=new eJ.vBJ({color:r,side:eJ.ehD,transparent:!0,opacity:.5}),l=new eJ.Kj0(e,t);l.type="Plane",Z.add(l)})(),(()=>{let e=new eJ.xo$(.2,32,32,Math.PI,-Math.PI),t=new eJ.vBJ({color:r,side:eJ.ehD,transparent:!0,opacity:.5}),l=new eJ.Kj0(e,t);l.type="Dome",Z.add(l)})(),(()=>{class e extends eJ.Hyl{getPoint(e){return new eJ.Pa4().set(this.radius*Math.cos(Math.PI*e),this.radius*Math.sin(Math.PI*e),0)}constructor(e){super(),this.radius=e}}let t=new e(.2);{let e=new eJ.WXh(t,32,.020000000000000004,32),l=new eJ.vBJ({color:r,side:eJ.ehD,transparent:!0,opacity:.5}),i=new eJ.Kj0(e,l);i.rotateX(Math.PI/2),i.type="ArcX",Z.add(i)}{let e=new eJ.WXh(t,32,.020000000000000004,32),l=new eJ.vBJ({color:r,side:eJ.ehD,transparent:!0,opacity:.5}),i=new eJ.Kj0(e,l);i.rotateX(Math.PI/2),i.rotateY(Math.PI/2),i.type="ArcY",Z.add(i)}})();let C=()=>{let e=new eJ.Pa4;t.boundingBox.getSize(e),e.multiplyScalar(1.2);let l=Math.max(Math.max(e.x,e.y),e.z);Z.scale.setScalar(l)},k=()=>{let e=new eJ.Pa4;t.boundingBox.getCenter(e),Z.position.copy(e)},S=()=>{let e=Z.visible;Z.visible=!e},P=()=>{e.localClippingEnabled=!0,Z.visible=!0,C(),k();let t=new eJ.Pa4().copy(Z.position).sub(u);Z.lookAt(t),d.setFromNormalAndCoplanarPoint(u,Z.position)},E=()=>{e.localClippingEnabled=!1,Z.visible=!1},M=e=>{if(k(),u.equals(e)){N();return}let t=new eJ.Pa4().copy(Z.position).sub(e);Z.lookAt(t),d.setFromNormalAndCoplanarPoint(e,Z.position),u.copy(e)},N=()=>{Z.rotateX(Math.PI);let e=d.normal.multiplyScalar(-1);d.setFromNormalAndCoplanarPoint(e,Z.position)},O=()=>{Z.traverse(e=>{("Plane"===e.type||"Dome"===e.type||"ArcX"===e.type||"ArcY"===e.type)&&(e.geometry.dispose(),e.material.dispose())}),e.domElement.removeEventListener("pointermove",_),e.domElement.removeEventListener("pointerdown",G),e.domElement.removeEventListener("pointerup",Y)},T=e=>{let t=e.target,l=t.getBoundingClientRect(),i=e.clientX-l.left,a=e.clientY-l.top,n=new eJ.FM8;return n.x=i/l.width*2-1,n.y=-(2*(a/l.height))+1,n},A=e=>{a&&a.material.color.set(r),a=e,e&&e.material.color.set(o)},L=()=>{i.enabled=!0},z=()=>{i.enabled=!1},R=()=>{l.getWorldDirection(c.forward),c.forward.normalize(),c.up.copy(l.up).normalize(),c.right.crossVectors(c.up,c.forward).normalize()},I=()=>{let e=new eJ.Pa4(0,0,1).applyQuaternion(Z.quaternion).multiplyScalar(-1);d.setFromNormalAndCoplanarPoint(e,Z.position)},_=e=>{if(!Z.visible)return;let t=T(e);if(w.setFromCamera(t,l),n){let e=new eJ.Pa4;w.ray.intersectPlane(v,e),(null==s?void 0:s.type)==="Plane"?D(e):(null==s?void 0:s.type)==="Dome"?V(t):W(e),I()}else{let e=w.intersectObject(Z);e.length?(z(),A(s=e[0].object),h.copy(e[0].point),R()):(s=null,A(),L())}},F=()=>{v.setFromNormalAndCoplanarPoint(c.forward,h),m.copy(Z.position);let e=new eJ.Pa4;w.ray.intersectPlane(v,e),g.copy(e).sub(m),f.copy(g).normalize(),b.set(m,new eJ.Pa4().copy(m).add(d.normal))},D=e=>{e.sub(g);let t=new eJ.Pa4;b.closestPointToPoint(e,!1,t),Z.position.copy(t)},U=e=>{p.copy(Z.rotation),x.copy(e)},V=e=>{Z.rotation.copy(p),Z.rotateOnWorldAxis(c.up,-(5*(x.x-e.x))),Z.rotateOnWorldAxis(c.right,-(5*(x.y-e.y)))},B=()=>{s.getWorldDirection(y),p.copy(Z.rotation),g.copy(h).sub(Z.position),f.copy(g).normalize(),j.up.copy(f),j.right.copy(y),j.forward.crossVectors(j.right,j.up),b.set(h,new eJ.Pa4().copy(h).add(j.forward)),v.setFromNormalAndCoplanarPoint(c.forward,h)},W=e=>{let t=i.object.position.distanceTo(i.target),l=new eJ.Pa4;b.closestPointToPoint(e,!1,l);let a=h.distanceTo(l);l.sub(h);let n=new eJ.Pa4().copy(f).cross(l).normalize(),s=Math.sign(y.dot(n));Z.rotation.copy(p),Z.rotateOnWorldAxis(y,s*a*1/(t/100))},H=e=>{switch(null==s?void 0:s.type){case"Plane":F();break;case"Dome":U(e);break;case"ArcX":case"ArcY":B()}},G=e=>{if(Z.visible&&s){n=!0;let t=T(e);H(t)}},Y=()=>{Z.visible&&(n=!1,A())};return e.domElement.addEventListener("pointermove",_),e.domElement.addEventListener("pointerdown",G),e.domElement.addEventListener("pointerup",Y),{getClippingPlane:()=>d,toggleVisible:S,start:P,stop:E,toAxis:M,flip:N,dispose:O}};var e7=l(54104);let e9=e=>{let t=new e7.A("rainbow",512);t.setMin(Number.MAX_VALUE),t.setMax(-Number.MAX_VALUE);let l=new eJ.xsS,i=new eJ.iKG(-1,1,1,-1,2,1);i.position.set(0,0,1);let a=new eJ.ZAu;l.add(a);let n=!1,s=e=>{l.children.forEach(t=>{t.children.forEach(t=>t.visible=e)})},r=()=>{l.children.forEach(e=>{e.children.forEach(t=>{"LabelHelper"===t.type&&t.dispose(),"Sprite"===t.type&&t.dispose(),e.remove(t)})})},o=e=>{if(!n){let l=t.minV,i=t.maxV;t.setMin(Math.min(l,e.minV)),t.setMax(Math.max(i,e.maxV))}let l=new eJ.ROQ(t.createCanvas()),i=new eJ.xeV({map:l,depthWrite:!1}),s=new eJ.jyi(i);s.material.rotation=-Math.PI/2,s.scale.x=.2,s.scale.y=1.2,s.renderOrder=1,s.dispose=s.material.dispose,a.add(s),u(t)},u=t=>{let l=e4(t.minV),i=e4(t.maxV),n=eQ(e,String(l),{background:"white",position:new eJ.Pa4(-.62,0,0),width:512,align:"right"});n.scale.x=.4,n.scale.y=2.8,n.renderOrder=0;let s=eQ(e,String(i),{background:"white",position:new eJ.Pa4(.62,0,0),width:512,align:"left"});s.scale.x=.4,s.scale.y=2.8,s.renderOrder=0,a.add(n),a.add(s)},d=e=>{t.setColorMap(e,512)},c=(e,l)=>{n=!0,t.setMin(e),t.setMax(l)},m=()=>{n=!1,t.setMin(Number.MAX_VALUE),t.setMax(-Number.MAX_VALUE)},h=e=>t.getColor(e),p=()=>{let t=e.domElement.getBoundingClientRect();e.setViewport(t.width/2-350,t.height-50,700,50),e.render(l,i)},y=()=>{n||(t.setMin(Number.MAX_VALUE),t.setMax(-Number.MAX_VALUE)),r()};return{render:p,addLUT:o,getMinV:()=>t.minV,getMaxV:()=>t.maxV,getColor:h,setVisible:s,setColorMap:d,setRange:c,setAutomaticRange:m,dispose:y}},te=e=>{let t=new eJ.ZAu;t.type="PointHelper",t.visible=!1,e.add(t);let l=()=>{var t,l;let i=(null!==(l=null===(t=e.boundingSphere)||void 0===t?void 0:t.radius)&&void 0!==l?l:1)/100,a=new eJ.xo$(i),n=new eJ.Wid({color:16711680});return new eJ.Kj0(a,n)},i=(e,t)=>{let l=new eJ.u9r().setFromPoints([e,t]),i=new eJ.nls({color:16711680});return new eJ.x12(l,i)},a=()=>{let t=[],l=e.boundingBox.max.x-e.boundingBox.min.x,a=e.boundingBox.max.y-e.boundingBox.min.y,n=e.boundingBox.max.z-e.boundingBox.min.z,s=Math.max(l,a,n),r=i(new eJ.Pa4(-s/2,0,0),new eJ.Pa4(s/2,0,0));t.push(r);let o=i(new eJ.Pa4(0,-s/2,0),new eJ.Pa4(0,s/2,0));t.push(o);let u=i(new eJ.Pa4(0,0,-s/2),new eJ.Pa4(0,0,s/2));return t.push(u),t},n=()=>{r();let e=l(),i=a();t.add(e),t.add(...i)},s=e=>{e?(t.position.set(e.x,e.y,e.z),t.visible=!0):t.visible=!1},r=()=>{t.children.forEach(e=>{t.remove(e),e.geometry.dispose(),e.material.dispose()})};return{build:n,dispose:r,update:s}};var tt=l(77836),tl=l(82854),ti=l(6648),ta=l(48764).lW;let tn=(e,t)=>{e.traverse(e=>{if("Mesh"===e.type){let l=e,i=new eJ.Uk6(l.geometry),a=new eJ.nls({color:l.material.color,linewidth:1}),n=new eJ.ejS(i,a);l.add(n),l.material.visible=!1,l.material.clippingPlanes=[t]}})},ts=(e,t)=>{e.traverse(e=>{if("Mesh"===e.type||"Line"===e.type){let l=e,i=l.geometry.getAttribute("data");if(i){let e=i.array.reduce((e,t)=>Math.min(e,t),i.array[0]),t=i.array.reduce((e,t)=>Math.max(e,t),i.array[0]);e===t&&(e-=1,t+=1);let a=new e7.A;a.setMin(e),a.setMax(t),l.userData={...l.userData,lut:a}}if("Mesh"===e.type){let e=new eJ.Uk6(l.geometry),t=new eJ.nls({linewidth:1}),i=new eJ.ejS(e,t);l.add(i)}l.material.vertexColors=!0,l.material.clippingPlanes=[t]}})},tr=(e,t)=>{e.traverse(e=>{if("Mesh"===e.type){let l=e;l.material.clippingPlanes=[t],l.material.originalColor=l.material.color}})},to=(e,t)=>{let l=new eJ.Ilk("#FAD114"),i=new eJ.Ilk("#EE9817"),a=async(e,t,l,i)=>{let a=new Blob([ta.from(e.buffer)]),u=URL.createObjectURL(a),d=new tt.E,c=new tl._;c.setDecoderPath("/three/libs/draco/"),d.setDRACOLoader(c);let m=new ti.a;m.setTranscoderPath("node_modules/three//examples/js/libs/basis/"),d.setKTX2Loader(m);let h=await new Promise((e,t)=>{d.load(u,t=>{e(t)},()=>void 0,e=>t(e))}),g=h.scene,f=new eJ.Tme;return f.type="Part",f.uuid=e.summary.uuid,f.children=g.children,f.userData=g.userData,"mesh"===e.summary.type?tn(f,i):"result"===e.summary.type?ts(f,i):("geometry3D"===e.summary.type||"geometry2D"===e.summary.type)&&tr(f,i),r(f,t),o(f,l),f.boundingBox=n(f),f.dispose=()=>s(f),f.setTransparent=e=>r(f,e),f.setDisplayMesh=e=>o(f,e),f.startSelection=(e,t,l)=>x(f,e,t,l),f.stopSelection=()=>v(),f.getHighlighted=()=>p,f.getSelected=()=>y,f.highlight=k,f.unhighlight=S,f.select=E,f.unselect=M,f},n=e=>{let t=new eJ.ZzF;return e.traverse(e=>{t.expandByObject(e)}),t},s=e=>{e.traverse(e=>{"Mesh"===e.type&&(e.geometry.dispose(),e.material.dispose())})},r=(e,t)=>{e.traverse(e=>{if("Mesh"===e.type){let l=e;l.material.transparent=t,l.material.opacity=t?.5:1,l.material.depthWrite=!t}})},o=(e,t)=>{"result"===e.userData.type&&e.traverse(e=>{e.traverse(e=>{if("LineSegments"===e.type){let l=e;l.visible=t}})})},u=new eJ.iMs,d=null,c=null,m=null,h=null,p=null,y=[],x=(e,t,l,i)=>{d=e,c=i,m=t,h=l,p=null,y.length=0,m.domElement.addEventListener("pointermove",C),m.domElement.addEventListener("pointerdown",P)},v=()=>{m&&m.domElement.removeEventListener("pointermove",C),m&&m.domElement.removeEventListener("pointerdown",P),S(),p=null,y.forEach(e=>{M(e.uuid)}),y.length=0,c=null,d=null,m=null,h=null},g=(e,t)=>{let l;if(e&&t)return e.traverse(e=>{e.userData.uuid===t&&(l=e)}),l},f=e=>{let t=e.target,l=t.getBoundingClientRect(),i=e.clientX-l.left,a=e.clientY-l.top,n=new eJ.FM8;return n.x=i/l.width*2-1,n.y=-(2*(a/l.height))+1,n},b=()=>{let t=u.intersectObject(d,!0);if(t.length){let l=t[0].object,i=l.parent;i&&e(d,i.userData.uuid,i.userData.label)}else e(d)},j=()=>{let t;let l=d.userData;if(2===l.dimension){if((t=u.intersectObject(d,!0)).length){let l=t[0].object,i=l.parent;(null==i?void 0:i.type)==="Mesh"?e(d,i.userData.uuid,i.userData.label):e(d,l.userData.uuid,l.userData.label)}else e(d)}else if((t=u.intersectObject(d,!0)).length){let l=t[0].object;e(d,l.userData.uuid,l.userData.label)}else e(d)},w=()=>{let t;let l=d.userData,i=l.edges;if((t=u.intersectObject(d,!0)).length){let l=t[0].object,a=null==i?void 0:i.find(e=>e.uuid===l.userData.uuid);a?e(d,l.userData.uuid,l.userData.label):e(d)}else e(d)},Z=()=>{let t=u.intersectObject(d,!0);if(t.length){let l=t[0];e(d,void 0,void 0,l.point)}else e(d)},C=e=>{let t=f(e);switch(u.setFromCamera(t,h),c){case"solids":b();break;case"faces":j();break;case"edges":w();break;case"point":Z()}},k=e=>{if(e===(null==p?void 0:p.uuid))return;S();let t=g(d,e);if(t){if(p={uuid:t.userData.uuid,label:t.userData.label},"Mesh"===t.type){let e=t;e.material.color=l}else t.traverse(e=>{if("Mesh"===e.type){let t=e;t.material.color=l}})}},S=()=>{let e=g(d,null==p?void 0:p.uuid);if(p=null,!e)return;let t=y.findIndex(t=>t.uuid===e.userData.uuid);if("Mesh"===e.type){let l=e;l.material.color=-1===t?l.material.originalColor:i}else e.traverse(e=>{if("Mesh"===e.type){let l=e;l.material.color=-1===t?l.material.originalColor:i}})},P=()=>{p&&t(d,p.uuid,p.label)},E=e=>{let t=g(d,e);if(t){if(y.push({uuid:e,label:t.userData.label}),"Mesh"===t.type){let e=t;e.material.color=i}else t.traverse(e=>{if("Mesh"===e.type){let t=e;t.material.color=i}})}},M=e=>{let t=g(d,e),l=y.findIndex(t=>t.uuid===e);if(-1!==l&&(y=[...y.slice(0,l),...y.slice(l+1)]),t){if("Mesh"===t.type){let e=t;e.material.color=e.material.originalColor}else t.traverse(e=>{if("Mesh"===e.type){let t=e;t.material.color=t.material.originalColor}})}};return{load:a}},tu=()=>({type:_.ENABLE}),td=()=>({type:_.DISABLE}),tc=e=>({type:_.SETTYPE,value:e}),tm=e=>({type:_.SETPART,value:e}),th=e=>{let{uuid:t,label:l}=e;return{type:_.HIGHLIGHT,value:{uuid:t,label:l}}},tp=()=>({type:_.UNHIGHLIGHT}),ty=e=>{let{uuid:t,label:l}=e;return{type:_.SELECT,value:{uuid:t,label:l}}},tx=e=>{let{uuid:t,label:l}=e;return{type:_.UNSELECT,value:{uuid:t,label:l}}},tv=e=>({type:_.SETPOINT,value:e});var tg=l(72735),tf=l(60968),tb=l.n(tf);let tj={load:"Error while loading part",snapshot:"Error while taking snapshot",saveScreenshot:"Unable to save screenshot"},tw=!1,tZ=e=>{let t=new eJ.ZzF;e.children.forEach(e=>{if(e.visible&&"Part"===e.type){let l=e.boundingBox,i=new eJ.Pa4(Math.min(t.min.x,l.min.x),Math.min(t.min.y,l.min.y),Math.min(t.min.z,l.min.z)),a=new eJ.Pa4(Math.max(t.max.x,l.max.x),Math.max(t.max.y,l.max.y),Math.max(t.max.z,l.max.z));t.set(i,a)}});let l=new eJ.aLr;t.getBoundingSphere(l),e.boundingBox=t,e.boundingSphere=l},tC=(e,t,l)=>{let i=t.object.position.distanceTo(t.target),a=t.target.clone().sub(e.position).normalize().multiplyScalar(i*l*.01);e.position.add(a)},tk=(e,t,l)=>{let i=e.children.find(e=>"Part"===e.type);if(!i)return;tw=!0;let a=e.boundingSphere,n=a.center,s=2*a.radius,r=s/(2*Math.atan(Math.PI*t.fov/360)),o=r/t.aspect,u=1.1*Math.max(r,o),d=l.target.clone().sub(t.position).normalize().multiplyScalar(u);l.target.copy(n),l.minDistance=u/10,l.maxDistance=10*u,t.position.copy(n).sub(d),t.near=u/100,t.far=100*u,t.updateProjectionMatrix()},tS=async(e,t,l,i,a,n,s)=>{let r=(e,t,l,i)=>{t?(e.highlight(t),setTimeout(()=>s(th({uuid:t,label:l})),1)):i?s(tv({x:i.x,y:i.y,z:i.z})):(e.unhighlight(),setTimeout(()=>s(tp()),1))},o=(e,t,l)=>{let i=e.getSelected();i.find(e=>e.uuid===t)?(e.unselect(t),setTimeout(()=>s(tx({uuid:t,label:l})),1)):(e.select(t),setTimeout(()=>s(ty({uuid:t,label:l})),1))},u=to(r,o),d=await u.load(e,a.transparent,a.displayMesh,n.sectionViewHelper.getClippingPlane());t.add(d),tZ(t),tw||tk(t,l,i),n.gridHelper.update(),n.gridHelper.update(),n.gridHelper.setVisible(!0),n.pointHelper.build()},tP=(e,t)=>{for(let l of(t.dispose(),t.setVisible(!1),e.children))"Part"===l.type&&"result"===l.userData.type&&l.traverse(e=>{("Mesh"===e.type||"Line"===e.type)&&(t.addLUT(e.userData.lut),t.setVisible(!0))})},tE=(e,t)=>{for(let l of(tP(e,t),e.children))"Part"===l.type&&"result"===l.userData.type&&l.traverse(e=>{if("Mesh"===e.type||"Line"===e.type){let l=e.geometry.getAttribute("data"),i=new Float32Array(3*l.count);for(let e=0;e<l.count;e++){let a=t.getColor(l.array[e]);i[3*e+0]=a.r,i[3*e+1]=a.g,i[3*e+2]=a.b}e.geometry.setAttribute("color",new eJ.a$l(i,3))}})},tM=async(e,t,l,i)=>{try{let a=i.domElement.width,n=i.domElement.height,s=l.aspect;i.domElement.width=520,i.domElement.height=312,l.aspect=520/312,l.updateProjectionMatrix(),i.clear(),i.setViewport(0,0,520,312),i.render(t,l);let r=i.domElement.toDataURL();i.domElement.width=a,i.domElement.height=n,l.aspect=s,l.updateProjectionMatrix(),await tg.Z.add({name:"snapshot",uid:"snapshot_"+(0,eX.Z)(),data:r},{id:e.id})}catch(e){(0,R.lt)(tj.snapshot,e)}},tN=(e,t,l,i)=>{try{let a=i.domElement.width,n=i.domElement.height;i.clear(),i.setViewport(0,0,a,n),i.render(t,l);let s=i.domElement.toDataURL(),r=document.createElement("a");r.href=s.replace("image/png","image/octet-stream"),r.download=e.title+"_"+new Date().toLocaleDateString()+".png",r.click()}catch(e){(0,R.lt)(tj.saveScreenshot,e)}},tO=e=>{var t,l,a,n,s;let{loading:o,project:u,parts:p}=e,y=(0,c.useRef)(null),v=(0,c.useRef)(),f=(0,c.useRef)(),b=(0,c.useRef)(),j=(0,c.useRef)(),w=(0,c.useRef)(),Z=(0,c.useRef)(),C=(0,c.useRef)(),S=(0,c.useRef)(),P=(0,c.useRef)(),[M,N]=(0,c.useState)(!1),[O,T]=(0,c.useState)(!0),[A,L]=(0,c.useState)(!1),[z,I]=(0,c.useState)(!1),[_,D]=(0,c.useState)(!1),[U,V]=(0,c.useState)(!1),B=(0,d.useRouter)(),{enabled:W,part:H,highlighted:G,selected:Y,point:J,type:X,dispatch:q}=(0,c.useContext)(F);(0,c.useEffect)(()=>{if(!eK.Z.isWebGLAvailable()){B.push("/webgl");return}let e=y.current,t=e.clientWidth,l=e.clientHeight;v.current=new eJ.xsS,v.current.boundingBox=new eJ.ZzF,v.current.boundingSphere=new eJ.aLr,f.current=new eJ.cPb(50,t/l,.1,1e3),f.current.position.z=10;let i=new eJ.Mig("#aaa",.75);v.current.add(i);let a=new eJ.cek("#fff",.5);a.decay=2,f.current.add(a),v.current.add(f.current),b.current=new eJ.CP7({antialias:!0,alpha:!0}),b.current.setClearColor("#ffffff"),b.current.setSize(t,l),b.current.setPixelRatio(window.devicePixelRatio||1),b.current.shadowMap.enabled=!0,b.current.autoClear=!1,e.appendChild(b.current.domElement),j.current=new eq.$(f.current,e),j.current.rotateSpeed=3,j.current.panSpeed=.1;let n=e0(b.current,f.current,{offsetWidth:t-155,offsetHeight:l-155,width:150,height:150}),s=e5(b.current,v.current,f.current,j.current,{offsetWidth:t-155,offsetHeight:l-155,width:150,height:150});w.current=e3(b.current,v.current,f.current,j.current),Z.current=e8(b.current,v.current,f.current,j.current),C.current=e6(b.current,v.current,f.current,j.current),S.current=e9(b.current),S.current.setVisible(!1),P.current=te(v.current);let r=()=>{j.current.update(),b.current.setViewport(0,0,t,l),b.current.render(v.current,f.current),w.current.update(),n.render(),s.render(),S.current.render()},o=()=>{t=e.clientWidth,l=e.clientHeight,f.current.aspect=t/l,f.current.updateProjectionMatrix(),b.current.setSize(t,l),n.resize({newOffsetWidth:t-155,newOffsetHeight:l-155,newWidth:150,newHeight:150}),s.resize({newOffsetWidth:t-155,newOffsetHeight:l-155,newWidth:150,newHeight:150}),r()},u=()=>{r(),setTimeout(()=>requestAnimationFrame(u),1e3/30)};return window.addEventListener("resize",o),requestAnimationFrame(u),()=>{tw=!1,window.removeEventListener("resize",o),e.removeChild(b.current.domElement),v.current.children.forEach(e=>{v.current.remove(e)}),n.dispose(),s.dispose(),w.current.dispose(),C.current.dispose(),Z.current.dispose(),S.current.dispose(),P.current.dispose()}},[B]),(0,E.Z)(()=>{if(!v.current)return;let e=v.current.children;if(!p.length){var t;tZ(v.current),w.current.update(),null===(t=P.current)||void 0===t||t.build()}let l=p.filter(t=>!e.find(e=>e.uuid===t.summary.uuid)),i=e.filter(e=>!p.find(t=>t.summary.uuid===e.uuid)).filter(e=>"Part"===e.type);i.forEach(e=>{var t;null===(t=v.current)||void 0===t||t.remove(e),e.dispose()}),(async()=>{await Promise.all(l.map(async e=>{try{await tS(e,v.current,f.current,j.current,{transparent:M,displayMesh:O},{gridHelper:w.current,sectionViewHelper:C.current,pointHelper:P.current},q)}catch(e){(0,R.lt)(tj.load,e),tZ(v.current)}})),tE(v.current,S.current)})()},[p,M,O,q]),(0,E.Z)(()=>{var e;if(v.current){if((null===(e=p[0])||void 0===e?void 0:e.summary.dimension)===2){tZ(v.current);let e=new eJ.Pa4(0,0,1),t=new eJ.Pa4(0,1,0),l=new eJ.Pa4;v.current.boundingBox.getCenter(l);let i=f.current.position.distanceTo(j.current.target),a=e.clone().multiplyScalar(i),n=l.add(a);f.current.position.copy(n),f.current.up.copy(t),j.current.noRotate=!0}else j.current.noRotate=!1}},[p]),(0,c.useEffect)(()=>{v.current&&v.current.children.forEach(e=>{"Part"===e.type&&e.userData.uuid===H&&(W?e.startSelection(b.current,f.current,X):e.stopSelection())})},[W,H,X]),(0,c.useEffect)(()=>{v.current&&v.current.children.forEach(e=>{if("Part"===e.type&&e.uuid===H){e.highlight(null==G?void 0:G.uuid);let t=e.getSelected(),l=Y.filter(e=>!t.find(t=>t.uuid===e.uuid));l.forEach(t=>{t.uuid&&e.select(t.uuid)});let i=t.filter(e=>!Y.find(t=>t.uuid===e.uuid));i.forEach(t=>{e.unselect(t.uuid)})}})},[H,G,Y]),(0,c.useEffect)(()=>{var e;v.current&&(null===(e=P.current)||void 0===e||e.update(J?new eJ.Pa4(J.x,J.y,J.z):void 0))},[J]);let K=(0,c.useCallback)(e=>{N(e),v.current.children.forEach(t=>{"Part"===t.type&&t.setTransparent(e)})},[]),$=(0,c.useCallback)(e=>{T(e),v.current.children.forEach(t=>{"Part"===t.type&&t.setDisplayMesh(e)})},[]),Q=(0,c.useCallback)(()=>{let e=!A;L(e),e?C.current.start():C.current.stop()},[A]),ee=(0,c.useCallback)(async()=>{I(!0);try{await tM(u,v.current,f.current,b.current)}finally{I(!1)}},[u]),et=(0,c.useCallback)(()=>{D(!0);try{tN(u,v.current,f.current,b.current)}finally{D(!1)}},[u]),el=(0,c.useCallback)(e=>{var t;null===(t=w.current)||void 0===t||t.setVisible(e)},[]),ei=(0,c.useCallback)(()=>{tC(f.current,j.current,1);let e=()=>ei();i=requestAnimationFrame(e)},[]),ea=(0,c.useCallback)(()=>{tC(f.current,j.current,-1);let e=()=>ea();i=requestAnimationFrame(e)},[]),en=(0,c.useCallback)(()=>{i&&cancelAnimationFrame(i),i=void 0},[]),er=(0,c.useCallback)(()=>{tk(v.current,f.current,j.current)},[]),eu=(0,c.useCallback)(()=>{C.current.toAxis(new eJ.Pa4(-1,0,0))},[]),ed=(0,c.useCallback)(()=>{C.current.toAxis(new eJ.Pa4(0,-1,0))},[]),ec=(0,c.useCallback)(()=>{C.current.toAxis(new eJ.Pa4(0,0,-1))},[]),em=(0,c.useCallback)(e=>{var t;null===(t=S.current)||void 0===t||t.setColorMap(e.key),tE(v.current,S.current)},[]),eh=(0,c.useCallback)(()=>{V(!0)},[]),ep=(0,c.useCallback)(()=>{V(!1)},[]),ey=(0,c.useCallback)(async e=>{var t;null===(t=S.current)||void 0===t||t.setRange(+e.min,+e.max),tE(v.current,S.current),ep()},[ep]),ex=(0,c.useCallback)(()=>{var e;null===(e=S.current)||void 0===e||e.setAutomaticRange(),tE(v.current,S.current)},[]);return(0,r.jsxs)(h.Z,{className:"".concat(eo().noScroll," ").concat(tb().view),children:[(0,r.jsxs)(es.ZP,{visible:U,title:"Custom range",initialValues:{min:null===(t=S.current)||void 0===t?void 0:t.getMinV(),max:null===(l=S.current)||void 0===l?void 0:l.getMaxV()},onCancel:ep,onOk:ey,children:[(0,r.jsx)(ev.Z.Item,{label:"Min",name:"min",children:(0,r.jsx)(eg.Z,{})}),(0,r.jsx)(ev.Z.Item,{label:"Max",name:"max",children:(0,r.jsx)(eg.Z,{})})]}),(0,r.jsxs)(h.Z.Header,{className:tb().head,children:[(0,r.jsx)(m.Z,{title:"Take snapshot",placement:"left",children:(0,r.jsx)(eN.Z,{placement:"bottom",menu:{items:[{key:"project",label:(0,r.jsx)(x.ZP,{type:"text",className:"".concat(eo().fullWidth," ").concat(eo().noBackground),loading:z,onClick:ee,children:"Project snapshot"})},{key:"image",label:(0,r.jsx)(x.ZP,{type:"text",className:"".concat(eo().fullWidth," ").concat(eo().noBackground),loading:_,onClick:et,children:"Export image"})}]},children:(0,r.jsx)(x.ZP,{icon:(0,r.jsx)(eL.Z,{})})})}),(0,r.jsx)(eO.Z,{style:{margin:0}}),(0,r.jsx)(m.Z,{title:"Display grid",placement:"left",children:(0,r.jsx)(eT.Z,{defaultChecked:!0,checkedChildren:(0,r.jsx)(ez.Z,{}),unCheckedChildren:(0,r.jsx)(ez.Z,{}),onChange:el})}),(0,r.jsx)(m.Z,{title:"Set transparency",placement:"left",children:(0,r.jsx)(eT.Z,{checked:M,checkedChildren:(0,r.jsx)(eR.Z,{}),unCheckedChildren:(0,r.jsx)(eR.Z,{}),onChange:K})}),(0,r.jsx)(eO.Z,{style:{margin:0}}),(0,r.jsx)(m.Z,{title:"Zoom out",placement:"left",children:(0,r.jsx)(x.ZP,{icon:(0,r.jsx)(eI.Z,{}),onMouseDown:ea,onMouseUp:en,onMouseOut:en})}),(0,r.jsx)(m.Z,{title:"Zoom in",placement:"left",children:(0,r.jsx)(x.ZP,{icon:(0,r.jsx)(e_.Z,{}),onMouseDown:ei,onMouseUp:en,onMouseOut:en})}),(0,r.jsx)(m.Z,{title:"Zoom to fit",placement:"left",children:(0,r.jsx)(x.ZP,{icon:(0,r.jsx)(eF.Z,{}),onClick:er})}),(0,r.jsx)(m.Z,{title:"Zoom to selection",placement:"left",children:(0,r.jsx)(x.ZP,{icon:(0,r.jsx)(eD.Z,{}),onClick:(null===(a=Z.current)||void 0===a?void 0:a.isEnabled())?null===(n=Z.current)||void 0===n?void 0:n.end:null===(s=Z.current)||void 0===s?void 0:s.start})}),(0,r.jsx)(eO.Z,{style:{margin:0}}),!A&&(0,r.jsx)(m.Z,{title:"Section view",placement:"left",children:(0,r.jsx)(x.ZP,{icon:(0,r.jsx)(eU.Z,{}),onClick:Q})}),A&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(m.Z,{title:"Stop",placement:"left",children:(0,r.jsx)(x.ZP,{icon:(0,r.jsx)(eV.Z,{}),onClick:Q})}),(0,r.jsx)(m.Z,{title:"Hide plane",placement:"left",children:(0,r.jsx)(x.ZP,{icon:(0,r.jsx)(g.Z,{}),onClick:C.current.toggleVisible})}),(0,r.jsx)(m.Z,{title:"Snap to X",placement:"left",children:(0,r.jsx)(x.ZP,{className:"ant-btn-icon-only",onClick:eu,children:"X"})}),(0,r.jsx)(m.Z,{title:"Snap to Y",placement:"left",children:(0,r.jsx)(x.ZP,{className:"ant-btn-icon-only",onClick:ed,children:"Y"})}),(0,r.jsx)(m.Z,{title:"Snap to Z",placement:"left",children:(0,r.jsx)(x.ZP,{className:"ant-btn-icon-only",onClick:ec,children:"Z"})}),(0,r.jsx)(m.Z,{title:"Flip",placement:"left",children:(0,r.jsx)(x.ZP,{onClick:C.current.flip,icon:(0,r.jsx)(eB.Z,{})})})]}),p.filter(e=>"result"===e.summary.type).length?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(eO.Z,{className:"no-margin"}),(0,r.jsx)(m.Z,{title:"Display result mesh",placement:"left",children:(0,r.jsx)(eT.Z,{checked:O,checkedChildren:(0,r.jsx)(eW.Z,{}),unCheckedChildren:(0,r.jsx)(eW.Z,{}),onChange:$})}),(0,r.jsx)(m.Z,{title:"Colormap",placement:"left",children:(0,r.jsx)(eN.Z,{placement:"bottom",menu:{items:[{key:"rainbow",label:"Rainbow"},{key:"cooltowarm",label:"Cool to warm"},{key:"blackbody",label:"Black body"},{key:"grayscale",label:"Gray scale"}],onClick:em},children:(0,r.jsx)(x.ZP,{icon:(0,r.jsx)(eH.Z,{})})})}),(0,r.jsx)(m.Z,{title:"Custom range",placement:"left",children:(0,r.jsx)(x.ZP,{icon:(0,r.jsx)(eG.Z,{}),onClick:eh})}),(0,r.jsx)(m.Z,{title:"Automatic range",placement:"left",children:(0,r.jsx)(x.ZP,{icon:(0,r.jsx)(eY.Z,{}),onClick:ex})})]}):null]}),(0,r.jsxs)(h.Z.Content,{className:"".concat(eo().noScroll," ").concat(tb().content),children:[(0,r.jsx)("div",{style:{display:o?"flex":"none"},className:tb().loading,children:(0,r.jsx)(eA.Z,{indicator:(0,r.jsx)(k.Z,{style:{fontSize:80},spin:!0})})}),(0,r.jsx)("div",{ref:y,className:tb().canvas})]})]})},tT={part:"Unable to load part"},tA=async(e,t,l)=>{try{if("geometry"===l){let e=await Q.getPart({id:t.id});return{...e,extra:{id:t.id}}}{let l=await eM.load({id:e.id},{originPath:t.originPath,glb:t.glb});return{...l,extra:{glb:t.glb}}}}catch(e){throw(0,R.lt)(tT.part,e),e}},tL=async(e,t,l)=>Promise.all(l.map(async l=>{let i=t.find(e=>{var t;return(null===(t=e.extra)||void 0===t?void 0:t.glb)===l.glb});if(i)return i;let a=await tA(e,l,"result");return a})),tz=async(e,t,l)=>{if(!l)return;let i=t.find(e=>{var t;return(null===(t=e.extra)||void 0===t?void 0:t.glb)===l.glb});if(i)return i;let a=await tA(e,l,"result");return a},tR=async(e,t,l)=>Promise.all(l.map(async l=>{let i=t.find(e=>{var t;return(null===(t=e.extra)||void 0===t?void 0:t.id)===l.id});if(i)return i;let a=await tA(e,l,"geometry");return a})),tI=e=>{let{project:t,simulation:l,geometries:i,results:a,postprocessing:n}=e,[s,o]=(0,c.useState)([]),[u,d]=(0,c.useState)(!1);return(0,E.Z)(()=>{(async()=>{d(!0);try{let e=[];if(l&&!n){let t=await tL(l,s,a);e.push(...t)}if(l){let t=await tz(l,s,n);t&&e.push(t)}if(!a.length&&!n){let t=await tR(l,s,i);e.push(...t)}o(e)}catch(e){}finally{d(!1)}})()},[l,i,a,n,s]),(0,r.jsx)(tO,{loading:u,project:{id:t.id,title:t.title},parts:s})};var t_=l(34041),tF=l(39014),tD=l(44442),tU=l(23389),tV=l(93398),tB=l(96486),tW=l(46210),tH=l(87782),tG=l(55276),tY=l(99138),tJ=l(57132);let tX={copy:"Unable to copy simulation"},tq=async(e,t,l)=>{try{let i=tH.Z.deepCopy(t.scheme);i.configuration.run.done=!1,i.configuration.run.error=void 0;let a=await W.Z.add({id:e.id},{name:t.name+" (copy)",scheme:i});l.addOneSimulation(a),l.mutateProject({id:e.id,simulations:[...e.simulations,a.id]})}catch(e){(0,R.lt)(tX.copy,e)}},tK=e=>{let{project:t,simulation:l,swr:i}=e,[a,n]=(0,c.useState)(!1),s=(0,c.useCallback)(async()=>{n(!0);try{await tq(t,l,i)}finally{n(!1)}},[t,l,i]);return(0,r.jsx)(m.Z,{title:"Copy simulation",children:(0,r.jsx)(x.ZP,{className:eo().noBorder,loading:a,icon:(0,r.jsx)(tJ.Z,{}),onClick:s})})},t$={update:"Unable to update simulation"},tQ=async(e,t,l)=>{try{await W.Z.update({id:e.id},[{key:"name",value:t.name}]),l.mutateOneSimulation({id:e.id,name:t.name})}catch(e){throw(0,R.lt)(t$.update,e),e}},t0=e=>{let{simulation:t,swr:l}=e,i=(0,c.useRef)(null),[a,n]=(0,c.useState)(!1),[s,o]=(0,c.useState)(!1);(0,c.useEffect)(()=>{i.current&&i.current.focus()});let u=(0,c.useCallback)(async e=>{o(!0);try{await tQ(t,e,l),o(!1),n(!1)}catch(e){throw o(!1),e}},[t,l]),d=(0,c.useCallback)(()=>n(!0),[]),m=(0,c.useCallback)(()=>n(!1),[]);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(z.w6,{onEdit:d}),(0,r.jsx)(es.ZP,{title:"Edit the simulation's name",visible:a,initialValues:{name:t.name},onCancel:m,onOk:u,loading:s,children:(0,r.jsx)(ev.Z.Item,{name:"name",label:"Name:",rules:[{required:!0,message:"Name is required"}],children:(0,r.jsx)(eg.Z,{ref:i})})})]})},t1={del:"Unable to delete simulation"},t2=async(e,t,l)=>{try{await W.Z.del(t);let i=e.simulations.filter(e=>e!==t.id);l.mutateProject({id:e.id,simulations:i}),l.delOneSimulation({id:t.id})}catch(e){throw(0,R.lt)(t1.del,e),e}},t5=e=>{let{project:t,simulation:l,swr:i}=e,[a,n]=(0,c.useState)(!1),s=(0,c.useCallback)(async()=>{n(!0);try{await t2(t,l,i)}finally{n(!1)}},[t,l,i]);return(0,r.jsx)(z.m1,{loading:a,text:(0,r.jsxs)(r.Fragment,{children:["Are you sure you want to delete the simulation"," ",(0,r.jsx)(y.Z.Text,{strong:!0,children:l.name}),"?"]}),onDelete:s})},t4=e=>{let{project:t,simulation:l,swr:i}=e;return t&&l?(0,r.jsx)(h.Z,{children:(0,r.jsx)(h.Z.Content,{children:(0,r.jsx)(N.Z,{size:"small",title:(0,r.jsx)(y.Z.Title,{level:5,ellipsis:!0,children:l.name}),actions:[(0,r.jsx)(tK,{project:{id:t.id,simulations:t.simulations},simulation:l,swr:{mutateProject:i.mutateProject,addOneSimulation:i.addOneSimulation}},"copy"),(0,r.jsx)(t0,{simulation:{id:l.id,name:l.name},swr:{mutateOneSimulation:i.mutateOneSimulation}},"edit"),(0,r.jsx)(t5,{project:{id:t.id,simulations:t.simulations},simulation:{id:l.id,name:l.name},swr:{mutateProject:i.mutateProject,delOneSimulation:i.delOneSimulation}},"delete")],children:(0,r.jsxs)(O.Z,{direction:"vertical",className:eo().fullWidth,children:[l.scheme.user&&(0,r.jsx)(tY.Z,{message:"User algorithm",type:"info",showIcon:!0}),(0,r.jsxs)(y.Z.Text,{children:[(0,r.jsx)("span",{className:eo().textLight,children:"Category:"})," ",l.scheme.category]}),(0,r.jsxs)(y.Z.Text,{children:[(0,r.jsx)("span",{className:eo().textLight,children:"Algorithm:"})," ",l.scheme.algorithm]}),(0,r.jsxs)(y.Z.Text,{children:[(0,r.jsx)("span",{className:eo().textLight,children:"Code:"})," ",l.scheme.code]}),(0,r.jsxs)(y.Z.Text,{children:[(0,r.jsx)("span",{className:eo().textLight,children:"Version:"})," ",l.scheme.version]}),(0,r.jsx)("div",{className:"".concat(eo().fullWidth," ").concat(eo().scroll),children:(0,r.jsx)(ea.Z.Html,{html:l.scheme.description})})]})})})}):(0,r.jsx)(N.Z,{children:(0,r.jsx)(eA.Z,{})})};var t3=l(32808);let t8=e=>{let{label:t,className:l,style:i,defaultValue:a,defaultChecked:n,onValueChange:s,onCheckedChange:o,unit:u}=e,[d,m]=(0,c.useState)(String(null!=a?a:0)),[h,p]=(0,c.useState)(!!n),[y,x]=(0,c.useState)(void 0!==n&&!n),[v,g]=(0,c.useState)(0),[f,b]=(0,c.useState)(!1);(0,c.useEffect)(()=>{m(String(null!=a?a:0))},[a]),(0,c.useEffect)(()=>{p(!!n)},[n]);let w=(0,c.useCallback)(e=>{let t=e.target.checked;p(t),null==o||o(t),x(!t)},[o]),Z=(0,c.useCallback)(e=>{v&&clearTimeout(v);let t=setTimeout(()=>{s(e),b(!1)},500);g(+t)},[v,s]),C=(0,c.useCallback)(e=>{let t=e.target.value;m(t),b(!0),Z(t)},[Z]);return(0,r.jsx)(O.Z,{className:"".concat(eo().fullWidth," ").concat(l),style:i,align:"start",children:(0,r.jsx)(ev.Z,{layout:"vertical",children:(0,r.jsx)(ev.Z.Item,{label:(0,r.jsxs)(r.Fragment,{children:[void 0!==n&&(0,r.jsx)(t3.Z,{checked:h,onChange:w,style:{marginRight:"5px"}}),t]}),children:(0,r.jsx)(eg.Z,{disabled:y,value:d,onChange:C,addonAfter:(0,r.jsxs)(O.Z,{className:eo().fullWidth,children:[(0,r.jsx)(ea.Z.Inline,{text:u}),f?(0,r.jsx)(k.Z,{spin:!0,className:eo().textOrange}):(0,r.jsx)(j.Z,{className:eo().textGreen})]})})})})})},t6={update:"Unable to update simulation"},t7=async(e,t,l)=>{try{let i=tH.Z.deepCopy(e);i.scheme.configuration.geometry.meshParameters={type:t,value:"auto"===t?"normal":"1"};let a={...i.scheme.configuration.geometry,done:!0};await W.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","geometry"],value:a}]),await W.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","run"],value:{...i.scheme.configuration.run,done:!1}}]),l.mutateOneSimulation(i)}catch(e){throw(0,R.lt)(t6.update,e),e}},t9=async(e,t,l,i)=>{try{let a=tH.Z.deepCopy(e);a.scheme.configuration.geometry.meshParameters={...a.scheme.configuration.geometry.meshParameters,type:t,value:l};let n={...a.scheme.configuration.geometry,done:!0};await W.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","geometry"],value:n}]),await W.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","run"],value:{...a.scheme.configuration.run,done:!1}}]),i.mutateOneSimulation(a)}catch(e){throw(0,R.lt)(t6.update,e),e}},le=e=>{let{simulation:t,swr:l}=e,[i,a]=(0,c.useState)(),[n,s]=(0,c.useState)();(0,c.useEffect)(()=>{let e=t.scheme.configuration.geometry.meshParameters;e?(a(e.type),s(e.value)):(a("auto"),s("normal"))},[t]);let o=(0,c.useCallback)(async e=>{try{await t7(t,e,l),a(e),"auto"===e?s("normal"):s("1")}catch(e){}},[t,l]),u=(0,c.useCallback)(async e=>{try{await t9(t,i,e,l),s(e)}catch(e){}},[t,i,l]);return(0,r.jsx)(N.Z,{size:"small",title:"Mesh refinement",children:(0,r.jsxs)(O.Z,{direction:"vertical",className:eo().fullWidth,children:[(0,r.jsx)(ev.Z,{layout:"vertical",children:(0,r.jsx)(ev.Z.Item,{label:"Type",children:(0,r.jsxs)(t_.Z,{className:eo().fullWidth,value:i,onChange:o,children:[(0,r.jsx)(t_.Z.Option,{value:"auto",children:"Automatic"}),(0,r.jsx)(t_.Z.Option,{value:"manual",children:"Manual"})]})})}),"auto"===i&&(0,r.jsx)(ev.Z,{layout:"vertical",children:(0,r.jsx)(ev.Z.Item,{label:"Size",children:(0,r.jsxs)(t_.Z,{className:eo().fullWidth,value:n,onChange:u,children:[(0,r.jsx)(t_.Z.Option,{value:"veryfine",children:"Very fine"}),(0,r.jsx)(t_.Z.Option,{value:"fine",children:"Fine"}),(0,r.jsx)(t_.Z.Option,{value:"normal",children:"Normal"}),(0,r.jsx)(t_.Z.Option,{value:"coarse",children:"Coarse"}),(0,r.jsx)(t_.Z.Option,{value:"verycoarse",children:"Very coarse"})]})})}),"manual"===i&&(0,r.jsx)(t8,{label:"Size",defaultValue:n,onValueChange:u,unit:"m"})]})})};var lt=l(98281),ll=l.n(lt);let li={update:"Unable to update simulation"},la=async(e,t,l,i,a)=>{try{var n;let s=tH.Z.deepCopy(e),r=t.find(e=>e.id===l);s.scheme.configuration.geometry.value=l,s.scheme.configuration.geometry.values=void 0;let o={...s.scheme.configuration,dimension:null!==(n=r.summary.dimension)&&void 0!==n?n:3,geometry:{...s.scheme.configuration.geometry,done:!0},run:{...s.scheme.configuration.run,done:!1}};await W.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration"],value:o}]),a.mutateOneSimulation(s),i([r])}catch(e){(0,R.lt)(li.update,e)}},ln=async(e,t,l,i,a)=>{try{var n;let s=tH.Z.deepCopy(e),r=t.filter(e=>l.includes(e.id));s.scheme.configuration.geometry.value=void 0,s.scheme.configuration.geometry.values=l;let o={...s.scheme.configuration,dimension:null!==(n=r[0].summary.dimension)&&void 0!==n?n:3,geometry:{...s.scheme.configuration.geometry,done:!0},run:{...s.scheme.configuration.run,done:!1}};await W.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration"],value:o}]),a.mutateOneSimulation(s),i(r)}catch(e){(0,R.lt)(li.update,e)}},ls=e=>{let{loadedGeometries:t,geometries:l,simulation:i,setGeometries:a,swr:n}=e,s=(0,c.useMemo)(()=>i.scheme.configuration.geometry.multiple,[i]),o=(0,c.useMemo)(()=>i.scheme.configuration.geometry.n,[i]),u=(0,c.useMemo)(()=>i.scheme.configuration.geometry.value,[i]),d=(0,c.useMemo)(()=>i.scheme.configuration.geometry.values,[i]);(0,E.Z)(()=>{s||u||!l.length?s&&!d&&l.length&&ln(i,t,l.map(e=>e.id),a,n):la(i,t,l[0].id,a,n)},[s,u,d,t,l,n]);let m=(0,c.useCallback)(e=>{s?ln(i,t,e,a,n):la(i,t,e,a,n)},[s,t,i,a,n]),h=(0,c.useMemo)(()=>(0,r.jsx)("div",{className:ll().geometriesList,children:(0,r.jsx)(t_.Z,{mode:s?"multiple":void 0,options:t.map(e=>({value:e.id,label:e.name})),value:s?d:u,onChange:m})}),[s,u,d,m,t]);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(N.Z,{size:"small",children:(0,r.jsx)(y.Z.Text,{children:"When changing the simulation domain, you might lose your topological entity assignments"})}),(0,r.jsxs)(N.Z,{size:"small",children:[(0,r.jsx)(y.Z.Text,{strong:!0,children:"Select a simulation domain"}),o?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("br",{}),(0,r.jsxs)(y.Z.Text,{children:[o," geometries needed"]})]}):null]}),h,i.scheme.configuration.geometry.meshable&&(0,r.jsx)(le,{simulation:{id:i.id,scheme:i.scheme},swr:{mutateOneSimulation:n.mutateOneSimulation}})]})},lr={update:"Unable to delete material"},lo=async(e,t,l,i)=>{try{let a=tH.Z.deepCopy(e),n=a.scheme.configuration.materials,s=n.values[t];s.selected.forEach(e=>{l(tx(e))}),n.values=[...n.values.slice(0,t),...n.values.slice(t+1)];let r={...n,done:!!n.values.length};await W.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","materials"],value:r}]),i.mutateOneSimulation(a)}catch(e){throw(0,R.lt)(lr.update,e),e}},lu=e=>{let{simulation:t,index:l,swr:i}=e,[a,n]=(0,c.useState)(!1),{dispatch:s}=(0,c.useContext)(F),o=(0,c.useMemo)(()=>t.scheme.configuration.materials,[t]),u=(0,c.useMemo)(()=>o.values[l],[o,l]),d=(0,c.useCallback)(async()=>{n(!0);try{await lo(t,l,s,i)}finally{n(!1)}},[t,l,i,s]);return(0,r.jsx)(z.m1,{loading:a,text:(0,r.jsxs)(r.Fragment,{children:["Are you sure you want to delete the material"," ",(0,r.jsx)(y.Z.Text,{strong:!0,children:u.material.label})]}),onDelete:d})},ld=e=>{let{geometries:t,simulation:l,material:i,index:a,swr:n,_onEdit:s}=e,[o,u]=(0,c.useState)(!0),{dispatch:d}=(0,c.useContext)(F),m=(0,c.useCallback)(()=>{d(tu());let e=i.geometry,l=t.find(t=>t.id===e);d(tm(null==l?void 0:l.summary.uuid));let a=i.selected;null==a||a.forEach(e=>{d(ty(e))})},[t,i,d]),h=(0,c.useCallback)(()=>{o&&d(td())},[o,d]),p=(0,c.useCallback)(()=>{u(!1),s(a),setTimeout(()=>u(!0),500)},[a,s]);return(0,r.jsx)(N.Z,{className:"".concat(eo().textAlignCenter," ").concat(ll().listItem),hoverable:!0,onMouseEnter:m,onMouseLeave:h,actions:[(0,r.jsx)(z.w6,{onEdit:p},"edit"),(0,r.jsx)(lu,{index:a,simulation:l,swr:n},"delete")],children:(0,r.jsx)(y.Z.Text,{strong:!0,className:eo().textAlignCenter,children:i.material.label})})},lc=e=>{var t;let{geometries:l,simulation:i,swr:a,onEdit:n}=e,s=(0,c.useMemo)(()=>i.scheme.configuration.materials,[i]);return(0,r.jsx)(r.Fragment,{children:null===(t=s.values)||void 0===t?void 0:t.map((e,t)=>(0,r.jsx)(ld,{geometries:l,simulation:i,material:e,index:t,swr:a,_onEdit:n},e.uuid)).filter(e=>e)})};var lm=l(85265),lh=l(51904),lp=l(13982),ly=l(14618),lx=l(94668),lv=l(68795);let lg=e=>{let{color:t,setFilter:l}=e,i=(0,c.useCallback)(()=>{l(t)},[t,l]);return(0,r.jsx)(m.Z,{title:"Color",children:(0,r.jsx)(x.ZP,{style:{backgroundColor:tH.Z.rgbToHex(t)},onClick:i,children:" "})},JSON.stringify(t))},lf=e=>{let{colors:t,setFilter:l}=e,i=(0,c.useCallback)(()=>{l(void 0)},[l]);return(0,r.jsx)(r.Fragment,{children:t.length>1&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(m.Z,{title:"Reset",children:(0,r.jsx)(x.ZP,{icon:(0,r.jsx)(ee.Z,{}),onClick:i})}),t.map(e=>(0,r.jsx)(lg,{color:e,setFilter:l},JSON.stringify(e)))]})})},lb=e=>{let{element:t,alreadySelected:l,filter:i,search:a,context:n}=e,s=(0,c.useCallback)(e=>{var t,l,n;return(!i||i.r===(null===(t=e.color)||void 0===t?void 0:t.r)&&i.g===(null===(l=e.color)||void 0===l?void 0:l.g)&&i.b===(null===(n=e.color)||void 0===n?void 0:n.b))&&(!a||!e.name||!!e.name.includes(a))},[i,a]),o=(0,c.useCallback)(e=>{n.dispatch(th(e))},[n]),u=(0,c.useCallback)(()=>{n.dispatch(tp())},[n]),d=(0,c.useCallback)(e=>{n.selected.find(t=>t.uuid===e.uuid)?n.dispatch(tx(e)):n.dispatch(ty(e))},[n]),m=(0,c.useMemo)(()=>{var e;return n.selected.find(e=>e.uuid===t.uuid)?"#EE9817":(null===(e=n.highlighted)||void 0===e?void 0:e.uuid)===t.uuid?"#FAD114":"transparent"},[t,n]),h=(0,c.useMemo)(()=>{var e;return n.selected.find(e=>e.uuid===t.uuid)?"rgba(238, 152, 23, 0.3)":(null===(e=n.highlighted)||void 0===e?void 0:e.uuid)===t.uuid?"rgba(250, 209, 20, 0.3)":"transparent"},[t,n]),p=(0,c.useCallback)(()=>o({uuid:t.uuid,label:t.label}),[t,o]),y=(0,c.useCallback)(()=>d({uuid:t.uuid,label:t.label}),[t,d]);return s(t)?(0,r.jsx)(N.Z,{style:{marginBottom:"10px"},bodyStyle:{position:"relative",padding:"10px 10px 10px 40px",borderWidth:"2px",borderStyle:"solid",borderColor:m,backgroundColor:h},onMouseEnter:p,onMouseLeave:u,onClick:y,children:(0,r.jsxs)(O.Z,{direction:"vertical",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{style:{position:"absolute",left:"-2px",top:"-2px",bottom:"-2px",width:"30px",backgroundColor:tH.Z.rgbToRgba(t.color,1)}}),t.name]}),null==l?void 0:l.map(e=>{if(e.selected.find(e=>e.uuid===t.uuid))return(0,r.jsx)(lh.Z,{color:tH.Z.stringToColor(e.label),children:e.label},t.uuid)})]})}):null},lj=e=>{var t;let{geometry:l,alreadySelected:i,updateSelected:a}=e,[n,s]=(0,c.useState)([]),[o,u]=(0,c.useState)(),[d,h]=(0,c.useState)(),{type:p,highlighted:v,selected:g,dispatch:f}=(0,c.useContext)(F);(0,E.Z)(()=>a(g),[g],[a]),(0,E.Z)(()=>{var e;let t=[];p&&(null===(e=l.summary[p])||void 0===e||e.forEach(e=>{if(e.color){let l=t.find(t=>t.r===e.color.r&&t.g===e.color.g&&t.b===e.color.b);l||t.push(e.color)}})),s(t)},[l,p]);let b=(0,c.useCallback)(()=>{var e;null===(e=l.summary[p])||void 0===e||e.forEach(e=>{var t,l,i;(!o||o&&o.r===(null===(t=e.color)||void 0===t?void 0:t.r)&&o.g===(null===(l=e.color)||void 0===l?void 0:l.g)&&o.b===(null===(i=e.color)||void 0===i?void 0:i.b))&&f(ty({uuid:e.uuid,label:e.label}))})},[l,p,o,f]),j=(0,c.useCallback)(()=>{var e;null===(e=l.summary[p])||void 0===e||e.forEach(e=>{var t,l,i;(!o||o&&o.r===(null===(t=e.color)||void 0===t?void 0:t.r)&&o.g===(null===(l=e.color)||void 0===l?void 0:l.g)&&o.b===(null===(i=e.color)||void 0===i?void 0:i.b))&&f(tx({uuid:e.uuid,label:e.label}))})},[l,p,o,f]),w=(0,c.useCallback)(()=>{var e;null===(e=l.summary[p])||void 0===e||e.forEach(e=>{var t,l,i;(!o||o&&o.r===(null===(t=e.color)||void 0===t?void 0:t.r)&&o.g===(null===(l=e.color)||void 0===l?void 0:l.g)&&o.b===(null===(i=e.color)||void 0===i?void 0:i.b))&&g.find(t=>t.uuid===e.uuid)?f(tx({uuid:e.uuid,label:e.label})):f(ty({uuid:e.uuid,label:e.label}))})},[l,g,p,o,f]),Z=(0,c.useCallback)(e=>{let t=e.target.value;h(t)},[]);return(0,r.jsxs)(N.Z,{size:"small",className:eo().noBorderBottom,children:[(0,r.jsxs)(O.Z,{direction:"vertical",className:eo().fullWidth,children:[(0,r.jsx)(y.Z.Text,{strong:!0,children:"Filters"}),(0,r.jsxs)(O.Z,{direction:"horizontal",wrap:!0,children:[(0,r.jsx)(lf,{colors:n,setFilter:u}),(0,r.jsx)(m.Z,{title:"Select all",children:(0,r.jsx)(x.ZP,{icon:(0,r.jsx)(lp.Z,{}),onClick:b})}),(0,r.jsx)(m.Z,{title:"Unselect all",children:(0,r.jsx)(x.ZP,{icon:(0,r.jsx)(ly.Z,{}),onClick:j})}),(0,r.jsx)(m.Z,{title:"Swap",children:(0,r.jsx)(x.ZP,{icon:(0,r.jsx)(lx.Z,{}),onClick:w})})]}),(0,r.jsx)(eg.Z,{placeholder:"Search",value:d,onChange:Z,suffix:(0,r.jsx)(lv.Z,{className:eo().textLight})})]}),(0,r.jsx)("div",{className:eo().fullWidth,style:{marginTop:"20px"},children:p?null===(t=l.summary[p])||void 0===t?void 0:t.map(e=>(0,r.jsx)(lb,{element:e,alreadySelected:i,filter:o,search:d,context:{selected:g,highlighted:v,dispatch:f}},e.uuid)):null})]})};var lw=l(51158),lZ=l(13520),lC=l(27588);let lk=e=>{let{onSelect:t}=e,[l,i]=(0,c.useState)(),[a,n]=(0,c.useState)(),[s,o]=(0,c.useState)(),[u,d]=(0,c.useState)(),m=(0,c.useMemo)(()=>Object.keys(lC.E),[]),y=(0,c.useCallback)(()=>i(!0),[]),v=(0,c.useCallback)(()=>i(!1),[]),g=(0,c.useCallback)(e=>{let{key:t}=e,l=lC.E[t];n({key:t,children:l.children}),o(void 0),d(void 0)},[]),f=(0,c.useCallback)(e=>{let{key:t}=e,l=lC.E[a.key],i=l.children.find(e=>e.key===t);o({key:t}),d(i)},[a]),b=(0,c.useCallback)(()=>{t(u),i(!1)},[u,t]);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(x.ZP,{icon:(0,r.jsx)(lZ.Z,{}),onClick:y,className:eo().fullWidth,children:"Pick a material"}),(0,r.jsx)(tF.Z,{open:l,title:"Material database",onCancel:v,onOk:b,okText:"Choose",okButtonProps:{disabled:!u},width:"50%",children:(0,r.jsx)(h.Z,{children:(0,r.jsx)(h.Z.Content,{children:(0,r.jsxs)(O.Z,{style:{alignItems:"stretch"},children:[(0,r.jsx)(p.Z,{mode:"inline",items:m.map(e=>({key:e,label:lC.E[e].label})),onClick:g}),(0,r.jsx)(p.Z,{mode:"inline",items:null==a?void 0:a.children.map(e=>({key:e.key,label:e.label})),selectedKeys:(null==s?void 0:s.key)?[null==s?void 0:s.key]:[],onClick:f}),u&&(0,r.jsx)(lw.ZP,{itemLayout:"vertical",children:u.children.map(e=>(0,r.jsxs)(lw.ZP.Item,{children:[e.label,": ",e.symbol," = ",e.value]},e.label))})]})})})})]})},lS={material:"You need to define a material",selected:"You need to select a solid",update:"Unable to add material"},lP=async(e,t,l)=>{try{let i=tH.Z.deepCopy(t);i.uuid=(0,eX.Z)();let a=tH.Z.deepCopy(e),n=a.scheme.configuration.materials;n.values=[...n.values||[],i];let s={...n,done:!0};await W.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","materials"],value:s}]),await W.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","run"],value:{...a.scheme.configuration.run,done:!1}}]),l.mutateOneSimulation(a)}catch(e){throw(0,R.lt)(lS.update,e),e}},lE=e=>{let{simulation:t,material:l,swr:i,onError:a,onClose:n}=e,[s,o]=(0,c.useState)(!1),u=(0,c.useCallback)(async()=>{o(!0);try{var e;if(!l.material){a(lS.material),o(!1);return}if(!(null===(e=l.selected)||void 0===e?void 0:e.length)){a(lS.selected),o(!1);return}a(),await lP(t,l,i),o(!1),n()}catch(e){o(!1)}},[t,l,i,a,n]);return(0,r.jsx)(z.HS,{loading:s,needMargin:!0,onAdd:u,children:"Add"})},lM={material:"You need to define a material",selected:"You need to select a solid",update:"Unable to edit material"},lN=async(e,t,l)=>{try{let i=tH.Z.deepCopy(e),a=i.scheme.configuration.materials,n=a.values.findIndex(e=>e.uuid===t.uuid);a.values=[...a.values.slice(0,n),t,...a.values.slice(n+1)];let s={...a};await W.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","materials"],value:s}]),l.mutateOneSimulation(i)}catch(e){throw(0,R.lt)(lM.update,e),e}},lO=e=>{let{simulation:t,material:l,swr:i,onError:a,onClose:n}=e,[s,o]=(0,c.useState)(!1),u=(0,c.useCallback)(async()=>{o(!0);try{var e;if(!l.material){a(lM.material),o(!1);return}if(!(null===(e=l.selected)||void 0===e?void 0:e.length)){a(lM.selected),o(!1);return}a(),await lN(t,l,i),o(!1),n()}catch(e){o(!1)}},[t,l,i,a,n]);return(0,r.jsx)(z.w6,{loading:s,primary:!0,needMargin:!0,onEdit:u,children:"Edit"})},lT=e=>{let{child:t,index:l,value:i,_onMaterialChange:a}=e,n=(0,c.useCallback)(e=>{a(t,l,e)},[t,l,a]);return(0,r.jsx)(t8,{label:t.name,defaultValue:null!=i?i:String(t.default),unit:t.unit,onValueChange:n},t.name)},lA=e=>{var t,l,i,a,n,s,o;let{visible:u,geometries:d,simulation:m,material:h,swr:p,onClose:v}=e,[g,f]=(0,c.useState)(),[b,j]=(0,c.useState)(),[w,C]=(0,c.useState)(),[k,S]=(0,c.useState)(),{dispatch:P}=(0,c.useContext)(F),M=(0,c.useMemo)(()=>m.scheme.configuration.materials,[m]);(0,E.Z)(()=>{var e;P(tm(null===(e=d[0])||void 0===e?void 0:e.summary.uuid)),C(null==h?void 0:h.geometry)},[d,h],[P]),(0,E.Z)(()=>{!u&&b&&j(void 0)},[u,b]),(0,E.Z)(()=>{var e;u&&!b&&h?j(h):!u||b||h||j({material:{label:"Default",children:(null==M?void 0:M.children.map(e=>({label:e.label,symbol:e.name,value:e.default})))||[]},geometry:null===(e=d[0])||void 0===e?void 0:e.id})},[u,d,M,b]),(0,E.Z)(()=>{var e;let t=null==M?void 0:null===(e=M.values)||void 0===e?void 0:e.map(e=>{if(e.uuid!==(null==h?void 0:h.uuid))return{label:e.material.label,selected:e.selected}}).filter(e=>e);f(t||[])},[m,h,M]);let T=(0,c.useCallback)(e=>{j(t=>({...t,material:e}))},[]),A=(0,c.useCallback)((e,t,l)=>{j(i=>({...i,material:{label:"Custom",children:[...i.material.children.slice(0,t),{label:e.label,symbol:e.name,value:l},...i.material.children.slice(t+1)]}}))},[]),L=(0,c.useCallback)(e=>{j(t=>({...t,selected:e}))},[]),R=(0,c.useCallback)(e=>{C(e);let t=d.find(t=>t.id===e);P(tm(t.summary.uuid)),j(t=>({...t,geometry:e}))},[d,P]),I=(0,c.useCallback)(()=>{j(void 0),v()},[v]);return(0,r.jsx)(lm.Z,{className:el().subPanel,title:"Material",placement:"left",closable:!1,open:u,mask:!1,maskClosable:!1,width:300,extra:(0,r.jsx)(x.ZP,{type:"text",icon:(0,r.jsx)(ee.Z,{}),onClick:I}),footer:(0,r.jsxs)("div",{style:{display:"flex",justifyContent:"flex-end"},children:[(0,r.jsx)(z.Lw,{onCancel:I}),h?(0,r.jsx)(lO,{material:{uuid:null!==(i=null==b?void 0:b.uuid)&&void 0!==i?i:h.uuid,material:null!==(a=null==b?void 0:b.material)&&void 0!==a?a:h.material,geometry:null!==(n=null==b?void 0:b.geometry)&&void 0!==n?n:h.geometry,selected:null!==(s=null==b?void 0:b.selected)&&void 0!==s?s:h.selected},simulation:{id:m.id,scheme:m.scheme},swr:{mutateOneSimulation:p.mutateOneSimulation},onError:S,onClose:I}):(0,r.jsx)(lE,{material:{material:null==b?void 0:b.material,geometry:null==b?void 0:b.geometry,selected:null==b?void 0:b.selected},simulation:{id:m.id,scheme:m.scheme},swr:{mutateOneSimulation:p.mutateOneSimulation},onError:S,onClose:I})]}),children:(0,r.jsxs)(O.Z,{direction:"vertical",className:eo().fullWidth,children:[(0,r.jsx)(N.Z,{size:"small",children:(0,r.jsxs)(O.Z,{direction:"vertical",className:eo().fullWidth,children:[(0,r.jsx)(lk,{onSelect:T}),(0,r.jsxs)(y.Z.Text,{children:["Material: ",null!==(o=null==b?void 0:null===(t=b.material)||void 0===t?void 0:t.label)&&void 0!==o?o:"default"]}),null==M?void 0:null===(l=M.children)||void 0===l?void 0:l.map((e,t)=>{var l,i;let a=null==b?void 0:null===(l=b.material)||void 0===l?void 0:null===(i=l.children)||void 0===i?void 0:i.find(t=>t.symbol===e.name);return(0,r.jsx)(lT,{child:e,index:t,value:null==a?void 0:a.value,_onMaterialChange:A},e.name)})]})}),(0,r.jsx)(tD.Z,{items:d.map(e=>({key:e.id,label:e.name,children:(0,r.jsx)(lj,{geometry:e,alreadySelected:g,updateSelected:L})})),activeKey:w,onChange:R}),k&&(0,r.jsxs)(y.Z.Text,{children:[(0,r.jsx)(Z.Z,{style:{color:"red"}})," ",k]})]})})},lL=e=>{let{geometries:t,simulation:l,swr:i,setVisible:a}=e,[n,s]=(0,c.useState)(),[o,u]=(0,c.useState)(!1),{dispatch:d}=(0,c.useContext)(F),m=(0,c.useMemo)(()=>l.scheme.configuration.materials,[l]);(0,E.Z)(()=>{var e;(null===(e=t[0])||void 0===e?void 0:e.summary)&&d(tc(2===t[0].summary.dimension?"faces":"solids"))},[t],[d]);let p=(0,c.useCallback)(()=>{s(void 0),u(!0),a(!1),d(tu())},[d,a]),y=(0,c.useCallback)(e=>{let t=m.values[e];s(t),u(!0),a(!1),d(tu())},[m,d,a]),x=(0,c.useCallback)(()=>{d(td()),u(!1),s(void 0),a(!0)},[d,a]);return t.length?(0,r.jsx)(h.Z,{children:(0,r.jsx)(h.Z.Content,{children:(0,r.jsxs)(N.Z,{size:"small",children:[(0,r.jsx)(z.HS,{onAdd:p,fullWidth:!0,primary:!1,children:"Add material"}),(0,r.jsx)(lc,{geometries:t.map(e=>({id:e.id,summary:e.summary})),simulation:{id:l.id,scheme:l.scheme},swr:i,onEdit:y}),(0,r.jsx)(lA,{visible:o,geometries:t.map(e=>({id:e.id,name:e.name,summary:e.summary})),simulation:{id:l.id,scheme:l.scheme},material:n&&{uuid:n.uuid,material:n.material,geometry:n.geometry,selected:n.selected},swr:{mutateOneSimulation:i.mutateOneSimulation},onClose:x})]})})}):(0,r.jsx)(M.Z.Simple,{})};var lz=l(15045);let lR={update:"Unable to update simulation"},lI=(e,t,l)=>(0,r.jsx)(t8,{label:t.label2D||t.label,defaultValue:null!==(a=t.value)&&void 0!==a?a:t.default,onValueChange:l,unit:t.unit},e),l_=(e,t,l)=>{var i;return(0,r.jsx)(ev.Z,{layout:"vertical",children:(0,r.jsx)(ev.Z.Item,{label:t.label2D||t.label,children:(0,r.jsx)(t_.Z,{options:null===(i=t.options)||void 0===i?void 0:i.map(e=>({label:e.label,value:null!==(n=e.value2D)&&void 0!==n?n:e.value})),defaultValue:t.value||t.default2D||t.default,onChange:l})})},e)},lF=(e,t,l)=>(0,r.jsx)(ev.Z,{layout:"horizontal",children:(0,r.jsx)(ev.Z.Item,{label:t.label2D||t.label,children:(0,r.jsx)(t3.Z,{defaultChecked:t.value,onChange:l})})},e),lD=(e,t,l)=>(0,r.jsx)(t8,{label:t.label,defaultValue:null!==(s=t.value)&&void 0!==s?s:t.default,onValueChange:l,unit:t.unit},e),lU=(e,t,l)=>(0,r.jsx)(ev.Z,{layout:"vertical",children:(0,r.jsx)(ev.Z.Item,{label:t.label,children:(0,r.jsx)(t_.Z,{options:t.options,defaultValue:t.value||t.default,onChange:l})})},e),lV=(e,t,l)=>(0,r.jsx)(ev.Z,{layout:"horizontal",children:(0,r.jsx)(ev.Z.Item,{label:t.label,children:(0,r.jsx)(t3.Z,{defaultChecked:t.value,onChange:l})})},e),lB=async(e,t)=>{try{let l=tH.Z.deepCopy(e),i=l.scheme.configuration.parameters,a={...i,done:!0};await W.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","parameters"],value:a}]),await W.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","run"],value:{...l.scheme.configuration.run,done:!1}}]),t.mutateOneSimulation(l)}catch(e){(0,R.lt)(lR.update,e)}},lW=async(e,t,l,i,a)=>{try{let n=tH.Z.deepCopy(e),s=n.scheme.configuration.parameters,r=s[t];r.children[l].value=i;let o={...s,done:!0};await W.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","parameters"],value:o}]),await W.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","run"],value:{...n.scheme.configuration.run,done:!1}}]),a.mutateOneSimulation(n)}catch(e){(0,R.lt)(lR.update,e)}},lH=e=>{let{simulation:t,dimension:l,child:i,pkey:a,index:n,swr:s}=e,r=(0,c.useCallback)(e=>lW(t,a,n,e,s),[t,a,n,s]),o=(0,c.useCallback)(e=>lW(t,a,n,e.target.checked,s),[t,a,n,s]);if(2===l){if(i.only3D);else if("formula"===i.htmlEntity)return lI(a+"&"+n,i,r);else if("select"===i.htmlEntity)return l_(a+"&"+n,i,r);else if("checkbox"===i.htmlEntity)return lF(a+"&"+n,i,o);return null}return"formula"===i.htmlEntity?lD(a+"&"+n,i,r):"select"===i.htmlEntity?lU(a+"&"+n,i,r):"checkbox"===i.htmlEntity?lV(a+"&"+n,i,o):null},lG=e=>{let{simulation:t,dimension:l,pkey:i,parameter:a,swr:n}=e,s=(0,c.useMemo)(()=>a.children.map((e,a)=>(0,r.jsx)(lH,{simulation:t,dimension:l,child:e,pkey:i,index:a,swr:n},i+"&"+e.label)),[t,l,i,a,n]);return(0,r.jsx)(N.Z,{size:"small",title:null==a?void 0:a.label,children:(0,r.jsx)(O.Z,{direction:"vertical",children:s})},i)},lY=e=>{let{simulation:t,swr:l}=e,i=(0,c.useMemo)(()=>null==t?void 0:t.scheme.configuration.parameters,[t]),a=(0,c.useMemo)(()=>null==t?void 0:t.scheme.configuration.dimension,[t]);(0,c.useEffect)(()=>{(null==i?void 0:i.done)||lB(t,l)},[t,i,l]);let n=(0,c.useMemo)(()=>Object.keys(i).map(e=>{if("index"===e||"title"===e||"done"==e)return null;let n=i[e];return n.advanced?null:(0,r.jsx)(lG,{simulation:t,dimension:a,pkey:e,parameter:n,swr:l},e)}).filter(e=>e),[t,a,i,l]),s=(0,c.useMemo)(()=>Object.keys(i).map(e=>{if("index"===e||"title"===e||"done"==e)return null;let n=i[e];return n.advanced?(0,r.jsx)(lG,{simulation:t,dimension:a,pkey:e,parameter:n,swr:l},e):null}).filter(e=>e),[t,a,i,l]);return(0,r.jsx)(h.Z,{children:(0,r.jsx)(h.Z.Content,{children:(0,r.jsxs)(O.Z,{direction:"vertical",children:[n,s.length?(0,r.jsx)(lz.Z,{children:(0,r.jsx)(lz.Z.Panel,{header:"Advanced",children:(0,r.jsx)(O.Z,{direction:"vertical",children:s})},"advanced")}):null]})})})},lJ=(e,t)=>e.map(e=>{let l=e.fileName.replace(new RegExp(t.prefixPattern),"").replace(new RegExp(t.suffixPattern),"");return{...e,number:+l}}),lX=(e,t)=>{let l=t.multiplicator;if(l){var i;let t=l.reduce((e,t)=>e[t],e);return null!==(i=t.value)&&void 0!==i?i:t.default}},lq={update:"Unable to update simulation"},lK=async(e,t,l)=>{try{let i=tH.Z.deepCopy(e),a=i.scheme.configuration.initialization;a.value={type:t},await W.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","initialization"],value:a}]),l.mutateOneSimulation(i)}catch(e){throw(0,R.lt)(lq.update,e),e}},l$=async(e,t,l,i)=>{try{var a;let n=await l1(e,l),s=tH.Z.deepCopy(t),r=s.scheme.configuration.initialization;r.value={...r.value,simulation:l,result:null==n?void 0:null===(a=n[0])||void 0===a?void 0:a.value},await W.Z.update({id:t.id},[{key:"scheme",type:"json",method:"set",path:["configuration","initialization"],value:r}]),i.mutateOneSimulation(s)}catch(e){throw(0,R.lt)(lq.update,e),e}},lQ=async(e,t,l,i)=>{try{let a=tH.Z.deepCopy(e),n=a.scheme.configuration.initialization;n.value={...n.value,number:+t,result:l.file},await W.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","initialization"],value:n}]),i.mutateOneSimulation(a)}catch(e){(0,R.lt)(lq.update,e)}},l0=async(e,t,l,i)=>{try{let a=tH.Z.deepCopy(e),n=a.scheme.configuration.initialization;n.value.values||(n.value.values=[]),n.value.values[t]=l,await W.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","initialization"],value:n}]),i.mutateOneSimulation(a)}catch(e){(0,R.lt)(lq.update,e)}},l1=async(e,t)=>{var l;let i=await W.Z.tasks({id:t}),a=e.find(e=>e.id===t),n=a.scheme.configuration,s=null==n?void 0:null===(l=n.run)||void 0===l?void 0:l.resultsFilter,r=[];return i.forEach(e=>{if(e.file&&"result"===e.file.type&&r.push({label:e.file.fileName,value:e.file.fileName,file:e.file.fileName}),e.files){if(s){let t=new RegExp(s.pattern),l=e.files.filter(e=>!t.test(e.fileName)).filter(e=>"result"===e.type),i=e.files.filter(e=>t.test(e.fileName)),a=lJ(i,s),o=a.map(e=>({number:e.number,fileName:e.fileName.replace(new RegExp(s.suffixPattern),"")})).filter((e,t,l)=>l.findIndex(t=>t.number===e.number)===t).sort((e,t)=>e.number-t.number),u=lX(n,s),d=o.map((e,t)=>{let l=u?e.number*u:t;return{label:String(Math.round(1e15*l)/1e15),value:e.fileName,file:e.fileName}});r.push(...l.map(e=>({label:e.fileName,value:e.fileName,file:e.fileName})).filter(e=>e)),r.push(...d)}else e.files.forEach(e=>{"result"===e.type&&r.push({label:e.fileName,value:e.fileName,file:e.fileName})})}}),r},l2=e=>{let{simulation:t,child:l,index:i,value:a,swr:n}=e,s=(0,c.useCallback)(e=>l0(t,i,e,n),[t,i,n]);return(0,r.jsx)(t8,{label:l.label,defaultValue:(null!=a?a:l.default).toString(),unit:l.unit,onValueChange:s})},l5=e=>{let{simulations:t,simulation:l,swr:i}=e,[a,n]=(0,c.useState)(!1),[s,o]=(0,c.useState)(),[u,d]=(0,c.useState)(),[m,p]=(0,c.useState)(),x=(0,c.useMemo)(()=>null==l?void 0:l.scheme.configuration.initialization,[l]),v=(0,c.useMemo)(()=>null==l?void 0:l.scheme.configuration.dimension,[l]),g=(0,c.useCallback)(e=>{let l=t.find(t=>t.id===e);d(l)},[t]);(0,E.Z)(()=>{var e,t;!s&&x.value&&o(x.value.type),!u&&(null===(e=x.value)||void 0===e?void 0:e.simulation)&&g(null===(t=x.value)||void 0===t?void 0:t.simulation)},[x,s,u],[g]),(0,E.Z)(()=>{u&&l1(t,u.id).then(e=>p(e))},[t,u]);let f=(0,c.useMemo)(()=>{let e=[{label:"None",value:"none"}];return x.coupling&&e.push({label:x.coupling.label,value:"coupling"}),x.direct&&e.push({label:x.direct.label,value:"direct"}),e},[x]),b=x.value,j=(0,c.useCallback)(async e=>{n(!0);try{await l$(t,l,e,i),g(e)}catch(e){}finally{n(!1)}},[t,l,i,g]),w=(0,c.useCallback)(async(e,t)=>{lQ(l,e,t,i)},[l,i]),Z=(0,c.useCallback)((e,t)=>(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(y.Z.Text,{children:"If you use coupling, the selected simulation mesh will be used, at least for the first iteration."}),(0,r.jsxs)(O.Z,{direction:"vertical",className:eo().fullWidth,style:{marginTop:"10px"},children:[(0,r.jsx)(t_.Z,{className:eo().fullWidth,options:e,placeholder:"Select a simulation",value:null==b?void 0:b.simulation,onChange:j}),a&&(0,r.jsx)(eA.Z,{}),(null==m?void 0:m.length)?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(y.Z.Text,{children:[null==t?void 0:t.name,":"]},"simulation"),(0,r.jsx)(t_.Z,{className:eo().fullWidth,options:m,placeholder:"Select a "+t.name,value:null==b?void 0:b.result,onChange:w})]}):(0,r.jsx)(y.Z.Text,{type:"danger",children:"No results, please select an other simulation."})]})]}),[b,m,a,j,w]),C=(0,c.useCallback)(e=>(0,r.jsx)(O.Z,{direction:"vertical",className:eo().fullWidth,children:e.children.map((e,t)=>{var a;if(2!==v||!e.only3D)return(0,r.jsx)(l2,{simulation:l,child:e,index:t,value:null==b?void 0:null===(a=b.values)||void 0===a?void 0:a[t],swr:i},e.label)})}),[b,v,l,i]),k=(0,c.useMemo)(()=>{let e={none:(0,r.jsx)("div",{})},i=x.coupling;if(null==i?void 0:i.compatibility){let a=t.map(e=>{let t=e.id===l.id||!i.compatibility.find(t=>t.algorithm===e.scheme.algorithm);return{label:e.name,value:e.id,disabled:t}}),n=i.compatibility.find(e=>{var t;return e.algorithm===(null==u?void 0:null===(t=u.scheme)||void 0===t?void 0:t.algorithm)}),s=null==n?void 0:n.filter;e.coupling=Z(a,s)}let a=x.direct;return(null==a?void 0:a.children)&&(e.direct=C(a)),e},[t,l,u,x,Z,C]),S=(0,c.useCallback)(async e=>{try{await lK(l,e,i),o(e)}catch(e){}},[l,i]);return(0,r.jsx)(h.Z,{children:(0,r.jsx)(h.Z.Content,{children:(0,r.jsxs)(N.Z,{size:"small",children:[(0,r.jsx)(t_.Z,{className:eo().fullWidth,style:{marginTop:"10px"},defaultValue:"none",value:s,options:f,onChange:S}),k[s||"none"]]})})})},l4={update:"Unable to delete boundary condition"},l3=async(e,t,l,i,a)=>{try{let n=tH.Z.deepCopy(e),s=n.scheme.configuration.boundaryConditions,r=s[t],o=r.values[l];o.selected.forEach(e=>{i(tx(e))}),r.values=[...r.values.slice(0,l),...r.values.slice(l+1)];let u=!1;Object.keys(s).forEach(e=>{var t;if("index"===e||"title"===e||"done"===e)return;let l=s[e];(null===(t=l.values)||void 0===t?void 0:t.length)&&(u=!0)});let d={...s,done:u};await W.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","boundaryConditions"],value:d}]),a.mutateOneSimulation(n)}catch(e){throw(0,R.lt)(l4.update,e),e}},l8=e=>{let{type:t,index:l,simulation:i,swr:a}=e,[n,s]=(0,c.useState)(!1),{dispatch:o}=(0,c.useContext)(F),u=(0,c.useMemo)(()=>i.scheme.configuration.boundaryConditions,[i]),d=(0,c.useMemo)(()=>u[t],[u,t]),m=(0,c.useMemo)(()=>d.values[l],[d,l]),h=(0,c.useCallback)(async()=>{s(!0);try{await l3(i,t,l,o,a)}finally{s(!1)}},[i,t,l,a,o]);return(0,r.jsx)(z.m1,{loading:n,onDelete:h,text:(0,r.jsxs)(r.Fragment,{children:["Are you sure you want to delete the condition"," ",(0,r.jsx)(y.Z.Text,{strong:!0,children:null==m?void 0:m.name}),"?"]})})},l6=e=>{let{geometries:t,simulation:l,boundaryCondition:i,index:a,type:n,swr:s,_onEdit:o}=e,[u,d]=(0,c.useState)(!0),{dispatch:m}=(0,c.useContext)(F),h=(0,c.useCallback)(()=>{m(tu());let e=i.geometry,l=t.find(t=>t.id===e);m(tm(null==l?void 0:l.summary.uuid));let a=i.selected;null==a||a.forEach(e=>{m(ty(e))})},[t,i,m]),p=(0,c.useCallback)(()=>{u&&m(td())},[u,m]),x=(0,c.useCallback)(()=>{d(!1),o(n,a),setTimeout(()=>d(!0),500)},[a,n,o]);return(0,r.jsxs)(N.Z,{className:ll().listItem,hoverable:!0,onMouseEnter:h,onMouseLeave:p,actions:[(0,r.jsx)(z.w6,{onEdit:x},"edit"),(0,r.jsx)(l8,{simulation:{id:l.id,scheme:l.scheme},type:n,index:a,swr:{mutateOneSimulation:s.mutateOneSimulation}},"delete")],children:[(0,r.jsx)(y.Z.Text,{strong:!0,children:i.name})," ",(0,r.jsxs)(y.Z.Text,{children:["(",i.type.label,")"]})]})},l7=e=>{let{geometries:t,simulation:l,swr:i,onEdit:a}=e,n=(0,c.useMemo)(()=>l.scheme.configuration.boundaryConditions,[l]);return(0,r.jsx)(r.Fragment,{children:Object.keys(n).map(e=>{var s;if("index"===e||"title"===e||"done"===e)return;let o=n[e];return null===(s=o.values)||void 0===s?void 0:s.map((n,s)=>(0,r.jsx)(l6,{geometries:t,simulation:l,boundaryCondition:n,index:s,type:e,swr:i,_onEdit:a},n.uuid))}).filter(e=>e)})};var l9=l(78045);let ie={name:"You need to define a name",type:"You need to select a type",selected:"You need to select a face",update:"Unable to add boundary condition"},it=async(e,t,l)=>{try{let i={...t},a=i.type.key;i.uuid=(0,eX.Z)();let n=tH.Z.deepCopy(e),s=n.scheme.configuration.boundaryConditions,r=s[a];r.values=[...r.values||[],i];let o={...s,done:!0};await W.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","boundaryConditions"],value:o}]),await W.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","run"],value:{...n.scheme.configuration.run,done:!1}}]),l.mutateOneSimulation(n)}catch(e){throw(0,R.lt)(ie.update,e),e}},il=e=>{let{simulation:t,boundaryCondition:l,swr:i,onError:a,onClose:n}=e,[s,o]=(0,c.useState)(!1),u=(0,c.useCallback)(async()=>{o(!0);try{var e,s;if(!l.name){a(ie.name),o(!1);return}if(!(null===(e=l.type)||void 0===e?void 0:e.key)){a(ie.type),o(!1);return}if(!(null===(s=l.selected)||void 0===s?void 0:s.length)){a(ie.selected),o(!1);return}a(),await it(t,l,i),o(!1),n()}catch(e){o(!1)}},[t,l,i,a,n]);return(0,r.jsx)(z.HS,{loading:s,onAdd:u,needMargin:!0,children:"Add"})},ii={name:"You need to define a name",type:"You need to select a type",selected:"You need to select a face",update:"Unable to edit boundary condition"},ia=async(e,t,l,i)=>{try{let a=tH.Z.deepCopy(e),n=a.scheme.configuration.boundaryConditions,s=t.type.key,r=l.type.key;if(r!==s){let e=n[r],t=e.values.findIndex(e=>e.uuid===l.uuid);e.values=[...e.values.slice(0,t),...e.values.slice(t+1)]}if(r!==s){let e=n[s];e.values=[...e.values||[],t]}else{let e=n[s],l=e.values.findIndex(e=>e.uuid===t.uuid);e.values=[...e.values.slice(0,l),t,...e.values.slice(l+1)]}let o={...n};await W.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","boundaryConditions"],value:o}]),i.mutateOneSimulation(a)}catch(e){throw(0,R.lt)(ii.update,e),e}},is=e=>{let{simulation:t,boundaryCondition:l,oldBoundaryCondition:i,swr:a,onError:n,onClose:s}=e,[o,u]=(0,c.useState)(!1),d=(0,c.useCallback)(async()=>{u(!0);try{var e,r;if(!l.name){n(ii.name),u(!1);return}if(!(null===(e=l.type)||void 0===e?void 0:e.key)){n(ii.type),u(!1);return}if(!(null===(r=l.selected)||void 0===r?void 0:r.length)){n(ii.selected),u(!1);return}n(),await ia(t,l,i,a),u(!1),s()}catch(e){u(!1)}},[t,l,i,a,n,s]);return(0,r.jsx)(z.w6,{loading:o,onEdit:d,primary:!0,needMargin:!0,children:"Edit"})},ir=e=>{let{boundaryCondition:t,index:l,value:i,checked:a,_onValueChange:n,_onCheckedChange:s}=e,o=(0,c.useCallback)(e=>n(l,e),[l,n]),u=(0,c.useCallback)(e=>s(l,e),[l,s]);return(0,r.jsx)(t8,{style:{marginBottom:"10px"},label:t.label,defaultValue:i,defaultChecked:a,onValueChange:o,onCheckedChange:u,unit:t.unit})},io=e=>{var t,l,i,a,n,s,o;let{visible:u,geometries:d,simulation:m,boundaryCondition:h,swr:p,onClose:v}=e,[g,f]=(0,c.useState)([]),[b,j]=(0,c.useState)([]),[w,C]=(0,c.useState)(),[k,S]=(0,c.useState)(),[P,M]=(0,c.useState)(),[T,A]=(0,c.useState)(),{dispatch:L}=(0,c.useContext)(F),R=(0,c.useMemo)(()=>m.scheme.configuration.boundaryConditions,[m]),I=(0,c.useMemo)(()=>m.scheme.configuration.dimension,[m]);(0,E.Z)(()=>{var e;L(tm(null===(e=d[0])||void 0===e?void 0:e.summary.uuid)),M(null==h?void 0:h.geometry)},[d,h],[L]),(0,E.Z)(()=>{!u&&k&&S(void 0)},[u,k]),(0,E.Z)(()=>{let e=Object.keys(R).map(e=>{if("index"===e||"title"===e||"done"===e)return;let t=R[e];return{key:e,label:t.label,children:t.children,values:t.values}}).filter(e=>e);j(e)},[R]),(0,E.Z)(()=>{let e=null==b?void 0:b.map(e=>{var t;return null===(t=e.values)||void 0===t?void 0:t.length}).filter(e=>e).reduce((e,t)=>e+t,0);C(e)},[b]),(0,E.Z)(()=>{u&&!k&&h?S(h):!u||k||h||void 0===w||S(e=>{var t;return{...e,name:"Boundary condition "+(w+1),geometry:null===(t=d[0])||void 0===t?void 0:t.id}})},[u,h,k,w]),(0,E.Z)(()=>{let e=Object.keys(R).map(e=>{var t;if("index"===e||"title"===e||"done"===e)return;let l=R[e];return null==l?void 0:null===(t=l.values)||void 0===t?void 0:t.map(e=>{if(e.uuid!==(null==h?void 0:h.uuid))return{label:e.name,selected:e.selected}}).filter(e=>e)}).flat().filter(e=>e);f(e)},[R,h]);let _=(0,c.useCallback)(e=>{let t=e.target.value;S(e=>({...e,name:t}))},[]),D=(0,c.useCallback)(e=>{var t;let l=e.target.value,i=b.find(e=>e.key===l),a=R[l],n=null===(t=a.children)||void 0===t?void 0:t.map(e=>({checked:!0,value:e.default}));S(e=>({...e,type:{key:i.key,label:i.label,children:i.children},values:n}))},[R,b]),U=(0,c.useCallback)((e,t)=>{S(l=>({...l,values:[...l.values.slice(0,e),{checked:l.values[e].checked,value:t},...l.values.slice(e+1)]}))},[]),V=(0,c.useCallback)((e,t)=>{S(l=>({...l,values:[...l.values.slice(0,e),{checked:t,value:l.values[e].value},...l.values.slice(e+1)]}))},[]),B=(0,c.useCallback)(e=>{S(t=>({...t,selected:e}))},[]),W=(0,c.useMemo)(()=>{var e;return(null==k?void 0:k.type)&&(null===(e=k.type)||void 0===e?void 0:e.children)?(0,r.jsx)(N.Z,{children:k.type.children.map((e,t)=>{if(2!==I||!e.only3D)return(0,r.jsx)(ir,{boundaryCondition:e,index:t,value:String(k.values[t].value),checked:k.type.children.length>1?k.values[t].checked:void 0,_onValueChange:U,_onCheckedChange:V},e.label)})}):null},[k,I,V,U]),H=(0,c.useCallback)(e=>{M(e);let t=d.find(t=>t.id===e);L(tm(null==t?void 0:t.summary.uuid)),S(t=>({...t,geometry:e}))},[d,L]),G=(0,c.useCallback)(()=>{S(void 0),v()},[v]);return(0,r.jsx)(lm.Z,{className:el().subPanel,title:"Boundary condition",placement:"left",closable:!1,open:u,mask:!1,maskClosable:!1,width:300,extra:(0,r.jsx)(x.ZP,{type:"text",icon:(0,r.jsx)(ee.Z,{}),onClick:G}),footer:(0,r.jsxs)("div",{style:{display:"flex",justifyContent:"flex-end"},children:[(0,r.jsx)(z.Lw,{onCancel:G}),h?(0,r.jsx)(is,{boundaryCondition:{uuid:null!==(l=null==k?void 0:k.uuid)&&void 0!==l?l:h.uuid,name:null!==(i=null==k?void 0:k.name)&&void 0!==i?i:h.name,type:null!==(a=null==k?void 0:k.type)&&void 0!==a?a:h.type,geometry:null!==(n=null==k?void 0:k.geometry)&&void 0!==n?n:h.geometry,selected:null!==(s=null==k?void 0:k.selected)&&void 0!==s?s:h.selected,values:null!==(o=null==k?void 0:k.values)&&void 0!==o?o:h.values},oldBoundaryCondition:{uuid:h.uuid,name:h.name,type:h.type,geometry:h.geometry,selected:h.selected,values:h.values},simulation:{id:m.id,scheme:m.scheme},swr:{mutateOneSimulation:p.mutateOneSimulation},onError:A,onClose:v}):(0,r.jsx)(il,{boundaryCondition:{name:null==k?void 0:k.name,type:null==k?void 0:k.type,geometry:null==k?void 0:k.geometry,selected:null==k?void 0:k.selected,values:null==k?void 0:k.values},simulation:{id:m.id,scheme:m.scheme},swr:{mutateOneSimulation:p.mutateOneSimulation},onError:A,onClose:v})]}),children:(0,r.jsxs)(O.Z,{direction:"vertical",className:eo().fullWidth,children:[(0,r.jsx)(N.Z,{size:"small",children:(0,r.jsx)(ev.Z,{layout:"vertical",children:(0,r.jsx)(ev.Z.Item,{label:(0,r.jsx)(y.Z.Text,{strong:!0,children:"Boundary condition name"}),children:(0,r.jsx)(eg.Z,{value:(null==k?void 0:k.name)||"",onChange:_,maxLength:50})})})}),(0,r.jsx)(N.Z,{size:"small",children:(0,r.jsx)(ev.Z,{layout:"vertical",children:(0,r.jsx)(ev.Z.Item,{label:(0,r.jsx)(y.Z.Text,{strong:!0,children:"Boundary condition type"}),children:(0,r.jsx)(l9.ZP.Group,{optionType:"button",buttonStyle:"solid",value:null==k?void 0:null===(t=k.type)||void 0===t?void 0:t.key,onChange:D,children:null==b?void 0:b.map(e=>(0,r.jsx)(l9.ZP.Button,{value:e.key,children:e.label},e.key))})})})}),W,(0,r.jsx)(tD.Z,{items:d.map(e=>({key:e.id,label:e.name,children:(0,r.jsx)(lj,{geometry:e,alreadySelected:g,updateSelected:B})})),activeKey:P,onChange:H}),T&&(0,r.jsxs)(y.Z.Text,{children:[(0,r.jsx)(Z.Z,{style:{color:"red"}})," ",T]})]})})},iu=e=>{let{simulation:t,geometries:l,swr:i,setVisible:a}=e,[n,s]=(0,c.useState)(),[o,u]=(0,c.useState)(!1),{dispatch:d}=(0,c.useContext)(F),m=(0,c.useMemo)(()=>t.scheme.configuration.boundaryConditions,[t]);(0,E.Z)(()=>{var e;(null===(e=l[0])||void 0===e?void 0:e.summary)&&d(tc(2===l[0].summary.dimension?"edges":"faces"))},[l],[d]);let p=(0,c.useCallback)(()=>{s(void 0),u(!0),a(!1),d(tu())},[d,a]),y=(0,c.useCallback)((e,t)=>{let l=m[e],i=l.values[t];s(i),u(!0),a(!1),d(tu())},[m,d,a]),x=(0,c.useCallback)(()=>{d(td()),u(!1),s(void 0),a(!0)},[d,a]);return l.length?(0,r.jsx)(h.Z,{children:(0,r.jsx)(h.Z.Content,{children:(0,r.jsxs)(N.Z,{size:"small",children:[(0,r.jsx)(z.HS,{onAdd:p,fullWidth:!0,primary:!1,children:"Add boundary condition"}),(0,r.jsx)(l7,{geometries:l.map(e=>({id:e.id,summary:e.summary})),simulation:{id:t.id,scheme:t.scheme},swr:{mutateOneSimulation:i.mutateOneSimulation},onEdit:y}),(0,r.jsx)(io,{visible:o,geometries:l.map(e=>({id:e.id,name:e.name,summary:e.summary})),simulation:{id:t.id,scheme:t.scheme},boundaryCondition:n&&{uuid:n.uuid,name:n.name,type:n.type,geometry:n.geometry,selected:n.selected,values:n.values},swr:{mutateOneSimulation:i.mutateOneSimulation},onClose:x})]})})}):(0,r.jsx)(M.Z.Simple,{})};var id=l(3363),ic=l(67841),im=l(36027),ih=l(57184);let ip={name:"You need to define a name",point:"You need to select a point",formula:"You need to define a formula",update:"Unable to update simulation"},iy=async(e,t,l)=>{try{let i=tH.Z.deepCopy(e),a=i.scheme.configuration.run,n=t.index;delete t.index,a.sensors[n]=t,await W.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","run"],value:a}]),l.mutateOneSimulation(i)}catch(e){throw(0,R.lt)(ip.update,e),e}},ix=e=>{let{simulation:t,sensor:l,onError:i,onClose:a,swr:n}=e,[s,o]=(0,c.useState)(),u=(0,c.useCallback)(async()=>{o(!0);try{if(!l.name){i(ip.name),o(!1);return}if(!l.point){i(ip.point),o(!1);return}if(!l.formula){i(ip.formula),o(!1);return}i(),await iy(t,l,n),o(!1),a()}catch(e){o(!1)}},[t,l,i,a,n]);return(0,r.jsx)(z.w6,{loading:s,primary:!0,needMargin:!0,onEdit:u,children:"Edit"})},iv={name:"You need to define a name",point:"You need to select a point",formula:"You need to define a formula",update:"Unable to update simulation"},ig=async(e,t,l)=>{try{let i=tH.Z.deepCopy(e),a=i.scheme.configuration.run,n={...a,sensors:[...a.sensors||[],t]};await W.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","run"],value:n}]),l.mutateOneSimulation(i)}catch(e){throw(0,R.lt)(iv.update,e),e}},ib=e=>{let{simulation:t,sensor:l,onError:i,onClose:a,swr:n}=e,[s,o]=(0,c.useState)(),u=(0,c.useCallback)(async()=>{o(!0);try{if(!l.name){i(iv.name),o(!1);return}if(!l.point){i(iv.point),o(!1);return}if(!l.formula){i(iv.formula),o(!1);return}i(),await ig(t,l,n),o(!1),a()}catch(e){o(!1)}},[t,l,i,a,n]);return(0,r.jsx)(z.HS,{loading:s,needMargin:!0,onAdd:u,children:"Add"})},ij=e=>{var t,l,i,a,n,s,o,u,d;let{visible:h,geometries:p,simulation:v,sensor:g,onClose:f,swr:b}=e,[j,w]=(0,c.useState)(),[C,k]=(0,c.useState)(),[S,P]=(0,c.useState)(),[M,T]=(0,c.useState)(),{point:A,dispatch:L}=(0,c.useContext)(F);(0,E.Z)(()=>{var e;L(tm(null===(e=p[0])||void 0===e?void 0:e.summary.uuid)),P(null==g?void 0:g.geometry)},[p,g],[L]),(0,E.Z)(()=>{L(tc("point"))},[L]),(0,E.Z)(()=>{if(!g){let e=v.scheme.configuration.run;k(t=>({...t,name:"Sensor "+(e.sensors?e.sensors.length+1:1)}))}},[v,g]),(0,E.Z)(()=>{g&&(k(g),L(tv({x:g.point.x,y:g.point.y,z:g.point.z})))},[g],[L]),(0,E.Z)(()=>{A&&k(e=>({...e,point:A}))},[A]);let R=(0,c.useCallback)(()=>{w(!1),L(td()),window.removeEventListener("click",R)},[L]),I=(0,c.useCallback)(()=>{j?R():(w(!0),L(tu()),setTimeout(()=>window.addEventListener("click",R),50))},[j,R,L]),_=(0,c.useCallback)(e=>{P(e);let t=p.find(t=>t.id===e);L(tm(t.summary.uuid)),k(t=>({...t,geometry:e}))},[p,L]),D=(0,c.useCallback)((e,t,l)=>{L(tv({x:e,y:t,z:l}))},[L]),U=(0,c.useCallback)(e=>{k(t=>({...t,formula:e}))},[]),V=(0,c.useCallback)(()=>{k(void 0),T(void 0),L(tv()),L(td()),f()},[L,f]),B=(0,c.useCallback)(e=>{k(t=>({...t,name:e.target.value}))},[]),W=(0,c.useCallback)(e=>D(+e,null!==(a=null==A?void 0:A.y)&&void 0!==a?a:0,null!==(n=null==A?void 0:A.z)&&void 0!==n?n:0),[A,D]),H=(0,c.useCallback)(e=>D(null!==(s=null==A?void 0:A.x)&&void 0!==s?s:0,+e,null!==(o=null==A?void 0:A.z)&&void 0!==o?o:0),[A,D]),G=(0,c.useCallback)(e=>D(null!==(u=null==A?void 0:A.x)&&void 0!==u?u:0,null!==(d=null==A?void 0:A.y)&&void 0!==d?d:0,+e),[A,D]);return(0,r.jsx)(lm.Z,{title:"Sensor",placement:"left",closable:!1,open:h,mask:!1,maskClosable:!1,width:300,extra:(0,r.jsx)(x.ZP,{type:"text",icon:(0,r.jsx)(ee.Z,{}),onClick:V}),footer:(0,r.jsxs)("div",{style:{display:"flex",justifyContent:"flex-end"},children:[(0,r.jsx)(z.Lw,{onCancel:V}),g?(0,r.jsx)(ix,{simulation:v,sensor:{...g,...C},onError:T,onClose:V,swr:b}):(0,r.jsx)(ib,{simulation:v,sensor:C,onError:T,onClose:V,swr:b})]}),children:(0,r.jsxs)(O.Z,{direction:"vertical",className:eo().fullWidth,children:[(0,r.jsxs)(N.Z,{size:"small",children:[(0,r.jsx)(y.Z.Text,{children:"Name"}),(0,r.jsx)(eg.Z,{value:null==C?void 0:C.name,onChange:B})]}),(0,r.jsxs)(N.Z,{size:"small",children:[(0,r.jsx)(tD.Z,{items:p.map(e=>({key:e.id,label:e.name})),activeKey:S,onChange:_}),(0,r.jsxs)(O.Z,{direction:"vertical",className:eo().fullWidth,children:[(0,r.jsxs)(O.Z,{className:eo().fullWidth,style:{justifyContent:"space-between"},children:[(0,r.jsx)(y.Z.Text,{children:"Point selection"}),(0,r.jsx)(m.Z,{title:"Pin in the geometry",children:(0,r.jsx)(x.ZP,{size:"small",type:j?"primary":"default",icon:(0,r.jsx)(ih.Z,{}),onClick:I})})]}),(0,r.jsx)(t8,{label:"X",defaultValue:null==C?void 0:null===(t=C.point)||void 0===t?void 0:t.x,onValueChange:W}),(0,r.jsx)(t8,{label:"Y",defaultValue:null==C?void 0:null===(l=C.point)||void 0===l?void 0:l.y,onValueChange:H}),(0,r.jsx)(t8,{label:"Z",defaultValue:null==C?void 0:null===(i=C.point)||void 0===i?void 0:i.z,onValueChange:G})]})]}),(0,r.jsx)(N.Z,{size:"small",className:eo().noBorderBottom,children:(0,r.jsx)(t8,{label:"Formula",defaultValue:null==C?void 0:C.formula,onValueChange:U})}),M&&(0,r.jsxs)(y.Z.Text,{children:[(0,r.jsx)(Z.Z,{style:{color:"red"}})," ",M]})]})})},iw={udpate:"Unable to update simulation"},iZ=async(e,t,l,i)=>{try{let a=tH.Z.deepCopy(e),n=a.scheme.configuration.run;l(tv()),n.sensors=[...n.sensors.slice(0,t),...n.sensors.slice(t+1)],await W.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","run"],value:n}]),i.mutateOneSimulation(a)}catch(e){throw(0,R.lt)(iw.udpate,e),e}},iC=e=>{let{simulation:t,index:l,swr:i}=e,[a,n]=(0,c.useState)(),{dispatch:s}=(0,c.useContext)(F),o=(0,c.useMemo)(()=>t.scheme.configuration.run,[t]),u=(0,c.useMemo)(()=>o.sensors[l],[l,o]),d=(0,c.useCallback)(async()=>{n(!0);try{await iZ(t,l,s,i)}finally{n(!1)}},[t,l,s,i]);return(0,r.jsx)(z.m1,{loading:a,text:(0,r.jsxs)(r.Fragment,{children:["Are you sure you want to delete the sensor"," ",(0,r.jsx)(y.Z.Text,{strong:!0,children:u.name})]}),onDelete:d})},ik=e=>{let{simulation:t,sensor:l,index:i,_onEdit:a,swr:n}=e,{dispatch:s}=(0,c.useContext)(F),o=(0,c.useCallback)(()=>{s(tu()),s(tv(l.point))},[l,s]),u=(0,c.useCallback)(()=>{s(td())},[s]),d=(0,c.useCallback)(()=>a({...l,index:i}),[l,i,a]);return(0,r.jsx)(N.Z,{className:"".concat(eo().textAlignCenter," ").concat(ll().listItem),hoverable:!0,onMouseEnter:o,onMouseLeave:u,actions:[(0,r.jsx)(z.w6,{onEdit:d},"edit"),(0,r.jsx)(iC,{simulation:t,index:i,swr:n},"delete")],children:(0,r.jsx)(y.Z.Text,{strong:!0,className:eo().textAlignCenter,children:l.name})})},iS=e=>{var t;let{simulation:l,onEdit:i,swr:a}=e,n=(0,c.useMemo)(()=>l.scheme.configuration.run,[l]);return(0,r.jsx)(r.Fragment,{children:null===(t=n.sensors)||void 0===t?void 0:t.map((e,t)=>(0,r.jsx)(ik,{simulation:l,sensor:e,index:t,_onEdit:i,swr:a},e.name))})},iP=e=>{let{geometries:t,simulation:l,setVisible:i,setResults:a,setPostprocessing:n,swr:s}=e,[o,u]=(0,c.useState)(),[d,m]=(0,c.useState)(),h=(0,c.useCallback)(()=>{a([]),n(void 0),m(void 0),i(!1),u(!0)},[i,a,n]),p=(0,c.useCallback)(e=>{a([]),n(void 0),m(e),i(!1),u(!0)},[i,a,n]),y=(0,c.useCallback)(()=>{m(void 0),i(!0),u(!1)},[i]);return(0,r.jsxs)(N.Z,{size:"small",title:"Sensors",children:[(0,r.jsx)(ij,{visible:o,geometries:t,simulation:l,sensor:d,onClose:y,swr:s}),(0,r.jsxs)(O.Z,{direction:"vertical",className:eo().fullWidth,children:[(0,r.jsx)(x.ZP,{className:eo().fullWidth,disabled:!1,type:"primary",icon:(0,r.jsx)(im.Z,{}),onClick:h,children:"Add a sensor"}),(0,r.jsx)(iS,{simulation:l,onEdit:p,swr:s})]})]})};var iE=l(139),iM=l(33997);let iN={plugins:"Plugins error",pluginsLoad:"Unable to load plugins"},iO=e=>{let{plugin:t,onOk:i,setVisible:a}=e,n=u()(()=>l(64546)("./".concat(t.key,"/src/components"))),s=(0,c.useCallback)(e=>{(0,tB.merge)(t,e),i(t),a(!1)},[t,i,a]);return(0,r.jsx)(N.Z,{title:t.configuration.name.value,children:(0,r.jsx)(n,{data:t.data,onSelect:s})},t.uuid)},iT=e=>{let{pluginsList:t,plugins:l,onOk:i,setVisible:a}=e;return(null==l?void 0:l.length)?(0,r.jsx)(O.Z,{align:"start",direction:"horizontal",wrap:!0,children:l.map(e=>{let l=t.find(t=>t.key===e.key);return l?(0,r.jsx)(iO,{plugin:e,onOk:i,setVisible:a},e.key):null})}):null},iA=e=>{let{disabled:t,cloudServer:l,onOk:i}=e,[a,n]=(0,c.useState)(!1),[s,o]=(0,c.useState)([]),u=(0,d.useRouter)(),[m,{errorPlugins:h}]=iM.Z.usePlugins();(0,c.useEffect)(()=>{h&&(0,R.lt)(iN.plugins,h)},[h]),(0,c.useEffect)(()=>{tG.Z.list().then(e=>{o(e)}).catch(e=>{(0,R.lt)(iN.pluginsLoad,e)})},[]);let p=(0,c.useCallback)(()=>n(!0),[]),v=(0,c.useCallback)(()=>n(!1),[]),g=(0,c.useCallback)(()=>{u.push({pathname:"/dashboard",query:{page:"account",tab:"hpc"}})},[u]);return(0,r.jsxs)(N.Z,{size:"small",title:"Computational resource",children:[(0,r.jsx)(tF.Z,{open:a,title:"Computational resource",okButtonProps:{disabled:!0,style:{display:"none"}},onCancel:v,style:{width:"unset"},children:(0,r.jsxs)(O.Z,{direction:"vertical",children:[(0,r.jsxs)(y.Z.Text,{children:["Your computational resource does not appear in this list? Create one in your"," ",(0,r.jsx)(z.Qj,{onClick:g,children:"account settings"})]}),(0,r.jsx)(iT,{pluginsList:s,plugins:m,onOk:i,setVisible:n})]})}),(0,r.jsxs)(O.Z,{direction:"vertical",className:eo().fullWidth,children:[l&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(y.Z.Text,{children:[(0,r.jsx)("span",{className:eo().textLight,children:"Plugin:"})," ",l.name]}),(0,r.jsxs)(y.Z.Text,{children:[(0,r.jsx)("span",{className:eo().textLight,children:"Name:"})," ",l.configuration.name.value]}),Object.keys(l.inUseConfiguration).map(e=>{let t=l.inUseConfiguration[e],i=t.value;return"boolean"==typeof i&&(i=i?"yes":"no"),(0,r.jsxs)(y.Z.Text,{children:[(0,r.jsxs)("span",{className:eo().textLight,children:[t.label,":"]})," ",i]},e)})]}),(0,r.jsx)(x.ZP,{className:eo().fullWidth,disabled:t,type:l?"link":"primary",icon:(0,r.jsx)(iE.Z,{}),onClick:p,children:l?"Modify the resource":"Select a resource"})]})]})};var iL=l(15360),iz=l(25935),iR=l(48764).lW;let iI={log:"Unable to get system log"},i_=async(e,t)=>{try{let l=await W.Z.log({id:e.id},t.systemLog),i=iR.from(l.log).toString();tF.Z.info({title:"System log",width:"unset",content:(0,r.jsx)("div",{style:{maxHeight:"70vh",overflow:"auto"},children:(0,r.jsx)("pre",{children:(0,r.jsx)("code",{children:(0,iz.ZP)(i.replace(/\n\n/g,"\n").replace(/\n/g,"<br />"))})})})})}catch(e){(0,R.lt)(iI.log,e)}},iF=e=>{var t,l;let{simulation:i,step:a,loading:n,setLoading:s}=e,o=(0,c.useCallback)(async()=>{s(!0);try{await i_(i,a)}catch(e){}finally{s(!1)}},[i,a,s]);return(0,r.jsxs)(r.Fragment,{children:[a.systemLog&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(x.ZP,{loading:n,onClick:o,children:"Complete log"}),(0,r.jsx)("br",{})]}),a.link&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("a",{href:"https://"+a.link.href,target:"_blank",rel:"noreferrer",children:(0,r.jsx)(x.ZP,{type:"primary",children:a.link.label})}),(0,r.jsx)("br",{})]}),(0,r.jsxs)(lz.Z,{ghost:!0,children:[a.warning&&(0,r.jsx)(lz.Z.Panel,{className:ll().warning,header:(0,r.jsx)(y.Z.Text,{type:"warning",children:"Warnings"}),children:(0,iz.ZP)(a.warning.replace(/\n\n/g,"\n").replace(/\n/g,"<br />"))},"warnings"),a.error&&(0,r.jsx)(lz.Z.Panel,{className:ll().error,header:(0,r.jsx)(y.Z.Text,{type:"danger",children:"Errors"}),children:(0,iz.ZP)(a.error.replace(/\n\n/g,"\n").replace(/\n/g,"<br />"))},"errors")]}),(0,iz.ZP)((null===(t=a.pluginLog)||void 0===t?void 0:t.replace(/\n\n/g,"\n").replace(/\n/g,"<br />"))||""),(0,iz.ZP)((null===(l=a.log)||void 0===l?void 0:l.replace(/\n\n/g,"\n").replace(/\n/g,"<br />").replace(/Info\s*:/g,'<span style="color: blue; font-weight: bold;">Info: </span>').replace(/Error:/g,'<span style="color: red; font-weight: bold;">Error:</span>'))||"")]})},iD=e=>{let{simulation:t,steps:l}=e,[i,a]=(0,c.useState)(!1),[n,s]=(0,c.useState)(!1),o=(0,c.useCallback)(()=>a(!0),[]),u=(0,c.useCallback)(()=>a(!1),[]);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(lm.Z,{title:"Log",open:i,onClose:u,width:"50%",children:(0,r.jsx)(tD.Z,{items:null==l?void 0:l.map((e,l)=>({key:""+l,label:e.label,children:(0,r.jsx)(iF,{simulation:t,step:e,loading:n,setLoading:s})}))})}),(0,r.jsx)(m.Z,{title:"Log",children:(0,r.jsx)(x.ZP,{disabled:!l||!l.length,icon:(0,r.jsx)(iL.Z,{}),onClick:o})})]})};var iU=l(23430);let iV={download:"Unable to download file"},iB=async(e,t)=>{try{let l=await eM.download({id:e.id},{originPath:t.originPath,fileName:t.fileName}),i=await l.blob(),a=window.URL.createObjectURL(new Blob([i])),n=document.createElement("a");n.href=a,n.setAttribute("download",t.name+"."+t.fileName.split(".").pop()),n.click()}catch(e){(0,R.lt)(iV.download,e)}},iW=e=>{let{simulation:t,file:l}=e,[i,a]=(0,c.useState)(!1),n=(0,c.useCallback)(async()=>{a(!0);try{await iB(t,l)}catch(e){}finally{a(!1)}},[t,l]);return(0,r.jsx)(m.Z,{title:"Download",children:(0,r.jsx)(x.ZP,{loading:i,icon:(0,r.jsx)(iU.Z,{}),onClick:n})})},iH={archive:"Unable to download archive"},iG=async e=>{try{let t=await eM.archive({id:e.id}),l=await t.blob(),i=window.URL.createObjectURL(new Blob([l])),a=document.createElement("a");a.href=i,a.setAttribute("download",e.scheme.name+".zip"),a.click()}catch(e){(0,R.lt)(iH.archive,e)}},iY=e=>{let{simulation:t}=e,[l,i]=(0,c.useState)(!1),a=(0,c.useCallback)(async()=>{i(!0);try{await iG(t)}catch(e){}finally{i(!1)}},[t]);return(0,r.jsx)(z.o6,{loading:l,onDownload:a})},iJ=e=>{var t;let{simulation:l,results:i,file:a,setResults:n}=e,s=(0,c.useCallback)(()=>{let e=i.findIndex(e=>e.fileName===a.fileName&&e.name===a.name);-1===e?n([...i,a]):n([...i.slice(0,e),...i.slice(e+1)])},[i,a,n]),o=(0,c.useMemo)(()=>i.find(e=>e.fileName===a.fileName&&e.name===a.name),[i,a]);return(0,r.jsxs)(O.Z,{style:{alignItems:"center"},children:[(0,r.jsx)(x.ZP,{icon:o?(0,r.jsx)(v.Z,{style:{color:"#fad114"}}):(0,r.jsx)(g.Z,{}),onClick:s}),(0,r.jsx)(iW,{simulation:{id:l.id},file:{name:a.name,fileName:a.fileName,originPath:a.originPath}}),null===(t=a.name)||void 0===t?void 0:t.replaceAll("_"," ")]})},iX=e=>{let{simulation:t,results:l,setResults:i}=e,[a,n]=(0,c.useState)(),[s,o]=(0,c.useState)(),[u,d]=(0,c.useState)(),m=(0,c.useMemo)(()=>{var e;return null==t?void 0:null===(e=t.scheme)||void 0===e?void 0:e.configuration},[t]);(0,E.Z)(()=>{var e;if(!(null==t?void 0:t.tasks)){n([]),o(void 0);return}let l=[],i=null==m?void 0:null===(e=m.run)||void 0===e?void 0:e.resultsFilter;t.tasks.forEach(e=>{if(e.file&&l.push(e.file),e.files){if(i){let t=new RegExp(i.pattern),a=e.files.filter(e=>!t.test(e.fileName)),n=e.files.filter(e=>t.test(e.fileName)),s=lJ(n,i),r=s.map(e=>e.number).filter((e,t,l)=>l.indexOf(e)===t).sort((e,t)=>e-t),u=lX(m,i),d=r.map((e,t)=>({label:Math.round(1e15*(u?e*u:t))/1e15,value:e}));l.push(...a),o({filtered:!0,name:i.name,files:s,options:d})}else l.push(...e.files)}}),n(l)},[t,m]),(0,E.Z)(()=>{!u&&s&&d(null==s?void 0:s.options[0].value)},[s,u]);let h=(0,c.useCallback)(e=>{let t=s.files.filter(t=>t.number===e&&l.find(e=>e.name===t.name));i(t),d(e)},[l,s,i]);return a||s?(null==a?void 0:a.length)||s?(0,r.jsx)(N.Z,{size:"small",title:"Results",extra:(0,r.jsx)(iY,{simulation:t&&{id:t.id,scheme:t.scheme}}),children:(0,r.jsxs)(O.Z,{direction:"vertical",className:eo().fullWidth,children:[null==a?void 0:a.map(e=>(0,r.jsx)(iJ,{simulation:t,results:l,file:e,setResults:i},e.name)),s&&(0,r.jsxs)(r.Fragment,{children:[s.name,(0,r.jsx)(t_.Z,{className:eo().fullWidth,options:s.options,value:u,onChange:h}),s.files.map(e=>{if(e.number===u)return(0,r.jsx)(iJ,{simulation:t,results:l,file:e,setResults:i},e.name)})]})]})}):(0,r.jsx)(N.Z,{size:"small",children:"No results yet"}):(0,r.jsx)(eA.Z,{})},iq={run:"Unable to run simulation",stop:"Unable to stop simulation",update:"Unable to update simulation"},iK=async(e,t,l)=>{try{let i=tH.Z.deepCopy(e),a=e.scheme.configuration;a.run.cloudServer=t,i.scheme.configuration=a,await W.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","run"],value:a.run}]),l.mutateOneSimulation(i),l.mutateSimulation(i)}catch(e){(0,R.lt)(iq.update,e)}},i$=async e=>{try{await W.Z.run({id:e.id})}catch(e){throw(0,R.lt)(iq.run,e),e}},iQ=async e=>{try{await W.Z.stop({id:e.id})}catch(e){throw(0,R.lt)(iq.stop,e),e}},i0=e=>{var t;let{geometries:l,simulation:i,results:a,setResults:n,setPostprocessing:s,setVisible:o,swr:u}=e,[d,m]=(0,c.useState)(!1),[p,y]=(0,c.useState)(!1),[v,g]=(0,c.useState)([]),[f,b]=(0,c.useState)(0),[j,{mutateSimulation:w}]=W.Z.useSimulation(i.id,2e3),Z=(0,c.useMemo)(()=>i.scheme.configuration,[i]),C=(0,c.useMemo)(()=>{var e;return null==j?void 0:null===(e=j.scheme)||void 0===e?void 0:e.configuration},[j]);(0,E.Z)(()=>{if(!Z){m(!0);return}let e=!0;Object.keys(Z).forEach(t=>{if("dimension"!==t&&"run"!==t){let l=Z[t];l.done||(e=!1)}}),Z.run.cloudServer||(e=!1),m(!e)},[Z]),(0,E.Z)(()=>{var e,t,l;(null==j?void 0:null===(e=j.tasks)||void 0===e?void 0:e.find(e=>(null==e?void 0:e.status)==="error"))?y(!1):(null==j?void 0:null===(t=j.tasks)||void 0===t?void 0:t.find(e=>e&&"finish"!==e.status))?y(!0):y(!1);let i=[];null==j||null===(l=j.tasks)||void 0===l||l.forEach((e,t)=>{if(e){if(t===j.tasks.length-1){var l,a,n;let t=null!==(n=null===(l=e.log)||void 0===l?void 0:l.match(/[\d\s]{3}%/g))&&void 0!==n?n:null===(a=e.log)||void 0===a?void 0:a.match(/[\d\s]*%/g),i=t?parseFloat(t.pop()):void 0;i&&b(i)}i[e.index]={index:e.index,label:e.label,status:e.status,log:e.log,pluginLog:e.pluginLog,warning:e.warning,error:e.error,systemLog:e.systemLog,link:e.link}}}),g(i)},[null==j?void 0:j.tasks]);let k=(0,c.useCallback)(async e=>iK(i,e,{...u,mutateSimulation:w}),[i,u,w]),S=(0,c.useCallback)(async()=>{y(!0);try{await i$(i)}catch(e){y(!1)}},[i]),P=(0,c.useCallback)(async()=>{try{await iQ(i),y(!1)}catch(e){}},[i]);return i&&j&&(null==j?void 0:j.id)!=="0"?(0,r.jsx)(h.Z,{children:(0,r.jsx)(h.Z.Content,{children:(0,r.jsxs)(O.Z,{direction:"vertical",className:eo().fullWidth,children:[(0,r.jsx)(iP,{geometries:l,simulation:i,setVisible:o,setResults:n,setPostprocessing:s,swr:{mutateOneSimulation:u.mutateOneSimulation}}),(0,r.jsx)(iA,{disabled:p,cloudServer:null==C?void 0:null===(t=C.run)||void 0===t?void 0:t.cloudServer,onOk:k}),(0,r.jsx)(N.Z,{size:"small",title:"Run",children:(0,r.jsxs)(O.Z,{direction:"vertical",className:eo().fullWidth,size:20,children:[(0,r.jsxs)("div",{className:eo().fullWidth,style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,r.jsxs)(O.Z,{children:[(0,r.jsx)(x.ZP,{disabled:d,type:"primary",icon:(0,r.jsx)(ic.Z,{}),loading:p,onClick:S,children:"Run"}),(0,r.jsx)(x.ZP,{disabled:!p,danger:!0,icon:(0,r.jsx)(eV.Z,{}),shape:"circle",onClick:P})]}),(0,r.jsx)(iD,{simulation:{id:i.id},steps:v})]}),(0,r.jsx)(id.Z,{direction:"vertical",current:v.length-1,percent:f,items:v.map((e,t)=>({key:t,title:e.label,description:"("+(t+1)+"/"+v.length+")",status:e.status}))})]})}),(0,r.jsx)(iX,{simulation:j&&{id:j.id,scheme:j.scheme,tasks:j.tasks},results:a,setResults:n})]})})}):(0,r.jsx)(h.Z,{children:(0,r.jsx)(h.Z.Content,{children:(0,r.jsx)(N.Z,{size:"small",children:(0,r.jsx)(eA.Z,{})})})})};var i1=l(1402),i2=[{key:"warpByVector",label:"Warp by vector",parameters:[{key:"Vectors",label:"Vectors",rules:[{required:!0,message:"Vectors is required"}]},{key:"ScaleFactor",label:"Scale factor",default:"1",rules:[{required:!0,message:"Scale factor is required"}]}]},{key:"contour",label:"Contour",parameters:[{key:"ContourBy",label:"Contour by",rules:[{required:!0,message:"ContourBy by is required"}]},{key:"isosurface",label:"Isosurface",default:"0",rules:[{required:!0,message:"Isosurface is required"}]}]},{key:"streamTracer",label:"Stream tracer",parameters:[{key:"Vectors",label:"Vectors",rules:[{required:!0,message:"Vectors is required"}]}]}];let i5=async(e,t,l,i)=>{let a=await (0,G.R)("/api/postprocessing",{method:"POST",headers:{Accept:"application/json"},body:JSON.stringify({simulation:e,result:t,filter:l,parameters:i})});return a.json()};var i4={run:i5};let i3={run:"Unable to run filter"},i8=async(e,t,l,i)=>{try{return await i4.run(e,t,l,i)}catch(e){throw(0,R.lt)(i3.run,e),e}},i6=e=>{let{simulation:t,postprocessing:l,result:i,setResult:a}=e,n=(0,c.useCallback)(()=>a((null==l?void 0:l.fileName)===i.fileName&&(null==l?void 0:l.name)===i.name?void 0:{type:"postprocessing",...i}),[l,i,a]);return(0,r.jsxs)(O.Z,{children:[(0,r.jsx)(x.ZP,{icon:(null==l?void 0:l.fileName)===i.fileName&&(null==l?void 0:l.name)===i.name?(0,r.jsx)(v.Z,{className:eo().primaryColor}):(0,r.jsx)(g.Z,{}),onClick:n}),(0,r.jsx)(iW,{simulation:{id:t.id},file:{name:i.name,fileName:i.fileName,originPath:i.originPath}}),i.name]},i.glb)},i7=e=>{let{simulation:t,postprocessing:l,results:i,setResult:a}=e;return i.length?(0,r.jsx)(O.Z,{direction:"vertical",className:eo().fullWidth,children:i.map(e=>(0,r.jsx)(i6,{simulation:t,postprocessing:l,result:e,setResult:a},e.glb))}):(0,r.jsx)(r.Fragment,{children:"No results"})},i9=e=>{let{simulation:t,results:l,postprocessing:i,setResult:a}=e,[n,s]=(0,c.useState)(),[o,u]=(0,c.useState)(),[d,p]=(0,c.useState)(),[y,v]=(0,c.useState)();(0,c.useEffect)(()=>{1!==l.length&&n&&s(!1)},[l,n]);let g=(0,c.useMemo)(()=>l[0],[l]);(0,c.useEffect)(()=>{t||(u(void 0),v(void 0))},[t]);let f=(0,c.useMemo)(()=>null==t?void 0:t.scheme.configuration.run.postprocessing,[t]),b=(0,c.useMemo)(()=>i2.map(e=>{if(null==f?void 0:f.find(t=>t.key===e.key))return{label:e.label,value:e.key}}).filter(e=>e),[f]),j=(0,c.useMemo)(()=>{if(!f||!o)return;let e=i2.find(e=>e.key===o),t=f.find(e=>e.key===o);if(null==e?void 0:e.parameters)return e.parameters.map((e,l)=>{var i;let a=null==t?void 0:null===(i=t.parameters)||void 0===i?void 0:i.find(t=>t.key===e.key);return(null==a?void 0:a.value)?(0,r.jsx)(ev.Z.Item,{label:e.label,name:["parameters",l],initialValue:a.value,rules:e.rules,children:(0,r.jsx)(eg.Z,{disabled:!0})},e.key):(null==a?void 0:a.options)?(0,r.jsx)(ev.Z.Item,{label:e.label,name:["parameters",l],rules:e.rules,children:(0,r.jsx)(t_.Z,{options:a.options.map(e=>({label:e,value:e}))})},e.key):(0,r.jsx)(ev.Z.Item,{label:e.label,name:["parameters",l],rules:e.rules,initialValue:e.default,children:(0,r.jsx)(eg.Z,{})},e.key)})},[f,o]),w=(0,c.useCallback)(()=>s(!0),[]),Z=(0,c.useCallback)(()=>s(!1),[]),C=(0,c.useCallback)(async e=>{p(!0);try{let l=await i8({id:t.id},g,o,e.parameters||[]);v({filter:o,results:l})}catch(e){}p(!1)},[t,g,o]);return t&&1===l.length&&f&&b.length?(0,r.jsx)(h.Z,{style:{position:"absolute",zIndex:101,right:25,bottom:50,backgroundColor:"rgba(255, 255, 255, 0)"},children:(0,r.jsxs)(h.Z.Content,{children:[(0,r.jsx)(m.Z,{title:"Post-processing",children:(0,r.jsx)(x.ZP,{type:"primary",icon:(0,r.jsx)(i1.Z,{}),onClick:w,style:{width:40,height:40,border:"1px solid #5E14FA",borderRadius:20,marginBottom:-20}})}),(0,r.jsxs)(lm.Z,{title:"Post-processing",closable:!0,onClose:Z,open:n,mask:!1,maskClosable:!1,children:[(0,r.jsx)(ev.Z,{style:{margin:"24px 0"},children:(0,r.jsx)(ev.Z.Item,{name:"filter",label:"Filter",children:(0,r.jsx)(t_.Z,{placeholder:"Select a filter",options:b,onChange:u})})}),(0,r.jsxs)(ev.Z,{layout:"vertical",style:{margin:"24px 0"},onFinish:C,children:[j,(0,r.jsx)(ev.Z.Item,{children:(0,r.jsx)(x.ZP,{type:"primary",loading:d,htmlType:"submit",icon:(0,r.jsx)(ic.Z,{}),children:"Run"})})]}),y&&(0,r.jsx)(N.Z,{size:"small",title:"Post-processing",extra:y.filter,children:(0,r.jsx)(i7,{simulation:t,postprocessing:i,results:y.results,setResult:a})})]})]})}):null},ae={plugins:"Unable to load plugins",update:"Unable to update simulation"},at=(e,t)=>{tG.Z.list().then(l=>{let i=al(e,tW.Z,l);t(i)}).catch(e=>{(0,R.lt)(ae.plugins,e)})},al=(e,t,l)=>{let i=t;return l.forEach(t=>{var l;(null==e?void 0:null===(l=e.authorizedplugins)||void 0===l?void 0:l.includes(t.key))&&"Model"===t.category&&(i=[...i,...t.models])}),i},ai=(e,t)=>{if(!t||!t.length)return!0;if(Array.isArray(e)){let l=t.filter(t=>e.includes(t));return l.length==t.length}return!!(1===t.length&&t.includes(e))},aa=e=>{let{visible:t,user:l,onOk:i,onCancel:a}=e,[n,s]=(0,c.useState)(),[o,u]=(0,c.useState)(!1),[d,m]=(0,c.useState)([]),[y,x]=(0,c.useState)(),[v,g]=(0,c.useState)();(0,E.Z)(()=>{l&&at(l,m)},[l]),(0,E.Z)(()=>{let e=d.map(e=>e.category).flat().filter((e,t,l)=>l.indexOf(e)===t).map(e=>({key:e,value:e}));x(e)},[d]);let f=(0,c.useCallback)(e=>{let{key:t}=e,l=d.find(e=>e.algorithm===t);s(tH.Z.deepCopy(l))},[d]),b=(0,c.useCallback)(e=>{let{key:t}=e,i=l.models.find(e=>e.algorithm===t);s(tH.Z.deepCopy(i))},[l]),j=(0,c.useCallback)(async()=>{if(u(!0),n)try{await i(n)}catch(e){}u(!1)},[n,i]),w=(0,c.useMemo)(()=>{let e=[{key:"category",disabled:!0,label:(0,r.jsx)(t_.Z,{mode:"multiple",className:eo().fullWidth,options:y,allowClear:!0,showArrow:!1,placeholder:"Category filter",onChange:g})}];return d.forEach(t=>{ai(t.category,v)&&e.push({key:t.algorithm,label:t.name})}),e},[d,y,v]),Z=(0,c.useMemo)(()=>{let e=[{key:"category",disabled:!0,label:(0,r.jsx)(t_.Z,{mode:"multiple",className:eo().fullWidth,options:y,allowClear:!0,showArrow:!1,placeholder:"Category filter",onChange:g})}];return null==l||l.models.forEach(t=>{ai(t.category,v)&&e.push({key:t.algorithm,label:t.name})}),e},[l,y,v]);return(0,r.jsx)(tF.Z,{open:t,title:"Create simulation",okText:"Create",okButtonProps:{loading:o},onOk:j,onCancel:a,width:"80%",children:(0,r.jsxs)(h.Z,{className:ll().selectorContent,children:[(0,r.jsx)(h.Z.Sider,{theme:"light",width:300,className:ll().selectorSider,children:(0,r.jsx)(tD.Z,{items:[{key:"tanatloc",label:"Tanatloc algorithm",children:(0,r.jsx)(p.Z,{mode:"inline",items:w,onSelect:f})},{key:"personal",label:"User algorithm",children:(0,r.jsx)(p.Z,{mode:"inline",className:ll().selectorMenu,items:Z,onSelect:b})}]})}),(0,r.jsx)(h.Z.Content,{className:ll().selector,children:(0,r.jsx)(ea.Z.Html,{html:null==n?void 0:n.description})})]})})},an=async(e,t,l)=>{try{let i=t.find(t=>{var l;return t.algorithm===(null==e?void 0:null===(l=e.scheme)||void 0===l?void 0:l.algorithm)}),a=tH.Z.deepCopy(e);(0,tB.merge)(a.scheme,i),await W.Z.update({id:e.id},[{key:"scheme",value:a.scheme}]),l.mutateOneSimulation(a)}catch(e){(0,R.lt)(ae.update,e)}},as=e=>{let{user:t,simulation:l,swr:i}=e,[a,n]=(0,c.useState)([]);return(0,E.Z)(()=>{t&&at(t,n)},[t]),(0,E.Z)(()=>{let e=a.find(e=>{var t;return e.algorithm===(null==l?void 0:null===(t=l.scheme)||void 0===t?void 0:t.algorithm)});if(e&&(null==l?void 0:l.scheme)){let t=(0,tU.Z)(l.scheme,e),n=(0,tV.Z)(l.scheme,e);(Object.keys(t).length||Object.keys(n).length)&&(tF.Z.info({title:"Update",content:"Your model need an update, please wait.",closable:!1,okButtonProps:{hidden:!0}}),an(l,a,i).finally(()=>tF.Z.destroyAll()))}},[l,a,i]),null};var ar={Selector:aa,Updater:as,About:t4,Geometry:ls,Materials:lL,Parameters:lY,Initialization:l5,BoundaryConditions:iu,Run:i0,Postprocessing:i9},ao=l(39095),au=l.n(ao);let ad=u()(()=>Promise.all([l.e(7521),l.e(5891),l.e(4830)]).then(l.bind(l,4830)),{loadableGenerated:{webpack:()=>[4830]},ssr:!1}),ac={dashboard:{key:"dashboard"},geometries:{label:"GEOMETRIES",key:"geometries"},simulations:{label:"SIMULATIONS",key:"simulations"}},am={user:"Unable to get user",project:"Unable to get project",simulations:"Unable to get simulations",geometries:"Unable to get geometries",add:"Unable to add simulation"},ah=async(e,t,l)=>{try{let i=await W.Z.add({id:e.id},{name:t.name,scheme:t});l.addOneSimulation(i),l.mutateProject({id:e.id,simulations:[...e.simulations||[],i.id]})}catch(e){throw(0,R.lt)(am.add,e),e}},ap=e=>{let{visible:t,geometry:l,panel:i,add:a,del:n,close:s}=e,o=(0,c.useCallback)(e=>{var t,a,r;e.stopPropagation(),(null==i?void 0:null===(t=i.props)||void 0===t?void 0:null===(a=t.children)||void 0===a?void 0:null===(r=a.type)||void 0===r?void 0:r.componentName)===ek.componentName&&s(),n(l)},[l,i,n,s]),u=(0,c.useCallback)(e=>{e.stopPropagation(),a(l)},[l,a]);return(0,r.jsxs)("div",{children:[l.name,t?(0,r.jsx)(v.Z,{onClick:o}):(0,r.jsx)(g.Z,{onClick:u})]})},ay=e=>{let{simulation:t}=e;return t.scheme.user?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(m.Z,{title:"User algorithm",placement:"right",children:(0,r.jsx)(f.Z,{style:{position:"absolute",top:0,left:14,fontSize:14,color:"#fad114"}})}),t.name]}):(0,r.jsx)(r.Fragment,{children:t.name})},ax=()=>{let e=(0,d.useRouter)(),{page:t,workspaceId:l,projectId:i}=e.query,[a,n]=(0,c.useState)(!1),[s,o]=(0,c.useState)([]),[u,m]=(0,c.useState)(!1),[v,g]=(0,c.useState)(),[f,N]=(0,c.useState)([]),[O,T]=(0,c.useState)(),[A,I]=(0,c.useState)(),[_,F]=(0,c.useState)(),[D,H]=(0,c.useState)(!0),[G,{errorUser:Y,loadingUser:J}]=V.Z.useUser(),[X,{mutateProject:q,errorProject:K,loadingProject:$}]=B.Z.useProject(i),[ee,{addOneSimulation:et,delOneSimulation:el,mutateOneSimulation:ea,errorSimulations:en,loadingSimulations:es}]=W.Z.useSimulations(null==X?void 0:X.simulations),[er,{addOneGeometry:eu,delOneGeometry:ed,mutateOneGeometry:ec,errorGeometries:em,loadingGeometries:eh}]=Q.useGeometries(null==X?void 0:X.geometries),ep=(0,c.useCallback)(()=>n(!0),[]),ey=(0,c.useCallback)(()=>m(!0),[]),ex=(0,c.useCallback)(()=>m(!1),[]),ev=(0,c.useCallback)(e=>{o(t=>[...t,e])},[]),eg=(0,c.useCallback)(e=>{let t=s.findIndex(t=>t.id===e.id);-1!==t&&o(e=>[...e.slice(0,t),...e.slice(t+1)])},[s]),ef=(0,c.useCallback)(()=>{F(void 0),I(void 0)},[]),eb=(0,c.useCallback)(e=>{let t=er.findIndex(t=>t.id===e);-1!==t&&o(e=>[...e.slice(0,t),{id:"0",needCleanup:!0},...e.slice(t+1)])},[er]),ej=(0,c.useCallback)(e=>{let t=er.find(t=>t.id===e);if(!t)return;let l=s.find(t=>t.id===e);l||o(e=>[...e,{...t,visible:!0}]),F((0,r.jsx)(ei,{visible:!0,title:"Geometry",onClose:ef,children:(0,r.jsx)(ek,{project:{id:X.id,geometries:X.geometries},geometry:{id:t.id,name:t.name,summary:t.summary},swr:{mutateProject:q,mutateOneGeometry:ec,delOneGeometry:ed},close:ef,onCleanup:eb})}))},[X,er,s,q,ec,ed,eb,ef]),ew=(0,c.useCallback)(e=>{F((0,r.jsx)(ei,{visible:!0,title:"About",onClose:ef,children:(0,r.jsx)(ar.About,{project:{id:X.id,simulations:X.simulations},simulation:{id:e.id,name:e.name,scheme:e.scheme},swr:{mutateProject:q,addOneSimulation:et,delOneSimulation:el,mutateOneSimulation:ea}})}))},[X,q,et,el,ea,ef]),eZ=(0,c.useCallback)(e=>{F((0,r.jsx)(ei,{visible:!0,title:"Geometry",onClose:ef,children:(0,r.jsx)(ar.Geometry,{loadedGeometries:er,geometries:s.map(e=>({id:e.id,summary:e.summary})),simulation:{id:e.id,scheme:e.scheme},setGeometries:o,swr:{mutateOneSimulation:ea}})}))},[er,s,ea,ef]),eC=(0,c.useCallback)(e=>{F((0,r.jsx)(ei,{visible:!0,title:"Parameters",onClose:ef,children:(0,r.jsx)(ar.Parameters,{simulation:{id:e.id,scheme:e.scheme},swr:{mutateOneSimulation:ea}})}))},[ea,ef]),eS=(0,c.useCallback)(e=>{F((0,r.jsx)(ei,{visible:D,title:"Materials",onClose:ef,children:(0,r.jsx)(ar.Materials,{geometries:s.map(e=>({id:e.id,name:e.name,summary:e.summary})),simulation:{id:e.id,scheme:e.scheme},swr:{mutateOneSimulation:ea},setVisible:H})}))},[s,D,ea,ef]),eP=(0,c.useCallback)(e=>{F((0,r.jsx)(ei,{visible:!0,title:"Initialization",onClose:ef,children:(0,r.jsx)(ar.Initialization,{simulations:ee,simulation:e,swr:{mutateOneSimulation:ea}})}))},[ee,ea,ef]),eE=(0,c.useCallback)(e=>{F((0,r.jsx)(ei,{visible:D,title:"Boundary conditions",onClose:ef,children:(0,r.jsx)(ar.BoundaryConditions,{geometries:s.map(e=>({id:e.id,name:e.name,summary:e.summary})),simulation:{id:e.id,scheme:e.scheme},swr:{mutateOneSimulation:ea},setVisible:H})}))},[s,D,ea,ef]),eM=(0,c.useCallback)(e=>{F((0,r.jsx)(ei,{visible:D,title:"Run",onClose:ef,children:(0,r.jsx)(ar.Run,{geometries:s,simulation:{id:e.id,scheme:e.scheme},results:f,setResults:N,setPostprocessing:T,setVisible:H,swr:{mutateOneSimulation:ea}})}))},[s,f,D,ea,ef]),eN=(0,c.useCallback)((e,t)=>{var l,i,a,n,s,r;let u=ee.find(t=>t.id===e);if(!u)return;g(u);let d=null===(l=u.scheme)||void 0===l?void 0:null===(i=l.configuration)||void 0===i?void 0:null===(a=i.geometry)||void 0===a?void 0:a.value,c=null===(n=u.scheme)||void 0===n?void 0:null===(s=n.configuration)||void 0===s?void 0:null===(r=s.geometry)||void 0===r?void 0:r.values;if(d){let e=er.find(e=>e.id===d);e&&o([e])}else if(c){let e=er.filter(e=>c.includes(e.id));o(e)}switch(t){case"about":ew(u);break;case"geometry":eZ(u);break;case"parameters":eC(u);break;case"materials":eS(u);break;case"initialization":eP(u);break;case"boundaryConditions":eE(u);break;case"run":eM(u);break;default:F(void 0)}},[er,ee,ew,eZ,eC,eS,eP,eE,eM]),eO=(0,c.useCallback)(()=>e.push({pathname:"/dashboard",query:{page:t,workspaceId:l}}),[e,t,l]),eT=(0,c.useCallback)(e=>{let t,{keyPath:l}=e,i=l.pop(),a=l.pop(),n=l.pop();n&&(t=n.split("&").pop()),I({key:i,id:a,item:t})},[]),eA=(0,c.useCallback)(async e=>{try{await ah(X,e,{addOneSimulation:et,mutateProject:q}),m(!1)}catch(e){}},[X,et,q]),eL=(0,c.useCallback)(e=>{if(eh)return!0;let t=e.value,l=e.values,i=e.multiple,a=e.n;return(!t||!!er.filter(e=>e.id===t).length)&&(!i||!l||(a?er.filter(e=>l.includes(e.id)).length===e.n:!!er.filter(e=>l.includes(e.id)).length))&&(!!t||!!l)||(e.done=!1,!1)},[er,eh]);(0,c.useEffect)(()=>{J||G||e.replace("/login")},[G,J,e]),(0,c.useEffect)(()=>{Y&&(0,R.lt)(am.user,Y),K&&(0,R.lt)(am.project,K),en&&(0,R.lt)(am.simulations,en),em&&(0,R.lt)(am.geometries,em)},[Y,K,en,em]),(0,E.Z)(()=>{$||eh?n(!1):er.length?n(!1):n(!0)},[$,eh,er]),(0,E.Z)(()=>{if(!eh){if(s.length){let e=!1,t=s.map(t=>{let l=er.find(e=>e.id===(null==t?void 0:t.id));return l?JSON.stringify({...l,visible:void 0})!==JSON.stringify({...t,visible:void 0})?(e=!0,l):t:(e=!0,null)}).filter(e=>e);e&&o(t)}else o(er[0]?[er[0]]:[])}},[eh,er,s],[o]),(0,E.Z)(()=>{if(!es&&v){let e=ee.find(e=>e.id===(null==v?void 0:v.id));e?JSON.stringify(e)!==JSON.stringify(v)&&(g(e),A&&A.key===ac.simulations.key&&eN(A.id,A.item)):(ef(),g(void 0))}},[ee,es,v,A],[g,ef]),(0,E.Z)(()=>{A&&(A.key===ac.geometries.key?ej(A.id):(eN(A.id,A.item),"run"!==A.item&&(N([]),T(void 0))))},[A,D,f],[ej,eN,ef]),(0,c.useEffect)(()=>{!f.length&&O&&T(void 0)},[f,O]);let ez=(0,c.useMemo)(()=>er.map(e=>{let t=s.find(t=>t.id===e.id);return{key:e.id,icon:(0,r.jsx)(b.Z,{}),label:(0,r.jsx)(ap,{visible:!!t,geometry:e,panel:_,add:ev,del:eg,close:ef})}}),[er,s,_,ev,eg,ef]),eR=(0,c.useMemo)(()=>ee.map(e=>{let t=e.scheme.configuration||{},l=[];return Object.keys(t).forEach(i=>{if("dimension"===i)return;let a=t[i],n=(0,r.jsx)(j.Z,{style:{color:"green"}});a.error?n=(0,r.jsx)(w.Z,{style:{color:"red"}}):a.done||(n=(0,r.jsx)(Z.Z,{style:{color:"orange"}})),"geometry"!==i||eL(a)||(n=(0,r.jsx)(Z.Z,{style:{color:"orange"}})),l[a.index]={key:e.id+"&"+i,disabled:!s.length,icon:n,label:a.title}}),{key:e.id,icon:(0,r.jsx)(C.Z,{}),label:(0,r.jsx)(ay,{simulation:e}),children:[{key:e.id+"&about",disabled:!s.length,icon:(0,r.jsx)(j.Z,{style:{color:"green"}}),label:"About"},...l]}}),[s,ee,eL]);return!G||J||$?(0,r.jsx)(M.Z.Simple,{}):"0"===X.id?(0,r.jsx)(L,{}):(0,r.jsx)(U,{children:(0,r.jsxs)(h.Z,{hasSider:!0,children:[(0,r.jsxs)(h.Z.Sider,{theme:"light",className:au().sider,width:256,children:[(0,r.jsx)("div",{className:eo().logo,children:(0,r.jsx)("img",{src:"/images/logo.svg",alt:"Tanatloc"})}),(0,r.jsx)(p.Z,{className:au().menu1,mode:"inline",items:[{key:"menu-go-back",disabled:!0,style:{cursor:"unset",margin:"10px 0",paddingLeft:10},label:(0,r.jsx)(z.ks,{className:eo().fullWidth,onClick:eO,children:"Return to dashboard"})},{type:"divider"},{key:"title",disabled:!0,className:"Menu-title",label:(0,r.jsx)(y.Z.Paragraph,{ellipsis:{tooltip:!0,rows:2},children:X.title})}]}),(0,r.jsx)("div",{className:au().menuScroll,children:(0,r.jsx)(p.Z,{mode:"inline",className:au().menu2,defaultOpenKeys:[ac.geometries.key,ac.simulations.key],items:[{key:ac.geometries.key,className:"SubMenu",icon:eh?(0,r.jsx)(k.Z,{}):(0,r.jsx)(b.Z,{}),label:(0,r.jsxs)(y.Z.Text,{strong:!0,children:[ac.geometries.label," (",er.length,")"]}),children:[{key:"new_geometry",disabled:!0,label:(0,r.jsx)(x.ZP,{icon:(0,r.jsx)(S.Z,{}),onClick:ep,children:"New Geometry"})},{key:"geometry-needed",disabled:!0,className:s.length?"display-none":"",icon:(0,r.jsx)(Z.Z,{style:{color:"red"}}),label:"A Geometry is needed"},...ez]},{key:ac.simulations.key,className:"SubMenu",icon:es?(0,r.jsx)(k.Z,{}):(0,r.jsx)(C.Z,{}),label:(0,r.jsxs)(y.Z.Text,{strong:!0,children:[ac.simulations.label," (",ee.length,")"]}),children:[{key:"new_simulation",disabled:!0,label:(0,r.jsx)(x.ZP,{disabled:!er.length,icon:(0,r.jsx)(P.Z,{}),onClick:ey,children:"New Simulation"})},...eR]}],onClick:eT})})]}),(0,r.jsxs)(h.Z.Content,{className:eo().noScroll,style:{position:"relative"},children:[(0,r.jsx)(ek.Add,{visible:a,project:{id:X.id,geometries:X.geometries},swr:{mutateProject:q,addOneGeometry:eu},setVisible:n}),(0,r.jsx)(ar.Selector,{user:{authorizedplugins:G.authorizedplugins,models:G.models},visible:u,onOk:eA,onCancel:ex}),(0,r.jsx)(ar.Updater,{user:{authorizedplugins:G.authorizedplugins},simulation:v&&{id:v.id,scheme:v.scheme},swr:{mutateOneSimulation:ea}}),_,(0,r.jsx)(tI,{project:{id:X.id,title:X.title},simulation:v&&{id:v.id},geometries:s.map(e=>({id:e.id,needCleanup:e.needCleanup})),results:f.map(e=>({glb:e.glb,originPath:e.originPath})),postprocessing:O&&{glb:O.glb,originPath:O.originPath}}),(0,r.jsx)(ad,{simulation:v&&{id:v.id,name:v.name}}),(0,r.jsx)(ar.Postprocessing,{simulation:v&&{id:v.id,scheme:v.scheme},results:f.map(e=>({name:e.name,fileName:e.fileName,originPath:e.originPath})),postprocessing:O&&{name:O.name,fileName:O.fileName},setResult:T})]})]})})};var av=ax},87819:function(e){e.exports={upload:"add_upload__gI0Tw"}},39095:function(e){e.exports={variables:'"@/styles/variables.css"',colorPrimary:"#fad114",sider:"project_sider__iUhsS",menu1:"project_menu1__XdM_R",menuScroll:"project_menuScroll__78_Ce",menu2:"project_menu2__Txzic"}},68847:function(e){e.exports={panel:"panel_panel___hALB",subPanel:"panel_subPanel__0TV8M"}},98281:function(e){e.exports={selectorContent:"simulation_selectorContent__HWIz8",selectorSider:"simulation_selectorSider__aC0Gk",selector:"simulation_selector__Xf4pE",geometriesList:"simulation_geometriesList__1Ces7",waring:"simulation_waring__Dn3br",error:"simulation_error__4EgiV",listItem:"simulation_listItem__YxV62"}},60968:function(e){e.exports={variables:'"@/styles/variables.css"',colorPrimary:"#fad114",view:"three_view__MDbup",head:"three_head__fY_4c",content:"three_content__FaWcm",loading:"three_loading__B2ZAP",canvas:"three_canvas__LLX1q"}},64546:function(e,t,l){var i={"./local/src/components":[21091,1091]};function a(e){if(!l.o(i,e))return Promise.resolve().then(function(){var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t});var t=i[e],a=t[0];return l.e(t[1]).then(function(){return l(a)})}a.keys=function(){return Object.keys(i)},a.id=64546,e.exports=a}}]);