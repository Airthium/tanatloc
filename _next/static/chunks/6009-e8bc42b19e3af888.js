(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6009],{72735:function(e,t,l){"use strict";l.d(t,{Z:function(){return n}});var a=l(83755);let i=async(e,t)=>{let l=await (0,a.R)("/api/avatar",{method:"POST",headers:{Accept:"application/json"},body:JSON.stringify({file:e,project:t})});return l.json()};var n={add:i}},33997:function(e,t,l){"use strict";l.d(t,{Z:function(){return d}});var a=l(83755);let i=async e=>{await (0,a.R)("/api/plugin",{method:"POST",body:JSON.stringify(e)})},n=async e=>{await (0,a.R)("/api/plugin",{method:"PUT",body:JSON.stringify(e)})},s=async e=>{await (0,a.R)("/api/plugin",{method:"DELETE",body:JSON.stringify(e)})};var r=l(55264),o=l(67294);let u=()=>{var e;let{data:t,error:l,mutate:i}=(0,r.ZP)("/api/plugin",a._),n=null!==(e=null==t?void 0:t.plugins)&&void 0!==e?e:[],s=(0,o.useCallback)(async e=>{let t=[...n,e];await i({plugins:t})},[n,i]),u=(0,o.useCallback)(async e=>{let t=n.filter(t=>t.key!==e.key);await i({plugins:t})},[n,i]),d=(0,o.useCallback)(async e=>{let t=n.map(t=>(t.key===e.key&&(t={...t,...e}),t));await i({plugins:t})},[n,i]);return[n,{addOnePlugin:s,delOnePlugin:u,mutateOnePlugin:d,errorPlugins:l,loadingPlugins:!t}]};var d={add:i,update:n,del:s,usePlugins:u}},55276:function(e,t,l){"use strict";l.d(t,{Z:function(){return s}});var a=l(83755);let i=async()=>{let e=await (0,a.R)("/api/plugins",{method:"GET",headers:{Accept:"application/json"}});return e.json()},n=async()=>{let e=await (0,a.R)("/api/plugins",{method:"POST",headers:{Accept:"application/json"}});return e.json()};var s={list:i,completeList:n}},77149:function(e,t,l){"use strict";l.d(t,{Z:function(){return v}});var a=l(55264),i=l(67294),n=l(83755);let s=e=>{var t;let{data:l,error:s,mutate:r}=(0,a.ZP)(["/api/projects",JSON.stringify({ids:e})],e=>{let[t,l]=e;return(0,n._)(t,l)}),o=null!==(t=null==l?void 0:l.projects)&&void 0!==t?t:[],u=(0,i.useCallback)(async e=>{let t=[...o,{...e,users:[],geometries:[],simulations:[],groups:[]}];await r({projects:t})},[o,r]),d=(0,i.useCallback)(async e=>{let t=o.filter(t=>t.id!==e.id);await r({projects:t})},[o,r]),c=(0,i.useCallback)(async e=>{let t=o.map(t=>(t.id===e.id&&(t={...t,...e}),t));await r({projects:t})},[o,r]);return[o,{addOneProject:u,delOneProject:d,mutateOneProject:c,errorProjects:s,loadingProjects:!l}]},r=e=>{var t;let{data:l,error:s,mutate:r}=(0,a.ZP)("/api/project"+(e?"/"+e:""),n._),o=null!==(t=null==l?void 0:l.project)&&void 0!==t?t:{id:"0"},u=(0,i.useCallback)(async e=>{let t={...o,...e};await r({project:t})},[o,r]);return[o,{mutateProject:u,errorProject:s,loadingProject:!l}]},o=async(e,t)=>{let l=await (0,n.R)("/api/project",{method:"POST",headers:{Accept:"application/json"},body:JSON.stringify({workspace:{id:e.id},project:t})});return l.json()},u=async(e,t)=>{await (0,n.R)("/api/project/"+e.id,{method:"PUT",body:JSON.stringify(t)})},d=async(e,t)=>{await (0,n.R)("/api/project/"+t.id,{method:"DELETE",body:JSON.stringify({id:e.id})})},c=async e=>(0,n.R)("/api/project/"+e.id+"/archive",{method:"GET",headers:{Accept:"application/json"}}),m=async e=>(0,n.R)("/api/project/"+e.id+"/archive",{method:"PUT"}),h=async e=>(0,n.R)("/api/project/"+e.id+"/archive",{method:"DELETE"}),p=async(e,t)=>(0,n.R)("/api/project/"+e.id+"/archive",{method:"POST",body:JSON.stringify({archive:t})}),y=async(e,t)=>{let l=await (0,n.R)("/api/project/"+t.id+"/copy",{method:"POST",headers:{Accept:"application/json"},body:JSON.stringify({workspace:{id:e.id}})});return l.json()};var v={useProjects:s,useProject:r,add:o,update:u,del:d,archive:c,unarchiveFromServer:m,deleteArchiveFile:h,unarchiveFromFile:p,copy:y}},72616:function(e,t,l){"use strict";l.d(t,{Z:function(){return v}});var a=l(55264),i=l(67294),n=l(83755);let s=e=>{var t;let{data:l,error:s,mutate:r}=(0,a.ZP)(["/api/simulations",JSON.stringify({ids:e})],e=>{let[t,l]=e;return(0,n._)(t,l)}),o=null!==(t=null==l?void 0:l.simulations)&&void 0!==t?t:[],u=(0,i.useCallback)(async e=>{let t=[...o,e];await r({simulations:t})},[o,r]),d=(0,i.useCallback)(async e=>{let t=o.filter(t=>t.id!==e.id);await r({simulations:t})},[o,r]),c=(0,i.useCallback)(async(e,t)=>{let l=o.map(t=>(t.id===e.id&&(t={...t,...e}),t));await r({simulations:l},t)},[o,r]);return[o,{addOneSimulation:u,delOneSimulation:d,mutateOneSimulation:c,errorSimulations:s,loadingSimulations:!l}]},r=(e,t)=>{var l;let{data:s,error:r,mutate:o}=(0,a.ZP)("/api/simulation"+(e?"/"+e:""),n._,{refreshInterval:null!=t?t:0}),u=null!==(l=null==s?void 0:s.simulation)&&void 0!==l?l:{id:"0"},d=(0,i.useCallback)(async e=>{await o({simulation:{...u,...e}})},[u,o]);return[u,{mutateSimulation:d,errorSimulation:r,loadingSimulation:!s}]},o=async(e,t)=>{let l=await (0,n.R)("/api/simulation",{method:"POST",headers:{Accept:"application/json"},body:JSON.stringify({project:{id:e.id},simulation:t})});return l.json()},u=async(e,t)=>{await (0,n.R)("/api/simulation/"+e.id,{method:"PUT",body:JSON.stringify(t)})},d=async e=>{await (0,n.R)("/api/simulation/"+e.id,{method:"DELETE"})},c=async e=>{await (0,n.R)("/api/simulation/"+e.id+"/run",{method:"GET"})},m=async e=>{await (0,n.R)("/api/simulation/"+e.id+"/stop",{method:"GET"})},h=async e=>{let t=await (0,n.R)("/api/simulation/"+e.id+"/tasks",{method:"GET",headers:{Accept:"application/json"}});return t.json()},p=async(e,t)=>{let l=await (0,n.R)("/api/simulation/"+e.id+"/log",{method:"POST",body:JSON.stringify({file:t})});return l.json()},y=async e=>{let t=await (0,n.R)("/api/simulation/"+e.id+"/copy",{method:"GET"});return t.json()};var v={useSimulations:s,useSimulation:r,add:o,update:u,del:d,run:c,stop:m,tasks:h,log:p,copy:y}},56009:function(e,t,l){"use strict";let a;l.d(t,{ZP:function(){return iZ}});var i,n,s,r,o,u,d,c,m,h=l(85893),p=l(5152),y=l.n(p),v=l(11163),x=l(67294),g=l(83062),f=l(97183),b=l(68508),j=l(22850),w=l(71577),Z=l(99611),C=l(90420),k=l(73480),S=l(48869),P=l(8751),E=l(18429),M=l(11475),N=l(22844),O=l(50888),T=l(88484),A=l(64789),L=l(36642),z=l(94725),R=l(85813),I=l(26713),_=l(20280);let F={notAllowed:"You are not allowed to be here."},D=()=>{let e=(0,v.useRouter)(),t=(0,x.useCallback)(()=>{(async()=>{await e.push("/")})()},[e]);return(0,h.jsx)(f.Z,{children:(0,h.jsx)(f.Z.Content,{children:(0,h.jsx)(R.Z,{title:"Not allowed",children:(0,h.jsxs)(I.Z,{direction:"vertical",children:[(0,h.jsxs)(j.Z.Text,{children:[(0,h.jsx)(_.Z,{style:{color:"red"}})," ",F.notAllowed]}),(0,h.jsxs)(j.Z.Text,{children:["Go back"," ",(0,h.jsx)(w.ZP,{type:"link",onClick:t,children:"home"})]})]})})})})};var U=l(51302),V=l(9242);let B={enabled:!1,type:void 0,part:void 0,highlighted:void 0,selected:[],point:void 0,dispatch:()=>void 0},W={ENABLE:"ENABLE",DISABLE:"DISABLE",CLEAR:"CLEAR",SETTYPE:"SETTYPE",SETPART:"SETPART",HIGHLIGHT:"HIGHLIGHT",UNHIGHLIGHT:"UNHIGHLIGHT",SELECT:"SELECT",UNSELECT:"UNSELECT",SETPOINT:"SETPOINT"},H=(0,x.createContext)(B),G=(e,t)=>{let l;switch(t.type){case W.ENABLE:return{...e,enabled:!0};case W.DISABLE:return{...e,enabled:!1,highlighted:void 0,selected:[],point:void 0};case W.CLEAR:return{...B};case W.SETTYPE:return{...e,type:t.value};case W.SETPART:return{...e,part:t.value};case W.HIGHLIGHT:return{...e,highlighted:t.value};case W.UNHIGHLIGHT:return{...e,highlighted:void 0};case W.SELECT:if(-1===(l=e.selected.findIndex(e=>e.uuid===t.value.uuid)))return{...e,selected:[...e.selected,t.value]};return e;case W.UNSELECT:if(-1===(l=e.selected.findIndex(e=>e.uuid===t.value.uuid)))return e;return{...e,selected:[...e.selected.slice(0,l),...e.selected.slice(l+1)]};case W.SETPOINT:return{...e,point:t.value};default:return e}},Y=e=>{let{children:t}=e,[l,a]=(0,x.useReducer)(G,B),i=(0,x.useMemo)(()=>({...l,dispatch:a}),[l]);return(0,h.jsx)(H.Provider,{value:i,children:t})};var J=l(42661),X=l(77149),q=l(72616),K=l(55264),$=l(83755);let Q=e=>{var t;let{data:l,error:a,mutate:i}=(0,K.ZP)(["/api/geometries",JSON.stringify({ids:e})],e=>{let[t,l]=e;return(0,$._)(t,l)}),n=null!==(t=null==l?void 0:l.geometries)&&void 0!==t?t:[],s=(0,x.useCallback)(async e=>{let t=[...n,e];await i({geometries:t})},[n,i]),r=(0,x.useCallback)(async e=>{let t=n.filter(t=>t.id!==e.id);await i({geometries:t})},[n,i]),o=(0,x.useCallback)(async e=>{let t=n.map(t=>(t.id===e.id&&(t={...t,...e}),t));await i({geometries:t})},[n,i]);return[n,{addOneGeometry:s,delOneGeometry:r,mutateOneGeometry:o,errorGeometries:a,loadingGeometries:!l}]},ee=async(e,t)=>{let l=await (0,$.R)("/api/geometry",{method:"POST",body:JSON.stringify({project:e,geometry:t})});return l.json()},et=async(e,t)=>{await (0,$.R)("/api/geometry/"+e.id,{method:"PUT",body:JSON.stringify(t)})},el=async e=>{await (0,$.R)("/api/geometry/"+e.id,{method:"DELETE"})},ea=async e=>{let t=await (0,$.R)("/api/geometry/"+e.id+"/download");return t.json()},ei=async e=>{let t=await (0,$.R)("/api/geometry/"+e.id+"/part");return t.json()};var en={useGeometries:Q,add:ee,update:et,del:el,download:ea,getPart:ei},es=l(97937),er=l(68847),eo=l.n(er);let eu=e=>{let{visible:t,title:l,children:a,onClose:i}=e;return(0,h.jsx)(R.Z,{className:eo().panel,style:{display:t?"block":"none"},title:l,extra:(0,h.jsx)(w.ZP,{type:"text",icon:(0,h.jsx)(es.Z,{}),onClick:i}),children:a})};var ed=l(62585),ec=l(31365),em=l(86373),eh=l(14856),ep=l.n(eh),ey=l(87819),ev=l.n(ey),ex=l(48764).lW;let eg={add:"Unable to add geometry"},ef=e=>e.name.toLowerCase().includes(".stp")||e.name.toLowerCase().includes(".step")||e.name.toLowerCase().includes(".dxf"),eb=async e=>{let t=new FileReader;return new Promise(l=>{t.addEventListener("load",()=>{l(t.result)}),t.readAsArrayBuffer(e)})},ej=async(e,t,l)=>{if("uploading"===t.file.status)return!0;if("done"===t.file.status){let a=await eb(t.file.originFileObj);try{let i=await en.add({id:e.id},{name:t.file.name,uid:t.file.uid,buffer:ex.from(a)});await l.addOneGeometry(i),await l.mutateProject({id:e.id,geometries:[...e.geometries,i.id]})}catch(e){throw(0,V.lt)(eg.add,e),e}}return!1},ew=e=>{let{visible:t,project:l,swr:a,setVisible:i}=e,[n,s]=(0,x.useState)(!1),r=(0,x.useCallback)(()=>i(!1),[i]),o=(0,x.useCallback)(e=>{(async()=>{try{let t=await ej(l,e,a);s(t),i(t)}catch(e){s(!1)}})()},[l,a,i]);return(0,h.jsx)(em.ZP,{title:"Upload geometry",visible:t,onCancel:r,cancelButtonProps:{loading:n},children:(0,h.jsxs)(I.Z,{direction:"vertical",className:ep().fullWidth,children:[(0,h.jsx)(ec.Z,{className:ev().upload,action:"/api/noop",accept:".stp,.step,.dxf",showUploadList:!1,listType:"picture-card",beforeUpload:ef,onChange:o,children:(0,h.jsx)("div",{children:n?(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)(O.Z,{style:{fontSize:25}}),(0,h.jsxs)("div",{style:{marginTop:8},children:[(0,h.jsx)("b",{children:"Loading"}),", converting, ..."]})]}):(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)(T.Z,{style:{fontSize:25}}),(0,h.jsxs)("div",{style:{marginTop:8},children:[(0,h.jsx)("b",{children:"Choose a file"})," or drop it here"]})]})})}),(0,h.jsx)(j.Z.Text,{children:(0,h.jsx)("p",{style:{color:"rgba(0, 0, 0, 0.45)",textAlign:"center"},children:"Native file format preferred: STEP (3D) or DXF (2D) file"})})]})})};var eZ=l(638),eC=l(69677);let ek=e=>{let{visible:t,geometry:l,setVisible:a,onEdit:i}=e,n=(0,x.useRef)(null),[s,r]=(0,x.useState)(!1);(0,x.useEffect)(()=>{n.current&&n.current.focus()});let o=(0,x.useCallback)(()=>a(!1),[a]),u=(0,x.useCallback)(async e=>{r(!0);try{await i(e),r(!1),a(!1)}catch(e){throw r(!1),e}},[a,i]);return(0,h.jsx)(em.ZP,{title:"Edit the geometry's name",visible:t,initialValues:{name:l.name},onCancel:o,onOk:u,loading:s,children:(0,h.jsx)(eZ.Z.Item,{name:"name",label:"Name:",rules:[{required:!0,message:"Name is required"}],children:(0,h.jsx)(eC.Z,{ref:n})})})};var eS=l(48764).lW;let eP={download:"Unable to download geometry",update:"Unable to update geometry",del:"Unable to delete geometry"},eE=async e=>{try{let t=await en.download({id:e.id}),l=new File([eS.from(t.buffer).toString()],e.name+"."+t.extension),a=window.URL.createObjectURL(l),i=document.createElement("a");i.href=a,i.setAttribute("download",e.name+"."+t.extension),i.click(),i.remove()}catch(e){(0,V.lt)(eP.download,e)}},eM=async(e,t,l)=>{try{await en.update({id:e.id},[{key:"name",value:t.name}]),e.name=t.name,await l.mutateOneGeometry(e)}catch(e){throw(0,V.lt)(eP.update,e),e}},eN=async(e,t,l,a)=>{try{await en.del({id:e.id});let i=t.geometries.filter(t=>t!==e.id);await a.mutateProject({id:t.id,geometries:i}),await a.delOneGeometry(e),l()}catch(e){throw(0,V.lt)(eP.del,e),e}},eO=e=>{var t,l,a,i,n,s;let{project:r,geometry:o,swr:u,close:d,onCleanup:c}=e,[m,p]=(0,x.useState)(!1),[y,v]=(0,x.useState)(!1),[g,b]=(0,x.useState)(!1),w=(0,x.useCallback)(()=>v(!0),[]),Z=(0,x.useCallback)(()=>{(async()=>{p(!0);try{await eE(o)}catch(e){}finally{p(!1)}})()},[o]),C=(0,x.useCallback)(async e=>eM(o,e,u),[o,u]),k=(0,x.useCallback)(async()=>{b(!0);try{await eN(o,r,d,u),c(o.id)}finally{b(!1)}},[r,o,u,d,c]);return o?(0,h.jsx)(f.Z,{children:(0,h.jsx)(f.Z.Content,{children:(0,h.jsx)(R.Z,{size:"small",title:"Informations",actions:[(0,h.jsx)(U.o6,{loading:m,onDownload:Z},"download"),(0,h.jsxs)("div",{children:[(0,h.jsx)(ek,{visible:y,geometry:{id:null==o?void 0:o.id,name:null==o?void 0:o.name},setVisible:v,onEdit:C}),(0,h.jsx)(U.w6,{onEdit:w})]},"edit"),(0,h.jsx)(U.m1,{loading:g,text:(0,h.jsxs)(h.Fragment,{children:["Are you sure you want to delete the geometry"," ",(0,h.jsx)(j.Z.Text,{strong:!0,children:o.name}),"?"]}),onDelete:k},"delete")],children:(0,h.jsxs)(I.Z,{direction:"vertical",className:ep().fullWidth,children:[(0,h.jsxs)(j.Z.Text,{children:[(0,h.jsx)("span",{className:ep().textLight,children:"File:"})," ",o.name," "]}),(0,h.jsxs)(j.Z.Text,{children:[(0,h.jsx)("span",{className:ep().textLight,children:"Unit:"})," ",(0,h.jsx)(ed.Z.Inline,{text:"m"})]}),(0,h.jsxs)(h.Fragment,{children:[3===o.summary.dimension&&(0,h.jsxs)(j.Z.Text,{children:[(0,h.jsx)("span",{className:ep().textLight,children:"Number of solids:"})," ",null!==(i=null===(t=o.summary.solids)||void 0===t?void 0:t.length)&&void 0!==i?i:0]}),(0,h.jsxs)(j.Z.Text,{children:[(0,h.jsx)("span",{className:ep().textLight,children:"Number of faces:"})," ",null!==(n=null===(l=o.summary.faces)||void 0===l?void 0:l.length)&&void 0!==n?n:0]}),2===o.summary.dimension&&(0,h.jsxs)(j.Z.Text,{children:[(0,h.jsx)("span",{className:ep().textLight,children:"Number of edges:"})," ",null!==(s=null===(a=o.summary.edges)||void 0===a?void 0:a.length)&&void 0!==s?s:0]})]})]})})})}):(0,h.jsx)(z.Z.Simple,{})};eO.componentName="Geometry",eO.Add=ew;let eT=async(e,t)=>{let l=await (0,$.R)("/api/result",{method:"POST",headers:{Accept:"application/json"},body:JSON.stringify({simulation:e,result:t})});return l.json()},eA=async(e,t)=>(0,$.R)("/api/result/download",{method:"POST",body:JSON.stringify({simulation:e,result:t})}),eL=async e=>(0,$.R)("/api/result/archive",{method:"POST",body:JSON.stringify({simulation:e})});var ez={load:eT,download:eA,archive:eL},eR=l(83159),eI=l(96074),e_=l(72269),eF=l(57953),eD=l(41428),eU=l(38095),eV=l(86350),eB=l(15668),eW=l(35598),eH=l(74317),eG=l(49591),eY=l(19478),eJ=l(87784),eX=l(75843),eq=l(15611),eK=l(69980),e$=l(62992),eQ=l(53073),e0=l(99477),e1=l(57632),e2=l(79753),e5=l(54327);let e4=e=>{let t=new e0.fHI(.025,.025,.8,50);t.translate(0,.4,0);let l=new e0.vBJ({color:e}),a=new e0.Kj0(t,l),i=new e0.b_z(.05,.2,50);i.translate(0,.9,0);let n=new e0.vBJ({color:e}),s=new e0.Kj0(i,n),r=new e0.ZAu;r.type="ArrowHelper",r.add(a),r.add(s);let o=()=>{t.dispose(),l.dispose(),i.dispose(),n.dispose()};return r.dispose=o,r},e3=(e,t,l)=>{var a,i;let n=document.createElement("canvas");n.width=null!==(a=null==l?void 0:l.width)&&void 0!==a?a:256,n.height=256;let s=n.getContext("2d");(null==l?void 0:l.background)&&(s.fillStyle=l.background,s.fillRect(0,0,n.width,n.height)),s.fillStyle="grey",s.font="50px sans-serif",s.textAlign=null!==(i=null==l?void 0:l.align)&&void 0!==i?i:"center",s.textBaseline="middle",s.fillText(t,n.width/2,n.height/2);let r=new e0.xEZ(n);r.flipY=!0,r.needsUpdate=!0;let o=new e0.xeV({map:r,transparent:!0,depthWrite:!1});o.map.anisotropy=e.capabilities.getMaxAnisotropy();let u=new e0.jyi(o);u.type="LabelHelper",(null==l?void 0:l.position)&&u.position.copy(l.position),(null==l?void 0:l.scale)&&u.scale.setScalar(l.scale);let d=()=>{r.dispose(),o.dispose()};return u.dispose=d,u},e8=function(e,t){let{offsetWidth:l,offsetHeight:a,width:i,height:n}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{offsetWidth:0,offsetHeight:0,width:150,height:150},s=l,r=a,o=i,u=n,d=e4("red");d.rotateZ(-Math.PI/2);let c=e3(e,"X",{position:new e0.Pa4(1.1,0,0)}),m=e4("green"),h=e3(e,"Y",{position:new e0.Pa4(0,1.1,0)}),p=e4("blue");p.rotateX(Math.PI/2);let y=e3(e,"Z",{position:new e0.Pa4(0,0,1.1)}),v=new e0.xo$(.05,50,50),x=new e0.vBJ({color:"black"}),g=new e0.Kj0(v,x),f=new e0.ZAu;f.type="AxisHelper",f.add(d),f.add(c),f.add(m),f.add(h),f.add(p),f.add(y),f.add(g);let b=new e0.xsS;b.add(f);let j=new e0.iKG(-1.2,1.2,1.2,-1.2,-2,2),w=e=>{let{newOffsetWidth:t,newOffsetHeight:l,newWidth:a,newHeight:i}=e;s=t,r=l,o=a,u=i},Z=()=>{e.setViewport(s,r,o,u),j.rotation.copy(t.rotation),e.render(b,j)},C=()=>{v.dispose(),x.dispose(),f.children.forEach(e=>{("ArrowHelper"===e.type||"LabelHelper"===e.type)&&e.dispose()}),b.remove(f)};return{dispose:C,render:Z,resize:w}},e6=(e,t,l,a,i,n)=>{let{smooth:s,radius:r,left:o,down:u}=i,{xc:d,yc:c,uc:m,vc:h}=n;for(let i=0;i<=s;i++){let n=Math.PI/2*(e+i/s),p=Math.cos(n),y=Math.sin(n);if(t.push(d+r*p,c+r*y,0),l.push(m+o*p,h+u*y),i<s){let t=(s+1)*e+i+4;a.push(e,t,t+1)}}},e7=(e,t,l,a)=>{let i=e/2-l,n=t/2-l,s=l/e,r=(e-l)/e,o=l/t,u=(t-l)/t,d=[i,n,0,-i,n,0,-i,-n,0,i,-n,0],c=[r,u,s,u,s,o,r,o],m=[3*(a+1)+3,3*(a+1)+4,a+4,a+5,2*(a+1)+4,2,1,2*(a+1)+3,3,4*(a+1)+3,4,0],h=[m[0],m[1],m[2],m[0],m[2],m[3],m[4],m[5],m[6],m[4],m[6],m[7],m[8],m[9],m[10],m[8],m[10],m[11]];for(let e=0;e<4;e++){let t=e<1||e>2?i:-i,m=e<2?n:-n,p=e<1||e>2?r:s,y=e<2?u:o;e6(e,d,c,h,{smooth:a,radius:l,left:s,down:o},{xc:t,yc:m,uc:p,vc:y})}let p=new e0.u9r;return p.setIndex(new e0.lCJ(h,1)),p.setAttribute("position",new e0.a$l(d,3)),p.setAttribute("uv",new e0.a$l(c,2)),p},e9=function(e,t,l,a){let{offsetWidth:i,offsetHeight:n,width:s,height:r}=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{offsetWidth:0,offsetHeight:0,width:150,height:150},o="#d3d3d3",u=null,d=null,c=[{text:"FRONT",normal:new e0.Pa4(0,0,1),up:new e0.Pa4(0,1,0)},{text:"BACK",normal:new e0.Pa4(0,0,-1),up:new e0.Pa4(0,1,0)},{text:"RIGHT",normal:new e0.Pa4(1,0,0),up:new e0.Pa4(0,1,0)},{text:"LEFT",normal:new e0.Pa4(-1,0,0),up:new e0.Pa4(0,1,0)},{text:"UP",normal:new e0.Pa4(0,1,0),up:new e0.Pa4(0,0,-1)},{text:"DOWN",normal:new e0.Pa4(0,-1,0),up:new e0.Pa4(0,0,1)}],m=e7(75,75,25,20),h=new e0.xo$(37.5,10,10,0,Math.PI,0),p=new e0.ZAu;c.forEach(e=>{let t=document.createElement("canvas"),l=t.getContext("2d");t.width=t.height=256,l.fillStyle=o,l.fillRect(0,0,t.width,t.height),l.font="bold 50pt sans-serif",l.fillStyle="#000000",l.textAlign="center",l.textBaseline="middle",l.fillText(e.text,t.width/2,t.height/2);let a=new e0.ROQ(t);a.needsUpdate=!0;let i=new e0.vBJ({map:a,transparent:!0,opacity:.75}),n=new e0.vBJ({color:o}),s=new e0.Kj0(m,i),r=new e0.Kj0(m,n);r.rotateY(Math.PI);let u=new e0.vBJ({color:o,transparent:!0,opacity:.2}),d=new e0.Kj0(h,u),c=new e0.ZAu;c.add(s,r,d),c.lookAt(e.normal),c.translateZ(50),c.normal=e.normal,c.up=e.up,p.add(c)});let y=new e0.Mig("#ffffff",1),v=new e0.xsS;v.add(p),v.add(y);let x=new e0.iKG(-100,100,100,-100,-100,100);x.position.z=2;let g=new e0.iMs,f=e=>{let t=b(e);j(t)?(u=w(t),Z(),(null==u?void 0:u.uuid)!==(null==d?void 0:d.uuid)&&(C(),d=u)):(u=null,C())},b=e=>{let t=e.target,l=t.getBoundingClientRect(),a=e.clientX-l.left,o=e.clientY-l.top,u=new e0.FM8;return u.x=(a-i)/s*2-1,u.y=-(2*((o+r-l.height+n)/r))+1,u},j=e=>e.x>-1&&e.x<1&&e.y>-1&&e.y<1,w=e=>{let t=new e0.Pa4(e.x,e.y,-1);t.unproject(x);let l=new e0.Pa4;x.getWorldDirection(l),g.set(t,l);let a=g.intersectObjects(v.children,!0);return a.length?a[0].object.parent:null},Z=()=>{var e;null==u||null===(e=u.children)||void 0===e||e.forEach(e=>{var t;let l=e;(null===(t=l.material)||void 0===t?void 0:t.color)&&(l.material.previousColor=l.material.color,l.material.color=new e0.Ilk("#FAD114"))})},C=()=>{var e;null==d||null===(e=d.children)||void 0===e||e.forEach(e=>{var t;let l=e;(null===(t=l.material)||void 0===t?void 0:t.color)&&(l.material.color=new e0.Ilk(o))})},k=e=>{if(u){var i;let n=u.normal,s=u.up,r=new e0.Pa4;null===(i=t.boundingBox)||void 0===i||i.getCenter(r);let o=l.position.distanceTo(a.target),d=n.clone().multiplyScalar(o),c=r.add(d);l.position.copy(c),l.up.copy(s),u=null,C(),f(e)}};e.domElement.addEventListener("pointermove",f),e.domElement.addEventListener("pointerdown",k);let S=e=>{let{newOffsetWidth:t,newOffsetHeight:l,newWidth:a,newHeight:o}=e;i=t,n=l,s=a,r=o},P=()=>{e.setViewport(i,n,s,r),x.rotation.copy(l.rotation),e.render(v,x)},E=()=>{e.domElement.removeEventListener("pointermove",f),e.domElement.removeEventListener("pointerdown",k),p.children.forEach(e=>{e.children.forEach(e=>{e.geometry.dispose(),e.material.dispose()})}),v.remove(p)};return{resize:S,render:P,dispose:E}},te=e=>1e-12>Math.abs(e)?"0":Math.abs(e)>1e3||.001>Math.abs(e)?e.toExponential(2):e.toFixed(3),tt=(e,t,l,a)=>{let i,n,s;let r=e=>{let t=Math.max(e.x,e.y,e.z),l=Math.max(Math.ceil(e.x/t*5),2),a=Math.max(Math.ceil(e.y/t*5),2),i=Math.max(Math.ceil(e.z/t*5),2);return new e0.Pa4(l,a,i)},o=(e,t,l,a,i)=>{let n=new e0.ZAu,s=new e0.nls({color:8947848}),r=new e0.Pa4(-e/2,0,-t/2),o=e/(l-1),u=t/(a-1);for(let t=0;t<a;++t){let l=new e0.u9r().setFromPoints([new e0.Pa4(r.x,0,r.z+t*u),new e0.Pa4(r.x+e,0,r.z+t*u)]);n.add(new e0.x12(l,s))}for(let e=0;e<l;++e){let l=new e0.u9r().setFromPoints([new e0.Pa4(r.x+e*o,0,r.z),new e0.Pa4(r.x+e*o,0,r.z+t)]);n.add(new e0.x12(l,s))}return null==i||i(n),n},u=(t,l,a,i)=>{let n=new e0.ZAu,s=Math.abs(l-t),r=s/(i-1),o=new e0.Pa4().copy(a).multiplyScalar(-s/2),u=new e0.Pa4().copy(a).multiplyScalar(r),d=t;for(let t=0;t<i;++t){let t=e3(e,te(d));t.position.copy(o),n.add(t),o.add(u),d+=r}return n},d=()=>{let e=t.boundingBox,l=t.boundingSphere.center,a=new e0.Pa4(e.max.x-e.min.x,e.max.y-e.min.y,e.max.z-e.min.z),s=r(a);n=1*(i=.1*Math.max(a.x,a.y,a.z));let d=new e0.ZAu,c=o(a.x,a.z,s.x,s.z),m=o(a.x,a.y,s.x,s.y,e=>{e.rotateX(Math.PI/2)}),h=o(a.y,a.z,s.y,s.z,e=>{e.rotateZ(-Math.PI/2)});d.add(c,m,h);let p=u(e.min.x,e.max.x,new e0.Pa4(1,0,0),s.x),v=u(e.min.y,e.max.y,new e0.Pa4(0,1,0),s.y),x=u(e.min.z,e.max.z,new e0.Pa4(0,0,1),s.z);return d.add(p,v,x),d.position.set(l.x,l.y,l.z),d.type="GridHelper",d.dispose=y,d},c=e=>e<=0?-1:1,m=e=>.5>=Math.abs(e)?1:-1,h=()=>{let e=t.boundingBox,r=new e0.Pa4(e.max.x-e.min.x,e.max.y-e.min.y,e.max.z-e.min.z),o=!1;t.children.forEach(e=>{"GridHelper"===e.type&&(o=e.visible,t.remove(e),e.dispose())}),s=d();let u=a.object.position.distanceTo(a.target);s.traverse(e=>{"LabelHelper"===e.type&&e.scale.setScalar(.05*u)});let h=new e0.Pa4;l.getWorldDirection(h);let p=u/10/(a.minDistance+.001),y=s.children[0],v=s.children[1],x=s.children[2];y.position.set(0,c(h.y)*(r.y/2+i),0),v.position.set(0,0,c(h.z)*(r.z/2+i)),x.position.set(c(h.x)*(r.x/2+i),0,0);let g=s.children[3],f=s.children[4],b=s.children[5];g.position.set(0,c(h.y)*m(h.y)*(r.y/2+n),-(c(h.z)*m(h.y)*(r.z/2+n))),f.position.set(c(h.x)*m(h.x)*(r.x/2+n),0,-(c(h.z)*m(h.x)*(r.z/2+n))),b.position.set(c(h.x)*m(h.x)*(r.x/2+n),-(c(h.y)*m(h.x)*(r.y/2+n)),0);let j=.2*p,w=.3*p;g.visible=Math.abs(h.y)>j||Math.abs(h.z)>w,f.visible=Math.abs(h.x)>w||Math.abs(h.z)>w,b.visible=Math.abs(h.x)>w||Math.abs(h.y)>j,s.visible=o,t.add(s)},p=e=>{s.visible=e},y=()=>{null==s||s.children.forEach(e=>{e.children.forEach(e=>{if("Line"===e.type){let t=e.geometry;t.dispose();let l=e.material;l.dispose()}else e.dispose()})})};return{dispose:y,setVisible:p,update:h}},tl=(e,t,l,a)=>{let i=document.createElement("div");i.style.pointerEvents="none",i.style.border="1px solid #55aaff",i.style.backgroundColor="rgba(75, 160, 255, 0.3)",i.style.position="fixed";let n=new e0.FM8,s=new e0.FM8,r=new e0.FM8,o=new e0.FM8,u=!1,d=!1,c=new e0.iMs,m=()=>{u=!0},h=()=>{u=!1},p=e=>{u&&0===e.button&&(d=!0,x(e))},y=e=>{u&&d&&g(e)},v=e=>{d=!1,u&&f(e)};e.domElement.addEventListener("pointerdown",p),e.domElement.addEventListener("pointermove",y),e.domElement.addEventListener("pointerup",v);let x=t=>{a.enabled=!1,e.domElement.parentElement.appendChild(i),i.style.left=t.clientX+"px",i.style.top=t.clientY+"px",i.style.width="0px",i.style.height="0px",n.x=t.clientX,n.y=t.clientY},g=e=>{o.x=Math.max(n.x,e.clientX),o.y=Math.max(n.y,e.clientY),r.x=Math.min(n.x,e.clientX),r.y=Math.min(n.y,e.clientY),i.style.left=r.x+"px",i.style.top=r.y+"px",i.style.width=o.x-r.x+"px",i.style.height=o.y-r.y+"px"},f=e=>{a.enabled=!0,i.parentElement&&i.parentElement.removeChild(i),s.x=e.clientX,s.y=e.clientY;let t=new e0.TUj(n,s);b(t),h()},b=i=>{let n=new e0.FM8(Math.abs(i.max.x-i.min.x),Math.abs(i.max.y-i.min.y));if(n.x<5||n.y<5)return;let s=new e0.FM8((i.max.x+i.min.x)/2,(i.max.y+i.min.y)/2),r=e.domElement.getBoundingClientRect(),o=s.x-r.left,u=s.y-r.top,d=new e0.FM8(o/r.width*2-1,-(2*(u/r.height))+1),m=t.children.find(e=>"Part"===e.type);if(!m)return;c.setFromCamera(d,l);let h=c.intersectObject(m);if(!h.length)return;a.target.copy(h[0].point);let p=new e0.FM8(n.x/r.width,n.y/r.height),y=Math.max(p.x,p.y),v=l.position.distanceTo(a.target),x=a.target.clone().sub(l.position).normalize().multiplyScalar(v*(1-y));l.position.add(x)},j=()=>{e.domElement.removeEventListener("pointerdown",p),e.domElement.removeEventListener("pointermove",y),e.domElement.removeEventListener("pointerup",v)};return{dispose:j,end:h,isEnabled:()=>u,start:m}},ta=(e,t,l,a)=>{let i,n,s;let r=new e0.Ilk("#fad114"),o=new e0.Ilk("#E98A15"),u=new e0.Pa4(-1,0,0),d=new e0.JOQ(u),c={up:new e0.Pa4,forward:new e0.Pa4,right:new e0.Pa4},m=new e0.Pa4,h=new e0.Pa4,p=new e0.USm,y=new e0.Pa4,v=new e0.FM8,x=new e0.JOQ,g=new e0.Pa4,f=new e0.Pa4,b=new e0.Zzh,j={up:new e0.Pa4,forward:new e0.Pa4,right:new e0.Pa4},w=new e0.iMs,Z=new e0.ZAu;Z.type="SectionViewHelper",Z.visible=!1,t.add(Z),(()=>{let e=new e0._12(1,1),t=new e0.vBJ({color:r,side:e0.ehD,transparent:!0,opacity:.5}),l=new e0.Kj0(e,t);l.type="Plane",Z.add(l)})(),(()=>{let e=new e0.xo$(.2,32,32,Math.PI,-Math.PI),t=new e0.vBJ({color:r,side:e0.ehD,transparent:!0,opacity:.5}),l=new e0.Kj0(e,t);l.type="Dome",Z.add(l)})(),(()=>{class e extends e0.Hyl{getPoint(e){return new e0.Pa4().set(this.radius*Math.cos(Math.PI*e),this.radius*Math.sin(Math.PI*e),0)}constructor(e){super(),this.radius=e}}let t=new e(.2);{let e=new e0.WXh(t,32,.020000000000000004,32),l=new e0.vBJ({color:r,side:e0.ehD,transparent:!0,opacity:.5}),a=new e0.Kj0(e,l);a.rotateX(Math.PI/2),a.type="ArcX",Z.add(a)}{let e=new e0.WXh(t,32,.020000000000000004,32),l=new e0.vBJ({color:r,side:e0.ehD,transparent:!0,opacity:.5}),a=new e0.Kj0(e,l);a.rotateX(Math.PI/2),a.rotateY(Math.PI/2),a.type="ArcY",Z.add(a)}})();let C=()=>{let e=new e0.Pa4;t.boundingBox.getSize(e),e.multiplyScalar(1.2);let l=Math.max(Math.max(e.x,e.y),e.z);Z.scale.setScalar(l)},k=()=>{let e=new e0.Pa4;t.boundingBox.getCenter(e),Z.position.copy(e)},S=()=>{let e=Z.visible;Z.visible=!e},P=()=>{e.localClippingEnabled=!0,Z.visible=!0,C(),k();let t=new e0.Pa4().copy(Z.position).sub(u);Z.lookAt(t),d.setFromNormalAndCoplanarPoint(u,Z.position)},E=()=>{e.localClippingEnabled=!1,Z.visible=!1},M=e=>{if(k(),u.equals(e)){N();return}let t=new e0.Pa4().copy(Z.position).sub(e);Z.lookAt(t),d.setFromNormalAndCoplanarPoint(e,Z.position),u.copy(e)},N=()=>{Z.rotateX(Math.PI);let e=d.normal.multiplyScalar(-1);d.setFromNormalAndCoplanarPoint(e,Z.position)},O=()=>{Z.traverse(e=>{("Plane"===e.type||"Dome"===e.type||"ArcX"===e.type||"ArcY"===e.type)&&(e.geometry.dispose(),e.material.dispose())}),e.domElement.removeEventListener("pointermove",_),e.domElement.removeEventListener("pointerdown",G),e.domElement.removeEventListener("pointerup",Y)},T=e=>{let t=e.target,l=t.getBoundingClientRect(),a=e.clientX-l.left,i=e.clientY-l.top,n=new e0.FM8;return n.x=a/l.width*2-1,n.y=-(2*(i/l.height))+1,n},A=e=>{i&&i.material.color.set(r),i=e,e&&e.material.color.set(o)},L=()=>{a.enabled=!0},z=()=>{a.enabled=!1},R=()=>{l.getWorldDirection(c.forward),c.forward.normalize(),c.up.copy(l.up).normalize(),c.right.crossVectors(c.up,c.forward).normalize()},I=()=>{let e=new e0.Pa4(0,0,1).applyQuaternion(Z.quaternion).multiplyScalar(-1);d.setFromNormalAndCoplanarPoint(e,Z.position)},_=e=>{if(!Z.visible)return;let t=T(e);if(w.setFromCamera(t,l),n){let e=new e0.Pa4;w.ray.intersectPlane(x,e),(null==s?void 0:s.type)==="Plane"?D(e):(null==s?void 0:s.type)==="Dome"?V(t):W(e),I()}else{let e=w.intersectObject(Z);e.length?(z(),A(s=e[0].object),h.copy(e[0].point),R()):(s=null,A(),L())}},F=()=>{x.setFromNormalAndCoplanarPoint(c.forward,h),m.copy(Z.position);let e=new e0.Pa4;w.ray.intersectPlane(x,e),g.copy(e).sub(m),f.copy(g).normalize(),b.set(m,new e0.Pa4().copy(m).add(d.normal))},D=e=>{e.sub(g);let t=new e0.Pa4;b.closestPointToPoint(e,!1,t),Z.position.copy(t)},U=e=>{p.copy(Z.rotation),v.copy(e)},V=e=>{Z.rotation.copy(p),Z.rotateOnWorldAxis(c.up,-(5*(v.x-e.x))),Z.rotateOnWorldAxis(c.right,-(5*(v.y-e.y)))},B=()=>{s.getWorldDirection(y),p.copy(Z.rotation),g.copy(h).sub(Z.position),f.copy(g).normalize(),j.up.copy(f),j.right.copy(y),j.forward.crossVectors(j.right,j.up),b.set(h,new e0.Pa4().copy(h).add(j.forward)),x.setFromNormalAndCoplanarPoint(c.forward,h)},W=e=>{let t=a.object.position.distanceTo(a.target),l=new e0.Pa4;b.closestPointToPoint(e,!1,l);let i=h.distanceTo(l);l.sub(h);let n=new e0.Pa4().copy(f).cross(l).normalize(),s=Math.sign(y.dot(n));Z.rotation.copy(p),Z.rotateOnWorldAxis(y,s*i*1/(t/100))},H=e=>{switch(null==s?void 0:s.type){case"Plane":F();break;case"Dome":U(e);break;case"ArcX":case"ArcY":B()}},G=e=>{if(Z.visible&&s){n=!0;let t=T(e);H(t)}},Y=()=>{Z.visible&&(n=!1,A())};return e.domElement.addEventListener("pointermove",_),e.domElement.addEventListener("pointerdown",G),e.domElement.addEventListener("pointerup",Y),{getClippingPlane:()=>d,toggleVisible:S,start:P,stop:E,toAxis:M,flip:N,dispose:O}};var ti=l(54104);let tn=e=>{let t=new ti.A("rainbow",512);t.setMin(Number.MAX_VALUE),t.setMax(-Number.MAX_VALUE);let l=new e0.xsS,a=new e0.iKG(-1,1,1,-1,2,1);a.position.set(0,0,1);let i=new e0.ZAu;l.add(i);let n=!1,s=e=>{l.children.forEach(t=>{t.children.forEach(t=>t.visible=e)})},r=()=>{l.children.forEach(e=>{e.children.forEach(t=>{"LabelHelper"===t.type&&t.dispose(),"Sprite"===t.type&&t.dispose(),e.remove(t)})})},o=e=>{if(!n){let l=t.minV,a=t.maxV;t.setMin(Math.min(l,e.minV)),t.setMax(Math.max(a,e.maxV))}let l=new e0.ROQ(t.createCanvas()),a=new e0.xeV({map:l,depthWrite:!1}),s=new e0.jyi(a);s.material.rotation=-Math.PI/2,s.scale.x=.2,s.scale.y=1.2,s.renderOrder=1,s.dispose=s.material.dispose,i.add(s),u(t)},u=t=>{let l=te(t.minV),a=te(t.maxV),n=e3(e,String(l),{background:"white",position:new e0.Pa4(-.62,0,0),width:512,align:"right"});n.scale.x=.4,n.scale.y=2.8,n.renderOrder=0;let s=e3(e,String(a),{background:"white",position:new e0.Pa4(.62,0,0),width:512,align:"left"});s.scale.x=.4,s.scale.y=2.8,s.renderOrder=0,i.add(n),i.add(s)},d=e=>{t.setColorMap(e,512)},c=(e,l)=>{n=!0,t.setMin(e),t.setMax(l)},m=()=>{n=!1,t.setMin(Number.MAX_VALUE),t.setMax(-Number.MAX_VALUE)},h=e=>t.getColor(e),p=()=>{let t=e.domElement.getBoundingClientRect();e.setViewport(t.width/2-350,t.height-50,700,50),e.render(l,a)},y=()=>{n||(t.setMin(Number.MAX_VALUE),t.setMax(-Number.MAX_VALUE)),r()};return{render:p,addLUT:o,getMinV:()=>t.minV,getMaxV:()=>t.maxV,getColor:h,setVisible:s,setColorMap:d,setRange:c,setAutomaticRange:m,dispose:y}},ts=e=>{let t=new e0.ZAu;t.type="PointHelper",t.visible=!1,e.add(t);let l=()=>{var t,l;let a=(null!==(l=null===(t=e.boundingSphere)||void 0===t?void 0:t.radius)&&void 0!==l?l:1)/100,i=new e0.xo$(a),n=new e0.Wid({color:16711680});return new e0.Kj0(i,n)},a=(e,t)=>{let l=new e0.u9r().setFromPoints([e,t]),a=new e0.nls({color:16711680});return new e0.x12(l,a)},i=()=>{let t=[],l=e.boundingBox.max.x-e.boundingBox.min.x,i=e.boundingBox.max.y-e.boundingBox.min.y,n=e.boundingBox.max.z-e.boundingBox.min.z,s=Math.max(l,i,n),r=a(new e0.Pa4(-s/2,0,0),new e0.Pa4(s/2,0,0));t.push(r);let o=a(new e0.Pa4(0,-s/2,0),new e0.Pa4(0,s/2,0));t.push(o);let u=a(new e0.Pa4(0,0,-s/2),new e0.Pa4(0,0,s/2));return t.push(u),t},n=()=>{r();let e=l(),a=i();t.add(e),t.add(...a)},s=e=>{e?(t.position.set(e.x,e.y,e.z),t.visible=!0):t.visible=!1},r=()=>{t.children.forEach(e=>{t.remove(e),e.geometry.dispose(),e.material.dispose()})};return{build:n,dispose:r,update:s}};var tr=l(77836),to=l(82854),tu=l(6648),td=l(48764).lW;let tc=(e,t)=>{e.traverse(e=>{if("Mesh"===e.type){let l=e,a=new e0.Uk6(l.geometry),i=new e0.nls({color:l.material.color,linewidth:1}),n=new e0.ejS(a,i);l.add(n),l.material.visible=!1,l.material.clippingPlanes=[t]}})},tm=(e,t)=>{e.traverse(e=>{if("Mesh"===e.type||"Line"===e.type){let l=e,a=l.geometry.getAttribute("data");if(a){let e=a.array.reduce((e,t)=>Math.min(e,t),a.array[0]),t=a.array.reduce((e,t)=>Math.max(e,t),a.array[0]);e===t&&(e-=1,t+=1);let i=new ti.A;i.setMin(e),i.setMax(t),l.userData={...l.userData,lut:i}}if("Mesh"===e.type){let e=new e0.Uk6(l.geometry),t=new e0.nls({linewidth:1}),a=new e0.ejS(e,t);l.add(a)}l.material.vertexColors=!0,l.material.clippingPlanes=[t]}})},th=(e,t)=>{e.traverse(e=>{if("Mesh"===e.type){let l=e;l.material.clippingPlanes=[t],l.material.originalColor=l.material.color}})},tp=(e,t)=>{let l=new e0.Ilk("#FAD114"),a=new e0.Ilk("#EE9817"),i=async(e,t,l,a)=>{let i=new Blob([td.from(e.buffer)]),u=URL.createObjectURL(i),d=new tr.E,c=new to._;c.setDecoderPath("/three/libs/draco/"),d.setDRACOLoader(c);let m=new tu.a;m.setTranscoderPath("node_modules/three//examples/js/libs/basis/"),d.setKTX2Loader(m);let h=await new Promise((e,t)=>{d.load(u,t=>{e(t)},()=>void 0,e=>t(e))}),g=h.scene,f=new e0.Tme;return f.type="Part",f.uuid=e.summary.uuid,f.children=g.children,f.userData=g.userData,"mesh"===e.summary.type?tc(f,a):"result"===e.summary.type?tm(f,a):("geometry3D"===e.summary.type||"geometry2D"===e.summary.type)&&th(f,a),r(f,t),o(f,l),f.boundingBox=n(f),f.dispose=()=>s(f),f.setTransparent=e=>r(f,e),f.setDisplayMesh=e=>o(f,e),f.startSelection=(e,t,l)=>v(f,e,t,l),f.stopSelection=()=>x(),f.getHighlighted=()=>p,f.getSelected=()=>y,f.highlight=k,f.unhighlight=S,f.select=E,f.unselect=M,f},n=e=>{let t=new e0.ZzF;return e.traverse(e=>{t.expandByObject(e)}),t},s=e=>{e.traverse(e=>{"Mesh"===e.type&&(e.geometry.dispose(),e.material.dispose())})},r=(e,t)=>{e.traverse(e=>{if("Mesh"===e.type){let l=e;l.material.transparent=t,l.material.opacity=t?.5:1,l.material.depthWrite=!t}})},o=(e,t)=>{"result"===e.userData.type&&e.traverse(e=>{e.traverse(e=>{if("LineSegments"===e.type){let l=e;l.visible=t}})})},u=new e0.iMs,d=null,c=null,m=null,h=null,p=null,y=[],v=(e,t,l,a)=>{d=e,c=a,m=t,h=l,p=null,y.length=0,m.domElement.addEventListener("pointermove",C),m.domElement.addEventListener("pointerdown",P)},x=()=>{null==m||m.domElement.removeEventListener("pointermove",C),null==m||m.domElement.removeEventListener("pointerdown",P),S(),p=null,y.forEach(e=>{M(e.uuid)}),y.length=0,c=null,d=null,m=null,h=null},g=(e,t)=>{let l;if(e&&t)return e.traverse(e=>{e.userData.uuid===t&&(l=e)}),l},f=e=>{let t=e.target,l=t.getBoundingClientRect(),a=e.clientX-l.left,i=e.clientY-l.top,n=new e0.FM8;return n.x=a/l.width*2-1,n.y=-(2*(i/l.height))+1,n},b=()=>{let t=u.intersectObject(d,!0);if(t.length){let l=t[0].object,a=l.parent;a&&e(d,a.userData.uuid,a.userData.label)}else e(d)},j=()=>{let t;let l=d.userData;if(2===l.dimension){if((t=u.intersectObject(d,!0)).length){let l=t[0].object,a=l.parent;(null==a?void 0:a.type)==="Mesh"?e(d,a.userData.uuid,a.userData.label):e(d,l.userData.uuid,l.userData.label)}else e(d)}else if((t=u.intersectObject(d,!0)).length){let l=t[0].object;e(d,l.userData.uuid,l.userData.label)}else e(d)},w=()=>{let t;let l=d.userData,a=l.edges;if((t=u.intersectObject(d,!0)).length){let l=t[0].object,i=null==a?void 0:a.find(e=>e.uuid===l.userData.uuid);i?e(d,l.userData.uuid,l.userData.label):e(d)}else e(d)},Z=()=>{let t=u.intersectObject(d,!0);if(t.length){let l=t[0];e(d,void 0,void 0,l.point)}else e(d)},C=e=>{let t=f(e);switch(u.setFromCamera(t,h),c){case"solids":b();break;case"faces":j();break;case"edges":w();break;case"point":Z()}},k=e=>{if(e===(null==p?void 0:p.uuid))return;S();let t=g(d,e);if(t){if(p={uuid:t.userData.uuid,label:t.userData.label},"Mesh"===t.type){let e=t;e.material.color=l}else t.traverse(e=>{if("Mesh"===e.type){let t=e;t.material.color=l}})}},S=()=>{let e=g(d,null==p?void 0:p.uuid);if(p=null,!e)return;let t=y.findIndex(t=>t.uuid===e.userData.uuid);if("Mesh"===e.type){let l=e;l.material.color=-1===t?l.material.originalColor:a}else e.traverse(e=>{if("Mesh"===e.type){let l=e;l.material.color=-1===t?l.material.originalColor:a}})},P=()=>{p&&t(d,p.uuid,p.label)},E=e=>{let t=g(d,e);if(t){if(y.push({uuid:e,label:t.userData.label}),"Mesh"===t.type){let e=t;e.material.color=a}else t.traverse(e=>{if("Mesh"===e.type){let t=e;t.material.color=a}})}},M=e=>{let t=g(d,e),l=y.findIndex(t=>t.uuid===e);if(-1!==l&&(y=[...y.slice(0,l),...y.slice(l+1)]),t){if("Mesh"===t.type){let e=t;e.material.color=e.material.originalColor}else t.traverse(e=>{if("Mesh"===e.type){let t=e;t.material.color=t.material.originalColor}})}};return{load:i}},ty=()=>({type:W.ENABLE}),tv=()=>({type:W.DISABLE}),tx=e=>({type:W.SETTYPE,value:e}),tg=e=>({type:W.SETPART,value:e}),tf=e=>{let{uuid:t,label:l}=e;return{type:W.HIGHLIGHT,value:{uuid:t,label:l}}},tb=()=>({type:W.UNHIGHLIGHT}),tj=e=>{let{uuid:t,label:l}=e;return{type:W.SELECT,value:{uuid:t,label:l}}},tw=e=>{let{uuid:t,label:l}=e;return{type:W.UNSELECT,value:{uuid:t,label:l}}},tZ=e=>({type:W.SETPOINT,value:e});var tC=l(72735),tk=l(60968),tS=l.n(tk);let tP={load:"Error while loading part",snapshot:"Error while taking snapshot",saveScreenshot:"Unable to save screenshot"},tE=!1,tM=e=>{let t=new e0.ZzF;e.children.forEach(e=>{if(e.visible&&"Part"===e.type){let l=e.boundingBox,a=new e0.Pa4(Math.min(t.min.x,l.min.x),Math.min(t.min.y,l.min.y),Math.min(t.min.z,l.min.z)),i=new e0.Pa4(Math.max(t.max.x,l.max.x),Math.max(t.max.y,l.max.y),Math.max(t.max.z,l.max.z));t.set(a,i)}});let l=new e0.aLr;t.getBoundingSphere(l),e.boundingBox=t,e.boundingSphere=l},tN=(e,t,l)=>{let a=t.object.position.distanceTo(t.target),i=t.target.clone().sub(e.position).normalize().multiplyScalar(a*l*.01);e.position.add(i)},tO=(e,t,l)=>{let a=e.children.find(e=>"Part"===e.type);if(!a)return;tE=!0;let i=e.boundingSphere,n=i.center,s=2*i.radius,r=s/(2*Math.atan(Math.PI*t.fov/360)),o=r/t.aspect,u=1.1*Math.max(r,o),d=l.target.clone().sub(t.position).normalize().multiplyScalar(u);l.target.copy(n),l.minDistance=u/10,l.maxDistance=10*u,t.position.copy(n).sub(d),t.near=u/100,t.far=100*u,t.updateProjectionMatrix()},tT=async(e,t,l,a,i,n,s)=>{let r=(e,t,l,a)=>{t?(e.highlight(t),setTimeout(()=>s(tf({uuid:t,label:l})),1)):a?s(tZ({x:a.x,y:a.y,z:a.z})):(e.unhighlight(),setTimeout(()=>s(tb()),1))},o=(e,t,l)=>{let a=e.getSelected();a.find(e=>e.uuid===t)?(e.unselect(t),setTimeout(()=>s(tw({uuid:t,label:l})),1)):(e.select(t),setTimeout(()=>s(tj({uuid:t,label:l})),1))},u=tp(r,o),d=await u.load(e,i.transparent,i.displayMesh,n.sectionViewHelper.getClippingPlane());t.add(d),tM(t),tE||tO(t,l,a),n.gridHelper.update(),n.gridHelper.update(),n.gridHelper.setVisible(!0),n.pointHelper.build()},tA=(e,t)=>{for(let l of(t.dispose(),t.setVisible(!1),e.children))"Part"===l.type&&"result"===l.userData.type&&l.traverse(e=>{("Mesh"===e.type||"Line"===e.type)&&(t.addLUT(e.userData.lut),t.setVisible(!0))})},tL=(e,t)=>{for(let l of(tA(e,t),e.children))"Part"===l.type&&"result"===l.userData.type&&l.traverse(e=>{if("Mesh"===e.type||"Line"===e.type){let l=e.geometry.getAttribute("data"),a=new Float32Array(3*l.count);for(let e=0;e<l.count;e++){let i=t.getColor(l.array[e]);a[3*e+0]=i.r,a[3*e+1]=i.g,a[3*e+2]=i.b}e.geometry.setAttribute("color",new e0.a$l(a,3))}})},tz=async(e,t,l,a)=>{try{let i=a.domElement.width,n=a.domElement.height,s=l.aspect;a.domElement.width=520,a.domElement.height=312,l.aspect=520/312,l.updateProjectionMatrix(),a.clear(),a.setViewport(0,0,520,312),a.render(t,l);let r=a.domElement.toDataURL();a.domElement.width=i,a.domElement.height=n,l.aspect=s,l.updateProjectionMatrix(),await tC.Z.add({name:"snapshot",uid:"snapshot_"+(0,e1.Z)(),data:r},{id:e.id})}catch(e){(0,V.lt)(tP.snapshot,e)}},tR=(e,t,l,a)=>{try{let i=a.domElement.width,n=a.domElement.height;a.clear(),a.setViewport(0,0,i,n),a.render(t,l);let s=a.domElement.toDataURL(),r=document.createElement("a");r.href=s.replace("image/png","image/octet-stream"),r.download=e.title+"_"+new Date().toLocaleDateString()+".png",r.click()}catch(e){(0,V.lt)(tP.saveScreenshot,e)}},tI=e=>{var t,l,i,n,s;let{loading:r,project:o,parts:u}=e,d=(0,x.useRef)(null),c=(0,x.useRef)(),m=(0,x.useRef)(),p=(0,x.useRef)(),y=(0,x.useRef)(),b=(0,x.useRef)(),j=(0,x.useRef)(),Z=(0,x.useRef)(),k=(0,x.useRef)(),S=(0,x.useRef)(),[P,E]=(0,x.useState)(!1),[M,N]=(0,x.useState)(!0),[T,A]=(0,x.useState)(!1),[z,R]=(0,x.useState)(!1),[I,_]=(0,x.useState)(!1),[F,D]=(0,x.useState)(!1),U=(0,v.useRouter)(),{enabled:B,part:W,highlighted:G,selected:Y,point:J,type:X,dispatch:q}=(0,x.useContext)(H);(0,x.useEffect)(()=>{var e;if(!e5.Z.isWebGLAvailable()){(async()=>{await U.push("/webgl")})();return}let t=d.current,l=t.clientWidth,a=t.clientHeight;c.current=new e0.xsS,c.current.boundingBox=new e0.ZzF,c.current.boundingSphere=new e0.aLr,m.current=new e0.cPb(50,l/a,.1,1e3),m.current.position.z=10;let i=new e0.Mig("#aaa",.75);c.current.add(i);let n=new e0.cek("#fff",.5);n.decay=2,m.current.add(n),c.current.add(m.current),p.current=new e0.CP7({antialias:!0,alpha:!0}),p.current.setClearColor("#ffffff"),p.current.setSize(l,a),p.current.setPixelRatio(null!==(e=window.devicePixelRatio)&&void 0!==e?e:1),p.current.shadowMap.enabled=!0,p.current.autoClear=!1,t.appendChild(p.current.domElement),y.current=new e2.$(m.current,t),y.current.rotateSpeed=3,y.current.panSpeed=.1;let s=e8(p.current,m.current,{offsetWidth:l-155,offsetHeight:a-155,width:150,height:150}),r=e9(p.current,c.current,m.current,y.current,{offsetWidth:l-155,offsetHeight:a-155,width:150,height:150});b.current=tt(p.current,c.current,m.current,y.current),j.current=tl(p.current,c.current,m.current,y.current),Z.current=ta(p.current,c.current,m.current,y.current),k.current=tn(p.current),k.current.setVisible(!1),S.current=ts(c.current);let o=()=>{y.current.update(),p.current.setViewport(0,0,l,a),p.current.render(c.current,m.current),b.current.update(),s.render(),r.render(),k.current.render()},u=()=>{l=t.clientWidth,a=t.clientHeight,m.current.aspect=l/a,m.current.updateProjectionMatrix(),p.current.setSize(l,a),s.resize({newOffsetWidth:l-155,newOffsetHeight:a-155,newWidth:150,newHeight:150}),r.resize({newOffsetWidth:l-155,newOffsetHeight:a-155,newWidth:150,newHeight:150}),o()},h=()=>{o(),setTimeout(()=>requestAnimationFrame(h),1e3/30)};return window.addEventListener("resize",u),requestAnimationFrame(h),()=>{tE=!1,window.removeEventListener("resize",u),t.removeChild(p.current.domElement),c.current.children.forEach(e=>{c.current.remove(e)}),s.dispose(),r.dispose(),b.current.dispose(),Z.current.dispose(),j.current.dispose(),k.current.dispose(),S.current.dispose()}},[U]),(0,L.Z)(()=>{if(!c.current)return;let e=c.current.children;if(!u.length){var t;tM(c.current),b.current.update(),null===(t=S.current)||void 0===t||t.build()}let l=u.filter(t=>!e.find(e=>e.uuid===t.summary.uuid)),a=e.filter(e=>!u.find(t=>t.summary.uuid===e.uuid)).filter(e=>"Part"===e.type);a.forEach(e=>{var t;null===(t=c.current)||void 0===t||t.remove(e),e.dispose()}),(async()=>{await Promise.all(l.map(async e=>{try{await tT(e,c.current,m.current,y.current,{transparent:P,displayMesh:M},{gridHelper:b.current,sectionViewHelper:Z.current,pointHelper:S.current},q)}catch(e){(0,V.lt)(tP.load,e),tM(c.current)}})),tL(c.current,k.current)})()},[u,P,M,q]),(0,L.Z)(()=>{var e;if(c.current){if((null===(e=u[0])||void 0===e?void 0:e.summary.dimension)===2){tM(c.current);let e=new e0.Pa4(0,0,1),t=new e0.Pa4(0,1,0),l=new e0.Pa4;c.current.boundingBox.getCenter(l);let a=m.current.position.distanceTo(y.current.target),i=e.clone().multiplyScalar(a),n=l.add(i);m.current.position.copy(n),m.current.up.copy(t),y.current.noRotate=!0}else y.current.noRotate=!1}},[u]),(0,x.useEffect)(()=>{c.current&&c.current.children.forEach(e=>{"Part"===e.type&&e.userData.uuid===W&&(B?e.startSelection(p.current,m.current,X):e.stopSelection())})},[B,W,X]),(0,x.useEffect)(()=>{c.current&&c.current.children.forEach(e=>{if("Part"===e.type&&e.uuid===W){e.highlight(null==G?void 0:G.uuid);let t=e.getSelected(),l=Y.filter(e=>!t.find(t=>t.uuid===e.uuid));l.forEach(t=>{t.uuid&&e.select(t.uuid)});let a=t.filter(e=>!Y.find(t=>t.uuid===e.uuid));a.forEach(t=>{e.unselect(t.uuid)})}})},[W,G,Y]),(0,x.useEffect)(()=>{var e;c.current&&(null===(e=S.current)||void 0===e||e.update(J?new e0.Pa4(J.x,J.y,J.z):void 0))},[J]);let K=(0,x.useCallback)(e=>{E(e),c.current.children.forEach(t=>{"Part"===t.type&&t.setTransparent(e)})},[]),$=(0,x.useCallback)(e=>{N(e),c.current.children.forEach(t=>{"Part"===t.type&&t.setDisplayMesh(e)})},[]),Q=(0,x.useCallback)(()=>{let e=!T;A(e),e?Z.current.start():Z.current.stop()},[T]),ee=(0,x.useCallback)(()=>{(async()=>{R(!0);try{await tz(o,c.current,m.current,p.current)}finally{R(!1)}})()},[o]),et=(0,x.useCallback)(()=>{_(!0);try{tR(o,c.current,m.current,p.current)}finally{_(!1)}},[o]),el=(0,x.useCallback)(e=>{var t;null===(t=b.current)||void 0===t||t.setVisible(e)},[]),ea=(0,x.useCallback)(()=>{tN(m.current,y.current,1);let e=()=>ea();a=requestAnimationFrame(e)},[]),ei=(0,x.useCallback)(()=>{tN(m.current,y.current,-1);let e=()=>ei();a=requestAnimationFrame(e)},[]),en=(0,x.useCallback)(()=>{a&&cancelAnimationFrame(a),a=void 0},[]),es=(0,x.useCallback)(()=>{tO(c.current,m.current,y.current)},[]),er=(0,x.useCallback)(()=>{Z.current.toAxis(new e0.Pa4(-1,0,0))},[]),eo=(0,x.useCallback)(()=>{Z.current.toAxis(new e0.Pa4(0,-1,0))},[]),eu=(0,x.useCallback)(()=>{Z.current.toAxis(new e0.Pa4(0,0,-1))},[]),ed=(0,x.useCallback)(e=>{var t;null===(t=k.current)||void 0===t||t.setColorMap(e.key),tL(c.current,k.current)},[]),ec=(0,x.useCallback)(()=>{D(!0)},[]),eh=(0,x.useCallback)(()=>{D(!1)},[]),ey=(0,x.useCallback)(async e=>{var t;null===(t=k.current)||void 0===t||t.setRange(+e.min,+e.max),tL(c.current,k.current),eh()},[eh]),ev=(0,x.useCallback)(()=>{var e;null===(e=k.current)||void 0===e||e.setAutomaticRange(),tL(c.current,k.current)},[]);return(0,h.jsxs)(f.Z,{className:"".concat(ep().noScroll," ").concat(tS().view),children:[(0,h.jsxs)(em.ZP,{visible:F,title:"Custom range",initialValues:{min:null===(t=k.current)||void 0===t?void 0:t.getMinV(),max:null===(l=k.current)||void 0===l?void 0:l.getMaxV()},onCancel:eh,onOk:ey,children:[(0,h.jsx)(eZ.Z.Item,{label:"Min",name:"min",children:(0,h.jsx)(eC.Z,{})}),(0,h.jsx)(eZ.Z.Item,{label:"Max",name:"max",children:(0,h.jsx)(eC.Z,{})})]}),(0,h.jsxs)(f.Z.Header,{className:tS().head,children:[(0,h.jsx)(g.Z,{title:"Take snapshot",placement:"left",children:(0,h.jsx)(eR.Z,{placement:"bottom",menu:{items:[{key:"project",label:(0,h.jsx)(w.ZP,{type:"text",className:"".concat(ep().fullWidth," ").concat(ep().noBackground),loading:z,onClick:ee,children:"Project snapshot"})},{key:"image",label:(0,h.jsx)(w.ZP,{type:"text",className:"".concat(ep().fullWidth," ").concat(ep().noBackground),loading:I,onClick:et,children:"Export image"})}]},children:(0,h.jsx)(w.ZP,{icon:(0,h.jsx)(eD.Z,{})})})}),(0,h.jsx)(eI.Z,{style:{margin:0}}),(0,h.jsx)(g.Z,{title:"Display grid",placement:"left",children:(0,h.jsx)(e_.Z,{defaultChecked:!0,checkedChildren:(0,h.jsx)(eU.Z,{}),unCheckedChildren:(0,h.jsx)(eU.Z,{}),onChange:el})}),(0,h.jsx)(g.Z,{title:"Set transparency",placement:"left",children:(0,h.jsx)(e_.Z,{checked:P,checkedChildren:(0,h.jsx)(eV.Z,{}),unCheckedChildren:(0,h.jsx)(eV.Z,{}),onChange:K})}),(0,h.jsx)(eI.Z,{style:{margin:0}}),(0,h.jsx)(g.Z,{title:"Zoom out",placement:"left",children:(0,h.jsx)(w.ZP,{icon:(0,h.jsx)(eB.Z,{}),onMouseDown:ei,onMouseUp:en,onMouseOut:en})}),(0,h.jsx)(g.Z,{title:"Zoom in",placement:"left",children:(0,h.jsx)(w.ZP,{icon:(0,h.jsx)(eW.Z,{}),onMouseDown:ea,onMouseUp:en,onMouseOut:en})}),(0,h.jsx)(g.Z,{title:"Zoom to fit",placement:"left",children:(0,h.jsx)(w.ZP,{icon:(0,h.jsx)(eH.Z,{}),onClick:es})}),(0,h.jsx)(g.Z,{title:"Zoom to selection",placement:"left",children:(0,h.jsx)(w.ZP,{icon:(0,h.jsx)(eG.Z,{}),onClick:(null===(i=j.current)||void 0===i?void 0:i.isEnabled())?null===(n=j.current)||void 0===n?void 0:n.end:null===(s=j.current)||void 0===s?void 0:s.start})}),(0,h.jsx)(eI.Z,{style:{margin:0}}),!T&&(0,h.jsx)(g.Z,{title:"Section view",placement:"left",children:(0,h.jsx)(w.ZP,{icon:(0,h.jsx)(eY.Z,{}),onClick:Q})}),T&&(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)(g.Z,{title:"Stop",placement:"left",children:(0,h.jsx)(w.ZP,{icon:(0,h.jsx)(eJ.Z,{}),onClick:Q})}),(0,h.jsx)(g.Z,{title:"Hide plane",placement:"left",children:(0,h.jsx)(w.ZP,{icon:(0,h.jsx)(C.Z,{}),onClick:Z.current.toggleVisible})}),(0,h.jsx)(g.Z,{title:"Snap to X",placement:"left",children:(0,h.jsx)(w.ZP,{className:"ant-btn-icon-only",onClick:er,children:"X"})}),(0,h.jsx)(g.Z,{title:"Snap to Y",placement:"left",children:(0,h.jsx)(w.ZP,{className:"ant-btn-icon-only",onClick:eo,children:"Y"})}),(0,h.jsx)(g.Z,{title:"Snap to Z",placement:"left",children:(0,h.jsx)(w.ZP,{className:"ant-btn-icon-only",onClick:eu,children:"Z"})}),(0,h.jsx)(g.Z,{title:"Flip",placement:"left",children:(0,h.jsx)(w.ZP,{onClick:Z.current.flip,icon:(0,h.jsx)(eX.Z,{})})})]}),u.filter(e=>"result"===e.summary.type).length?(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)(eI.Z,{className:"no-margin"}),(0,h.jsx)(g.Z,{title:"Display result mesh",placement:"left",children:(0,h.jsx)(e_.Z,{checked:M,checkedChildren:(0,h.jsx)(eq.Z,{}),unCheckedChildren:(0,h.jsx)(eq.Z,{}),onChange:$})}),(0,h.jsx)(g.Z,{title:"Colormap",placement:"left",children:(0,h.jsx)(eR.Z,{placement:"bottom",menu:{items:[{key:"rainbow",label:"Rainbow"},{key:"cooltowarm",label:"Cool to warm"},{key:"blackbody",label:"Black body"},{key:"grayscale",label:"Gray scale"}],onClick:ed},children:(0,h.jsx)(w.ZP,{icon:(0,h.jsx)(eK.Z,{})})})}),(0,h.jsx)(g.Z,{title:"Custom range",placement:"left",children:(0,h.jsx)(w.ZP,{icon:(0,h.jsx)(e$.Z,{}),onClick:ec})}),(0,h.jsx)(g.Z,{title:"Automatic range",placement:"left",children:(0,h.jsx)(w.ZP,{icon:(0,h.jsx)(eQ.Z,{}),onClick:ev})})]}):null]}),(0,h.jsxs)(f.Z.Content,{className:"".concat(ep().noScroll," ").concat(tS().content),children:[(0,h.jsx)("div",{style:{display:r?"flex":"none"},className:tS().loading,children:(0,h.jsx)(eF.Z,{indicator:(0,h.jsx)(O.Z,{style:{fontSize:80},spin:!0})})}),(0,h.jsx)("div",{ref:d,className:tS().canvas})]})]})},t_={part:"Unable to load part"},tF=async(e,t,l)=>{try{if("geometry"===l){let e=await en.getPart({id:t.id});return{...e,extra:{id:t.id}}}{let l=await ez.load({id:e.id},{originPath:t.originPath,glb:t.glb});return{...l,extra:{glb:t.glb}}}}catch(e){throw(0,V.lt)(t_.part,e),e}},tD=async(e,t,l)=>Promise.all(l.map(async l=>{let a=t.find(e=>{var t;return(null===(t=e.extra)||void 0===t?void 0:t.glb)===l.glb});if(a)return a;let i=await tF(e,l,"result");return i})),tU=async(e,t,l)=>{if(!l)return;let a=t.find(e=>{var t;return(null===(t=e.extra)||void 0===t?void 0:t.glb)===l.glb});if(a)return a;let i=await tF(e,l,"result");return i},tV=async(e,t,l)=>Promise.all(l.map(async l=>{let a=t.find(e=>{var t;return(null===(t=e.extra)||void 0===t?void 0:t.id)===l.id});if(a)return a;let i=await tF(e,l,"geometry");return i})),tB=e=>{let{project:t,simulation:l,geometries:a,results:i,postprocessing:n}=e,[s,r]=(0,x.useState)([]),[o,u]=(0,x.useState)(!1);return(0,L.Z)(()=>{(async()=>{u(!0);try{let e=[];if(l&&!n){let t=await tD(l,s,i);e.push(...t)}if(l){let t=await tU(l,s,n);t&&e.push(t)}if(!i.length&&!n){let t=await tV(l,s,a);e.push(...t)}r(e)}catch(e){}finally{u(!1)}})()},[l,a,i,n,s]),(0,h.jsx)(tI,{loading:o,project:{id:t.id,title:t.title},parts:s})};var tW=l(34041),tH=l(39014),tG=l(44442),tY=l(23389),tJ=l(93398),tX=l(96486),tq=l(46210),tK=l(87782),t$=l(55276),tQ=l(99138),t0=l(57132);let t1={copy:"Unable to copy simulation"},t2=async(e,t,l)=>{try{let a=await q.Z.copy(t);await l.addOneSimulation(a),await l.mutateProject({id:e.id,simulations:[...e.simulations,a.id]})}catch(e){(0,V.lt)(t1.copy,e)}},t5=e=>{let{project:t,simulation:l,swr:a}=e,[i,n]=(0,x.useState)(!1),s=(0,x.useCallback)(()=>{(async()=>{n(!0);try{await t2(t,l,a)}finally{n(!1)}})()},[t,l,a]);return(0,h.jsx)(g.Z,{title:"Copy simulation",children:(0,h.jsx)(w.ZP,{className:ep().noBorder,loading:i,icon:(0,h.jsx)(t0.Z,{}),onClick:s})})},t4={update:"Unable to update simulation"},t3=async(e,t,l)=>{try{await q.Z.update({id:e.id},[{key:"name",value:t.name}]),await l.mutateOneSimulation({id:e.id,name:t.name})}catch(e){throw(0,V.lt)(t4.update,e),e}},t8=e=>{let{simulation:t,swr:l}=e,a=(0,x.useRef)(null),[i,n]=(0,x.useState)(!1),[s,r]=(0,x.useState)(!1);(0,x.useEffect)(()=>{a.current&&a.current.focus()});let o=(0,x.useCallback)(async e=>{r(!0);try{await t3(t,e,l),r(!1),n(!1)}catch(e){throw r(!1),e}},[t,l]),u=(0,x.useCallback)(()=>n(!0),[]),d=(0,x.useCallback)(()=>n(!1),[]);return(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)(U.w6,{onEdit:u}),(0,h.jsx)(em.ZP,{title:"Edit the simulation's name",visible:i,initialValues:{name:t.name},onCancel:d,onOk:o,loading:s,children:(0,h.jsx)(eZ.Z.Item,{name:"name",label:"Name:",rules:[{required:!0,message:"Name is required"}],children:(0,h.jsx)(eC.Z,{ref:a})})})]})},t6={del:"Unable to delete simulation"},t7=async(e,t,l)=>{try{await q.Z.del(t);let a=e.simulations.filter(e=>e!==t.id);await l.mutateProject({id:e.id,simulations:a}),await l.delOneSimulation({id:t.id})}catch(e){throw(0,V.lt)(t6.del,e),e}},t9=e=>{let{project:t,simulation:l,swr:a}=e,[i,n]=(0,x.useState)(!1),s=(0,x.useCallback)(async()=>{n(!0);try{await t7(t,l,a)}finally{n(!1)}},[t,l,a]);return(0,h.jsx)(U.m1,{loading:i,text:(0,h.jsxs)(h.Fragment,{children:["Are you sure you want to delete the simulation"," ",(0,h.jsx)(j.Z.Text,{strong:!0,children:l.name}),"?"]}),onDelete:s})},le=e=>{let{project:t,simulation:l,swr:a}=e;return t&&l?(0,h.jsx)(f.Z,{children:(0,h.jsx)(f.Z.Content,{children:(0,h.jsx)(R.Z,{size:"small",title:(0,h.jsx)(j.Z.Title,{level:5,ellipsis:!0,children:l.name}),actions:[(0,h.jsx)(t5,{project:{id:t.id,simulations:t.simulations},simulation:l,swr:{mutateProject:a.mutateProject,addOneSimulation:a.addOneSimulation}},"copy"),(0,h.jsx)(t8,{simulation:{id:l.id,name:l.name},swr:{mutateOneSimulation:a.mutateOneSimulation}},"edit"),(0,h.jsx)(t9,{project:{id:t.id,simulations:t.simulations},simulation:{id:l.id,name:l.name},swr:{mutateProject:a.mutateProject,delOneSimulation:a.delOneSimulation}},"delete")],children:(0,h.jsxs)(I.Z,{direction:"vertical",className:ep().fullWidth,children:[l.scheme.user&&(0,h.jsx)(tQ.Z,{message:"User algorithm",type:"info",showIcon:!0}),(0,h.jsxs)(j.Z.Text,{children:[(0,h.jsx)("span",{className:ep().textLight,children:"Category:"})," ",l.scheme.category]}),(0,h.jsxs)(j.Z.Text,{children:[(0,h.jsx)("span",{className:ep().textLight,children:"Algorithm:"})," ",l.scheme.algorithm]}),(0,h.jsxs)(j.Z.Text,{children:[(0,h.jsx)("span",{className:ep().textLight,children:"Code:"})," ",l.scheme.code]}),(0,h.jsxs)(j.Z.Text,{children:[(0,h.jsx)("span",{className:ep().textLight,children:"Version:"})," ",l.scheme.version]}),(0,h.jsx)("div",{className:"".concat(ep().fullWidth," ").concat(ep().scroll),children:(0,h.jsx)(ed.Z.Html,{html:l.scheme.description})})]})})})}):(0,h.jsx)(R.Z,{children:(0,h.jsx)(eF.Z,{})})};var lt=l(32808);let ll=e=>{let{label:t,className:l,style:a,defaultValue:i,defaultChecked:n,onValueChange:s,onCheckedChange:r,unit:o}=e,[u,d]=(0,x.useState)(String(null!=i?i:0)),[c,m]=(0,x.useState)(!!n),[p,y]=(0,x.useState)(void 0!==n&&!n),[v,g]=(0,x.useState)(0),[f,b]=(0,x.useState)(!1);(0,x.useEffect)(()=>{d(String(null!=i?i:0))},[i]),(0,x.useEffect)(()=>{m(!!n)},[n]);let j=(0,x.useCallback)(e=>{let t=e.target.checked;m(t),null==r||r(t),y(!t)},[r]),w=(0,x.useCallback)(e=>{v&&clearTimeout(v);let t=setTimeout(()=>{s(e),b(!1)},500);g(+t)},[v,s]),Z=(0,x.useCallback)(e=>{let t=e.target.value;d(t),b(!0),w(t)},[w]);return(0,h.jsx)(I.Z,{className:"".concat(ep().fullWidth," ").concat(l),style:a,align:"start",children:(0,h.jsx)(eZ.Z,{layout:"vertical",children:(0,h.jsx)(eZ.Z.Item,{label:(0,h.jsxs)(h.Fragment,{children:[void 0!==n&&(0,h.jsx)(lt.Z,{checked:c,onChange:j,style:{marginRight:"5px"}}),t]}),children:(0,h.jsx)(eC.Z,{disabled:p,value:u,onChange:Z,addonAfter:(0,h.jsxs)(I.Z,{className:ep().fullWidth,children:[(0,h.jsx)(ed.Z.Inline,{text:o}),f?(0,h.jsx)(O.Z,{spin:!0,className:ep().textOrange}):(0,h.jsx)(P.Z,{className:ep().textGreen})]})})})})})},la={update:"Unable to update simulation"},li=async(e,t,l)=>{try{let a=tK.Z.deepCopy(e);a.scheme.configuration.geometry.meshParameters={type:t,value:"auto"===t?"normal":"1"};let i={...a.scheme.configuration.geometry,done:!0};await q.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","geometry"],value:i}]),await q.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","run"],value:{...a.scheme.configuration.run,done:!1}}]),await l.mutateOneSimulation(a)}catch(e){throw(0,V.lt)(la.update,e),e}},ln=async(e,t,l,a)=>{try{let i=tK.Z.deepCopy(e);i.scheme.configuration.geometry.meshParameters={...i.scheme.configuration.geometry.meshParameters,type:t,value:l};let n={...i.scheme.configuration.geometry,done:!0};await q.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","geometry"],value:n}]),await q.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","run"],value:{...i.scheme.configuration.run,done:!1}}]),await a.mutateOneSimulation(i)}catch(e){throw(0,V.lt)(la.update,e),e}},ls=e=>{let{simulation:t,swr:l}=e,[a,i]=(0,x.useState)(),[n,s]=(0,x.useState)();(0,x.useEffect)(()=>{let e=t.scheme.configuration.geometry.meshParameters;e?(i(e.type),s(e.value)):(i("auto"),s("normal"))},[t]);let r=(0,x.useCallback)(e=>{(async()=>{try{await li(t,e,l),i(e),"auto"===e?s("normal"):s("1")}catch(e){}})()},[t,l]),o=(0,x.useCallback)(e=>{(async()=>{try{await ln(t,a,e,l),s(e)}catch(e){}})()},[t,a,l]);return(0,h.jsx)(R.Z,{size:"small",title:"Mesh refinement",children:(0,h.jsxs)(I.Z,{direction:"vertical",className:ep().fullWidth,children:[(0,h.jsx)(eZ.Z,{layout:"vertical",children:(0,h.jsx)(eZ.Z.Item,{label:"Type",children:(0,h.jsxs)(tW.Z,{className:ep().fullWidth,value:a,onChange:r,children:[(0,h.jsx)(tW.Z.Option,{value:"auto",children:"Automatic"}),(0,h.jsx)(tW.Z.Option,{value:"manual",children:"Manual"})]})})}),"auto"===a&&(0,h.jsx)(eZ.Z,{layout:"vertical",children:(0,h.jsx)(eZ.Z.Item,{label:"Size",children:(0,h.jsxs)(tW.Z,{className:ep().fullWidth,value:n,onChange:o,children:[(0,h.jsx)(tW.Z.Option,{value:"veryfine",children:"Very fine"}),(0,h.jsx)(tW.Z.Option,{value:"fine",children:"Fine"}),(0,h.jsx)(tW.Z.Option,{value:"normal",children:"Normal"}),(0,h.jsx)(tW.Z.Option,{value:"coarse",children:"Coarse"}),(0,h.jsx)(tW.Z.Option,{value:"verycoarse",children:"Very coarse"})]})})}),"manual"===a&&(0,h.jsx)(ll,{label:"Size",defaultValue:n,onValueChange:o,unit:"m"})]})})};var lr=l(98281),lo=l.n(lr);let lu={update:"Unable to update simulation"},ld=async(e,t,l,a,i)=>{try{var n;let s=tK.Z.deepCopy(e),r=t.find(e=>e.id===l);s.scheme.configuration.geometry.value=l,s.scheme.configuration.geometry.values=void 0;let o={...s.scheme.configuration,dimension:null!==(n=r.summary.dimension)&&void 0!==n?n:3,geometry:{...s.scheme.configuration.geometry,done:!0},run:{...s.scheme.configuration.run,done:!1}};await q.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration"],value:o}]),await i.mutateOneSimulation(s),a([r])}catch(e){(0,V.lt)(lu.update,e)}},lc=async(e,t,l,a,i)=>{try{var n;let s=tK.Z.deepCopy(e),r=t.filter(e=>l.includes(e.id));s.scheme.configuration.geometry.value=void 0,s.scheme.configuration.geometry.values=l;let o={...s.scheme.configuration,dimension:null!==(n=r[0].summary.dimension)&&void 0!==n?n:3,geometry:{...s.scheme.configuration.geometry,done:!0},run:{...s.scheme.configuration.run,done:!1}};await q.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration"],value:o}]),await i.mutateOneSimulation(s),a(r)}catch(e){(0,V.lt)(lu.update,e)}},lm=e=>{let{loadedGeometries:t,geometries:l,simulation:a,setGeometries:i,swr:n}=e,s=(0,x.useMemo)(()=>a.scheme.configuration.geometry.multiple,[a]),r=(0,x.useMemo)(()=>a.scheme.configuration.geometry.n,[a]),o=(0,x.useMemo)(()=>a.scheme.configuration.geometry.value,[a]),u=(0,x.useMemo)(()=>a.scheme.configuration.geometry.values,[a]);(0,L.Z)(()=>{(async()=>{s||o||!l.length?s&&!u&&l.length&&await lc(a,t,l.map(e=>e.id),i,n):await ld(a,t,l[0].id,i,n)})()},[s,o,u,t,l,n]);let d=(0,x.useCallback)(e=>{(async()=>{s?await lc(a,t,e,i,n):await ld(a,t,e,i,n)})()},[s,t,a,i,n]),c=(0,x.useMemo)(()=>(0,h.jsx)("div",{className:lo().geometriesList,children:(0,h.jsx)(tW.Z,{mode:s?"multiple":void 0,options:t.map(e=>({value:e.id,label:e.name})),value:s?u:o,onChange:d})}),[s,o,u,d,t]);return(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)(R.Z,{size:"small",children:(0,h.jsx)(j.Z.Text,{children:"When changing the simulation domain, you might lose your topological entity assignments"})}),(0,h.jsxs)(R.Z,{size:"small",children:[(0,h.jsx)(j.Z.Text,{strong:!0,children:"Select a simulation domain"}),r?(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)("br",{}),(0,h.jsxs)(j.Z.Text,{children:[r," geometries needed"]})]}):null]}),c,a.scheme.configuration.geometry.meshable&&(0,h.jsx)(ls,{simulation:{id:a.id,scheme:a.scheme},swr:{mutateOneSimulation:n.mutateOneSimulation}})]})},lh={update:"Unable to delete material"},lp=async(e,t,l,a)=>{try{let i=tK.Z.deepCopy(e),n=i.scheme.configuration.materials,s=n.values[t];s.selected.forEach(e=>{l(tw(e))}),n.values=[...n.values.slice(0,t),...n.values.slice(t+1)];let r={...n,done:!!n.values.length};await q.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","materials"],value:r}]),await a.mutateOneSimulation(i)}catch(e){throw(0,V.lt)(lh.update,e),e}},ly=e=>{let{simulation:t,index:l,swr:a}=e,[i,n]=(0,x.useState)(!1),{dispatch:s}=(0,x.useContext)(H),r=(0,x.useMemo)(()=>t.scheme.configuration.materials,[t]),o=(0,x.useMemo)(()=>r.values[l],[r,l]),u=(0,x.useCallback)(async()=>{n(!0);try{await lp(t,l,s,a)}finally{n(!1)}},[t,l,a,s]);return(0,h.jsx)(U.m1,{loading:i,text:(0,h.jsxs)(h.Fragment,{children:["Are you sure you want to delete the material"," ",(0,h.jsx)(j.Z.Text,{strong:!0,children:o.material.label})]}),onDelete:u})},lv=e=>{let{geometries:t,simulation:l,material:a,index:i,swr:n,_onEdit:s}=e,[r,o]=(0,x.useState)(!0),{dispatch:u}=(0,x.useContext)(H),d=(0,x.useCallback)(()=>{u(ty());let e=a.geometry,l=t.find(t=>t.id===e);u(tg(null==l?void 0:l.summary.uuid));let i=a.selected;null==i||i.forEach(e=>{u(tj(e))})},[t,a,u]),c=(0,x.useCallback)(()=>{r&&u(tv())},[r,u]),m=(0,x.useCallback)(()=>{o(!1),s(i),setTimeout(()=>o(!0),500)},[i,s]);return(0,h.jsx)(R.Z,{className:"".concat(ep().textAlignCenter," ").concat(lo().listItem),hoverable:!0,onMouseEnter:d,onMouseLeave:c,actions:[(0,h.jsx)(U.w6,{onEdit:m},"edit"),(0,h.jsx)(ly,{index:i,simulation:l,swr:n},"delete")],children:(0,h.jsx)(j.Z.Text,{strong:!0,className:ep().textAlignCenter,children:a.material.label})})},lx=e=>{var t;let{geometries:l,simulation:a,swr:i,onEdit:n}=e,s=(0,x.useMemo)(()=>a.scheme.configuration.materials,[a]);return(0,h.jsx)(h.Fragment,{children:null===(t=s.values)||void 0===t?void 0:t.map((e,t)=>(0,h.jsx)(lv,{geometries:l,simulation:a,material:e,index:t,swr:i,_onEdit:n},e.uuid)).filter(e=>e)})};var lg=l(85265),lf=l(51904),lb=l(13982),lj=l(14618),lw=l(94668),lZ=l(68795);let lC=e=>{let{color:t,setFilter:l}=e,a=(0,x.useCallback)(()=>{l(t)},[t,l]);return(0,h.jsx)(g.Z,{title:"Color",children:(0,h.jsx)(w.ZP,{style:{backgroundColor:tK.Z.rgbToHex(t)},onClick:a,children:" "})},JSON.stringify(t))},lk=e=>{let{colors:t,setFilter:l}=e,a=(0,x.useCallback)(()=>{l(void 0)},[l]);return(0,h.jsx)(h.Fragment,{children:t.length>1&&(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)(g.Z,{title:"Reset",children:(0,h.jsx)(w.ZP,{icon:(0,h.jsx)(es.Z,{}),onClick:a})}),t.map(e=>(0,h.jsx)(lC,{color:e,setFilter:l},JSON.stringify(e)))]})})},lS=e=>{let{element:t,alreadySelected:l,filter:a,search:i,context:n}=e,s=(0,x.useCallback)(e=>{var t,l,n;return(!a||a.r===(null===(t=e.color)||void 0===t?void 0:t.r)&&a.g===(null===(l=e.color)||void 0===l?void 0:l.g)&&a.b===(null===(n=e.color)||void 0===n?void 0:n.b))&&(!i||!e.name||!!e.name.includes(i))},[a,i]),r=(0,x.useCallback)(e=>{n.dispatch(tf(e))},[n]),o=(0,x.useCallback)(()=>{n.dispatch(tb())},[n]),u=(0,x.useCallback)(e=>{n.selected.find(t=>t.uuid===e.uuid)?n.dispatch(tw(e)):n.dispatch(tj(e))},[n]),d=(0,x.useMemo)(()=>{var e;return n.selected.find(e=>e.uuid===t.uuid)?"#EE9817":(null===(e=n.highlighted)||void 0===e?void 0:e.uuid)===t.uuid?"#FAD114":"transparent"},[t,n]),c=(0,x.useMemo)(()=>{var e;return n.selected.find(e=>e.uuid===t.uuid)?"rgba(238, 152, 23, 0.3)":(null===(e=n.highlighted)||void 0===e?void 0:e.uuid)===t.uuid?"rgba(250, 209, 20, 0.3)":"transparent"},[t,n]),m=(0,x.useCallback)(()=>r({uuid:t.uuid,label:t.label}),[t,r]),p=(0,x.useCallback)(()=>u({uuid:t.uuid,label:t.label}),[t,u]);return s(t)?(0,h.jsx)(R.Z,{style:{marginBottom:"10px"},bodyStyle:{position:"relative",padding:"10px 10px 10px 40px",borderWidth:"2px",borderStyle:"solid",borderColor:d,backgroundColor:c},onMouseEnter:m,onMouseLeave:o,onClick:p,children:(0,h.jsxs)(I.Z,{direction:"vertical",children:[(0,h.jsxs)("div",{children:[(0,h.jsx)("div",{style:{position:"absolute",left:"-2px",top:"-2px",bottom:"-2px",width:"30px",backgroundColor:tK.Z.rgbToRgba(t.color,1)}}),t.name]}),null==l?void 0:l.map(e=>{if(e.selected.find(e=>e.uuid===t.uuid))return(0,h.jsx)(lf.Z,{color:tK.Z.stringToColor(e.label),children:e.label},t.uuid)})]})}):null},lP=e=>{var t;let{geometry:l,alreadySelected:a,updateSelected:i}=e,[n,s]=(0,x.useState)([]),[r,o]=(0,x.useState)(),[u,d]=(0,x.useState)(),{type:c,highlighted:m,selected:p,dispatch:y}=(0,x.useContext)(H);(0,L.Z)(()=>i(p),[p],[i]),(0,L.Z)(()=>{var e;let t=[];c&&(null===(e=l.summary[c])||void 0===e||e.forEach(e=>{if(e.color){let l=t.find(t=>t.r===e.color.r&&t.g===e.color.g&&t.b===e.color.b);l||t.push(e.color)}})),s(t)},[l,c]);let v=(0,x.useCallback)(()=>{var e;null===(e=l.summary[c])||void 0===e||e.forEach(e=>{var t,l,a;(!r||r&&r.r===(null===(t=e.color)||void 0===t?void 0:t.r)&&r.g===(null===(l=e.color)||void 0===l?void 0:l.g)&&r.b===(null===(a=e.color)||void 0===a?void 0:a.b))&&y(tj({uuid:e.uuid,label:e.label}))})},[l,c,r,y]),f=(0,x.useCallback)(()=>{var e;null===(e=l.summary[c])||void 0===e||e.forEach(e=>{var t,l,a;(!r||r&&r.r===(null===(t=e.color)||void 0===t?void 0:t.r)&&r.g===(null===(l=e.color)||void 0===l?void 0:l.g)&&r.b===(null===(a=e.color)||void 0===a?void 0:a.b))&&y(tw({uuid:e.uuid,label:e.label}))})},[l,c,r,y]),b=(0,x.useCallback)(()=>{var e;null===(e=l.summary[c])||void 0===e||e.forEach(e=>{var t,l,a;(!r||r&&r.r===(null===(t=e.color)||void 0===t?void 0:t.r)&&r.g===(null===(l=e.color)||void 0===l?void 0:l.g)&&r.b===(null===(a=e.color)||void 0===a?void 0:a.b))&&p.find(t=>t.uuid===e.uuid)?y(tw({uuid:e.uuid,label:e.label})):y(tj({uuid:e.uuid,label:e.label}))})},[l,p,c,r,y]),Z=(0,x.useCallback)(e=>{let t=e.target.value;d(t)},[]);return(0,h.jsxs)(R.Z,{size:"small",className:ep().noBorderBottom,children:[(0,h.jsxs)(I.Z,{direction:"vertical",className:ep().fullWidth,children:[(0,h.jsx)(j.Z.Text,{strong:!0,children:"Filters"}),(0,h.jsxs)(I.Z,{direction:"horizontal",wrap:!0,children:[(0,h.jsx)(lk,{colors:n,setFilter:o}),(0,h.jsx)(g.Z,{title:"Select all",children:(0,h.jsx)(w.ZP,{icon:(0,h.jsx)(lb.Z,{}),onClick:v})}),(0,h.jsx)(g.Z,{title:"Unselect all",children:(0,h.jsx)(w.ZP,{icon:(0,h.jsx)(lj.Z,{}),onClick:f})}),(0,h.jsx)(g.Z,{title:"Swap",children:(0,h.jsx)(w.ZP,{icon:(0,h.jsx)(lw.Z,{}),onClick:b})})]}),(0,h.jsx)(eC.Z,{placeholder:"Search",value:u,onChange:Z,suffix:(0,h.jsx)(lZ.Z,{className:ep().textLight})})]}),(0,h.jsx)("div",{className:ep().fullWidth,style:{marginTop:"20px"},children:c?null===(t=l.summary[c])||void 0===t?void 0:t.map(e=>(0,h.jsx)(lS,{element:e,alreadySelected:a,filter:r,search:u,context:{selected:p,highlighted:m,dispatch:y}},e.uuid)):null})]})};var lE=l(51158),lM=l(13520),lN=l(27588);let lO=e=>{let{onSelect:t}=e,[l,a]=(0,x.useState)(),[i,n]=(0,x.useState)(),[s,r]=(0,x.useState)(),[o,u]=(0,x.useState)(),d=(0,x.useMemo)(()=>Object.keys(lN.E),[]),c=(0,x.useCallback)(()=>a(!0),[]),m=(0,x.useCallback)(()=>a(!1),[]),p=(0,x.useCallback)(e=>{let{key:t}=e,l=lN.E[t];n({key:t,children:l.children}),r(void 0),u(void 0)},[]),y=(0,x.useCallback)(e=>{let{key:t}=e,l=lN.E[i.key],a=l.children.find(e=>e.key===t);r({key:t}),u(a)},[i]),v=(0,x.useCallback)(()=>{t(o),a(!1)},[o,t]);return(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)(w.ZP,{icon:(0,h.jsx)(lM.Z,{}),onClick:c,className:ep().fullWidth,children:"Pick a material"}),(0,h.jsx)(tH.Z,{open:l,title:"Material database",onCancel:m,onOk:v,okText:"Choose",okButtonProps:{disabled:!o},width:"50%",children:(0,h.jsx)(f.Z,{children:(0,h.jsx)(f.Z.Content,{children:(0,h.jsxs)(I.Z,{style:{alignItems:"stretch"},children:[(0,h.jsx)(b.Z,{mode:"inline",items:d.map(e=>({key:e,label:lN.E[e].label})),onClick:p}),(0,h.jsx)(b.Z,{mode:"inline",items:null==i?void 0:i.children.map(e=>({key:e.key,label:e.label})),selectedKeys:(null==s?void 0:s.key)?[null==s?void 0:s.key]:[],onClick:y}),o&&(0,h.jsx)(lE.ZP,{itemLayout:"vertical",children:o.children.map(e=>(0,h.jsxs)(lE.ZP.Item,{children:[e.label,": ",e.symbol," = ",e.value]},e.label))})]})})})})]})},lT={material:"You need to define a material",selected:"You need to select a solid",update:"Unable to add material"},lA=async(e,t,l)=>{try{var a;let i=tK.Z.deepCopy(t);i.uuid=(0,e1.Z)();let n=tK.Z.deepCopy(e),s=n.scheme.configuration.materials;s.values=[...null!==(a=s.values)&&void 0!==a?a:[],i];let r={...s,done:!0};await q.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","materials"],value:r}]),await q.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","run"],value:{...n.scheme.configuration.run,done:!1}}]),await l.mutateOneSimulation(n)}catch(e){throw(0,V.lt)(lT.update,e),e}},lL=e=>{let{simulation:t,material:l,swr:a,onError:i,onClose:n}=e,[s,r]=(0,x.useState)(!1),o=(0,x.useCallback)(()=>{(async()=>{r(!0);try{var e;if(!l.material){i(lT.material),r(!1);return}if(!(null===(e=l.selected)||void 0===e?void 0:e.length)){i(lT.selected),r(!1);return}i(),await lA(t,l,a),r(!1),n()}catch(e){r(!1)}})()},[t,l,a,i,n]);return(0,h.jsx)(U.HS,{loading:s,needMargin:!0,onAdd:o,children:"Add"})},lz={material:"You need to define a material",selected:"You need to select a solid",update:"Unable to edit material"},lR=async(e,t,l)=>{try{let a=tK.Z.deepCopy(e),i=a.scheme.configuration.materials,n=i.values.findIndex(e=>e.uuid===t.uuid);i.values=[...i.values.slice(0,n),t,...i.values.slice(n+1)];let s={...i};await q.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","materials"],value:s}]),await l.mutateOneSimulation(a)}catch(e){throw(0,V.lt)(lz.update,e),e}},lI=e=>{let{simulation:t,material:l,swr:a,onError:i,onClose:n}=e,[s,r]=(0,x.useState)(!1),o=(0,x.useCallback)(()=>{(async()=>{r(!0);try{var e;if(!l.material){i(lz.material),r(!1);return}if(!(null===(e=l.selected)||void 0===e?void 0:e.length)){i(lz.selected),r(!1);return}i(),await lR(t,l,a),r(!1),n()}catch(e){r(!1)}})()},[t,l,a,i,n]);return(0,h.jsx)(U.w6,{loading:s,primary:!0,needMargin:!0,onEdit:o,children:"Edit"})},l_=e=>{let{child:t,index:l,value:a,_onMaterialChange:i}=e,n=(0,x.useCallback)(e=>{i(t,l,e)},[t,l,i]);return(0,h.jsx)(ll,{label:t.name,defaultValue:null!=a?a:String(t.default),unit:t.unit,onValueChange:n},t.name)},lF=e=>{var t,l,a,i,n,s,r;let{visible:o,geometries:u,simulation:d,material:c,swr:m,onClose:p}=e,[y,v]=(0,x.useState)(),[g,f]=(0,x.useState)(),[b,Z]=(0,x.useState)(),[C,k]=(0,x.useState)(),{dispatch:S}=(0,x.useContext)(H),P=(0,x.useMemo)(()=>d.scheme.configuration.materials,[d]);(0,L.Z)(()=>{var e;S(tg(null===(e=u[0])||void 0===e?void 0:e.summary.uuid)),Z(null==c?void 0:c.geometry)},[u,c],[S]),(0,L.Z)(()=>{!o&&g&&f(void 0)},[o,g]),(0,L.Z)(()=>{var e,t;o&&!g&&c?f(c):!o||g||c||f({material:{label:"Default",children:null!==(t=null==P?void 0:P.children.map(e=>({label:e.label,symbol:e.name,value:e.default})))&&void 0!==t?t:[]},geometry:null===(e=u[0])||void 0===e?void 0:e.id})},[o,u,P,g]),(0,L.Z)(()=>{var e;let t=null==P?void 0:null===(e=P.values)||void 0===e?void 0:e.map(e=>{if(e.uuid!==(null==c?void 0:c.uuid))return{label:e.material.label,selected:e.selected}}).filter(e=>e);v(null!=t?t:[])},[d,c,P]);let E=(0,x.useCallback)(e=>{f(t=>({...t,material:e}))},[]),N=(0,x.useCallback)((e,t,l)=>{f(a=>({...a,material:{label:"Custom",children:[...a.material.children.slice(0,t),{label:e.label,symbol:e.name,value:l},...a.material.children.slice(t+1)]}}))},[]),O=(0,x.useCallback)(e=>{f(t=>({...t,selected:e}))},[]),T=(0,x.useCallback)(e=>{Z(e);let t=u.find(t=>t.id===e);S(tg(t.summary.uuid)),f(t=>({...t,geometry:e}))},[u,S]),A=(0,x.useCallback)(()=>{f(void 0),p()},[p]);return(0,h.jsx)(lg.Z,{className:eo().subPanel,title:"Material",placement:"left",closable:!1,open:o,mask:!1,maskClosable:!1,width:300,extra:(0,h.jsx)(w.ZP,{type:"text",icon:(0,h.jsx)(es.Z,{}),onClick:A}),footer:(0,h.jsxs)("div",{style:{display:"flex",justifyContent:"flex-end"},children:[(0,h.jsx)(U.Lw,{onCancel:A}),c?(0,h.jsx)(lI,{material:{uuid:null!==(a=null==g?void 0:g.uuid)&&void 0!==a?a:c.uuid,material:null!==(i=null==g?void 0:g.material)&&void 0!==i?i:c.material,geometry:null!==(n=null==g?void 0:g.geometry)&&void 0!==n?n:c.geometry,selected:null!==(s=null==g?void 0:g.selected)&&void 0!==s?s:c.selected},simulation:{id:d.id,scheme:d.scheme},swr:{mutateOneSimulation:m.mutateOneSimulation},onError:k,onClose:A}):(0,h.jsx)(lL,{material:{material:null==g?void 0:g.material,geometry:null==g?void 0:g.geometry,selected:null==g?void 0:g.selected},simulation:{id:d.id,scheme:d.scheme},swr:{mutateOneSimulation:m.mutateOneSimulation},onError:k,onClose:A})]}),children:(0,h.jsxs)(I.Z,{direction:"vertical",className:ep().fullWidth,children:[(0,h.jsx)(R.Z,{size:"small",children:(0,h.jsxs)(I.Z,{direction:"vertical",className:ep().fullWidth,children:[(0,h.jsx)(lO,{onSelect:E}),(0,h.jsxs)(j.Z.Text,{children:["Material: ",null!==(r=null==g?void 0:null===(t=g.material)||void 0===t?void 0:t.label)&&void 0!==r?r:"default"]}),null==P?void 0:null===(l=P.children)||void 0===l?void 0:l.map((e,t)=>{var l,a;let i=null==g?void 0:null===(l=g.material)||void 0===l?void 0:null===(a=l.children)||void 0===a?void 0:a.find(t=>t.symbol===e.name);return(0,h.jsx)(l_,{child:e,index:t,value:null==i?void 0:i.value,_onMaterialChange:N},e.name)})]})}),(0,h.jsx)(tG.Z,{items:u.map(e=>({key:e.id,label:e.name,children:(0,h.jsx)(lP,{geometry:e,alreadySelected:y,updateSelected:O})})),activeKey:b,onChange:T}),C&&(0,h.jsxs)(j.Z.Text,{children:[(0,h.jsx)(M.Z,{style:{color:"red"}})," ",C]})]})})},lD=e=>{let{geometries:t,simulation:l,swr:a,setVisible:i}=e,[n,s]=(0,x.useState)(),[r,o]=(0,x.useState)(!1),{dispatch:u}=(0,x.useContext)(H),d=(0,x.useMemo)(()=>l.scheme.configuration.materials,[l]);(0,L.Z)(()=>{var e;(null===(e=t[0])||void 0===e?void 0:e.summary)&&u(tx(2===t[0].summary.dimension?"faces":"solids"))},[t],[u]);let c=(0,x.useCallback)(()=>{s(void 0),o(!0),i(!1),u(ty())},[u,i]),m=(0,x.useCallback)(e=>{let t=d.values[e];s(t),o(!0),i(!1),u(ty())},[d,u,i]),p=(0,x.useCallback)(()=>{u(tv()),o(!1),s(void 0),i(!0)},[u,i]);return t.length?(0,h.jsx)(f.Z,{children:(0,h.jsx)(f.Z.Content,{children:(0,h.jsxs)(R.Z,{size:"small",children:[(0,h.jsx)(U.HS,{onAdd:c,fullWidth:!0,primary:!1,children:"Add material"}),(0,h.jsx)(lx,{geometries:t.map(e=>({id:e.id,summary:e.summary})),simulation:{id:l.id,scheme:l.scheme},swr:a,onEdit:m}),(0,h.jsx)(lF,{visible:r,geometries:t.map(e=>({id:e.id,name:e.name,summary:e.summary})),simulation:{id:l.id,scheme:l.scheme},material:n&&{uuid:n.uuid,material:n.material,geometry:n.geometry,selected:n.selected},swr:{mutateOneSimulation:a.mutateOneSimulation},onClose:p})]})})}):(0,h.jsx)(z.Z.Simple,{})};var lU=l(15045);let lV={update:"Unable to update simulation"},lB=(e,t,l)=>(0,h.jsx)(ll,{label:null!==(i=t.label2D)&&void 0!==i?i:t.label,defaultValue:null!==(n=t.value)&&void 0!==n?n:t.default,onValueChange:l,unit:t.unit},e),lW=(e,t,l)=>{var a;return(0,h.jsx)(eZ.Z,{layout:"vertical",children:(0,h.jsx)(eZ.Z.Item,{label:null!==(s=t.label2D)&&void 0!==s?s:t.label,children:(0,h.jsx)(tW.Z,{options:null===(a=t.options)||void 0===a?void 0:a.map(e=>({label:e.label,value:null!==(r=e.value2D)&&void 0!==r?r:e.value})),defaultValue:null!==(u=null!==(o=t.value)&&void 0!==o?o:t.default2D)&&void 0!==u?u:t.default,onChange:l})})},e)},lH=(e,t,l)=>(0,h.jsx)(eZ.Z,{layout:"horizontal",children:(0,h.jsx)(eZ.Z.Item,{label:null!==(d=t.label2D)&&void 0!==d?d:t.label,children:(0,h.jsx)(lt.Z,{defaultChecked:t.value,onChange:l})})},e),lG=(e,t,l)=>(0,h.jsx)(ll,{label:t.label,defaultValue:null!==(c=t.value)&&void 0!==c?c:t.default,onValueChange:l,unit:t.unit},e),lY=(e,t,l)=>(0,h.jsx)(eZ.Z,{layout:"vertical",children:(0,h.jsx)(eZ.Z.Item,{label:t.label,children:(0,h.jsx)(tW.Z,{options:t.options,defaultValue:null!==(m=t.value)&&void 0!==m?m:t.default,onChange:l})})},e),lJ=(e,t,l)=>(0,h.jsx)(eZ.Z,{layout:"horizontal",children:(0,h.jsx)(eZ.Z.Item,{label:t.label,children:(0,h.jsx)(lt.Z,{defaultChecked:t.value,onChange:l})})},e),lX=async(e,t)=>{try{let l=tK.Z.deepCopy(e),a=l.scheme.configuration.parameters,i={...a,done:!0};await q.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","parameters"],value:i}]),await q.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","run"],value:{...l.scheme.configuration.run,done:!1}}]),await t.mutateOneSimulation(l)}catch(e){(0,V.lt)(lV.update,e)}},lq=async(e,t,l,a,i)=>{try{let n=tK.Z.deepCopy(e),s=n.scheme.configuration.parameters,r=s[t];r.children[l].value=a;let o={...s,done:!0};await q.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","parameters"],value:o}]),await q.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","run"],value:{...n.scheme.configuration.run,done:!1}}]),await i.mutateOneSimulation(n)}catch(e){(0,V.lt)(lV.update,e)}},lK=e=>{let{simulation:t,dimension:l,child:a,pkey:i,index:n,swr:s}=e,r=(0,x.useCallback)(e=>{(async()=>{await lq(t,i,n,e,s)})()},[t,i,n,s]),o=(0,x.useCallback)(e=>{(async()=>{await lq(t,i,n,e.target.checked,s)})()},[t,i,n,s]);if(2===l){if(a.only3D);else if("formula"===a.htmlEntity)return lB(i+"&"+n,a,r);else if("select"===a.htmlEntity)return lW(i+"&"+n,a,r);else if("checkbox"===a.htmlEntity)return lH(i+"&"+n,a,o);return null}return"formula"===a.htmlEntity?lG(i+"&"+n,a,r):"select"===a.htmlEntity?lY(i+"&"+n,a,r):"checkbox"===a.htmlEntity?lJ(i+"&"+n,a,o):null},l$=e=>{let{simulation:t,dimension:l,pkey:a,parameter:i,swr:n}=e,s=(0,x.useMemo)(()=>i.children.map((e,i)=>(0,h.jsx)(lK,{simulation:t,dimension:l,child:e,pkey:a,index:i,swr:n},a+"&"+e.label)),[t,l,a,i,n]);return(0,h.jsx)(R.Z,{size:"small",title:null==i?void 0:i.label,children:(0,h.jsx)(I.Z,{direction:"vertical",children:s})},a)},lQ=e=>{let{simulation:t,swr:l}=e,a=(0,x.useMemo)(()=>null==t?void 0:t.scheme.configuration.parameters,[t]),i=(0,x.useMemo)(()=>null==t?void 0:t.scheme.configuration.dimension,[t]);(0,x.useEffect)(()=>{(async()=>{(null==a?void 0:a.done)||await lX(t,l)})()},[t,a,l]);let n=(0,x.useMemo)(()=>Object.keys(a).map(e=>{if("index"===e||"title"===e||"done"==e)return null;let n=a[e];return n.advanced?null:(0,h.jsx)(l$,{simulation:t,dimension:i,pkey:e,parameter:n,swr:l},e)}).filter(e=>e),[t,i,a,l]),s=(0,x.useMemo)(()=>Object.keys(a).map(e=>{if("index"===e||"title"===e||"done"==e)return null;let n=a[e];return n.advanced?(0,h.jsx)(l$,{simulation:t,dimension:i,pkey:e,parameter:n,swr:l},e):null}).filter(e=>e),[t,i,a,l]);return(0,h.jsx)(f.Z,{children:(0,h.jsx)(f.Z.Content,{children:(0,h.jsxs)(I.Z,{direction:"vertical",children:[n,s.length?(0,h.jsx)(lU.Z,{children:(0,h.jsx)(lU.Z.Panel,{header:"Advanced",children:(0,h.jsx)(I.Z,{direction:"vertical",children:s})},"advanced")}):null]})})})},l0=(e,t)=>e.map(e=>{let l=e.fileName.replace(new RegExp(t.prefixPattern),"").replace(new RegExp(t.suffixPattern),"");return{...e,number:+l}}),l1=(e,t)=>{let l=t.multiplicator;if(l){var a;let t=l.reduce((e,t)=>e[t],e);return null!==(a=t.value)&&void 0!==a?a:t.default}},l2={update:"Unable to update simulation"},l5=async(e,t,l)=>{try{let a=tK.Z.deepCopy(e),i=a.scheme.configuration.initialization;i.value={type:t},await q.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","initialization"],value:i}]),await l.mutateOneSimulation(a)}catch(e){throw(0,V.lt)(l2.update,e),e}},l4=async(e,t,l,a)=>{try{var i;let n=await l6(e,l),s=tK.Z.deepCopy(t),r=s.scheme.configuration.initialization;r.value={...r.value,simulation:l,result:null==n?void 0:null===(i=n[0])||void 0===i?void 0:i.value},await q.Z.update({id:t.id},[{key:"scheme",type:"json",method:"set",path:["configuration","initialization"],value:r}]),await a.mutateOneSimulation(s)}catch(e){throw(0,V.lt)(l2.update,e),e}},l3=async(e,t,l,a)=>{try{let i=tK.Z.deepCopy(e),n=i.scheme.configuration.initialization;n.value={...n.value,number:+t,result:l.file},await q.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","initialization"],value:n}]),await a.mutateOneSimulation(i)}catch(e){(0,V.lt)(l2.update,e)}},l8=async(e,t,l,a)=>{try{let i=tK.Z.deepCopy(e),n=i.scheme.configuration.initialization;n.value.values||(n.value.values=[]),n.value.values[t]=l,await q.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","initialization"],value:n}]),await a.mutateOneSimulation(i)}catch(e){(0,V.lt)(l2.update,e)}},l6=async(e,t)=>{var l;let a=await q.Z.tasks({id:t}),i=e.find(e=>e.id===t),n=i.scheme.configuration,s=null==n?void 0:null===(l=n.run)||void 0===l?void 0:l.resultsFilter,r=[];return a.forEach(e=>{if(e.file&&"result"===e.file.type&&r.push({label:e.file.fileName,value:e.file.fileName,file:e.file.fileName}),e.files){if(s){let t=new RegExp(s.pattern),l=e.files.filter(e=>!t.test(e.fileName)).filter(e=>"result"===e.type),a=e.files.filter(e=>t.test(e.fileName)),i=l0(a,s),o=i.map(e=>({number:e.number,fileName:e.fileName.replace(new RegExp(s.suffixPattern),"")})).filter((e,t,l)=>l.findIndex(t=>t.number===e.number)===t).sort((e,t)=>e.number-t.number),u=l1(n,s),d=o.map((e,t)=>{let l=u?e.number*u:t;return{label:String(Math.round(1e15*l)/1e15),value:e.fileName,file:e.fileName}});r.push(...l.map(e=>({label:e.fileName,value:e.fileName,file:e.fileName})).filter(e=>e)),r.push(...d)}else e.files.forEach(e=>{"result"===e.type&&r.push({label:e.fileName,value:e.fileName,file:e.fileName})})}}),r},l7=e=>{let{simulation:t,child:l,index:a,value:i,swr:n}=e,s=(0,x.useCallback)(e=>{(async()=>{await l8(t,a,e,n)})()},[t,a,n]);return(0,h.jsx)(ll,{label:l.label,defaultValue:(null!=i?i:l.default).toString(),unit:l.unit,onValueChange:s})},l9=e=>{let{simulations:t,simulation:l,swr:a}=e,[i,n]=(0,x.useState)(!1),[s,r]=(0,x.useState)(),[o,u]=(0,x.useState)(),[d,c]=(0,x.useState)(),m=(0,x.useMemo)(()=>null==l?void 0:l.scheme.configuration.initialization,[l]),p=(0,x.useMemo)(()=>null==l?void 0:l.scheme.configuration.dimension,[l]),y=(0,x.useCallback)(e=>{let l=t.find(t=>t.id===e);u(l)},[t]);(0,L.Z)(()=>{var e,t;!s&&m.value&&r(m.value.type),!o&&(null===(e=m.value)||void 0===e?void 0:e.simulation)&&y(null===(t=m.value)||void 0===t?void 0:t.simulation)},[m,s,o],[y]),(0,L.Z)(()=>{(async()=>{if(o){let e=await l6(t,o.id);c(e)}})()},[t,o]);let v=(0,x.useMemo)(()=>{let e=[{label:"None",value:"none"}];return m.coupling&&e.push({label:m.coupling.label,value:"coupling"}),m.direct&&e.push({label:m.direct.label,value:"direct"}),e},[m]),g=m.value,b=(0,x.useCallback)(e=>{(async()=>{n(!0);try{await l4(t,l,e,a),y(e)}catch(e){}finally{n(!1)}})()},[t,l,a,y]),w=(0,x.useCallback)((e,t)=>{(async()=>{await l3(l,e,t,a)})()},[l,a]),Z=(0,x.useCallback)((e,t)=>(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)(j.Z.Text,{children:"If you use coupling, the selected simulation mesh will be used, at least for the first iteration."}),(0,h.jsxs)(I.Z,{direction:"vertical",className:ep().fullWidth,style:{marginTop:"10px"},children:[(0,h.jsx)(tW.Z,{className:ep().fullWidth,options:e,placeholder:"Select a simulation",value:null==g?void 0:g.simulation,onChange:b}),i&&(0,h.jsx)(eF.Z,{}),(null==d?void 0:d.length)?(0,h.jsxs)(h.Fragment,{children:[(0,h.jsxs)(j.Z.Text,{children:[null==t?void 0:t.name,":"]},"simulation"),(0,h.jsx)(tW.Z,{className:ep().fullWidth,options:d,placeholder:"Select a "+t.name,value:null==g?void 0:g.result,onChange:w})]}):(0,h.jsx)(j.Z.Text,{type:"danger",children:"No results, please select an other simulation."})]})]}),[g,d,i,b,w]),C=(0,x.useCallback)(e=>(0,h.jsx)(I.Z,{direction:"vertical",className:ep().fullWidth,children:e.children.map((e,t)=>{var i;if(2!==p||!e.only3D)return(0,h.jsx)(l7,{simulation:l,child:e,index:t,value:null==g?void 0:null===(i=g.values)||void 0===i?void 0:i[t],swr:a},e.label)})}),[g,p,l,a]),k=(0,x.useMemo)(()=>{let e={none:(0,h.jsx)("div",{})},a=m.coupling;if(null==a?void 0:a.compatibility){let i=t.map(e=>{let t=e.id===l.id||!a.compatibility.find(t=>t.algorithm===e.scheme.algorithm);return{label:e.name,value:e.id,disabled:t}}),n=a.compatibility.find(e=>{var t;return e.algorithm===(null==o?void 0:null===(t=o.scheme)||void 0===t?void 0:t.algorithm)}),s=null==n?void 0:n.filter;e.coupling=Z(i,s)}let i=m.direct;return(null==i?void 0:i.children)&&(e.direct=C(i)),e},[t,l,o,m,Z,C]),S=(0,x.useCallback)(e=>{(async()=>{try{await l5(l,e,a),r(e)}catch(e){}})()},[l,a]);return(0,h.jsx)(f.Z,{children:(0,h.jsx)(f.Z.Content,{children:(0,h.jsxs)(R.Z,{size:"small",children:[(0,h.jsx)(tW.Z,{className:ep().fullWidth,style:{marginTop:"10px"},defaultValue:"none",value:s,options:v,onChange:S}),k[null!=s?s:"none"]]})})})},ae={update:"Unable to delete boundary condition"},at=async(e,t,l,a,i)=>{try{let n=tK.Z.deepCopy(e),s=n.scheme.configuration.boundaryConditions,r=s[t],o=r.values[l];o.selected.forEach(e=>{a(tw(e))}),r.values=[...r.values.slice(0,l),...r.values.slice(l+1)];let u=!1;Object.keys(s).forEach(e=>{var t;if("index"===e||"title"===e||"done"===e)return;let l=s[e];(null===(t=l.values)||void 0===t?void 0:t.length)&&(u=!0)});let d={...s,done:u};await q.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","boundaryConditions"],value:d}]),await i.mutateOneSimulation(n)}catch(e){throw(0,V.lt)(ae.update,e),e}},al=e=>{let{type:t,index:l,simulation:a,swr:i}=e,[n,s]=(0,x.useState)(!1),{dispatch:r}=(0,x.useContext)(H),o=(0,x.useMemo)(()=>a.scheme.configuration.boundaryConditions,[a]),u=(0,x.useMemo)(()=>o[t],[o,t]),d=(0,x.useMemo)(()=>u.values[l],[u,l]),c=(0,x.useCallback)(async()=>{s(!0);try{await at(a,t,l,r,i)}finally{s(!1)}},[a,t,l,i,r]);return(0,h.jsx)(U.m1,{loading:n,onDelete:c,text:(0,h.jsxs)(h.Fragment,{children:["Are you sure you want to delete the condition"," ",(0,h.jsx)(j.Z.Text,{strong:!0,children:null==d?void 0:d.name}),"?"]})})},aa=e=>{let{geometries:t,simulation:l,boundaryCondition:a,index:i,type:n,swr:s,_onEdit:r}=e,[o,u]=(0,x.useState)(!0),{dispatch:d}=(0,x.useContext)(H),c=(0,x.useCallback)(()=>{d(ty());let e=a.geometry,l=t.find(t=>t.id===e);d(tg(null==l?void 0:l.summary.uuid));let i=a.selected;null==i||i.forEach(e=>{d(tj(e))})},[t,a,d]),m=(0,x.useCallback)(()=>{o&&d(tv())},[o,d]),p=(0,x.useCallback)(()=>{u(!1),r(n,i),setTimeout(()=>u(!0),500)},[i,n,r]);return(0,h.jsxs)(R.Z,{className:lo().listItem,hoverable:!0,onMouseEnter:c,onMouseLeave:m,actions:[(0,h.jsx)(U.w6,{onEdit:p},"edit"),(0,h.jsx)(al,{simulation:{id:l.id,scheme:l.scheme},type:n,index:i,swr:{mutateOneSimulation:s.mutateOneSimulation}},"delete")],children:[(0,h.jsx)(j.Z.Text,{strong:!0,children:a.name})," ",(0,h.jsxs)(j.Z.Text,{children:["(",a.type.label,")"]})]})},ai=e=>{let{geometries:t,simulation:l,swr:a,onEdit:i}=e,n=(0,x.useMemo)(()=>l.scheme.configuration.boundaryConditions,[l]);return(0,h.jsx)(h.Fragment,{children:Object.keys(n).map(e=>{var s;if("index"===e||"title"===e||"done"===e)return;let r=n[e];return null===(s=r.values)||void 0===s?void 0:s.map((n,s)=>(0,h.jsx)(aa,{geometries:t,simulation:l,boundaryCondition:n,index:s,type:e,swr:a,_onEdit:i},n.uuid))}).filter(e=>e)})};var an=l(78045);let as={name:"You need to define a name",type:"You need to select a type",selected:"You need to select a face",update:"Unable to add boundary condition"},ar=async(e,t,l)=>{try{var a;let i={...t},n=i.type.key;i.uuid=(0,e1.Z)();let s=tK.Z.deepCopy(e),r=s.scheme.configuration.boundaryConditions,o=r[n];o.values=[...null!==(a=o.values)&&void 0!==a?a:[],i];let u={...r,done:!0};await q.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","boundaryConditions"],value:u}]),await q.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","run"],value:{...s.scheme.configuration.run,done:!1}}]),await l.mutateOneSimulation(s)}catch(e){throw(0,V.lt)(as.update,e),e}},ao=e=>{let{simulation:t,boundaryCondition:l,swr:a,onError:i,onClose:n}=e,[s,r]=(0,x.useState)(!1),o=(0,x.useCallback)(()=>{(async()=>{r(!0);try{var e,s;if(!l.name){i(as.name),r(!1);return}if(!(null===(e=l.type)||void 0===e?void 0:e.key)){i(as.type),r(!1);return}if(!(null===(s=l.selected)||void 0===s?void 0:s.length)){i(as.selected),r(!1);return}i(),await ar(t,l,a),r(!1),n()}catch(e){r(!1)}})()},[t,l,a,i,n]);return(0,h.jsx)(U.HS,{loading:s,onAdd:o,needMargin:!0,children:"Add"})},au={name:"You need to define a name",type:"You need to select a type",selected:"You need to select a face",update:"Unable to edit boundary condition"},ad=async(e,t,l,a)=>{try{let n=tK.Z.deepCopy(e),s=n.scheme.configuration.boundaryConditions,r=t.type.key,o=l.type.key;if(o!==r){let e=s[o],t=e.values.findIndex(e=>e.uuid===l.uuid);e.values=[...e.values.slice(0,t),...e.values.slice(t+1)]}if(o!==r){var i;let e=s[r];e.values=[...null!==(i=e.values)&&void 0!==i?i:[],t]}else{let e=s[r],l=e.values.findIndex(e=>e.uuid===t.uuid);e.values=[...e.values.slice(0,l),t,...e.values.slice(l+1)]}let u={...s};await q.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","boundaryConditions"],value:u}]),await a.mutateOneSimulation(n)}catch(e){throw(0,V.lt)(au.update,e),e}},ac=e=>{let{simulation:t,boundaryCondition:l,oldBoundaryCondition:a,swr:i,onError:n,onClose:s}=e,[r,o]=(0,x.useState)(!1),u=(0,x.useCallback)(()=>{(async()=>{o(!0);try{var e,r;if(!l.name){n(au.name),o(!1);return}if(!(null===(e=l.type)||void 0===e?void 0:e.key)){n(au.type),o(!1);return}if(!(null===(r=l.selected)||void 0===r?void 0:r.length)){n(au.selected),o(!1);return}n(),await ad(t,l,a,i),o(!1),s()}catch(e){o(!1)}})()},[t,l,a,i,n,s]);return(0,h.jsx)(U.w6,{loading:r,onEdit:u,primary:!0,needMargin:!0,children:"Edit"})},am=e=>{let{boundaryCondition:t,index:l,value:a,checked:i,_onValueChange:n,_onCheckedChange:s}=e,r=(0,x.useCallback)(e=>n(l,e),[l,n]),o=(0,x.useCallback)(e=>s(l,e),[l,s]);return(0,h.jsx)(ll,{style:{marginBottom:"10px"},label:t.label,defaultValue:a,defaultChecked:i,onValueChange:r,onCheckedChange:o,unit:t.unit})},ah=e=>{var t,l,a,i,n,s,r,o;let{visible:u,geometries:d,simulation:c,boundaryCondition:m,swr:p,onClose:y}=e,[v,g]=(0,x.useState)([]),[f,b]=(0,x.useState)([]),[Z,C]=(0,x.useState)(),[k,S]=(0,x.useState)(),[P,E]=(0,x.useState)(),[N,O]=(0,x.useState)(),{dispatch:T}=(0,x.useContext)(H),A=(0,x.useMemo)(()=>c.scheme.configuration.boundaryConditions,[c]),z=(0,x.useMemo)(()=>c.scheme.configuration.dimension,[c]);(0,L.Z)(()=>{var e;T(tg(null===(e=d[0])||void 0===e?void 0:e.summary.uuid)),E(null==m?void 0:m.geometry)},[d,m],[T]),(0,L.Z)(()=>{!u&&k&&S(void 0)},[u,k]),(0,L.Z)(()=>{let e=Object.keys(A).map(e=>{if("index"===e||"title"===e||"done"===e)return;let t=A[e];return{key:e,label:t.label,children:t.children,values:t.values}}).filter(e=>e);b(e)},[A]),(0,L.Z)(()=>{let e=null==f?void 0:f.map(e=>{var t;return null===(t=e.values)||void 0===t?void 0:t.length}).filter(e=>e).reduce((e,t)=>e+t,0);C(e)},[f]),(0,L.Z)(()=>{u&&!k&&m?S(m):!u||k||m||void 0===Z||S(e=>{var t;return{...e,name:"Boundary condition "+(Z+1),geometry:null===(t=d[0])||void 0===t?void 0:t.id}})},[u,m,k,Z]),(0,L.Z)(()=>{let e=Object.keys(A).map(e=>{var t;if("index"===e||"title"===e||"done"===e)return;let l=A[e];return null==l?void 0:null===(t=l.values)||void 0===t?void 0:t.map(e=>{if(e.uuid!==(null==m?void 0:m.uuid))return{label:e.name,selected:e.selected}}).filter(e=>e)}).flat().filter(e=>e);g(e)},[A,m]);let _=(0,x.useCallback)(e=>{let t=e.target.value;S(e=>({...e,name:t}))},[]),F=(0,x.useCallback)(e=>{var t;let l=e.target.value,a=f.find(e=>e.key===l),i=A[l],n=null===(t=i.children)||void 0===t?void 0:t.map(e=>({checked:!0,value:e.default}));S(e=>({...e,type:{key:a.key,label:a.label,children:a.children},values:n}))},[A,f]),D=(0,x.useCallback)((e,t)=>{S(l=>({...l,values:[...l.values.slice(0,e),{checked:l.values[e].checked,value:t},...l.values.slice(e+1)]}))},[]),V=(0,x.useCallback)((e,t)=>{S(l=>({...l,values:[...l.values.slice(0,e),{checked:t,value:l.values[e].value},...l.values.slice(e+1)]}))},[]),B=(0,x.useCallback)(e=>{S(t=>({...t,selected:e}))},[]),W=(0,x.useMemo)(()=>{var e;return(null==k?void 0:k.type)&&(null===(e=k.type)||void 0===e?void 0:e.children)?(0,h.jsx)(R.Z,{children:k.type.children.map((e,t)=>{if(2!==z||!e.only3D)return(0,h.jsx)(am,{boundaryCondition:e,index:t,value:String(k.values[t].value),checked:k.type.children.length>1?k.values[t].checked:void 0,_onValueChange:D,_onCheckedChange:V},e.label)})}):null},[k,z,V,D]),G=(0,x.useCallback)(e=>{E(e);let t=d.find(t=>t.id===e);T(tg(null==t?void 0:t.summary.uuid)),S(t=>({...t,geometry:e}))},[d,T]),Y=(0,x.useCallback)(()=>{S(void 0),y()},[y]);return(0,h.jsx)(lg.Z,{className:eo().subPanel,title:"Boundary condition",placement:"left",closable:!1,open:u,mask:!1,maskClosable:!1,width:300,extra:(0,h.jsx)(w.ZP,{type:"text",icon:(0,h.jsx)(es.Z,{}),onClick:Y}),footer:(0,h.jsxs)("div",{style:{display:"flex",justifyContent:"flex-end"},children:[(0,h.jsx)(U.Lw,{onCancel:Y}),m?(0,h.jsx)(ac,{boundaryCondition:{uuid:null!==(l=null==k?void 0:k.uuid)&&void 0!==l?l:m.uuid,name:null!==(a=null==k?void 0:k.name)&&void 0!==a?a:m.name,type:null!==(i=null==k?void 0:k.type)&&void 0!==i?i:m.type,geometry:null!==(n=null==k?void 0:k.geometry)&&void 0!==n?n:m.geometry,selected:null!==(s=null==k?void 0:k.selected)&&void 0!==s?s:m.selected,values:null!==(r=null==k?void 0:k.values)&&void 0!==r?r:m.values},oldBoundaryCondition:{uuid:m.uuid,name:m.name,type:m.type,geometry:m.geometry,selected:m.selected,values:m.values},simulation:{id:c.id,scheme:c.scheme},swr:{mutateOneSimulation:p.mutateOneSimulation},onError:O,onClose:y}):(0,h.jsx)(ao,{boundaryCondition:{name:null==k?void 0:k.name,type:null==k?void 0:k.type,geometry:null==k?void 0:k.geometry,selected:null==k?void 0:k.selected,values:null==k?void 0:k.values},simulation:{id:c.id,scheme:c.scheme},swr:{mutateOneSimulation:p.mutateOneSimulation},onError:O,onClose:y})]}),children:(0,h.jsxs)(I.Z,{direction:"vertical",className:ep().fullWidth,children:[(0,h.jsx)(R.Z,{size:"small",children:(0,h.jsx)(eZ.Z,{layout:"vertical",children:(0,h.jsx)(eZ.Z.Item,{label:(0,h.jsx)(j.Z.Text,{strong:!0,children:"Boundary condition name"}),children:(0,h.jsx)(eC.Z,{value:null!==(o=null==k?void 0:k.name)&&void 0!==o?o:"",onChange:_,maxLength:50})})})}),(0,h.jsx)(R.Z,{size:"small",children:(0,h.jsx)(eZ.Z,{layout:"vertical",children:(0,h.jsx)(eZ.Z.Item,{label:(0,h.jsx)(j.Z.Text,{strong:!0,children:"Boundary condition type"}),children:(0,h.jsx)(an.ZP.Group,{optionType:"button",buttonStyle:"solid",value:null==k?void 0:null===(t=k.type)||void 0===t?void 0:t.key,onChange:F,children:null==f?void 0:f.map(e=>(0,h.jsx)(an.ZP.Button,{value:e.key,children:e.label},e.key))})})})}),W,(0,h.jsx)(tG.Z,{items:d.map(e=>({key:e.id,label:e.name,children:(0,h.jsx)(lP,{geometry:e,alreadySelected:v,updateSelected:B})})),activeKey:P,onChange:G}),N&&(0,h.jsxs)(j.Z.Text,{children:[(0,h.jsx)(M.Z,{style:{color:"red"}})," ",N]})]})})},ap=e=>{let{simulation:t,geometries:l,swr:a,setVisible:i}=e,[n,s]=(0,x.useState)(),[r,o]=(0,x.useState)(!1),{dispatch:u}=(0,x.useContext)(H),d=(0,x.useMemo)(()=>t.scheme.configuration.boundaryConditions,[t]);(0,L.Z)(()=>{var e;(null===(e=l[0])||void 0===e?void 0:e.summary)&&u(tx(2===l[0].summary.dimension?"edges":"faces"))},[l],[u]);let c=(0,x.useCallback)(()=>{s(void 0),o(!0),i(!1),u(ty())},[u,i]),m=(0,x.useCallback)((e,t)=>{let l=d[e],a=l.values[t];s(a),o(!0),i(!1),u(ty())},[d,u,i]),p=(0,x.useCallback)(()=>{u(tv()),o(!1),s(void 0),i(!0)},[u,i]);return l.length?(0,h.jsx)(f.Z,{children:(0,h.jsx)(f.Z.Content,{children:(0,h.jsxs)(R.Z,{size:"small",children:[(0,h.jsx)(U.HS,{onAdd:c,fullWidth:!0,primary:!1,children:"Add boundary condition"}),(0,h.jsx)(ai,{geometries:l.map(e=>({id:e.id,summary:e.summary})),simulation:{id:t.id,scheme:t.scheme},swr:{mutateOneSimulation:a.mutateOneSimulation},onEdit:m}),(0,h.jsx)(ah,{visible:r,geometries:l.map(e=>({id:e.id,name:e.name,summary:e.summary})),simulation:{id:t.id,scheme:t.scheme},boundaryCondition:n&&{uuid:n.uuid,name:n.name,type:n.type,geometry:n.geometry,selected:n.selected,values:n.values},swr:{mutateOneSimulation:a.mutateOneSimulation},onClose:p})]})})}):(0,h.jsx)(z.Z.Simple,{})};var ay=l(3363),av=l(67841),ax=l(36027),ag=l(57184);let af={name:"You need to define a name",point:"You need to select a point",formula:"You need to define a formula",update:"Unable to update simulation"},ab=async(e,t,l)=>{try{let a=tK.Z.deepCopy(e),i=a.scheme.configuration.run,n=t.index;delete t.index,i.sensors[n]=t,await q.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","run"],value:i}]),await l.mutateOneSimulation(a)}catch(e){throw(0,V.lt)(af.update,e),e}},aj=e=>{let{simulation:t,sensor:l,onError:a,onClose:i,swr:n}=e,[s,r]=(0,x.useState)(),o=(0,x.useCallback)(()=>{(async()=>{r(!0);try{if(!l.name){a(af.name),r(!1);return}if(!l.point){a(af.point),r(!1);return}if(!l.formula){a(af.formula),r(!1);return}a(),await ab(t,l,n),r(!1),i()}catch(e){r(!1)}})()},[t,l,a,i,n]);return(0,h.jsx)(U.w6,{loading:s,primary:!0,needMargin:!0,onEdit:o,children:"Edit"})},aw={name:"You need to define a name",point:"You need to select a point",formula:"You need to define a formula",update:"Unable to update simulation"},aZ=async(e,t,l)=>{try{var a;let i=tK.Z.deepCopy(e),n=i.scheme.configuration.run,s={...n,sensors:[...null!==(a=n.sensors)&&void 0!==a?a:[],t]};await q.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","run"],value:s}]),await l.mutateOneSimulation(i)}catch(e){throw(0,V.lt)(aw.update,e),e}},aC=e=>{let{simulation:t,sensor:l,onError:a,onClose:i,swr:n}=e,[s,r]=(0,x.useState)(),o=(0,x.useCallback)(()=>{(async()=>{r(!0);try{if(!l.name){a(aw.name),r(!1);return}if(!l.point){a(aw.point),r(!1);return}if(!l.formula){a(aw.formula),r(!1);return}a(),await aZ(t,l,n),r(!1),i()}catch(e){r(!1)}})()},[t,l,a,i,n]);return(0,h.jsx)(U.HS,{loading:s,needMargin:!0,onAdd:o,children:"Add"})},ak=e=>{var t,l,a,i,n,s,r,o,u;let{visible:d,geometries:c,simulation:m,sensor:p,onClose:y,swr:v}=e,[f,b]=(0,x.useState)(),[Z,C]=(0,x.useState)(),[k,S]=(0,x.useState)(),[P,E]=(0,x.useState)(),{point:N,dispatch:O}=(0,x.useContext)(H);(0,L.Z)(()=>{var e;O(tg(null===(e=c[0])||void 0===e?void 0:e.summary.uuid)),S(null==p?void 0:p.geometry)},[c,p],[O]),(0,L.Z)(()=>{O(tx("point"))},[O]),(0,L.Z)(()=>{if(!p){let e=m.scheme.configuration.run;C(t=>({...t,name:"Sensor "+(e.sensors?e.sensors.length+1:1)}))}},[m,p]),(0,L.Z)(()=>{p&&(C(p),O(tZ({x:p.point.x,y:p.point.y,z:p.point.z})))},[p],[O]),(0,L.Z)(()=>{N&&C(e=>({...e,point:N}))},[N]);let T=(0,x.useCallback)(()=>{b(!1),O(tv()),window.removeEventListener("click",T)},[O]),A=(0,x.useCallback)(()=>{f?T():(b(!0),O(ty()),setTimeout(()=>window.addEventListener("click",T),50))},[f,T,O]),z=(0,x.useCallback)(e=>{S(e);let t=c.find(t=>t.id===e);O(tg(t.summary.uuid)),C(t=>({...t,geometry:e}))},[c,O]),_=(0,x.useCallback)((e,t,l)=>{O(tZ({x:e,y:t,z:l}))},[O]),F=(0,x.useCallback)(e=>{C(t=>({...t,formula:e}))},[]),D=(0,x.useCallback)(()=>{C(void 0),E(void 0),O(tZ()),O(tv()),y()},[O,y]),V=(0,x.useCallback)(e=>{C(t=>({...t,name:e.target.value}))},[]),B=(0,x.useCallback)(e=>_(+e,null!==(i=null==N?void 0:N.y)&&void 0!==i?i:0,null!==(n=null==N?void 0:N.z)&&void 0!==n?n:0),[N,_]),W=(0,x.useCallback)(e=>_(null!==(s=null==N?void 0:N.x)&&void 0!==s?s:0,+e,null!==(r=null==N?void 0:N.z)&&void 0!==r?r:0),[N,_]),G=(0,x.useCallback)(e=>_(null!==(o=null==N?void 0:N.x)&&void 0!==o?o:0,null!==(u=null==N?void 0:N.y)&&void 0!==u?u:0,+e),[N,_]);return(0,h.jsx)(lg.Z,{title:"Sensor",placement:"left",closable:!1,open:d,mask:!1,maskClosable:!1,width:300,extra:(0,h.jsx)(w.ZP,{type:"text",icon:(0,h.jsx)(es.Z,{}),onClick:D}),footer:(0,h.jsxs)("div",{style:{display:"flex",justifyContent:"flex-end"},children:[(0,h.jsx)(U.Lw,{onCancel:D}),p?(0,h.jsx)(aj,{simulation:m,sensor:{...p,...Z},onError:E,onClose:D,swr:v}):(0,h.jsx)(aC,{simulation:m,sensor:Z,onError:E,onClose:D,swr:v})]}),children:(0,h.jsxs)(I.Z,{direction:"vertical",className:ep().fullWidth,children:[(0,h.jsxs)(R.Z,{size:"small",children:[(0,h.jsx)(j.Z.Text,{children:"Name"}),(0,h.jsx)(eC.Z,{value:null==Z?void 0:Z.name,onChange:V})]}),(0,h.jsxs)(R.Z,{size:"small",children:[(0,h.jsx)(tG.Z,{items:c.map(e=>({key:e.id,label:e.name})),activeKey:k,onChange:z}),(0,h.jsxs)(I.Z,{direction:"vertical",className:ep().fullWidth,children:[(0,h.jsxs)(I.Z,{className:ep().fullWidth,style:{justifyContent:"space-between"},children:[(0,h.jsx)(j.Z.Text,{children:"Point selection"}),(0,h.jsx)(g.Z,{title:"Pin in the geometry",children:(0,h.jsx)(w.ZP,{size:"small",type:f?"primary":"default",icon:(0,h.jsx)(ag.Z,{}),onClick:A})})]}),(0,h.jsx)(ll,{label:"X",defaultValue:null==Z?void 0:null===(t=Z.point)||void 0===t?void 0:t.x,onValueChange:B}),(0,h.jsx)(ll,{label:"Y",defaultValue:null==Z?void 0:null===(l=Z.point)||void 0===l?void 0:l.y,onValueChange:W}),(0,h.jsx)(ll,{label:"Z",defaultValue:null==Z?void 0:null===(a=Z.point)||void 0===a?void 0:a.z,onValueChange:G})]})]}),(0,h.jsx)(R.Z,{size:"small",className:ep().noBorderBottom,children:(0,h.jsx)(ll,{label:"Formula",defaultValue:null==Z?void 0:Z.formula,onValueChange:F})}),P&&(0,h.jsxs)(j.Z.Text,{children:[(0,h.jsx)(M.Z,{style:{color:"red"}})," ",P]})]})})},aS={udpate:"Unable to update simulation"},aP=async(e,t,l,a)=>{try{let i=tK.Z.deepCopy(e),n=i.scheme.configuration.run;l(tZ()),n.sensors=[...n.sensors.slice(0,t),...n.sensors.slice(t+1)],await q.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","run"],value:n}]),await a.mutateOneSimulation(i)}catch(e){throw(0,V.lt)(aS.udpate,e),e}},aE=e=>{let{simulation:t,index:l,swr:a}=e,[i,n]=(0,x.useState)(),{dispatch:s}=(0,x.useContext)(H),r=(0,x.useMemo)(()=>t.scheme.configuration.run,[t]),o=(0,x.useMemo)(()=>r.sensors[l],[l,r]),u=(0,x.useCallback)(async()=>{n(!0);try{await aP(t,l,s,a)}finally{n(!1)}},[t,l,s,a]);return(0,h.jsx)(U.m1,{loading:i,text:(0,h.jsxs)(h.Fragment,{children:["Are you sure you want to delete the sensor"," ",(0,h.jsx)(j.Z.Text,{strong:!0,children:o.name})]}),onDelete:u})},aM=e=>{let{simulation:t,sensor:l,index:a,_onEdit:i,swr:n}=e,{dispatch:s}=(0,x.useContext)(H),r=(0,x.useCallback)(()=>{s(ty()),s(tZ(l.point))},[l,s]),o=(0,x.useCallback)(()=>{s(tv())},[s]),u=(0,x.useCallback)(()=>i({...l,index:a}),[l,a,i]);return(0,h.jsx)(R.Z,{className:"".concat(ep().textAlignCenter," ").concat(lo().listItem),hoverable:!0,onMouseEnter:r,onMouseLeave:o,actions:[(0,h.jsx)(U.w6,{onEdit:u},"edit"),(0,h.jsx)(aE,{simulation:t,index:a,swr:n},"delete")],children:(0,h.jsx)(j.Z.Text,{strong:!0,className:ep().textAlignCenter,children:l.name})})},aN=e=>{var t;let{simulation:l,onEdit:a,swr:i}=e,n=(0,x.useMemo)(()=>l.scheme.configuration.run,[l]);return(0,h.jsx)(h.Fragment,{children:null===(t=n.sensors)||void 0===t?void 0:t.map((e,t)=>(0,h.jsx)(aM,{simulation:l,sensor:e,index:t,_onEdit:a,swr:i},e.name))})},aO=e=>{let{geometries:t,simulation:l,setVisible:a,setResults:i,setPostprocessing:n,swr:s}=e,[r,o]=(0,x.useState)(),[u,d]=(0,x.useState)(),c=(0,x.useCallback)(()=>{i([]),n(void 0),d(void 0),a(!1),o(!0)},[a,i,n]),m=(0,x.useCallback)(e=>{i([]),n(void 0),d(e),a(!1),o(!0)},[a,i,n]),p=(0,x.useCallback)(()=>{d(void 0),a(!0),o(!1)},[a]);return(0,h.jsxs)(R.Z,{size:"small",title:"Sensors",children:[(0,h.jsx)(ak,{visible:r,geometries:t,simulation:l,sensor:u,onClose:p,swr:s}),(0,h.jsxs)(I.Z,{direction:"vertical",className:ep().fullWidth,children:[(0,h.jsx)(w.ZP,{className:ep().fullWidth,disabled:!1,type:"primary",icon:(0,h.jsx)(ax.Z,{}),onClick:c,children:"Add a sensor"}),(0,h.jsx)(aN,{simulation:l,onEdit:m,swr:s})]})]})};var aT=l(139),aA=l(33997);let aL={plugins:"Plugins error",pluginsLoad:"Unable to load plugins"},az=e=>{let{plugin:t,onOk:a,setVisible:i}=e,n=y()(()=>l(64546)("./".concat(t.key,"/src/components"))),s=(0,x.useCallback)(e=>{(async()=>{(0,tX.merge)(t,e),await a(t),i(!1)})()},[t,a,i]);return(0,h.jsx)(R.Z,{title:t.configuration.name.value,children:(0,h.jsx)(n,{data:t.data,onSelect:s})},t.uuid)},aR=e=>{let{pluginsList:t,plugins:l,onOk:a,setVisible:i}=e;return(null==l?void 0:l.length)?(0,h.jsx)(I.Z,{align:"start",direction:"horizontal",wrap:!0,children:l.map(e=>{let l=t.find(t=>t.key===e.key);return l?(0,h.jsx)(az,{plugin:e,onOk:a,setVisible:i},e.key):null})}):null},aI=e=>{let{disabled:t,cloudServer:l,onOk:a}=e,[i,n]=(0,x.useState)(!1),[s,r]=(0,x.useState)([]),o=(0,v.useRouter)(),[u,{errorPlugins:d}]=aA.Z.usePlugins();(0,x.useEffect)(()=>{d&&(0,V.lt)(aL.plugins,d)},[d]),(0,x.useEffect)(()=>{(async()=>{try{let e=await t$.Z.list();r(e)}catch(e){(0,V.lt)(aL.pluginsLoad,e)}})()},[]);let c=(0,x.useCallback)(()=>n(!0),[]),m=(0,x.useCallback)(()=>n(!1),[]),p=(0,x.useCallback)(()=>{(async()=>{await o.push({pathname:"/dashboard",query:{page:"account",tab:"hpc"}})})()},[o]);return(0,h.jsxs)(R.Z,{size:"small",title:"Computational resource",children:[(0,h.jsx)(tH.Z,{open:i,title:"Computational resource",okButtonProps:{disabled:!0,style:{display:"none"}},onCancel:m,style:{width:"unset"},children:(0,h.jsxs)(I.Z,{direction:"vertical",children:[(0,h.jsxs)(j.Z.Text,{children:["Your computational resource does not appear in this list? Create one in your"," ",(0,h.jsx)(U.Qj,{onClick:p,children:"account settings"})]}),(0,h.jsx)(aR,{pluginsList:s,plugins:u,onOk:a,setVisible:n})]})}),(0,h.jsxs)(I.Z,{direction:"vertical",className:ep().fullWidth,children:[l&&(0,h.jsxs)(h.Fragment,{children:[(0,h.jsxs)(j.Z.Text,{children:[(0,h.jsx)("span",{className:ep().textLight,children:"Plugin:"})," ",l.name]}),(0,h.jsxs)(j.Z.Text,{children:[(0,h.jsx)("span",{className:ep().textLight,children:"Name:"})," ",l.configuration.name.value]}),Object.keys(l.inUseConfiguration).map(e=>{let t=l.inUseConfiguration[e],a=t.value;return"boolean"==typeof a&&(a=a?"yes":"no"),(0,h.jsxs)(j.Z.Text,{children:[(0,h.jsxs)("span",{className:ep().textLight,children:[t.label,":"]})," ",a]},e)})]}),(0,h.jsx)(w.ZP,{className:ep().fullWidth,disabled:t,type:l?"link":"primary",icon:(0,h.jsx)(aT.Z,{}),onClick:c,children:l?"Modify the resource":"Select a resource"})]})]})};var a_=l(15360),aF=l(25935),aD=l(48764).lW;let aU={log:"Unable to get system log"},aV=async(e,t)=>{try{let l=await q.Z.log({id:e.id},t.systemLog),a=aD.from(l.log).toString();tH.Z.info({title:"System log",width:"unset",content:(0,h.jsx)("div",{style:{maxHeight:"70vh",overflow:"auto"},children:(0,h.jsx)("pre",{children:(0,h.jsx)("code",{children:(0,aF.ZP)(a.replace(/\n\n/g,"\n").replace(/\n/g,"<br />"))})})})})}catch(e){(0,V.lt)(aU.log,e)}},aB=e=>{var t,l,a,i;let{simulation:n,step:s,loading:r,setLoading:o}=e,u=(0,x.useCallback)(()=>{(async()=>{o(!0);try{await aV(n,s)}catch(e){}finally{o(!1)}})()},[n,s,o]);return(0,h.jsxs)(h.Fragment,{children:[s.systemLog&&(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)(w.ZP,{loading:r,onClick:u,children:"Complete log"}),(0,h.jsx)("br",{})]}),s.link&&(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)("a",{href:"https://"+s.link.href,target:"_blank",rel:"noreferrer",children:(0,h.jsx)(w.ZP,{type:"primary",children:s.link.label})}),(0,h.jsx)("br",{})]}),(0,h.jsxs)(lU.Z,{ghost:!0,children:[s.warning&&(0,h.jsx)(lU.Z.Panel,{className:lo().warning,header:(0,h.jsx)(j.Z.Text,{type:"warning",children:"Warnings"}),children:(0,aF.ZP)(s.warning.replace(/\n\n/g,"\n").replace(/\n/g,"<br />"))},"warnings"),s.error&&(0,h.jsx)(lU.Z.Panel,{className:lo().error,header:(0,h.jsx)(j.Z.Text,{type:"danger",children:"Errors"}),children:(0,aF.ZP)(s.error.replace(/\n\n/g,"\n").replace(/\n/g,"<br />"))},"errors")]}),(0,aF.ZP)(null!==(a=null===(t=s.pluginLog)||void 0===t?void 0:t.replace(/\n\n/g,"\n").replace(/\n/g,"<br />"))&&void 0!==a?a:""),(0,aF.ZP)(null!==(i=null===(l=s.log)||void 0===l?void 0:l.replace(/\n\n/g,"\n").replace(/\n/g,"<br />").replace(/Info\s*:/g,'<span style="color: blue; font-weight: bold;">Info: </span>').replace(/Error:/g,'<span style="color: red; font-weight: bold;">Error:</span>'))&&void 0!==i?i:"")]})},aW=e=>{let{simulation:t,steps:l}=e,[a,i]=(0,x.useState)(!1),[n,s]=(0,x.useState)(!1),r=(0,x.useCallback)(()=>i(!0),[]),o=(0,x.useCallback)(()=>i(!1),[]);return(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)(lg.Z,{title:"Log",open:a,onClose:o,width:"50%",children:(0,h.jsx)(tG.Z,{items:null==l?void 0:l.map((e,l)=>({key:""+l,label:e.label,children:(0,h.jsx)(aB,{simulation:t,step:e,loading:n,setLoading:s})}))})}),(0,h.jsx)(g.Z,{title:"Log",children:(0,h.jsx)(w.ZP,{disabled:!(null==l?void 0:l.length),icon:(0,h.jsx)(a_.Z,{}),onClick:r})})]})};var aH=l(23430);let aG={download:"Unable to download file"},aY=async(e,t)=>{try{let l=await ez.download({id:e.id},{originPath:t.originPath,fileName:t.fileName}),a=await l.blob(),i=window.URL.createObjectURL(new Blob([a])),n=document.createElement("a");n.href=i,n.setAttribute("download",t.name+"."+t.fileName.split(".").pop()),n.click()}catch(e){(0,V.lt)(aG.download,e)}},aJ=e=>{let{simulation:t,file:l}=e,[a,i]=(0,x.useState)(!1),n=(0,x.useCallback)(()=>{(async()=>{i(!0);try{await aY(t,l)}catch(e){}finally{i(!1)}})()},[t,l]);return(0,h.jsx)(g.Z,{title:"Download",children:(0,h.jsx)(w.ZP,{loading:a,icon:(0,h.jsx)(aH.Z,{}),onClick:n})})},aX={archive:"Unable to download archive"},aq=async e=>{try{let t=await ez.archive({id:e.id}),l=await t.blob(),a=window.URL.createObjectURL(new Blob([l])),i=document.createElement("a");i.href=a,i.setAttribute("download",e.scheme.name+".zip"),i.click()}catch(e){(0,V.lt)(aX.archive,e)}},aK=e=>{let{simulation:t}=e,[l,a]=(0,x.useState)(!1),i=(0,x.useCallback)(()=>{(async()=>{a(!0);try{await aq(t)}catch(e){}finally{a(!1)}})()},[t]);return(0,h.jsx)(U.o6,{loading:l,onDownload:i})},a$=e=>{var t;let{simulation:l,results:a,file:i,setResults:n}=e,s=(0,x.useCallback)(()=>{let e=a.findIndex(e=>e.fileName===i.fileName&&e.name===i.name);-1===e?n([...a,i]):n([...a.slice(0,e),...a.slice(e+1)])},[a,i,n]),r=(0,x.useMemo)(()=>a.find(e=>e.fileName===i.fileName&&e.name===i.name),[a,i]);return(0,h.jsxs)(I.Z,{style:{alignItems:"center"},children:[(0,h.jsx)(w.ZP,{icon:r?(0,h.jsx)(Z.Z,{style:{color:"#fad114"}}):(0,h.jsx)(C.Z,{}),onClick:s}),(0,h.jsx)(aJ,{simulation:{id:l.id},file:{name:i.name,fileName:i.fileName,originPath:i.originPath}}),null===(t=i.name)||void 0===t?void 0:t.replaceAll("_"," ")]})},aQ=e=>{let{simulation:t,results:l,setResults:a}=e,[i,n]=(0,x.useState)(),[s,r]=(0,x.useState)(),[o,u]=(0,x.useState)(),d=(0,x.useMemo)(()=>{var e;return null==t?void 0:null===(e=t.scheme)||void 0===e?void 0:e.configuration},[t]);(0,L.Z)(()=>{var e;if(!(null==t?void 0:t.tasks)){n([]),r(void 0);return}let l=[],a=null==d?void 0:null===(e=d.run)||void 0===e?void 0:e.resultsFilter;t.tasks.forEach(e=>{if(e.file&&l.push(e.file),e.files){if(a){let t=new RegExp(a.pattern),i=e.files.filter(e=>!t.test(e.fileName)),n=e.files.filter(e=>t.test(e.fileName)),s=l0(n,a),o=s.map(e=>e.number).filter((e,t,l)=>l.indexOf(e)===t).sort((e,t)=>e-t),u=l1(d,a),c=o.map((e,t)=>({label:Math.round(1e15*(u?e*u:t))/1e15,value:e}));l.push(...i),r({filtered:!0,name:a.name,files:s,options:c})}else l.push(...e.files)}}),n(l)},[t,d]),(0,L.Z)(()=>{!o&&s&&u(null==s?void 0:s.options[0].value)},[s,o]);let c=(0,x.useCallback)(e=>{let t=s.files.filter(t=>t.number===e&&l.find(e=>e.name===t.name));a(t),u(e)},[l,s,a]);return i||s?(null==i?void 0:i.length)||s?(0,h.jsx)(R.Z,{size:"small",title:"Results",extra:(0,h.jsx)(aK,{simulation:t&&{id:t.id,scheme:t.scheme}}),children:(0,h.jsxs)(I.Z,{direction:"vertical",className:ep().fullWidth,children:[null==i?void 0:i.map(e=>(0,h.jsx)(a$,{simulation:t,results:l,file:e,setResults:a},e.name)),s&&(0,h.jsxs)(h.Fragment,{children:[s.name,(0,h.jsx)(tW.Z,{className:ep().fullWidth,options:s.options,value:o,onChange:c}),s.files.map(e=>{if(e.number===o)return(0,h.jsx)(a$,{simulation:t,results:l,file:e,setResults:a},e.name)})]})]})}):(0,h.jsx)(R.Z,{size:"small",children:"No results yet"}):(0,h.jsx)(eF.Z,{})},a0={run:"Unable to run simulation",stop:"Unable to stop simulation",update:"Unable to update simulation"},a1=async(e,t,l)=>{try{let a=tK.Z.deepCopy(e),i=e.scheme.configuration;i.run.cloudServer=t,a.scheme.configuration=i,await q.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","run"],value:i.run}]),await l.mutateOneSimulation(a),await l.mutateSimulation(a)}catch(e){(0,V.lt)(a0.update,e)}},a2=async e=>{try{await q.Z.run({id:e.id})}catch(e){throw(0,V.lt)(a0.run,e),e}},a5=async e=>{try{await q.Z.stop({id:e.id})}catch(e){throw(0,V.lt)(a0.stop,e),e}},a4=e=>{var t;let{geometries:l,simulation:a,results:i,setResults:n,setPostprocessing:s,setVisible:r,swr:o}=e,[u,d]=(0,x.useState)(!1),[c,m]=(0,x.useState)(!1),[p,y]=(0,x.useState)([]),[v,g]=(0,x.useState)(0),[b,{mutateSimulation:j}]=q.Z.useSimulation(a.id,2e3),Z=(0,x.useMemo)(()=>a.scheme.configuration,[a]),C=(0,x.useMemo)(()=>{var e;return null==b?void 0:null===(e=b.scheme)||void 0===e?void 0:e.configuration},[b]);(0,L.Z)(()=>{if(!Z){d(!0);return}let e=!0;Object.keys(Z).forEach(t=>{if("dimension"!==t&&"run"!==t){let l=Z[t];l.done||(e=!1)}}),Z.run.cloudServer||(e=!1),d(!e)},[Z]),(0,L.Z)(()=>{var e,t,l;(null==b?void 0:null===(e=b.tasks)||void 0===e?void 0:e.find(e=>(null==e?void 0:e.status)==="error"))?m(!1):(null==b?void 0:null===(t=b.tasks)||void 0===t?void 0:t.find(e=>e&&"finish"!==e.status))?m(!0):m(!1);let a=[];null==b||null===(l=b.tasks)||void 0===l||l.forEach((e,t)=>{if(e){if(t===b.tasks.length-1){var l,i,n;let t=null!==(n=null===(l=e.log)||void 0===l?void 0:l.match(/[\d\s]{3}%/g))&&void 0!==n?n:null===(i=e.log)||void 0===i?void 0:i.match(/[\d\s]*%/g),a=t?parseFloat(t.pop()):void 0;a&&g(a)}a[e.index]={index:e.index,label:e.label,status:e.status,log:e.log,pluginLog:e.pluginLog,warning:e.warning,error:e.error,systemLog:e.systemLog,link:e.link}}}),y(a)},[null==b?void 0:b.tasks]);let k=(0,x.useCallback)(async e=>a1(a,e,{...o,mutateSimulation:j}),[a,o,j]),S=(0,x.useCallback)(()=>{(async()=>{m(!0);try{await a2(a)}catch(e){m(!1)}})()},[a]),P=(0,x.useCallback)(()=>{(async()=>{try{await a5(a),m(!1)}catch(e){}})()},[a]);return a&&b&&(null==b?void 0:b.id)!=="0"?(0,h.jsx)(f.Z,{children:(0,h.jsx)(f.Z.Content,{children:(0,h.jsxs)(I.Z,{direction:"vertical",className:ep().fullWidth,children:[(0,h.jsx)(aO,{geometries:l,simulation:a,setVisible:r,setResults:n,setPostprocessing:s,swr:{mutateOneSimulation:o.mutateOneSimulation}}),(0,h.jsx)(aI,{disabled:c,cloudServer:null==C?void 0:null===(t=C.run)||void 0===t?void 0:t.cloudServer,onOk:k}),(0,h.jsx)(R.Z,{size:"small",title:"Run",children:(0,h.jsxs)(I.Z,{direction:"vertical",className:ep().fullWidth,size:20,children:[(0,h.jsxs)("div",{className:ep().fullWidth,style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,h.jsxs)(I.Z,{children:[(0,h.jsx)(w.ZP,{disabled:u,type:"primary",icon:(0,h.jsx)(av.Z,{}),loading:c,onClick:S,children:"Run"}),(0,h.jsx)(w.ZP,{disabled:!c,danger:!0,icon:(0,h.jsx)(eJ.Z,{}),shape:"circle",onClick:P})]}),(0,h.jsx)(aW,{simulation:{id:a.id},steps:p})]}),(0,h.jsx)(ay.Z,{direction:"vertical",current:p.length-1,percent:v,items:p.map((e,t)=>({key:t,title:e.label,description:"("+(t+1)+"/"+p.length+")",status:e.status}))})]})}),(0,h.jsx)(aQ,{simulation:b&&{id:b.id,scheme:b.scheme,tasks:b.tasks},results:i,setResults:n})]})})}):(0,h.jsx)(f.Z,{children:(0,h.jsx)(f.Z.Content,{children:(0,h.jsx)(R.Z,{size:"small",children:(0,h.jsx)(eF.Z,{})})})})};var a3=l(1402),a8=[{key:"warpByVector",label:"Warp by vector",parameters:[{key:"Vectors",label:"Vectors",rules:[{required:!0,message:"Vectors is required"}]},{key:"ScaleFactor",label:"Scale factor",default:"1",rules:[{required:!0,message:"Scale factor is required"}]}]},{key:"contour",label:"Contour",parameters:[{key:"ContourBy",label:"Contour by",rules:[{required:!0,message:"ContourBy by is required"}]},{key:"isosurface",label:"Isosurface",default:"0",rules:[{required:!0,message:"Isosurface is required"}]}]},{key:"streamTracer",label:"Stream tracer",parameters:[{key:"Vectors",label:"Vectors",rules:[{required:!0,message:"Vectors is required"}]}]}];let a6=async(e,t,l,a)=>{let i=await (0,$.R)("/api/postprocessing",{method:"POST",headers:{Accept:"application/json"},body:JSON.stringify({simulation:e,result:t,filter:l,parameters:a})});return i.json()};var a7={run:a6};let a9={run:"Unable to run filter"},ie=async(e,t,l,a)=>{try{return await a7.run(e,t,l,a)}catch(e){throw(0,V.lt)(a9.run,e),e}},it=e=>{let{simulation:t,postprocessing:l,result:a,setResult:i}=e,n=(0,x.useCallback)(()=>i((null==l?void 0:l.fileName)===a.fileName&&(null==l?void 0:l.name)===a.name?void 0:{type:"postprocessing",...a}),[l,a,i]);return(0,h.jsxs)(I.Z,{children:[(0,h.jsx)(w.ZP,{icon:(null==l?void 0:l.fileName)===a.fileName&&(null==l?void 0:l.name)===a.name?(0,h.jsx)(Z.Z,{className:ep().primaryColor}):(0,h.jsx)(C.Z,{}),onClick:n}),(0,h.jsx)(aJ,{simulation:{id:t.id},file:{name:a.name,fileName:a.fileName,originPath:a.originPath}}),a.name]},a.glb)},il=e=>{let{simulation:t,postprocessing:l,results:a,setResult:i}=e;return a.length?(0,h.jsx)(I.Z,{direction:"vertical",className:ep().fullWidth,children:a.map(e=>(0,h.jsx)(it,{simulation:t,postprocessing:l,result:e,setResult:i},e.glb))}):(0,h.jsx)(h.Fragment,{children:"No results"})},ia=e=>{let{simulation:t,results:l,postprocessing:a,setResult:i}=e,[n,s]=(0,x.useState)(),[r,o]=(0,x.useState)(),[u,d]=(0,x.useState)(),[c,m]=(0,x.useState)();(0,x.useEffect)(()=>{1!==l.length&&n&&s(!1)},[l,n]);let p=(0,x.useMemo)(()=>l[0],[l]);(0,x.useEffect)(()=>{t||(o(void 0),m(void 0))},[t]);let y=(0,x.useMemo)(()=>null==t?void 0:t.scheme.configuration.run.postprocessing,[t]),v=(0,x.useMemo)(()=>a8.map(e=>{if(null==y?void 0:y.find(t=>t.key===e.key))return{label:e.label,value:e.key}}).filter(e=>e),[y]),b=(0,x.useMemo)(()=>{if(!y||!r)return;let e=a8.find(e=>e.key===r),t=y.find(e=>e.key===r);if(null==e?void 0:e.parameters)return e.parameters.map((e,l)=>{var a;let i=null==t?void 0:null===(a=t.parameters)||void 0===a?void 0:a.find(t=>t.key===e.key);return(null==i?void 0:i.value)?(0,h.jsx)(eZ.Z.Item,{label:e.label,name:["parameters",l],initialValue:i.value,rules:e.rules,children:(0,h.jsx)(eC.Z,{disabled:!0})},e.key):(null==i?void 0:i.options)?(0,h.jsx)(eZ.Z.Item,{label:e.label,name:["parameters",l],rules:e.rules,children:(0,h.jsx)(tW.Z,{options:i.options.map(e=>({label:e,value:e}))})},e.key):(0,h.jsx)(eZ.Z.Item,{label:e.label,name:["parameters",l],rules:e.rules,initialValue:e.default,children:(0,h.jsx)(eC.Z,{})},e.key)})},[y,r]),j=(0,x.useCallback)(()=>s(!0),[]),Z=(0,x.useCallback)(()=>s(!1),[]),C=(0,x.useCallback)(e=>{(async()=>{d(!0);try{var l;let a=await ie({id:t.id},p,r,null!==(l=e.parameters)&&void 0!==l?l:[]);m({filter:r,results:a})}catch(e){}d(!1)})()},[t,p,r]);return t&&1===l.length&&y&&v.length?(0,h.jsx)(f.Z,{style:{position:"absolute",zIndex:101,right:25,bottom:50,backgroundColor:"rgba(255, 255, 255, 0)"},children:(0,h.jsxs)(f.Z.Content,{children:[(0,h.jsx)(g.Z,{title:"Post-processing",children:(0,h.jsx)(w.ZP,{type:"primary",icon:(0,h.jsx)(a3.Z,{}),onClick:j,style:{width:40,height:40,border:"1px solid #5E14FA",borderRadius:20,marginBottom:-20}})}),(0,h.jsxs)(lg.Z,{title:"Post-processing",closable:!0,onClose:Z,open:n,mask:!1,maskClosable:!1,children:[(0,h.jsx)(eZ.Z,{style:{margin:"24px 0"},children:(0,h.jsx)(eZ.Z.Item,{name:"filter",label:"Filter",children:(0,h.jsx)(tW.Z,{placeholder:"Select a filter",options:v,onChange:o})})}),(0,h.jsxs)(eZ.Z,{layout:"vertical",style:{margin:"24px 0"},onFinish:C,children:[b,(0,h.jsx)(eZ.Z.Item,{children:(0,h.jsx)(w.ZP,{type:"primary",loading:u,htmlType:"submit",icon:(0,h.jsx)(av.Z,{}),children:"Run"})})]}),c&&(0,h.jsx)(R.Z,{size:"small",title:"Post-processing",extra:c.filter,children:(0,h.jsx)(il,{simulation:t,postprocessing:a,results:c.results,setResult:i})})]})]})}):null},ii={plugins:"Unable to load plugins",update:"Unable to update simulation"},is=async e=>{try{let t=await t$.Z.list();return ir(e,tq.Z,t)}catch(e){return(0,V.lt)(ii.plugins,e),[]}},ir=(e,t,l)=>{let a=t;return l.forEach(t=>{var l;(null==e?void 0:null===(l=e.authorizedplugins)||void 0===l?void 0:l.includes(t.key))&&"Model"===t.category&&(a=[...a,...t.models])}),a},io=(e,t)=>{if(!(null==t?void 0:t.length))return!0;if(Array.isArray(e)){let l=t.filter(t=>e.includes(t));return l.length==t.length}return!!(1===t.length&&t.includes(e))},iu=e=>{let{visible:t,user:l,onOk:a,onCancel:i}=e,[n,s]=(0,x.useState)(),[r,o]=(0,x.useState)(!1),[u,d]=(0,x.useState)([]),[c,m]=(0,x.useState)(),[p,y]=(0,x.useState)();(0,L.Z)(()=>{(async()=>{if(l){let e=await is(l);d(e)}})()},[l]),(0,L.Z)(()=>{let e=u.map(e=>e.category).flat().filter((e,t,l)=>l.indexOf(e)===t).map(e=>({key:e,value:e}));m(e)},[u]);let v=(0,x.useCallback)(e=>{let{key:t}=e,l=u.find(e=>e.algorithm===t);s(tK.Z.deepCopy(l))},[u]),g=(0,x.useCallback)(e=>{let{key:t}=e,a=l.models.find(e=>e.algorithm===t);s(tK.Z.deepCopy(a))},[l]),j=(0,x.useCallback)(()=>{(async()=>{if(o(!0),n)try{await a(n)}catch(e){}o(!1)})()},[n,a]),w=(0,x.useMemo)(()=>{let e=[{key:"category",disabled:!0,label:(0,h.jsx)(tW.Z,{mode:"multiple",className:ep().fullWidth,options:c,allowClear:!0,showArrow:!1,placeholder:"Category filter",onChange:y})}];return u.forEach(t=>{io(t.category,p)&&e.push({key:t.algorithm,label:t.name})}),e},[u,c,p]),Z=(0,x.useMemo)(()=>{let e=[{key:"category",disabled:!0,label:(0,h.jsx)(tW.Z,{mode:"multiple",className:ep().fullWidth,options:c,allowClear:!0,showArrow:!1,placeholder:"Category filter",onChange:y})}];return null==l||l.models.forEach(t=>{io(t.category,p)&&e.push({key:t.algorithm,label:t.name})}),e},[l,c,p]);return(0,h.jsx)(tH.Z,{open:t,title:"Create simulation",okText:"Create",okButtonProps:{loading:r},onOk:j,onCancel:i,width:"80%",children:(0,h.jsxs)(f.Z,{className:lo().selectorContent,children:[(0,h.jsx)(f.Z.Sider,{theme:"light",width:300,className:lo().selectorSider,children:(0,h.jsx)(tG.Z,{items:[{key:"tanatloc",label:"Tanatloc algorithm",children:(0,h.jsx)(b.Z,{mode:"inline",items:w,onSelect:v})},{key:"personal",label:"User algorithm",children:(0,h.jsx)(b.Z,{mode:"inline",className:lo().selectorMenu,items:Z,onSelect:g})}]})}),(0,h.jsx)(f.Z.Content,{className:lo().selector,children:(0,h.jsx)(ed.Z.Html,{html:null==n?void 0:n.description})})]})})},id=async(e,t,l)=>{try{let a=t.find(t=>{var l;return t.algorithm===(null==e?void 0:null===(l=e.scheme)||void 0===l?void 0:l.algorithm)}),i=tK.Z.deepCopy(e);(0,tX.merge)(i.scheme,a),await q.Z.update({id:e.id},[{key:"scheme",value:i.scheme}]),await l.mutateOneSimulation(i)}catch(e){(0,V.lt)(ii.update,e)}},ic=e=>{let{user:t,simulation:l,swr:a}=e,[i,n]=(0,x.useState)([]);return(0,L.Z)(()=>{(async()=>{if(t){let e=await is(t);n(e)}})()},[t]),(0,L.Z)(()=>{let e=i.find(e=>{var t;return e.algorithm===(null==l?void 0:null===(t=l.scheme)||void 0===t?void 0:t.algorithm)});if(e&&(null==l?void 0:l.scheme)){let t=(0,tY.Z)(l.scheme,e),n=(0,tJ.Z)(l.scheme,e);(Object.keys(t).length||Object.keys(n).length)&&(tH.Z.info({title:"Update",content:"Your model need an update, please wait.",closable:!1,okButtonProps:{hidden:!0}}),id(l,i,a).finally(()=>tH.Z.destroyAll()))}},[l,i,a]),null};var im={Selector:iu,Updater:ic,About:le,Geometry:lm,Materials:lD,Parameters:lQ,Initialization:l9,BoundaryConditions:ap,Run:a4,Postprocessing:ia},ih=l(39095),ip=l.n(ih);let iy=y()(()=>Promise.all([l.e(7521),l.e(5731),l.e(4830)]).then(l.bind(l,4830)),{loadableGenerated:{webpack:()=>[4830]},ssr:!1}),iv={dashboard:{key:"dashboard"},geometries:{label:"GEOMETRIES",key:"geometries"},simulations:{label:"SIMULATIONS",key:"simulations"}},ix={user:"Unable to get user",project:"Unable to get project",simulations:"Unable to get simulations",geometries:"Unable to get geometries",add:"Unable to add simulation"},ig=async(e,t,l)=>{try{var a;let i=await q.Z.add({id:e.id},{name:t.name,scheme:t});await l.addOneSimulation(i),await l.mutateProject({id:e.id,simulations:[...null!==(a=e.simulations)&&void 0!==a?a:[],i.id]})}catch(e){throw(0,V.lt)(ix.add,e),e}},ib=e=>{let{visible:t,geometry:l,panel:a,add:i,del:n,close:s}=e,r=(0,x.useCallback)(e=>{var t,i,r;e.stopPropagation(),(null==a?void 0:null===(t=a.props)||void 0===t?void 0:null===(i=t.children)||void 0===i?void 0:null===(r=i.type)||void 0===r?void 0:r.componentName)===eO.componentName&&s(),n(l)},[l,a,n,s]),o=(0,x.useCallback)(e=>{e.stopPropagation(),i(l)},[l,i]);return(0,h.jsxs)("div",{children:[l.name,t?(0,h.jsx)(Z.Z,{onClick:r}):(0,h.jsx)(C.Z,{onClick:o})]})},ij=e=>{let{simulation:t}=e;return t.scheme.user?(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)(g.Z,{title:"User algorithm",placement:"right",children:(0,h.jsx)(k.Z,{style:{position:"absolute",top:0,left:14,fontSize:14,color:"#fad114"}})}),t.name]}):(0,h.jsx)(h.Fragment,{children:t.name})},iw=()=>{let e=(0,v.useRouter)(),{page:t,workspaceId:l,projectId:a}=e.query,[i,n]=(0,x.useState)(!1),[s,r]=(0,x.useState)([]),[o,u]=(0,x.useState)(!1),[d,c]=(0,x.useState)(),[m,p]=(0,x.useState)([]),[y,g]=(0,x.useState)(),[Z,C]=(0,x.useState)(),[k,R]=(0,x.useState)(),[I,_]=(0,x.useState)(!0),[F,{errorUser:B,loadingUser:W}]=J.Z.useUser(),[H,{mutateProject:G,errorProject:K,loadingProject:$}]=X.Z.useProject(a),[Q,{addOneSimulation:ee,delOneSimulation:et,mutateOneSimulation:el,errorSimulations:ea,loadingSimulations:ei}]=q.Z.useSimulations(null==H?void 0:H.simulations),[es,{addOneGeometry:er,delOneGeometry:eo,mutateOneGeometry:ed,errorGeometries:ec,loadingGeometries:em}]=en.useGeometries(null==H?void 0:H.geometries),eh=(0,x.useCallback)(()=>n(!0),[]),ey=(0,x.useCallback)(()=>u(!0),[]),ev=(0,x.useCallback)(()=>u(!1),[]),ex=(0,x.useCallback)(e=>{r(t=>[...t,e])},[]),eg=(0,x.useCallback)(e=>{let t=s.findIndex(t=>t.id===e.id);-1!==t&&r(e=>[...e.slice(0,t),...e.slice(t+1)])},[s]),ef=(0,x.useCallback)(()=>{R(void 0),C(void 0)},[]),eb=(0,x.useCallback)(e=>{let t=es.findIndex(t=>t.id===e);-1!==t&&r(e=>[...e.slice(0,t),{id:"0",needCleanup:!0},...e.slice(t+1)])},[es]),ej=(0,x.useCallback)(e=>{let t=es.find(t=>t.id===e);if(!t)return;let l=s.find(t=>t.id===e);l||r(e=>[...e,{...t,visible:!0}]),R((0,h.jsx)(eu,{visible:!0,title:"Geometry",onClose:ef,children:(0,h.jsx)(eO,{project:{id:H.id,geometries:H.geometries},geometry:{id:t.id,name:t.name,summary:t.summary},swr:{mutateProject:G,mutateOneGeometry:ed,delOneGeometry:eo},close:ef,onCleanup:eb})}))},[H,es,s,G,ed,eo,eb,ef]),ew=(0,x.useCallback)(e=>{R((0,h.jsx)(eu,{visible:!0,title:"About",onClose:ef,children:(0,h.jsx)(im.About,{project:{id:H.id,simulations:H.simulations},simulation:{id:e.id,name:e.name,scheme:e.scheme},swr:{mutateProject:G,addOneSimulation:ee,delOneSimulation:et,mutateOneSimulation:el}})}))},[H,G,ee,et,el,ef]),eZ=(0,x.useCallback)(e=>{R((0,h.jsx)(eu,{visible:!0,title:"Geometry",onClose:ef,children:(0,h.jsx)(im.Geometry,{loadedGeometries:es,geometries:s.map(e=>({id:e.id,summary:e.summary})),simulation:{id:e.id,scheme:e.scheme},setGeometries:r,swr:{mutateOneSimulation:el}})}))},[es,s,el,ef]),eC=(0,x.useCallback)(e=>{R((0,h.jsx)(eu,{visible:!0,title:"Parameters",onClose:ef,children:(0,h.jsx)(im.Parameters,{simulation:{id:e.id,scheme:e.scheme},swr:{mutateOneSimulation:el}})}))},[el,ef]),ek=(0,x.useCallback)(e=>{R((0,h.jsx)(eu,{visible:I,title:"Materials",onClose:ef,children:(0,h.jsx)(im.Materials,{geometries:s.map(e=>({id:e.id,name:e.name,summary:e.summary})),simulation:{id:e.id,scheme:e.scheme},swr:{mutateOneSimulation:el},setVisible:_})}))},[s,I,el,ef]),eS=(0,x.useCallback)(e=>{R((0,h.jsx)(eu,{visible:!0,title:"Initialization",onClose:ef,children:(0,h.jsx)(im.Initialization,{simulations:Q,simulation:e,swr:{mutateOneSimulation:el}})}))},[Q,el,ef]),eP=(0,x.useCallback)(e=>{R((0,h.jsx)(eu,{visible:I,title:"Boundary conditions",onClose:ef,children:(0,h.jsx)(im.BoundaryConditions,{geometries:s.map(e=>({id:e.id,name:e.name,summary:e.summary})),simulation:{id:e.id,scheme:e.scheme},swr:{mutateOneSimulation:el},setVisible:_})}))},[s,I,el,ef]),eE=(0,x.useCallback)(e=>{R((0,h.jsx)(eu,{visible:I,title:"Run",onClose:ef,children:(0,h.jsx)(im.Run,{geometries:s,simulation:{id:e.id,scheme:e.scheme},results:m,setResults:p,setPostprocessing:g,setVisible:_,swr:{mutateOneSimulation:el}})}))},[s,m,I,el,ef]),eM=(0,x.useCallback)((e,t)=>{var l,a,i,n,s,o;let u=Q.find(t=>t.id===e);if(!u)return;c(u);let d=null===(l=u.scheme)||void 0===l?void 0:null===(a=l.configuration)||void 0===a?void 0:null===(i=a.geometry)||void 0===i?void 0:i.value,m=null===(n=u.scheme)||void 0===n?void 0:null===(s=n.configuration)||void 0===s?void 0:null===(o=s.geometry)||void 0===o?void 0:o.values;if(d){let e=es.find(e=>e.id===d);e&&r([e])}else if(m){let e=es.filter(e=>m.includes(e.id));r(e)}switch(t){case"about":ew(u);break;case"geometry":eZ(u);break;case"parameters":eC(u);break;case"materials":ek(u);break;case"initialization":eS(u);break;case"boundaryConditions":eP(u);break;case"run":eE(u);break;default:R(void 0)}},[es,Q,ew,eZ,eC,ek,eS,eP,eE]),eN=(0,x.useCallback)(()=>{(async()=>{await e.push({pathname:"/dashboard",query:{page:t,workspaceId:l}})})()},[e,t,l]),eT=(0,x.useCallback)(e=>{let t,{keyPath:l}=e,a=l.pop(),i=l.pop(),n=l.pop();n&&(t=n.split("&").pop()),C({key:a,id:i,item:t})},[]),eA=(0,x.useCallback)(async e=>{try{await ig(H,e,{addOneSimulation:ee,mutateProject:G}),u(!1)}catch(e){}},[H,ee,G]),eL=(0,x.useCallback)(e=>{if(em)return!0;let t=e.value,l=e.values,a=e.multiple,i=e.n;return(!t||!!es.filter(e=>e.id===t).length)&&(!a||!l||(i?es.filter(e=>l.includes(e.id)).length===e.n:!!es.filter(e=>l.includes(e.id)).length))&&(!!t||!!l)||(e.done=!1,!1)},[es,em]);(0,x.useEffect)(()=>{(async()=>{W||F||await e.replace("/login")})()},[F,W,e]),(0,x.useEffect)(()=>{B&&(0,V.lt)(ix.user,B),K&&(0,V.lt)(ix.project,K),ea&&(0,V.lt)(ix.simulations,ea),ec&&(0,V.lt)(ix.geometries,ec)},[B,K,ea,ec]),(0,L.Z)(()=>{$||em?n(!1):es.length?n(!1):n(!0)},[$,em,es]),(0,L.Z)(()=>{if(!em){if(s.length){let e=!1,t=s.map(t=>{let l=es.find(e=>e.id===(null==t?void 0:t.id));return l?JSON.stringify({...l,visible:void 0})!==JSON.stringify({...t,visible:void 0})?(e=!0,l):t:(e=!0,null)}).filter(e=>e);e&&r(t)}else r(es[0]?[es[0]]:[])}},[em,es,s],[r]),(0,L.Z)(()=>{if(!ei&&d){let e=Q.find(e=>e.id===(null==d?void 0:d.id));e?JSON.stringify(e)!==JSON.stringify(d)&&(c(e),Z&&Z.key===iv.simulations.key&&eM(Z.id,Z.item)):(ef(),c(void 0))}},[Q,ei,d,Z],[c,ef]),(0,L.Z)(()=>{Z&&(Z.key===iv.geometries.key?ej(Z.id):(eM(Z.id,Z.item),"run"!==Z.item&&(p([]),g(void 0))))},[Z,I,m],[ej,eM,ef]),(0,x.useEffect)(()=>{!m.length&&y&&g(void 0)},[m,y]);let ez=(0,x.useMemo)(()=>es.map(e=>{let t=s.find(t=>t.id===e.id);return{key:e.id,icon:(0,h.jsx)(S.Z,{}),label:(0,h.jsx)(ib,{visible:!!t,geometry:e,panel:k,add:ex,del:eg,close:ef})}}),[es,s,k,ex,eg,ef]),eR=(0,x.useMemo)(()=>Q.map(e=>{let t=e.scheme.configuration||{},l=[];return Object.keys(t).forEach(a=>{if("dimension"===a)return;let i=t[a],n=(0,h.jsx)(P.Z,{style:{color:"green"}});i.error?n=(0,h.jsx)(E.Z,{style:{color:"red"}}):i.done||(n=(0,h.jsx)(M.Z,{style:{color:"orange"}})),"geometry"!==a||eL(i)||(n=(0,h.jsx)(M.Z,{style:{color:"orange"}})),l[i.index]={key:e.id+"&"+a,disabled:!s.length,icon:n,label:i.title}}),{key:e.id,icon:(0,h.jsx)(N.Z,{}),label:(0,h.jsx)(ij,{simulation:e}),children:[{key:e.id+"&about",disabled:!s.length,icon:(0,h.jsx)(P.Z,{style:{color:"green"}}),label:"About"},...l]}}),[s,Q,eL]);return!F||W||$?(0,h.jsx)(z.Z.Simple,{}):"0"===H.id?(0,h.jsx)(D,{}):(0,h.jsx)(Y,{children:(0,h.jsxs)(f.Z,{hasSider:!0,children:[(0,h.jsxs)(f.Z.Sider,{theme:"light",className:ip().sider,width:256,children:[(0,h.jsx)("div",{className:ep().logo,children:(0,h.jsx)("img",{src:"/images/logo.svg",alt:"Tanatloc"})}),(0,h.jsx)(b.Z,{className:ip().menu1,mode:"inline",items:[{key:"menu-go-back",disabled:!0,style:{cursor:"unset",margin:"10px 0",paddingLeft:10},label:(0,h.jsx)(U.ks,{className:ep().fullWidth,onClick:eN,children:"Return to dashboard"})},{type:"divider"},{key:"title",disabled:!0,className:"Menu-title",label:(0,h.jsx)(j.Z.Paragraph,{ellipsis:{tooltip:!0,rows:2},children:H.title})}]}),(0,h.jsx)("div",{className:ip().menuScroll,children:(0,h.jsx)(b.Z,{mode:"inline",className:ip().menu2,defaultOpenKeys:[iv.geometries.key,iv.simulations.key],items:[{key:iv.geometries.key,className:"SubMenu",icon:em?(0,h.jsx)(O.Z,{}):(0,h.jsx)(S.Z,{}),label:(0,h.jsxs)(j.Z.Text,{strong:!0,children:[iv.geometries.label," (",es.length,")"]}),children:[{key:"new_geometry",disabled:!0,label:(0,h.jsx)(w.ZP,{icon:(0,h.jsx)(T.Z,{}),onClick:eh,children:"New Geometry"})},{key:"geometry-needed",disabled:!0,className:s.length?"display-none":"",icon:(0,h.jsx)(M.Z,{style:{color:"red"}}),label:"A Geometry is needed"},...ez]},{key:iv.simulations.key,className:"SubMenu",icon:ei?(0,h.jsx)(O.Z,{}):(0,h.jsx)(N.Z,{}),label:(0,h.jsxs)(j.Z.Text,{strong:!0,children:[iv.simulations.label," (",Q.length,")"]}),children:[{key:"new_simulation",disabled:!0,label:(0,h.jsx)(w.ZP,{disabled:!es.length,icon:(0,h.jsx)(A.Z,{}),onClick:ey,children:"New Simulation"})},...eR]}],onClick:eT})})]}),(0,h.jsxs)(f.Z.Content,{className:ep().noScroll,style:{position:"relative"},children:[(0,h.jsx)(eO.Add,{visible:i,project:{id:H.id,geometries:H.geometries},swr:{mutateProject:G,addOneGeometry:er},setVisible:n}),(0,h.jsx)(im.Selector,{user:{authorizedplugins:F.authorizedplugins,models:F.models},visible:o,onOk:eA,onCancel:ev}),(0,h.jsx)(im.Updater,{user:{authorizedplugins:F.authorizedplugins},simulation:d&&{id:d.id,scheme:d.scheme},swr:{mutateOneSimulation:el}}),k,(0,h.jsx)(tB,{project:{id:H.id,title:H.title},simulation:d&&{id:d.id},geometries:s.map(e=>({id:e.id,needCleanup:e.needCleanup})),results:m.map(e=>({glb:e.glb,originPath:e.originPath})),postprocessing:y&&{glb:y.glb,originPath:y.originPath}}),(0,h.jsx)(iy,{simulation:d&&{id:d.id,name:d.name}}),(0,h.jsx)(im.Postprocessing,{simulation:d&&{id:d.id,scheme:d.scheme},results:m.map(e=>({name:e.name,fileName:e.fileName,originPath:e.originPath})),postprocessing:y&&{name:y.name,fileName:y.fileName},setResult:g})]})]})})};var iZ=iw},87819:function(e){e.exports={upload:"add_upload__gI0Tw"}},39095:function(e){e.exports={variables:'"@/styles/variables.css"',colorPrimary:"#fad114",sider:"project_sider__iUhsS",menu1:"project_menu1__XdM_R",menuScroll:"project_menuScroll__78_Ce",menu2:"project_menu2__Txzic"}},68847:function(e){e.exports={panel:"panel_panel___hALB",subPanel:"panel_subPanel__0TV8M"}},98281:function(e){e.exports={selectorContent:"simulation_selectorContent__HWIz8",selectorSider:"simulation_selectorSider__aC0Gk",selector:"simulation_selector__Xf4pE",geometriesList:"simulation_geometriesList__1Ces7",waring:"simulation_waring__Dn3br",error:"simulation_error__4EgiV",listItem:"simulation_listItem__YxV62"}},60968:function(e){e.exports={variables:'"@/styles/variables.css"',colorPrimary:"#fad114",view:"three_view__MDbup",head:"three_head__fY_4c",content:"three_content__FaWcm",loading:"three_loading__B2ZAP",canvas:"three_canvas__LLX1q"}},64546:function(e,t,l){var a={"./local/src/components":[21091,1091]};function i(e){if(!l.o(a,e))return Promise.resolve().then(function(){var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t});var t=a[e],i=t[0];return l.e(t[1]).then(function(){return l(i)})}i.keys=function(){return Object.keys(a)},i.id=64546,e.exports=i}}]);