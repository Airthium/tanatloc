"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6487],{66157:(e,a,t)=>{t.d(a,{A:()=>n});var i=t(8065),s=t(96540),r=t(50641);let n={useOrganizations:()=>{var e;let{data:a,error:t,mutate:n}=(0,i.Ay)("/api/organizations",r.G),o=!a,l=null!==(e=null==a?void 0:a.organizations)&&void 0!==e?e:[],d=(0,s.useCallback)(async e=>{let a=[...l,{...e,pendingowners:[],users:[],pendingusers:[],groups:[]}];await n({organizations:a})},[l,n]),u=(0,s.useCallback)(async e=>{let a=l.filter(a=>a.id!==e.id);await n({organizations:a})},[l,n]),c=(0,s.useCallback)(async e=>{let a=l.map(a=>(a.id===e.id&&(a={...a,...e}),a));await n({organizations:a})},[l,n]);return[l,{addOneOrganization:d,delOneOrganization:u,mutateOneOrganization:c,errorOrganizations:t,loadingOrganizations:o}]},add:async e=>(await (0,r.T)("/api/organization",{method:"POST",headers:{Accept:"application/json"},body:JSON.stringify(e)})).json(),update:async(e,a)=>{await (0,r.T)("/api/organization",{method:"PUT",body:JSON.stringify({organization:e,data:a})})},del:async e=>{await (0,r.T)("/api/organization",{method:"DELETE",body:JSON.stringify(e)})},accept:async e=>{await (0,r.T)("/api/organization/"+e.id,{method:"PUT"})},decline:async e=>{await (0,r.T)("/api/organization/"+e.id,{method:"POST"})},quit:async e=>{await (0,r.T)("/api/organization/"+e.id,{method:"DELETE"})}}},81864:(e,a,t)=>{t.d(a,{A:()=>s});var i=t(50641);let s={add:async e=>(await (0,i.T)("/api/userModel",{method:"POST",body:JSON.stringify({userModel:e})})).json(),update:async(e,a)=>{await (0,i.T)("/api/userModel",{method:"PUT",body:JSON.stringify({userModel:e,data:a})})},del:async e=>{await (0,i.T)("/api/userModel",{method:"DELETE",body:JSON.stringify({userModel:e})})}}},70423:(e,a,t)=>{t.d(a,{A:()=>n});var i=t(8065),s=t(96540),r=t(50641);let n={useWorkspaces:()=>{var e;let{data:a,error:t,mutate:n}=(0,i.Ay)("/api/workspace",r.G),o=!a,l=null!==(e=null==a?void 0:a.workspaces)&&void 0!==e?e:[],d=(0,s.useCallback)(async e=>{let a=[...l,e];await n({workspaces:a})},[l,n]),u=(0,s.useCallback)(async e=>{let a=l.filter(a=>a.id!==e.id);await n({workspaces:a})},[l,n]),c=(0,s.useCallback)(async e=>{let a=l.map(a=>(a.id===e.id&&(a={...a,...e}),a));await n({workspaces:a})},[l,n]);return[l,{addOneWorkspace:d,delOneWorkspace:u,mutateOneWorkspace:c,errorWorkspaces:t,loadingWorkspaces:o}]},add:async e=>(await (0,r.T)("/api/workspace",{method:"POST",headers:{Accept:"application/json"},body:JSON.stringify(e)})).json(),update:async(e,a)=>{await (0,r.T)("/api/workspace",{method:"PUT",body:JSON.stringify({workspace:e,data:a})})},del:async e=>{await (0,r.T)("/api/workspace",{method:"DELETE",body:JSON.stringify(e)})}}},2075:(e,a,t)=>{t.d(a,{Ay:()=>C});var i=t(74848),s=t(96540),r=t(86715),n=t(61580),o=t(86026),l=t(75654),d=t(6385),u=t(43508),c=t(35605),p=t(4866),h=t.n(p),y=t(78252),g=t(40889),m=t(70551),k=t(67070),w=t(5776),v=t(72620),b=t(58779),f=t(70423),A=t(81864),O=t(66188),S=t.n(O);let j={share:"Unable to share"},x=async(e,a,t,i,s,r)=>{if(e){await f.A.update({id:e.id},[{key:"groups",value:i},{key:"users",value:s}]);let a=v.A.deepCopy(e);a.groups=i.map(e=>({id:e})),a.users=s.map(e=>({id:e})),await r.mutateOneWorkspace(a)}else if(a){await b.A.update({id:a.id},[{key:"groups",value:i},{key:"users",value:s}]);let e=v.A.deepCopy(a);e.groups=i.map(e=>({id:e})),e.users=s.map(e=>({id:e})),await r.mutateOneProject(e)}else{await A.A.update({id:t.id},[{key:"groups",value:i},{key:"users",value:s}]);let e=v.A.deepCopy(t);e.groups=i.map(e=>({id:e})),e.users=s.map(e=>({id:e})),await r.mutateUser(e)}},T=e=>{let a=e.email;if(e.lastname||e.firstname){var t;a=(e.lastname?e.lastname+" ":"")+(null!==(t=e.firstname)&&void 0!==t?t:"")}return a},C=e=>{let{disabled:a,workspace:t,project:p,userModel:v,organizations:b,swr:f,style:A}=e,[O,C]=(0,s.useState)(!1),[z,E]=(0,s.useState)(!1),[N,W]=(0,s.useState)([]),[D,L]=(0,s.useState)([]),[P,J]=(0,s.useState)([]),[M,U]=(0,s.useState)([]),{dispatch:_}=(0,s.useContext)(y.V2),F=(0,r.useRouter)();(0,s.useEffect)(()=>{var e;let a=null!==(e=null!=t?t:p)&&void 0!==e?e:v,i=null==a?void 0:a.groups.map(e=>e.id),s=null==a?void 0:a.users.map(e=>e.id);J(null!=i?i:[]),U(null!=s?s:[])},[t,p,v]),(0,s.useEffect)(()=>{let e=b.map(e=>{let a=e.groups.map(e=>({key:e.id,title:e.name,value:e.id,type:"group"}));return{key:e.id,title:e.name,value:e.id,disabled:!0,checkable:!1,children:a}}),a=[];b.forEach(e=>{e.owners.forEach(e=>{a.push({key:e.id,title:T(e),value:e.id,type:"user"})}),e.users.forEach(e=>{a.push({key:e.id,title:T(e),value:e.id,type:"user"})}),e.groups.forEach(e=>{e.users.forEach(e=>{a.push({key:e.id,title:T(e),value:e.id,type:"user"})})})});let t=a.filter((e,a,t)=>t.findIndex(a=>a.key===e.key)===a);W(e),L(t)},[b]);let B=(0,s.useCallback)(()=>{(0,m.g)(async()=>{await F.push({pathname:"/dashboard",query:{page:"organizations"}})})},[F]),H=(0,s.useMemo)(()=>{let e="Share this ";return t?e+="workspace":p?e+="project":e+="user model",e+=" with organizations groups"},[t,p]),I=(0,s.useMemo)(()=>{let e="Share this ";return t?e+="workspace":p?e+="project":e+="user model",e+=" with organizations users"},[t,p]),q=(0,s.useMemo)(()=>N.length?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.A.Item,{label:(0,i.jsx)(i.Fragment,{children:H}),children:(0,i.jsx)(o.A,{multiple:!0,treeCheckable:!0,treeDefaultExpandAll:!0,showCheckedStrategy:o.A.SHOW_ALL,placeholder:"Select groups",dropdownStyle:{maxHeight:400,overflow:"auto"},className:S().fullWidth,treeData:N,value:P,onChange:J})}),(0,i.jsx)(n.A.Item,{label:(0,i.jsx)(i.Fragment,{children:I}),children:(0,i.jsx)(o.A,{multiple:!0,treeCheckable:!0,treeDefaultExpandAll:!0,showCheckedStrategy:o.A.SHOW_ALL,placeholder:"Select users",dropdownStyle:{maxHeight:400,overflow:"auto"},className:S().fullWidth,treeData:D,value:M,onChange:U})})]}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("br",{}),(0,i.jsx)(l.A.Text,{strong:!0,children:"There is no organization for now"}),(0,i.jsx)("br",{}),(0,i.jsxs)(l.A.Text,{children:["You can create organizations and groups in the"," ",(0,i.jsx)(k.z9,{onClick:B,children:"Organization menu"}),"."]})]}),[H,I,N,D,P,M,B]),G=(0,s.useCallback)(()=>C(!0),[]),R=(0,s.useCallback)(()=>C(!1),[]),V=(0,s.useCallback)(async()=>{E(!0);try{await x(t,p,v,P,M,f),E(!1),C(!1)}catch(e){throw _((0,g.CN)({title:j.share,err:e})),E(!1),e}},[t,p,v,P,M,f,_]),Y=(0,s.useMemo)(()=>{let e="Share ";return t?e+="workspace":p?e+="project":e+="user model",e},[t,p]),K=(0,s.useMemo)(()=>{let e="";return t?e+="Workspace":p?e+="Project":e+="User model",e+=": ",t?e+=t.name:p?e+=p.title:e+=null==v?void 0:v.model.name,e},[t,p,v]);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(d.A,{title:"Share",children:(0,i.jsx)(u.Ay,{className:"".concat(S().noBackground," ").concat((null==A?void 0:A.buttonLight)?S().textLight:""," ").concat((null==A?void 0:A.buttonDark)?S().textDark:""," ").concat((null==A?void 0:A.buttonBordered)?"":S().noBorder," ").concat(h()()?S().displayNone:""),id:"share",disabled:a,type:!a||(null==A?void 0:A.buttonBordered)?void 0:"link",icon:(0,i.jsx)(c.A,{}),onClick:G},"share")}),(0,i.jsxs)(w.Ay,{title:Y,visible:O,onCancel:R,onOk:V,loading:z,children:[(0,i.jsx)(l.A.Title,{level:5,children:K}),q]})]})}}}]);