(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[807],{27588:function(e,l,t){"use strict";t.d(l,{E:function(){return i},j:function(){return a}});let a=[{label:"Density",symbol:"Rho",units:[{label:"\\(kg.m^{-3}\\)"}],unit:{label:"\\(kg.m^{-3}\\)"}},{label:"Young's modulus",symbol:"E",units:[{label:"\\(Pa\\)"}],unit:{label:"\\(Pa\\)"}},{label:"Poisson's ratio",symbol:"Nu"},{label:"Thermal conductivity",symbol:"Lambda",units:[{label:"\\(W.m^{-1}.K^{-1}\\)"}],unit:{label:"\\(W.m^{-1}.K^{-1}\\)"}},{label:"Heat capacity",symbol:"Cp",units:[{label:"\\(J.K^{-1}.kg^{-1}\\)"}],unit:{label:"\\(J.K^{-1}.kg^{-1}\\)"}},{label:"Dynamic viscosity",symbol:"Mu",units:[{label:"\\(Pa.s\\)"}],unit:{label:"\\(Pa.s\\)"}}],i={metal:{label:"Metal",children:[{key:"steel",label:"Generic Steel",children:[{label:"Density",symbol:"Rho",value:"7850"},{label:"Young's modulus",symbol:"E",value:"2.1e11"},{label:"Poisson's ratio",symbol:"Nu",value:"0.3"},{label:"Thermal conductivity",symbol:"Lambda",value:"15"},{label:"Heat capacity",symbol:"Cp",value:"502"}]},{key:"S235JR+AR",label:"Steel (S235JR+AR)",children:[{label:"Density",symbol:"Rho",value:"7850"},{label:"Young's modulus",symbol:"E",value:"2.1e11"},{label:"Poisson's ratio",symbol:"Nu",value:"0.27"},{label:"Thermal conductivity",symbol:"Lambda",value:"15"},{label:"Heat capacity",symbol:"Cp",value:"502"}]},{key:"304",label:"Stainless Steel 304",children:[{label:"Density",symbol:"Rho",value:"8000"},{label:"Young's modulus",symbol:"E",value:"193e9"},{label:"Poisson's ratio",symbol:"Nu",value:"0.29"},{label:"Thermal conductivity",symbol:"Lambda",value:"16.2"},{label:"Heat capacity",symbol:"Cp",value:"500"},{label:"Yield strength",symbol:"SigmaY",value:"215e6"}]},{key:"316L",label:"Stainless Steel 316L",children:[{label:"Density",symbol:"Rho",value:"7990"},{label:"Young's modulus",symbol:"E",value:"193e9"},{label:"Poisson's ratio",symbol:"Nu",value:"0.25"},{label:"Thermal conductivity",symbol:"Lambda",value:"16.2"},{label:"Heat capacity",symbol:"Cp",value:"500"},{label:"Yield strength",symbol:"SigmaY",value:"290e6"}]},{key:"6082-O",label:"Aluminium 6082-O",children:[{label:"Density",symbol:"Rho",value:"2700"},{label:"Young's modulus",symbol:"E",value:"69e9"},{label:"Poisson's ratio",symbol:"Nu",value:"0.33"},{label:"Thermal conductivity",symbol:"Lambda",value:"170"},{label:"Heat capacity",symbol:"Cp",value:"960"},{label:"Yield strength",symbol:"SigmaY",value:"60e6"}]},{key:"7075-O",label:"Aluminium 7075-O",children:[{label:"Density",symbol:"Rho",value:"2810"},{label:"Young's modulus",symbol:"E",value:"71.7e9"},{label:"Poisson's ratio",symbol:"Nu",value:"0.33"},{label:"Thermal conductivity",symbol:"Lambda",value:"173"},{label:"Heat capacity",symbol:"Cp",value:"960"},{label:"Yield strength",symbol:"SigmaY",value:"110e6"}]},{key:"2017A",label:"Aluminium 2017A",children:[{label:"Density",symbol:"Rho",value:"2790"},{label:"Young's modulus",symbol:"E",value:"72.5e9"},{label:"Poisson's ratio",symbol:"Nu",value:"0.33"},{label:"Thermal conductivity",symbol:"Lambda",value:"134"},{label:"Heat capacity",symbol:"Cp",value:"873"},{label:"Yield strength",symbol:"SigmaY",value:"275e6"}]}]},polymer:{label:"Polymer",children:[{key:"PMMA",label:"PMMA",children:[{label:"Density",symbol:"Rho",value:"1180"},{label:"Young's modulus",symbol:"E",value:"2.9e9"},{label:"Poisson's ratio",symbol:"Nu",value:"0.36"},{label:"Thermal conductivity",symbol:"Lambda",value:"0.193"},{label:"Heat capacity",symbol:"Cp",value:"1480"},{label:"Yield strength",symbol:"SigmaY",value:"69e6"}]}]},fluid:{label:"Fluid",children:[{key:"water",label:"Water",children:[{label:"Density",symbol:"Rho",value:"1e3"},{label:"Dynamic viscosity",symbol:"Mu",value:"1e-3"},{label:"Thermal conductivity",symbol:"Lambda",value:"0.6"},{label:"Heat capacity",symbol:"Cp",value:"4185"}]}]},contact:{label:"Contact",children:[{key:"fundation",label:"Fundation",children:[]}]}}},10739:function(e,l,t){"use strict";t.d(l,{Z:function(){return o}});var a=t(83755);let i=async(e,l)=>{let t=await (0,a.R)("/api/result",{method:"POST",headers:{Accept:"application/json"},body:JSON.stringify({simulation:e,result:l})});return t.json()},n=async(e,l)=>(0,a.R)("/api/result/download",{method:"POST",body:JSON.stringify({simulation:e,result:l})}),s=async e=>(0,a.R)("/api/result/archive",{method:"POST",body:JSON.stringify({simulation:e})});var o={load:i,download:n,archive:s}},20807:function(e,l,t){"use strict";t.d(l,{ZP:function(){return tS}});var a,i,n,s,o,u,r,d,c,m=t(85893),h=t(67294),v=t(34041),y=t(83062),p=t(22850),x=t(85576),b=t(97183),g=t(44442),f=t(68508),j=t(60052),Z=t(68245),C=t(96486),k=t(55359),w=t(830),S=t(36642),N=t(62585),T=t(51302),E=t(12745),P=t(87782),O=t(72616),M=t(55276),L=t(85813),I=t(57953),A=t(42075),_=t(99138),H=t(71577),U=t(57132),R=t(14856),Y=t.n(R);let z={copy:"Unable to copy simulation"},F=async(e,l,t,a)=>{try{let a=await O.Z.copy(l);await t.addOneSimulation(a),await t.mutateProject({id:e.id,simulations:[...e.simulations,a.id]})}catch(e){a((0,w.iT)({title:z.copy,err:e}))}};var B=e=>{let{project:l,simulation:t,swr:a}=e,[i,n]=(0,h.useState)(!1),{dispatch:s}=(0,h.useContext)(k.uj),o=(0,h.useCallback)(()=>{(async()=>{n(!0);try{await F(l,t,a,s)}finally{n(!1)}})()},[l,t,a,s]);return(0,m.jsx)(y.Z,{title:"Copy simulation",children:(0,m.jsx)(H.ZP,{className:Y().noBorder,loading:i,icon:(0,m.jsx)(U.Z,{}),onClick:o})})},W=t(638),V=t(69677),D=t(86373);let G={update:"Unable to update simulation"},q=async(e,l,t,a)=>{try{await O.Z.update({id:e.id},[{key:"name",value:l.name}]),await t.mutateOneSimulation({id:e.id,name:l.name})}catch(e){throw a((0,w.iT)({title:G.update,err:e})),e}};var K=e=>{let{simulation:l,swr:t}=e,a=(0,h.useRef)(null),[i,n]=(0,h.useState)(!1),[s,o]=(0,h.useState)(!1),{dispatch:u}=(0,h.useContext)(k.uj);(0,h.useEffect)(()=>{a.current&&a.current.focus()});let r=(0,h.useCallback)(async e=>{o(!0);try{await q(l,e,t,u),o(!1),n(!1)}catch(e){throw o(!1),e}},[l,t,u]),d=(0,h.useCallback)(()=>n(!0),[]),c=(0,h.useCallback)(()=>n(!1),[]);return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(T.w6,{onEdit:d}),(0,m.jsx)(D.ZP,{title:"Edit the simulation's name",visible:i,initialValues:{name:l.name},onCancel:c,onOk:r,loading:s,children:(0,m.jsx)(W.Z.Item,{name:"name",label:"Name:",rules:[{required:!0,message:"Name is required"}],children:(0,m.jsx)(V.Z,{ref:a})})})]})};let J={del:"Unable to delete simulation"},$=async(e,l,t,a)=>{try{await O.Z.del(l);let a=e.simulations.filter(e=>e!==l.id);await t.mutateProject({id:e.id,simulations:a}),await t.delOneSimulation({id:l.id})}catch(e){throw a((0,w.iT)({title:J.del,err:e})),e}};var Q=e=>{let{project:l,simulation:t,swr:a}=e,[i,n]=(0,h.useState)(!1),{dispatch:s}=(0,h.useContext)(k.uj),o=(0,h.useCallback)(async()=>{n(!0);try{await $(l,t,a,s)}finally{n(!1)}},[l,t,a,s]);return(0,m.jsx)(T.m1,{loading:i,text:(0,m.jsxs)(m.Fragment,{children:["Are you sure you want to delete the simulation"," ",(0,m.jsx)(p.Z.Text,{strong:!0,children:t.name}),"?"]}),onDelete:o})},X=t(32808),ee=t(50888),el=t(8751),et=t(43437),ea=t.n(et),ei=e=>{let{label:l,className:t,defaultValue:a,defaultChecked:i,units:n,unit:s,onValueChange:o,onCheckedChange:u,onUnitChange:r}=e,[d,c]=(0,h.useState)(String(null!=a?a:0)),[y,p]=(0,h.useState)(!!i),[x,b]=(0,h.useState)(void 0!==i&&!i),[g,f]=(0,h.useState)(0),[j,Z]=(0,h.useState)(!1);(0,h.useEffect)(()=>{c(String(null!=a?a:0))},[a]),(0,h.useEffect)(()=>{p(!!i)},[i]);let C=(0,h.useCallback)(e=>{let l=e.target.checked;p(l),null==u||u(l),b(!l)},[u]),k=(0,h.useCallback)(e=>{g&&clearTimeout(g);let l=setTimeout(()=>{o(e),Z(!1)},500);f(+l)},[g,o]),w=(0,h.useCallback)(e=>{let l=e.target.value;c(l),Z(!0),k(l)},[k]),S=(0,h.useCallback)(e=>{let l=null==n?void 0:n.find(l=>l.label===e);null==r||r(l)},[n,r]),T=(0,h.useMemo)(()=>s?n&&n.length>1?(0,m.jsx)(v.Z,{className:ea().select,options:n.map(e=>({value:e.label,label:(0,m.jsx)(N.Z.Inline,{text:e.label})})),onChange:S,value:null==s?void 0:s.label}):(0,m.jsx)(N.Z.Inline,{text:s.label}):null,[s,n,S]);return(0,m.jsx)(A.Z,{className:"".concat(Y().fullWidth," ").concat(ea().formula," ").concat(t),style:ea(),align:"start",children:(0,m.jsx)(W.Z,{layout:"vertical",children:(0,m.jsx)(W.Z.Item,{label:(0,m.jsxs)(m.Fragment,{children:[void 0!==i&&(0,m.jsx)(X.Z,{checked:y,onChange:C,style:{marginRight:"5px"}}),l]}),children:(0,m.jsx)(V.Z,{className:ea().input,disabled:x,value:d,onChange:w,addonBefore:j?(0,m.jsx)(ee.Z,{spin:!0,className:Y().textOrange}):(0,m.jsx)(el.Z,{className:Y().textGreen}),addonAfter:T})})})})};let en={update:"Unable to update simulation"},es=async(e,l,t,a)=>{try{let a=P.Z.deepCopy(e);a.scheme.configuration.geometry.meshParameters={type:l,value:"auto"===l?"normal":"1"};let i={...a.scheme.configuration.geometry,done:!0};await O.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","geometry"],value:i}]),await O.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","run"],value:{...a.scheme.configuration.run,done:!1}}]),await t.mutateOneSimulation(a)}catch(e){throw a((0,w.iT)({title:en.update,err:e})),e}},eo=async(e,l,t,a)=>{try{var i;let a=P.Z.deepCopy(e);a.scheme.configuration.geometry.meshParameters={...a.scheme.configuration.geometry.meshParameters,type:null===(i=a.scheme.configuration.geometry.meshParameters)||void 0===i?void 0:i.type,value:l};let n={...a.scheme.configuration.geometry,done:!0};await O.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","geometry"],value:n}]),await O.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","run"],value:{...a.scheme.configuration.run,done:!1}}]),await t.mutateOneSimulation(a)}catch(e){throw a((0,w.iT)({title:en.update,err:e})),e}},eu=async(e,l,t,a)=>{try{var i,n;let a=P.Z.deepCopy(e);a.scheme.configuration.geometry.meshParameters={...a.scheme.configuration.geometry.meshParameters,type:null===(i=a.scheme.configuration.geometry.meshParameters)||void 0===i?void 0:i.type,value:null===(n=a.scheme.configuration.geometry.meshParameters)||void 0===n?void 0:n.value,unit:l};let s={...a.scheme.configuration.geometry,done:!0};await O.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","geometry"],value:s}]),await O.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","run"],value:{...a.scheme.configuration.run,done:!1}}]),await t.mutateOneSimulation(a)}catch(e){throw a((0,w.iT)({title:en.update,err:e})),e}};var er=e=>{let{simulation:l,swr:t}=e,[a,i]=(0,h.useState)(),[n,s]=(0,h.useState)(),[o,u]=(0,h.useState)(),{dispatch:r}=(0,h.useContext)(k.uj);(0,h.useEffect)(()=>{let e=l.scheme.configuration.geometry.meshParameters;if(e){var t;i(e.type),s(e.value),u(null!==(t=e.unit)&&void 0!==t?t:{label:"m"})}else i("auto"),s("normal"),u({label:"m"})},[l]);let d=(0,h.useCallback)(e=>{(async()=>{try{await es(l,e,t,r),i(e),"auto"===e?s("normal"):s("1")}catch(e){}})()},[l,t,r]),c=(0,h.useCallback)(e=>{(async()=>{try{await eo(l,e,t,r),s(e)}catch(e){}})()},[l,t,r]),y=(0,h.useCallback)(e=>{(async()=>{try{await eu(l,e,t,r),u(e)}catch(e){}})()},[l,t,r]);return(0,m.jsx)(L.Z,{size:"small",title:"Mesh refinement",children:(0,m.jsxs)(A.Z,{direction:"vertical",className:Y().fullWidth,children:[(0,m.jsx)(W.Z,{layout:"vertical",children:(0,m.jsx)(W.Z.Item,{label:"Type",children:(0,m.jsxs)(v.Z,{className:Y().fullWidth,value:a,onChange:d,children:[(0,m.jsx)(v.Z.Option,{value:"auto",children:"Automatic"}),(0,m.jsx)(v.Z.Option,{value:"manual",children:"Manual"})]})})}),"auto"===a&&(0,m.jsx)(W.Z,{layout:"vertical",children:(0,m.jsx)(W.Z.Item,{label:"Size",children:(0,m.jsxs)(v.Z,{className:Y().fullWidth,value:n,onChange:c,children:[(0,m.jsx)(v.Z.Option,{value:"veryfine",children:"Very fine"}),(0,m.jsx)(v.Z.Option,{value:"fine",children:"Fine"}),(0,m.jsx)(v.Z.Option,{value:"normal",children:"Normal"}),(0,m.jsx)(v.Z.Option,{value:"coarse",children:"Coarse"}),(0,m.jsx)(v.Z.Option,{value:"verycoarse",children:"Very coarse"})]})})}),"manual"===a&&(0,m.jsx)(ei,{label:"Size",defaultValue:n,units:[{label:"m"},{label:"mm",multiplicator:1e3}],unit:o,onValueChange:c,onUnitChange:y})]})})},ed=t(98281),ec=t.n(ed);let em={update:"Unable to update simulation"},eh=async(e,l,t,a,i,n)=>{try{var s;let n=P.Z.deepCopy(e),o=l.find(e=>e.id===t);n.scheme.configuration.geometry.value=t,n.scheme.configuration.geometry.values=void 0;let u={...n.scheme.configuration,dimension:null!==(s=o.summary.dimension)&&void 0!==s?s:3,geometry:{...n.scheme.configuration.geometry,done:!0},run:{...n.scheme.configuration.run,done:!1}};await O.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration"],value:u}]),await i.mutateOneSimulation(n),a([o])}catch(e){n((0,w.iT)({title:em.update,err:e}))}},ev=async(e,l,t,a,i,n)=>{try{var s;let n=P.Z.deepCopy(e),o=l.filter(e=>t.includes(e.id));n.scheme.configuration.geometry.value=void 0,n.scheme.configuration.geometry.values=t;let u={...n.scheme.configuration,dimension:null!==(s=o[0].summary.dimension)&&void 0!==s?s:3,geometry:{...n.scheme.configuration.geometry,done:!0},run:{...n.scheme.configuration.run,done:!1}};await O.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration"],value:u}]),await i.mutateOneSimulation(n),a(o)}catch(e){n((0,w.iT)({title:em.update,err:e}))}};var ey=t(94725),ep=t(48474),ex=t(40782);let eb={update:"Unable to delete material"},eg=async(e,l,t,a,i)=>{try{let i=P.Z.deepCopy(e),n=i.scheme.configuration.materials,s=n.values[l];s.selected.forEach(e=>{a((0,ex.hF)(e))}),n.values=[...n.values.slice(0,l),...n.values.slice(l+1)];let o={...n,done:!!n.values.length};await O.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","materials"],value:o}]),await t.mutateOneSimulation(i)}catch(e){throw i((0,w.iT)({title:eb.update,err:e})),e}};var ef=e=>{let{simulation:l,index:t,swr:a}=e,[i,n]=(0,h.useState)(!1),{dispatch:s}=(0,h.useContext)(k.uj),{dispatch:o}=(0,h.useContext)(ep.ZB),u=(0,h.useMemo)(()=>l.scheme.configuration.materials,[l]),r=(0,h.useMemo)(()=>u.values[t],[u,t]),d=(0,h.useCallback)(async()=>{n(!0);try{await eg(l,t,a,o,s)}finally{n(!1)}},[l,t,a,o,s]);return(0,m.jsx)(T.m1,{loading:i,text:(0,m.jsxs)(m.Fragment,{children:["Are you sure you want to delete the material"," ",(0,m.jsx)(p.Z.Text,{strong:!0,children:r.material.label})]}),onDelete:d})};let ej=e=>{let{geometries:l,simulation:t,material:a,index:i,swr:n,_onEdit:s}=e,[o,u]=(0,h.useState)(!0),{dispatch:r}=(0,h.useContext)(ep.ZB),d=(0,h.useCallback)(()=>{r((0,ex.wp)());let e=a.geometry,t=l.find(l=>l.id===e);r((0,ex.rx)(null==t?void 0:t.summary.uuid));let i=a.selected;null==i||i.forEach(e=>{r((0,ex.Ys)(e))})},[l,a,r]),c=(0,h.useCallback)(()=>{o&&r((0,ex.h$)())},[o,r]),v=(0,h.useCallback)(()=>{u(!1),s(i),setTimeout(()=>u(!0),500)},[i,s]);return(0,m.jsx)(L.Z,{className:"".concat(Y().textAlignCenter," ").concat(ec().listItem),hoverable:!0,onMouseEnter:d,onMouseLeave:c,actions:[(0,m.jsx)(T.w6,{onEdit:v},"edit"),(0,m.jsx)(ef,{index:i,simulation:t,swr:n},"delete")],children:(0,m.jsx)(p.Z.Text,{strong:!0,className:Y().textAlignCenter,children:a.material.label})})};var eZ=e=>{var l;let{geometries:t,simulation:a,swr:i,onEdit:n}=e,s=(0,h.useMemo)(()=>a.scheme.configuration.materials,[a]);return(0,m.jsx)(m.Fragment,{children:null===(l=s.values)||void 0===l?void 0:l.map((e,l)=>(0,m.jsx)(ej,{geometries:t,simulation:a,material:e,index:l,swr:i,_onEdit:n},e.uuid)).filter(e=>e)})},eC=t(85265),ek=t(97937),ew=t(11475),eS=t(51904),eN=t(13982),eT=t(14618),eE=t(94668),eP=t(68795);let eO=e=>{let{color:l,setFilter:t}=e,a=(0,h.useCallback)(()=>{t(l)},[l,t]);return(0,m.jsx)(y.Z,{title:"Color",children:(0,m.jsx)(H.ZP,{style:{backgroundColor:P.Z.rgbToHex(l)},onClick:a,children:" "})},JSON.stringify(l))},eM=e=>{let{colors:l,setFilter:t}=e,a=(0,h.useCallback)(()=>{t(void 0)},[t]);return(0,m.jsx)(m.Fragment,{children:l.length>1&&(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(y.Z,{title:"Reset",children:(0,m.jsx)(H.ZP,{icon:(0,m.jsx)(ek.Z,{}),onClick:a})}),l.map(e=>(0,m.jsx)(eO,{color:e,setFilter:t},JSON.stringify(e)))]})})},eL=e=>{let{element:l,alreadySelected:t,filter:a,search:i,context:n}=e,s=(0,h.useCallback)(e=>{var l,t,n;return(!a||a.r===(null===(l=e.color)||void 0===l?void 0:l.r)&&a.g===(null===(t=e.color)||void 0===t?void 0:t.g)&&a.b===(null===(n=e.color)||void 0===n?void 0:n.b))&&(!i||!e.name||!!e.name.includes(i))},[a,i]),o=(0,h.useCallback)(e=>{n.dispatch((0,ex.CH)(e))},[n]),u=(0,h.useCallback)(()=>{n.dispatch((0,ex.HW)())},[n]),r=(0,h.useCallback)(e=>{n.selected.find(l=>l.uuid===e.uuid)?n.dispatch((0,ex.hF)(e)):n.dispatch((0,ex.Ys)(e))},[n]),d=(0,h.useMemo)(()=>{var e;return n.selected.find(e=>e.uuid===l.uuid)?"#EE9817":(null===(e=n.highlighted)||void 0===e?void 0:e.uuid)===l.uuid?"#FAD114":"transparent"},[l,n]),c=(0,h.useMemo)(()=>{var e;return n.selected.find(e=>e.uuid===l.uuid)?"rgba(238, 152, 23, 0.3)":(null===(e=n.highlighted)||void 0===e?void 0:e.uuid)===l.uuid?"rgba(250, 209, 20, 0.3)":"transparent"},[l,n]),v=(0,h.useCallback)(()=>o({uuid:l.uuid,label:l.label}),[l,o]),y=(0,h.useCallback)(()=>r({uuid:l.uuid,label:l.label}),[l,r]);return s(l)?(0,m.jsx)(L.Z,{style:{marginBottom:"10px"},bodyStyle:{position:"relative",padding:"10px 10px 10px 40px",borderWidth:"2px",borderStyle:"solid",borderColor:d,backgroundColor:c},onMouseEnter:v,onMouseLeave:u,onClick:y,children:(0,m.jsxs)(A.Z,{direction:"vertical",children:[(0,m.jsxs)("div",{children:[(0,m.jsx)("div",{style:{position:"absolute",left:"-2px",top:"-2px",bottom:"-2px",width:"30px",backgroundColor:P.Z.rgbToRgba(l.color,1)}}),l.name]}),null==t?void 0:t.map(e=>{if(e.selected.find(e=>e.uuid===l.uuid))return(0,m.jsx)(eS.Z,{color:P.Z.stringToColor(e.label),children:e.label},l.uuid)})]})}):null};var eI=e=>{var l;let{geometry:t,alreadySelected:a,updateSelected:i}=e,[n,s]=(0,h.useState)([]),[o,u]=(0,h.useState)(),[r,d]=(0,h.useState)(),{type:c,highlighted:v,selected:x,dispatch:b}=(0,h.useContext)(ep.ZB);(0,S.Z)(()=>i(x),[x],[i]),(0,S.Z)(()=>{var e;let l=[];c&&(null===(e=t.summary[c])||void 0===e||e.forEach(e=>{if(e.color){let t=l.find(l=>l.r===e.color.r&&l.g===e.color.g&&l.b===e.color.b);t||l.push(e.color)}})),s(l)},[t,c]);let g=(0,h.useCallback)(()=>{var e;null===(e=t.summary[c])||void 0===e||e.forEach(e=>{var l,t,a;(!o||o&&o.r===(null===(l=e.color)||void 0===l?void 0:l.r)&&o.g===(null===(t=e.color)||void 0===t?void 0:t.g)&&o.b===(null===(a=e.color)||void 0===a?void 0:a.b))&&b((0,ex.Ys)({uuid:e.uuid,label:e.label}))})},[t,c,o,b]),f=(0,h.useCallback)(()=>{var e;null===(e=t.summary[c])||void 0===e||e.forEach(e=>{var l,t,a;(!o||o&&o.r===(null===(l=e.color)||void 0===l?void 0:l.r)&&o.g===(null===(t=e.color)||void 0===t?void 0:t.g)&&o.b===(null===(a=e.color)||void 0===a?void 0:a.b))&&b((0,ex.hF)({uuid:e.uuid,label:e.label}))})},[t,c,o,b]),j=(0,h.useCallback)(()=>{var e;null===(e=t.summary[c])||void 0===e||e.forEach(e=>{var l,t,a;(!o||o&&o.r===(null===(l=e.color)||void 0===l?void 0:l.r)&&o.g===(null===(t=e.color)||void 0===t?void 0:t.g)&&o.b===(null===(a=e.color)||void 0===a?void 0:a.b))&&x.find(l=>l.uuid===e.uuid)?b((0,ex.hF)({uuid:e.uuid,label:e.label})):b((0,ex.Ys)({uuid:e.uuid,label:e.label}))})},[t,x,c,o,b]),Z=(0,h.useCallback)(e=>{let l=e.target.value;d(l)},[]);return(0,m.jsxs)(L.Z,{size:"small",className:Y().noBorderBottom,children:[(0,m.jsxs)(A.Z,{direction:"vertical",className:Y().fullWidth,children:[(0,m.jsx)(p.Z.Text,{strong:!0,children:"Filters"}),(0,m.jsxs)(A.Z,{direction:"horizontal",wrap:!0,children:[(0,m.jsx)(eM,{colors:n,setFilter:u}),(0,m.jsx)(y.Z,{title:"Select all",children:(0,m.jsx)(H.ZP,{icon:(0,m.jsx)(eN.Z,{}),onClick:g})}),(0,m.jsx)(y.Z,{title:"Unselect all",children:(0,m.jsx)(H.ZP,{icon:(0,m.jsx)(eT.Z,{}),onClick:f})}),(0,m.jsx)(y.Z,{title:"Swap",children:(0,m.jsx)(H.ZP,{icon:(0,m.jsx)(eE.Z,{}),onClick:j})})]}),(0,m.jsx)(V.Z,{placeholder:"Search",value:r,onChange:Z,suffix:(0,m.jsx)(eP.Z,{className:Y().textLight})})]}),(0,m.jsx)("div",{className:Y().fullWidth,style:{marginTop:"20px"},children:c?null===(l=t.summary[c])||void 0===l?void 0:l.map(e=>(0,m.jsx)(eL,{element:e,alreadySelected:a,filter:o,search:r,context:{selected:x,highlighted:v,dispatch:b}},e.uuid)):null})]})},eA=t(2487),e_=t(13520),eH=t(27588),eU=e=>{let{onSelect:l}=e,[t,a]=(0,h.useState)(),[i,n]=(0,h.useState)(),[s,o]=(0,h.useState)(),[u,r]=(0,h.useState)(),d=(0,h.useMemo)(()=>Object.keys(eH.E),[]),c=(0,h.useCallback)(()=>a(!0),[]),v=(0,h.useCallback)(()=>a(!1),[]),y=(0,h.useCallback)(e=>{let{key:l}=e,t=eH.E[l];n({key:l,children:t.children}),o(void 0),r(void 0)},[]),p=(0,h.useCallback)(e=>{let{key:l}=e,t=eH.E[i.key],a=t.children.find(e=>e.key===l);o({key:l}),r(a)},[i]),g=(0,h.useCallback)(()=>{l(u),a(!1)},[u,l]);return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(H.ZP,{icon:(0,m.jsx)(e_.Z,{}),onClick:c,className:Y().fullWidth,children:"Pick a material"}),(0,m.jsx)(x.Z,{open:t,title:"Material database",onCancel:v,onOk:g,okText:"Choose",okButtonProps:{disabled:!u},width:"50%",children:(0,m.jsx)(b.Z,{children:(0,m.jsx)(b.Z.Content,{children:(0,m.jsxs)(A.Z,{style:{alignItems:"stretch"},children:[(0,m.jsx)(f.Z,{mode:"inline",items:d.map(e=>({key:e,label:eH.E[e].label})),onClick:y}),(0,m.jsx)(f.Z,{mode:"inline",items:null==i?void 0:i.children.map(e=>({key:e.key,label:e.label})),selectedKeys:(null==s?void 0:s.key)?[null==s?void 0:s.key]:[],onClick:p}),u&&(0,m.jsx)(eA.Z,{itemLayout:"vertical",children:u.children.map(e=>(0,m.jsxs)(eA.Z.Item,{children:[e.label,": ",e.symbol," = ",e.value]},e.label))})]})})})})]})},eR=t(57632);let eY={material:"You need to define a material",selected:"You need to select a solid",update:"Unable to add material"},ez=async(e,l,t,a)=>{try{var i;let a=P.Z.deepCopy(l);a.uuid=(0,eR.Z)();let n=P.Z.deepCopy(e),s=n.scheme.configuration.materials;s.values=[...null!==(i=s.values)&&void 0!==i?i:[],a];let o={...s,done:!0};await O.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","materials"],value:o}]),await O.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","run"],value:{...n.scheme.configuration.run,done:!1}}]),await t.mutateOneSimulation(n)}catch(e){throw a((0,w.iT)({title:eY.update,err:e})),e}};var eF=e=>{let{simulation:l,material:t,swr:a,onError:i,onClose:n}=e,[s,o]=(0,h.useState)(!1),{dispatch:u}=(0,h.useContext)(k.uj),r=(0,h.useCallback)(()=>{(async()=>{o(!0);try{var e;if(!t.material){i(eY.material),o(!1);return}if(!(null===(e=t.selected)||void 0===e?void 0:e.length)){i(eY.selected),o(!1);return}i(),await ez(l,t,a,u),o(!1),n()}catch(e){o(!1)}})()},[l,t,a,i,n,u]);return(0,m.jsx)(T.HS,{loading:s,needMargin:!0,onAdd:r,children:"Add"})};let eB={material:"You need to define a material",selected:"You need to select a solid",update:"Unable to edit material"},eW=async(e,l,t,a)=>{try{let a=P.Z.deepCopy(e),i=a.scheme.configuration.materials,n=i.values.findIndex(e=>e.uuid===l.uuid);i.values=[...i.values.slice(0,n),l,...i.values.slice(n+1)];let s={...i};await O.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","materials"],value:s}]),await t.mutateOneSimulation(a)}catch(e){throw a((0,w.iT)({title:eB.update,err:e})),e}};var eV=e=>{let{simulation:l,material:t,swr:a,onError:i,onClose:n}=e,[s,o]=(0,h.useState)(!1),{dispatch:u}=(0,h.useContext)(k.uj),r=(0,h.useCallback)(()=>{(async()=>{o(!0);try{var e;if(!t.material){i(eB.material),o(!1);return}if(!(null===(e=t.selected)||void 0===e?void 0:e.length)){i(eB.selected),o(!1);return}i(),await eW(l,t,a,u),o(!1),n()}catch(e){o(!1)}})()},[l,t,a,i,n,u]);return(0,m.jsx)(T.w6,{loading:s,primary:!0,needMargin:!0,onEdit:r,children:"Edit"})},eD=t(68847),eG=t.n(eD);let eq=e=>{let{child:l,index:t,value:a,unit:i,_onMaterialChange:n,_onUnitChange:s}=e,o=(0,h.useCallback)(e=>{n(l,t,e)},[l,t,n]),u=(0,h.useCallback)(e=>{s(t,e)},[t,s]);return(0,m.jsx)(ei,{label:l.name,defaultValue:null!=a?a:String(l.default),units:l.units,unit:null!=i?i:l.unit,onValueChange:o,onUnitChange:u},l.name)};var eK=e=>{var l,t,a,i,n,s,o;let{visible:u,geometries:r,simulation:d,material:c,swr:v,onClose:y}=e,[x,b]=(0,h.useState)(),[f,j]=(0,h.useState)(),[Z,C]=(0,h.useState)(),[k,w]=(0,h.useState)(),{dispatch:N}=(0,h.useContext)(ep.ZB),E=(0,h.useMemo)(()=>d.scheme.configuration.materials,[d]);(0,S.Z)(()=>{var e;N((0,ex.rx)(null===(e=r[0])||void 0===e?void 0:e.summary.uuid)),C(null==c?void 0:c.geometry)},[r,c],[N]),(0,S.Z)(()=>{!u&&f&&j(void 0)},[u,f]),(0,S.Z)(()=>{var e,l;u&&!f&&c?j(c):!u||f||c||j({material:{label:"Default",children:null!==(l=null==E?void 0:E.children.map(e=>({label:e.label,symbol:e.name,value:e.default})))&&void 0!==l?l:[]},geometry:null===(e=r[0])||void 0===e?void 0:e.id})},[u,r,E,f]),(0,S.Z)(()=>{var e;let l=null==E?void 0:null===(e=E.values)||void 0===e?void 0:e.map(e=>{if(e.uuid!==(null==c?void 0:c.uuid))return{label:e.material.label,selected:e.selected}}).filter(e=>e);b(null!=l?l:[])},[d,c,E]);let P=(0,h.useCallback)(e=>{j(l=>({...l,material:e}))},[]),O=(0,h.useCallback)((e,l,t)=>{j(a=>({...a,material:{label:"Custom",children:[...a.material.children.slice(0,l),{...a.material.children[l],label:e.label,symbol:e.name,value:t},...a.material.children.slice(l+1)]}}))},[]),M=(0,h.useCallback)((e,l)=>{j(t=>({...t,material:{...t.material,children:[...t.material.children.slice(0,e),{...t.material.children[e],unit:l},...t.material.children.slice(e+1)]}}))},[]),I=(0,h.useCallback)(e=>{j(l=>({...l,selected:e}))},[]),_=(0,h.useCallback)(e=>{C(e);let l=r.find(l=>l.id===e);N((0,ex.rx)(l.summary.uuid)),j(l=>({...l,geometry:e}))},[r,N]),U=(0,h.useCallback)(()=>{j(void 0),y()},[y]);return(0,m.jsx)(eC.Z,{className:eG().subPanel,title:"Material",placement:"left",closable:!1,open:u,mask:!1,maskClosable:!1,width:300,extra:(0,m.jsx)(H.ZP,{type:"text",icon:(0,m.jsx)(ek.Z,{}),onClick:U}),footer:(0,m.jsxs)("div",{style:{display:"flex",justifyContent:"flex-end"},children:[(0,m.jsx)(T.Lw,{onCancel:U}),c?(0,m.jsx)(eV,{material:{uuid:null!==(a=null==f?void 0:f.uuid)&&void 0!==a?a:c.uuid,material:null!==(i=null==f?void 0:f.material)&&void 0!==i?i:c.material,geometry:null!==(n=null==f?void 0:f.geometry)&&void 0!==n?n:c.geometry,selected:null!==(s=null==f?void 0:f.selected)&&void 0!==s?s:c.selected},simulation:{id:d.id,scheme:d.scheme},swr:{mutateOneSimulation:v.mutateOneSimulation},onError:w,onClose:U}):(0,m.jsx)(eF,{material:{material:null==f?void 0:f.material,geometry:null==f?void 0:f.geometry,selected:null==f?void 0:f.selected},simulation:{id:d.id,scheme:d.scheme},swr:{mutateOneSimulation:v.mutateOneSimulation},onError:w,onClose:U})]}),children:(0,m.jsxs)(A.Z,{direction:"vertical",className:Y().fullWidth,children:[(0,m.jsx)(L.Z,{size:"small",children:(0,m.jsxs)(A.Z,{direction:"vertical",className:Y().fullWidth,children:[(0,m.jsx)(eU,{onSelect:P}),(0,m.jsxs)(p.Z.Text,{children:["Material: ",null!==(o=null==f?void 0:null===(l=f.material)||void 0===l?void 0:l.label)&&void 0!==o?o:"default"]}),null==E?void 0:null===(t=E.children)||void 0===t?void 0:t.map((e,l)=>{var t,a,i;let n=null==f?void 0:null===(t=f.material)||void 0===t?void 0:null===(a=t.children)||void 0===a?void 0:a.find(l=>l.symbol===e.name);return(0,m.jsx)(eq,{child:e,index:l,value:null==n?void 0:n.value,unit:null!==(i=null==n?void 0:n.unit)&&void 0!==i?i:e.unit,_onMaterialChange:O,_onUnitChange:M},e.name)})]})}),(0,m.jsx)(g.Z,{items:r.map(e=>({key:e.id,label:e.name,children:(0,m.jsx)(eI,{geometry:e,alreadySelected:x,updateSelected:I})})),activeKey:Z,onChange:_}),k&&(0,m.jsxs)(p.Z.Text,{children:[(0,m.jsx)(ew.Z,{style:{color:"red"}})," ",k]})]})})},eJ=t(47221);let e$={update:"Unable to update simulation"},eQ=(e,l,t,n)=>(0,m.jsx)(ei,{label:null!==(a=l.label2D)&&void 0!==a?a:l.label,defaultValue:null!==(i=l.value)&&void 0!==i?i:l.default,onValueChange:t,onUnitChange:n,units:l.units,unit:l.unit},e),eX=(e,l,t)=>{var a;return(0,m.jsx)(W.Z,{layout:"vertical",children:(0,m.jsx)(W.Z.Item,{label:null!==(n=l.label2D)&&void 0!==n?n:l.label,children:(0,m.jsx)(v.Z,{options:null===(a=l.options)||void 0===a?void 0:a.map(e=>({label:e.label,value:null!==(s=e.value2D)&&void 0!==s?s:e.value})),defaultValue:null!==(u=null!==(o=l.value)&&void 0!==o?o:l.default2D)&&void 0!==u?u:l.default,onChange:t})})},e)},e0=(e,l,t)=>(0,m.jsx)(W.Z,{layout:"horizontal",children:(0,m.jsx)(W.Z.Item,{label:null!==(r=l.label2D)&&void 0!==r?r:l.label,children:(0,m.jsx)(X.Z,{defaultChecked:l.value,onChange:t})})},e),e1=(e,l,t,a)=>(0,m.jsx)(ei,{label:l.label,defaultValue:null!==(d=l.value)&&void 0!==d?d:l.default,units:l.units,unit:l.unit,onValueChange:t,onUnitChange:a},e),e2=(e,l,t)=>(0,m.jsx)(W.Z,{layout:"vertical",children:(0,m.jsx)(W.Z.Item,{label:l.label,children:(0,m.jsx)(v.Z,{options:l.options,defaultValue:null!==(c=l.value)&&void 0!==c?c:l.default,onChange:t})})},e),e5=(e,l,t)=>(0,m.jsx)(W.Z,{layout:"horizontal",children:(0,m.jsx)(W.Z.Item,{label:l.label,children:(0,m.jsx)(X.Z,{defaultChecked:l.value,onChange:t})})},e),e3=async(e,l,t)=>{try{let t=P.Z.deepCopy(e),a=t.scheme.configuration.parameters,i={...a,done:!0};await O.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","parameters"],value:i}]),await O.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","run"],value:{...t.scheme.configuration.run,done:!1}}]),await l.mutateOneSimulation(t)}catch(e){t((0,w.iT)({title:e$.update,err:e}))}},e7=async(e,l,t,a,i,n)=>{try{let n=P.Z.deepCopy(e),s=n.scheme.configuration.parameters,o=s[l];o.children[t].value=a;let u={...s};await O.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","parameters"],value:u}]),await O.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","run"],value:{...n.scheme.configuration.run,done:!1}}]),await i.mutateOneSimulation(n)}catch(e){n((0,w.iT)({title:e$.update,err:e}))}},e8=async(e,l,t,a,i,n)=>{try{let n=P.Z.deepCopy(e),s=n.scheme.configuration.parameters,o=s[l];o.children[t].unit=a;let u={...s};await O.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","parameters"],value:u}]),await O.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","run"],value:{...n.scheme.configuration.run,done:!1}}]),await i.mutateOneSimulation(n)}catch(e){n((0,w.iT)({title:e$.update,err:e}))}},e6=e=>{let{simulation:l,dimension:t,child:a,pkey:i,index:n,swr:s}=e,{dispatch:o}=(0,h.useContext)(k.uj),u=(0,h.useCallback)(e=>{(async()=>{await e7(l,i,n,e,s,o)})()},[l,i,n,s,o]),r=(0,h.useCallback)(e=>{(async()=>{await e8(l,i,n,e,s,o)})()},[l,i,n,s,o]),d=(0,h.useCallback)(e=>{(async()=>{await e7(l,i,n,e.target.checked,s,o)})()},[l,i,n,s,o]);if(2===t){if(a.only3D);else if("formula"===a.htmlEntity)return eQ(i+"&"+n,a,u,r);else if("select"===a.htmlEntity)return eX(i+"&"+n,a,u);else if("checkbox"===a.htmlEntity)return e0(i+"&"+n,a,d);return null}return"formula"===a.htmlEntity?e1(i+"&"+n,a,u,r):"select"===a.htmlEntity?e2(i+"&"+n,a,u):"checkbox"===a.htmlEntity?e5(i+"&"+n,a,d):null},e4=e=>{let{simulation:l,dimension:t,pkey:a,parameter:i,swr:n}=e,s=(0,h.useMemo)(()=>i.children.map((e,i)=>(0,m.jsx)(e6,{simulation:l,dimension:t,child:e,pkey:a,index:i,swr:n},a+"&"+e.label)),[l,t,a,i,n]);return(0,m.jsx)(L.Z,{size:"small",title:null==i?void 0:i.label,children:(0,m.jsx)(A.Z,{direction:"vertical",children:s})},a)},e9=(e,l)=>e.map(e=>{let t=e.fileName.replace(new RegExp(l.prefixPattern),"").replace(new RegExp(l.suffixPattern),"");return{...e,number:+t}}),le=(e,l)=>{let t=l.multiplicator;if(t){var a;let l=t.reduce((e,l)=>e[l],e);return null!==(a=l.value)&&void 0!==a?a:l.default}},ll={update:"Unable to update simulation"},lt=async(e,l,t,a)=>{try{let a=P.Z.deepCopy(e),i=a.scheme.configuration.initialization;i.value={type:l},await O.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","initialization"],value:i}]),await t.mutateOneSimulation(a)}catch(e){throw a((0,w.iT)({title:ll.update,err:e})),e}},la=async(e,l,t,a,i)=>{try{var n;let i=await ls(e,t),s=P.Z.deepCopy(l),o=s.scheme.configuration.initialization;o.value={...o.value,simulation:t,result:null==i?void 0:null===(n=i[0])||void 0===n?void 0:n.value},await O.Z.update({id:l.id},[{key:"scheme",type:"json",method:"set",path:["configuration","initialization"],value:o}]),await a.mutateOneSimulation(s)}catch(e){throw i((0,w.iT)({title:ll.update,err:e})),e}},li=async(e,l,t,a,i)=>{try{let i=P.Z.deepCopy(e),n=i.scheme.configuration.initialization;n.value={...n.value,number:+l,result:t.file},await O.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","initialization"],value:n}]),await a.mutateOneSimulation(i)}catch(e){i((0,w.iT)({title:ll.update,err:e}))}},ln=async(e,l,t,a,i)=>{try{let i=P.Z.deepCopy(e),n=i.scheme.configuration.initialization;n.value.values||(n.value.values=[]),n.value.values[l]=t,await O.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","initialization"],value:n}]),await a.mutateOneSimulation(i)}catch(e){i((0,w.iT)({title:ll.update,err:e}))}},ls=async(e,l)=>{var t;let a=await O.Z.tasks({id:l}),i=e.find(e=>e.id===l),n=i.scheme.configuration,s=null==n?void 0:null===(t=n.run)||void 0===t?void 0:t.resultsFilter,o=[];return a.forEach(e=>{if(e.file&&"result"===e.file.type&&o.push({label:e.file.fileName,value:e.file.fileName,file:e.file.fileName}),e.files){if(s){let l=new RegExp(s.pattern),t=e.files.filter(e=>!l.test(e.fileName)).filter(e=>"result"===e.type),a=e.files.filter(e=>l.test(e.fileName)),i=e9(a,s),u=i.map(e=>({number:e.number,fileName:e.fileName.replace(new RegExp(s.suffixPattern),"")})).filter((e,l,t)=>t.findIndex(l=>l.number===e.number)===l).sort((e,l)=>e.number-l.number),r=le(n,s),d=u.map((e,l)=>{let t=r?e.number*r:l;return{label:String(Math.round(1e15*t)/1e15),value:e.fileName,file:e.fileName}});o.push(...t.map(e=>({label:e.fileName,value:e.fileName,file:e.fileName})).filter(e=>e)),o.push(...d)}else e.files.forEach(e=>{"result"===e.type&&o.push({label:e.fileName,value:e.fileName,file:e.fileName})})}}),o},lo=e=>{let{simulation:l,child:t,index:a,value:i,swr:n,dispatch:s}=e,o=(0,h.useCallback)(e=>{(async()=>{await ln(l,a,e,n,s)})()},[l,a,n,s]);return(0,m.jsx)(ei,{label:t.label,defaultValue:(null!=i?i:t.default).toString(),units:t.units,unit:t.unit,onValueChange:o})},lu={update:"Unable to delete boundary condition"},lr=async(e,l,t,a,i,n)=>{try{let n=P.Z.deepCopy(e),s=n.scheme.configuration.boundaryConditions,o=s[l],u=o.values[t];u.selected.forEach(e=>{i((0,ex.hF)(e))}),o.values=[...o.values.slice(0,t),...o.values.slice(t+1)];let r=!1;Object.keys(s).forEach(e=>{var l;if("index"===e||"title"===e||"done"===e)return;let t=s[e];(null===(l=t.values)||void 0===l?void 0:l.length)&&(r=!0)});let d={...s,done:r};await O.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","boundaryConditions"],value:d}]),await a.mutateOneSimulation(n)}catch(e){throw n((0,w.iT)({title:lu.update,err:e})),e}};var ld=e=>{let{type:l,index:t,simulation:a,swr:i}=e,[n,s]=(0,h.useState)(!1),{dispatch:o}=(0,h.useContext)(ep.ZB),{dispatch:u}=(0,h.useContext)(k.uj),r=(0,h.useMemo)(()=>a.scheme.configuration.boundaryConditions,[a]),d=(0,h.useMemo)(()=>r[l],[r,l]),c=(0,h.useMemo)(()=>d.values[t],[d,t]),v=(0,h.useCallback)(async()=>{s(!0);try{await lr(a,l,t,i,o,u)}finally{s(!1)}},[a,l,t,i,o,u]);return(0,m.jsx)(T.m1,{loading:n,onDelete:v,text:(0,m.jsxs)(m.Fragment,{children:["Are you sure you want to delete the condition"," ",(0,m.jsx)(p.Z.Text,{strong:!0,children:null==c?void 0:c.name}),"?"]})})};let lc=e=>{let{geometries:l,simulation:t,boundaryCondition:a,index:i,type:n,swr:s,_onEdit:o}=e,[u,r]=(0,h.useState)(!0),{dispatch:d}=(0,h.useContext)(ep.ZB),c=(0,h.useCallback)(()=>{d((0,ex.wp)());let e=a.geometry,t=l.find(l=>l.id===e);d((0,ex.rx)(null==t?void 0:t.summary.uuid));let i=a.selected;null==i||i.forEach(e=>{d((0,ex.Ys)(e))})},[l,a,d]),v=(0,h.useCallback)(()=>{u&&d((0,ex.h$)())},[u,d]),y=(0,h.useCallback)(()=>{r(!1),o(n,i),setTimeout(()=>r(!0),500)},[i,n,o]);return(0,m.jsxs)(L.Z,{className:ec().listItem,hoverable:!0,onMouseEnter:c,onMouseLeave:v,actions:[(0,m.jsx)(T.w6,{onEdit:y},"edit"),(0,m.jsx)(ld,{simulation:{id:t.id,scheme:t.scheme},type:n,index:i,swr:{mutateOneSimulation:s.mutateOneSimulation}},"delete")],children:[(0,m.jsx)(p.Z.Text,{strong:!0,children:a.name})," ",(0,m.jsxs)(p.Z.Text,{children:["(",a.type.label,")"]})]})};var lm=e=>{let{geometries:l,simulation:t,swr:a,onEdit:i}=e,n=(0,h.useMemo)(()=>t.scheme.configuration.boundaryConditions,[t]);return(0,m.jsx)(m.Fragment,{children:Object.keys(n).map(e=>{var s;if("index"===e||"title"===e||"done"===e)return;let o=n[e];return null===(s=o.values)||void 0===s?void 0:s.map((n,s)=>(0,m.jsx)(lc,{geometries:l,simulation:t,boundaryCondition:n,index:s,type:e,swr:a,_onEdit:i},n.uuid))}).filter(e=>e)})},lh=t(78045);let lv={name:"You need to define a name",type:"You need to select a type",selected:"You need to select a face",update:"Unable to add boundary condition"},ly=async(e,l,t,a)=>{try{var i;let a={...l},n=a.type.key;a.uuid=(0,eR.Z)();let s=P.Z.deepCopy(e),o=s.scheme.configuration.boundaryConditions,u=o[n];u.values=[...null!==(i=u.values)&&void 0!==i?i:[],a];let r={...o,done:!0};await O.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","boundaryConditions"],value:r}]),await O.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","run"],value:{...s.scheme.configuration.run,done:!1}}]),await t.mutateOneSimulation(s)}catch(e){throw a((0,w.iT)({title:lv.update,err:e})),e}};var lp=e=>{let{simulation:l,boundaryCondition:t,swr:a,onError:i,onClose:n}=e,[s,o]=(0,h.useState)(!1),{dispatch:u}=(0,h.useContext)(k.uj),r=(0,h.useCallback)(()=>{(async()=>{o(!0);try{var e,s;if(!t.name){i(lv.name),o(!1);return}if(!(null===(e=t.type)||void 0===e?void 0:e.key)){i(lv.type),o(!1);return}if(!(null===(s=t.selected)||void 0===s?void 0:s.length)){i(lv.selected),o(!1);return}i(),await ly(l,t,a,u),o(!1),n()}catch(e){o(!1)}})()},[l,t,a,i,n,u]);return(0,m.jsx)(T.HS,{loading:s,onAdd:r,needMargin:!0,children:"Add"})};let lx={name:"You need to define a name",type:"You need to select a type",selected:"You need to select a face",update:"Unable to edit boundary condition"},lb=async(e,l,t,a,i)=>{try{let i=P.Z.deepCopy(e),s=i.scheme.configuration.boundaryConditions,o=l.type.key,u=t.type.key;if(u!==o){let e=s[u],l=e.values.findIndex(e=>e.uuid===t.uuid);e.values=[...e.values.slice(0,l),...e.values.slice(l+1)]}if(u!==o){var n;let e=s[o];e.values=[...null!==(n=e.values)&&void 0!==n?n:[],l]}else{let e=s[o],t=e.values.findIndex(e=>e.uuid===l.uuid);e.values=[...e.values.slice(0,t),l,...e.values.slice(t+1)]}let r={...s};await O.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","boundaryConditions"],value:r}]),await a.mutateOneSimulation(i)}catch(e){throw i((0,w.iT)({title:lx.update,err:e})),e}};var lg=e=>{let{simulation:l,boundaryCondition:t,oldBoundaryCondition:a,swr:i,onError:n,onClose:s}=e,[o,u]=(0,h.useState)(!1),{dispatch:r}=(0,h.useContext)(k.uj),d=(0,h.useCallback)(()=>{(async()=>{u(!0);try{var e,o;if(!t.name){n(lx.name),u(!1);return}if(!(null===(e=t.type)||void 0===e?void 0:e.key)){n(lx.type),u(!1);return}if(!(null===(o=t.selected)||void 0===o?void 0:o.length)){n(lx.selected),u(!1);return}n(),await lb(l,t,a,i,r),u(!1),s()}catch(e){u(!1)}})()},[l,t,a,i,n,s,r]);return(0,m.jsx)(T.w6,{loading:o,onEdit:d,primary:!0,needMargin:!0,children:"Edit"})};let lf=e=>{let{boundaryCondition:l,index:t,value:a,checked:i,unit:n,_onValueChange:s,_onCheckedChange:o,_onUnitChange:u}=e,r=(0,h.useCallback)(e=>s(t,e),[t,s]),d=(0,h.useCallback)(e=>o(t,e),[t,o]),c=(0,h.useCallback)(e=>u(t,e),[t,u]);return(0,m.jsx)(ei,{label:l.label,defaultValue:a,defaultChecked:i,onValueChange:r,onCheckedChange:d,onUnitChange:c,units:l.units,unit:n})};var lj=e=>{var l,t,a,i,n,s,o,u;let{visible:r,geometries:d,simulation:c,boundaryCondition:v,swr:y,onClose:x}=e,[b,f]=(0,h.useState)([]),[j,Z]=(0,h.useState)([]),[C,k]=(0,h.useState)(),[w,N]=(0,h.useState)(),[E,P]=(0,h.useState)(),[O,M]=(0,h.useState)(),{dispatch:I}=(0,h.useContext)(ep.ZB),_=(0,h.useMemo)(()=>c.scheme.configuration.boundaryConditions,[c]),U=(0,h.useMemo)(()=>c.scheme.configuration.dimension,[c]);(0,S.Z)(()=>{var e;I((0,ex.rx)(null===(e=d[0])||void 0===e?void 0:e.summary.uuid)),P(null==v?void 0:v.geometry)},[d,v],[I]),(0,S.Z)(()=>{!r&&w&&N(void 0)},[r,w]),(0,S.Z)(()=>{let e=Object.keys(_).map(e=>{if("index"===e||"title"===e||"done"===e)return;let l=_[e];return{key:e,label:l.label,children:l.children,values:l.values}}).filter(e=>e);Z(e)},[_]),(0,S.Z)(()=>{let e=null==j?void 0:j.map(e=>{var l;return null===(l=e.values)||void 0===l?void 0:l.length}).filter(e=>e).reduce((e,l)=>e+l,0);k(e)},[j]),(0,S.Z)(()=>{r&&!w&&v?N(v):!r||w||v||void 0===C||N(e=>{var l;return{...e,name:"Boundary condition "+(C+1),geometry:null===(l=d[0])||void 0===l?void 0:l.id}})},[r,v,w,C]),(0,S.Z)(()=>{let e=Object.keys(_).map(e=>{var l;if("index"===e||"title"===e||"done"===e)return;let t=_[e];return null==t?void 0:null===(l=t.values)||void 0===l?void 0:l.map(e=>{if(e.uuid!==(null==v?void 0:v.uuid))return{label:e.name,selected:e.selected}}).filter(e=>e)}).flat().filter(e=>e);f(e)},[_,v]);let R=(0,h.useCallback)(e=>{let l=e.target.value;N(e=>({...e,name:l}))},[]),z=(0,h.useCallback)(e=>{var l;let t=e.target.value,a=j.find(e=>e.key===t),i=_[t],n=null===(l=i.children)||void 0===l?void 0:l.map(e=>({checked:!0,value:e.default}));N(e=>({...e,type:{key:a.key,label:a.label,children:a.children},values:n}))},[_,j]),F=(0,h.useCallback)((e,l)=>{N(t=>({...t,values:[...t.values.slice(0,e),{...t.values[e],value:l},...t.values.slice(e+1)]}))},[]),B=(0,h.useCallback)((e,l)=>{N(t=>({...t,values:[...t.values.slice(0,e),{...t.values[e],checked:l},...t.values.slice(e+1)]}))},[]),D=(0,h.useCallback)((e,l)=>{N(t=>({...t,values:[...t.values.slice(0,e),{...t.values[e],unit:l},...t.values.slice(e+1)]}))},[]),G=(0,h.useCallback)(e=>{N(l=>({...l,selected:e}))},[]),q=(0,h.useMemo)(()=>{var e;return(null==w?void 0:w.type)&&(null===(e=w.type)||void 0===e?void 0:e.children)?(0,m.jsx)(L.Z,{children:w.type.children.map((e,l)=>{var t;if(2!==U||!e.only3D)return(0,m.jsx)(lf,{boundaryCondition:e,index:l,value:String(w.values[l].value),checked:w.type.children.length>1?w.values[l].checked:void 0,unit:null!==(t=w.values[l].unit)&&void 0!==t?t:e.unit,_onValueChange:F,_onCheckedChange:B,_onUnitChange:D},e.label)})}):null},[w,U,B,F,D]),K=(0,h.useCallback)(e=>{P(e);let l=d.find(l=>l.id===e);I((0,ex.rx)(null==l?void 0:l.summary.uuid)),N(l=>({...l,geometry:e}))},[d,I]),J=(0,h.useCallback)(()=>{N(void 0),x()},[x]);return(0,m.jsx)(eC.Z,{className:eG().subPanel,title:"Boundary condition",placement:"left",closable:!1,open:r,mask:!1,maskClosable:!1,width:300,extra:(0,m.jsx)(H.ZP,{type:"text",icon:(0,m.jsx)(ek.Z,{}),onClick:J}),footer:(0,m.jsxs)("div",{style:{display:"flex",justifyContent:"flex-end"},children:[(0,m.jsx)(T.Lw,{onCancel:J}),v?(0,m.jsx)(lg,{boundaryCondition:{uuid:null!==(t=null==w?void 0:w.uuid)&&void 0!==t?t:v.uuid,name:null!==(a=null==w?void 0:w.name)&&void 0!==a?a:v.name,type:null!==(i=null==w?void 0:w.type)&&void 0!==i?i:v.type,geometry:null!==(n=null==w?void 0:w.geometry)&&void 0!==n?n:v.geometry,selected:null!==(s=null==w?void 0:w.selected)&&void 0!==s?s:v.selected,values:null!==(o=null==w?void 0:w.values)&&void 0!==o?o:v.values},oldBoundaryCondition:{uuid:v.uuid,name:v.name,type:v.type,geometry:v.geometry,selected:v.selected,values:v.values},simulation:{id:c.id,scheme:c.scheme},swr:{mutateOneSimulation:y.mutateOneSimulation},onError:M,onClose:x}):(0,m.jsx)(lp,{boundaryCondition:{name:null==w?void 0:w.name,type:null==w?void 0:w.type,geometry:null==w?void 0:w.geometry,selected:null==w?void 0:w.selected,values:null==w?void 0:w.values},simulation:{id:c.id,scheme:c.scheme},swr:{mutateOneSimulation:y.mutateOneSimulation},onError:M,onClose:x})]}),children:(0,m.jsxs)(A.Z,{direction:"vertical",className:Y().fullWidth,children:[(0,m.jsx)(L.Z,{size:"small",children:(0,m.jsx)(W.Z,{layout:"vertical",children:(0,m.jsx)(W.Z.Item,{label:(0,m.jsx)(p.Z.Text,{strong:!0,children:"Boundary condition name"}),children:(0,m.jsx)(V.Z,{value:null!==(u=null==w?void 0:w.name)&&void 0!==u?u:"",onChange:R,maxLength:50})})})}),(0,m.jsx)(L.Z,{size:"small",children:(0,m.jsx)(W.Z,{layout:"vertical",children:(0,m.jsx)(W.Z.Item,{label:(0,m.jsx)(p.Z.Text,{strong:!0,children:"Boundary condition type"}),children:(0,m.jsx)(lh.ZP.Group,{optionType:"button",buttonStyle:"solid",value:null==w?void 0:null===(l=w.type)||void 0===l?void 0:l.key,onChange:z,children:null==j?void 0:j.map(e=>(0,m.jsx)(lh.ZP.Button,{value:e.key,children:e.label},e.key))})})})}),q,(0,m.jsx)(g.Z,{items:d.map(e=>({key:e.id,label:e.name,children:(0,m.jsx)(eI,{geometry:e,alreadySelected:b,updateSelected:G})})),activeKey:E,onChange:K}),O&&(0,m.jsxs)(p.Z.Text,{children:[(0,m.jsx)(ew.Z,{style:{color:"red"}})," ",O]})]})})},lZ=t(3363),lC=t(67841),lk=t(87784),lw=t(36027),lS=t(57184);let lN={name:"You need to define a name",point:"You need to select a point",formula:"You need to define a formula",update:"Unable to update simulation"},lT=async(e,l,t,a)=>{try{let a=P.Z.deepCopy(e),i=a.scheme.configuration.run,n=l.index;delete l.index,i.sensors[n]=l,await O.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","run"],value:i}]),await t.mutateOneSimulation(a)}catch(e){throw a((0,w.iT)({title:lN.update,err:e})),e}};var lE=e=>{let{simulation:l,sensor:t,onError:a,onClose:i,swr:n}=e,[s,o]=(0,h.useState)(),{dispatch:u}=(0,h.useContext)(k.uj),r=(0,h.useCallback)(()=>{(async()=>{o(!0);try{if(!t.name){a(lN.name),o(!1);return}if(!t.point){a(lN.point),o(!1);return}if(!t.formula){a(lN.formula),o(!1);return}a(),await lT(l,t,n,u),o(!1),i()}catch(e){o(!1)}})()},[l,t,a,i,n,u]);return(0,m.jsx)(T.w6,{loading:s,primary:!0,needMargin:!0,onEdit:r,children:"Edit"})};let lP={name:"You need to define a name",point:"You need to select a point",formula:"You need to define a formula",update:"Unable to update simulation"},lO=async(e,l,t,a)=>{try{var i;let a=P.Z.deepCopy(e),n=a.scheme.configuration.run,s={...n,sensors:[...null!==(i=n.sensors)&&void 0!==i?i:[],l]};await O.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","run"],value:s}]),await t.mutateOneSimulation(a)}catch(e){throw a((0,w.iT)({title:lP.update,err:e})),e}};var lM=e=>{let{simulation:l,sensor:t,onError:a,onClose:i,swr:n}=e,[s,o]=(0,h.useState)(),{dispatch:u}=(0,h.useContext)(k.uj),r=(0,h.useCallback)(()=>{(async()=>{o(!0);try{if(!t.name){a(lP.name),o(!1);return}if(!t.point){a(lP.point),o(!1);return}if(!t.formula){a(lP.formula),o(!1);return}a(),await lO(l,t,n,u),o(!1),i()}catch(e){o(!1)}})()},[l,t,a,i,n,u]);return(0,m.jsx)(T.HS,{loading:s,needMargin:!0,onAdd:r,children:"Add"})},lL=e=>{var l,t,a,i,n,s,o,u,r;let{visible:d,geometries:c,simulation:v,sensor:x,onClose:b,swr:f}=e,[j,Z]=(0,h.useState)(),[C,k]=(0,h.useState)(),[w,N]=(0,h.useState)(),[E,P]=(0,h.useState)(),{point:O,dispatch:M}=(0,h.useContext)(ep.ZB);(0,S.Z)(()=>{var e;M((0,ex.rx)(null===(e=c[0])||void 0===e?void 0:e.summary.uuid)),N(null==x?void 0:x.geometry)},[c,x],[M]),(0,S.Z)(()=>{M((0,ex.Cw)("point"))},[M]),(0,S.Z)(()=>{if(!x){let e=v.scheme.configuration.run;k(l=>({...l,name:"Sensor "+(e.sensors?e.sensors.length+1:1)}))}},[v,x]),(0,S.Z)(()=>{x&&(k(x),M((0,ex.N7)({x:x.point.x,y:x.point.y,z:x.point.z})))},[x],[M]),(0,S.Z)(()=>{O&&k(e=>({...e,point:O}))},[O]);let I=(0,h.useCallback)(()=>{Z(!1),M((0,ex.h$)()),window.removeEventListener("click",I)},[M]),_=(0,h.useCallback)(()=>{j?I():(Z(!0),M((0,ex.wp)()),setTimeout(()=>window.addEventListener("click",I),50))},[j,I,M]),U=(0,h.useCallback)(e=>{N(e);let l=c.find(l=>l.id===e);M((0,ex.rx)(l.summary.uuid)),k(l=>({...l,geometry:e}))},[c,M]),R=(0,h.useCallback)((e,l,t)=>{M((0,ex.N7)({x:e,y:l,z:t}))},[M]),z=(0,h.useCallback)(e=>{k(l=>({...l,formula:e}))},[]),F=(0,h.useCallback)(()=>{k(void 0),P(void 0),M((0,ex.N7)()),M((0,ex.h$)()),b()},[M,b]),B=(0,h.useCallback)(e=>{k(l=>({...l,name:e.target.value}))},[]),W=(0,h.useCallback)(e=>R(+e,null!==(i=null==O?void 0:O.y)&&void 0!==i?i:0,null!==(n=null==O?void 0:O.z)&&void 0!==n?n:0),[O,R]),D=(0,h.useCallback)(e=>R(null!==(s=null==O?void 0:O.x)&&void 0!==s?s:0,+e,null!==(o=null==O?void 0:O.z)&&void 0!==o?o:0),[O,R]),G=(0,h.useCallback)(e=>R(null!==(u=null==O?void 0:O.x)&&void 0!==u?u:0,null!==(r=null==O?void 0:O.y)&&void 0!==r?r:0,+e),[O,R]);return(0,m.jsx)(eC.Z,{title:"Sensor",placement:"left",closable:!1,open:d,mask:!1,maskClosable:!1,width:300,extra:(0,m.jsx)(H.ZP,{type:"text",icon:(0,m.jsx)(ek.Z,{}),onClick:F}),footer:(0,m.jsxs)("div",{style:{display:"flex",justifyContent:"flex-end"},children:[(0,m.jsx)(T.Lw,{onCancel:F}),x?(0,m.jsx)(lE,{simulation:v,sensor:{...x,...C},onError:P,onClose:F,swr:f}):(0,m.jsx)(lM,{simulation:v,sensor:C,onError:P,onClose:F,swr:f})]}),children:(0,m.jsxs)(A.Z,{direction:"vertical",className:Y().fullWidth,children:[(0,m.jsxs)(L.Z,{size:"small",children:[(0,m.jsx)(p.Z.Text,{children:"Name"}),(0,m.jsx)(V.Z,{value:null==C?void 0:C.name,onChange:B})]}),(0,m.jsxs)(L.Z,{size:"small",children:[(0,m.jsx)(g.Z,{items:c.map(e=>({key:e.id,label:e.name})),activeKey:w,onChange:U}),(0,m.jsxs)(A.Z,{direction:"vertical",className:Y().fullWidth,children:[(0,m.jsxs)(A.Z,{className:Y().fullWidth,style:{justifyContent:"space-between"},children:[(0,m.jsx)(p.Z.Text,{children:"Point selection"}),(0,m.jsx)(y.Z,{title:"Pin in the geometry",children:(0,m.jsx)(H.ZP,{size:"small",type:j?"primary":"default",icon:(0,m.jsx)(lS.Z,{}),onClick:_})})]}),(0,m.jsx)(ei,{label:"X",defaultValue:null==C?void 0:null===(l=C.point)||void 0===l?void 0:l.x,onValueChange:W}),(0,m.jsx)(ei,{label:"Y",defaultValue:null==C?void 0:null===(t=C.point)||void 0===t?void 0:t.y,onValueChange:D}),(0,m.jsx)(ei,{label:"Z",defaultValue:null==C?void 0:null===(a=C.point)||void 0===a?void 0:a.z,onValueChange:G})]})]}),(0,m.jsx)(L.Z,{size:"small",className:Y().noBorderBottom,children:(0,m.jsx)(ei,{label:"Formula",defaultValue:null==C?void 0:C.formula,onValueChange:z})}),E&&(0,m.jsxs)(p.Z.Text,{children:[(0,m.jsx)(ew.Z,{style:{color:"red"}})," ",E]})]})})};let lI={udpate:"Unable to update simulation"},lA=async(e,l,t,a,i)=>{try{let i=P.Z.deepCopy(e),n=i.scheme.configuration.run;a((0,ex.N7)()),n.sensors=[...n.sensors.slice(0,l),...n.sensors.slice(l+1)],await O.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","run"],value:n}]),await t.mutateOneSimulation(i)}catch(e){throw i((0,w.iT)({title:lI.udpate,err:e})),e}};var l_=e=>{let{simulation:l,index:t,swr:a}=e,[i,n]=(0,h.useState)(),{dispatch:s}=(0,h.useContext)(ep.ZB),{dispatch:o}=(0,h.useContext)(k.uj),u=(0,h.useMemo)(()=>l.scheme.configuration.run,[l]),r=(0,h.useMemo)(()=>u.sensors[t],[t,u]),d=(0,h.useCallback)(async()=>{n(!0);try{await lA(l,t,a,s,o)}finally{n(!1)}},[l,t,a,s,o]);return(0,m.jsx)(T.m1,{loading:i,text:(0,m.jsxs)(m.Fragment,{children:["Are you sure you want to delete the sensor"," ",(0,m.jsx)(p.Z.Text,{strong:!0,children:r.name})]}),onDelete:d})};let lH=e=>{let{simulation:l,sensor:t,index:a,_onEdit:i,swr:n}=e,{dispatch:s}=(0,h.useContext)(ep.ZB),o=(0,h.useCallback)(()=>{s((0,ex.wp)()),s((0,ex.N7)(t.point))},[t,s]),u=(0,h.useCallback)(()=>{s((0,ex.h$)())},[s]),r=(0,h.useCallback)(()=>i({...t,index:a}),[t,a,i]);return(0,m.jsx)(L.Z,{className:"".concat(Y().textAlignCenter," ").concat(ec().listItem),hoverable:!0,onMouseEnter:o,onMouseLeave:u,actions:[(0,m.jsx)(T.w6,{onEdit:r},"edit"),(0,m.jsx)(l_,{simulation:l,index:a,swr:n},"delete")],children:(0,m.jsx)(p.Z.Text,{strong:!0,className:Y().textAlignCenter,children:t.name})})};var lU=e=>{var l;let{simulation:t,onEdit:a,swr:i}=e,n=(0,h.useMemo)(()=>t.scheme.configuration.run,[t]);return(0,m.jsx)(m.Fragment,{children:null===(l=n.sensors)||void 0===l?void 0:l.map((e,l)=>(0,m.jsx)(lH,{simulation:t,sensor:e,index:l,_onEdit:a,swr:i},e.name))})},lR=e=>{let{geometries:l,simulation:t,setVisible:a,setResults:i,setPostprocessing:n,swr:s}=e,[o,u]=(0,h.useState)(),[r,d]=(0,h.useState)(),c=(0,h.useCallback)(()=>{i([]),n(void 0),d(void 0),a(!1),u(!0)},[a,i,n]),v=(0,h.useCallback)(e=>{i([]),n(void 0),d(e),a(!1),u(!0)},[a,i,n]),y=(0,h.useCallback)(()=>{d(void 0),a(!0),u(!1)},[a]);return(0,m.jsxs)(L.Z,{size:"small",title:"Sensors",children:[(0,m.jsx)(lL,{visible:o,geometries:l,simulation:t,sensor:r,onClose:y,swr:s}),(0,m.jsxs)(A.Z,{direction:"vertical",className:Y().fullWidth,children:[(0,m.jsx)(H.ZP,{className:Y().fullWidth,disabled:!1,type:"primary",icon:(0,m.jsx)(lw.Z,{}),onClick:c,children:"Add a sensor"}),(0,m.jsx)(lU,{simulation:t,onEdit:v,swr:s})]})]})},lY=t(5152),lz=t.n(lY),lF=t(11163),lB=t(85060),lW=t(139),lV=t(35742);let lD={plugins:"Plugins error",pluginsLoad:"Unable to load plugins",extra:"Unable to execute extra action"},lG=async(e,l,t)=>{try{await lV.Z.extra(e,l)}catch(e){t((0,w.iT)({title:lD.extra,err:e}))}},lq=e=>{let{plugin:l,onOk:a,setVisible:i}=e,n=lz()(()=>t(64546)("./".concat(l.key,"/src/components"))),s=(0,h.useCallback)(e=>{(async()=>{(0,C.merge)(l,e),await a(l),i(!1)})()},[l,a,i]);return(0,m.jsx)(L.Z,{title:l.configuration.name.value,children:(0,m.jsx)(n,{data:l.data,onSelect:s})},l.uuid)},lK=e=>{let{pluginsList:l,plugins:t,onOk:a,setVisible:i}=e;return(null==t?void 0:t.length)?(0,m.jsx)(A.Z,{align:"start",direction:"horizontal",wrap:!0,children:t.map(e=>{let t=l.find(l=>l.key===e.key);return t?(0,m.jsx)(lq,{plugin:e,onOk:a,setVisible:i},e.uuid):null})}):null};var lJ=e=>{let{disabled:l,cloudServer:t,onOk:a}=e,[i,n]=(0,h.useState)(!1),[s,o]=(0,h.useState)([]),{dispatch:u}=(0,h.useContext)(k.uj),r=(0,lF.useRouter)(),[d,{errorPlugins:c}]=lV.Z.usePlugins();(0,h.useEffect)(()=>{c&&u((0,w.iT)({title:lD.plugins,err:c}))},[c,u]),(0,h.useEffect)(()=>{(async()=>{try{let e=await M.Z.list();o(e)}catch(e){u((0,w.iT)({title:lD.pluginsLoad,err:e}))}})()},[u]);let v=(0,h.useCallback)(()=>n(!0),[]),b=(0,h.useCallback)(()=>n(!1),[]),g=(0,h.useCallback)(()=>{(async()=>{await r.push({pathname:"/dashboard",query:{page:"account",tab:"hpc"}})})()},[r]),f=(0,h.useCallback)(e=>{(async()=>{await lG(t,e,u)})()},[t,u]),j=(0,h.useMemo)(()=>{let e=null==t?void 0:t.extra;if(!e)return(0,m.jsx)(m.Fragment,{});let l=Object.keys(e).map(l=>{let t=e[l],a="cloud-download"===t.icon?(0,m.jsx)(lB.Z,{}):null;if("button"===t.type)return(0,m.jsx)(y.Z,{title:t.label,children:(0,m.jsx)(H.ZP,{icon:a,onClick:()=>f(t.action)})},t.action)});return(0,m.jsxs)("div",{children:["Custom plugin actions:",(0,m.jsx)("br",{}),l]})},[null==t?void 0:t.extra,f]);return(0,m.jsxs)(L.Z,{size:"small",title:"Computational resource",children:[(0,m.jsx)(x.Z,{open:i,title:"Computational resource",okButtonProps:{disabled:!0,style:{display:"none"}},onCancel:b,style:{width:"unset"},children:(0,m.jsxs)(A.Z,{direction:"vertical",children:[(0,m.jsxs)(p.Z.Text,{children:["Your computational resource does not appear in this list? Create one in your"," ",(0,m.jsx)(T.Qj,{onClick:g,children:"account settings"})]}),(0,m.jsx)(lK,{pluginsList:s,plugins:d,onOk:a,setVisible:n})]})}),(0,m.jsxs)(A.Z,{direction:"vertical",className:Y().fullWidth,children:[t&&(0,m.jsxs)(m.Fragment,{children:[(0,m.jsxs)(p.Z.Text,{children:[(0,m.jsx)("span",{className:Y().textLight,children:"Plugin:"})," ",t.name]}),(0,m.jsxs)(p.Z.Text,{children:[(0,m.jsx)("span",{className:Y().textLight,children:"Name:"})," ",t.configuration.name.value]}),Object.keys(t.inUseConfiguration).map(e=>{let l=t.inUseConfiguration[e],a=l.value;return"boolean"==typeof a&&(a=a?"yes":"no"),(0,m.jsxs)(p.Z.Text,{children:[(0,m.jsxs)("span",{className:Y().textLight,children:[l.label,":"]})," ",a]},e)})]}),(0,m.jsx)(H.ZP,{className:Y().fullWidth,disabled:l,type:t?"link":"primary",icon:(0,m.jsx)(lW.Z,{}),onClick:v,children:t?"Modify the resource":"Select a resource"}),j]})]})},l$=t(15360),lQ=t(25935),lX=t(48764).lW;let l0={log:"Unable to get system log"},l1=async(e,l,t)=>{try{let t=await O.Z.log({id:e.id},l.systemLog),a=lX.from(t.log).toString();x.Z.info({title:"System log",width:"unset",content:(0,m.jsx)("div",{style:{maxHeight:"70vh",overflow:"auto"},children:(0,m.jsx)("pre",{children:(0,m.jsx)("code",{children:(0,lQ.ZP)(a.replace(/\n\n/g,"\n").replace(/\n/g,"<br />"))})})})})}catch(e){t((0,w.iT)({title:l0.log,err:e}))}},l2=e=>{var l,t,a,i;let{simulation:n,step:s,loading:o,setLoading:u}=e,{dispatch:r}=(0,h.useContext)(k.uj),d=(0,h.useCallback)(()=>{(async()=>{u(!0);try{await l1(n,s,r)}catch(e){}finally{u(!1)}})()},[n,s,u,r]),c=(0,h.useMemo)(()=>{let e=[];return s.warning&&e.push({key:"warnings",className:ec().warning,label:(0,m.jsx)(p.Z.Text,{type:"warning",children:"Warnings"}),children:(0,lQ.ZP)(s.warning.replace(/\n\n/g,"\n").replace(/\n/g,"<br />"))}),s.error&&e.push({key:"errors",className:ec().error,label:(0,m.jsx)(p.Z.Text,{type:"danger",children:"Errors"}),children:(0,lQ.ZP)(s.error.replace(/\n\n/g,"\n").replace(/\n/g,"<br />"))}),e},[s]);return(0,m.jsxs)(m.Fragment,{children:[s.systemLog&&(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(H.ZP,{loading:o,onClick:d,children:"Complete log"}),(0,m.jsx)("br",{})]}),s.link&&(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)("a",{href:"https://"+s.link.href,target:"_blank",rel:"noreferrer",children:(0,m.jsx)(H.ZP,{type:"primary",children:s.link.label})}),(0,m.jsx)("br",{})]}),(0,m.jsx)(eJ.Z,{ghost:!0,items:c}),(0,lQ.ZP)(null!==(a=null===(l=s.pluginLog)||void 0===l?void 0:l.replace(/\n\n/g,"\n").replace(/\n/g,"<br />"))&&void 0!==a?a:""),(0,lQ.ZP)(null!==(i=null===(t=s.log)||void 0===t?void 0:t.replace(/\n\n/g,"\n").replace(/\n/g,"<br />").replace(/Info\s*:/g,'<span style="color: blue; font-weight: bold;">Info: </span>').replace(/Error:/g,'<span style="color: red; font-weight: bold;">Error:</span>'))&&void 0!==i?i:"")]})};var l5=e=>{let{simulation:l,steps:t}=e,[a,i]=(0,h.useState)(!1),[n,s]=(0,h.useState)(!1),o=(0,h.useCallback)(()=>i(!0),[]),u=(0,h.useCallback)(()=>i(!1),[]);return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(eC.Z,{title:"Log",open:a,onClose:u,width:"50%",children:(0,m.jsx)(g.Z,{items:null==t?void 0:t.map((e,t)=>({key:""+t,label:e.label,children:(0,m.jsx)(l2,{simulation:l,step:e,loading:n,setLoading:s})}))})}),(0,m.jsx)(y.Z,{title:"Log",children:(0,m.jsx)(H.ZP,{disabled:!(null==t?void 0:t.length),icon:(0,m.jsx)(l$.Z,{}),onClick:o})})]})},l3=t(99611),l7=t(90420),l8=t(23430),l6=t(10739);let l4={download:"Unable to download file"},l9=async(e,l,t)=>{try{let t=await l6.Z.download({id:e.id},{originPath:l.originPath,fileName:l.fileName}),a=await t.blob(),i=window.URL.createObjectURL(new Blob([a])),n=document.createElement("a");n.href=i,n.setAttribute("download",l.name+"."+l.fileName.split(".").pop()),n.click()}catch(e){t((0,w.iT)({title:l4.download,err:e}))}};var te=e=>{let{simulation:l,file:t}=e,[a,i]=(0,h.useState)(!1),{dispatch:n}=(0,h.useContext)(k.uj),s=(0,h.useCallback)(()=>{(async()=>{i(!0);try{await l9(l,t,n)}catch(e){}finally{i(!1)}})()},[l,t,n]);return(0,m.jsx)(y.Z,{title:"Download",children:(0,m.jsx)(H.ZP,{loading:a,icon:(0,m.jsx)(l8.Z,{}),onClick:s})})};let tl={archive:"Unable to download archive"},tt=async(e,l)=>{try{let l=await l6.Z.archive({id:e.id}),t=await l.blob(),a=window.URL.createObjectURL(new Blob([t])),i=document.createElement("a");i.href=a,i.setAttribute("download",e.scheme.name+".zip"),i.click()}catch(e){l((0,w.iT)({title:tl.archive,err:e}))}};var ta=e=>{let{simulation:l}=e,[t,a]=(0,h.useState)(!1),{dispatch:i}=(0,h.useContext)(k.uj),n=(0,h.useCallback)(()=>{(async()=>{a(!0);try{await tt(l,i)}catch(e){}finally{a(!1)}})()},[l,i]);return(0,m.jsx)(T.o6,{loading:t,onDownload:n})};let ti=e=>{var l;let{simulation:t,results:a,file:i,setResults:n}=e,s=(0,h.useCallback)(()=>{let e=a.findIndex(e=>e.fileName===i.fileName&&e.name===i.name);if(-1===e){let e=i.geometry,l=a.filter(l=>l.geometry!==e);n([...l,i])}else n([...a.slice(0,e),...a.slice(e+1)])},[a,i,n]),o=(0,h.useMemo)(()=>a.find(e=>e.fileName===i.fileName&&e.name===i.name),[a,i]);return(0,m.jsxs)(A.Z,{style:{alignItems:"center"},children:[(0,m.jsx)(H.ZP,{icon:o?(0,m.jsx)(l3.Z,{style:{color:"#fad114"}}):(0,m.jsx)(l7.Z,{}),onClick:s}),(0,m.jsx)(te,{simulation:{id:t.id},file:{name:i.name,fileName:i.fileName,originPath:i.originPath}}),null===(l=i.name)||void 0===l?void 0:l.replaceAll("_"," ")]})};var tn=e=>{let{simulation:l,results:t,setResults:a}=e,[i,n]=(0,h.useState)(),[s,o]=(0,h.useState)(),[u,r]=(0,h.useState)(),d=(0,h.useMemo)(()=>{var e;return null==l?void 0:null===(e=l.scheme)||void 0===e?void 0:e.configuration},[l]);(0,S.Z)(()=>{var e;if(!(null==l?void 0:l.tasks)){n([]),o(void 0);return}let t=[],a=null==d?void 0:null===(e=d.run)||void 0===e?void 0:e.resultsFilter;l.tasks.forEach(e=>{if(e.file&&t.push(e.file),e.files){if(a){let l=new RegExp(a.pattern),i=e.files.filter(e=>!l.test(e.fileName)),n=e.files.filter(e=>l.test(e.fileName)),s=e9(n,a),u=s.map(e=>e.number).filter((e,l,t)=>t.indexOf(e)===l).sort((e,l)=>e-l),r=le(d,a),c=u.map((e,l)=>({label:Math.round(1e15*(r?e*r:l))/1e15,value:e}));t.push(...i),o({filtered:!0,name:a.name,files:s,options:c})}else t.push(...e.files)}}),n(t)},[l,d]),(0,S.Z)(()=>{!u&&s&&r(null==s?void 0:s.options[0].value)},[s,u]);let c=(0,h.useCallback)(e=>{let l=s.files.filter(l=>l.number===e&&t.find(e=>e.name===l.name));a(l),r(e)},[t,s,a]);return i||s?(null==i?void 0:i.length)||s?(0,m.jsx)(L.Z,{size:"small",title:"Results",extra:(0,m.jsx)(ta,{simulation:l&&{id:l.id,scheme:l.scheme}}),children:(0,m.jsxs)(A.Z,{direction:"vertical",className:Y().fullWidth,children:[null==i?void 0:i.map(e=>(0,m.jsx)(ti,{simulation:l,results:t,file:e,setResults:a},e.name)),s&&(0,m.jsxs)(m.Fragment,{children:[s.name,(0,m.jsx)(v.Z,{className:Y().fullWidth,options:s.options,value:u,onChange:c}),s.files.map(e=>{if(e.number===u)return(0,m.jsx)(ti,{simulation:l,results:t,file:e,setResults:a},e.name)})]})]})}):(0,m.jsx)(L.Z,{size:"small",children:"No results yet"}):(0,m.jsx)(I.Z,{})};let ts={run:"Unable to run simulation",stop:"Unable to stop simulation",update:"Unable to update simulation"},to=async(e,l,t,a)=>{try{let a=P.Z.deepCopy(e),i=e.scheme.configuration;i.run.cloudServer=l,a.scheme.configuration=i,await O.Z.update({id:e.id},[{key:"scheme",type:"json",method:"set",path:["configuration","run"],value:i.run}]),await t.mutateOneSimulation(a),await t.mutateSimulation(a)}catch(e){a((0,w.iT)({title:ts.update,err:e}))}},tu=async(e,l,t)=>{try{await O.Z.run({id:e.id},t)}catch(e){throw l((0,w.iT)({title:ts.run,err:e})),e}},tr=async(e,l)=>{try{await O.Z.stop({id:e.id})}catch(e){throw l((0,w.iT)({title:ts.stop,err:e})),e}};var td=t(1402),tc=[{key:"warpByVector",label:"Warp by vector",parameters:[{key:"Vectors",label:"Vectors",rules:[{required:!0,message:"Vectors is required"}]},{key:"ScaleFactor",label:"Scale factor",default:"1",rules:[{required:!0,message:"Scale factor is required"}]}]},{key:"contour",label:"Contour",parameters:[{key:"ContourBy",label:"Contour by",rules:[{required:!0,message:"ContourBy by is required"}]},{key:"isosurface",label:"Isosurface",default:"0",rules:[{required:!0,message:"Isosurface is required"}]}]},{key:"streamTracer",label:"Stream tracer",parameters:[{key:"Vectors",label:"Vectors",rules:[{required:!0,message:"Vectors is required"}]}]}],tm=t(83755);let th=async(e,l,t,a)=>{let i=await (0,tm.R)("/api/postprocessing",{method:"POST",headers:{Accept:"application/json"},body:JSON.stringify({simulation:e,result:l,filter:t,parameters:a})});return i.json()};var tv={run:th},ty=t(79916),tp=t.n(ty);let tx={run:"Unable to run filter"},tb=async(e,l,t,a,i)=>{try{return await tv.run(e,l,t,a)}catch(e){throw i((0,w.iT)({title:tx.run,err:e})),e}},tg=e=>{let{simulation:l,postprocessing:t,result:a,setResult:i}=e,n=(0,h.useCallback)(()=>i((null==t?void 0:t.fileName)===a.fileName&&(null==t?void 0:t.name)===a.name?void 0:{type:"postprocessing",...a}),[t,a,i]);return(0,m.jsxs)(A.Z,{children:[(0,m.jsx)(H.ZP,{icon:(null==t?void 0:t.fileName)===a.fileName&&(null==t?void 0:t.name)===a.name?(0,m.jsx)(l3.Z,{className:Y().primaryColor}):(0,m.jsx)(l7.Z,{}),onClick:n}),(0,m.jsx)(te,{simulation:{id:l.id},file:{name:a.name,fileName:a.fileName,originPath:a.originPath}}),a.name]},a.glb)},tf=e=>{let{simulation:l,postprocessing:t,results:a,setResult:i}=e;return a.length?(0,m.jsx)(A.Z,{direction:"vertical",className:Y().fullWidth,children:a.map(e=>(0,m.jsx)(tg,{simulation:l,postprocessing:t,result:e,setResult:i},e.glb))}):(0,m.jsx)(m.Fragment,{children:"No results"})},tj={plugins:"Unable to load plugins",update:"Unable to update simulation"},tZ=async(e,l)=>{try{let l=await M.Z.list();return tC(e,E.Z,l)}catch(e){return l((0,w.iT)({title:tj.plugins,err:e})),[]}},tC=(e,l,t)=>{let a=l;return t.forEach(l=>{var t;(null===(t=e.authorizedplugins)||void 0===t?void 0:t.includes(l.key))&&"Model"===l.category&&(a=[...a,...l.models])}),a},tk=(e,l)=>{if(!(null==l?void 0:l.length))return!0;if(Array.isArray(e)){let t=l.filter(l=>e.includes(l));return t.length==l.length}return!!(1===l.length&&l.includes(e))},tw=async(e,l,t,a)=>{try{let a=l.find(l=>{var t;return l.algorithm===(null==e?void 0:null===(t=e.scheme)||void 0===t?void 0:t.algorithm)}),i=P.Z.deepCopy(e);(0,C.merge)(i.scheme,a),await O.Z.update({id:e.id},[{key:"scheme",value:i.scheme}]),await t.mutateOneSimulation(i)}catch(e){a((0,w.iT)({title:tj.update,err:e}))}};var tS={Selector:e=>{let{visible:l,user:t,title:a,okText:i,onOk:n,onCancel:s,onDelete:o}=e,[u,r]=(0,h.useState)(),[d,c]=(0,h.useState)(),[j,Z]=(0,h.useState)(!1),[C,w]=(0,h.useState)([]),[E,O]=(0,h.useState)(),[M,L]=(0,h.useState)([]),{dispatch:I}=(0,h.useContext)(k.uj);(0,S.Z)(()=>{(async()=>{let e=await tZ(t,I);w(e)})()},[t],[I]),(0,S.Z)(()=>{let e=C.map(e=>e.category).flat().filter((e,l,t)=>t.indexOf(e)===l).map(e=>({key:e,value:e}));O(e)},[C]);let A=(0,h.useCallback)(e=>{let{key:l}=e;r(l);let t=C.find(e=>e.algorithm===l);c({model:t})},[C]),_=(0,h.useCallback)(e=>{let{key:l}=e,a=l.split("&").pop();r(a);let i=t.usermodels.find(e=>e.model.algorithm===a);c(P.Z.deepCopy(i))},[t]),H=(0,h.useCallback)(()=>{(async()=>{if(Z(!0),d)try{await n(d)}catch(e){}Z(!1),c(void 0),r(void 0)})()},[d,n]),U=(0,h.useCallback)(()=>{c(void 0),r(void 0),s()},[s]),R=(0,h.useMemo)(()=>{let e=[{key:"category",disabled:!0,label:(0,m.jsx)(v.Z,{mode:"multiple",className:Y().fullWidth,options:E,allowClear:!0,showArrow:!1,placeholder:"Category filter",onChange:L,value:M,style:{textOverflow:"ellipsis"}})}];return C.forEach(l=>{tk(l.category,M)&&e.push({key:l.algorithm,label:l.name})}),e},[C,E,M]),z=(0,h.useMemo)(()=>{let e=[{key:"category",disabled:!0,label:(0,m.jsx)(v.Z,{mode:"multiple",className:Y().fullWidth,options:E,allowClear:!0,showArrow:!1,placeholder:"Category filter",onChange:L,value:M})}];return t.usermodels.forEach((l,a)=>{tk(l.model.category,M)&&e.push({key:l.id+"&"+l.model.algorithm,label:(0,m.jsxs)(m.Fragment,{children:[o?(0,m.jsx)(T.m1,{onDelete:async()=>o(a)}):null,(0,m.jsx)(y.Z,{title:l.model.name,children:(0,m.jsx)(p.Z.Text,{ellipsis:!0,children:l.model.name})}),l.owners.find(e=>e.id===t.id)?null:(0,m.jsx)("div",{className:"shared",children:P.Z.userToAvatar(l.owners[0])})]})})}),e},[t,E,M,o]);return(0,m.jsx)(x.Z,{open:l,title:null!=a?a:"Create simulation",okText:null!=i?i:"Create",okButtonProps:{loading:j},onOk:H,onCancel:U,width:"80%",children:(0,m.jsxs)(b.Z,{className:ec().selectorContent,children:[(0,m.jsx)(b.Z.Sider,{theme:"light",width:300,className:ec().selectorSider,children:(0,m.jsx)(g.Z,{defaultActiveKey:"tanatloc",items:[{key:"tanatloc",label:"Tanatloc algorithm",children:(0,m.jsx)(f.Z,{selectedKeys:u?[u]:void 0,mode:"inline",items:R,onClick:A})},{key:"personal",label:"User algorithm",children:(0,m.jsx)(f.Z,{selectedKeys:u?[u]:void 0,mode:"inline",className:ec().userMenu,items:z,onClick:_})}]})}),(0,m.jsx)(b.Z.Content,{className:ec().selector,children:(0,m.jsx)(N.Z.Html,{html:null==d?void 0:d.model.description})})]})})},Updater:e=>{let{user:l,simulation:t,swr:a}=e,[i,n]=(0,h.useState)([]),{dispatch:s}=(0,h.useContext)(k.uj);return(0,S.Z)(()=>{(async()=>{let e=await tZ(l,s);n(e)})()},[l],[s]),(0,S.Z)(()=>{let e=i.find(e=>{var l;return e.algorithm===(null==t?void 0:null===(l=t.scheme)||void 0===l?void 0:l.algorithm)});if(e&&(null==t?void 0:t.scheme)){let l=(0,j.Z)(t.scheme,e,{excludedKeys:["value","unit"]}),n=(0,Z.Z)(t.scheme,e,{excludedKeys:["value","unit"]});(Object.keys(l).length||Object.keys(n).length)&&(x.Z.info({title:"Update",content:"Your model need an update, please wait.",closable:!1,okButtonProps:{hidden:!0}}),tw(t,i,a,s).finally(()=>x.Z.destroyAll()))}},[t,i,a]),null},About:e=>{let{project:l,simulation:t,swr:a}=e;return l&&t?(0,m.jsx)(b.Z,{children:(0,m.jsx)(b.Z.Content,{children:(0,m.jsx)(L.Z,{size:"small",title:(0,m.jsx)(p.Z.Title,{level:5,ellipsis:!0,children:t.name}),actions:[(0,m.jsx)(B,{project:{id:l.id,simulations:l.simulations},simulation:t,swr:{mutateProject:a.mutateProject,addOneSimulation:a.addOneSimulation}},"copy"),(0,m.jsx)(K,{simulation:{id:t.id,name:t.name},swr:{mutateOneSimulation:a.mutateOneSimulation}},"edit"),(0,m.jsx)(Q,{project:{id:l.id,simulations:l.simulations},simulation:{id:t.id,name:t.name},swr:{mutateProject:a.mutateProject,delOneSimulation:a.delOneSimulation}},"delete")],children:(0,m.jsxs)(A.Z,{direction:"vertical",className:Y().fullWidth,children:[t.scheme.userModelId&&(0,m.jsx)(_.Z,{message:"User algorithm",type:"info",showIcon:!0}),(0,m.jsxs)(p.Z.Text,{children:[(0,m.jsx)("span",{className:Y().textLight,children:"Category:"})," ",t.scheme.category]}),(0,m.jsxs)(p.Z.Text,{children:[(0,m.jsx)("span",{className:Y().textLight,children:"Algorithm:"})," ",t.scheme.algorithm]}),(0,m.jsxs)(p.Z.Text,{children:[(0,m.jsx)("span",{className:Y().textLight,children:"Code:"})," ",t.scheme.code]}),(0,m.jsxs)(p.Z.Text,{children:[(0,m.jsx)("span",{className:Y().textLight,children:"Version:"})," ",t.scheme.version]}),(0,m.jsx)("div",{className:"".concat(Y().fullWidth," ").concat(Y().scroll),children:(0,m.jsx)(N.Z.Html,{html:t.scheme.description})})]})})})}):(0,m.jsx)(L.Z,{children:(0,m.jsx)(I.Z,{})})},Geometry:e=>{let{loadedGeometries:l,geometries:t,simulation:a,setGeometries:i,swr:n}=e,{dispatch:s}=(0,h.useContext)(k.uj),o=(0,h.useMemo)(()=>a.scheme.configuration.geometry.multiple,[a]),u=(0,h.useMemo)(()=>a.scheme.configuration.geometry.n,[a]),r=(0,h.useMemo)(()=>a.scheme.configuration.geometry.value,[a]),d=(0,h.useMemo)(()=>a.scheme.configuration.geometry.values,[a]);(0,S.Z)(()=>{(async()=>{o||r||!t.length?o&&!d&&t.length&&await ev(a,l,t.map(e=>e.id),i,n,s):await eh(a,l,t[0].id,i,n,s)})()},[o,r,d,l,t,n],[s]);let c=(0,h.useCallback)(e=>{(async()=>{o?await ev(a,l,e,i,n,s):await eh(a,l,e,i,n,s)})()},[o,l,a,i,n,s]),y=(0,h.useMemo)(()=>(0,m.jsx)("div",{className:ec().geometriesList,children:(0,m.jsx)(v.Z,{mode:o?"multiple":void 0,options:l.map(e=>({value:e.id,label:e.name})),value:o?d:r,onChange:c})}),[o,r,d,c,l]);return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(L.Z,{size:"small",children:(0,m.jsx)(p.Z.Text,{children:"When changing the simulation domain, you might lose your topological entity assignments"})}),(0,m.jsxs)(L.Z,{size:"small",children:[(0,m.jsx)(p.Z.Text,{strong:!0,children:"Select a simulation domain"}),u?(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)("br",{}),(0,m.jsxs)(p.Z.Text,{children:[u," geometries needed"]})]}):null]}),y,a.scheme.configuration.geometry.meshable&&(0,m.jsx)(er,{simulation:{id:a.id,scheme:a.scheme},swr:{mutateOneSimulation:n.mutateOneSimulation}})]})},Materials:e=>{let{geometries:l,simulation:t,swr:a,setVisible:i}=e,[n,s]=(0,h.useState)(),[o,u]=(0,h.useState)(!1),{dispatch:r}=(0,h.useContext)(ep.ZB),d=(0,h.useMemo)(()=>t.scheme.configuration.materials,[t]);(0,S.Z)(()=>{var e;(null===(e=l[0])||void 0===e?void 0:e.summary)&&r((0,ex.Cw)(2===l[0].summary.dimension?"faces":"solids"))},[l],[r]);let c=(0,h.useCallback)(()=>{s(void 0),u(!0),i(!1),r((0,ex.wp)())},[r,i]),v=(0,h.useCallback)(e=>{let l=d.values[e];s(l),u(!0),i(!1),r((0,ex.wp)())},[d,r,i]),y=(0,h.useCallback)(()=>{r((0,ex.h$)()),u(!1),s(void 0),i(!0)},[r,i]);return l.length?(0,m.jsx)(b.Z,{children:(0,m.jsx)(b.Z.Content,{children:(0,m.jsxs)(L.Z,{size:"small",children:[(0,m.jsx)(T.HS,{onAdd:c,fullWidth:!0,primary:!1,children:"Add material"}),(0,m.jsx)(eZ,{geometries:l.map(e=>({id:e.id,summary:e.summary})),simulation:{id:t.id,scheme:t.scheme},swr:a,onEdit:v}),(0,m.jsx)(eK,{visible:o,geometries:l.map(e=>({id:e.id,name:e.name,summary:e.summary})),simulation:{id:t.id,scheme:t.scheme},material:n&&{uuid:n.uuid,material:n.material,geometry:n.geometry,selected:n.selected},swr:{mutateOneSimulation:a.mutateOneSimulation},onClose:y})]})})}):(0,m.jsx)(ey.Z.Simple,{})},Parameters:e=>{let{simulation:l,swr:t}=e,{dispatch:a}=(0,h.useContext)(k.uj),i=(0,h.useMemo)(()=>null==l?void 0:l.scheme.configuration.parameters,[l]),n=(0,h.useMemo)(()=>null==l?void 0:l.scheme.configuration.dimension,[l]);(0,h.useEffect)(()=>{(async()=>{(null==i?void 0:i.done)||await e3(l,t,a)})()},[l,i,t,a]);let s=(0,h.useMemo)(()=>Object.keys(i).map(e=>{if("index"===e||"title"===e||"done"==e)return null;let a=i[e];return a.advanced?null:(0,m.jsx)(e4,{simulation:l,dimension:n,pkey:e,parameter:a,swr:t},e)}).filter(e=>e),[l,n,i,t]),o=(0,h.useMemo)(()=>Object.keys(i).map(e=>{if("index"===e||"title"===e||"done"==e)return null;let a=i[e];return a.advanced?(0,m.jsx)(e4,{simulation:l,dimension:n,pkey:e,parameter:a,swr:t},e):null}).filter(e=>e),[l,n,i,t]);return(0,m.jsx)(b.Z,{children:(0,m.jsx)(b.Z.Content,{children:(0,m.jsxs)(A.Z,{direction:"vertical",children:[s,o.length?(0,m.jsx)(eJ.Z,{items:[{key:"advanced",label:"Advanced",children:(0,m.jsx)(A.Z,{direction:"vertical",children:o})}]}):null]})})})},Initialization:e=>{let{simulations:l,simulation:t,swr:a}=e,[i,n]=(0,h.useState)(!1),[s,o]=(0,h.useState)(),[u,r]=(0,h.useState)(),[d,c]=(0,h.useState)(),{dispatch:y}=(0,h.useContext)(k.uj),x=(0,h.useMemo)(()=>null==t?void 0:t.scheme.configuration.initialization,[t]),g=(0,h.useMemo)(()=>null==t?void 0:t.scheme.configuration.dimension,[t]),f=(0,h.useCallback)(e=>{let t=l.find(l=>l.id===e);r(t)},[l]);(0,S.Z)(()=>{var e,l;!s&&x.value&&o(x.value.type),!u&&(null===(e=x.value)||void 0===e?void 0:e.simulation)&&f(null===(l=x.value)||void 0===l?void 0:l.simulation)},[x,s,u],[f]),(0,S.Z)(()=>{(async()=>{if(u){let e=await ls(l,u.id);c(e)}})()},[l,u]);let j=(0,h.useMemo)(()=>{let e=[{label:"None",value:"none"}];return x.coupling&&e.push({label:x.coupling.label,value:"coupling"}),x.direct&&e.push({label:x.direct.label,value:"direct"}),e},[x]),Z=x.value,C=(0,h.useCallback)(e=>{(async()=>{n(!0);try{await la(l,t,e,a,y),f(e)}catch(e){}finally{n(!1)}})()},[l,t,a,f,y]),w=(0,h.useCallback)((e,l)=>{(async()=>{await li(t,e,l,a,y)})()},[t,a,y]),N=(0,h.useCallback)((e,l)=>(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(p.Z.Text,{children:"If you use coupling, the selected simulation mesh will be used, at least for the first iteration."}),(0,m.jsxs)(A.Z,{direction:"vertical",className:Y().fullWidth,style:{marginTop:"10px"},children:[(0,m.jsx)(v.Z,{className:Y().fullWidth,options:e,placeholder:"Select a simulation",value:null==Z?void 0:Z.simulation,onChange:C}),i&&(0,m.jsx)(I.Z,{}),(null==d?void 0:d.length)?(0,m.jsxs)(m.Fragment,{children:[(0,m.jsxs)(p.Z.Text,{children:[null==l?void 0:l.name,":"]},"simulation"),(0,m.jsx)(v.Z,{className:Y().fullWidth,options:d,placeholder:"Select a "+l.name,value:null==Z?void 0:Z.result,onChange:w})]}):(0,m.jsx)(p.Z.Text,{type:"danger",children:"No results, please select an other simulation."})]})]}),[Z,d,i,C,w]),T=(0,h.useCallback)(e=>(0,m.jsx)(A.Z,{direction:"vertical",className:Y().fullWidth,children:e.children.map((e,l)=>{var i;if(2!==g||!e.only3D)return(0,m.jsx)(lo,{simulation:t,child:e,index:l,value:null==Z?void 0:null===(i=Z.values)||void 0===i?void 0:i[l],swr:a,dispatch:y},e.label)})}),[Z,g,t,a,y]),E=(0,h.useMemo)(()=>{let e={none:(0,m.jsx)("div",{})},a=x.coupling;if(null==a?void 0:a.compatibility){let i=l.map(e=>{let l=e.id===t.id||!a.compatibility.find(l=>l.algorithm===e.scheme.algorithm);return{label:e.name,value:e.id,disabled:l}}),n=a.compatibility.find(e=>{var l;return e.algorithm===(null==u?void 0:null===(l=u.scheme)||void 0===l?void 0:l.algorithm)}),s=null==n?void 0:n.filter;e.coupling=N(i,s)}let i=x.direct;return(null==i?void 0:i.children)&&(e.direct=T(i)),e},[l,t,u,x,N,T]),P=(0,h.useCallback)(e=>{(async()=>{try{await lt(t,e,a,y),o(e)}catch(e){}})()},[t,a,y]);return(0,m.jsx)(b.Z,{children:(0,m.jsx)(b.Z.Content,{children:(0,m.jsxs)(L.Z,{size:"small",children:[(0,m.jsx)(v.Z,{className:Y().fullWidth,style:{marginTop:"10px"},defaultValue:"none",value:s,options:j,onChange:P}),E[null!=s?s:"none"]]})})})},BoundaryConditions:e=>{let{simulation:l,geometries:t,swr:a,setVisible:i}=e,[n,s]=(0,h.useState)(),[o,u]=(0,h.useState)(!1),{dispatch:r}=(0,h.useContext)(ep.ZB),d=(0,h.useMemo)(()=>l.scheme.configuration.boundaryConditions,[l]);(0,S.Z)(()=>{var e;(null===(e=t[0])||void 0===e?void 0:e.summary)&&r((0,ex.Cw)(2===t[0].summary.dimension?"edges":"faces"))},[t],[r]);let c=(0,h.useCallback)(()=>{s(void 0),u(!0),i(!1),r((0,ex.wp)())},[r,i]),v=(0,h.useCallback)((e,l)=>{let t=d[e],a=t.values[l];s(a),u(!0),i(!1),r((0,ex.wp)())},[d,r,i]),y=(0,h.useCallback)(()=>{r((0,ex.h$)()),u(!1),s(void 0),i(!0)},[r,i]);return t.length?(0,m.jsx)(b.Z,{children:(0,m.jsx)(b.Z.Content,{children:(0,m.jsxs)(L.Z,{size:"small",children:[(0,m.jsx)(T.HS,{onAdd:c,fullWidth:!0,primary:!1,children:"Add boundary condition"}),(0,m.jsx)(lm,{geometries:t.map(e=>({id:e.id,summary:e.summary})),simulation:{id:l.id,scheme:l.scheme},swr:{mutateOneSimulation:a.mutateOneSimulation},onEdit:v}),(0,m.jsx)(lj,{visible:o,geometries:t.map(e=>({id:e.id,name:e.name,summary:e.summary})),simulation:{id:l.id,scheme:l.scheme},boundaryCondition:n&&{uuid:n.uuid,name:n.name,type:n.type,geometry:n.geometry,selected:n.selected,values:n.values},swr:{mutateOneSimulation:a.mutateOneSimulation},onClose:y})]})})}):(0,m.jsx)(ey.Z.Simple,{})},Run:e=>{var l;let{geometries:t,simulation:a,results:i,setResults:n,setPostprocessing:s,setVisible:o,swr:u}=e,[r,d]=(0,h.useState)(!1),[c,v]=(0,h.useState)(!1),[y,p]=(0,h.useState)(!1),[x,g]=(0,h.useState)(!1),[f,j]=(0,h.useState)([]),[Z,C]=(0,h.useState)(0),{dispatch:w}=(0,h.useContext)(k.uj),[N,{mutateSimulation:T}]=O.Z.useSimulation(a.id,2e3),E=(0,h.useMemo)(()=>a.scheme.configuration,[a]),P=(0,h.useMemo)(()=>{var e;return null==N?void 0:null===(e=N.scheme)||void 0===e?void 0:e.configuration},[N]);(0,S.Z)(()=>{if(!E){d(!0);return}let e=!0;Object.keys(E).forEach(l=>{if("dimension"!==l&&"run"!==l){let t=E[l];t.done||(e=!1)}}),E.run.cloudServer||(e=!1),d(!e)},[E]),(0,h.useEffect)(()=>{var e;let l=null===(e=a.scheme.configuration)||void 0===e?void 0:e.geometry;(null==l?void 0:l.mesh)||(null==l?void 0:l.meshes)?p(!0):(p(!1),g(!1))},[a]),(0,S.Z)(()=>{var e,l,t;(null==N?void 0:null===(e=N.tasks)||void 0===e?void 0:e.find(e=>(null==e?void 0:e.status)==="error"))?v(!1):(null==N?void 0:null===(l=N.tasks)||void 0===l?void 0:l.find(e=>e&&"finish"!==e.status))?v(!0):v(!1);let a=[];null==N||null===(t=N.tasks)||void 0===t||t.forEach((e,l)=>{if(e){if(l===N.tasks.length-1){var t,i,n;let l=null!==(n=null===(t=e.log)||void 0===t?void 0:t.match(/[\d\s]{3}%/g))&&void 0!==n?n:null===(i=e.log)||void 0===i?void 0:i.match(/[\d\s]*%/g),a=null==l?void 0:l.pop(),s=a?parseFloat(a):0;a&&C(s)}a[e.index]={index:e.index,label:e.label,status:e.status,log:e.log,pluginLog:e.pluginLog,warning:e.warning,error:e.error,systemLog:e.systemLog,link:e.link}}}),j(a)},[null==N?void 0:N.tasks]);let M=(0,h.useCallback)(async e=>to(a,e,{...u,mutateSimulation:T},w),[a,u,T,w]),_=(0,h.useCallback)(e=>{g(e.target.checked)},[]),U=(0,h.useCallback)(()=>{(async()=>{v(!0);try{await tu(a,w,x)}catch(e){v(!1)}})()},[a,x,w]),R=(0,h.useCallback)(()=>{(async()=>{try{await tr(a,w),v(!1)}catch(e){}})()},[a,w]);return a&&N&&(null==N?void 0:N.id)!=="0"?(0,m.jsx)(b.Z,{children:(0,m.jsx)(b.Z.Content,{children:(0,m.jsxs)(A.Z,{direction:"vertical",className:Y().fullWidth,children:[(0,m.jsx)(lR,{geometries:t,simulation:a,setVisible:o,setResults:n,setPostprocessing:s,swr:{mutateOneSimulation:u.mutateOneSimulation}}),(0,m.jsx)(lJ,{disabled:c,cloudServer:null==P?void 0:null===(l=P.run)||void 0===l?void 0:l.cloudServer,onOk:M}),(0,m.jsx)(L.Z,{size:"small",title:"Run",children:(0,m.jsxs)(A.Z,{direction:"vertical",className:Y().fullWidth,size:20,children:[y?(0,m.jsx)(X.Z,{checked:x,onChange:_,children:"Keep mesh?"}):null,(0,m.jsxs)("div",{className:Y().fullWidth,style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,m.jsxs)(A.Z,{children:[(0,m.jsx)(H.ZP,{disabled:r,type:"primary",icon:(0,m.jsx)(lC.Z,{}),loading:c,onClick:U,children:"Run"}),(0,m.jsx)(H.ZP,{disabled:!c,danger:!0,icon:(0,m.jsx)(lk.Z,{}),shape:"circle",onClick:R})]}),(0,m.jsx)(l5,{simulation:{id:a.id},steps:f})]}),(0,m.jsx)(lZ.Z,{direction:"vertical",current:f.length-1,percent:Z,items:f.map((e,l)=>({key:l,title:e.label,description:"("+(l+1)+"/"+f.length+")",status:e.status}))})]})}),(0,m.jsx)(tn,{simulation:N&&{id:N.id,scheme:N.scheme,tasks:N.tasks},results:i,setResults:n})]})})}):(0,m.jsx)(b.Z,{children:(0,m.jsx)(b.Z.Content,{children:(0,m.jsx)(L.Z,{size:"small",children:(0,m.jsx)(I.Z,{})})})})},Postprocessing:e=>{let{simulation:l,results:t,postprocessing:a,setResult:i}=e,[n,s]=(0,h.useState)(),[o,u]=(0,h.useState)(),[r,d]=(0,h.useState)(),[c,p]=(0,h.useState)(),{dispatch:x}=(0,h.useContext)(k.uj);(0,h.useEffect)(()=>{1!==t.length&&n&&s(!1)},[t,n]);let g=(0,h.useMemo)(()=>t[0],[t]);(0,h.useEffect)(()=>{l||(u(void 0),p(void 0))},[l]);let f=(0,h.useMemo)(()=>null==l?void 0:l.scheme.configuration.run.postprocessing,[l]),j=(0,h.useMemo)(()=>tc.map(e=>{if(null==f?void 0:f.find(l=>l.key===e.key))return{label:e.label,value:e.key}}).filter(e=>e),[f]),Z=(0,h.useMemo)(()=>{if(!f||!o)return;let e=tc.find(e=>e.key===o),l=f.find(e=>e.key===o);if(null==e?void 0:e.parameters)return e.parameters.map((e,t)=>{var a;let i=null==l?void 0:null===(a=l.parameters)||void 0===a?void 0:a.find(l=>l.key===e.key);return(null==i?void 0:i.value)?(0,m.jsx)(W.Z.Item,{label:e.label,name:["parameters",t],initialValue:i.value,rules:e.rules,children:(0,m.jsx)(V.Z,{disabled:!0})},e.key):(null==i?void 0:i.options)?(0,m.jsx)(W.Z.Item,{label:e.label,name:["parameters",t],rules:e.rules,children:(0,m.jsx)(v.Z,{options:i.options.map(e=>({label:e,value:e}))})},e.key):(0,m.jsx)(W.Z.Item,{label:e.label,name:["parameters",t],rules:e.rules,initialValue:e.default,children:(0,m.jsx)(V.Z,{})},e.key)})},[f,o]),C=(0,h.useCallback)(()=>s(!0),[]),w=(0,h.useCallback)(()=>s(!1),[]),S=(0,h.useCallback)(e=>{(async()=>{d(!0);try{var t;let a=await tb({id:l.id},g,o,null!==(t=e.parameters)&&void 0!==t?t:[],x);p({filter:o,results:a})}catch(e){}d(!1)})()},[l,g,o,x]);return l&&1===t.length&&f&&j.length?(0,m.jsx)(b.Z,{className:tp().postprocessing,children:(0,m.jsxs)(b.Z.Content,{children:[(0,m.jsx)(y.Z,{title:"Post-processing",children:(0,m.jsx)(H.ZP,{type:"primary",icon:(0,m.jsx)(td.Z,{}),onClick:C,className:tp().button})}),(0,m.jsxs)(eC.Z,{title:"Post-processing",closable:!0,onClose:w,open:n,mask:!1,maskClosable:!1,children:[(0,m.jsx)(W.Z,{children:(0,m.jsx)(W.Z.Item,{name:"filter",label:"Filter",children:(0,m.jsx)(v.Z,{placeholder:"Select a filter",options:j,onChange:u})})}),(0,m.jsxs)(W.Z,{layout:"vertical",style:{margin:"24px 0"},onFinish:S,children:[Z,(0,m.jsx)(W.Z.Item,{children:(0,m.jsx)(H.ZP,{type:"primary",loading:r,htmlType:"submit",icon:(0,m.jsx)(lC.Z,{}),children:"Run"})})]}),c&&(0,m.jsx)(L.Z,{size:"small",title:"Post-processing",extra:c.filter,children:(0,m.jsx)(tf,{simulation:l,postprocessing:a,results:c.results,setResult:i})})]})]})}):null}}},40782:function(e,l,t){"use strict";t.d(l,{CH:function(){return u},Cw:function(){return s},HW:function(){return r},N7:function(){return m},Ys:function(){return d},h$:function(){return n},hF:function(){return c},rx:function(){return o},wp:function(){return i}});var a=t(48474);let i=()=>({type:a.Hp.ENABLE}),n=()=>({type:a.Hp.DISABLE}),s=e=>({type:a.Hp.SETTYPE,value:e}),o=e=>({type:a.Hp.SETPART,value:e}),u=e=>{let{uuid:l,label:t}=e;return{type:a.Hp.HIGHLIGHT,value:{uuid:l,label:t}}},r=()=>({type:a.Hp.UNHIGHLIGHT}),d=e=>{let{uuid:l,label:t}=e;return{type:a.Hp.SELECT,value:{uuid:l,label:t}}},c=e=>{let{uuid:l,label:t}=e;return{type:a.Hp.UNSELECT,value:{uuid:l,label:t}}},m=e=>({type:a.Hp.SETPOINT,value:e})},48474:function(e,l,t){"use strict";t.d(l,{Hp:function(){return s},ZB:function(){return o}});var a=t(85893),i=t(67294);let n={enabled:!1,type:void 0,part:void 0,highlighted:void 0,selected:[],point:void 0,dispatch:()=>void 0},s={ENABLE:"ENABLE",DISABLE:"DISABLE",CLEAR:"CLEAR",SETTYPE:"SETTYPE",SETPART:"SETPART",HIGHLIGHT:"HIGHLIGHT",UNHIGHLIGHT:"UNHIGHLIGHT",SELECT:"SELECT",UNSELECT:"UNSELECT",SETPOINT:"SETPOINT"},o=(0,i.createContext)(n),u=(e,l)=>{let t;switch(l.type){case s.ENABLE:return{...e,enabled:!0};case s.DISABLE:return{...e,enabled:!1,highlighted:void 0,selected:[],point:void 0};case s.CLEAR:return{...n};case s.SETTYPE:return{...e,type:l.value};case s.SETPART:return{...e,part:l.value};case s.HIGHLIGHT:return{...e,highlighted:l.value};case s.UNHIGHLIGHT:return{...e,highlighted:void 0};case s.SELECT:if(-1===(t=e.selected.findIndex(e=>e.uuid===l.value.uuid)))return{...e,selected:[...e.selected,l.value]};return e;case s.UNSELECT:if(-1===(t=e.selected.findIndex(e=>e.uuid===l.value.uuid)))return e;return{...e,selected:[...e.selected.slice(0,t),...e.selected.slice(t+1)]};case s.SETPOINT:return{...e,point:l.value};default:return e}};l.ZP=e=>{let{children:l}=e,[t,s]=(0,i.useReducer)(u,n),r=(0,i.useMemo)(()=>({...t,dispatch:s}),[t]);return(0,a.jsx)(o.Provider,{value:r,children:l})}},43437:function(e){e.exports={formula:"formula_formula__smqjI",select:"formula_select__Oi6_G"}},68847:function(e){e.exports={panel:"panel_panel___hALB",subPanel:"panel_subPanel__0TV8M"}},98281:function(e){e.exports={userMenu:"simulation_userMenu__e8lOH",selectorContent:"simulation_selectorContent__HWIz8",selectorSider:"simulation_selectorSider__aC0Gk",selector:"simulation_selector__Xf4pE",geometriesList:"simulation_geometriesList__1Ces7",waring:"simulation_waring__Dn3br",error:"simulation_error__4EgiV",listItem:"simulation_listItem__YxV62"}},79916:function(e){e.exports={postprocessing:"postprocessing_postprocessing__SLJQQ",button:"postprocessing_button__tNNEm"}},64546:function(e,l,t){var a={"./local/src/components":[21091,1091]};function i(e){if(!t.o(a,e))return Promise.resolve().then(function(){var l=Error("Cannot find module '"+e+"'");throw l.code="MODULE_NOT_FOUND",l});var l=a[e],i=l[0];return t.e(l[1]).then(function(){return t(i)})}i.keys=function(){return Object.keys(a)},i.id=64546,e.exports=i}}]);