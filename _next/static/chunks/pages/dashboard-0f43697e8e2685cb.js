(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8026],{40528:function(e,a,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/dashboard",function(){return t(90037)}])},37404:function(e,a,t){"use strict";t.d(a,{JT:function(){return s},ah:function(){return l},nq:function(){return i},tE:function(){return n},yL:function(){return r}}),t(83454).env.AUTH_SECRET||Array(33).join("a");let r=6,i=16,s=!0,n=!0,l=!0},5094:function(e,a,t){"use strict";t.d(a,{Z:function(){return s}});var r=t(11425);let i=async(e,a)=>{let t=await (0,r.R)("/api/avatar",{method:"POST",headers:{Accept:"application/json"},body:JSON.stringify({file:e,project:a})});return t.json()};var s={add:i}},4415:function(e,a,t){"use strict";t.d(a,{H:function(){return r}});class r extends Error{constructor(e){super(e.title),this.title=e.title,this.name="APIError",this.render=e.render,this.err=e.err,this.type=e.type||"error"}}},71270:function(e,a,t){"use strict";t.d(a,{Z:function(){return c}});var r=t(11425);let i=async e=>{await (0,r.R)("/api/plugin",{method:"POST",body:JSON.stringify(e)})},s=async e=>{await (0,r.R)("/api/plugin",{method:"PUT",body:JSON.stringify(e)})},n=async e=>{await (0,r.R)("/api/plugin",{method:"DELETE",body:JSON.stringify(e)})};var l=t(8100),o=t(67294);let d=()=>{let{data:e,error:a,mutate:t}=(0,l.ZP)("/api/plugin",r._),i=(null==e?void 0:e.plugins)||[],s=(0,o.useCallback)(e=>{let a=[...i,e];t({plugins:a})},[i,t]),n=(0,o.useCallback)(e=>{let a=i.filter(a=>a.key!==e.key);t({plugins:a})},[i,t]),d=(0,o.useCallback)(e=>{let a=i.map(a=>(a.key===e.key&&(a={...a,...e}),a));t({plugins:a})},[i,t]);return[i,{mutatePlugins:t,addOnePlugin:s,delOnePlugin:n,mutateOnePlugin:d,errorPlugins:a,loadingPlugins:!e}]};var c={add:i,update:s,del:n,usePlugins:d}},10843:function(e,a,t){"use strict";t.d(a,{Z:function(){return n}});var r=t(11425);let i=async()=>{let e=await (0,r.R)("/api/plugins",{method:"GET",headers:{Accept:"application/json"}});return e.json()},s=async()=>{let e=await (0,r.R)("/api/plugins",{method:"POST",headers:{Accept:"application/json"}});return e.json()};var n={list:i,completeList:s}},26791:function(e,a,t){"use strict";t.d(a,{Z:function(){return g}});var r=t(8100),i=t(67294),s=t(11425);let n=e=>{let{data:a,error:t,mutate:n}=(0,r.ZP)(["/api/projects",JSON.stringify({ids:e})],s._),l=(null==a?void 0:a.projects)||[],o=(0,i.useCallback)(e=>{let a=[...l,{...e,users:[],geometries:[],simulations:[],groups:[]}];n({projects:a})},[l,n]),d=(0,i.useCallback)(e=>{let a=l.filter(a=>a.id!==e.id);n({projects:a})},[l,n]),c=(0,i.useCallback)(e=>{let a=l.map(a=>(a.id===e.id&&(a={...a,...e}),a));n({projects:a})},[l,n]);return[l,{addOneProject:o,delOneProject:d,mutateOneProject:c,errorProjects:t,loadingProjects:!a}]},l=e=>{let{data:a,error:t,mutate:n}=(0,r.ZP)("/api/project"+(e?"/"+e:""),s._),l=(null==a?void 0:a.project)||{id:"0"},o=(0,i.useCallback)(e=>{let a={...l,...e};n({project:a})},[l,n]);return[l,{mutateProject:o,errorProject:t,loadingProject:!a}]},o=async(e,a)=>{let t=await (0,s.R)("/api/project",{method:"POST",headers:{Accept:"application/json"},body:JSON.stringify({workspace:{id:e.id},project:a})});return t.json()},d=async(e,a)=>{await (0,s.R)("/api/project/"+e.id,{method:"PUT",body:JSON.stringify(a)})},c=async(e,a)=>{await (0,s.R)("/api/project/"+a.id,{method:"DELETE",body:JSON.stringify({id:e.id})})},u=async e=>(0,s.R)("/api/project/"+e.id+"/archive",{method:"GET",headers:{Accept:"application/json"}}),p=async e=>(0,s.R)("/api/project/"+e.id+"/archive",{method:"PUT"}),m=async e=>(0,s.R)("/api/project/"+e.id+"/archive",{method:"DELETE"}),h=async(e,a)=>(0,s.R)("/api/project/"+e.id+"/archive",{method:"POST",body:JSON.stringify({archive:a})});var g={useProjects:n,useProject:l,add:o,update:d,del:c,archive:u,unarchiveFromServer:p,deleteArchiveFile:m,unarchiveFromFile:h}},92288:function(e,a,t){"use strict";t.d(a,{Z:function(){return o}});var r=t(8100),i=t(67294),s=t(11425);let n=()=>{let{data:e,error:a,mutate:t}=(0,r.ZP)("/api/system",s._),n=(null==e?void 0:e.system)||{},l=(0,i.useCallback)(e=>{t({system:{...n,...e}})},[n,t]);return[n,{mutateSystem:l,errorSystem:a,loadingSystem:!e}]},l=async e=>{await (0,s.R)("/api/system",{method:"PUT",body:JSON.stringify(e)})};var o={useSystem:n,update:l}},18436:function(e,a,t){"use strict";t.d(a,{HS:function(){return o},Lw:function(){return k},m1:function(){return j},o6:function(){return w},w6:function(){return u},ks:function(){return Z},Qj:function(){return z}});var r=t(85893),i=t(84908),s=t(71577),n=t(64789);let l=e=>{let{disabled:a,primary:t=!0,light:l,dark:o,fullWidth:d,needMargin:c,loading:u,children:p,onAdd:m}=e;return(0,r.jsx)(i.Z,{title:p||"Add",children:(0,r.jsx)(s.Z,{className:(d?"full-width":"")+(c?" marginLeft-5":"")+(l?" text-light":"")+(o?" text-dark":""),disabled:a,loading:u,type:t?"primary":"default",icon:(0,r.jsx)(n.Z,{}),onClick:()=>m(),children:p})})};var o=l,d=t(47389);let c=e=>{let{disabled:a,primary:t=!1,bordered:n,light:l,dark:o,needMargin:c,loading:u,children:p,onEdit:m}=e;return(0,r.jsx)(i.Z,{title:p||"Edit",children:(0,r.jsx)(s.Z,{className:"no-background "+(c?"marginLeft-5 ":"")+(l?"text-light ":"")+(o?"text-dark ":"")+(n?"":"no-border "),disabled:a,loading:u,type:a?"link":t?"primary":"default",icon:(0,r.jsx)(d.Z,{}),onClick:m,children:p})})};var u=c,p=t(67294),m=t(82061),h=t(28345);let g=e=>{let{disabled:a,loading:t,bordered:n,text:l,title:o,children:d,onDelete:c}=e,[u,g]=(0,p.useState)(!1);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(h.AN,{visible:u,loading:t,title:o||"Delete",onCancel:()=>g(!1),async onOk(){await c(),g(!1)},children:l||"Are you sure?"}),(0,r.jsx)(i.Z,{title:d||"Delete",children:(0,r.jsx)(s.Z,{className:"no-background "+(n?"":"no-border"),danger:!0,disabled:a,type:a?"link":void 0,loading:t,icon:(0,r.jsx)(m.Z,{}),onClick:()=>g(!0),children:d})})]})};var j=g,x=t(69753);let y=e=>{let{disabled:a,loading:t,bordered:n,children:l,onDownload:o}=e;return(0,r.jsx)(i.Z,{title:l||"Download",children:(0,r.jsx)(s.Z,{className:"no-background "+(n?"":"no-border"),disabled:a,loading:t,icon:(0,r.jsx)(x.Z,{}),onClick:()=>o(),children:l})})};var w=y,v=t(12157);let f=e=>{let{children:a,onClick:t}=e;return(0,r.jsx)(s.Z,{className:"no-border",icon:(0,r.jsx)(v.Z,{className:"color-primary"}),onClick:t,children:a||"Go back"})};var Z=f;let b=e=>{let{disabled:a,loading:t,children:n,onCancel:l}=e;return(0,r.jsx)(i.Z,{title:n||"Cancel",children:(0,r.jsx)(s.Z,{disabled:a,loading:t,type:"default",onClick:l,children:n||"Cancel"})})};var k=b;let O=e=>{let{children:a,onClick:t}=e;return(0,r.jsx)(s.Z,{type:"link",onClick:t,style:{padding:0},children:a})};var z=O},47455:function(e,a,t){"use strict";t.d(a,{o:function(){return y}});var r=t(85893),i=t(227),s=t(96365),n=t(37404),l=t(92288);let o={password:"Please enter a password",passwordTooSmall:e=>"Your password is too small (minimum "+e+" characters)",passwordTooLong:e=>"Your password is too long (maximum "+e+" characters)",passwordRequireLetter:"Your password must contain a letter",passwordRequireNumber:"Your password must contain a number",passwordRequireSymbol:"Your password must contain a symbol"},d=(e,a)=>!(a.length<e),c=(e,a)=>!(a.length>e),u=(e,a)=>-1!==e.search(a),p=(e,a)=>{var t,r;return(null!==(r=null==e?void 0:null===(t=e.password)||void 0===t?void 0:t.requireLetter)&&void 0!==r?!r:!n.JT)||u(a,/[a-zA-Z]/)},m=(e,a)=>{var t,r;return(null!==(r=null==e?void 0:null===(t=e.password)||void 0===t?void 0:t.requireNumber)&&void 0!==r?!r:!n.tE)||u(a,/\d/)},h=(e,a)=>{var t,r;return(null!==(r=null==e?void 0:null===(t=e.password)||void 0===t?void 0:t.requireSymbol)&&void 0!==r?!r:!n.ah)||u(a,/[!@#$%^&*(){}[\]<>?/|.:;_-]/)},g=(e,a,t,r)=>{d(e,t)||r.push(o.passwordTooSmall(e)),c(a,t)||r.push(o.passwordTooLong(a))},j=(e,a,t)=>{p(e,a)||t.push(o.passwordRequireLetter),m(e,a)||t.push(o.passwordRequireNumber),h(e,a)||t.push(o.passwordRequireSymbol)},x=e=>{var a,t,d,c;let{labelCol:u,wrapperCol:p,name:m,label:h,inputPlaceholder:x,inputAutoComplete:y,edit:w,style:v,required:f,className:Z}=e,[b]=l.Z.useSystem(),k=null!==(d=null==b?void 0:null===(a=b.password)||void 0===a?void 0:a.min)&&void 0!==d?d:n.yL,O=null!==(c=null==b?void 0:null===(t=b.password)||void 0===t?void 0:t.max)&&void 0!==c?c:n.nq;return(0,r.jsx)(i.Z.Item,{className:Z,labelCol:u,wrapperCol:p,name:m||"password",label:h||"Password",rules:[()=>({validator(e,a){let t=[];return w&&"******"===a?Promise.resolve():a?(g(k,O,a,t),j(b,a,t),t.length)?Promise.reject(t):Promise.resolve():Promise.reject(o.password)}}),{required:!!f,message:""}],style:v,children:(0,r.jsx)(s.Z.Password,{placeholder:x,autoComplete:y})})};var y=x},64376:function(e,a,t){"use strict";var r=t(85893),i=t(84908),s=t(63922),n=t(24093),l=t(11382),o=t(13023),d=t(48764).lW;let c=e=>JSON.parse(JSON.stringify(e)),u=e=>{if(!e)return"#FFFFFF";let a=Array.from(e).reduce((e,a)=>a.charCodeAt(0)+((e<<5)-e),0);return"hsl("+a%360+", 100%, 25%)"},p=e=>{if(!e)return"#"+Math.floor(16777215*Math.random()).toString(16);let a=[],t=255/e;for(let r=0;r<e;r++){let i=Math.floor(r*t%255).toString(16).padStart(2,"0"),s=Math.floor((r+1)*t%255).toString(16).padStart(2,"0"),n=Math.floor((r+2)*t%255).toString(16).padStart(2,"0");a.push("#"+i+s+n)}return a},m=e=>{let a=e.toString(16);return 1===a.length?"0"+a:a},h=e=>"#"+m(Math.floor(255*e.r))+m(Math.floor(255*e.g))+m(Math.floor(255*e.b)),g=e=>{let a=e.avatar&&d.from(e.avatar).toString(),t="",o="";return e.firstname||e.lastname?(t=(e.firstname?e.firstname+" ":"")+(e.lastname||""),o=(e.firstname?e.firstname[0]:"")+(e.lastname?e.lastname[0]:"")):e.email&&(t=e.email,o=e.email[0]),(0,r.jsx)(i.Z,{title:t+(e.pending?" (Invite pending)":""),children:(0,r.jsx)(s.Z,{count:e.pending&&"Pending...",offset:[30,5],style:{backgroundColor:"#ff4d4f",zIndex:10},children:(0,r.jsx)(n.C,{src:a,style:{backgroundColor:u(t)},children:o.toUpperCase()||(0,r.jsx)(l.Z,{})})})},e.id||JSON.stringify(e))},j=e=>{let a=e.name,t="";return a&&(t=a[0]),(0,r.jsx)(i.Z,{title:a,children:(0,r.jsx)(n.C,{style:{backgroundColor:u(a)},children:t.toUpperCase()||(0,r.jsx)(l.Z,{})})},e.id||JSON.stringify(e))},x=e=>!!(0,o.parseOneAddress)(e);a.Z={deepCopy:c,stringToColor:u,colorGenerator:p,rgbToHex:h,rgbToRgba:function(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return e?"rgba("+255*e.r+", "+255*e.g+", "+255*e.b+", "+a+")":"rgba(255, 255, 255, 0)"},userToAvatar:g,groupToAvatar:j,validateEmail:x,getGitVersion:()=>"git-front-5775ebb"}},90037:function(e,a,t){"use strict";t.r(a),t.d(a,{default:function(){return tY}});var r=t(85893),i=t(11163),s=t(67294),n=t(97183),l=t(66516),o=t(80284),d=t(41156),c=t(42952),u=t(55355),p=t(11186),m=t(47389),h=t(63783),g=t(92443),j=t(59134),x=t.n(j),y=t(4147),w=t(67582),v=t(54666),f=t(19345),Z=t(27049),b=t(227),k=t(96365),O=t(98662),z=t(62986),C=t(28345),S=t(8100),P=t(11425);let N=()=>{let{data:e,error:a,mutate:t}=(0,S.ZP)("/api/workspace",P._),r=(null==e?void 0:e.workspaces)||[],i=(0,s.useCallback)(e=>{let a=[...r,e];t({workspaces:a})},[r,t]),n=(0,s.useCallback)(e=>{let a=r.filter(a=>a.id!==e.id);t({workspaces:a})},[r,t]),l=(0,s.useCallback)(e=>{let a=r.map(a=>(a.id===e.id&&(a={...a,...e}),a));t({workspaces:a})},[r,t]);return[r,{addOneWorkspace:i,delOneWorkspace:n,mutateOneWorkspace:l,errorWorkspaces:a,loadingWorkspaces:!e}]},T=async e=>{let a=await (0,P.R)("/api/workspace",{method:"POST",headers:{Accept:"application/json"},body:JSON.stringify(e)});return a.json()},E=async(e,a)=>{await (0,P.R)("/api/workspace",{method:"PUT",body:JSON.stringify({workspace:e,data:a})})},A=async e=>{await (0,P.R)("/api/workspace",{method:"DELETE",body:JSON.stringify(e)})};var I={useWorkspaces:N,add:T,update:E,del:A},U=t(26713),R=t(24093),D=t(40110),F=t(97986),q=t(84908),L=t(71577),W=t(20046),H=t(18436),G=t(64376),J=t(26791);let M={share:"Unable to share"},_=async(e,a,t,r,i)=>{try{if(e){await I.update({id:e.id},[{key:"groups",value:t},{key:"users",value:r}]);let s=G.Z.deepCopy(e);s.groups=t.map(e=>({id:e})),s.users=r.map(e=>({id:e})),i.mutateOneWorkspace(s)}else{await J.Z.update({id:a.id},[{key:"groups",value:t},{key:"users",value:r}]);let n=G.Z.deepCopy(a);n.groups=t.map(e=>({id:e})),n.users=r.map(e=>({id:e})),i.mutateOneProject(n)}}catch(l){throw(0,w.lt)(M.share,l),l}},B=e=>{let a=e.email;return(e.lastname||e.firstname)&&(a=(e.lastname?e.lastname+" ":"")+(e.firstname||"")),a},Y=e=>{let{disabled:a,workspace:t,project:n,organizations:l,swr:d,style:c}=e,[u,p]=(0,s.useState)(!1),[m,h]=(0,s.useState)(!1),[g,j]=(0,s.useState)([]),[y,w]=(0,s.useState)([]),[v,f]=(0,s.useState)([]),[Z,k]=(0,s.useState)([]),O=(0,i.useRouter)();(0,s.useEffect)(()=>{let e=t||n,a=null==e?void 0:e.groups.map(e=>e.id),r=null==e?void 0:e.users.map(e=>e.id);f(a||[]),k(r||[])},[t,n]),(0,s.useEffect)(()=>{let e=l.map(e=>{let a=e.groups.map(e=>({key:e.id,title:e.name,value:e.id,type:"group"}));return{key:e.id,title:e.name,value:e.id,disabled:!0,checkable:!1,children:a}}),a=[];l.forEach(e=>{e.owners.forEach(e=>{a.push({key:e.id,title:B(e),value:e.id,type:"user"})}),e.users.forEach(e=>{a.push({key:e.id,title:B(e),value:e.id,type:"user"})}),e.groups.forEach(e=>{e.users.forEach(e=>{a.push({key:e.id,title:B(e),value:e.id,type:"user"})})})});let t=a.filter((e,a,t)=>t.findIndex(a=>a.key===e.key)===a);j(e),w(t)},[l]);let z=null;return z=g.length?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(b.Z.Item,{label:(0,r.jsxs)(r.Fragment,{children:["Share this ",t?"workspace":"project"," with organizations groups"]}),children:(0,r.jsx)(F.Z,{multiple:!0,treeCheckable:!0,treeDefaultExpandAll:!0,showCheckedStrategy:F.Z.SHOW_ALL,placeholder:"Select groups",dropdownStyle:{maxHeight:400,overflow:"auto"},className:"full-width",treeData:g,value:v,onChange:e=>f(e)})}),(0,r.jsx)(b.Z.Item,{label:(0,r.jsxs)(r.Fragment,{children:["Share this ",t?"workspace":"project"," with organizations users"]}),children:(0,r.jsx)(F.Z,{multiple:!0,treeCheckable:!0,treeDefaultExpandAll:!0,showCheckedStrategy:F.Z.SHOW_ALL,placeholder:"Select users",dropdownStyle:{maxHeight:400,overflow:"auto"},className:"full-width",treeData:y,value:Z,onChange:e=>k(e)})})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("br",{}),(0,r.jsx)(o.Z.Text,{strong:!0,children:"There is no organization for now"}),(0,r.jsx)("br",{}),(0,r.jsxs)(o.Z.Text,{children:["You can create organizations and groups in the"," ",(0,r.jsx)(H.Qj,{onClick:()=>O.push({pathname:"/dashboard",query:{page:"organizations"}}),children:"Organization menu"}),"."]})]}),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(q.Z,{title:"Share",children:(0,r.jsx)(L.Z,{className:"no-background "+((null==c?void 0:c.buttonLight)?"text-light ":"")+((null==c?void 0:c.buttonDark)?" text-dark ":"")+((null==c?void 0:c.buttonBordered)?" ":"no-border ")+(x()()?"display-none ":" "),disabled:a,type:a?"link":void 0,icon:(0,r.jsx)(W.Z,{}),onClick:()=>p(!0)},"share")}),(0,r.jsxs)(C.ZP,{title:"Share "+(t?"workspace":"project"),visible:u,onCancel:()=>p(!1),async onOk(){h(!0);try{await _(t,n,v,Z,d),h(!1),p(!1)}catch(e){throw h(!1),e}},loading:m,children:[(0,r.jsxs)(o.Z.Title,{level:5,children:[t?"Workspace: ":"Project: ",(null==t?void 0:t.name)||(null==n?void 0:n.title)]}),z]})]})},V={add:"Unable to add project"},X=async(e,a,t)=>{try{let r=await J.Z.add({id:e.id},a);return t.addOneProject(r),t.mutateOneWorkspace({...e,projects:[...e.projects,r.id]}),r}catch(i){throw(0,w.lt)(V.add,i),i}},K=e=>{let{workspace:a,swr:t}=e,[n,l]=(0,s.useState)(!1),[o,d]=(0,s.useState)(!1),c=(0,i.useRouter)();return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(H.HS,{primary:!1,dark:!0,onAdd:()=>l(!0),children:"Create a new project"}),(0,r.jsxs)(C.ZP,{title:"Create a new project",visible:n,onCancel:()=>l(!1),async onOk(e){d(!0);try{let r=await X(a,e,t);d(!1),l(!1),c.push({pathname:"/project",query:{page:"workspaces",workspaceId:a.id,projectId:r.id}})}catch(i){throw d(!1),i}},loading:o,children:[(0,r.jsx)(b.Z.Item,{label:"Name",name:"title",rules:[{required:!0,message:"Name is required"},{max:50,message:"Max 50 characters"}],children:(0,r.jsx)(k.Z,{placeholder:"Project's name"})}),(0,r.jsx)(b.Z.Item,{label:"Description",name:"description",children:(0,r.jsx)(k.Z.TextArea,{showCount:!0,maxLength:120,placeholder:"Project's description"})})]})]})};var Q=t(47987),$=t(20550),ee=t(61980);let ea={edit:"Unable to edit project"},et=async(e,a,t)=>{try{await J.Z.update({id:e.id},[{key:"title",value:a.title},{key:"description",value:a.description}]),t.mutateOneProject(e)}catch(r){throw(0,w.lt)(ea.edit,r),r}},er=e=>{let{disabled:a,project:t,swr:i}=e,[n,l]=(0,s.useState)(!1),[o,d]=(0,s.useState)(!1);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(H.w6,{disabled:a,dark:!0,onEdit:()=>l(!0)}),(0,r.jsxs)(C.ZP,{title:'Edit "'+t.title+'" project',visible:n,onCancel:()=>l(!1),async onOk(e){d(!0);try{await et(t,e,i),d(!1),l(!1)}catch(a){throw d(!1),a}},loading:o,initialValues:{title:t.title,description:t.description},children:[(0,r.jsx)(b.Z.Item,{label:"Name",name:"title",rules:[{required:!0,message:"Name is required"},{max:50,message:"Max 50 characters"}],children:(0,r.jsx)(k.Z,{placeholder:"Project's name"})}),(0,r.jsx)(b.Z.Item,{label:"Description",name:"description",children:(0,r.jsx)(k.Z.TextArea,{placeholder:"Project's description",showCount:!0,maxLength:120})})]})]})};var ei=t(14670);let es={del:"Unable to delete project"},en=async(e,a,t)=>{try{await J.Z.del({id:e.id},{id:a.id});let r=e.projects.findIndex(e=>e===a.id);e.projects=[...e.projects.slice(0,r),...e.projects.slice(r+1)],t.mutateOneWorkspace(e),t.delOneProject({id:a.id})}catch(i){throw(0,w.lt)(es.del,i),i}},el=e=>{let{disabled:a,workspace:t,project:i,swr:n}=e,[l,d]=(0,s.useState)(!1);return(0,r.jsx)(H.m1,{disabled:a,loading:l,title:"Delete the project",text:(0,r.jsxs)(r.Fragment,{children:["Are you sure you want to delete the project"," ",(0,r.jsx)(o.Z.Text,{strong:!0,children:i.title}),"?",(0,r.jsx)(ei.Z,{type:"error",message:"If you delete the project, you will no longer be able to restore the archive",style:{marginTop:"16px"}})]}),async onDelete(){d(!0);try{await en(t,i,n)}finally{d(!1)}}})};var eo=t(7426),ed=t(57546),ec=t(238),eu=t(48764).lW;let ep={archive:"Unable to archive project",unarchiveServer:"Unable to unarchive project on server",deleteArchive:"Unable to delete archive",badFormat:"Bad archive format (supported format: .tanatlocarchive)",upload:"Unable to upload archive"},em=async(e,a,t)=>{try{let r=await J.Z.archive({id:a.id}),i=await r.blob(),s=window.URL.createObjectURL(new Blob([i])),n=document.createElement("a");n.href=s,n.setAttribute("download",a.id+".tanatlocarchive"),n.click(),t.mutateOneProject({...a,archived:!0}),t.mutateOneWorkspace(e)}catch(l){throw(0,w.lt)(ep.archive,l),l}},eh=async(e,a,t)=>{try{await J.Z.unarchiveFromServer({id:a.id}),t.mutateOneProject({...a,archived:!1}),t.mutateOneWorkspace(e)}catch(r){throw(0,w.lt)(ep.unarchiveServer,r),r}},eg=async e=>{try{await J.Z.deleteArchiveFile({id:e.id})}catch(a){(0,w.lt)(ep.deleteArchive,a)}},ej=async e=>{let a=new FileReader;return new Promise(t=>{a.addEventListener("load",()=>{t(a.result)}),a.readAsArrayBuffer(e)})},ex=async(e,a,t,r)=>{if("uploading"===t.file.status)return!0;if("done"===t.file.status)try{let i=await ej(t.file.originFileObj);await J.Z.unarchiveFromFile({id:a.id},eu.from(i)),r.mutateOneProject({...a,archived:!1}),r.mutateOneWorkspace(e)}catch(s){(0,w.lt)(ep.upload,s)}return!1},ey=e=>{let{disabled:a,workspace:t,project:i,swr:n}=e,[l,d]=(0,s.useState)(!1),[c,u]=(0,s.useState)(!1);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(C.ZP,{visible:l,loading:c,title:"Archive",onCancel:()=>d(!1),onOk:i.archived?void 0:async()=>{u(!0);try{await em(t,i,n),u(!1),d(!1)}catch(e){throw u(!1),e}},okButtonText:"Archive",children:i.archived?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(b.Z.Item,{label:"Restore archive from the server",tooltip:"This will restore the project from the server archive file.",children:(0,r.jsx)(L.Z,{loading:c,async onClick(){u(!0);try{await eh(t,i,n),u(!1),d(!1)}catch(e){u(!1)}},children:"Restore archive from the server"})}),(0,r.jsx)(b.Z.Item,{label:"Restore archive from local file",tooltip:"This will restore the project from your local archive file (.tanatlocarchive file).",children:(0,r.jsx)(eo.Z,{action:"/api/noop",accept:".tanatlocarchive",showUploadList:!1,async onChange(e){let a=await ex(t,i,e,n);u(a),d(a)},children:(0,r.jsx)(L.Z,{children:"Restore archive from archive file"})})}),(0,r.jsx)(b.Z.Item,{label:"Delete archive from the server",tooltip:"This will delete the archive file from the server, you will have to use a local copy to restore the project.",children:(0,r.jsx)(H.m1,{loading:c,bordered:!0,title:"Delete server archive",text:"Are you sure your want to delete the archive from the server?",onDelete:async()=>eg(i),children:"Delete server archive"})})]}):(0,r.jsxs)(o.Z.Text,{children:["An archive will be downloaded and the project will not be editable anymore, archive the project \xab",i.title,"\xbb?"]})}),(0,r.jsx)(q.Z,{title:i.archived?"Manage archive":"Archive",children:(0,r.jsx)(L.Z,{disabled:a,type:"link",icon:i.archived?(0,r.jsx)(ed.Z,{}):(0,r.jsx)(ec.Z,{}),onClick:()=>d(!0)})})]})};var ew=t(48764).lW;let ev=e=>{let{user:a,page:t,workspace:n,projects:l,organizations:d,filter:c,sorter:u,swr:p}=e,m=(0,s.useRef)(null),[h,g]=(0,s.useState)(!0),[j,x]=(0,s.useState)([]),[y,w]=(0,s.useState)(100),f=(0,i.useRouter)();(0,s.useEffect)(()=>{let e=m.current;if(!e)return;let a=e.getBoundingClientRect(),t=a.top,r=window.innerHeight,i=r-t;i!==y&&w(i)}),(0,s.useEffect)(()=>{let e=l.map(e=>{var a,t,i,s,n;let l;if(c&&!(null===(t=null===(a=e.title)||void 0===a?void 0:a.toLowerCase())||void 0===t?void 0:t.includes(c.toLowerCase())))return;l=e.archived?(0,r.jsx)(z.Z,{description:"Archived project"}):e.avatar?(0,r.jsx)("img",{src:e&&ew.from(e.avatar).toString(),alt:"Tanatloc"}):(0,r.jsx)(z.Z,{image:"images/empty.svg",description:"No preview yet."});let d=(0,r.jsxs)(U.Z,{direction:"vertical",className:"full-width text-left",children:[(0,r.jsxs)(o.Z.Text,{children:[(0,r.jsx)("b",{children:"Created:"})," ",new Date(e.createddate).toLocaleDateString()]}),(0,r.jsxs)(o.Z.Text,{children:[(0,r.jsx)("b",{children:"Last modified:"})," ",new Date(e.lastaccess).toLocaleDateString()]}),e.description&&(0,r.jsx)(o.Z.Paragraph,{ellipsis:{rows:4,tooltip:!0},children:e.description})]}),u=null==e?void 0:null===(i=e.owners)||void 0===i?void 0:i.map(e=>G.Z.userToAvatar(e)),p=null==e?void 0:null===(s=e.users)||void 0===s?void 0:s.map(e=>G.Z.userToAvatar(e)),m=null==e?void 0:null===(n=e.groups)||void 0===n?void 0:n.map(e=>G.Z.groupToAvatar(e));return{...e,snapshotRender:l,descriptionRender:d,ownersRender:u,usersRender:p,groupsRender:m}}).filter(e=>e);switch(u){case"alphaAsc":e.sort((e,a)=>e.title.localeCompare(a.title));break;case"alphaDesc":e.sort((e,a)=>-1*e.title.localeCompare(a.title));break;case"modifiedDesc":e.sort((e,a)=>new Date(a.lastaccess).getTime()-new Date(e.lastaccess).getTime())}x(e),g(!1)},[l,c,u]);let b=e=>{f.push({pathname:"/project",query:{page:t,workspaceId:n.id,projectId:e.id}})};return h||p.loadingProjects?(0,r.jsx)(v.Z.Simple,{}):j.length?(0,r.jsx)("div",{ref:m,style:{height:y},children:(0,r.jsx)(U.Z,{className:"marginBottom-20",wrap:!0,align:"start",size:20,children:j.map(e=>{var t,i,s,l;return(0,r.jsx)(Q.Z,{title:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(o.Z.Paragraph,{ellipsis:{rows:2,tooltip:!0},children:e.title}),e.archived&&(0,r.jsx)($.Z,{children:"Archived"})]}),className:"Project-Card"+(e.archived?" archive":""),cover:(0,r.jsxs)(ee.Z,{className:"Project-Carousel",dots:{className:"Project-Carousel-dots"},children:[(0,r.jsx)("div",{className:"Project-Carousel-snapshot"+(e.archived?" archive":""),onClick:()=>!e.archived&&b({id:e.id}),children:e.snapshotRender}),(0,r.jsx)("div",{className:"Project-Carousel-description"+(e.archived?" archive":""),onClick:()=>!e.archived&&b({id:e.id}),children:e.descriptionRender})]}),actions:[(0,r.jsx)(el,{disabled:!(null==e?void 0:null===(t=e.owners)||void 0===t?void 0:t.find(e=>e.id===(null==a?void 0:a.id))),workspace:{id:n.id,projects:n.projects},project:{id:e.id,title:e.title},swr:{mutateOneWorkspace:p.mutateOneWorkspace,delOneProject:p.delOneProject}},"delete"),(0,r.jsx)(ey,{disabled:!(null==e?void 0:null===(i=e.owners)||void 0===i?void 0:i.find(e=>e.id===(null==a?void 0:a.id))),workspace:{id:n.id},project:{archived:e.archived,id:e.id,title:e.title},swr:{mutateOneWorkspace:p.mutateOneWorkspace,mutateOneProject:p.mutateOneProject}},"archive"),(0,r.jsx)(Y,{disabled:!(null==e?void 0:null===(s=e.owners)||void 0===s?void 0:s.find(e=>e.id===(null==a?void 0:a.id))),project:{id:e.id,title:e.title,groups:e.groups,users:e.users},organizations:d,swr:{mutateOneProject:p.mutateOneProject},style:{buttonDark:!0}},"share"),(0,r.jsx)(er,{disabled:!(null==e?void 0:null===(l=e.owners)||void 0===l?void 0:l.find(e=>e.id===(null==a?void 0:a.id))),project:{id:e.id,title:e.title,description:e.description},swr:{mutateOneProject:p.mutateOneProject}},"edit")],children:(0,r.jsxs)("div",{style:{padding:"6px 0",display:"grid",gridTemplateColumns:"10fr 1fr 20fr",gridTemplateRows:"auto auto"},children:[(0,r.jsx)("div",{children:"Admin:"}),(0,r.jsx)("div",{}),(0,r.jsx)("div",{children:"Shared with:"}),(0,r.jsx)(R.C.Group,{maxCount:5,children:e.ownersRender}),(0,r.jsx)(Z.Z,{type:"vertical",style:{height:"80%",borderColor:"#f0f0f0"}}),(0,r.jsxs)(R.C.Group,{children:[e.usersRender,e.groupsRender]})]})},e.id)})})}):(0,r.jsx)(z.Z,{image:"images/empty.svg",className:"Project-Empty",description:c?(0,r.jsxs)(r.Fragment,{children:["No project found with the current search"," ",(0,r.jsx)("span",{className:"Project-Empty-search-value",children:c}),"..."]}):(0,r.jsx)(r.Fragment,{children:"No project for now... Get started!"})})},ef={update:"Unable to update workspace"},eZ=async(e,a,t)=>{try{let r=G.Z.deepCopy(e);e.name=a.name,await I.update({id:e.id},[{key:"name",value:a.name}]),t.mutateOneWorkspace(r)}catch(i){throw(0,w.lt)(ef.update,i),i}},eb=e=>{let{workspace:a,swr:t}=e,[i,n]=(0,s.useState)(!1),[l,o]=(0,s.useState)(!1);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(H.w6,{bordered:!0,dark:!0,onEdit:()=>n(!0)}),(0,r.jsx)(C.ZP,{visible:i,loading:l,title:"Edit the workspace",initialValues:{name:a.name},onCancel:()=>n(!1),async onOk(e){o(!0);try{await eZ(a,e,t),o(!1),n(!1)}catch(r){throw o(!1),r}},children:(0,r.jsx)(b.Z.Item,{label:"Name",name:"name",rules:[{required:!0,message:"Name is required"},{max:50,message:"Max 50 characters"}],children:(0,r.jsx)(k.Z,{placeholder:"Workspace's name"})})})]})},ek={del:"Unable to delete workspace"},eO=async(e,a)=>{try{await I.del({id:e.id}),a.delOneWorkspace({id:e.id})}catch(t){throw(0,w.lt)(ek.del,t),t}},ez=e=>{let{workspace:a,swr:t}=e,[i,n]=(0,s.useState)(!1);return(0,r.jsx)(H.m1,{bordered:!0,loading:i,text:"The projects contained in this workspace will be lost.",async onDelete(){n(!0);try{await eO(a,t)}finally{n(!1)}}})},eC={projects:"Error while loading projects",update:"Unable to update workspace"},eS=e=>{var a,t,i,l,o,d;let{user:c,page:u,workspace:p,organizations:m,swr:h}=e,[g,j]=(0,s.useState)(),[x,y]=(0,s.useState)(),[v,{addOneProject:Z,delOneProject:b,mutateOneProject:z,errorProjects:C,loadingProjects:S}]=J.Z.useProjects(null==p?void 0:p.projects);return(0,s.useEffect)(()=>{C&&(0,w.lt)(eC.projects,C)},[C]),(0,r.jsxs)(n.Z,{className:"no-scroll",children:[(0,r.jsx)(f.Z,{className:"inWorkspace-PageHeader",backIcon:!1,footer:(0,r.jsxs)(U.Z,{direction:"horizontal",size:"large",className:"full-width lastchild-marginLeft-auto",children:[(0,r.jsx)(k.Z,{placeholder:"Enter a project name (case sensitive)",value:g,onChange:e=>j(e.target.value),style:{width:500},suffix:(0,r.jsx)(D.Z,{className:"text-light"})}),(null==p?void 0:null===(a=p.owners)||void 0===a?void 0:a.find(e=>e.id===c.id))?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(K,{workspace:{id:p.id,projects:p.projects},swr:{mutateOneWorkspace:h.mutateOneWorkspace,addOneProject:Z}}),(0,r.jsxs)(U.Z,{size:8,children:[(0,r.jsx)(eb,{workspace:{id:p.id,name:p.name},swr:{mutateOneWorkspace:h.mutateOneWorkspace}}),(0,r.jsx)(Y,{workspace:{id:p.id,name:p.name,groups:p.groups,users:p.users},organizations:m,swr:{mutateOneWorkspace:h.mutateOneWorkspace},style:{buttonDark:!0,buttonBordered:!0}}),(0,r.jsx)(ez,{workspace:{id:p.id},swr:{delOneWorkspace:h.delOneWorkspace}})]})]}):(0,r.jsx)("div",{})]}),children:(null===(t=p.users)||void 0===t?void 0:t.length)||(null===(i=p.groups)||void 0===i?void 0:i.length)?(0,r.jsxs)("div",{className:"inWorkspace-shared",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"marginRight-10",children:"Admin:"}),(0,r.jsx)(R.C.Group,{maxCount:5,children:null===(l=p.owners)||void 0===l?void 0:l.map(e=>G.Z.userToAvatar(e))})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"marginRight-10",children:"Shared with:"}),(0,r.jsx)(R.C.Group,{maxCount:5,children:null===(o=p.users)||void 0===o?void 0:o.map(e=>G.Z.userToAvatar(e))}),(0,r.jsx)(R.C.Group,{maxCount:5,children:null===(d=p.groups)||void 0===d?void 0:d.map(e=>G.Z.groupToAvatar(e))})]})]}):null}),(0,r.jsx)(O.Z,{className:"inWorkspace-Tabs",items:[{key:"modifiedDesc",label:"Last modified"},{key:"alphaAsc",label:"Name (A-Z)"},{key:"alphaDesc",label:"Name (Z-A)"}],defaultActiveKey:"modifiedDesc",onChange:e=>y(e)}),(0,r.jsx)(n.Z.Content,{className:"scroll",children:(0,r.jsx)(ev,{user:c,page:u,workspace:{id:p.id,projects:p.projects},projects:v,organizations:m,filter:g,sorter:x,swr:{mutateOneWorkspace:h.mutateOneWorkspace,delOneProject:b,mutateOneProject:z,loadingProjects:S}})})]})},eP={add:"Unable to add workspace"},eN=async(e,a)=>{try{let t=await I.add(e);a.addOneWorkspace(t)}catch(r){throw(0,w.lt)(eP.add,r),r}},eT=e=>{let{swr:a}=e,[t,i]=(0,s.useState)(!1),[n,l]=(0,s.useState)(!1);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(H.HS,{onAdd:()=>l(!0),children:"Create a new workspace"}),(0,r.jsx)(C.ZP,{visible:n,loading:t,title:"Create a new workspace",onCancel:()=>l(!1),async onOk(e){i(!0);try{await eN(e,a),i(!1),l(!1)}catch(t){throw i(!1),t}},children:(0,r.jsx)(b.Z.Item,{label:"Name",name:"name",rules:[{required:!0,message:"Name is required"},{max:50,message:"Max 50 characters"}],children:(0,r.jsx)(k.Z,{placeholder:"Workspace's name"})})})]})},eE={add:"Unable to add workspace"},eA=async(e,a,t)=>{try{let r=await I.add(a);t.addOneWorkspace(r),e.push({pathname:"/dashboard",query:{page:"workspaces",workspaceId:r.id}})}catch(i){throw(0,w.lt)(eE.add,i),i}},eI=e=>{let{user:a,workspaces:t,organizations:l,swr:d}=e,[c,u]=(0,s.useState)(!1),[p,m]=(0,s.useState)(!1),h=(0,i.useRouter)(),{page:g,workspaceId:j}=h.query;return(0,r.jsxs)(n.Z,{className:"inDashboard Workspace no-scroll",children:[(0,r.jsx)(f.Z,{className:"inDashboard-PageHeader",backIcon:!1,title:(0,r.jsx)(o.Z.Title,{level:2,className:"inDashboard-PageHeader-title",children:"Workspaces"}),footer:(0,r.jsx)(Z.Z,{})}),(0,r.jsx)(n.Z.Content,{className:"no-scroll",children:t.length?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(C.ZP,{visible:c,loading:p,title:"Create a new workspace",onCancel:()=>u(!1),async onOk(e){m(!0);try{await eA(h,e,d),m(!1),u(!1)}catch(a){throw m(!1),a}},children:(0,r.jsx)(b.Z.Item,{label:"Name",name:"name",rules:[{required:!0,message:"Name is required"},{max:50,message:"Max 50 characters"}],children:(0,r.jsx)(k.Z,{placeholder:"Workspace's name"})})}),(0,r.jsx)(O.Z,{type:"editable-card",className:"inDashboard-Tabs no-scroll",items:t.map(e=>({key:e.id,label:e.name,className:"no-scroll",closable:!1,children:(0,r.jsx)(eS,{user:a,page:g||tG.workspaces.key,workspace:{id:e.id,name:e.name,projects:e.projects,owners:e.owners,users:e.users,groups:e.groups},organizations:l,swr:{delOneWorkspace:d.delOneWorkspace,mutateOneWorkspace:d.mutateOneWorkspace}})})),defaultActiveKey:j||"1",onEdit:()=>u(!0)})]}):(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(z.Z,{image:"images/empty.svg",description:"No workspace for now. Get started !",children:(0,r.jsx)(eT,{swr:{addOneWorkspace:d.addOneWorkspace}})})})})]})};var eU=t(87547),eR=t(88484),eD=t(4415),eF=t(55734),eq=t(5094),eL=t(48764).lW;let eW={update:"Unable to update informations",upload:"Unable to upload image",badFormat:"Supported formats: jpg, png",badSize:"Image must be smaller than 5MB"},eH=e=>{let a="image/jpeg"===e.type||"image/png"===e.type;a||(0,w.lt)(eW.badFormat);let t=e.size/1024/1024<1;return t||(0,w.lt)(eW.badSize),a&&t},eG=async e=>{let a=new FileReader;return new Promise(t=>{a.addEventListener("load",()=>{t(a.result)}),a.readAsDataURL(e)})},eJ=async(e,a,t)=>{if("uploading"===a.file.status)return!0;if("done"!==a.file.status)return!1;try{let r=await eG(a.file.originFileObj);await eq.Z.add({name:a.file.name,uid:a.file.uid,data:r}),t.mutateUser({...e,avatar:eL.from(r)})}catch(i){(0,w.lt)(eW.upload,i)}return!1},eM=async(e,a,t)=>{try{let r=[];if(e.email!==a.email&&r.push({key:"email",value:a.email}),e.firstname!==a.firstname&&r.push({key:"firstname",value:a.firstname}),e.lastname!==a.lastname&&r.push({key:"lastname",value:a.lastname}),!r.length)return;await eF.Z.update(r),t.mutateUser({email:a.email,firstname:a.firstname,lastname:a.lastname}),r.find(e=>"email"===e.key)&&(0,w.Ur)("Changes saved","A validation email has been send to "+a.email)}catch(i){throw new eD.H({title:eW.update,err:i})}},e_=e=>{let{user:a,swr:t}=e,[i,n]=(0,s.useState)(!1),[l,o]=(0,s.useState)(!1),[d,c]=(0,s.useState)();return(0,r.jsx)(Q.Z,{title:"Contact Details",children:(0,r.jsxs)(U.Z,{direction:"horizontal",className:"Account-Information",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)(R.C,{size:128,src:a.avatar&&eL.from(a.avatar).toString(),icon:(0,r.jsx)(eU.Z,{})}),(0,r.jsx)(eo.Z,{action:"/api/noop",accept:".jpg,.png",showUploadList:!1,beforeUpload:eH,async onChange(e){let r=await eJ(a,e,t);n(r)},children:(0,r.jsx)(L.Z,{loading:i,icon:(0,r.jsx)(eR.Z,{}),children:"Upload new"})})]}),(0,r.jsx)("div",{children:(0,r.jsxs)(b.Z,{labelCol:{span:4},className:"max-width-500",initialValues:{email:a.email,firstname:a.firstname||"",lastname:a.lastname||""},async onFinish(e){o(!0);try{await eM(a,e,t),c(null)}catch(r){c(r)}finally{o(!1)}},children:[(0,r.jsx)(b.Z.Item,{label:"Email",name:"email",rules:[x()()?{type:"email",message:"This is not a valid email"}:void 0,{max:50,message:"Max 50 characters"}].filter(e=>e),children:(0,r.jsx)(k.Z,{disabled:x()()})}),(0,r.jsx)(b.Z.Item,{label:"First name",name:"firstname",rules:[{max:50,message:"Max 50 characters"}],children:(0,r.jsx)(k.Z,{})}),(0,r.jsx)(b.Z.Item,{label:"Last name",name:"lastname",rules:[{max:50,message:"Max 50 characters"}],children:(0,r.jsx)(k.Z,{})}),(0,r.jsx)(w.Xq,{error:d}),(0,r.jsx)(b.Z.Item,{wrapperCol:{offset:4},children:(0,r.jsx)(L.Z,{loading:l,type:"primary",htmlType:"submit",children:"Save changes"})})]})})]})})};var eB=t(47455);let eY={check:"Unable to check password",update:"Unable to update password",passwordMismatch:"Password and confirmation mismatch",invalid:"Current password is not valid"},eV=async(e,a)=>{let t;try{t=await eF.Z.check({email:e.email,password:a.password})}catch(r){throw new eD.H({title:eY.check,err:r})}if(!t.valid)throw new eD.H({title:eY.invalid});try{await eF.Z.update([{type:"crypt",key:"password",value:a.newPassword}]),(0,w.Ur)("Your password has been changed successfully")}catch(i){throw new eD.H({title:eY.update,err:i})}},eX=e=>{let{user:a}=e,[t,i]=(0,s.useState)(!1),[n,l]=(0,s.useState)();return(0,r.jsx)(Q.Z,{title:"Your Password",children:(0,r.jsxs)(b.Z,{labelCol:{offset:2},wrapperCol:{offset:2},className:"max-width-500",layout:"vertical",async onFinish(e){i(!0);try{await eV(a,e),l(null)}catch(t){l(t)}finally{i(!1)}},name:"passwordForm",children:[(0,r.jsx)(b.Z.Item,{label:"Current password",name:"password",rules:[{required:!0,message:"Current password is required"}],children:(0,r.jsx)(k.Z.Password,{placeholder:"Current password"})}),(0,r.jsx)(eB.o,{name:"newPassword",label:"New password",inputPlaceholder:"Enter a new password",required:!0}),(0,r.jsx)(b.Z.Item,{label:"Password confirmation",name:"passwordConfirm",rules:[{required:!0,message:"Password confirmation is required"},e=>{let{getFieldValue:a}=e;return{validator:(e,t)=>t&&a("newPassword")!==t?Promise.reject(eY.passwordMismatch):Promise.resolve()}}],children:(0,r.jsx)(k.Z.Password,{placeholder:"Confirm your new password"})}),(0,r.jsx)(w.Xq,{error:n}),(0,r.jsx)(b.Z.Item,{children:(0,r.jsx)(U.Z,{children:(0,r.jsx)(L.Z,{type:"primary",htmlType:"submit",loading:t,children:"Modify password"})})})]})})},eK=x()()?"http://localhost:3000":"",eQ=async()=>{await fetch(eK+"/api/logout")},e$={del:"Unable to delete user"},e0=async e=>{try{await eF.Z.del(),await eQ(),e.clearUser()}catch(a){throw(0,w.lt)(e$.del,a),a}},e1=e=>{let{swr:a}=e,[t,i]=(0,s.useState)(!1);return(0,r.jsx)(Q.Z,{title:"Delete your account",children:(0,r.jsx)(H.m1,{title:"Delete your account",text:"This action cannot be undone. If you delete your account, you will permanently lose your workspaces and projects.",bordered:!0,loading:t,async onDelete(){i(!0);try{await e0(a)}finally{i(!1)}},children:"Delete your account"})})};var e5=t(11382),e2=t(10843),e4=t(40038),e6=t(25935),e8=t(71270);let e7={update:"Unable to update plugins"},e9=(e,a)=>(0,r.jsx)(b.Z.Item,{name:a,label:e.label,htmlFor:"input-"+a,tooltip:e.tooltip,rules:e.rules,children:(0,r.jsx)(k.Z,{id:"input-"+a,autoComplete:"off",...e.props||{}})},e.label),e3=(e,a)=>(0,r.jsx)(b.Z.Item,{name:a,label:e.label,htmlFor:"input-"+a,tooltip:e.tooltip,rules:e.rules,children:(0,r.jsx)(k.Z.TextArea,{id:"input-"+a,autoComplete:"off",...e.props||{}})},e.label),ae=(e,a)=>(0,r.jsx)(b.Z.Item,{name:a,label:e.label,htmlFor:"input-"+a,tooltip:e.tooltip,rules:e.rules,children:(0,r.jsx)(k.Z,{id:"input-"+a,type:"password",autoComplete:"off",...e.props||{}})},e.label),aa=(e,a)=>(0,r.jsx)(b.Z.Item,{name:a,label:e.label,htmlFor:"select-"+a,tooltip:e.tooltip,rules:e.rules,children:(0,r.jsx)(e4.Z,{id:"select-"+a,children:e.options.map(a=>(0,r.jsx)(e4.Z.Option,{value:a,...e.props||{},children:a},a))})},e.label),at=async(e,a,t,r)=>{try{var i,s;if(a){let n=G.Z.deepCopy(e);Object.keys(t).forEach(e=>{n.configuration[e].value=t[e]}),n.needReInit=!0,await e8.Z.update(n),null===(i=r.mutateOnePlugin)||void 0===i||i.call(r,n)}else{let l=G.Z.deepCopy(e);Object.keys(t).forEach(e=>{l.configuration[e].value=t[e]}),await e8.Z.add(l),null===(s=r.addOnePlugin)||void 0===s||s.call(r,l)}}catch(o){throw(0,w.lt)(e7.update,o),o}},ar=e=>{let{plugin:a,swr:t,edit:i}=e,[n,l]=(0,s.useState)(!1),[d,c]=(0,s.useState)(!1),[u,p]=(0,s.useState)({});return(0,s.useEffect)(()=>{let e={};Object.keys(a.configuration).forEach(t=>{var r;e[t]=null!==(r=a.configuration[t].value)&&void 0!==r?r:a.configuration[t].default}),p(e)},[null==a?void 0:a.configuration]),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(C.ZP,{title:a.name,visible:n,initialValues:u,onCancel:()=>l(!1),async onOk(e){c(!0);try{await at(a,!!i,e,t),c(!1),l(!1)}catch(r){throw c(!1),r}},loading:d,children:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(o.Z.Text,{children:(0,e6.ZP)(a.description||"")}),Object.keys(a.configuration).map(e=>{let t=a.configuration[e];return"input"===t.type?e9(t,e):"textarea"===t.type?e3(t,e):"password"===t.type?ae(t,e):"select"===t.type?aa(t,e):(0,r.jsx)(r.Fragment,{})})]})}),i?(0,r.jsx)(H.w6,{onEdit:()=>l(!0),children:"Edit"}):(0,r.jsxs)(H.HS,{onAdd:()=>l(!0),children:["Add a new \xab",a.name,"\xbb configuration"]})]})},ai={del:"Unable to delete plugin"},as=async(e,a)=>{try{await e8.Z.del({uuid:e.uuid}),a.delOnePlugin(e)}catch(t){throw(0,w.lt)(ai.del,t),t}},an=e=>{var a;let{plugin:t,swr:i}=e,[n,l]=(0,s.useState)(!1);return(0,r.jsx)(H.m1,{loading:n,title:"Delete plugin",text:(0,r.jsxs)(r.Fragment,{children:["Are you sure you want to delete the plugin"," ",(0,r.jsx)(o.Z.Text,{strong:!0,children:null===(a=t.configuration.name)||void 0===a?void 0:a.value}),"?"]}),async onDelete(){l(!0);try{await as(t,i)}finally{l(!1)}},children:"Delete"})},al=e=>{let{plugin:a,plugins:t,swr:i}=e,[n,l]=(0,s.useState)([]);return(0,s.useEffect)(()=>{let e=t.map(e=>{var t;if(e.key!==a.key)return;let s=e.configuration,n=Object.keys(s).map(e=>{let a;if("name"!==e){if("textarea"===s[e].type){let t=s[e].value;a=(0,r.jsx)(o.Z.Paragraph,{children:(0,r.jsx)("pre",{children:(0,r.jsx)("code",{children:t})})})}else a="password"===s[e].type?(0,r.jsx)(o.Z.Text,{children:"******"}):(0,r.jsx)(o.Z.Text,{children:s[e].value||"unset"});return(0,r.jsxs)(o.Z.Paragraph,{children:[(0,r.jsxs)(o.Z.Text,{strong:!0,children:[s[e].label,":"]})," ",a]},e)}}).filter(e=>e);return(0,r.jsx)(Q.Z,{title:null===(t=s.name)||void 0===t?void 0:t.value,actions:[(0,r.jsx)(an,{plugin:{uuid:e.uuid,configuration:e.configuration},swr:{delOnePlugin:i.delOnePlugin}},"delete"),(0,r.jsx)(ar,{plugin:{uuid:e.uuid,key:e.key,name:e.name,needInit:e.needInit,configuration:e.configuration,inUseConfiguration:e.inUseConfiguration},swr:{mutateOnePlugin:i.mutateOnePlugin},edit:!0},"plugin")],children:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(o.Z.Text,{children:(0,e6.ZP)(e.description||"")}),n.length?n:(0,r.jsx)(o.Z.Text,{children:"No configuration data"})]})},e.uuid)}).filter(e=>e);l(e)},[a,t,i]),(0,r.jsx)(U.Z,{direction:"horizontal",wrap:!0,size:20,children:n})},ao={plugins:"Error while loading plugins"},ad=e=>{let{plugin:a}=e,[t,{addOnePlugin:i,delOnePlugin:n,mutateOnePlugin:l,errorPlugins:o,loadingPlugins:d}]=e8.Z.usePlugins();return((0,s.useEffect)(()=>{o&&(0,w.lt)(ao.plugins,o)},[o]),d)?(0,r.jsx)(e5.Z,{}):(0,r.jsxs)(U.Z,{direction:"vertical",className:"full-width",children:[(0,r.jsx)(ar,{plugin:{uuid:a.uuid,key:a.key,name:a.name,description:a.description,needInit:a.needInit,configuration:a.configuration,inUseConfiguration:a.inUseConfiguration},swr:{addOnePlugin:i}}),(0,r.jsx)(al,{plugin:{key:a.key},plugins:t,swr:{delOnePlugin:n,mutateOnePlugin:l}})]})},ac={plugins:"Unable to load plugins"},au=async()=>{try{let e=await e2.Z.list(),a=e.filter(e=>"HPC"===e.category);if(a.length)return a.map(e=>(0,r.jsx)(Q.Z,{title:e.name,children:(0,r.jsx)(ad,{plugin:{key:e.key,name:e.name,description:e.description,needInit:!!e.needInit,configuration:e.configuration,inUseConfiguration:e.inUseConfiguration}})},e.key));return[(0,r.jsx)(Q.Z,{title:"No access",children:"You do not have access to any HPC plugin. Request it."},"no-access")]}catch(t){return(0,w.lt)(ac.plugins,t),[(0,r.jsx)(Q.Z,{title:"Error",children:"Something led to an error. Please try again later."},"error")]}},ap=()=>{let[e,a]=(0,s.useState)([(0,r.jsx)(Q.Z,{title:"Loading",children:(0,r.jsx)(e5.Z,{})},"loading")]);return(0,s.useEffect)(()=>{au().then(a)},[]),(0,r.jsx)(U.Z,{direction:"vertical",className:"full-width scroll",size:20,children:e})},am=(e,a)=>{e.replace({pathname:"/dashboard",query:{page:"account",tab:a}})},ah=e=>{let{user:a,swr:t}=e,s=(0,i.useRouter)(),{tab:l}=s.query,d=[];return d.push({key:"personal",label:"Personal Information",children:(0,r.jsxs)(U.Z,{direction:"vertical",className:"full-width",size:20,children:[(0,r.jsx)(e_,{user:{email:a.email,firstname:a.firstname,lastname:a.lastname,avatar:a.avatar},swr:{mutateUser:t.mutateUser}}),!x()()&&(0,r.jsx)(e1,{swr:{clearUser:t.clearUser}})]})}),x()()||d.push({key:"security",label:"Security",children:(0,r.jsx)(U.Z,{direction:"vertical",className:"full-width",size:20,children:(0,r.jsx)(eX,{user:{email:a.email}})})}),d.push({key:"hpc",label:"HPC Providers",children:(0,r.jsx)(ap,{})}),(0,r.jsxs)(n.Z,{className:"inDashboard Account no-scroll",children:[(0,r.jsx)(f.Z,{className:"inDashboard-PageHeader",backIcon:!1,title:(0,r.jsx)(o.Z.Title,{level:2,className:"inDashboard-PageHeader-title",children:"Account Settings"}),footer:(0,r.jsx)(Z.Z,{})}),(0,r.jsx)(n.Z.Content,{className:"no-scroll",children:(0,r.jsx)(O.Z,{className:"inDashboard-Tabs no-scroll",type:"card",items:d,defaultActiveKey:l||"personal",onChange:e=>am(s,e)})})]})};var ag=t(12157);let aj=()=>{let{data:e,error:a,mutate:t}=(0,S.ZP)("/api/organizations",P._),r=(null==e?void 0:e.organizations)||[],i=(0,s.useCallback)(e=>{let a=[...r,{...e,pendingowners:[],users:[],pendingusers:[],groups:[]}];t({organizations:a})},[r,t]),n=(0,s.useCallback)(e=>{let a=r.filter(a=>a.id!==e.id);t({organizations:a})},[r,t]),l=(0,s.useCallback)(e=>{let a=r.map(a=>(a.id===e.id&&(a={...a,...e}),a));t({organizations:a})},[r,t]);return[r,{addOneOrganization:i,delOneOrganization:n,mutateOneOrganization:l,errorOrganizations:a,loadingOrganizations:!e}]},ax=async e=>{let a=await (0,P.R)("/api/organization",{method:"POST",headers:{Accept:"application/json"},body:JSON.stringify(e)});return a.json()},ay=async(e,a)=>{await (0,P.R)("/api/organization",{method:"PUT",body:JSON.stringify({organization:e,data:a})})},aw=async e=>{await (0,P.R)("/api/organization",{method:"DELETE",body:JSON.stringify(e)})},av=async e=>{await (0,P.R)("/api/organization/"+e.id,{method:"PUT"})},af=async e=>{await (0,P.R)("/api/organization/"+e.id,{method:"POST"})},aZ=async e=>{await (0,P.R)("/api/organization/"+e.id,{method:"DELETE"})};var ab={useOrganizations:aj,add:ax,update:ay,del:aw,accept:av,decline:af,quit:aZ},ak=t(69317);let aO={add:"Unable to add user",existing:"This user already exists or its invite is pending"},az=(e,a)=>{var t,r,i,s;let n=null===(t=a.owners)||void 0===t?void 0:t.find(a=>a.email===e.email),l=null===(r=a.pendingowners)||void 0===r?void 0:r.find(a=>a.email===e.email),o=null===(i=a.users)||void 0===i?void 0:i.find(a=>a.email===e.email),d=null===(s=a.pendingusers)||void 0===s?void 0:s.find(a=>a.email===e.email);return n||l||o||d},aC=async(e,a,t,r)=>{let i=az(t,e);if(i)throw(0,w.lt)(aO.existing),Error(aO.existing);try{await ab.update(e,[{key:a,type:"array",method:"append",value:t.email.trim()}]);let s=G.Z.deepCopy(e);s[a]=[...s[a],{email:t.email}],r.mutateOneOrganization(s)}catch(n){throw(0,w.lt)(aO.add,n),n}},aS=e=>{let{title:a,organization:t,dBkey:i,swr:n}=e,[l,o]=(0,s.useState)(!1),[d,c]=(0,s.useState)(!1);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(C.ZP,{visible:l,loading:d,title:a,onCancel:()=>o(!1),async onOk(e){c(!0);try{await aC(t,i,e,n),c(!1),o(!1)}catch(a){throw c(!1),a}},children:(0,r.jsx)(b.Z.Item,{name:"email",label:"Email",rules:[{required:!0,message:"Email is required"}],children:(0,r.jsx)(k.Z,{})})}),(0,r.jsx)(H.HS,{onAdd:()=>o(!0),children:a})]})},aP={del:"Unable to delete user"},aN=async(e,a,t,r)=>{try{await ab.update(e,[{key:t,type:"array",method:"remove",value:a.id}]);let i=G.Z.deepCopy(e);i[t]=i[t].filter(e=>e.id!==a.id),r.mutateOneOrganization(i)}catch(s){throw(0,w.lt)(aP.del,s),s}},aT=e=>{let{disabled:a,user:t,organization:i,dBkey:n,swr:l}=e,[d,c]=(0,s.useState)(!1),u=(0,s.useCallback)(e=>e.firstname||e.lastname?e.firstname+" "+e.lastname:e.email,[]);return(0,r.jsx)(H.m1,{bordered:!0,disabled:a,title:"Delete organization",text:(0,r.jsxs)(r.Fragment,{children:["Are you sure you want to delete the user"," ",(0,r.jsx)(o.Z.Text,{strong:!0,children:u(t)}),"?"]}),loading:d,async onDelete(){c(!0);try{await aN(i,t,n,l)}finally{c(!1)}}})},aE=e=>{var a,t,i;let{organization:n,swr:l}=e,[o,d]=(0,s.useState)(),[c,u]=(0,s.useState)(),p=(0,s.useRef)(null),m=(0,s.useRef)(null),h=(0,s.useRef)(null),g=(e,a)=>G.Z.userToAvatar(a),j=e=>(0,r.jsx)(aT,{disabled:n.owners.length<2&&!e.pending,user:{id:e.id,email:e.email},organization:{id:n.id,owners:n.owners,pendingowners:n.pendingowners,users:n.users,pendingusers:n.pendingusers},dBkey:e.pending?"pendingowners":"owners",swr:{mutateOneOrganization:l.mutateOneOrganization}}),x=e=>(0,r.jsx)(aT,{user:{id:e.id,email:e.email,firstname:e.firstname,lastname:e.lastname},organization:{id:n.id,owners:n.owners,pendingowners:n.pendingowners,users:n.users,pendingusers:n.pendingusers},dBkey:e.pending?"pendingusers":"users",swr:{mutateOneOrganization:l.mutateOneOrganization}}),y=[{key:"avatar",dataIndex:"avatar",render:g},{key:"lastname",title:"Lastname",dataIndex:"lastname"},{key:"firstname",title:"Firstname",dataIndex:"firstname"},{key:"email",title:"Email",dataIndex:"email"}],w=[...y,{key:"actions",title:"Actions",align:"center",fixed:"right",width:75,render:j}],v=[...y,{key:"actions",title:"Actions",align:"center",fixed:"right",width:75,render:x}],f=(0,s.useCallback)(()=>{let e=p.current;if(!e)return;let a=e.clientHeight-15,t=a/2-39-12-32-20-75,r=e.clientHeight,i=e.clientHeight;r>t?d({y:t}):d(void 0),i>t?u({y:t}):u(void 0)},[]);return(0,s.useEffect)(()=>(window.addEventListener("resize",f),()=>{window.removeEventListener("resize",f)}),[f]),(0,s.useEffect)(()=>{f()},[n,f]),(0,r.jsx)("div",{ref:p,style:{height:"calc(100vh - 228px)"},children:(0,r.jsxs)(U.Z,{direction:"vertical",className:"full-width",size:20,children:[(0,r.jsx)(Q.Z,{title:"Administrators",size:"small",children:(0,r.jsxs)(U.Z,{direction:"vertical",className:"full-width",size:20,children:[(0,r.jsx)(aS,{title:"New administrator",organization:{id:n.id,owners:n.owners,pendingowners:n.pendingowners,pendingusers:n.pendingusers,users:n.users},dBkey:"owners",swr:{mutateOneOrganization:l.mutateOneOrganization}}),(0,r.jsx)(ak.Z,{loading:l.loadingOrganizations,pagination:!1,size:"small",columns:w,dataSource:[...n.owners.map(e=>({...e,key:e.id})),...null===(a=n.pendingowners)||void 0===a?void 0:a.map(e=>({...e,pending:!0,key:e.id}))],scroll:{y:null==o?void 0:o.y},ref:m})]})}),(0,r.jsx)(Q.Z,{title:"Users",size:"small",children:(0,r.jsxs)(U.Z,{direction:"vertical",className:"full-width",size:20,children:[(0,r.jsx)(aS,{title:"New user",organization:{id:n.id,owners:n.owners,pendingowners:n.pendingowners,pendingusers:n.pendingusers,users:n.users},dBkey:"users",swr:{mutateOneOrganization:l.mutateOneOrganization}}),(0,r.jsx)(ak.Z,{loading:null==l?void 0:l.loadingOrganizations,pagination:!1,size:"small",columns:v,dataSource:[...null===(t=n.users)||void 0===t?void 0:t.map(e=>({...e,key:e.id})),...null===(i=n.pendingusers)||void 0===i?void 0:i.map(e=>({...e,pending:!0,key:e.id}))],scroll:{y:null==c?void 0:c.y},ref:h})]})})]})})},aA=e=>{let{data:a,error:t,mutate:r}=(0,S.ZP)("/api/groups/"+e,P._),i=(null==a?void 0:a.groups)||[],n=(0,s.useCallback)(e=>{let a=[...i,e];r({groups:a})},[i,r]),l=(0,s.useCallback)(e=>{let a=i.filter(a=>a.id!==e.id);r({groups:a})},[i,r]),o=(0,s.useCallback)(e=>{let a=i.map(a=>(a.id===e.id&&(a={...a,...e}),a));r({groups:a})},[i,r]);return[i,{addOneGroup:n,delOneGroup:l,mutateOneGroup:o,errorGroups:t,loadingGroups:!a}]},aI=async(e,a)=>{let t=await (0,P.R)("/api/group",{method:"POST",body:JSON.stringify({organization:e,group:a})});return t.json()},aU=async(e,a)=>{await (0,P.R)("/api/group",{method:"PUT",body:JSON.stringify({group:e,data:a})})},aR=async e=>{await (0,P.R)("/api/group",{method:"DELETE",body:JSON.stringify(e)})};var aD={useGroups:aA,add:aI,update:aU,del:aR};let aF={del:"Unable to delete group"},aq=async(e,a)=>{try{await aD.del({id:e.id}),a.delOneGroup({id:e.id})}catch(t){throw(0,w.lt)(aF.del,t),t}},aL=e=>{let{group:a,swr:t}=e,[i,n]=(0,s.useState)(!1);return(0,r.jsx)(H.m1,{bordered:!0,title:"Delete group",text:(0,r.jsxs)(r.Fragment,{children:["Are you sure you want to delete the group"," ",(0,r.jsx)(o.Z.Text,{strong:!0,children:a.name}),"?"]}),loading:i,async onDelete(){n(!0);try{await aq(a,t)}finally{n(!1)}}})},aW={add:"Unable to add group",update:"Unable to update group"},aH=async(e,a,t)=>{try{let r=await aD.add({id:e.id},{name:a.name,users:a.users});t.addOneGroup({...r,name:a.name,users:a.users}),t.mutateOneOrganization({id:e.id,groups:[...e.groups,r]})}catch(i){throw(0,w.lt)(aW.add,i),i}},aG=async(e,a,t,r)=>{try{var i,s,n,l;let o=[];if(a.name!==t.name&&o.push({key:"name",value:t.name}),(null===(i=a.users)||void 0===i?void 0:i.map(e=>e.id).toString())!==t.users.toString()&&o.push({key:"users",value:t.users}),!o.length)return;await aD.update({id:a.id},o),r.mutateOneGroup({...a,...t});let d=null===(s=e.groups)||void 0===s?void 0:s.findIndex(e=>e.id===a.id);r.mutateOneOrganization({id:e.id,groups:[...null===(n=e.groups)||void 0===n?void 0:n.slice(0,d),a,...null===(l=e.groups)||void 0===l?void 0:l.slice(d+1)]})}catch(c){throw(0,w.lt)(aW.update,c),c}},aJ=e=>{var a;let{userOptions:t,organization:i,group:n,swr:l}=e,[o,d]=(0,s.useState)(!1),[c,u]=(0,s.useState)(!1);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(C.ZP,{title:n?"Edit group":"New group",visible:o,initialValues:n&&{name:n.name,users:null===(a=n.users)||void 0===a?void 0:a.map(e=>e.id)},onCancel:()=>d(!1),async onOk(e){u(!0);try{n?await aG(i,n,e,{mutateOneOrganization:l.mutateOneOrganization,mutateOneGroup:l.mutateOneGroup}):await aH(i,e,{mutateOneOrganization:l.mutateOneOrganization,addOneGroup:l.addOneGroup}),u(!1),d(!1)}catch(a){throw u(!1),a}},loading:c,children:[(0,r.jsx)(b.Z.Item,{name:"name",label:"Name",rules:[{required:!0,message:"Name is requried"}],children:(0,r.jsx)(k.Z,{})}),(0,r.jsx)(b.Z.Item,{name:"users",label:"Users",rules:[{required:!0,message:"Users selection is required"}],children:(0,r.jsx)(e4.Z,{mode:"multiple",placeholder:"Select users",options:t})})]}),n?(0,r.jsx)(H.w6,{bordered:!0,onEdit:()=>d(!0),children:"Edit"}):(0,r.jsx)(H.HS,{onAdd:()=>d(!0),children:"New group"})]})},aM={groups:"Error while loading groups"},a_=e=>{let{organization:a,swr:t}=e,[i,n]=(0,s.useState)([]),[l,o]=(0,s.useState)(null),d=(0,s.useRef)(null),[c,{addOneGroup:u,mutateOneGroup:p,delOneGroup:m,errorGroups:h,loadingGroups:g}]=aD.useGroups(a.id);(0,s.useEffect)(()=>{let e=a.owners,t=null==a?void 0:a.users,r=[...e,...t],i=r.map(e=>({label:e.firstname||e.lastname?e.firstname+" "+e.lastname:e.email,value:e.id}));n(i)},[a]),(0,s.useEffect)(()=>{h&&(0,w.lt)(aM.groups,h)},[h]);let j=e=>(0,r.jsx)(R.C.Group,{maxCount:5,children:e.map(e=>G.Z.userToAvatar(e))}),x=(e,s)=>(0,r.jsxs)(U.Z,{children:[(0,r.jsx)(aJ,{userOptions:i,organization:{id:a.id,groups:a.groups},group:{id:s.id,name:s.name,users:s.users},swr:{mutateOneOrganization:t.mutateOneOrganization,mutateOneGroup:p}}),(0,r.jsx)(aL,{group:{id:s.id,name:s.name},swr:{delOneGroup:m}})]}),y=(0,s.useCallback)(()=>{let e=d.current;e&&(e.clientHeight>window.innerHeight-e.offsetTop-59?o({y:window.innerHeight-e.offsetTop-59}):o(null))},[]);return(0,s.useEffect)(()=>(window.addEventListener("resize",y),()=>{window.removeEventListener("resize",y)}),[y]),(0,s.useEffect)(()=>{y()},[c,y]),(0,r.jsxs)(U.Z,{direction:"vertical",className:"full-width",size:20,children:[(0,r.jsx)(aJ,{userOptions:i,organization:{id:a.id,groups:a.groups},swr:{mutateOneOrganization:t.mutateOneOrganization,addOneGroup:u}}),(0,r.jsx)(ak.Z,{loading:g,pagination:!1,size:"small",columns:[{title:"Group name",dataIndex:"name",key:"name"},{title:"Users",dataIndex:"users",key:"users",render:j},{title:"Actions",key:"actions",render:x}],dataSource:c.map(e=>({key:e.id,...e})),scroll:{y:null==l?void 0:l.y},ref:d})]})},aB={name:"Unable to update organization's name"},aY=async(e,a,t)=>{try{await ab.update(e,[{key:"name",value:a}]),t.mutateOneOrganization({...e,name:a})}catch(r){(0,w.lt)(aB.name,r)}},aV=e=>{let{organization:a,swr:t,onClose:i}=e;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"display-flex",children:[(0,r.jsx)(L.Z,{className:"marginRight-20",icon:(0,r.jsx)(ag.Z,{}),onClick:()=>i()}),(0,r.jsx)(o.Z.Title,{level:3,editable:{onChange:async e=>aY(a,e,{mutateOneOrganization:t.mutateOneOrganization})},children:a.name})]}),(0,r.jsx)(O.Z,{items:[{key:"users",label:"Users",children:(0,r.jsx)(aE,{organization:{id:a.id,owners:a.owners,pendingowners:a.pendingowners,users:a.users,pendingusers:a.pendingusers},swr:{mutateOneOrganization:t.mutateOneOrganization,loadingOrganizations:t.loadingOrganizations}})},{key:"groups",label:"Groups",children:(0,r.jsx)(a_,{organization:{id:a.id,owners:a.owners,users:a.users,groups:a.groups},swr:{mutateOneOrganization:t.mutateOneOrganization}})}]})]})},aX={add:"Unable to add organization"},aK=async(e,a)=>{try{let t=await ab.add({name:e.name});t.name=e.name,a.addOneOrganization(t)}catch(r){throw(0,w.lt)(aX.add,r),r}},aQ=e=>{let{swr:a}=e,[t,i]=(0,s.useState)(!1),[n,l]=(0,s.useState)(!1);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(C.ZP,{title:"New organization",visible:t,onCancel:()=>i(!1),async onOk(e){l(!0);try{await aK(e,a),l(!1),i(!1)}catch(t){throw l(!1),t}},loading:n,children:(0,r.jsx)(b.Z.Item,{name:"name",label:"Name",rules:[{required:!0,message:"Name is required"}],children:(0,r.jsx)(k.Z,{})})}),(0,r.jsx)(H.HS,{onAdd:()=>i(!0),children:"New organization"})]})};var a$=t(75768),a0=t(40695),a1=t(31662);let a5={del:"Unable to delete organization"},a2=async(e,a)=>{try{await ab.del({id:e.id}),a.delOneOrganization({id:e.id})}catch(t){throw(0,w.lt)(a5.del,t),t}},a4=e=>{let{organization:a,swr:t}=e,[i,n]=(0,s.useState)(!1);return(0,r.jsx)(H.m1,{bordered:!0,title:"Delete organization",text:(0,r.jsxs)(r.Fragment,{children:["Are you sure you want to delete the organization"," ",(0,r.jsx)(o.Z.Text,{strong:!0,children:a.name}),"?"]}),async onDelete(){n(!0);try{await a2(a,t)}finally{n(!1)}},loading:i})},a6={quit:"Unable to quit organization",accept:"Unable to accept invitation",decline:"Unable to decline invitation"},a8=async(e,a,t)=>{try{await ab.quit({id:e.id});let r=G.Z.deepCopy(e),i=r.users.findIndex(e=>e.id===a.id);r.users.splice(i,1),t.mutateOneOrganization(r)}catch(s){(0,w.lt)(a6.quit,s)}},a7=async(e,a,t)=>{try{await ab.accept(e);let r=G.Z.deepCopy(e),i=r.pendingowners.findIndex(e=>e.id===a.id),s=r.pendingowners[i];if(-1!==i)r.pendingowners.splice(i,1),r.owners.push(s);else{let n=r.pendingusers.findIndex(e=>e.id===a.id),l=r.pendingusers[n];r.pendingusers.splice(n,1),r.users.push(l)}t.mutateOneOrganization(r)}catch(o){(0,w.lt)(a6.accept,o)}},a9=async(e,a,t)=>{try{var r,i;await ab.decline({id:e.id});let s=G.Z.deepCopy(e),n=null===(r=s.pendingowners)||void 0===r?void 0:r.findIndex(e=>e.id===a.id);if(-1!==n)s.pendingowners.splice(n,1);else{let l=null===(i=s.pendingusers)||void 0===i?void 0:i.findIndex(e=>e.id===a.id);s.pendingusers.splice(l,1)}t.mutateOneOrganization(s)}catch(o){(0,w.lt)(a6.decline,o)}},a3=e=>{var a;let{user:t,organizations:i,swr:n,setOrganization:l}=e,[o,d]=(0,s.useState)(null),c=(0,s.useRef)(null),u=e=>(0,r.jsx)(R.C.Group,{maxCount:5,children:null==e?void 0:e.map(e=>G.Z.userToAvatar(e))}),m=e=>(0,r.jsx)(R.C.Group,{maxCount:5,children:null==e?void 0:e.map(e=>G.Z.userToAvatar(e))}),h=e=>(0,r.jsx)(R.C.Group,{maxCount:5,children:null==e?void 0:e.map(e=>G.Z.groupToAvatar(e))}),g=e=>e.owners.find(e=>e.id===t.id)?(0,r.jsxs)(U.Z,{wrap:!0,children:[(0,r.jsx)(L.Z,{icon:(0,r.jsx)(p.Z,{}),onClick:()=>l(e),children:"Manage"}),(0,r.jsx)(a4,{organization:{id:e.id,name:e.name},swr:{delOneOrganization:n.delOneOrganization}})]}):e.users.find(e=>e.id===t.id)?(0,r.jsx)(U.Z,{wrap:!0,children:(0,r.jsx)(L.Z,{danger:!0,icon:(0,r.jsx)(a$.Z,{}),onClick:()=>a8({id:e.id,users:e.users},{id:t.id},{mutateOneOrganization:n.mutateOneOrganization}),children:"Quit"})}):e.pendingowners.find(e=>e.id===t.id)||e.pendingusers.find(e=>e.id===t.id)?(0,r.jsxs)(U.Z,{wrap:!0,children:[(0,r.jsx)(L.Z,{type:"primary",icon:(0,r.jsx)(a0.Z,{}),onClick:async()=>a7({id:e.id,owners:e.owners,pendingowners:e.pendingowners,users:e.users,pendingusers:e.pendingusers},{id:t.id},{mutateOneOrganization:n.mutateOneOrganization}),children:"Accept invitation"}),(0,r.jsx)(L.Z,{danger:!0,icon:(0,r.jsx)(a1.Z,{}),onClick:()=>a9({id:e.id,pendingowners:e.pendingowners,pendingusers:e.pendingusers},{id:t.id},{mutateOneOrganization:n.mutateOneOrganization}),children:"Decline"})]}):void 0,j=(0,s.useCallback)(()=>{let e=c.current;e&&(e.clientHeight>window.innerHeight-e.offsetTop-59?d({y:window.innerHeight-e.offsetTop-59}):d(null))},[]);return(0,s.useEffect)(()=>(window.addEventListener("resize",j),()=>{window.removeEventListener("resize",j)}),[j]),(0,s.useEffect)(()=>{j()},[i,j,null===(a=c.current)||void 0===a?void 0:a.offsetTop]),(0,r.jsx)(ak.Z,{loading:n.loadingOrganizations,pagination:!1,size:"small",columns:[{title:"Name",dataIndex:"name",key:"name",sorter(e,a){let t=e.name||"",r=a.name||"";return t.localeCompare(r)}},{title:"Administrators",dataIndex:"owners",key:"owners",render:u},{title:"Users",dataIndex:"users",key:"users",render:m},{title:"Groups",dataIndex:"groups",key:"groups",render:h},{title:"Actions",key:"actions",render:g}],dataSource:null==i?void 0:i.map(e=>({key:e.id,id:e.id,name:e.name,owners:e.owners,pendingowners:e.pendingowners,users:e.users,pendingusers:e.pendingusers,groups:e.groups})),ref:c,scroll:{y:null==o?void 0:o.y}})},te=e=>{let{user:a,organizations:t,swr:l}=e,[d,c]=(0,s.useState)(),u=(0,i.useRouter)(),{organizationId:p}=u.query;return(0,s.useEffect)(()=>{if(p){let e=t.find(e=>e.id===p);c(e)}},[p,t]),(0,s.useEffect)(()=>{if(d){let e=t.find(e=>e.id===d.id);JSON.stringify(e)!==JSON.stringify(d)&&c(e)}},[t,d]),(0,r.jsxs)(n.Z,{className:"inDashboard Organization",children:[(0,r.jsx)(f.Z,{className:"inDashboard-PageHeader",backIcon:!1,title:(0,r.jsx)(o.Z.Title,{level:2,className:"inDashboard-PageHeader-title",children:"Organizations"}),footer:(0,r.jsx)(Z.Z,{})}),(0,r.jsx)(n.Z.Content,{className:"no-scroll",children:d?(0,r.jsx)(aV,{organization:{id:d.id,name:d.name,owners:d.owners,pendingowners:d.pendingowners,users:d.users,pendingusers:d.pendingusers,groups:d.groups},swr:{mutateOneOrganization:l.mutateOneOrganization,loadingOrganizations:l.loadingOrganizations},onClose(){u.push({pathname:"dashboard",query:{page:"organizations"}}),c(null)}}):(0,r.jsxs)(U.Z,{direction:"vertical",className:"full-width",size:20,children:[(0,r.jsx)(aQ,{swr:{addOneOrganization:l.addOneOrganization}}),(0,r.jsx)(a3,{user:{id:a.id},organizations:t,swr:{mutateOneOrganization:l.mutateOneOrganization,delOneOrganization:l.delOneOrganization,loadingOrganizations:l.loadingOrganizations},setOrganization(e){u.push({pathname:"dashboard",query:{page:"organizations",organizationId:e.id}}),c(e)}})]})})]})};var ta=t(63922),tt=t(10808),tr=t(88284),ti=t(32808),ts=t(92288);let tn={add:"Unable to add user"},tl=async(e,a)=>{try{let t=await eF.Z.add({email:e.email,password:e.password});if(t.alreadyExists)throw Error("User already exists");await eF.Z.updateById(t.id,[{key:"firstname",value:e.firstname},{key:"lastname",value:e.lastname},{key:"authorizedplugins",value:e.authorizedplugins},{key:"superuser",value:!!e.superuser}]);let r={...t,email:e.email,firstname:e.firstname,lastname:e.firstname,superuser:e.superuser};a.addOneUser(r)}catch(i){throw(0,w.lt)(tn.add,i),i}},to=e=>{let{plugins:a,swr:t}=e,[i,n]=(0,s.useState)(!1),[l,o]=(0,s.useState)(!1),[d]=ts.Z.useSystem();return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(C.ZP,{title:"New user",visible:i,initialValues:d.defaultplugins&&{authorizedplugins:d.defaultplugins},onCancel:()=>n(!1),async onOk(e){o(!0);try{await tl(e,t),o(!1),n(!1)}catch(a){throw o(!1),a}},loading:l,children:[(0,r.jsx)(b.Z.Item,{name:"firstname",label:"First name",children:(0,r.jsx)(k.Z,{})}),(0,r.jsx)(b.Z.Item,{name:"lastname",label:"Last name",children:(0,r.jsx)(k.Z,{})}),(0,r.jsx)(b.Z.Item,{name:"email",label:"Email",rules:[{required:!0,message:"Email is required"}],children:(0,r.jsx)(k.Z,{})}),(0,r.jsx)(eB.o,{name:"password"}),(0,r.jsx)(b.Z.Item,{name:"authorizedplugins",label:"Plugins",children:(0,r.jsx)(e4.Z,{mode:"multiple",options:a.map(e=>({label:e.name,value:e.key}))})}),(0,r.jsx)(b.Z.Item,{name:"superuser",label:"Administrator",valuePropName:"checked",children:(0,r.jsx)(ti.Z,{})})]}),(0,r.jsx)(H.HS,{onAdd:()=>n(!0),children:"New user"})]})},td={update:"Unable to update user"},tc=async(e,a,t)=>{try{let r=Object.keys(a).map(t=>{let r=a[t];if(void 0!==r&&"******"!==r&&r!==e[t])return{key:t,value:r,type:"password"===t&&"crypt"}}).filter(e=>e);if(!r.length)return;await eF.Z.updateById(e.id,r),a.password="******";let i={...e,...a};t.mutateOneUser(i)}catch(s){throw(0,w.lt)(td.update,s),s}},tu=e=>{let{plugins:a,user:t,swr:i}=e,[n,l]=(0,s.useState)(!1),[o,d]=(0,s.useState)(!1);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(C.ZP,{title:"Edit user",visible:n,initialValues:{...t,password:"******",authorizedplugins:t.authorizedplugins},onCancel:()=>l(!1),async onOk(e){d(!0);try{await tc(t,e,i),d(!1),l(!1)}catch(a){throw d(!1),a}},loading:o,children:[(0,r.jsx)(b.Z.Item,{name:"firstname",label:"First name",children:(0,r.jsx)(k.Z,{})}),(0,r.jsx)(b.Z.Item,{name:"lastname",label:"Last name",children:(0,r.jsx)(k.Z,{})}),(0,r.jsx)(b.Z.Item,{name:"email",label:"Email",rules:[{required:!0,message:"Email is required"}],children:(0,r.jsx)(k.Z,{})}),(0,r.jsx)(eB.o,{name:"password",edit:!0}),(0,r.jsx)(b.Z.Item,{name:"authorizedplugins",label:"Plugins",children:(0,r.jsx)(e4.Z,{mode:"multiple",options:a.map(e=>({label:e.name,value:e.key}))})}),(0,r.jsx)(b.Z.Item,{name:"superuser",label:"Administrator",valuePropName:"checked",children:(0,r.jsx)(ti.Z,{})})]}),(0,r.jsx)(H.w6,{bordered:!0,onEdit:()=>l(!0),children:"Edit"})]})},tp={del:"Unable to delete user"},tm=async(e,a)=>{try{await eF.Z.delById(e.id),a.delOneUser({id:e.id})}catch(t){throw(0,w.lt)(tp.del,t),t}},th=e=>{let{user:a,swr:t}=e,[i,n]=(0,s.useState)(!1);return(0,r.jsx)(H.m1,{loading:i,bordered:!0,text:(0,r.jsxs)(r.Fragment,{children:["Are you sure you want to delete the user"," ",(0,r.jsx)(o.Z.Text,{strong:!0,children:a.email}),"?"]}),title:"Delete user",async onDelete(){n(!0);try{await tm(a,t)}finally{n(!1)}}})},tg={plugins:"Unable to load plugins"},tj=e=>{let{users:a,swr:t}=e,[i,n]=(0,s.useState)(),[l,o]=(0,s.useState)(),d=(0,s.useRef)(null),c=e=>{e.sort();let a=e.map(e=>{let a=null==i?void 0:i.find(a=>a.key===e);if(a)return(0,r.jsx)(ta.Z.Ribbon,{text:a.category,style:{marginTop:"-15px"},children:(0,r.jsx)(Q.Z,{size:"small",children:a.name})},e)}),t=(0,r.jsx)(U.Z,{direction:"vertical",children:a});return(0,r.jsx)(tt.Z,{content:t,children:(0,r.jsxs)(L.Z,{children:[a.length," plugins"]})})},u=e=>e&&(0,r.jsx)(tr.Z,{className:"color-green"}),p=(e,a)=>(0,r.jsxs)(U.Z,{children:[(0,r.jsx)(tu,{plugins:(null==i?void 0:i.map(e=>({key:e.key,name:e.name})))||[],user:{id:a.id,firstname:a.firstname,lastname:a.lastname,email:a.email,authorizedplugins:a.authorizedplugins,superuser:a.superuser},swr:{mutateOneUser:t.mutateOneUser}}),(0,r.jsx)(th,{user:{id:a.id,email:a.email},swr:{delOneUser:t.delOneUser}})]}),m=(0,s.useCallback)(()=>{let e=d.current;e&&(e.clientHeight>window.innerHeight-e.offsetTop-59?o({y:window.innerHeight-e.offsetTop-59}):o(void 0))},[]);return(0,s.useEffect)(()=>{e2.Z.completeList().then(e=>{n(e)}).catch(e=>{(0,w.lt)(tg.plugins,e)})},[]),(0,s.useEffect)(()=>(window.addEventListener("resize",m),()=>{window.removeEventListener("resize",m)}),[m]),(0,s.useEffect)(()=>{m()},[a,m]),(0,r.jsxs)(U.Z,{direction:"vertical",className:"full-width full-height",size:20,children:[(0,r.jsx)(to,{plugins:(null==i?void 0:i.map(e=>({key:e.key,name:e.name})))||[],swr:{addOneUser:t.addOneUser}}),(0,r.jsx)(ak.Z,{loading:!i,pagination:!1,size:"small",columns:[{title:"First name",dataIndex:"firstname",key:"firstname",sorter(e,a){let t=e.firstname||"",r=a.firstname||"";return t.localeCompare(r)}},{title:"Last name",dataIndex:"lastname",key:"lastname",sorter(e,a){let t=e.lastname||"",r=a.lastname||"";return t.localeCompare(r)}},{title:"Email",dataIndex:"email",key:"email",sorter(e,a){let t=e.email,r=a.email;return t.localeCompare(r)}},{title:"Password",key:"password",render:()=>"******"},{title:"Plugins",dataIndex:"authorizedplugins",key:"authorizedplugins",render:c},{title:"Administrator",dataIndex:"superuser",key:"superuser",render:u},{title:"Actions",key:"actions",render:p}],dataSource:a.map(e=>({...e,key:e.id})),ref:d,scroll:{y:null==l?void 0:l.y}})]})};var tx=t(49129),ty=t(37404);let tw={system:"Error while loading system",update:"Unable to update system"},tv=async(e,a)=>{try{await ts.Z.update([{key:"allowsignup",value:!e.allowsignup}]),a({allowsignup:!e.allowsignup}),(0,w.Ur)("Changes saved")}catch(t){(0,w.lt)(tw.update,t)}},tf=async(e,a)=>{try{await ts.Z.update([{key:"password",value:e}]),a({password:e}),(0,w.Ur)("Changes saved")}catch(t){(0,w.lt)(tw.update,t)}},tZ=()=>{let[e]=b.Z.useForm(),[a,{mutateSystem:t,errorSystem:i,loadingSystem:n}]=ts.Z.useSystem(),l={wrapperCol:{offset:8,span:16}};return((0,s.useEffect)(()=>{i&&(0,w.lt)(tw.system,i)},[i]),(0,s.useEffect)(()=>{n||e.setFieldsValue((null==a?void 0:a.password)||{min:ty.yL,max:ty.nq,requireLetter:ty.JT,requireNumber:ty.tE,requireSymbol:ty.ah})},[n,e,null==a?void 0:a.password]),n)?(0,r.jsx)(v.Z.Simple,{}):(0,r.jsxs)(U.Z,{direction:"vertical",className:"full-width",size:20,children:[(0,r.jsx)(Q.Z,{title:"Signup",children:(0,r.jsx)(ti.Z,{checked:null==a?void 0:a.allowsignup,onChange:()=>tv(a,t),children:"Allow signup"})}),(0,r.jsx)(Q.Z,{title:"Password",children:(0,r.jsxs)(b.Z,{labelCol:{span:8},wrapperCol:{span:16},form:e,name:"form",onFinish:async e=>tf(e,t),children:[(0,r.jsx)(b.Z.Item,{label:"Minimum number of characters",name:"min",rules:[{required:!0,message:"Minimum number of characters is required"}],children:(0,r.jsx)(tx.Z,{min:0,max:64})}),(0,r.jsx)(b.Z.Item,{label:"Maximum number of characters",name:"max",rules:[{required:!0,message:"Maximum number of characters is required"}],children:(0,r.jsx)(tx.Z,{min:0,max:64})}),(0,r.jsx)(b.Z.Item,{...l,valuePropName:"checked",name:"requireLetter",children:(0,r.jsx)(ti.Z,{children:"Require letter"})}),(0,r.jsx)(b.Z.Item,{...l,valuePropName:"checked",name:"requireNumber",children:(0,r.jsx)(ti.Z,{children:"Require number"})}),(0,r.jsx)(b.Z.Item,{...l,valuePropName:"checked",name:"requireSymbol",children:(0,r.jsx)(ti.Z,{children:"Require symbol"})}),(0,r.jsx)(b.Z.Item,{...l,children:(0,r.jsx)(L.Z,{type:"primary",icon:(0,r.jsx)(tr.Z,{}),htmlType:"submit"})})]})})]})},tb={plugins:"Unable to get plugins",update:"Unable to update system"},tk=async(e,a,t,r)=>{try{await ts.Z.update([{key:"defaultplugins",type:"array",method:t?"append":"remove",value:a.key}]);let i=(null==e?void 0:e.defaultplugins)||[],s=i.indexOf(a.key);t&&-1===s&&i.push(a.key),t||-1===s||i.splice(s,1),r.mutateSystem({defaultplugins:i})}catch(n){(0,w.lt)(tb.update,n)}},tO=()=>{let e=(0,s.useRef)(null),[a,t]=(0,s.useState)(),[i,n]=(0,s.useState)(),[l,{mutateSystem:o,loadingSystem:d}]=ts.Z.useSystem();(0,s.useEffect)(()=>{e2.Z.completeList().then(e=>{t(e)}).catch(e=>{(0,w.lt)(tb.plugins,e)})},[]);let c=(0,s.useCallback)(()=>{let a=e.current;a&&(a.clientHeight>window.innerHeight-a.offsetTop-59?n({y:window.innerHeight-a.offsetTop-59}):n(null))},[]);return(0,s.useEffect)(()=>(window.addEventListener("resize",c),()=>{window.removeEventListener("resize",c)}),[c]),(0,s.useEffect)(()=>{c()},[a,c]),(0,r.jsx)(ak.Z,{loading:!a||d,pagination:!1,size:"small",columns:[{title:"Category",dataIndex:"category",key:"category"},{title:"Name",dataIndex:"name",key:"name"},{title:"Default enabled",key:"enable",render(e){var a;let t=null==l?void 0:null===(a=l.defaultplugins)||void 0===a?void 0:a.includes(e.key);return(0,r.jsx)(ti.Z,{checked:t,onChange:async a=>tk(l,e,a.target.checked,{mutateSystem:o})})}}],dataSource:a,ref:e,scroll:{y:null==i?void 0:i.y}})},tz={users:{label:"Users",key:"users"},registration:{label:"Registration",key:"registration"},plugins:{label:"Plugins",key:"plugins"}},tC={users:"Error while loading users"},tS=(e,a)=>{e.replace({pathname:"/dashboard",query:{page:"administration",tab:a}})},tP=()=>{let e=(0,i.useRouter)(),{tab:a}=e.query,[t,{addOneUser:l,mutateOneUser:d,delOneUser:c,errorUsers:u}]=eF.Z.useUsers();return(0,s.useEffect)(()=>{u&&(0,w.lt)(tC.users,u)},[u]),(0,r.jsxs)(n.Z,{className:"inDashboard Administration",children:[(0,r.jsx)(f.Z,{className:"inDashboard-PageHeader",backIcon:!1,title:(0,r.jsx)(o.Z.Title,{level:2,className:"inDashboard-PageHeader-title",children:"Administration"}),footer:(0,r.jsx)(Z.Z,{})}),(0,r.jsx)(n.Z.Content,{children:(0,r.jsx)(O.Z,{className:"inDashboard-Tabs",type:"card",items:[{key:tz.users.key,label:tz.users.label,children:(0,r.jsx)(tj,{users:t,swr:{addOneUser:l,mutateOneUser:d,delOneUser:c}})},{key:tz.registration.key,label:tz.registration.label,children:(0,r.jsx)(tZ,{})},{key:tz.plugins.key,label:tz.plugins.label,children:(0,r.jsx)(tO,{})}],defaultActiveKey:a||"default",onChange:a=>tS(e,a)})})]})};var tN=t(95507);let tT=()=>(0,r.jsx)(Q.Z,{title:"Standard workflow",children:(0,r.jsx)(tN.ZP,{dataSource:["Go to account settings","Fill your first name, last name, change your password if needed","Create an HPC provider, you will need that to run a simulation","Create a new workspace","Create a new project","Upload a geometry (STEP file for 3D or DXF file for 2D)","Select a simulation model","Configure your simulation: geometry, materials, parameters, boundary conditions, depending on your simulation, HPC resource","Run your simulation","Display the results","Depending on your simulation, visualize data","Depending on your simulation, post-process the result"],renderItem:e=>(0,r.jsxs)(tN.ZP.Item,{children:[" - ",e]})})}),tE=()=>(0,r.jsx)(Q.Z,{title:"Workspace",children:(0,r.jsxs)(o.Z.Text,{children:["The workspace is the place where all the projects are. You can create several workspaces to sort your different projects.",(0,r.jsx)("br",{}),"You can share your workspace with other users or groups throught organizations."]})});var tA=t(54907);let tI=()=>(0,r.jsxs)(Q.Z,{title:"Project",children:[(0,r.jsx)(o.Z.Text,{children:"The project is used to manage geometries and simulation."}),(0,r.jsx)(tA.Z,{children:(0,r.jsx)(tA.Z.Panel,{header:"Archive Project",children:(0,r.jsxs)(o.Z.Text,{children:["You can archive a project to save disk space.",(0,r.jsx)("br",{}),"Once archived, a project is not editable anymore.",(0,r.jsx)("br",{}),"At the archive time, you can download a"," ",(0,r.jsx)("code",{children:".tanatlocarchive"})," file that contains all the data to restore your project later.",(0,r.jsx)("br",{}),"There is several options to manage an archived projects:",(0,r.jsxs)("ul",{children:[(0,r.jsx)("li",{children:"Restore the project from the previously downloaded archive file;"}),(0,r.jsx)("li",{children:"Restore the project from the archive file on the server;"}),(0,r.jsx)("li",{children:"Delete the archive file on the server, in the case you will not be able to restore the project from the server archive file."})]})]})},"archive")})]}),tU=()=>(0,r.jsx)(Q.Z,{title:"Account / HPC plugins",children:(0,r.jsxs)(tA.Z,{children:[(0,r.jsxs)(tA.Z.Panel,{header:"Local plugin",children:[(0,r.jsx)(o.Z.Text,{children:"Allow to compute a simulation directly on the frontal server."}),(0,r.jsx)(o.Z.Text,{children:"This plugin is only reserved for test purposes."})]},"local"),(0,r.jsxs)(tA.Z.Panel,{header:"Rescale plugin",children:[(0,r.jsxs)(o.Z.Text,{children:["Allow to compute a simulation on"," ",(0,r.jsx)("a",{href:"https://www.rescale.com/",children:"Rescale"}),"."]}),(0,r.jsx)(o.Z.Text,{children:"You have to fill the following informations:"}),(0,r.jsxs)("ul",{children:[(0,r.jsx)("li",{children:"Name: a name to retrieve your configuration during the simulation parameterization;"}),(0,r.jsxs)("li",{children:["Token: your API token. You can find it in your"," ",(0,r.jsx)("a",{href:"https://platform.rescale.jp/user/settings/api-key/",children:"Rescale account"}),";"]}),(0,r.jsx)("li",{children:"Platform: the platform you use. USA, Europe or Japan;"}),(0,r.jsx)("li",{children:"[Optional] Organization name: the organization you are in;"}),(0,r.jsx)("li",{children:"[Optional] Project id: the financial project identifier;"}),(0,r.jsx)("li",{children:"[Optional] Default walltime: the default value for the run walltime;"}),(0,r.jsx)("li",{children:"[Optional] Additional files: additional files you have to use with your simulations. Generally FreeFEM custom plugins."})]}),(0,r.jsx)(o.Z.Text,{children:"When you save this informations, Tanatloc will check your API key, the available core types, and the available FreeFEM versions."})]},"rescale")]})}),tR=()=>(0,r.jsxs)(Q.Z,{title:"Administration",children:[(0,r.jsx)(o.Z.Text,{children:"Your need to be an administrator to have acces to this part"}),(0,r.jsxs)(tA.Z,{children:[(0,r.jsx)(tA.Z.Panel,{header:"Users",children:(0,r.jsx)(o.Z.Text,{children:"You can manage users: create, delete or modify informations."})},"users"),(0,r.jsx)(tA.Z.Panel,{header:"Registration",children:(0,r.jsx)(o.Z.Text,{children:"Allow you to enable / disable the signup and to manage the required pattern for passwords."})},"registration")]})]}),tD=()=>(0,r.jsxs)(Q.Z,{title:"Organization",children:[(0,r.jsx)(o.Z.Text,{children:"Allow you to manage an organization, and associated groups for sharing purpose."}),(0,r.jsxs)(tA.Z,{children:[(0,r.jsx)(tA.Z.Panel,{header:"Users",children:(0,r.jsxs)(o.Z.Text,{children:["Add or remove owners and users.",(0,r.jsx)("br",{}),"Owners and users in an organization can be used to share a workspace or a project."]})},"users"),(0,r.jsx)(tA.Z.Panel,{header:"Groups",children:(0,r.jsxs)(o.Z.Text,{children:["Add, modify or remove groups.",(0,r.jsx)("br",{}),"Groups in an organization can be used to share a workspace or a project."]})},"groups")]})]});var tF=t(73461),tq=t.n(tF);let tL=()=>(0,r.jsxs)(Q.Z,{title:"About",children:[(0,r.jsxs)(o.Z,{children:["Version: ",(0,r.jsx)(o.Z.Text,{code:!0,children:y.i8})]}),(0,r.jsx)("br",{}),(0,r.jsxs)(o.Z,{children:["Git version:"," ",(0,r.jsx)(o.Z.Text,{code:!0,children:G.Z.getGitVersion()})]}),(0,r.jsx)("br",{}),(0,r.jsxs)(o.Z,{children:["Browser: ",(0,r.jsx)(o.Z.Text,{code:!0,children:navigator.userAgent})]}),(0,r.jsx)("br",{}),(0,r.jsxs)(o.Z,{children:["OS: ",(0,r.jsx)(o.Z.Text,{code:!0,children:tq().platform()})]})]}),tW=()=>(0,r.jsxs)(n.Z,{className:"inDashboard Help",children:[(0,r.jsx)(f.Z,{className:"inDashboard-PageHeader",backIcon:!1,title:(0,r.jsx)(o.Z.Title,{level:2,className:"inDashboard-PageHeader-title",children:"Help"}),extra:(0,r.jsx)("a",{href:"https://github.com/Airthium/tanatloc/issues/new/choose",target:"_blank",rel:"noreferrer",children:"Open an issue"}),footer:(0,r.jsx)(Z.Z,{})}),(0,r.jsx)(n.Z.Content,{className:"scroll",children:(0,r.jsxs)(U.Z,{direction:"vertical",className:"full-width",size:20,children:[(0,r.jsx)(tT,{}),(0,r.jsx)(tE,{}),(0,r.jsx)(tI,{}),(0,r.jsx)(tU,{}),(0,r.jsx)(tD,{}),(0,r.jsx)(tR,{}),(0,r.jsx)(tL,{})]})})]}),tH={user:"Error while loading user",organizations:"Error while loading organizations",workspaces:"Error while loading workspaces",logout:"Unable to logout"},tG={workspaces:{label:"Workspaces",key:"workspaces"},account:{label:"Account Settings",key:"account"},organizations:{label:"Organizations",key:"organizations"},administration:{label:"Administration",key:"administration"},editor:{label:"Editor",key:"editor"},help:{label:"I Need Help",key:"help"},logout:{label:"Logout",key:"logout"}},tJ=(e,a,t)=>{a===tG.logout.key?tM(e,t):a===tG.editor.key?e.push("/editor"):e.replace({pathname:"/dashboard",query:{page:a}})},tM=async(e,a)=>{try{await eQ(),a(),e.push("/")}catch(t){(0,w.lt)(tH.logout,t)}},t_=()=>{let[e,a]=(0,s.useState)(),[t,{mutateUser:j,clearUser:f,errorUser:Z,loadingUser:b}]=eF.Z.useUser(),[k,{addOneOrganization:O,delOneOrganization:z,mutateOneOrganization:C,errorOrganizations:S,loadingOrganizations:P}]=ab.useOrganizations(),[N,{addOneWorkspace:T,delOneWorkspace:E,mutateOneWorkspace:A,errorWorkspaces:U,loadingWorkspaces:R}]=I.useWorkspaces(),D=(0,i.useRouter)();return((0,s.useEffect)(()=>{b||t||D.replace("/")},[t,b,D]),(0,s.useEffect)(()=>{let e=new URLSearchParams(window.location.search),t=e.get("page");t?a(t):(a(tG.workspaces.key),tJ(D,tG.workspaces.key,f))},[D,f]),(0,s.useEffect)(()=>{Z&&(0,w.lt)(tH.user,Z),S&&(0,w.lt)(tH.organizations,S),U&&(0,w.lt)(tH.workspaces,U)},[Z,S,U]),!t||b||P||R)?(0,r.jsx)(v.Z,{}):(0,r.jsxs)(n.Z,{className:"Dashboard",children:[(0,r.jsxs)(n.Z.Sider,{theme:"light",width:"256",className:"Dashboard-Sider",children:[(0,r.jsx)("div",{className:"logo",children:(0,r.jsx)("img",{src:"/images/logo.svg",alt:"Tanatloc"})}),(0,r.jsx)(l.Z,{className:"Dashboard-Menu",theme:"light",items:[{key:tG.workspaces.key,icon:(0,r.jsx)(d.Z,{}),label:tG.workspaces.label},{key:tG.account.key,icon:(0,r.jsx)(c.Z,{}),label:tG.account.label},{key:tG.organizations.key,icon:(0,r.jsx)(u.Z,{}),label:tG.organizations.label,className:x()()?"display-none":""},{key:tG.administration.key,className:t.superuser&&!x()()?"":"display-none",icon:(0,r.jsx)(p.Z,{}),label:tG.administration.label},{key:tG.editor.key,icon:(0,r.jsx)(m.Z,{}),label:tG.editor.label},{key:tG.help.key,icon:(0,r.jsx)(h.Z,{}),label:tG.help.label},{type:"divider"},{key:tG.logout.key,danger:!0,icon:(0,r.jsx)(g.Z,{}),label:tG.logout.label,className:x()()?"display-none":""},{key:"version",disabled:!0,className:"version",label:(0,r.jsxs)(o.Z.Text,{className:"text-light",ellipsis:{tooltip:!0},children:["version ",y.i8]})}],onClick(e){let{keyPath:t}=e,r=t.pop();a(r),tJ(D,r,f)},mode:"inline"})]}),(0,r.jsxs)(n.Z.Content,{className:"no-scroll",children:[e===tG.workspaces.key&&(0,r.jsx)(eI,{user:{id:t.id},workspaces:N,organizations:k,swr:{addOneWorkspace:T,delOneWorkspace:E,mutateOneWorkspace:A}}),e===tG.account.key&&(0,r.jsx)(ah,{user:{email:t.email,firstname:t.firstname,lastname:t.lastname,avatar:t.avatar},swr:{mutateUser:j,clearUser:f}}),e===tG.organizations.key&&(0,r.jsx)(te,{user:{id:t.id},organizations:k,swr:{addOneOrganization:O,delOneOrganization:z,mutateOneOrganization:C,loadingOrganizations:P}}),e===tG.administration.key&&(0,r.jsx)(tP,{}),e===tG.help.key&&(0,r.jsx)(tW,{})]})]})},tB=()=>(0,r.jsx)(t_,{});var tY=tB},4147:function(e){"use strict";e.exports={i8:"1.1.6"}}},function(e){e.O(0,[5305,105,7987,586,6495,4362,1021,1188,1260,2566,7040,6326,9477,5507,7088,9317,2414,3407,9774,2888,179],function(){return e(e.s=40528)}),_N_E=e.O()}]);