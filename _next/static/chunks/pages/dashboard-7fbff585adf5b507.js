(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8026],{9637:function(e,a,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/dashboard",function(){return t(62447)}])},59141:function(e,a,t){"use strict";var i;t.d(a,{JT:function(){return n},ah:function(){return o},nq:function(){return r},tE:function(){return l},yL:function(){return s}}),null!==(i=t(83454).env.AUTH_SECRET)&&void 0!==i||Array(33).join("a");let s=6,r=16,n=!0,l=!0,o=!0},5957:function(e,a,t){"use strict";t.d(a,{Z:function(){return s}});var i=t(948);let add=async(e,a)=>{let t=await (0,i.R)("/api/avatar",{method:"POST",headers:{Accept:"application/json"},body:JSON.stringify({file:e,project:a})});return t.json()};var s={add:add}},77547:function(e,a,t){"use strict";t.d(a,{H:function(){return APIError}});let APIError=class APIError extends Error{constructor(e){var a;super(e.title),this.title=e.title,this.name="APIError",this.render=e.render,this.err=e.err,this.type=null!==(a=e.type)&&void 0!==a?a:"error"}}},42095:function(e,a,t){"use strict";t.d(a,{Z:function(){return n}});var i=t(59734),s=t(67294),r=t(948);let add=async(e,a)=>{let t=await (0,r.R)("/api/geometry",{method:"POST",body:JSON.stringify({project:e,geometry:a})});return t.json()},update=async(e,a)=>{await (0,r.R)("/api/geometry/"+e.id,{method:"PUT",body:JSON.stringify(a)})},del=async e=>{await (0,r.R)("/api/geometry/"+e.id,{method:"DELETE"})},download=async e=>{let a=await (0,r.R)("/api/geometry/"+e.id+"/download");return a.json()},getPart=async e=>{let a=await (0,r.R)("/api/geometry/"+e.id+"/part");return a.json()};var n={useGeometries:e=>{var a;let{data:t,error:n,mutate:l}=(0,i.ZP)(["/api/geometries",JSON.stringify({ids:e})],e=>{let[a,t]=e;return(0,r._)(a,t)}),o=null!==(a=null==t?void 0:t.geometries)&&void 0!==a?a:[],d=(0,s.useCallback)(async e=>{let a=[...o,e];await l({geometries:a})},[o,l]),u=(0,s.useCallback)(async e=>{let a=o.filter(a=>a.id!==e.id);await l({geometries:a})},[o,l]),c=(0,s.useCallback)(async e=>{let a=o.map(a=>(a.id===e.id&&(a={...a,...e}),a));await l({geometries:a})},[o,l]);return[o,{addOneGeometry:d,delOneGeometry:u,mutateOneGeometry:c,errorGeometries:n,loadingGeometries:!t}]},add:add,update:update,del:del,download:download,getPart:getPart}},61552:function(e,a,t){"use strict";t.d(a,{x:function(){return login}});var i=t(59134),s=t.n(i);let r=s()()?"http://localhost:3000":"",login=async e=>{let a=await fetch(r+"/api/login",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({email:e.email,password:e.password})});return 200===a.status?{ok:!0,...await a.json()}:{ok:!1}}},751:function(e,a,t){"use strict";t.d(a,{Z:function(){return n}});var i=t(59734),s=t(67294),r=t(948);let update=async e=>{await (0,r.R)("/api/system",{method:"PUT",body:JSON.stringify(e)})};var n={useSystem:()=>{var e;let{data:a,error:t,mutate:n}=(0,i.ZP)("/api/system",r._),l=null!==(e=null==a?void 0:a.system)&&void 0!==e?e:{},o=(0,s.useCallback)(async e=>{await n({system:{...l,...e}})},[l,n]);return[l,{mutateSystem:o,errorSystem:t,loadingSystem:!a}]},update:update}},55798:function(e,a,t){"use strict";t.d(a,{o:function(){return input_password}});var i=t(85893),s=t(97538),r=t(51024),n=t(59141),l=t(751);let o={password:"Please enter a password",passwordTooSmall:e=>"Your password is too small (minimum "+e+" characters)",passwordTooLong:e=>"Your password is too long (maximum "+e+" characters)",passwordRequireLetter:"Your password must contain a letter",passwordRequireNumber:"Your password must contain a number",passwordRequireSymbol:"Your password must contain a symbol"},_checkMin=(e,a)=>!(a.length<e),_checkMax=(e,a)=>!(a.length>e),_checkRegex=(e,a)=>-1!==e.search(a),_requireLetter=(e,a)=>{var t,i;return(null!==(i=null==e?void 0:null===(t=e.password)||void 0===t?void 0:t.requireLetter)&&void 0!==i?!i:!n.JT)||_checkRegex(a,/[a-zA-Z]/)},_requireNumber=(e,a)=>{var t,i;return(null!==(i=null==e?void 0:null===(t=e.password)||void 0===t?void 0:t.requireNumber)&&void 0!==i?!i:!n.tE)||_checkRegex(a,/\d/)},_requireSymbol=(e,a)=>{var t,i;return(null!==(i=null==e?void 0:null===(t=e.password)||void 0===t?void 0:t.requireSymbol)&&void 0!==i?!i:!n.ah)||_checkRegex(a,/[!@#$%^&*(){}[\]<>?/|.:;_-]/)},_checkSize=(e,a,t,i)=>{_checkMin(e,t)||i.push(o.passwordTooSmall(e)),_checkMax(a,t)||i.push(o.passwordTooLong(a))},_checkFormat=(e,a,t)=>{_requireLetter(e,a)||t.push(o.passwordRequireLetter),_requireNumber(e,a)||t.push(o.passwordRequireNumber),_requireSymbol(e,a)||t.push(o.passwordRequireSymbol)};var input_password=e=>{var a,t,d,u;let{labelCol:c,wrapperCol:p,name:m,label:h,inputPlaceholder:g,inputAutoComplete:w,edit:x,style:y,required:j}=e,[f]=l.Z.useSystem(),v=null!==(d=null==f?void 0:null===(a=f.password)||void 0===a?void 0:a.min)&&void 0!==d?d:n.yL,b=null!==(u=null==f?void 0:null===(t=f.password)||void 0===t?void 0:t.max)&&void 0!==u?u:n.nq;return(0,i.jsx)(s.Z.Item,{labelCol:c,wrapperCol:p,name:null!=m?m:"password",label:null!=h?h:"Password",rules:[()=>({validator(e,a){let t=[];return x&&"******"===a?Promise.resolve():a?(_checkSize(v,b,a,t),_checkFormat(f,a,t),t.length)?Promise.reject(t):Promise.resolve():Promise.reject(o.password)}}),{required:!!j,message:""}],style:y,children:(0,i.jsx)(r.default.Password,{placeholder:g,autoComplete:w})})}},62447:function(e,a,t){"use strict";t.r(a),t.d(a,{default:function(){return dashboard_page}});var i=t(85893),s=t(11163),r=t(67294),n=t(16373),l=t(12386),o=t(53740),d=t(60077),u=t(55984),c=t(35741),p=t(54434),m=t(78390),h=t(72708),g=t(58452),w=t(59134),x=t.n(w),y=t(4147),j=t(8061),f=t(54509),v=t(95590),b=t(40561),k=t(65400),_=t.n(k),C=t(36671),Z=t(97538),O=t(51024),z=t(20838),S=t(94055),T=t(29450),P=t(61093),A=t(32615),E=t(51274),N=t(74253),I=t(65053),U=t.n(I),pageHeader=e=>{let{className:a,title:t,footer:s,extra:r,children:n}=e;return(0,i.jsxs)("div",{className:a,children:[(t||r)&&(0,i.jsxs)("div",{className:U().head,children:[(0,i.jsx)("div",{children:t}),(0,i.jsx)("div",{children:r})]}),(0,i.jsx)("div",{children:n}),null!=s?s:(0,i.jsx)(N.Z,{className:U().divider})]})},D=t(55043),q=t(88053);let F={add:"Unable to add workspace"},_onAdd=async(e,a,t)=>{try{let t=await D.Z.add(e);await a.addOneWorkspace(t)}catch(e){throw t((0,f.iT)({title:F.add,err:e})),e}};var add=e=>{let{swr:a}=e,t=(0,r.useRef)(null),[s,n]=(0,r.useState)(!1),[l,o]=(0,r.useState)(!1),{dispatch:d}=(0,r.useContext)(j.uj);(0,r.useEffect)(()=>{t.current&&t.current.focus()});let u=(0,r.useCallback)(()=>o(!0),[]),c=(0,r.useCallback)(()=>o(!1),[]),p=(0,r.useCallback)(async e=>{n(!0);try{await _onAdd(e,a,d),n(!1),o(!1)}catch(e){throw n(!1),e}},[a,d]);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(q.HS,{onAdd:u,children:"Create a new workspace"}),(0,i.jsx)(E.ZP,{visible:l,loading:s,title:"Create a new workspace",onCancel:c,onOk:p,children:(0,i.jsx)(Z.Z.Item,{label:"Name",name:"name",rules:[{required:!0,message:"Name is required"},{max:50,message:"Max 50 characters"}],children:(0,i.jsx)(O.default,{ref:t,placeholder:"Workspace's name"})})})]})},R=t(84960),W=t(74048),L=t(7737),G=t(17072),H=t(8798);let B={add:"Unable to add project"},add_onAdd=async(e,a,t,i)=>{try{let i=await H.Z.add({id:e.id},a);return await t.addOneProject(i),await t.mutateOneWorkspace({...e,projects:[...e.projects,i.id]}),i}catch(e){throw i((0,f.iT)({title:B.add,err:e})),e}};var project_add=e=>{let{workspace:a,swr:t}=e,n=(0,r.useRef)(null),[l,o]=(0,r.useState)(!1),[d,u]=(0,r.useState)(!1),{dispatch:c}=(0,r.useContext)(j.uj),p=(0,s.useRouter)();(0,r.useEffect)(()=>{n.current&&n.current.focus()});let m=(0,r.useCallback)(()=>o(!0),[]),h=(0,r.useCallback)(()=>o(!1),[]),g=(0,r.useCallback)(e=>e.stopPropagation(),[]),w=(0,r.useCallback)(async e=>{u(!0);try{let i=await add_onAdd(a,e,t,c);u(!1),o(!1),await p.push({pathname:"/project",query:{page:"workspaces",workspaceId:a.id,projectId:i.id}})}catch(e){throw u(!1),e}},[p,a,t,c]);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(q.HS,{primary:!1,dark:!0,onAdd:m,children:"Create a new project"}),(0,i.jsxs)(E.ZP,{title:"Create a new project",visible:l,onCancel:h,onOk:w,loading:d,children:[(0,i.jsx)(Z.Z.Item,{label:"Name",name:"title",rules:[{required:!0,message:"Name is required"},{max:50,message:"Max 50 characters"}],children:(0,i.jsx)(O.default,{ref:n,placeholder:"Project's name"})}),(0,i.jsx)(Z.Z.Item,{label:"Description",name:"description",children:(0,i.jsx)(O.default.TextArea,{showCount:!0,style:{marginBottom:"20px"},maxLength:120,placeholder:"Project's description",onKeyUp:g})})]})]})},M=t(70302),J=t(60713),K=t(77834),V=t(59361),Y=t(67701);let Q={edit:"Unable to edit project"},_onEdit=async(e,a,t,i)=>{try{await H.Z.update({id:e.id},[{key:"title",value:a.title},{key:"description",value:a.description}]),await t.mutateOneProject(e)}catch(e){throw i((0,f.iT)({title:Q.edit,err:e})),e}};var edit=e=>{let{disabled:a,project:t,swr:s}=e,n=(0,r.useRef)(null),[l,o]=(0,r.useState)(!1),[d,u]=(0,r.useState)(!1),{dispatch:c}=(0,r.useContext)(j.uj);(0,r.useEffect)(()=>{n.current&&n.current.focus()});let p=(0,r.useCallback)(()=>o(!0),[]),m=(0,r.useCallback)(()=>o(!1),[]),h=(0,r.useCallback)(async e=>{u(!0);try{await _onEdit(t,e,s,c),u(!1),o(!1)}catch(e){throw u(!1),e}},[t,s,c]),g=(0,r.useCallback)(e=>e.stopPropagation(),[]);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(q.w6,{disabled:a,dark:!0,onEdit:p}),(0,i.jsxs)(E.ZP,{title:'Edit "'+t.title+'" project',visible:l,onCancel:m,onOk:h,loading:d,initialValues:{title:t.title,description:t.description},children:[(0,i.jsx)(Z.Z.Item,{label:"Name",name:"title",rules:[{required:!0,message:"Name is required"},{max:50,message:"Max 50 characters"}],children:(0,i.jsx)(O.default,{ref:n,placeholder:"Project's name"})}),(0,i.jsx)(Z.Z.Item,{label:"Description",name:"description",children:(0,i.jsx)(O.default.TextArea,{style:{marginBottom:"20px"},placeholder:"Project's description",showCount:!0,maxLength:120,onKeyUp:g})})]})]})},$=t(4863);let X={del:"Unable to delete project"},_onDelete=async(e,a,t,i)=>{try{await H.Z.del({id:e.id},{id:a.id});let i=e.projects.findIndex(e=>e===a.id);e.projects=[...e.projects.slice(0,i),...e.projects.slice(i+1)],await t.mutateOneWorkspace(e),await t.delOneProject({id:a.id})}catch(e){throw i((0,f.iT)({title:X.del,err:e})),e}};var project_delete=e=>{let{disabled:a,workspace:t,project:s,swr:n}=e,[l,d]=(0,r.useState)(!1),{dispatch:u}=(0,r.useContext)(j.uj),c=(0,r.useCallback)(async()=>{d(!0);try{await _onDelete(t,s,n,u)}finally{d(!1)}},[t,s,n,u]);return(0,i.jsx)(q.m1,{disabled:a,loading:l,title:"Delete the project",text:(0,i.jsxs)(i.Fragment,{children:["Are you sure you want to delete the project"," ",(0,i.jsx)(o.Z.Text,{strong:!0,children:s.title}),"?",(0,i.jsx)($.Z,{type:"error",message:"If you delete the project, you will no longer be able to restore the archive",style:{marginTop:"16px"}})]}),onDelete:c})},ee=t(28465),ea=t(64860),et=t(44760),ei=t(48764).lW;let es={archive:"Unable to archive project",unarchiveServer:"Unable to unarchive project on server",deleteArchive:"Unable to delete archive",upload:"Unable to upload archive"},_onArchive=async(e,a,t,i)=>{try{let i=await H.Z.archive({id:a.id}),s=await i.blob(),r=window.URL.createObjectURL(new Blob([s])),n=document.createElement("a");n.href=r,n.setAttribute("download",a.id+".tanatlocarchive"),n.click(),await t.mutateOneProject({...a,archived:!0}),await t.mutateOneWorkspace(e)}catch(e){throw i((0,f.iT)({title:es.archive,err:e})),e}},_onUnarchiveServer=async(e,a,t,i)=>{try{await H.Z.unarchiveFromServer({id:a.id}),await t.mutateOneProject({...a,archived:!1}),await t.mutateOneWorkspace(e)}catch(e){throw i((0,f.iT)({title:es.unarchiveServer,err:e})),e}},_onArchiveDelete=async(e,a)=>{try{await H.Z.deleteArchiveFile({id:e.id})}catch(e){a((0,f.iT)({title:es.deleteArchive,err:e}))}},_getFile=async e=>{let a=new FileReader;return new Promise(t=>{a.addEventListener("load",()=>{t(a.result)}),a.readAsArrayBuffer(e)})},_onUpload=async(e,a,t,i,s)=>{if("uploading"===t.file.status)return!0;if("done"===t.file.status)try{let s=await _getFile(t.file.originFileObj);await H.Z.unarchiveFromFile({id:a.id},ei.from(s)),await i.mutateOneProject({...a,archived:!1}),await i.mutateOneWorkspace(e)}catch(e){s((0,f.iT)({title:es.upload,err:e}))}return!1};var archive=e=>{let{disabled:a,workspace:t,project:s,swr:n}=e,[l,d]=(0,r.useState)(!1),[u,c]=(0,r.useState)(!1),{dispatch:p}=(0,r.useContext)(j.uj),m=(0,r.useCallback)(()=>d(!0),[]),h=(0,r.useCallback)(()=>d(!1),[]),g=(0,r.useCallback)(async()=>{c(!0);try{await _onArchive(t,s,n,p),c(!1),d(!1)}catch(e){throw c(!1),e}},[t,s,n,p]),w=(0,r.useCallback)(()=>{(async()=>{c(!0);try{await _onUnarchiveServer(t,s,n,p),c(!1),d(!1)}catch(e){c(!1)}})()},[t,s,n,p]),x=(0,r.useCallback)(e=>{(async()=>{let a=await _onUpload(t,s,e,n,p);c(a),d(a)})()},[t,s,n,p]),y=(0,r.useCallback)(async()=>_onArchiveDelete(s,p),[s,p]);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(E.ZP,{visible:l,loading:u,title:"Archive",onCancel:h,onOk:s.archived?void 0:g,okButtonText:"Archive",children:s.archived?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(Z.Z.Item,{label:"Restore archive from the server",tooltip:"This will restore the project from the server archive file.",children:(0,i.jsx)(_(),{loading:u,onClick:w,children:"Restore archive from the server"})}),(0,i.jsx)(Z.Z.Item,{label:"Restore archive from local file",tooltip:"This will restore the project from your local archive file (.tanatlocarchive file).",children:(0,i.jsx)(ee.Z,{action:"/api/noop",accept:".tanatlocarchive",showUploadList:!1,onChange:x,children:(0,i.jsx)(_(),{children:"Restore archive from archive file"})})}),(0,i.jsx)(Z.Z.Item,{label:"Delete archive from the server",tooltip:"This will delete the archive file from the server, you will have to use a local copy to restore the project.",children:(0,i.jsx)(q.m1,{loading:u,bordered:!0,title:"Delete server archive",text:"Are you sure your want to delete the archive from the server?",onDelete:y,children:"Delete server archive"})})]}):(0,i.jsxs)(o.Z.Text,{children:["An archive will be downloaded and the project will not be editable anymore, archive the project \xab",s.title,"\xbb?"]})}),(0,i.jsx)(S.default,{title:s.archived?"Manage archive":"Archive",children:(0,i.jsx)(_(),{disabled:a,type:"link",icon:s.archived?(0,i.jsx)(et.Z,{}):(0,i.jsx)(ea.Z,{}),onClick:m})})]})},er=t(52655),en=t(35304),el=t.n(en);let eo={copy:"Unable to copy project"},_onCopy=async(e,a,t,i)=>{try{let i=await H.Z.copy(e,a);await t.addOneProject(i),e.projects.push(i.id),await t.mutateOneWorkspace(e)}catch(e){i((0,f.iT)({title:eo.copy,err:e}))}};var copy=e=>{let{workspace:a,project:t,swr:s}=e,{dispatch:n}=(0,r.useContext)(j.uj),l=(0,r.useCallback)(()=>{(async()=>{await _onCopy(a,t,s,n)})()},[a,t,s,n]);return(0,i.jsx)(S.default,{title:"Copy",children:(0,i.jsx)(_(),{icon:(0,i.jsx)(er.default,{}),className:"".concat(el().noBorder," ").concat(el().noBackground),onClick:l})})},ed=t(97221),eu=t(94722),ec=t.n(eu),ep=t(48764).lW;let ProjectCard=e=>{var a,t,n,l;let{user:d,workspace:u,page:c,project:p,organizations:m,swr:h}=e,g=(0,s.useRouter)(),w=(0,r.useCallback)(()=>{(async()=>{p.archived||await g.push({pathname:"/project",query:{page:c,workspaceId:u.id,projectId:p.id}})})()},[g,u,c,p]),x=(0,r.useMemo)(()=>p.archived?(0,i.jsx)(C.default,{description:"Archived project"}):p.avatar?(0,i.jsx)("img",{src:ep.from(p.avatar).toString(),alt:"Tanatloc"}):(0,i.jsx)(C.default,{image:"images/empty.svg",description:"No preview yet."}),[p]),y=(0,r.useMemo)(()=>(0,i.jsxs)(W.default,{direction:"vertical",className:"".concat(el().fullWidth," ").concat(el().textAlignLeft),children:[(0,i.jsxs)(o.Z.Text,{children:[(0,i.jsx)("b",{children:"Created:"})," ",new Date(p.createddate).toLocaleDateString()]}),(0,i.jsxs)(o.Z.Text,{children:[(0,i.jsx)("b",{children:"Last modified:"})," ",new Date(p.lastaccess).toLocaleDateString()]}),p.description&&(0,i.jsx)(o.Z.Paragraph,{ellipsis:{rows:4,tooltip:!0},children:p.description})]}),[p]),j=(0,r.useMemo)(()=>{var e;return null===(e=p.owners)||void 0===e?void 0:e.map(e=>ed.Z.userToAvatar(e))},[p]),f=(0,r.useMemo)(()=>{var e;return null===(e=p.users)||void 0===e?void 0:e.map(e=>ed.Z.userToAvatar(e))},[p]),v=(0,r.useMemo)(()=>{var e;return null==p?void 0:null===(e=p.groups)||void 0===e?void 0:e.map(e=>ed.Z.groupToAvatar(e))},[p]);return(0,i.jsx)(M.Z,{title:(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(o.Z.Paragraph,{ellipsis:{rows:2,tooltip:!0},children:p.title}),p.archived&&(0,i.jsx)(V.Z,{children:"Archived"})]}),className:"".concat(ec().card," ").concat(p.archived?ec().cardArchived:""),cover:(0,i.jsxs)(J.Z,{className:ec().carousel,dots:{className:"dots"},children:[(0,i.jsx)("div",{className:"".concat(ec().carouselSnapshot," ").concat(p.archived?ec().carouselSnapshotArchived:""),onClick:w,children:x}),(0,i.jsx)("div",{className:"".concat(ec().carouselDescription," ").concat(p.archived?ec().carouselDescriptionArchived:""),onClick:w,children:y})]}),actions:[(0,i.jsx)(edit,{disabled:!(null==p?void 0:null===(a=p.owners)||void 0===a?void 0:a.find(e=>e.id===(null==d?void 0:d.id))),project:{id:p.id,title:p.title,description:p.description},swr:{mutateOneProject:h.mutateOneProject}},"edit"),(0,i.jsx)(G.ZP,{disabled:!(null==p?void 0:null===(t=p.owners)||void 0===t?void 0:t.find(e=>e.id===(null==d?void 0:d.id))),project:{id:p.id,title:p.title,groups:p.groups,users:p.users},organizations:m,swr:{mutateOneProject:h.mutateOneProject},style:{buttonDark:!0}},"share"),(0,i.jsx)(copy,{workspace:{id:u.id,projects:u.projects},project:{id:p.id},swr:{addOneProject:h.addOneProject,mutateOneWorkspace:h.mutateOneWorkspace}},"copy"),(0,i.jsx)(K.default,{trigger:["click"],menu:{items:[{key:"archive",label:(0,i.jsx)(archive,{disabled:!(null==p?void 0:null===(n=p.owners)||void 0===n?void 0:n.find(e=>e.id===(null==d?void 0:d.id))),workspace:{id:u.id},project:{archived:p.archived,id:p.id,title:p.title},swr:{mutateOneWorkspace:h.mutateOneWorkspace,mutateOneProject:h.mutateOneProject}},"archive")},{key:"delete",label:(0,i.jsx)(project_delete,{disabled:!(null==p?void 0:null===(l=p.owners)||void 0===l?void 0:l.find(e=>e.id===(null==d?void 0:d.id))),workspace:{id:u.id,projects:u.projects},project:{id:p.id,title:p.title},swr:{mutateOneWorkspace:h.mutateOneWorkspace,delOneProject:h.delOneProject}})}]},children:(0,i.jsx)(_(),{icon:(0,i.jsx)(Y.default,{}),className:el().noBorder})},"more")],children:(0,i.jsxs)("div",{style:{padding:"6px 0",display:"grid",gridTemplateColumns:"10fr 1fr 20fr",gridTemplateRows:"auto auto"},children:[(0,i.jsx)("div",{children:"Admin:"}),(0,i.jsx)("div",{}),(0,i.jsx)("div",{children:"Shared with:"}),(0,i.jsx)(R.ZP.Group,{maxCount:5,children:j}),(0,i.jsx)(N.Z,{type:"vertical",style:{height:"80%",borderColor:"#f0f0f0"}}),(0,i.jsxs)(R.ZP.Group,{children:[f,v]})]})},p.id)};var list=e=>{let{user:a,page:t,workspace:s,projects:n,organizations:l,filter:o,sorter:d,swr:u}=e,c=(0,r.useRef)(null),[p,m]=(0,r.useState)(!0),[h,g]=(0,r.useState)([]),[w,x]=(0,r.useState)(100),y=(0,r.useCallback)(()=>{let e=c.current;if(!e){setTimeout(()=>y(),100);return}let a=e.getBoundingClientRect(),t=a.top,i=window.innerHeight,s=i-t;s!==w&&x(s)},[w]);return((0,r.useEffect)(()=>(window.addEventListener("resize",y),y(),()=>{window.removeEventListener("resize",y)}),[y]),(0,r.useEffect)(()=>{let e=n.map(e=>{var a,t;if(!o||(null===(t=e.title)||void 0===t?void 0:null===(a=t.toLowerCase())||void 0===a?void 0:a.includes(o.toLowerCase())))return e}).filter(e=>e);switch(d){case"alphaAsc":e.sort((e,a)=>e.title.localeCompare(a.title));break;case"alphaDesc":e.sort((e,a)=>-1*e.title.localeCompare(a.title));break;case"modifiedDesc":e.sort((e,a)=>new Date(a.lastaccess).getTime()-new Date(e.lastaccess).getTime())}g(e),m(!1)},[n,o,d]),p||u.loadingProjects)?(0,i.jsx)(b.Z.Simple,{}):h.length?(0,i.jsx)("div",{ref:c,style:{height:w},children:(0,i.jsx)(W.default,{style:{marginBottom:"20px"},wrap:!0,align:"start",size:20,children:h.map(e=>(0,i.jsx)(ProjectCard,{user:a,workspace:s,page:t,project:e,organizations:l,swr:u},e.id))})}):(0,i.jsx)(C.default,{image:"images/empty.svg",className:ec().empty,description:o?(0,i.jsxs)(i.Fragment,{children:["No project found with the current search"," ",(0,i.jsx)("span",{className:ec().emptySearch,children:o}),"..."]}):(0,i.jsx)(i.Fragment,{children:"No project for now... Get started!"})})};let em={update:"Unable to update workspace"},edit_onEdit=async(e,a,t,i)=>{try{let i=ed.Z.deepCopy(e);e.name=a.name,await D.Z.update({id:e.id},[{key:"name",value:a.name}]),await t.mutateOneWorkspace(i)}catch(e){throw i((0,f.iT)({title:em.update,err:e})),e}};var workspace_edit=e=>{let{workspace:a,swr:t}=e,s=(0,r.useRef)(null),[n,l]=(0,r.useState)(!1),[o,d]=(0,r.useState)(!1),{dispatch:u}=(0,r.useContext)(j.uj);(0,r.useEffect)(()=>{s.current&&s.current.focus()});let c=(0,r.useCallback)(()=>l(!0),[]),p=(0,r.useCallback)(()=>l(!1),[]),m=(0,r.useCallback)(async e=>{d(!0);try{await edit_onEdit(a,e,t,u),d(!1),l(!1)}catch(e){throw d(!1),e}},[a,t,u]);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(q.w6,{bordered:!0,dark:!0,onEdit:c}),(0,i.jsx)(E.ZP,{visible:n,loading:o,title:"Edit the workspace",initialValues:{name:a.name},onCancel:p,onOk:m,children:(0,i.jsx)(Z.Z.Item,{label:"Name",name:"name",rules:[{required:!0,message:"Name is required"},{max:50,message:"Max 50 characters"}],children:(0,i.jsx)(O.default,{ref:s,placeholder:"Workspace's name"})})})]})};let eh={del:"Unable to delete workspace"},delete_onDelete=async(e,a,t)=>{try{await D.Z.del({id:e.id}),await a.delOneWorkspace({id:e.id})}catch(e){throw t((0,f.iT)({title:eh.del,err:e})),e}};var workspace_delete=e=>{let{workspace:a,swr:t}=e,[n,l]=(0,r.useState)(!1),{dispatch:o}=(0,r.useContext)(j.uj),d=(0,s.useRouter)(),u=(0,r.useCallback)(async()=>{l(!0);try{await delete_onDelete(a,t,o),await d.push({pathname:"/dashboard",query:{page:"workspaces"}})}finally{l(!1)}},[d,a,t,o]);return(0,i.jsx)(q.m1,{bordered:!0,loading:n,text:"The projects contained in this workspace will be lost.",onDelete:u})},eg=t(55255),ew=t.n(eg);let ex={projects:"Error while loading projects"};var components_workspace=e=>{var a,t,s,l,o,d;let{user:u,page:c,workspace:p,organizations:m,swr:h}=e,[g,w]=(0,r.useState)(),[x,y]=(0,r.useState)(),{dispatch:v}=(0,r.useContext)(j.uj),[b,{addOneProject:k,delOneProject:_,mutateOneProject:C,errorProjects:Z,loadingProjects:S}]=H.Z.useProjects(null==p?void 0:p.projects);(0,r.useEffect)(()=>{Z&&v((0,f.iT)({title:ex.projects,err:Z}))},[Z,v]);let T=(0,r.useCallback)(e=>w(e.target.value),[]);return(0,i.jsxs)(n.Z,{className:el().noScroll,children:[(0,i.jsx)(pageHeader,{footer:(0,i.jsxs)(W.default,{direction:"horizontal",size:"large",className:"".concat(ew().search," ").concat(el().fullWidth),children:[(0,i.jsx)(O.default,{placeholder:"Enter a project name (case sensitive)",value:g,onChange:T,style:{width:500},suffix:(0,i.jsx)(L.default,{className:el().textLight})}),(null==p?void 0:null===(a=p.owners)||void 0===a?void 0:a.find(e=>e.id===u.id))?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(project_add,{workspace:{id:p.id,projects:p.projects},swr:{mutateOneWorkspace:h.mutateOneWorkspace,addOneProject:k}}),(0,i.jsxs)(W.default,{size:8,children:[(0,i.jsx)(workspace_edit,{workspace:{id:p.id,name:p.name},swr:{mutateOneWorkspace:h.mutateOneWorkspace}}),(0,i.jsx)(G.ZP,{workspace:{id:p.id,name:p.name,groups:p.groups,users:p.users},organizations:m,swr:{mutateOneWorkspace:h.mutateOneWorkspace},style:{buttonDark:!0,buttonBordered:!0}}),(0,i.jsx)(workspace_delete,{workspace:{id:p.id},swr:{delOneWorkspace:h.delOneWorkspace}})]})]}):(0,i.jsx)("div",{})]}),children:(null===(t=p.users)||void 0===t?void 0:t.length)||(null===(s=p.groups)||void 0===s?void 0:s.length)?(0,i.jsxs)("div",{className:ew().shared,children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("span",{style:{marginRight:"10px"},children:"Admin:"}),(0,i.jsx)(R.ZP.Group,{maxCount:5,children:null===(l=p.owners)||void 0===l?void 0:l.map(e=>ed.Z.userToAvatar(e))})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("span",{style:{marginRight:"10px"},children:"Shared with:"}),(0,i.jsx)(R.ZP.Group,{maxCount:5,children:null===(o=p.users)||void 0===o?void 0:o.map(e=>ed.Z.userToAvatar(e))}),(0,i.jsx)(R.ZP.Group,{maxCount:5,children:null===(d=p.groups)||void 0===d?void 0:d.map(e=>ed.Z.groupToAvatar(e))})]})]}):void 0}),(0,i.jsx)(z.default,{className:ew().tabs,items:[{key:"modifiedDesc",label:"Last modified"},{key:"alphaAsc",label:"Name (A-Z)"},{key:"alphaDesc",label:"Name (Z-A)"}],defaultActiveKey:"modifiedDesc",onChange:y}),(0,i.jsx)(n.Z.Content,{className:el().scroll,children:(0,i.jsx)(list,{user:u,page:c,workspace:{id:p.id,projects:p.projects},projects:b,organizations:m,filter:g,sorter:x,swr:{addOneProject:k,mutateOneWorkspace:h.mutateOneWorkspace,delOneProject:_,mutateOneProject:C,loadingProjects:S}})})]})},ey=t(56590),ej=t(91724),ef=t(57632),ev=t(28456),eb=t(42095),ek=t(81229),e_=t(48764).lW;let eC={addWorkspace:"Unable to add workspace",addProject:"Unable to add project",addGeometry:"Unable to add geometry"},_onWorkspaceAdd=async(e,a)=>{try{let a=await D.Z.add(e);return a}catch(e){throw a((0,f.iT)({title:eC.addWorkspace,err:e})),e}},_onProjectAdd=async(e,a,t)=>{try{let t=await H.Z.add({id:e.id},a);return t}catch(e){throw t((0,f.iT)({title:eC.addProject,err:e})),e}},sample_getFile=async()=>{let e=await fetch("/doc/cube.stp"),a=await e.blob(),t=new FileReader;return new Promise(e=>{t.addEventListener("load",()=>{e(t.result)}),t.readAsArrayBuffer(a)})},_onGeometryAdd=async(e,a)=>{let t=await sample_getFile();try{let a=await eb.Z.add({id:e.id},{name:"cube.stp",uid:(0,ef.Z)(),buffer:e_.from(t)});return a}catch(e){throw a((0,f.iT)({title:eC.addGeometry,err:e})),e}},_onSimulationAdd=async(e,a,t,i)=>{try{var s,r,n,l;let i=ev.Z.find(e=>"poisson"===e.algorithm);i.configuration.geometry.value=t.id,i.configuration.geometry.done=!0,i.configuration.parameters.done=!0,i.configuration.boundaryConditions.dirichlet.values=[{uuid:"0",name:"Boundary 0",type:{key:"dirichlet",label:"Dirichlet",children:[{label:"u",htmlEntity:"formula",default:"0"}]},geometry:t.id,selected:[{label:2,uuid:null===(r=t.summary.faces)||void 0===r?void 0:null===(s=r.find(e=>2===e.label))||void 0===s?void 0:s.uuid}],values:[{checked:!0,value:0}]},{uuid:"1",name:"Boundary 1",type:{key:"dirichlet",label:"Dirichlet",children:[{label:"u",htmlEntity:"formula",default:"0"}]},geometry:t.id,selected:[{label:4,uuid:null===(l=t.summary.faces)||void 0===l?void 0:null===(n=l.find(e=>4===e.label))||void 0===n?void 0:n.uuid}],values:[{checked:!0,value:1}]}],i.configuration.boundaryConditions.done=!0;let o=e.plugins.find(e=>"local"===e.key);i.configuration.run.cloudServer=o;let d=await ek.Z.add({id:a.id},{name:i.name,scheme:i});return d}catch(e){throw i((0,f.iT)({title:eC.addProject,err:e})),e}};var sample=e=>{let{visible:a,setVisible:t,user:n,swr:l}=e,[o,d]=(0,r.useState)(!1),{dispatch:u}=(0,r.useContext)(j.uj),c=(0,s.useRouter)(),p=(0,r.useCallback)(()=>t(!1),[t]),m=(0,r.useCallback)(async()=>{d(!0);try{let e=await _onWorkspaceAdd({name:"Example Workspace"},u),a=await _onProjectAdd(e,{title:"Example Project",description:"This is an example project solving the Poisson's equation"},u),t=await _onGeometryAdd(a,u);await _onSimulationAdd(n,a,t,u),l.addOneWorkspace(e),d(!1),p(),await c.push({pathname:"/dashboard",query:{page:"workspaces",workspaceId:e.id}})}catch(e){throw d(!1),e}},[c,n,l,p,u]),h=(0,r.useCallback)(e=>(0,i.jsx)(ey.Z.Item,{children:e&&(0,i.jsxs)("div",{children:[(0,i.jsx)(ej.Z,{style:{margin:"0 10px"}}),e]})}),[]);return(0,i.jsx)(E.ZP,{visible:a,loading:o,title:"Sample workspace",onCancel:p,onOk:m,children:(0,i.jsxs)(i.Fragment,{children:["Create a new workspace with predefined configuration:",(0,i.jsx)(ey.Z,{dataSource:["","Cube geometry","Poisson's equation","0 & 1 dirichlet boundary conditions","Local computing server",""],renderItem:h}),"You just have to run the simulation!"]})})},eZ=t(66172),eO=t.n(eZ);let ez={add:"Unable to add workspace"},_onOk=async(e,a,t,i)=>{try{let i=await D.Z.add(a);await t.addOneWorkspace(i),await e.push({pathname:"/dashboard",query:{page:"workspaces",workspaceId:i.id}}).catch()}catch(e){throw i((0,f.iT)({title:ez.add,err:e})),e}};var workspace_list=e=>{let{user:a,workspaces:t,organizations:l,swr:d}=e,u=(0,r.useRef)(null),[c,p]=(0,r.useState)(!1),[m,h]=(0,r.useState)(!1),[g,w]=(0,r.useState)(!1),{dispatch:x}=(0,r.useContext)(j.uj),y=(0,s.useRouter)(),{page:f,workspaceId:v}=y.query;(0,r.useEffect)(()=>{u.current&&u.current.focus()});let b=(0,r.useCallback)(()=>{p(!1)},[]),k=(0,r.useCallback)(()=>{w(!0)},[]),N=(0,r.useCallback)(e=>{(async()=>{"add"===e?p(!0):"sample"===e?w(!0):await y.push({pathname:"/dashboard",query:{page:"workspaces",workspaceId:e}})})()},[y]),I=(0,r.useCallback)(async e=>{h(!0);try{await _onOk(y,e,d,x),h(!1),p(!1)}catch(e){throw h(!1),e}},[y,d,x]);return(0,i.jsxs)(n.Z,{className:"".concat(eO().inDashboard," ").concat(el().noScroll),children:[(0,i.jsx)(pageHeader,{title:(0,i.jsx)(o.Z.Title,{level:2,style:{marginBottom:"0 !important"},children:"Workspaces"})}),(0,i.jsxs)(n.Z.Content,{className:el().noScroll,children:[(0,i.jsx)(sample,{visible:g,setVisible:w,user:a,swr:{addOneWorkspace:d.addOneWorkspace}}),t.length?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(E.ZP,{visible:c,loading:m,title:"Create a new workspace",onCancel:b,onOk:I,children:(0,i.jsx)(Z.Z.Item,{label:"Name",name:"name",rules:[{required:!0,message:"Name is required"},{max:50,message:"Max 50 characters"}],children:(0,i.jsx)(O.default,{ref:u,placeholder:"Workspace's name"})})}),(0,i.jsx)(z.default,{type:"editable-card",hideAdd:!0,className:"".concat(el().noScroll," ").concat(eO().inDashboardTabs," ").concat(ew().tabs),items:[...t.map(e=>({key:e.id,label:e.name,css:el().noScroll,closable:!1,children:(0,i.jsx)(components_workspace,{user:a,page:null!=f?f:az.workspaces.key,workspace:{id:e.id,name:e.name,projects:e.projects,owners:e.owners,users:e.users,groups:e.groups},organizations:l,swr:{delOneWorkspace:d.delOneWorkspace,mutateOneWorkspace:d.mutateOneWorkspace}})})),{key:"add",label:(0,i.jsx)(S.default,{title:"New workspace",children:(0,i.jsx)(A.default,{})}),closable:!1},{key:"sample",label:(0,i.jsx)(S.default,{title:"Sample workspace",children:(0,i.jsx)(T.Z,{})}),closable:!1}],defaultActiveKey:"1",activeKey:v,onChange:N})]}):(0,i.jsx)(i.Fragment,{children:(0,i.jsxs)(C.default,{className:ew().empty,image:"images/empty.svg",description:"No workspace for now. Get started !",children:[(0,i.jsx)(add,{swr:{addOneWorkspace:d.addOneWorkspace}}),(0,i.jsx)(_(),{type:"primary",icon:(0,i.jsx)(P.Z,{}),onClick:k,children:"Create a sample workspace"})]})})]})]})},eS=t(35855),eT=t(46403),eP=t(27756),eA=t(77547),eE=t(40144),eN=t(5957),eI=t(82657),eU=t.n(eI),eD=t(48764).lW;let eq={update:"Unable to update informations",upload:"Unable to upload image",badFormat:"Supported formats: jpg, png",badSize:"Image must be smaller than 5MB"},_beforeUpload=(e,a)=>{let t="image/jpeg"===e.type||"image/png"===e.type;t||a((0,f.iT)({title:eq.badFormat}));let i=e.size/1024/1024<1;return i||a((0,f.iT)({title:eq.badSize})),t&&i},_getBase64=async e=>{let a=new FileReader;return new Promise(t=>{a.addEventListener("load",()=>{t(a.result)}),a.readAsDataURL(e)})},_onChange=async(e,a,t,i)=>{if("uploading"===a.file.status)return!0;if("done"!==a.file.status)return!1;try{let t=await _getBase64(a.file.originFileObj);await eN.Z.add({name:a.file.name,uid:a.file.uid,data:t}),await i.mutateUser({...e,avatar:eD.from(t)})}catch(e){t((0,f.iT)({title:eq.upload,err:e}))}return!1},_onFinish=async(e,a,t,i)=>{try{let s=[];if(e.email!==a.email&&s.push({key:"email",value:a.email}),e.firstname!==a.firstname&&s.push({key:"firstname",value:a.firstname}),e.lastname!==a.lastname&&s.push({key:"lastname",value:a.lastname}),!s.length)return;await eE.Z.update(s),await i.mutateUser({email:a.email,firstname:a.firstname,lastname:a.lastname}),s.find(e=>"email"===e.key)&&t((0,f.$E)({title:"Changes saved",description:"A validation email has been send to "+a.email}))}catch(e){throw new eA.H({title:eq.update,err:e})}};var information=e=>{var a,t;let{user:s,swr:n}=e,[l,o]=(0,r.useState)(!1),[d,u]=(0,r.useState)(!1),[c,p]=(0,r.useState)(),{dispatch:m}=(0,r.useContext)(j.uj),h=(0,r.useCallback)(e=>_beforeUpload(e,m),[m]),g=(0,r.useCallback)(e=>{(async()=>{let a=await _onChange(s,e,m,n);o(a)})()},[s,n,m]),w=(0,r.useCallback)(e=>{(async()=>{u(!0);try{await _onFinish(s,e,m,n),p(void 0)}catch(e){p(e)}finally{u(!1)}})()},[s,n,m]);return(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(M.Z,{title:"Contact Details",children:(0,i.jsxs)(W.default,{direction:"horizontal",className:eU().information,children:[(0,i.jsxs)("div",{className:eU().avatar,children:[(0,i.jsx)(R.ZP,{size:128,src:s.avatar&&eD.from(s.avatar).toString(),icon:(0,i.jsx)(eT.Z,{})}),(0,i.jsx)(ee.Z,{action:"/api/noop",accept:".jpg,.png",showUploadList:!1,beforeUpload:h,onChange:g,children:(0,i.jsx)(_(),{loading:l,icon:(0,i.jsx)(eS.Z,{}),children:"Upload new"})})]}),(0,i.jsx)("div",{className:eU().form,children:(0,i.jsxs)(Z.Z,{labelCol:{span:4},style:{maxWidth:500},initialValues:{email:s.email,firstname:null!==(a=s.firstname)&&void 0!==a?a:"",lastname:null!==(t=s.lastname)&&void 0!==t?t:""},onFinish:w,children:[(0,i.jsx)(Z.Z.Item,{label:"Email",name:"email",rules:[{max:50,message:"Max 50 characters"}],children:(0,i.jsx)(O.default,{disabled:x()()})}),(0,i.jsx)(Z.Z.Item,{label:"First name",name:"firstname",rules:[{max:50,message:"Max 50 characters"}],children:(0,i.jsx)(O.default,{})}),(0,i.jsx)(Z.Z.Item,{label:"Last name",name:"lastname",rules:[{max:50,message:"Max 50 characters"}],children:(0,i.jsx)(O.default,{})}),(0,i.jsx)(eP.Xq,{error:c}),(0,i.jsx)(Z.Z.Item,{wrapperCol:{offset:4},children:(0,i.jsx)(_(),{loading:d,type:"primary",htmlType:"submit",children:"Save changes"})})]})})]})})})},eF=t(55798);let eR={check:"Unable to check password",update:"Unable to update password",passwordMismatch:"Password and confirmation mismatch",invalid:"Current password is not valid"},password_onFinish=async(e,a,t)=>{let i;try{i=await eE.Z.check({email:e.email,password:a.password})}catch(e){throw new eA.H({title:eR.check,err:e})}if(!i.valid)throw new eA.H({title:eR.invalid});try{await eE.Z.update([{type:"crypt",key:"password",value:a.newPassword}]),t((0,f.$E)({title:"Your password has been changed successfully"}))}catch(e){throw new eA.H({title:eR.update,err:e})}};var account_password=e=>{let{user:a}=e,[t,s]=(0,r.useState)(!1),[n,l]=(0,r.useState)(),{dispatch:o}=(0,r.useContext)(j.uj),d=(0,r.useCallback)(e=>{(async()=>{s(!0);try{await password_onFinish(a,e,o),l(void 0)}catch(e){l(e)}finally{s(!1)}})()},[a,o]);return(0,i.jsx)(M.Z,{title:"Your Password",children:(0,i.jsxs)(Z.Z,{labelCol:{offset:2},wrapperCol:{offset:2},style:{maxWidth:500},layout:"vertical",onFinish:d,name:"passwordForm",children:[(0,i.jsx)(Z.Z.Item,{label:"Current password",name:"password",rules:[{required:!0,message:"Current password is required"}],children:(0,i.jsx)(O.default.Password,{placeholder:"Current password"})}),(0,i.jsx)(eF.o,{name:"newPassword",label:"New password",inputPlaceholder:"Enter a new password",required:!0}),(0,i.jsx)(Z.Z.Item,{label:"Password confirmation",name:"passwordConfirm",rules:[{required:!0,message:"Password confirmation is required"},e=>{let{getFieldValue:a}=e;return{validator:(e,t)=>t&&a("newPassword")!==t?Promise.reject(eR.passwordMismatch):Promise.resolve()}}],children:(0,i.jsx)(O.default.Password,{placeholder:"Confirm your new password"})}),(0,i.jsx)(eP.Xq,{error:n}),(0,i.jsx)(Z.Z.Item,{children:(0,i.jsx)(W.default,{children:(0,i.jsx)(_(),{type:"primary",htmlType:"submit",loading:t,children:"Modify password"})})})]})})};let eW=x()()?"http://localhost:3000":"",logout=async()=>{await fetch(eW+"/api/logout")},eL={del:"Unable to delete user"},account_delete_onDelete=async(e,a)=>{try{await eE.Z.del(),await logout(),await e.clearUser()}catch(e){throw a((0,f.iT)({title:eL.del,err:e})),e}};var account_delete=e=>{let{swr:a}=e,[t,s]=(0,r.useState)(!1),{dispatch:n}=(0,r.useContext)(j.uj),l=(0,r.useCallback)(async()=>{s(!0);try{await account_delete_onDelete(a,n)}finally{s(!1)}},[a,n]);return(0,i.jsx)(M.Z,{title:"Delete your account",children:(0,i.jsx)(q.m1,{title:"Delete your account",text:"This action cannot be undone. If you delete your account, you will permanently lose your workspaces and projects.",bordered:!0,loading:t,onDelete:l,children:"Delete your account"})})},eG=t(89552),eH=t(70459),eB=t(66769),eM=t(64749),eJ=t(47311);let eK={update:"Unable to update plugins"},_inputItem=(e,a,t)=>{var s;return(0,i.jsx)(Z.Z.Item,{name:a,label:e.label,htmlFor:"input-"+a,tooltip:e.tooltip,rules:e.rules,children:(0,i.jsx)(O.default,{ref:t,id:"input-"+a,autoComplete:"off",...null!==(s=e.props)&&void 0!==s?s:{}})},a)},_textareaItem=(e,a)=>{var t;return(0,i.jsx)(Z.Z.Item,{name:a,label:e.label,htmlFor:"input-"+a,tooltip:e.tooltip,rules:e.rules,children:(0,i.jsx)(O.default.TextArea,{id:"input-"+a,autoComplete:"off",...null!==(t=e.props)&&void 0!==t?t:{}})},a)},_passwordItem=(e,a)=>{var t;return(0,i.jsx)(Z.Z.Item,{name:a,label:e.label,htmlFor:"input-"+a,tooltip:e.tooltip,rules:e.rules,children:(0,i.jsx)(O.default,{id:"input-"+a,type:"password",autoComplete:"off",...null!==(t=e.props)&&void 0!==t?t:{}})},a)},_selectItem=(e,a)=>(0,i.jsx)(Z.Z.Item,{name:a,label:e.label,htmlFor:"select-"+a,tooltip:e.tooltip,rules:e.rules,children:(0,i.jsx)(eM.default,{id:"select-"+a,children:e.options.map(a=>{var t;return(0,i.jsx)(eM.default.Option,{value:a,...null!==(t=e.props)&&void 0!==t?t:{},children:a},a)})})},a),dialog_onFinish=async(e,a,t,i,s)=>{try{var r,n;if(a){let a=ed.Z.deepCopy(e);Object.keys(t).forEach(e=>{a.configuration[e].value=t[e]}),a.needReInit=!0,await eB.Z.update(a),await (null===(r=i.mutateOnePlugin)||void 0===r?void 0:r.call(i,a))}else{let a=ed.Z.deepCopy(e);a.uuid="add",Object.keys(t).forEach(e=>{a.configuration[e].value=t[e]}),await eB.Z.add(a),await (null===(n=i.addOnePlugin)||void 0===n?void 0:n.call(i,a))}}catch(e){throw s((0,f.iT)({title:eK.update,err:e})),e}};var plugin_dialog=e=>{var a;let{plugin:t,swr:s,edit:n}=e,l=(0,r.useRef)(null),[d,u]=(0,r.useState)(!1),[c,p]=(0,r.useState)(!1),[m,h]=(0,r.useState)({}),{dispatch:g}=(0,r.useContext)(j.uj);(0,r.useEffect)(()=>{let e={};Object.keys(t.configuration).forEach(a=>{var i;e[a]=null!==(i=t.configuration[a].value)&&void 0!==i?i:t.configuration[a].default}),h(e)},[null==t?void 0:t.configuration]),(0,r.useEffect)(()=>{l.current&&l.current.focus()});let w=(0,r.useCallback)(()=>{u(!0)},[]),x=(0,r.useCallback)(()=>{u(!1)},[]),y=(0,r.useCallback)(async e=>{p(!0);try{await dialog_onFinish(t,!!n,e,s,g),p(!1),u(!1)}catch(e){throw p(!1),e}},[t,s,n,g]),f=(0,r.useMemo)(()=>Object.keys(t.configuration).map((e,a)=>{let s=t.configuration[e];return"input"===s.type?_inputItem(s,e,0===a?l:void 0):"textarea"===s.type?_textareaItem(s,e):"password"===s.type?_passwordItem(s,e):"select"===s.type?_selectItem(s,e):(0,i.jsx)("div",{},e)}),[t.configuration]);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(E.ZP,{title:t.name,visible:d,initialValues:m,onCancel:x,onOk:y,loading:c,children:(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(o.Z.Text,{children:(0,eJ.ZP)(null!==(a=t.description)&&void 0!==a?a:"")}),f]})}),n?(0,i.jsx)(q.w6,{onEdit:w,children:"Edit"}):(0,i.jsxs)(q.HS,{onAdd:w,children:["Add a new \xab",t.name,"\xbb configuration"]})]})};let eV={del:"Unable to delete plugin"},plugin_delete_onDelete=async(e,a,t)=>{try{await eB.Z.del({uuid:e.uuid}),await a.delOnePlugin(e)}catch(e){throw t((0,f.iT)({title:eV.del,err:e})),e}};var plugin_delete=e=>{var a;let{plugin:t,swr:s}=e,[n,l]=(0,r.useState)(!1),{dispatch:d}=(0,r.useContext)(j.uj),u=(0,r.useCallback)(async()=>{l(!0);try{await plugin_delete_onDelete(t,s,d)}finally{l(!1)}},[t,s,d]);return(0,i.jsx)(q.m1,{loading:n,title:"Delete plugin",text:(0,i.jsxs)(i.Fragment,{children:["Are you sure you want to delete the plugin"," ",(0,i.jsx)(o.Z.Text,{strong:!0,children:null===(a=t.configuration.name)||void 0===a?void 0:a.value}),"?"]}),onDelete:u,children:"Delete"})},eY=t(80842);let eQ={refresh:"Unable to refresh plugin"},_onUpdate=async(e,a)=>{try{let a=ed.Z.deepCopy(e);a.needReInit=!0,await eB.Z.update(a)}catch(e){a((0,f.iT)({title:eQ.refresh,err:e}))}};var refresh=e=>{let{plugin:a}=e,[t,s]=(0,r.useState)(!1),{dispatch:n}=(0,r.useContext)(j.uj),l=(0,r.useCallback)(()=>{(async()=>{s(!0),await _onUpdate(a,n),s(!1)})()},[a,n]);return(0,i.jsx)(_(),{loading:t,icon:(0,i.jsx)(eY.Z,{}),onClick:l,className:"".concat(el().noBackground," ").concat(el().noBorder),children:"Refresh"},"refresh")},plugin_list=e=>{let{plugin:a,plugins:t,swr:s}=e,[n,l]=(0,r.useState)([]);return(0,r.useEffect)(()=>{let e=t.map(e=>{var t,r;if(e.key!==a.key)return;let n=e.configuration,l=Object.keys(n).map(e=>{let a;if("name"!==e){if("textarea"===n[e].type){let t=n[e].value;a=(0,i.jsx)(o.Z.Paragraph,{children:(0,i.jsx)("pre",{children:(0,i.jsx)("code",{children:t})})})}else if("password"===n[e].type)a=(0,i.jsx)(o.Z.Text,{children:"******"});else{var t;a=(0,i.jsx)(o.Z.Text,{children:null!==(t=n[e].value)&&void 0!==t?t:"unset"})}return(0,i.jsxs)(o.Z.Paragraph,{children:[(0,i.jsxs)(o.Z.Text,{strong:!0,children:[n[e].label,":"]})," ",a]},e)}}).filter(e=>e),d=[];return d.push((0,i.jsx)(plugin_delete,{plugin:{uuid:e.uuid,configuration:e.configuration},swr:{delOnePlugin:s.delOnePlugin}},"delete")),e.haveInit&&d.push((0,i.jsx)(refresh,{plugin:e})),d.push((0,i.jsx)(plugin_dialog,{plugin:e,swr:{mutateOnePlugin:s.mutateOnePlugin},edit:!0},"plugin")),(0,i.jsx)(M.Z,{title:null===(t=n.name)||void 0===t?void 0:t.value,actions:d,children:(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(o.Z.Text,{children:(0,eJ.ZP)(null!==(r=e.description)&&void 0!==r?r:"")}),l.length?l:(0,i.jsx)(o.Z.Text,{children:"No configuration data"})]})},e.uuid)}).filter(e=>e);l(e)},[a,t,s]),(0,i.jsx)(W.default,{direction:"horizontal",wrap:!0,size:20,children:n})};let e$={plugins:"Error while loading plugins"};var hpc_plugin=e=>{let{plugin:a}=e,[t,{addOnePlugin:s,delOnePlugin:n,mutateOnePlugin:l,errorPlugins:o,loadingPlugins:d}]=eB.Z.usePlugins(),{dispatch:u}=(0,r.useContext)(j.uj);return((0,r.useEffect)(()=>{o&&u((0,f.iT)({title:e$.plugins,err:o}))},[o,u]),d)?(0,i.jsx)(eG.default,{}):(0,i.jsxs)(W.default,{direction:"vertical",className:el().fullWidth,children:[(0,i.jsx)(plugin_dialog,{plugin:a,swr:{addOnePlugin:s}}),(0,i.jsx)(plugin_list,{plugin:{key:a.key},plugins:t,swr:{delOnePlugin:n,mutateOnePlugin:l}})]})};let eX={plugins:"Unable to load plugins"},_pluginsList=async e=>{try{let e=await eH.Z.list(),a=e.filter(e=>"HPC"===e.category);if(a.length)return a.map(e=>(0,i.jsx)(M.Z,{title:e.name,children:(0,i.jsx)(hpc_plugin,{plugin:e})},e.key));return[(0,i.jsx)(M.Z,{title:"No access",children:"You do not have access to any HPC plugin. Request it."},"no-access")]}catch(a){return e((0,f.iT)({title:eX.plugins,err:a})),[(0,i.jsx)(M.Z,{title:"Error",children:"Something led to an error. Please try again later."},"error")]}};var hpc=()=>{let e=(0,r.useRef)(null),[a,t]=(0,r.useState)([(0,i.jsx)(M.Z,{title:"Loading",children:(0,i.jsx)(eG.default,{})},"loading")]),[s,n]=(0,r.useState)(100),{dispatch:l}=(0,r.useContext)(j.uj),o=(0,r.useCallback)(()=>{let a=e.current;if(!a){setTimeout(()=>o(),100);return}let t=a.getBoundingClientRect(),i=t.top,r=window.innerHeight,l=r-i;l!==s&&n(l)},[s]);return(0,r.useEffect)(()=>{(async()=>{let e=await _pluginsList(l);t(e)})()},[l]),(0,r.useEffect)(()=>(window.addEventListener("resize",o),o(),()=>{window.removeEventListener("resize",o)}),[o]),(0,i.jsx)(W.default,{ref:e,direction:"vertical",className:"".concat(el().fullWidth," ").concat(el().scroll),size:20,style:{height:s-20},children:a})},account=e=>{let{user:a,swr:t}=e,l=(0,s.useRouter)(),{tab:d}=l.query,u=(0,r.useMemo)(()=>[{key:"personal",label:"Personal Information",children:(0,i.jsxs)(W.default,{direction:"vertical",className:el().fullWidth,size:20,children:[(0,i.jsx)(information,{user:{email:a.email,firstname:a.firstname,lastname:a.lastname,avatar:a.avatar},swr:{mutateUser:t.mutateUser}}),!x()()&&(0,i.jsx)(account_delete,{swr:{clearUser:t.clearUser}})]})},x()()?null:{key:"security",label:"Security",children:(0,i.jsx)(W.default,{direction:"vertical",className:el().fullWidth,size:20,children:(0,i.jsx)(account_password,{user:{email:a.email}})})},{key:"hpc",label:"HPC Providers",children:(0,i.jsx)(hpc,{})}].filter(e=>e),[a,t]),c=(0,r.useCallback)(e=>{(async()=>{await l.replace({pathname:"/dashboard",query:{page:"account",tab:e}})})()},[l]);return(0,i.jsxs)(n.Z,{className:"".concat(el().noScroll," ").concat(eO().inDashboard),children:[(0,i.jsx)(pageHeader,{title:(0,i.jsx)(o.Z.Title,{level:2,style:{marginBottom:"0 !important"},children:"Account Settings"})}),(0,i.jsx)(n.Z.Content,{className:el().noScroll,children:(0,i.jsx)(z.default,{className:"".concat(el().noScroll," ").concat(eO().inDashboardTabs),type:"card",items:u,defaultActiveKey:null!=d?d:"personal",onChange:c})})]})},e0=t(85317),e1=t(91326),e5=t(2307);let e4={add:"Unable to add user",existing:"This user already exists or its invite is pending"},_checkAlreadyAdded=(e,a)=>{var t,i,s,r,n,l;let o=null===(t=a.owners)||void 0===t?void 0:t.find(a=>a.email===e.email),d=null===(i=a.pendingowners)||void 0===i?void 0:i.find(a=>a.email===e.email),u=null===(s=a.users)||void 0===s?void 0:s.find(a=>a.email===e.email),c=null===(r=a.pendingusers)||void 0===r?void 0:r.find(a=>a.email===e.email);return null!==(l=null!==(n=null!=o?o:d)&&void 0!==n?n:u)&&void 0!==l?l:c},add_onFinish=async(e,a,t,i,s)=>{let r=_checkAlreadyAdded(t,e);if(r)throw s((0,f.iT)({title:e4.existing})),Error(e4.existing);try{await e1.Z.update(e,[{key:a,type:"array",method:"append",value:t.email.trim()}]);let s=ed.Z.deepCopy(e);s[a]=[...s[a],{email:t.email}],await i.mutateOneOrganization(s)}catch(e){throw s((0,f.iT)({title:e4.add,err:e})),e}};var users_add=e=>{let{title:a,organization:t,dBkey:s,swr:n}=e,l=(0,r.useRef)(null),[o,d]=(0,r.useState)(!1),[u,c]=(0,r.useState)(!1),{dispatch:p}=(0,r.useContext)(j.uj);(0,r.useEffect)(()=>{l.current&&l.current.focus()});let m=(0,r.useCallback)(()=>d(!0),[]),h=(0,r.useCallback)(()=>d(!1),[]),g=(0,r.useCallback)(async e=>{c(!0);try{await add_onFinish(t,s,e,n,p),c(!1),d(!1)}catch(e){throw c(!1),e}},[t,s,n,p]);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(E.ZP,{visible:o,loading:u,title:a,onCancel:h,onOk:g,children:(0,i.jsx)(Z.Z.Item,{name:"email",label:"Email",rules:[{required:!0,message:"Email is required"}],children:(0,i.jsx)(O.default,{ref:l})})}),(0,i.jsx)(q.HS,{onAdd:m,children:a})]})};let e2={del:"Unable to delete user"},users_delete_onDelete=async(e,a,t,i,s)=>{try{await e1.Z.update(a,[{key:t,type:"array",method:"remove",value:e.id}]);let s=ed.Z.deepCopy(a);s[t]=s[t].filter(a=>a.id!==e.id),await i.mutateOneOrganization(s)}catch(e){throw s((0,f.iT)({title:e2.del,err:e})),e}};var users_delete=e=>{let{disabled:a,user:t,organization:s,dBkey:n,swr:l}=e,[d,u]=(0,r.useState)(!1),{dispatch:c}=(0,r.useContext)(j.uj),p=(0,r.useCallback)(e=>e.firstname||e.lastname?e.firstname+" "+e.lastname:e.email,[]),m=(0,r.useCallback)(async()=>{u(!0);try{await users_delete_onDelete(t,s,n,l,c)}finally{u(!1)}},[t,s,n,l,c]);return(0,i.jsx)(q.m1,{bordered:!0,disabled:a,title:"Delete organization",text:(0,i.jsxs)(i.Fragment,{children:["Are you sure you want to delete the user"," ",(0,i.jsx)(o.Z.Text,{strong:!0,children:p(t)}),"?"]}),loading:d,onDelete:m})},users=e=>{let{organization:a,swr:t}=e,[s,n]=(0,r.useState)(),[l,o]=(0,r.useState)(),d=(0,r.useRef)(null),u=(0,r.useRef)(null),c=(0,r.useRef)(null),p=(0,r.useCallback)((e,a)=>ed.Z.userToAvatar(a),[]),m=(0,r.useCallback)(e=>(0,i.jsx)(R.ZP.Group,{maxCount:5,children:null==e?void 0:e.map(e=>ed.Z.workspaceToAvatar(e))}),[]),h=(0,r.useCallback)(e=>(0,i.jsx)(R.ZP.Group,{maxCount:5,children:null==e?void 0:e.map(e=>ed.Z.projectToAvatar(e))}),[]),g=(0,r.useCallback)(e=>(0,i.jsx)(R.ZP.Group,{maxCount:5,children:null==e?void 0:e.map(e=>ed.Z.usermodelToAvatar(e))}),[]),w=(0,r.useCallback)(e=>(0,i.jsx)(users_delete,{disabled:a.owners.length<2&&!e.pending,user:{id:e.id,email:e.email},organization:{id:a.id,owners:a.owners,pendingowners:a.pendingowners,users:a.users,pendingusers:a.pendingusers},dBkey:e.pending?"pendingowners":"owners",swr:{mutateOneOrganization:t.mutateOneOrganization}}),[a,t]),x=(0,r.useCallback)(e=>(0,i.jsx)(users_delete,{user:{id:e.id,email:e.email,firstname:e.firstname,lastname:e.lastname},organization:{id:a.id,owners:a.owners,pendingowners:a.pendingowners,users:a.users,pendingusers:a.pendingusers},dBkey:e.pending?"pendingusers":"users",swr:{mutateOneOrganization:t.mutateOneOrganization}}),[a,t]),y=(0,r.useMemo)(()=>[{key:"avatar",dataIndex:"avatar",align:"center",render:p},{key:"lastname",title:"Lastname",dataIndex:"lastname",align:"center"},{key:"firstname",title:"Firstname",dataIndex:"firstname",align:"center"},{key:"email",title:"Email",dataIndex:"email",align:"center"},{key:"workspaces",title:"Workspaces",dataIndex:"workspaces",align:"center",render:m},{key:"projects",title:"Projects",dataIndex:"projects",align:"center",render:h},{key:"usermodels",title:"User models",dataIndex:"usermodels",align:"center",render:g}],[p,m,h,g]),j=(0,r.useMemo)(()=>[...y,{key:"actions",title:"Actions",align:"center",fixed:"right",render:w}],[y,w]),f=(0,r.useMemo)(()=>[...y,{key:"actions",title:"Actions",align:"center",fixed:"right",render:x}],[y,x]),v=(0,r.useCallback)(()=>{let e=d.current;if(!e)return;let a=e.clientHeight-15,t=a/2-39-12-32-20-75,i=e.clientHeight,s=e.clientHeight;i>t?n({y:t}):n(void 0),s>t?o({y:t}):o(void 0)},[]);return(0,r.useEffect)(()=>(window.addEventListener("resize",v),()=>{window.removeEventListener("resize",v)}),[v]),(0,r.useEffect)(()=>{v()},[a,v]),(0,i.jsx)("div",{ref:d,style:{height:"calc(100vh - 228px)"},children:(0,i.jsxs)(W.default,{direction:"vertical",className:el().fullWidth,size:20,children:[(0,i.jsx)(M.Z,{title:"Administrators",size:"small",children:(0,i.jsxs)(W.default,{direction:"vertical",className:el().fullWidth,size:20,children:[(0,i.jsx)(users_add,{title:"New administrator",organization:{id:a.id,owners:a.owners,pendingowners:a.pendingowners,pendingusers:a.pendingusers,users:a.users},dBkey:"owners",swr:{mutateOneOrganization:t.mutateOneOrganization}}),(0,i.jsx)(e5.Z,{loading:t.loadingOrganizations,pagination:!1,size:"small",columns:j,dataSource:[...a.owners.map(e=>({...e,key:e.id})),...a.pendingowners.map(e=>({...e,workspaces:[],projects:[],usermodels:[],pending:!0,key:e.id}))],scroll:{x:1200,y:null==s?void 0:s.y},ref:u})]})}),(0,i.jsx)(M.Z,{title:"Users",size:"small",children:(0,i.jsxs)(W.default,{direction:"vertical",className:el().fullWidth,size:20,children:[(0,i.jsx)(users_add,{title:"New user",organization:{id:a.id,owners:a.owners,pendingowners:a.pendingowners,pendingusers:a.pendingusers,users:a.users},dBkey:"users",swr:{mutateOneOrganization:t.mutateOneOrganization}}),(0,i.jsx)(e5.Z,{loading:null==t?void 0:t.loadingOrganizations,pagination:!1,size:"small",columns:f,dataSource:[...a.users.map(e=>({...e,key:e.id})),...a.pendingusers.map(e=>({...e,workspaces:[],projects:[],usermodels:[],pending:!0,key:e.id}))],scroll:{x:1200,y:null==l?void 0:l.y},ref:c})]})})]})})},e7=t(59734),e6=t(948);let add_add=async(e,a)=>{let t=await (0,e6.R)("/api/group",{method:"POST",body:JSON.stringify({organization:e,group:a})});return t.json()},update=async(e,a)=>{await (0,e6.R)("/api/group",{method:"PUT",body:JSON.stringify({group:e,data:a})})},del=async e=>{await (0,e6.R)("/api/group",{method:"DELETE",body:JSON.stringify(e)})};var e9={useGroups:e=>{var a;let{data:t,error:i,mutate:s}=(0,e7.ZP)("/api/groups/"+e,e6._),n=null!==(a=null==t?void 0:t.groups)&&void 0!==a?a:[],l=(0,r.useCallback)(async e=>{let a=[...n,e];await s({groups:a})},[n,s]),o=(0,r.useCallback)(async e=>{let a=n.filter(a=>a.id!==e.id);await s({groups:a})},[n,s]),d=(0,r.useCallback)(async e=>{let a=n.map(a=>(a.id===e.id&&(a={...a,...e}),a));await s({groups:a})},[n,s]);return[n,{addOneGroup:l,delOneGroup:o,mutateOneGroup:d,errorGroups:i,loadingGroups:!t}]},add:add_add,update:update,del:del};let e3={del:"Unable to delete group"},group_delete_onDelete=async(e,a,t)=>{try{await e9.del({id:e.id}),await a.delOneGroup({id:e.id})}catch(e){throw t((0,f.iT)({title:e3.del,err:e})),e}};var group_delete=e=>{let{group:a,swr:t}=e,[s,n]=(0,r.useState)(!1),{dispatch:l}=(0,r.useContext)(j.uj),d=(0,r.useCallback)(async()=>{n(!0);try{await group_delete_onDelete(a,t,l)}finally{n(!1)}},[a,t,l]);return(0,i.jsx)(q.m1,{bordered:!0,title:"Delete group",text:(0,i.jsxs)(i.Fragment,{children:["Are you sure you want to delete the group"," ",(0,i.jsx)(o.Z.Text,{strong:!0,children:a.name}),"?"]}),loading:s,onDelete:d})};let e8={add:"Unable to add group",update:"Unable to update group"},group_onAdd=async(e,a,t,i)=>{try{let i=await e9.add({id:e.id},{name:a.name,users:a.users});await t.addOneGroup({...i,name:a.name,users:a.users}),await t.mutateOneOrganization({id:e.id,groups:[...e.groups,i]})}catch(e){throw i((0,f.iT)({title:e8.add,err:e})),e}},group_onUpdate=async(e,a,t,i,s)=>{try{var r;let s=[];if(a.name!==t.name&&s.push({key:"name",value:t.name}),(null===(r=a.users)||void 0===r?void 0:r.map(e=>e.id).toString())!==t.users.toString()&&s.push({key:"users",value:t.users}),!s.length)return;await e9.update({id:a.id},s),await i.mutateOneGroup({...a,...t});let n=e.groups.findIndex(e=>e.id===a.id);await i.mutateOneOrganization({id:e.id,groups:[...e.groups.slice(0,n),a,...e.groups.slice(n+1)]})}catch(e){throw s((0,f.iT)({title:e8.update,err:e})),e}};var assets_group=e=>{var a;let{userOptions:t,organization:s,group:n,swr:l}=e,o=(0,r.useRef)(null),[d,u]=(0,r.useState)(!1),[c,p]=(0,r.useState)(!1),{dispatch:m}=(0,r.useContext)(j.uj);(0,r.useEffect)(()=>{o.current&&o.current.focus()});let h=(0,r.useCallback)(()=>u(!0),[]),g=(0,r.useCallback)(()=>u(!1),[]),w=(0,r.useCallback)(async e=>{p(!0);try{n?await group_onUpdate(s,n,e,{mutateOneOrganization:l.mutateOneOrganization,mutateOneGroup:l.mutateOneGroup},m):await group_onAdd(s,e,{mutateOneOrganization:l.mutateOneOrganization,addOneGroup:l.addOneGroup},m),p(!1),u(!1)}catch(e){throw p(!1),e}},[s,n,l,m]);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(E.ZP,{title:n?"Edit group":"New group",visible:d,initialValues:n&&{name:n.name,users:null===(a=n.users)||void 0===a?void 0:a.map(e=>e.id)},onCancel:g,onOk:w,loading:c,children:[(0,i.jsx)(Z.Z.Item,{name:"name",label:"Name",rules:[{required:!0,message:"Name is requried"}],children:(0,i.jsx)(O.default,{ref:o})}),(0,i.jsx)(Z.Z.Item,{name:"users",label:"Users",rules:[{required:!0,message:"Users selection is required"}],children:(0,i.jsx)(eM.default,{mode:"multiple",placeholder:"Select users",options:t})})]}),n?(0,i.jsx)(q.w6,{bordered:!0,onEdit:h,children:"Edit"}):(0,i.jsx)(q.HS,{onAdd:h,children:"New group"})]})};let ae={groups:"Error while loading groups"};var groups=e=>{let{organization:a,swr:t}=e,s=(0,r.useRef)(null),[n,l]=(0,r.useState)([]),[o,d]=(0,r.useState)(null),{dispatch:u}=(0,r.useContext)(j.uj),[c,{addOneGroup:p,mutateOneGroup:m,delOneGroup:h,errorGroups:g,loadingGroups:w}]=e9.useGroups(a.id);(0,r.useEffect)(()=>{let e=a.owners,t=null==a?void 0:a.users,i=[...e,...t],s=i.map(e=>({label:e.firstname||e.lastname?e.firstname+" "+e.lastname:e.email,value:e.id}));l(s)},[a]),(0,r.useEffect)(()=>{g&&u((0,f.iT)({title:ae.groups,err:g}))},[g,u]);let x=(0,r.useCallback)(e=>(0,i.jsx)(R.ZP.Group,{maxCount:5,children:e.map(e=>ed.Z.userToAvatar(e))}),[]),y=(0,r.useCallback)(e=>(0,i.jsx)(R.ZP.Group,{maxCount:5,children:e.map(e=>ed.Z.workspaceToAvatar(e))}),[]),v=(0,r.useCallback)(e=>(0,i.jsx)(R.ZP.Group,{maxCount:5,children:e.map(e=>ed.Z.projectToAvatar(e))}),[]),b=(0,r.useCallback)(e=>(0,i.jsx)(R.ZP.Group,{maxCount:5,children:e.map(e=>ed.Z.usermodelToAvatar(e))}),[]),k=(0,r.useCallback)((e,s)=>(0,i.jsxs)(W.default,{children:[(0,i.jsx)(assets_group,{userOptions:n,organization:{id:a.id,groups:a.groups},group:{id:s.id,name:s.name,users:s.users},swr:{mutateOneOrganization:t.mutateOneOrganization,mutateOneGroup:m}}),(0,i.jsx)(group_delete,{group:{id:s.id,name:s.name},swr:{delOneGroup:h}})]}),[a,t,n,m,h]),_=(0,r.useMemo)(()=>[{title:"Group name",dataIndex:"name",key:"name",align:"center"},{title:"Users",dataIndex:"users",key:"users",align:"center",render:x},{title:"Workspaces",dataIndex:"workspaces",key:"workspaces",align:"center",render:y},{title:"Projects",dataIndex:"projects",key:"projects",align:"center",render:v},{title:"User models",dataIndex:"usermodels",key:"usermodels",align:"center",render:b},{title:"Actions",key:"actions",align:"center",fixed:"right",render:k}],[x,y,v,b,k]),C=(0,r.useCallback)(()=>{let e=s.current;e&&(e.clientHeight>window.innerHeight-e.offsetTop-59?d({y:window.innerHeight-e.offsetTop-59}):d(null))},[]);return(0,r.useEffect)(()=>(window.addEventListener("resize",C),()=>{window.removeEventListener("resize",C)}),[C]),(0,r.useEffect)(()=>{C()},[c,C]),(0,i.jsxs)(W.default,{direction:"vertical",className:el().fullWidth,size:20,children:[(0,i.jsx)(assets_group,{userOptions:n,organization:{id:a.id,groups:a.groups},swr:{mutateOneOrganization:t.mutateOneOrganization,addOneGroup:p}}),(0,i.jsx)(e5.Z,{loading:w,pagination:!1,size:"small",columns:_,dataSource:c.map(e=>({key:e.id,...e})),scroll:{x:1200,y:null==o?void 0:o.y},ref:s})]})};let aa={name:"Unable to update organization's name"},_onName=async(e,a,t,i)=>{try{await e1.Z.update(e,[{key:"name",value:a}]),await t.mutateOneOrganization({...e,name:a})}catch(e){i((0,f.iT)({title:aa.name,err:e}))}};var assets_organization=e=>{let{organization:a,swr:t,onClose:s}=e,{dispatch:n}=(0,r.useContext)(j.uj),l=(0,r.useCallback)(e=>{(async()=>{await _onName(a,e,{mutateOneOrganization:t.mutateOneOrganization},n)})()},[a,t,n]);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("div",{className:el().displayFlex,children:[(0,i.jsx)(_(),{style:{marginRight:"20px"},icon:(0,i.jsx)(e0.Z,{}),onClick:s}),(0,i.jsx)(o.Z.Title,{level:3,editable:{onChange:l},children:a.name})]}),(0,i.jsx)(z.default,{items:[{key:"users",label:"Users",children:(0,i.jsx)(users,{organization:{id:a.id,owners:a.owners,pendingowners:a.pendingowners,users:a.users,pendingusers:a.pendingusers},swr:{mutateOneOrganization:t.mutateOneOrganization,loadingOrganizations:t.loadingOrganizations}})},{key:"groups",label:"Groups",children:(0,i.jsx)(groups,{organization:{id:a.id,owners:a.owners,users:a.users,groups:a.groups},swr:{mutateOneOrganization:t.mutateOneOrganization}})}]})]})};let at={add:"Unable to add organization"},organizations_add_onAdd=async(e,a,t)=>{try{let t=await e1.Z.add({name:e.name});t.name=e.name,await a.addOneOrganization(t)}catch(e){throw t((0,f.iT)({title:at.add,err:e})),e}};var organizations_add=e=>{let{swr:a}=e,t=(0,r.useRef)(null),[s,n]=(0,r.useState)(!1),[l,o]=(0,r.useState)(!1),{dispatch:d}=(0,r.useContext)(j.uj);(0,r.useEffect)(()=>{t.current&&t.current.focus()});let u=(0,r.useCallback)(()=>n(!0),[]),c=(0,r.useCallback)(()=>n(!1),[]),p=(0,r.useCallback)(async e=>{o(!0);try{await organizations_add_onAdd(e,a,d),o(!1),n(!1)}catch(e){throw o(!1),e}},[a,d]);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(E.ZP,{title:"New organization",visible:s,onCancel:c,onOk:p,loading:l,children:(0,i.jsx)(Z.Z.Item,{name:"name",label:"Name",rules:[{required:!0,message:"Name is required"}],children:(0,i.jsx)(O.default,{ref:t})})}),(0,i.jsx)(q.HS,{onAdd:u,children:"New organization"})]})},ai=t(48138),as=t(92018),ar=t(5986);let an={del:"Unable to delete organization"},organizations_delete_onDelete=async(e,a,t)=>{try{await e1.Z.del({id:e.id}),await a.delOneOrganization({id:e.id})}catch(e){throw t((0,f.iT)({title:an.del,err:e})),e}};var organizations_delete=e=>{let{organization:a,swr:t}=e,[s,n]=(0,r.useState)(!1),{dispatch:l}=(0,r.useContext)(j.uj),d=(0,r.useCallback)(async()=>{n(!0);try{await organizations_delete_onDelete(a,t,l)}finally{n(!1)}},[a,t,l]);return(0,i.jsx)(q.m1,{bordered:!0,title:"Delete organization",text:(0,i.jsxs)(i.Fragment,{children:["Are you sure you want to delete the organization"," ",(0,i.jsx)(o.Z.Text,{strong:!0,children:a.name}),"?"]}),onDelete:d,loading:s})};let al={quit:"Unable to quit organization",accept:"Unable to accept invitation",decline:"Unable to decline invitation"},_onQuit=async(e,a,t,i)=>{try{await e1.Z.quit({id:e.id});let i=ed.Z.deepCopy(e),s=i.users.findIndex(e=>e.id===a.id);i.users.splice(s,1),await t.mutateOneOrganization(i)}catch(e){i((0,f.iT)({title:al.quit,err:e}))}},_onAccept=async(e,a,t,i)=>{try{await e1.Z.accept(e);let i=ed.Z.deepCopy(e),s=i.pendingowners.findIndex(e=>e.id===a.id),r=i.pendingowners[s];if(-1!==s)i.pendingowners.splice(s,1),i.owners.push({...r,workspaces:[],projects:[],usermodels:[]});else{let e=i.pendingusers.findIndex(e=>e.id===a.id),t=i.pendingusers[e];i.pendingusers.splice(e,1),i.users.push({...t,workspaces:[],projects:[],usermodels:[]})}await t.mutateOneOrganization(i)}catch(e){i((0,f.iT)({title:al.accept,err:e}))}},_onDecline=async(e,a,t,i)=>{try{var s,r;await e1.Z.decline({id:e.id});let i=ed.Z.deepCopy(e),n=null===(s=i.pendingowners)||void 0===s?void 0:s.findIndex(e=>e.id===a.id);if(-1!==n)i.pendingowners.splice(n,1);else{let e=null===(r=i.pendingusers)||void 0===r?void 0:r.findIndex(e=>e.id===a.id);i.pendingusers.splice(e,1)}await t.mutateOneOrganization(i)}catch(e){i((0,f.iT)({title:al.decline,err:e}))}},ManageButton=e=>{let{organization:a,swr:t,setOrganization:s}=e,n=(0,r.useCallback)(()=>s(a),[a,s]);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(_(),{icon:(0,i.jsx)(u.Z,{}),onClick:n,children:"Manage"}),(0,i.jsx)(organizations_delete,{organization:{id:a.id,name:a.name},swr:{delOneOrganization:t.delOneOrganization}})]})},QuitButton=e=>{let{user:a,organization:t,swr:s,dispatch:n}=e,l=(0,r.useCallback)(()=>{(async()=>{await _onQuit({id:t.id,users:t.users},{id:a.id},{mutateOneOrganization:s.mutateOneOrganization},n)})()},[a,t,s,n]);return(0,i.jsx)(_(),{danger:!0,icon:(0,i.jsx)(ar.Z,{}),onClick:l,children:"Quit"})},AcceptButton=e=>{let{user:a,organization:t,swr:s,dispatch:n}=e,l=(0,r.useCallback)(()=>{(async()=>{await _onAccept({id:t.id,owners:t.owners,pendingowners:t.pendingowners,users:t.users,pendingusers:t.pendingusers},{id:a.id},{mutateOneOrganization:s.mutateOneOrganization},n)})()},[a,t,s,n]);return(0,i.jsx)(_(),{type:"primary",icon:(0,i.jsx)(ai.Z,{}),onClick:l,children:"Accept invitation"})},DeclineButton=e=>{let{user:a,organization:t,swr:s,dispatch:n}=e,l=(0,r.useCallback)(()=>{(async()=>{await _onDecline({id:t.id,pendingowners:t.pendingowners,pendingusers:t.pendingusers},{id:a.id},{mutateOneOrganization:s.mutateOneOrganization},n)})()},[a,t,s,n]);return(0,i.jsx)(_(),{danger:!0,icon:(0,i.jsx)(as.Z,{}),onClick:l,children:"Decline"})};var organizations_list=e=>{var a;let{user:t,organizations:s,swr:n,setOrganization:l}=e,[o,d]=(0,r.useState)(null),{dispatch:u}=(0,r.useContext)(j.uj),c=(0,r.useRef)(null),p=(0,r.useCallback)(e=>(0,i.jsx)(R.ZP.Group,{maxCount:5,children:null==e?void 0:e.map(e=>ed.Z.userToAvatar(e))}),[]),m=(0,r.useCallback)(e=>(0,i.jsx)(R.ZP.Group,{maxCount:5,children:null==e?void 0:e.map(e=>ed.Z.userToAvatar(e))}),[]),h=(0,r.useCallback)(e=>(0,i.jsx)(R.ZP.Group,{maxCount:5,children:null==e?void 0:e.map(e=>ed.Z.groupToAvatar(e))}),[]),g=(0,r.useCallback)(e=>e.owners.find(e=>e.id===t.id)?(0,i.jsx)(W.default,{wrap:!0,children:(0,i.jsx)(ManageButton,{organization:e,swr:{delOneOrganization:n.delOneOrganization},setOrganization:l})}):e.users.find(e=>e.id===t.id)?(0,i.jsx)(W.default,{wrap:!0,children:(0,i.jsx)(QuitButton,{user:t,organization:e,swr:{mutateOneOrganization:n.mutateOneOrganization},dispatch:u})}):e.pendingowners.find(e=>e.id===t.id)||e.pendingusers.find(e=>e.id===t.id)?(0,i.jsxs)(W.default,{wrap:!0,children:[(0,i.jsx)(AcceptButton,{user:t,organization:e,swr:{mutateOneOrganization:n.mutateOneOrganization},dispatch:u}),(0,i.jsx)(DeclineButton,{user:t,organization:e,swr:{mutateOneOrganization:n.mutateOneOrganization},dispatch:u})]}):null,[t,n,l,u]),w=(0,r.useMemo)(()=>[{title:"Name",dataIndex:"name",key:"name",sorter:(e,a)=>{var t,i;let s=null!==(t=e.name)&&void 0!==t?t:"",r=null!==(i=a.name)&&void 0!==i?i:"";return s.localeCompare(r)}},{title:"Administrators",dataIndex:"owners",key:"owners",render:p},{title:"Users",dataIndex:"users",key:"users",render:m},{title:"Groups",dataIndex:"groups",key:"groups",render:h},{title:"Actions",key:"actions",render:g}],[p,m,h,g]),x=(0,r.useCallback)(()=>{let e=c.current;e&&(e.clientHeight>window.innerHeight-e.offsetTop-59?d({y:window.innerHeight-e.offsetTop-59}):d(null))},[]);return(0,r.useEffect)(()=>(window.addEventListener("resize",x),()=>{window.removeEventListener("resize",x)}),[x]),(0,r.useEffect)(()=>{x()},[s,x,null===(a=c.current)||void 0===a?void 0:a.offsetTop]),(0,i.jsx)(e5.Z,{loading:n.loadingOrganizations,pagination:!1,size:"small",columns:w,dataSource:null==s?void 0:s.map(e=>({key:e.id,id:e.id,name:e.name,owners:e.owners,pendingowners:e.pendingowners,users:e.users,pendingusers:e.pendingusers,groups:e.groups})),ref:c,scroll:{y:null==o?void 0:o.y}})},components_organizations=e=>{let{user:a,organizations:t,swr:l}=e,[d,u]=(0,r.useState)(),c=(0,s.useRouter)(),{organizationId:p}=c.query;(0,r.useEffect)(()=>{if(p){let e=t.find(e=>e.id===p);u(e)}},[p,t]),(0,r.useEffect)(()=>{if(d){let e=t.find(e=>e.id===d.id);JSON.stringify(e)!==JSON.stringify(d)&&u(e)}},[t,d]);let m=(0,r.useCallback)(()=>{(async()=>{await c.push({pathname:"dashboard",query:{page:"organizations"}}),u(null)})()},[c]),h=(0,r.useCallback)(e=>{(async()=>{await c.push({pathname:"dashboard",query:{page:"organizations",organizationId:e.id}}),u(e)})()},[c]);return(0,i.jsxs)(n.Z,{className:eO().inDashboard,children:[(0,i.jsx)(pageHeader,{title:(0,i.jsx)(o.Z.Title,{level:2,style:{marginBottom:"0 !important"},children:"Organizations"})}),(0,i.jsx)(n.Z.Content,{className:el().noScroll,children:d?(0,i.jsx)(assets_organization,{organization:{id:d.id,name:d.name,owners:d.owners,pendingowners:d.pendingowners,users:d.users,pendingusers:d.pendingusers,groups:d.groups},swr:{mutateOneOrganization:l.mutateOneOrganization,loadingOrganizations:l.loadingOrganizations},onClose:m}):(0,i.jsxs)(W.default,{direction:"vertical",className:el().fullWidth,size:20,children:[(0,i.jsx)(organizations_add,{swr:{addOneOrganization:l.addOneOrganization}}),(0,i.jsx)(organizations_list,{user:{id:a.id},organizations:t,swr:{mutateOneOrganization:l.mutateOneOrganization,delOneOrganization:l.delOneOrganization,loadingOrganizations:l.loadingOrganizations},setOrganization:h})]})})]})},ao=t(84996),ad=t(62443),au=t(79686),ac=t(31059),ap=t(751);let am={add:"Unable to add user"},users_add_onAdd=async(e,a,t)=>{try{let t=await eE.Z.add({email:e.email,password:e.password});if(t.alreadyExists)throw Error("User already exists");await eE.Z.updateById(t.id,[{key:"firstname",value:e.firstname},{key:"lastname",value:e.lastname},{key:"authorizedplugins",value:e.authorizedplugins},{key:"superuser",value:!!e.superuser}]);let i={...t,email:e.email,firstname:e.firstname,lastname:e.firstname,superuser:e.superuser};await a.addOneUser(i)}catch(e){throw t((0,f.iT)({title:am.add,err:e})),e}};var administration_users_add=e=>{let{plugins:a,swr:t}=e,s=(0,r.useRef)(null),[n,l]=(0,r.useState)(!1),[o,d]=(0,r.useState)(!1),{dispatch:u}=(0,r.useContext)(j.uj),[c]=ap.Z.useSystem();(0,r.useEffect)(()=>{s.current&&s.current.focus()});let p=(0,r.useCallback)(()=>l(!0),[]),m=(0,r.useCallback)(()=>l(!0),[]),h=(0,r.useCallback)(async e=>{d(!0);try{await users_add_onAdd(e,t,u),d(!1),l(!1)}catch(e){throw d(!1),e}},[t,u]);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(E.ZP,{title:"New user",visible:n,initialValues:c.defaultplugins&&{authorizedplugins:c.defaultplugins},onCancel:m,onOk:h,loading:o,children:[(0,i.jsx)(Z.Z.Item,{name:"firstname",label:"First name",children:(0,i.jsx)(O.default,{ref:s})}),(0,i.jsx)(Z.Z.Item,{name:"lastname",label:"Last name",children:(0,i.jsx)(O.default,{})}),(0,i.jsx)(Z.Z.Item,{name:"email",label:"Email",rules:[{required:!0,message:"Email is required"}],children:(0,i.jsx)(O.default,{})}),(0,i.jsx)(eF.o,{name:"password"}),(0,i.jsx)(Z.Z.Item,{name:"authorizedplugins",label:"Plugins",children:(0,i.jsx)(eM.default,{mode:"multiple",options:a.map(e=>({label:e.name,value:e.key}))})}),(0,i.jsx)(Z.Z.Item,{name:"superuser",label:"Administrator",valuePropName:"checked",children:(0,i.jsx)(ac.default,{})})]}),(0,i.jsx)(q.HS,{onAdd:p,children:"New user"})]})};let ah={update:"Unable to update user"},edit_onUpdate=async(e,a,t,i)=>{try{let i=Object.keys(a).map(t=>{let i=a[t];if(void 0!==i&&"******"!==i&&i!==e[t])return{key:t,value:i,type:"password"===t&&"crypt"}}).filter(e=>e);if(!i.length)return;await eE.Z.updateById(e.id,i),a.password="******";let s={...e,...a};await t.mutateOneUser(s)}catch(e){throw i((0,f.iT)({title:ah.update,err:e})),e}};var users_edit=e=>{let{plugins:a,user:t,swr:s}=e,n=(0,r.useRef)(null),[l,o]=(0,r.useState)(!1),[d,u]=(0,r.useState)(!1),{dispatch:c}=(0,r.useContext)(j.uj);(0,r.useEffect)(()=>{n.current&&n.current.focus()});let p=(0,r.useCallback)(()=>o(!0),[]),m=(0,r.useCallback)(()=>o(!1),[]),h=(0,r.useCallback)(async e=>{u(!0);try{await edit_onUpdate(t,e,s,c),u(!1),o(!1)}catch(e){throw u(!1),e}},[t,s,c]);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(E.ZP,{title:"Edit user",visible:l,initialValues:{...t,password:"******",authorizedplugins:t.authorizedplugins},onCancel:m,onOk:h,loading:d,children:[(0,i.jsx)(Z.Z.Item,{name:"firstname",label:"First name",children:(0,i.jsx)(O.default,{ref:n})}),(0,i.jsx)(Z.Z.Item,{name:"lastname",label:"Last name",children:(0,i.jsx)(O.default,{})}),(0,i.jsx)(Z.Z.Item,{name:"email",label:"Email",rules:[{required:!0,message:"Email is required"}],children:(0,i.jsx)(O.default,{})}),(0,i.jsx)(eF.o,{name:"password",edit:!0}),(0,i.jsx)(Z.Z.Item,{name:"authorizedplugins",label:"Plugins",children:(0,i.jsx)(eM.default,{mode:"multiple",options:a.map(e=>({label:e.name,value:e.key}))})}),(0,i.jsx)(Z.Z.Item,{name:"superuser",label:"Administrator",valuePropName:"checked",children:(0,i.jsx)(ac.default,{})})]}),(0,i.jsx)(q.w6,{bordered:!0,onEdit:p,children:"Edit"})]})};let ag={del:"Unable to delete user"},administration_users_delete_onDelete=async(e,a,t)=>{try{await eE.Z.delById(e.id),await a.delOneUser({id:e.id})}catch(e){throw t((0,f.iT)({title:ag.del,err:e})),e}};var administration_users_delete=e=>{let{user:a,swr:t}=e,[s,n]=(0,r.useState)(!1),{dispatch:l}=(0,r.useContext)(j.uj),d=(0,r.useCallback)(async()=>{n(!0);try{await administration_users_delete_onDelete(a,t,l)}finally{n(!1)}},[a,t,l]);return(0,i.jsx)(q.m1,{loading:s,bordered:!0,text:(0,i.jsxs)(i.Fragment,{children:["Are you sure you want to delete the user"," ",(0,i.jsx)(o.Z.Text,{strong:!0,children:a.email}),"?"]}),title:"Delete user",onDelete:d})};let aw={plugins:"Unable to load plugins"};var administration_users=e=>{var a;let{users:t,swr:s}=e,n=(0,r.useRef)(null),[l,o]=(0,r.useState)(),[d,u]=(0,r.useState)(),{dispatch:c}=(0,r.useContext)(j.uj),p=(0,r.useCallback)(e=>{e.sort((e,a)=>e.localeCompare(a));let a=e.map(e=>{let a=null==l?void 0:l.find(a=>a.key===e);if(a)return(0,i.jsx)(ao.Z.Ribbon,{text:a.category,style:{marginTop:"-15px"},children:(0,i.jsx)(M.Z,{size:"small",children:a.name})},e)}),t=(0,i.jsx)(W.default,{direction:"vertical",children:a});return(0,i.jsx)(ad.default,{content:t,children:(0,i.jsxs)(_(),{children:[a.length," plugins"]})})},[l]),m=(0,r.useCallback)(e=>e?(0,i.jsx)(au.default,{className:el().textGreen}):null,[]),h=(0,r.useCallback)((e,a)=>{var t;return(0,i.jsxs)(W.default,{children:[(0,i.jsx)(users_edit,{plugins:null!==(t=null==l?void 0:l.map(e=>({key:e.key,name:e.name})))&&void 0!==t?t:[],user:{id:a.id,firstname:a.firstname,lastname:a.lastname,email:a.email,authorizedplugins:a.authorizedplugins,superuser:a.superuser},swr:{mutateOneUser:s.mutateOneUser}}),(0,i.jsx)(administration_users_delete,{user:{id:a.id,email:a.email},swr:{delOneUser:s.delOneUser}})]})},[l,s]),g=(0,r.useMemo)(()=>[{title:"First name",dataIndex:"firstname",key:"firstname",sorter:(e,a)=>{var t,i;let s=null!==(t=e.firstname)&&void 0!==t?t:"",r=null!==(i=a.firstname)&&void 0!==i?i:"";return s.localeCompare(r)}},{title:"Last name",dataIndex:"lastname",key:"lastname",sorter:(e,a)=>{var t,i;let s=null!==(t=e.lastname)&&void 0!==t?t:"",r=null!==(i=a.lastname)&&void 0!==i?i:"";return s.localeCompare(r)}},{title:"Email",dataIndex:"email",key:"email",sorter:(e,a)=>{let t=e.email,i=a.email;return t.localeCompare(i)}},{title:"Password",key:"password",render:()=>"******"},{title:"Plugins",dataIndex:"authorizedplugins",key:"authorizedplugins",render:p},{title:"Administrator",dataIndex:"superuser",key:"superuser",align:"center",render:m},{title:"Actions",key:"actions",render:h}],[p,m,h]),w=(0,r.useCallback)(()=>{let e=n.current;e&&(e.clientHeight>window.innerHeight-e.offsetTop-59?u({y:window.innerHeight-e.offsetTop-59}):u(void 0))},[]);return(0,v.Z)(()=>(window.addEventListener("resize",w),()=>{window.removeEventListener("resize",w)}),void 0,[w]),(0,v.Z)(()=>{w()},[t],[w]),(0,r.useEffect)(()=>{(async()=>{try{let e=await eH.Z.completeList();o(e)}catch(e){c((0,f.iT)({title:aw.plugins,err:e}))}})()},[c]),(0,i.jsxs)(W.default,{direction:"vertical",className:"".concat(el().fullWidth," ").concat(el().fullHeight),size:20,children:[(0,i.jsx)(administration_users_add,{plugins:null!==(a=null==l?void 0:l.map(e=>({key:e.key,name:e.name})))&&void 0!==a?a:[],swr:{addOneUser:s.addOneUser}}),(0,i.jsx)(e5.Z,{loading:!l,pagination:!1,size:"small",columns:g,dataSource:t.map(e=>({...e,key:e.id})),ref:n,scroll:{y:null==d?void 0:d.y}})]})},ax=t(8799),ay=t(59141);let aj={system:"Error while loading system",update:"Unable to update system"},_onAllowSignup=async(e,a,t)=>{try{await ap.Z.update([{key:"allowsignup",value:!e.allowsignup}]),await a({allowsignup:!e.allowsignup}),t((0,f.$E)({title:"Changes saved"}))}catch(e){t((0,f.iT)({title:aj.update,err:e}))}},_onPasswordFinish=async(e,a,t)=>{try{await ap.Z.update([{key:"password",value:e}]),await a({password:e}),t((0,f.$E)({title:"Changes saved"}))}catch(e){t((0,f.iT)({title:aj.update,err:e}))}};var registration=()=>{let{dispatch:e}=(0,r.useContext)(j.uj),[a]=Z.Z.useForm(),[t,{mutateSystem:s,errorSystem:n,loadingSystem:l}]=ap.Z.useSystem();(0,r.useEffect)(()=>{n&&e((0,f.iT)({title:aj.system,err:n}))},[n,e]),(0,r.useEffect)(()=>{var e;l||a.setFieldsValue(null!==(e=null==t?void 0:t.password)&&void 0!==e?e:{min:ay.yL,max:ay.nq,requireLetter:ay.JT,requireNumber:ay.tE,requireSymbol:ay.ah})},[l,a,null==t?void 0:t.password]);let o=(0,r.useCallback)(()=>{(async()=>{await _onAllowSignup(t,s,e)})()},[t,s,e]),d=(0,r.useCallback)(a=>{(async()=>{await _onPasswordFinish(a,s,e)})()},[s,e]);return l?(0,i.jsx)(b.Z.Simple,{}):(0,i.jsxs)(W.default,{direction:"vertical",className:el().fullWidth,size:20,children:[(0,i.jsx)(M.Z,{title:"Signup",children:(0,i.jsx)(ac.default,{checked:null==t?void 0:t.allowsignup,onChange:o,children:"Allow signup"})}),(0,i.jsx)(M.Z,{title:"Password",children:(0,i.jsx)(Z.Z,{form:a,name:"form",onFinish:d,style:{display:"flex",justifyContent:"space-between"},children:(0,i.jsxs)("div",{className:"".concat(el().displayFlex," ").concat(el().fullWidth),style:{justifyContent:"space-between"},children:[(0,i.jsxs)("div",{children:[(0,i.jsx)(Z.Z.Item,{label:"Minimum number of characters",name:"min",rules:[{required:!0,message:"Minimum number of characters is required"}],children:(0,i.jsx)(ax.Z,{min:0,max:64})}),(0,i.jsx)(Z.Z.Item,{label:"Maximum number of characters",name:"max",rules:[{required:!0,message:"Maximum number of characters is required"}],children:(0,i.jsx)(ax.Z,{min:0,max:64})})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)(Z.Z.Item,{valuePropName:"checked",name:"requireLetter",children:(0,i.jsx)(ac.default,{children:"Require letter"})}),(0,i.jsx)(Z.Z.Item,{valuePropName:"checked",name:"requireNumber",children:(0,i.jsx)(ac.default,{children:"Require number"})}),(0,i.jsx)(Z.Z.Item,{valuePropName:"checked",name:"requireSymbol",children:(0,i.jsx)(ac.default,{children:"Require symbol"})})]}),(0,i.jsx)("div",{style:{marginTop:"auto"},children:(0,i.jsx)(Z.Z.Item,{children:(0,i.jsx)(_(),{type:"primary",icon:(0,i.jsx)(au.default,{}),htmlType:"submit",children:"Save changes"})})})]})})})]})};let af={plugins:"Unable to get plugins",update:"Unable to update system"},plugins_onChange=async(e,a,t,i,s)=>{try{var r;await ap.Z.update([{key:"defaultplugins",type:"array",method:t?"append":"remove",value:a.key}]);let s=ed.Z.deepCopy(null!==(r=null==e?void 0:e.defaultplugins)&&void 0!==r?r:[]),n=s.indexOf(a.key);t&&-1===n&&s.push(a.key),t||-1===n||s.splice(n,1),await i.mutateSystem({defaultplugins:s})}catch(e){s((0,f.iT)({title:af.update,err:e}))}},plugins_Plugin=e=>{let{plugin:a,system:t,swr:s,dispatch:n}=e,[l,o]=(0,r.useState)();(0,r.useEffect)(()=>{if(null==t?void 0:t.defaultplugins){let e=t.defaultplugins.includes(a.key);o(e)}},[a,t]);let d=(0,r.useCallback)(e=>{(async()=>{await plugins_onChange(t,a,e.target.checked,s,n)})()},[a,t,s,n]);return(0,i.jsx)(ac.default,{checked:l,onChange:d})};var plugins=()=>{let e=(0,r.useRef)(null),{dispatch:a}=(0,r.useContext)(j.uj),[t,s]=(0,r.useState)(),[n,l]=(0,r.useState)(),[o,{mutateSystem:d,loadingSystem:u}]=ap.Z.useSystem();(0,r.useEffect)(()=>{(async()=>{try{let e=await eH.Z.completeList();s(e)}catch(e){a((0,f.iT)({title:af.plugins,err:e}))}})()},[a]);let c=(0,r.useCallback)(e=>(0,i.jsx)(plugins_Plugin,{system:o,plugin:e,swr:{mutateSystem:d},dispatch:a}),[o,d,a]),p=(0,r.useMemo)(()=>[{title:"Category",dataIndex:"category",key:"category"},{title:"Name",dataIndex:"name",key:"name"},{title:"Default enabled",key:"enable",render:c}],[c]),m=(0,r.useCallback)(()=>{let a=e.current;a&&(a.clientHeight>window.innerHeight-a.offsetTop-59?l({y:window.innerHeight-a.offsetTop-59}):l(null))},[]);return(0,r.useEffect)(()=>(window.addEventListener("resize",m),()=>{window.removeEventListener("resize",m)}),[m]),(0,r.useEffect)(()=>{m()},[t,m]),(0,i.jsx)(e5.Z,{loading:!t||u,pagination:!1,size:"small",columns:p,dataSource:t,ref:e,scroll:{y:null==n?void 0:n.y}})};let av={users:{label:"Users",key:"users"},registration:{label:"Registration",key:"registration"},plugins:{label:"Plugins",key:"plugins"}},ab={users:"Error while loading users"};var administration=()=>{let{dispatch:e}=(0,r.useContext)(j.uj),a=(0,s.useRouter)(),{tab:t}=a.query,[l,{addOneUser:d,mutateOneUser:u,delOneUser:c,errorUsers:p}]=eE.Z.useUsers();(0,r.useEffect)(()=>{p&&e((0,f.iT)({title:ab.users,err:p}))},[p,e]);let m=(0,r.useCallback)(e=>{(async()=>{await a.replace({pathname:"/dashboard",query:{page:"administration",tab:e}})})()},[a]);return(0,i.jsxs)(n.Z,{className:eO().inDashboard,children:[(0,i.jsx)(pageHeader,{title:(0,i.jsx)(o.Z.Title,{level:2,style:{marginBottom:"0 !important"},children:"Administration"})}),(0,i.jsx)(n.Z.Content,{children:(0,i.jsx)(z.default,{className:eO().inDashboardTabs,type:"card",items:[{key:av.users.key,label:av.users.label,children:(0,i.jsx)(administration_users,{users:l,swr:{addOneUser:d,mutateOneUser:u,delOneUser:c}})},{key:av.registration.key,label:av.registration.label,children:(0,i.jsx)(registration,{})},{key:av.plugins.key,label:av.plugins.label,children:(0,i.jsx)(plugins,{})}],defaultActiveKey:null!=t?t:"default",onChange:m})})]})},ak=t(41664),a_=t.n(ak),help=()=>(0,i.jsxs)(n.Z,{className:eO().inDashboard,children:[(0,i.jsx)(pageHeader,{title:(0,i.jsx)(o.Z.Title,{level:2,style:{marginBottom:"0 !important"},children:"Help"})}),(0,i.jsx)(n.Z.Content,{className:el().scroll,children:(0,i.jsxs)(W.default,{direction:"vertical",className:el().fullWidth,size:20,children:[(0,i.jsxs)(o.Z,{children:[(0,i.jsx)(o.Z.Title,{level:3,children:"Documentation"}),(0,i.jsxs)(o.Z.Text,{children:["Full interface"," ",(0,i.jsx)(a_(),{href:"/doc",target:"_blank",children:"Documentation"})]})]}),(0,i.jsxs)(o.Z,{children:[(0,i.jsx)(o.Z.Title,{level:3,children:"Bug report"}),(0,i.jsxs)(o.Z.Text,{children:[(0,i.jsx)(a_(),{href:"https://github.com/Airthium/tanatloc/issues/new/choose",target:"_blank",children:"Open an issue"})," ","on Github"]})]}),(0,i.jsxs)(o.Z,{children:[(0,i.jsx)(o.Z.Title,{level:3,children:"Feature request"}),(0,i.jsxs)(o.Z.Text,{children:[(0,i.jsx)(a_(),{href:"https://github.com/Airthium/tanatloc/issues/new/choose",target:"_blank",children:"Open an issue"})," ","on Github"]})]})]})})]});let needUpdate=async()=>{if(!x()())return{needed:!1};let e=await fetch("https://api.github.com/repos/Airthium/tanatloc-electron/releases/latest",{method:"GET"}),a=await e.json(),t=y.i8,i=!a.tag_name.includes("alpha")&&!a.tag_name.includes("beta")&&t!==a.tag_name&&"v"+t!==a.tag_name;return{needed:i,res:a}};var aC={needUpdate},updater=()=>{let[e,a]=(0,r.useState)(),[t,s]=(0,r.useState)(!1);(0,r.useEffect)(()=>{(async()=>{try{let e=await aC.needUpdate();e.needed&&a(e)}catch(e){console.error(e)}})()},[]),(0,r.useEffect)(()=>{(null==e?void 0:e.needed)&&s(!0)},[e]);let n=(0,r.useCallback)(()=>{s(!1)},[]),l=(0,r.useCallback)(async()=>{window.open("https://github.com/Airthium/tanatloc-electron/releases/tag/"+(null==e?void 0:e.res.tag_name),"_blank"),s(!1)},[e]);return(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(E.ZP,{visible:t,title:"Update",okButtonText:"Update",onCancel:n,onOk:l,children:(0,i.jsxs)(W.default,{direction:"vertical",children:[(0,i.jsx)(o.Z.Text,{children:"A new release is available"}),(0,i.jsxs)(o.Z.Text,{children:["Do you want to update to version"," ",(0,i.jsx)(o.Z.Text,{code:!0,children:null==e?void 0:e.res.tag_name}),"?"]})]})})})},aZ=t(61552);let aO={user:"Error while loading user",organizations:"Error while loading organizations",workspaces:"Error while loading workspaces",logout:"Unable to logout"},az={workspaces:{label:"Workspaces",key:"workspaces"},account:{label:"Account Settings",key:"account"},organizations:{label:"Organizations",key:"organizations"},administration:{label:"Administration",key:"administration"},editor:{label:"Model Editor",key:"editor"},help:{label:"I Need Help",key:"help"},logout:{label:"Logout",key:"logout"}};var dashboard=()=>{let[e,a]=(0,r.useState)(),{dispatch:t}=(0,r.useContext)(j.uj),[w,{mutateUser:k,clearUser:_,errorUser:C,loadingUser:Z}]=eE.Z.useUser(),[O,{addOneOrganization:z,delOneOrganization:S,mutateOneOrganization:T,errorOrganizations:P,loadingOrganizations:A}]=e1.Z.useOrganizations(),[E,{addOneWorkspace:N,delOneWorkspace:I,mutateOneWorkspace:U,errorWorkspaces:q,loadingWorkspaces:F}]=D.Z.useWorkspaces(),R=(0,s.useRouter)(),W=(0,r.useCallback)(async()=>{try{await logout(),await _()}catch(e){t((0,f.iT)({title:aO.logout,err:e}))}},[_,t]),L=(0,r.useCallback)(async e=>{a(e),e===az.logout.key?await W():e===az.editor.key?await R.push("/editor"):await R.replace({pathname:"/dashboard",query:{page:e}})},[R,W]),G=(0,r.useCallback)(e=>{let{keyPath:a}=e;(async()=>{let e=a.pop();await L(e)})()},[L]);return((0,v.Z)(()=>{(async()=>{x()()?await (0,aZ.x)({email:"admin",password:"password"}):Z||w||await R.replace("/")})()},[w,Z,R]),(0,v.Z)(()=>{(async()=>{let e=new URLSearchParams(window.location.search),t=e.get("page");t?a(t):await L(az.workspaces.key)})()},[R],[L]),(0,v.Z)(()=>{C&&t((0,f.iT)({title:aO.user,err:C})),P&&t((0,f.iT)({title:aO.organizations,err:P})),q&&t((0,f.iT)({title:aO.workspaces,err:q}))},[C,P,q]),!w||Z||A||F)?(0,i.jsx)(b.Z,{}):(0,i.jsxs)(n.Z,{className:eO().dashboard,children:[(0,i.jsx)(updater,{}),(0,i.jsxs)(n.Z.Sider,{theme:"light",width:"256",className:eO().sider,children:[(0,i.jsx)("div",{className:el().logo,children:(0,i.jsx)("img",{src:"/images/logo.svg",alt:"Tanatloc"})}),(0,i.jsx)(l.default,{className:eO().menu,items:[{key:az.workspaces.key,icon:(0,i.jsx)(d.Z,{}),label:az.workspaces.label},{key:az.account.key,icon:(0,i.jsx)(c.Z,{}),label:az.account.label},{key:az.organizations.key,icon:(0,i.jsx)(h.Z,{}),label:az.organizations.label,className:x()()?"display-none":""},{key:az.administration.key,className:w.superuser&&!x()()?"":"display-none",icon:(0,i.jsx)(u.Z,{}),label:az.administration.label},{key:az.editor.key,icon:(0,i.jsx)(g.default,{}),label:az.editor.label},{key:az.help.key,icon:(0,i.jsx)(p.default,{}),label:az.help.label},{type:"divider"},{key:az.logout.key,danger:!0,icon:(0,i.jsx)(m.Z,{}),label:az.logout.label,className:x()()?"display-none":""},{key:"version",disabled:!0,className:"version",label:(0,i.jsxs)(o.Z.Text,{className:el().textLight,ellipsis:{tooltip:!0},children:["version ",y.i8]})}],onClick:G,mode:"inline"})]}),(0,i.jsxs)(n.Z.Content,{className:el().noScroll,children:[e===az.workspaces.key&&(0,i.jsx)(workspace_list,{user:{id:w.id,plugins:w.plugins},workspaces:E,organizations:O,swr:{addOneWorkspace:N,delOneWorkspace:I,mutateOneWorkspace:U}}),e===az.account.key&&(0,i.jsx)(account,{user:{email:w.email,firstname:w.firstname,lastname:w.lastname,avatar:w.avatar},swr:{mutateUser:k,clearUser:_}}),e===az.organizations.key&&(0,i.jsx)(components_organizations,{user:{id:w.id},organizations:O,swr:{addOneOrganization:z,delOneOrganization:S,mutateOneOrganization:T,loadingOrganizations:A}}),e===az.administration.key&&(0,i.jsx)(administration,{}),e===az.help.key&&(0,i.jsx)(help,{})]})]})},dashboard_page=()=>(0,i.jsx)(dashboard,{})},82657:function(e){e.exports={information:"information_information__JyH_D"}},65053:function(e){e.exports={variables:'"@/styles/index.module.css"',colorPrimary:"#fad114",head:"pageHeader_head__R_sEo",divider:"pageHeader_divider__wx9MS"}},66172:function(e){e.exports={variables:'"@/styles/index.module.css"',colorPrimary:"#fad114",dashboard:"dashboard_dashboard__3usL4",sider:"dashboard_sider__QlZ6b",menu:"dashboard_menu__7pd_G","ant-menu-item-divider":"dashboard_ant-menu-item-divider__CDKa1",inDashboard:"dashboard_inDashboard__PEL1z",inDashboardTabs:"dashboard_inDashboardTabs__1L_iA"}},94722:function(e){e.exports={variables:'"@/styles/variables.css"',colorPrimary:"#fad114",textColorLight:"rgba(0, 0, 0, 0.45)",card:"list_card__qxs0D",cardArchived:"list_cardArchived___a_uA",carousel:"list_carousel__rAygP",carouselSnapshot:"list_carouselSnapshot__wturO",carouselSnapshotArchived:"list_carouselSnapshotArchived__OFeKM",carouselDescription:"list_carouselDescription__AUEPz",carouselDescriptionArchived:"list_carouselDescriptionArchived__ypoxh",empty:"list_empty__JWMqP",emptySearch:"list_emptySearch__nZ3dG"}},55255:function(e){e.exports={empty:"workspace_empty__1O3ic",search:"workspace_search__lZrCd",shared:"workspace_shared__r0geC",tabs:"workspace_tabs__Ukwpy"}},4147:function(e){"use strict";e.exports={i8:"1.2.12"}}},function(e){e.O(0,[9774,6373,1350,302,1664,4704,7651,9734,1269,7562,7234,2618,2509,713,6771,237,9818,3505,4278,2888,179],function(){return e(e.s=9637)}),_N_E=e.O()}]);