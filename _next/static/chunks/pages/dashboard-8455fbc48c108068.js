(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8026],{9637:function(e,a,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/dashboard",function(){return t(80333)}])},59420:function(e,a,t){"use strict";var s;t.d(a,{JT:function(){return n},ah:function(){return o},nq:function(){return i},tE:function(){return l},yL:function(){return r}}),null!==(s=t(83454).env.AUTH_SECRET)&&void 0!==s||Array(33).join("a");let r=6,i=16,n=!0,l=!0,o=!0},72735:function(e,a,t){"use strict";t.d(a,{Z:function(){return i}});var s=t(83755);let r=async(e,a)=>{let t=await (0,s.R)("/api/avatar",{method:"POST",headers:{Accept:"application/json"},body:JSON.stringify({file:e,project:a})});return t.json()};var i={add:r}},83755:function(e,a,t){"use strict";t.d(a,{R:function(){return d},_:function(){return o}});var s=t(59134),r=t.n(s),i=t(83454);let n=i.env.PORT?parseInt(i.env.PORT):3e3,l=r()()?"http://localhost:"+n:"",o=async(e,a)=>{let t=await fetch(l+e,{method:a?"POST":"GET",headers:{accept:"application/json","Content-Type":"application/json"},...a&&{body:a}}),s=t.headers.get("Content-Type");if(!t.ok){let e=Error("An error occured while fetching data.");throw e.info=(null==s?void 0:s.includes("application/json"))&&await t.json(),e.status=t.status,e}return t.json()},d=async(e,a)=>{var t;let s=await fetch(l+e,{...a,method:null!==(t=null==a?void 0:a.method)&&void 0!==t?t:"GET",headers:{...null==a?void 0:a.headers,"Content-Type":"application/json"}}),r=s.headers.get("Content-Type");if(!s.ok){let e=Error("An error occured while fetching data.");throw e.info=(null==r?void 0:r.includes("application/json"))&&await s.json(),e.status=s.status,e}return s}},93659:function(e,a,t){"use strict";t.d(a,{H:function(){return s}});class s extends Error{constructor(e){var a;super(e.title),this.title=e.title,this.name="APIError",this.render=e.render,this.err=e.err,this.type=null!==(a=e.type)&&void 0!==a?a:"error"}}},52228:function(e,a,t){"use strict";t.d(a,{x:function(){return n}});var s=t(59134),r=t.n(s);let i=r()()?"http://localhost:3000":"",n=async e=>{let a=await fetch(i+"/api/login",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({email:e.email,password:e.password})});return 200===a.status?{ok:!0,...await a.json()}:{ok:!1}}},33997:function(e,a,t){"use strict";t.d(a,{Z:function(){return c}});var s=t(83755);let r=async e=>{await (0,s.R)("/api/plugin",{method:"POST",body:JSON.stringify(e)})},i=async e=>{await (0,s.R)("/api/plugin",{method:"PUT",body:JSON.stringify(e)})},n=async e=>{await (0,s.R)("/api/plugin",{method:"DELETE",body:JSON.stringify(e)})};var l=t(59734),o=t(67294);let d=()=>{var e;let{data:a,error:t,mutate:r}=(0,l.ZP)("/api/plugin",s._),i=null!==(e=null==a?void 0:a.plugins)&&void 0!==e?e:[],n=(0,o.useCallback)(async e=>{let a=[...i,e];await r({plugins:a})},[i,r]),d=(0,o.useCallback)(async e=>{let a=i.filter(a=>a.key!==e.key);await r({plugins:a})},[i,r]),c=(0,o.useCallback)(async e=>{let a=i.map(a=>(a.key===e.key&&(a={...a,...e}),a));await r({plugins:a})},[i,r]);return[i,{addOnePlugin:n,delOnePlugin:d,mutateOnePlugin:c,errorPlugins:t,loadingPlugins:!a}]};var c={add:r,update:i,del:n,usePlugins:d}},55276:function(e,a,t){"use strict";t.d(a,{Z:function(){return n}});var s=t(83755);let r=async()=>{let e=await (0,s.R)("/api/plugins",{method:"GET",headers:{Accept:"application/json"}});return e.json()},i=async()=>{let e=await (0,s.R)("/api/plugins",{method:"POST",headers:{Accept:"application/json"}});return e.json()};var n={list:r,completeList:i}},77149:function(e,a,t){"use strict";t.d(a,{Z:function(){return y}});var s=t(59734),r=t(67294),i=t(83755);let n=e=>{var a;let{data:t,error:n,mutate:l}=(0,s.ZP)(["/api/projects",JSON.stringify({ids:e})],e=>{let[a,t]=e;return(0,i._)(a,t)}),o=null!==(a=null==t?void 0:t.projects)&&void 0!==a?a:[],d=(0,r.useCallback)(async e=>{let a=[...o,{...e,users:[],geometries:[],simulations:[],groups:[]}];await l({projects:a})},[o,l]),c=(0,r.useCallback)(async e=>{let a=o.filter(a=>a.id!==e.id);await l({projects:a})},[o,l]),u=(0,r.useCallback)(async e=>{let a=o.map(a=>(a.id===e.id&&(a={...a,...e}),a));await l({projects:a})},[o,l]);return[o,{addOneProject:d,delOneProject:c,mutateOneProject:u,errorProjects:n,loadingProjects:!t}]},l=e=>{var a;let{data:t,error:n,mutate:l}=(0,s.ZP)("/api/project"+(e?"/"+e:""),i._),o=null!==(a=null==t?void 0:t.project)&&void 0!==a?a:{id:"0"},d=(0,r.useCallback)(async e=>{let a={...o,...e};await l({project:a})},[o,l]);return[o,{mutateProject:d,errorProject:n,loadingProject:!t}]},o=async(e,a)=>{let t=await (0,i.R)("/api/project",{method:"POST",headers:{Accept:"application/json"},body:JSON.stringify({workspace:{id:e.id},project:a})});return t.json()},d=async(e,a)=>{await (0,i.R)("/api/project/"+e.id,{method:"PUT",body:JSON.stringify(a)})},c=async(e,a)=>{await (0,i.R)("/api/project/"+a.id,{method:"DELETE",body:JSON.stringify({id:e.id})})},u=async e=>(0,i.R)("/api/project/"+e.id+"/archive",{method:"GET",headers:{Accept:"application/json"}}),p=async e=>(0,i.R)("/api/project/"+e.id+"/archive",{method:"PUT"}),m=async e=>(0,i.R)("/api/project/"+e.id+"/archive",{method:"DELETE"}),h=async(e,a)=>(0,i.R)("/api/project/"+e.id+"/archive",{method:"POST",body:JSON.stringify({archive:a})}),g=async(e,a)=>{let t=await (0,i.R)("/api/project/"+a.id+"/copy",{method:"POST",headers:{Accept:"application/json"},body:JSON.stringify({workspace:{id:e.id}})});return t.json()};var y={useProjects:n,useProject:l,add:o,update:d,del:c,archive:u,unarchiveFromServer:p,deleteArchiveFile:m,unarchiveFromFile:h,copy:g}},69081:function(e,a,t){"use strict";t.d(a,{Z:function(){return o}});var s=t(59734),r=t(67294),i=t(83755);let n=()=>{var e;let{data:a,error:t,mutate:n}=(0,s.ZP)("/api/system",i._),l=null!==(e=null==a?void 0:a.system)&&void 0!==e?e:{},o=(0,r.useCallback)(async e=>{await n({system:{...l,...e}})},[l,n]);return[l,{mutateSystem:o,errorSystem:t,loadingSystem:!a}]},l=async e=>{await (0,i.R)("/api/system",{method:"PUT",body:JSON.stringify(e)})};var o={useSystem:n,update:l}},42661:function(e,a,t){"use strict";t.d(a,{Z:function(){return h}});var s=t(59734),r=t(67294),i=t(83755);let n=()=>{let{data:e,error:a,mutate:t}=(0,s.ZP)("/api/user",i._),n=null==e?void 0:e.user,l=(0,r.useCallback)(async e=>{await t({user:{...n,...e}})},[n,t]),o=(0,r.useCallback)(async()=>{await t({user:void 0})},[t]);return[n,{mutateUser:l,clearUser:o,errorUser:(null==a?void 0:a.status)===401?void 0:a,loadingUser:(null==a?void 0:a.status)!==401&&!e}]},l=()=>{var e;let{data:a,error:t,mutate:n}=(0,s.ZP)("/api/users",i._),l=null!==(e=null==a?void 0:a.users)&&void 0!==e?e:[],o=(0,r.useCallback)(async e=>{let a=[...l,{...e,authorizedplugins:[]}];await n({users:a})},[l,n]),d=(0,r.useCallback)(async e=>{let a=l.filter(a=>a.id!==e.id);await n({users:a})},[l,n]),c=(0,r.useCallback)(async e=>{let a=l.map(a=>(a.id===e.id&&(a={...a,...e}),a));await n({users:a})},[l,n]);return[l,{addOneUser:o,delOneUser:d,mutateOneUser:c,errorUsers:t,loadingUsers:!a}]},o=async e=>{let a=await (0,i.R)("/api/user",{method:"POST",headers:{Accept:"application/json"},body:JSON.stringify(e)});return a.json()},d=async e=>{await (0,i.R)("/api/user",{method:"PUT",body:JSON.stringify(e)})},c=async(e,a)=>{await (0,i.R)("/api/user/"+e,{method:"PUT",body:JSON.stringify(a)})},u=async()=>{await (0,i.R)("/api/user",{method:"DELETE"})},p=async e=>{await (0,i.R)("/api/user/"+e,{method:"DELETE"})},m=async e=>{let a=await (0,i.R)("/api/user/check",{method:"POST",headers:{Accept:"application/json"},body:JSON.stringify(e)});return a.json()};var h={useUser:n,useUsers:l,add:o,update:d,updateById:c,del:u,delById:p,check:m}},74219:function(e,a,t){"use strict";t.d(a,{o:function(){return j}});var s=t(85893),r=t(638),i=t(69677),n=t(59420),l=t(69081);let o={password:"Please enter a password",passwordTooSmall:e=>"Your password is too small (minimum "+e+" characters)",passwordTooLong:e=>"Your password is too long (maximum "+e+" characters)",passwordRequireLetter:"Your password must contain a letter",passwordRequireNumber:"Your password must contain a number",passwordRequireSymbol:"Your password must contain a symbol"},d=(e,a)=>!(a.length<e),c=(e,a)=>!(a.length>e),u=(e,a)=>-1!==e.search(a),p=(e,a)=>{var t,s;return(null!==(s=null==e?void 0:null===(t=e.password)||void 0===t?void 0:t.requireLetter)&&void 0!==s?!s:!n.JT)||u(a,/[a-zA-Z]/)},m=(e,a)=>{var t,s;return(null!==(s=null==e?void 0:null===(t=e.password)||void 0===t?void 0:t.requireNumber)&&void 0!==s?!s:!n.tE)||u(a,/\d/)},h=(e,a)=>{var t,s;return(null!==(s=null==e?void 0:null===(t=e.password)||void 0===t?void 0:t.requireSymbol)&&void 0!==s?!s:!n.ah)||u(a,/[!@#$%^&*(){}[\]<>?/|.:;_-]/)},g=(e,a,t,s)=>{d(e,t)||s.push(o.passwordTooSmall(e)),c(a,t)||s.push(o.passwordTooLong(a))},y=(e,a,t)=>{p(e,a)||t.push(o.passwordRequireLetter),m(e,a)||t.push(o.passwordRequireNumber),h(e,a)||t.push(o.passwordRequireSymbol)},w=e=>{var a,t,d,c;let{labelCol:u,wrapperCol:p,name:m,label:h,inputPlaceholder:w,inputAutoComplete:j,edit:x,style:v,required:f}=e,[b]=l.Z.useSystem(),k=null!==(d=null==b?void 0:null===(a=b.password)||void 0===a?void 0:a.min)&&void 0!==d?d:n.yL,Z=null!==(c=null==b?void 0:null===(t=b.password)||void 0===t?void 0:t.max)&&void 0!==c?c:n.nq;return(0,s.jsx)(r.Z.Item,{labelCol:u,wrapperCol:p,name:null!=m?m:"password",label:null!=h?h:"Password",rules:[()=>({validator(e,a){let t=[];return x&&"******"===a?Promise.resolve():a?(g(k,Z,a,t),y(b,a,t),t.length)?Promise.reject(t):Promise.resolve():Promise.reject(o.password)}}),{required:!!f,message:""}],style:v,children:(0,s.jsx)(i.Z.Password,{placeholder:w,autoComplete:j})})};var j=w},94725:function(e,a,t){"use strict";var s=t(85893),r=t(67294),i=t(41664),n=t.n(i),l=t(26713),o=t(85813),d=t(57953),c=t(97183),u=t(22850),p=t(3363),m=t(50888),h=t(28058),g=t(14856),y=t.n(g),w=t(80108),j=t.n(w);let x=()=>(0,s.jsx)(l.Z,{style:{height:"100%",width:"100%",justifyContent:"center",alignItems:"center"},children:(0,s.jsx)(o.Z,{children:(0,s.jsxs)(l.Z,{children:[(0,s.jsx)(d.Z,{}),"Loading, please wait..."]})})}),v=e=>{let{text:a,status:t,errors:i}=e,[l,g]=(0,r.useState)([]),[w,x]=(0,r.useState)([]);(0,r.useEffect)(()=>{if(!(null==t?void 0:t.length)){g([]);return}let e=t.map((e,a)=>({index:a,status:"finish",icon:0===a?(0,s.jsx)(m.Z,{}):void 0,title:e})).filter(e=>e);g(e)},[t]),(0,r.useEffect)(()=>{if(!(null==i?void 0:i.length)){x([]);return}x(i.map(e=>{let a=null;return e.includes("docker: command not found")||e.includes("Is the docker daemon running")?a=(0,s.jsxs)(o.Z,{className:j().errorCard,children:["There is an error with your Docker installation.",(0,s.jsx)("br",{}),"Please verify that Docker is correctly installed and running."]}):(e.includes("EHOSTUNREACH")||e.includes("ENETUNREACH")||e.includes("ETIMEOUT"))&&(a=(0,s.jsxs)(o.Z,{className:j().errorCard,children:["There is an error with your PostgreSQL installation.",(0,s.jsx)("br",{}),'Please verify that postgres Docker container "tanatloc-postgres" is correctly installed and running.']})),(0,s.jsxs)("div",{children:[e,a]},e)}))},[i]);let v=!!(null==t?void 0:t.length)||!!(null==i?void 0:i.length);return(0,s.jsxs)(c.Z,{children:[(0,s.jsx)("div",{className:y().logo,children:(0,s.jsx)("img",{src:"/images/logo.svg",alt:"Tanatloc"})}),(0,s.jsx)(o.Z,{className:j().loading,bodyStyle:{padding:0},title:(0,s.jsx)("div",{className:j().title,children:(null==i?void 0:i.length)?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(h.Z,{className:"warning"}),(0,s.jsx)(u.Z.Title,{level:3,style:{margin:"0"},children:"An error occurs"}),(0,s.jsx)(n(),{href:"https://github.com/Airthium/tanatloc/issues/new/choose",target:"_blank",children:"Open an issue"})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(d.Z,{size:"large",indicator:(0,s.jsx)(m.Z,{})}),null!=a?a:"Loading, please wait..."]})}),children:v?(0,s.jsxs)("div",{className:j().content,children:[w.length?(0,s.jsxs)("div",{className:j().errors,children:[w.map(e=>e),(0,s.jsx)(u.Z.Title,{level:5,children:"Please restart the application"})]}):null,(0,s.jsx)("div",{className:j().status,children:(0,s.jsx)(p.Z,{direction:"vertical",items:l})})]}):null})]})};v.Simple=x,a.Z=v},36642:function(e,a,t){"use strict";t.d(a,{Z:function(){return l}});var s=t(67294);let r=(e,a)=>{if(!e||!a)return!1;let t=e.length,s=a.length;return t===s&&e.every((e,t)=>{let s=a[t];return null===e&&null===s||void 0===e&&void 0===s||(Array.isArray(e)?r(e,s):"object"==typeof e?i(e,s):e===s)})},i=(e,a)=>!!e&&!!a&&JSON.stringify(e)===JSON.stringify(a),n=(e,a,t)=>{let i=(0,s.useRef)();(0,s.useEffect)(()=>{var t;if(!(null===(t=i.current)||void 0===t?void 0:t.length)||!r(i.current,a))return i.current=[...null!=a?a:[!0]],e()},[...null!=a?a:[],...null!=t?t:[],e])};var l=n},80333:function(e,a,t){"use strict";t.r(a),t.d(a,{default:function(){return sr}});var s=t(85893),r=t(11163),i=t(67294),n=t(97183),l=t(68508),o=t(22850),d=t(41156),c=t(42952),u=t(55355),p=t(11186),m=t(86548),h=t(25035),g=t(92443),y=t(59134),w=t.n(y),j=t(4147),x=t(36642),v=t(9242),f=t(94725),b=t(638),k=t(69677),Z=t(44442),O=t(32983),C=t(86373),S=t(96074),z=t(43308),P=t.n(z);let E=e=>{let{className:a,title:t,footer:r,extra:i,children:n}=e;return(0,s.jsxs)("div",{className:a,children:[(t||i)&&(0,s.jsxs)("div",{className:P().head,children:[(0,s.jsx)("div",{children:t}),(0,s.jsx)("div",{children:i})]}),(0,s.jsx)("div",{children:n}),null!=r?r:(0,s.jsx)(S.Z,{className:P().divider})]})};var N=t(59734),T=t(83755);let _=()=>{var e;let{data:a,error:t,mutate:s}=(0,N.ZP)("/api/workspace",T._),r=null!==(e=null==a?void 0:a.workspaces)&&void 0!==e?e:[],n=(0,i.useCallback)(async e=>{let a=[...r,e];await s({workspaces:a})},[r,s]),l=(0,i.useCallback)(async e=>{let a=r.filter(a=>a.id!==e.id);await s({workspaces:a})},[r,s]),o=(0,i.useCallback)(async e=>{let a=r.map(a=>(a.id===e.id&&(a={...a,...e}),a));await s({workspaces:a})},[r,s]);return[r,{addOneWorkspace:n,delOneWorkspace:l,mutateOneWorkspace:o,errorWorkspaces:t,loadingWorkspaces:!a}]},U=async e=>{let a=await (0,T.R)("/api/workspace",{method:"POST",headers:{Accept:"application/json"},body:JSON.stringify(e)});return a.json()},A=async(e,a)=>{await (0,T.R)("/api/workspace",{method:"PUT",body:JSON.stringify({workspace:e,data:a})})},I=async e=>{await (0,T.R)("/api/workspace",{method:"DELETE",body:JSON.stringify(e)})};var R={useWorkspaces:_,add:U,update:A,del:I},D=t(51302);let q={add:"Unable to add workspace"},W=async(e,a)=>{try{let t=await R.add(e);await a.addOneWorkspace(t)}catch(e){throw(0,v.lt)(q.add,e),e}},F=e=>{let{swr:a}=e,t=(0,i.useRef)(null),[r,n]=(0,i.useState)(!1),[l,o]=(0,i.useState)(!1);(0,i.useEffect)(()=>{t.current&&t.current.focus()});let d=(0,i.useCallback)(()=>o(!0),[]),c=(0,i.useCallback)(()=>o(!1),[]),u=(0,i.useCallback)(async e=>{n(!0);try{await W(e,a),n(!1),o(!1)}catch(e){throw n(!1),e}},[a]);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(D.HS,{onAdd:d,children:"Create a new workspace"}),(0,s.jsx)(C.ZP,{visible:l,loading:r,title:"Create a new workspace",onCancel:c,onOk:u,children:(0,s.jsx)(b.Z.Item,{label:"Name",name:"name",rules:[{required:!0,message:"Name is required"},{max:50,message:"Max 50 characters"}],children:(0,s.jsx)(k.Z,{ref:t,placeholder:"Workspace's name"})})})]})};var L=t(26713),H=t(98293),B=t(68795),G=t(59847),M=t(83062),J=t(71577),K=t(20046),Y=t(87782),V=t(77149),X=t(14856),Q=t.n(X);let $={share:"Unable to share"},ee=async(e,a,t,s,r)=>{try{if(e){await R.update({id:e.id},[{key:"groups",value:t},{key:"users",value:s}]);let a=Y.Z.deepCopy(e);a.groups=t.map(e=>({id:e})),a.users=s.map(e=>({id:e})),await r.mutateOneWorkspace(a)}else{await V.Z.update({id:a.id},[{key:"groups",value:t},{key:"users",value:s}]);let e=Y.Z.deepCopy(a);e.groups=t.map(e=>({id:e})),e.users=s.map(e=>({id:e})),await r.mutateOneProject(e)}}catch(e){throw(0,v.lt)($.share,e),e}},ea=e=>{let a=e.email;if(e.lastname||e.firstname){var t;a=(e.lastname?e.lastname+" ":"")+(null!==(t=e.firstname)&&void 0!==t?t:"")}return a},et=e=>{var a;let{disabled:t,workspace:n,project:l,organizations:d,swr:c,style:u}=e,[p,m]=(0,i.useState)(!1),[h,g]=(0,i.useState)(!1),[y,j]=(0,i.useState)([]),[x,v]=(0,i.useState)([]),[f,k]=(0,i.useState)([]),[Z,O]=(0,i.useState)([]),S=(0,r.useRouter)();(0,i.useEffect)(()=>{let e=null!=n?n:l,a=null==e?void 0:e.groups.map(e=>e.id),t=null==e?void 0:e.users.map(e=>e.id);k(null!=a?a:[]),O(null!=t?t:[])},[n,l]),(0,i.useEffect)(()=>{let e=d.map(e=>{let a=e.groups.map(e=>({key:e.id,title:e.name,value:e.id,type:"group"}));return{key:e.id,title:e.name,value:e.id,disabled:!0,checkable:!1,children:a}}),a=[];d.forEach(e=>{e.owners.forEach(e=>{a.push({key:e.id,title:ea(e),value:e.id,type:"user"})}),e.users.forEach(e=>{a.push({key:e.id,title:ea(e),value:e.id,type:"user"})}),e.groups.forEach(e=>{e.users.forEach(e=>{a.push({key:e.id,title:ea(e),value:e.id,type:"user"})})})});let t=a.filter((e,a,t)=>t.findIndex(a=>a.key===e.key)===a);j(e),v(t)},[d]);let z=(0,i.useCallback)(()=>{(async()=>{await S.push({pathname:"/dashboard",query:{page:"organizations"}})})()},[S]),P=(0,i.useMemo)(()=>y.length?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(b.Z.Item,{label:(0,s.jsxs)(s.Fragment,{children:["Share this ",n?"workspace":"project"," with organizations groups"]}),children:(0,s.jsx)(G.Z,{multiple:!0,treeCheckable:!0,treeDefaultExpandAll:!0,showCheckedStrategy:G.Z.SHOW_ALL,placeholder:"Select groups",dropdownStyle:{maxHeight:400,overflow:"auto"},className:Q().fullWidth,treeData:y,value:f,onChange:k})}),(0,s.jsx)(b.Z.Item,{label:(0,s.jsxs)(s.Fragment,{children:["Share this ",n?"workspace":"project"," with organizations users"]}),children:(0,s.jsx)(G.Z,{multiple:!0,treeCheckable:!0,treeDefaultExpandAll:!0,showCheckedStrategy:G.Z.SHOW_ALL,placeholder:"Select users",dropdownStyle:{maxHeight:400,overflow:"auto"},className:Q().fullWidth,treeData:x,value:Z,onChange:O})})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("br",{}),(0,s.jsx)(o.Z.Text,{strong:!0,children:"There is no organization for now"}),(0,s.jsx)("br",{}),(0,s.jsxs)(o.Z.Text,{children:["You can create organizations and groups in the"," ",(0,s.jsx)(D.Qj,{onClick:z,children:"Organization menu"}),"."]})]}),[n,y,x,f,Z,z]),E=(0,i.useCallback)(()=>m(!0),[]),N=(0,i.useCallback)(()=>m(!1),[]),T=(0,i.useCallback)(async()=>{g(!0);try{await ee(n,l,f,Z,c),g(!1),m(!1)}catch(e){throw g(!1),e}},[n,l,f,Z,c]);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(M.Z,{title:"Share",children:(0,s.jsx)(J.ZP,{className:"".concat(Q().noBackground," ").concat((null==u?void 0:u.buttonLight)?Q().textLight:""," ").concat((null==u?void 0:u.buttonDark)?Q().textDark:""," ").concat((null==u?void 0:u.buttonBordered)?"":Q().noBorder," ").concat(w()()?Q().displayNone:""),disabled:t,type:t?"link":void 0,icon:(0,s.jsx)(K.Z,{}),onClick:E},"share")}),(0,s.jsxs)(C.ZP,{title:"Share "+(n?"workspace":"project"),visible:p,onCancel:N,onOk:T,loading:h,children:[(0,s.jsxs)(o.Z.Title,{level:5,children:[n?"Workspace: ":"Project: ",null!==(a=null==n?void 0:n.name)&&void 0!==a?a:null==l?void 0:l.title]}),P]})]})},es={add:"Unable to add project"},er=async(e,a,t)=>{try{let s=await V.Z.add({id:e.id},a);return await t.addOneProject(s),await t.mutateOneWorkspace({...e,projects:[...e.projects,s.id]}),s}catch(e){throw(0,v.lt)(es.add,e),e}},ei=e=>{let{workspace:a,swr:t}=e,n=(0,i.useRef)(null),[l,o]=(0,i.useState)(!1),[d,c]=(0,i.useState)(!1),u=(0,r.useRouter)();(0,i.useEffect)(()=>{n.current&&n.current.focus()});let p=(0,i.useCallback)(()=>o(!0),[]),m=(0,i.useCallback)(()=>o(!1),[]),h=(0,i.useCallback)(e=>e.stopPropagation(),[]),g=(0,i.useCallback)(async e=>{c(!0);try{let s=await er(a,e,t);c(!1),o(!1),await u.push({pathname:"/project",query:{page:"workspaces",workspaceId:a.id,projectId:s.id}})}catch(e){throw c(!1),e}},[u,a,t]);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(D.HS,{primary:!1,dark:!0,onAdd:p,children:"Create a new project"}),(0,s.jsxs)(C.ZP,{title:"Create a new project",visible:l,onCancel:m,onOk:g,loading:d,children:[(0,s.jsx)(b.Z.Item,{label:"Name",name:"title",rules:[{required:!0,message:"Name is required"},{max:50,message:"Max 50 characters"}],children:(0,s.jsx)(k.Z,{ref:n,placeholder:"Project's name"})}),(0,s.jsx)(b.Z.Item,{label:"Description",name:"description",children:(0,s.jsx)(k.Z.TextArea,{showCount:!0,style:{marginBottom:"20px"},maxLength:120,placeholder:"Project's description",onKeyUp:h})})]})]})};var en=t(85813),el=t(51904),eo=t(91978),ed=t(83159);let ec={edit:"Unable to edit project"},eu=async(e,a,t)=>{try{await V.Z.update({id:e.id},[{key:"title",value:a.title},{key:"description",value:a.description}]),await t.mutateOneProject(e)}catch(e){throw(0,v.lt)(ec.edit,e),e}},ep=e=>{let{disabled:a,project:t,swr:r}=e,n=(0,i.useRef)(null),[l,o]=(0,i.useState)(!1),[d,c]=(0,i.useState)(!1);(0,i.useEffect)(()=>{n.current&&n.current.focus()});let u=(0,i.useCallback)(()=>o(!0),[]),p=(0,i.useCallback)(()=>o(!1),[]),m=(0,i.useCallback)(async e=>{c(!0);try{await eu(t,e,r),c(!1),o(!1)}catch(e){throw c(!1),e}},[t,r]),h=(0,i.useCallback)(e=>e.stopPropagation(),[]);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(D.w6,{disabled:a,dark:!0,onEdit:u}),(0,s.jsxs)(C.ZP,{title:'Edit "'+t.title+'" project',visible:l,onCancel:p,onOk:m,loading:d,initialValues:{title:t.title,description:t.description},children:[(0,s.jsx)(b.Z.Item,{label:"Name",name:"title",rules:[{required:!0,message:"Name is required"},{max:50,message:"Max 50 characters"}],children:(0,s.jsx)(k.Z,{ref:n,placeholder:"Project's name"})}),(0,s.jsx)(b.Z.Item,{label:"Description",name:"description",children:(0,s.jsx)(k.Z.TextArea,{style:{marginBottom:"20px"},placeholder:"Project's description",showCount:!0,maxLength:120,onKeyUp:h})})]})]})};var em=t(99138);let eh={del:"Unable to delete project"},eg=async(e,a,t)=>{try{await V.Z.del({id:e.id},{id:a.id});let s=e.projects.findIndex(e=>e===a.id);e.projects=[...e.projects.slice(0,s),...e.projects.slice(s+1)],await t.mutateOneWorkspace(e),await t.delOneProject({id:a.id})}catch(e){throw(0,v.lt)(eh.del,e),e}},ey=e=>{let{disabled:a,workspace:t,project:r,swr:n}=e,[l,d]=(0,i.useState)(!1),c=(0,i.useCallback)(async()=>{d(!0);try{await eg(t,r,n)}finally{d(!1)}},[t,r,n]);return(0,s.jsx)(D.m1,{disabled:a,loading:l,title:"Delete the project",text:(0,s.jsxs)(s.Fragment,{children:["Are you sure you want to delete the project"," ",(0,s.jsx)(o.Z.Text,{strong:!0,children:r.title}),"?",(0,s.jsx)(em.Z,{type:"error",message:"If you delete the project, you will no longer be able to restore the archive",style:{marginTop:"16px"}})]}),onDelete:c})};var ew=t(31365),ej=t(57546),ex=t(238),ev=t(48764).lW;let ef={archive:"Unable to archive project",unarchiveServer:"Unable to unarchive project on server",deleteArchive:"Unable to delete archive",badFormat:"Bad archive format (supported format: .tanatlocarchive)",upload:"Unable to upload archive"},eb=async(e,a,t)=>{try{let s=await V.Z.archive({id:a.id}),r=await s.blob(),i=window.URL.createObjectURL(new Blob([r])),n=document.createElement("a");n.href=i,n.setAttribute("download",a.id+".tanatlocarchive"),n.click(),await t.mutateOneProject({...a,archived:!0}),await t.mutateOneWorkspace(e)}catch(e){throw(0,v.lt)(ef.archive,e),e}},ek=async(e,a,t)=>{try{await V.Z.unarchiveFromServer({id:a.id}),await t.mutateOneProject({...a,archived:!1}),await t.mutateOneWorkspace(e)}catch(e){throw(0,v.lt)(ef.unarchiveServer,e),e}},eZ=async e=>{try{await V.Z.deleteArchiveFile({id:e.id})}catch(e){(0,v.lt)(ef.deleteArchive,e)}},eO=async e=>{let a=new FileReader;return new Promise(t=>{a.addEventListener("load",()=>{t(a.result)}),a.readAsArrayBuffer(e)})},eC=async(e,a,t,s)=>{if("uploading"===t.file.status)return!0;if("done"===t.file.status)try{let r=await eO(t.file.originFileObj);await V.Z.unarchiveFromFile({id:a.id},ev.from(r)),await s.mutateOneProject({...a,archived:!1}),await s.mutateOneWorkspace(e)}catch(e){(0,v.lt)(ef.upload,e)}return!1},eS=e=>{let{disabled:a,workspace:t,project:r,swr:n}=e,[l,d]=(0,i.useState)(!1),[c,u]=(0,i.useState)(!1),p=(0,i.useCallback)(()=>d(!0),[]),m=(0,i.useCallback)(()=>d(!1),[]),h=(0,i.useCallback)(async()=>{u(!0);try{await eb(t,r,n),u(!1),d(!1)}catch(e){throw u(!1),e}},[t,r,n]),g=(0,i.useCallback)(()=>{(async()=>{u(!0);try{await ek(t,r,n),u(!1),d(!1)}catch(e){u(!1)}})()},[t,r,n]),y=(0,i.useCallback)(e=>{(async()=>{let a=await eC(t,r,e,n);u(a),d(a)})()},[t,r,n]),w=(0,i.useCallback)(async()=>eZ(r),[r]);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(C.ZP,{visible:l,loading:c,title:"Archive",onCancel:m,onOk:r.archived?void 0:h,okButtonText:"Archive",children:r.archived?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(b.Z.Item,{label:"Restore archive from the server",tooltip:"This will restore the project from the server archive file.",children:(0,s.jsx)(J.ZP,{loading:c,onClick:g,children:"Restore archive from the server"})}),(0,s.jsx)(b.Z.Item,{label:"Restore archive from local file",tooltip:"This will restore the project from your local archive file (.tanatlocarchive file).",children:(0,s.jsx)(ew.Z,{action:"/api/noop",accept:".tanatlocarchive",showUploadList:!1,onChange:y,children:(0,s.jsx)(J.ZP,{children:"Restore archive from archive file"})})}),(0,s.jsx)(b.Z.Item,{label:"Delete archive from the server",tooltip:"This will delete the archive file from the server, you will have to use a local copy to restore the project.",children:(0,s.jsx)(D.m1,{loading:c,bordered:!0,title:"Delete server archive",text:"Are you sure your want to delete the archive from the server?",onDelete:w,children:"Delete server archive"})})]}):(0,s.jsxs)(o.Z.Text,{children:["An archive will be downloaded and the project will not be editable anymore, archive the project \xab",r.title,"\xbb?"]})}),(0,s.jsx)(M.Z,{title:r.archived?"Manage archive":"Archive",children:(0,s.jsx)(J.ZP,{disabled:a,type:"link",icon:r.archived?(0,s.jsx)(ej.Z,{}):(0,s.jsx)(ex.Z,{}),onClick:p})})]})};var ez=t(57132);let eP={copy:"Unable to copy project"},eE=async(e,a,t)=>{try{let s=await V.Z.copy(e,a);await t.addOneProject(s),e.projects.push(s.id),await t.mutateOneWorkspace(e)}catch(e){(0,v.lt)(eP.copy,e)}},eN=e=>{let{workspace:a,project:t,swr:r}=e,n=(0,i.useCallback)(()=>{(async()=>{await eE(a,t,r)})()},[a,t,r]);return(0,s.jsx)(M.Z,{title:"Copy",children:(0,s.jsx)(J.ZP,{icon:(0,s.jsx)(ez.Z,{}),className:"".concat(Q().noBorder," ").concat(Q().noBackground),onClick:n})})};var eT=t(61131),e_=t.n(eT),eU=t(89705),eA=t(48764).lW;let eI=e=>{var a,t,n,l;let{user:d,workspace:c,page:u,project:p,organizations:m,swr:h}=e,g=(0,r.useRouter)(),y=(0,i.useCallback)(()=>{(async()=>{p.archived||await g.push({pathname:"/project",query:{page:u,workspaceId:c.id,projectId:p.id}})})()},[g,c,u,p]),w=(0,i.useMemo)(()=>p.archived?(0,s.jsx)(O.Z,{description:"Archived project"}):p.avatar?(0,s.jsx)("img",{src:eA.from(p.avatar).toString(),alt:"Tanatloc"}):(0,s.jsx)(O.Z,{image:"images/empty.svg",description:"No preview yet."}),[p]),j=(0,i.useMemo)(()=>(0,s.jsxs)(L.Z,{direction:"vertical",className:"".concat(Q().fullWidth," ").concat(Q().textAlignLeft),children:[(0,s.jsxs)(o.Z.Text,{children:[(0,s.jsx)("b",{children:"Created:"})," ",new Date(p.createddate).toLocaleDateString()]}),(0,s.jsxs)(o.Z.Text,{children:[(0,s.jsx)("b",{children:"Last modified:"})," ",new Date(p.lastaccess).toLocaleDateString()]}),p.description&&(0,s.jsx)(o.Z.Paragraph,{ellipsis:{rows:4,tooltip:!0},children:p.description})]}),[p]),x=(0,i.useMemo)(()=>{var e;return null===(e=p.owners)||void 0===e?void 0:e.map(e=>Y.Z.userToAvatar(e))},[p]),v=(0,i.useMemo)(()=>{var e;return null===(e=p.users)||void 0===e?void 0:e.map(e=>Y.Z.userToAvatar(e))},[p]),f=(0,i.useMemo)(()=>{var e;return null==p?void 0:null===(e=p.groups)||void 0===e?void 0:e.map(e=>Y.Z.groupToAvatar(e))},[p]);return(0,s.jsx)(en.Z,{title:(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(o.Z.Paragraph,{ellipsis:{rows:2,tooltip:!0},children:p.title}),p.archived&&(0,s.jsx)(el.Z,{children:"Archived"})]}),className:"".concat(e_().card," ").concat(p.archived?e_().cardArchived:""),cover:(0,s.jsxs)(eo.Z,{className:e_().carousel,dots:{className:"dots"},children:[(0,s.jsx)("div",{className:"".concat(e_().carouselSnapshot," ").concat(p.archived?e_().carouselSnapshotArchived:""),onClick:y,children:w}),(0,s.jsx)("div",{className:"".concat(e_().carouselDescription," ").concat(p.archived?e_().carouselDescriptionArchived:""),onClick:y,children:j})]}),actions:[(0,s.jsx)(ep,{disabled:!(null==p?void 0:null===(a=p.owners)||void 0===a?void 0:a.find(e=>e.id===(null==d?void 0:d.id))),project:{id:p.id,title:p.title,description:p.description},swr:{mutateOneProject:h.mutateOneProject}},"edit"),(0,s.jsx)(et,{disabled:!(null==p?void 0:null===(t=p.owners)||void 0===t?void 0:t.find(e=>e.id===(null==d?void 0:d.id))),project:{id:p.id,title:p.title,groups:p.groups,users:p.users},organizations:m,swr:{mutateOneProject:h.mutateOneProject},style:{buttonDark:!0}},"share"),(0,s.jsx)(eN,{workspace:{id:c.id,projects:c.projects},project:{id:p.id},swr:{addOneProject:h.addOneProject,mutateOneWorkspace:h.mutateOneWorkspace}},"copy"),(0,s.jsx)(ed.Z,{menu:{items:[{key:"archive",label:(0,s.jsx)(eS,{disabled:!(null==p?void 0:null===(n=p.owners)||void 0===n?void 0:n.find(e=>e.id===(null==d?void 0:d.id))),workspace:{id:c.id},project:{archived:p.archived,id:p.id,title:p.title},swr:{mutateOneWorkspace:h.mutateOneWorkspace,mutateOneProject:h.mutateOneProject}},"archive")},{key:"delete",label:(0,s.jsx)(ey,{disabled:!(null==p?void 0:null===(l=p.owners)||void 0===l?void 0:l.find(e=>e.id===(null==d?void 0:d.id))),workspace:{id:c.id,projects:c.projects},project:{id:p.id,title:p.title},swr:{mutateOneWorkspace:h.mutateOneWorkspace,delOneProject:h.delOneProject}})}]},children:(0,s.jsx)(J.ZP,{icon:(0,s.jsx)(eU.Z,{}),className:Q().noBorder})},"more")],children:(0,s.jsxs)("div",{style:{padding:"6px 0",display:"grid",gridTemplateColumns:"10fr 1fr 20fr",gridTemplateRows:"auto auto"},children:[(0,s.jsx)("div",{children:"Admin:"}),(0,s.jsx)("div",{}),(0,s.jsx)("div",{children:"Shared with:"}),(0,s.jsx)(H.C.Group,{maxCount:5,children:x}),(0,s.jsx)(S.Z,{type:"vertical",style:{height:"80%",borderColor:"#f0f0f0"}}),(0,s.jsxs)(H.C.Group,{children:[v,f]})]})},p.id)},eR=e=>{let{user:a,page:t,workspace:r,projects:n,organizations:l,filter:o,sorter:d,swr:c}=e,u=(0,i.useRef)(null),[p,m]=(0,i.useState)(!0),[h,g]=(0,i.useState)([]),[y,w]=(0,i.useState)(100);return((0,i.useEffect)(()=>{let e=u.current;if(!e)return;let a=e.getBoundingClientRect(),t=a.top,s=window.innerHeight,r=s-t;r!==y&&w(r)}),(0,i.useEffect)(()=>{let e=n.map(e=>{var a,t;if(!o||(null===(a=null===(t=e.title)||void 0===t?void 0:t.toLowerCase())||void 0===a?void 0:a.includes(o.toLowerCase())))return e}).filter(e=>e);switch(d){case"alphaAsc":e.sort((e,a)=>e.title.localeCompare(a.title));break;case"alphaDesc":e.sort((e,a)=>-1*e.title.localeCompare(a.title));break;case"modifiedDesc":e.sort((e,a)=>new Date(a.lastaccess).getTime()-new Date(e.lastaccess).getTime())}g(e),m(!1)},[n,o,d]),p||c.loadingProjects)?(0,s.jsx)(f.Z.Simple,{}):h.length?(0,s.jsx)("div",{ref:u,style:{height:y},children:(0,s.jsx)(L.Z,{style:{marginBottom:"20px"},wrap:!0,align:"start",size:20,children:h.map(e=>(0,s.jsx)(eI,{user:a,workspace:r,page:t,project:e,organizations:l,swr:c},e.id))})}):(0,s.jsx)(O.Z,{image:"images/empty.svg",className:e_().empty,description:o?(0,s.jsxs)(s.Fragment,{children:["No project found with the current search"," ",(0,s.jsx)("span",{className:e_().emptySearch,children:o}),"..."]}):(0,s.jsx)(s.Fragment,{children:"No project for now... Get started!"})})},eD={update:"Unable to update workspace"},eq=async(e,a,t)=>{try{let s=Y.Z.deepCopy(e);e.name=a.name,await R.update({id:e.id},[{key:"name",value:a.name}]),await t.mutateOneWorkspace(s)}catch(e){throw(0,v.lt)(eD.update,e),e}},eW=e=>{let{workspace:a,swr:t}=e,r=(0,i.useRef)(null),[n,l]=(0,i.useState)(!1),[o,d]=(0,i.useState)(!1);(0,i.useEffect)(()=>{r.current&&r.current.focus()});let c=(0,i.useCallback)(()=>l(!0),[]),u=(0,i.useCallback)(()=>l(!1),[]),p=(0,i.useCallback)(async e=>{d(!0);try{await eq(a,e,t),d(!1),l(!1)}catch(e){throw d(!1),e}},[a,t]);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(D.w6,{bordered:!0,dark:!0,onEdit:c}),(0,s.jsx)(C.ZP,{visible:n,loading:o,title:"Edit the workspace",initialValues:{name:a.name},onCancel:u,onOk:p,children:(0,s.jsx)(b.Z.Item,{label:"Name",name:"name",rules:[{required:!0,message:"Name is required"},{max:50,message:"Max 50 characters"}],children:(0,s.jsx)(k.Z,{ref:r,placeholder:"Workspace's name"})})})]})},eF={del:"Unable to delete workspace"},eL=async(e,a)=>{try{await R.del({id:e.id}),await a.delOneWorkspace({id:e.id})}catch(e){throw(0,v.lt)(eF.del,e),e}},eH=e=>{let{workspace:a,swr:t}=e,[r,n]=(0,i.useState)(!1),l=(0,i.useCallback)(async()=>{n(!0);try{await eL(a,t)}finally{n(!1)}},[a,t]);return(0,s.jsx)(D.m1,{bordered:!0,loading:r,text:"The projects contained in this workspace will be lost.",onDelete:l})};var eB=t(85318),eG=t.n(eB);let eM={projects:"Error while loading projects",update:"Unable to update workspace"},eJ=e=>{var a,t,r,l,o,d;let{user:c,page:u,workspace:p,organizations:m,swr:h}=e,[g,y]=(0,i.useState)(),[w,j]=(0,i.useState)(),[x,{addOneProject:f,delOneProject:b,mutateOneProject:O,errorProjects:C,loadingProjects:S}]=V.Z.useProjects(null==p?void 0:p.projects);(0,i.useEffect)(()=>{C&&(0,v.lt)(eM.projects,C)},[C]);let z=(0,i.useCallback)(e=>y(e.target.value),[]);return(0,s.jsxs)(n.Z,{className:Q().noScroll,children:[(0,s.jsx)(E,{footer:(0,s.jsxs)(L.Z,{direction:"horizontal",size:"large",className:"".concat(eG().search," ").concat(Q().fullWidth),children:[(0,s.jsx)(k.Z,{placeholder:"Enter a project name (case sensitive)",value:g,onChange:z,style:{width:500},suffix:(0,s.jsx)(B.Z,{className:Q().textLight})}),(null==p?void 0:null===(a=p.owners)||void 0===a?void 0:a.find(e=>e.id===c.id))?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(ei,{workspace:{id:p.id,projects:p.projects},swr:{mutateOneWorkspace:h.mutateOneWorkspace,addOneProject:f}}),(0,s.jsxs)(L.Z,{size:8,children:[(0,s.jsx)(eW,{workspace:{id:p.id,name:p.name},swr:{mutateOneWorkspace:h.mutateOneWorkspace}}),(0,s.jsx)(et,{workspace:{id:p.id,name:p.name,groups:p.groups,users:p.users},organizations:m,swr:{mutateOneWorkspace:h.mutateOneWorkspace},style:{buttonDark:!0,buttonBordered:!0}}),(0,s.jsx)(eH,{workspace:{id:p.id},swr:{delOneWorkspace:h.delOneWorkspace}})]})]}):(0,s.jsx)("div",{})]}),children:(null===(t=p.users)||void 0===t?void 0:t.length)||(null===(r=p.groups)||void 0===r?void 0:r.length)?(0,s.jsxs)("div",{className:eG().shared,children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{style:{marginRight:"10px"},children:"Admin:"}),(0,s.jsx)(H.C.Group,{maxCount:5,children:null===(l=p.owners)||void 0===l?void 0:l.map(e=>Y.Z.userToAvatar(e))})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{style:{marginRight:"10px"},children:"Shared with:"}),(0,s.jsx)(H.C.Group,{maxCount:5,children:null===(o=p.users)||void 0===o?void 0:o.map(e=>Y.Z.userToAvatar(e))}),(0,s.jsx)(H.C.Group,{maxCount:5,children:null===(d=p.groups)||void 0===d?void 0:d.map(e=>Y.Z.groupToAvatar(e))})]})]}):void 0}),(0,s.jsx)(Z.Z,{className:eG().tabs,items:[{key:"modifiedDesc",label:"Last modified"},{key:"alphaAsc",label:"Name (A-Z)"},{key:"alphaDesc",label:"Name (Z-A)"}],defaultActiveKey:"modifiedDesc",onChange:j}),(0,s.jsx)(n.Z.Content,{className:Q().scroll,children:(0,s.jsx)(eR,{user:c,page:u,workspace:{id:p.id,projects:p.projects},projects:x,organizations:m,filter:g,sorter:w,swr:{addOneProject:f,mutateOneWorkspace:h.mutateOneWorkspace,delOneProject:b,mutateOneProject:O,loadingProjects:S}})})]})};var eK=t(89957),eY=t.n(eK);let eV={add:"Unable to add workspace"},eX=async(e,a,t)=>{try{let s=await R.add(a);await t.addOneWorkspace(s),await e.push({pathname:"/dashboard",query:{page:"workspaces",workspaceId:s.id}}).catch()}catch(e){throw(0,v.lt)(eV.add,e),e}},eQ=e=>{let{user:a,workspaces:t,organizations:l,swr:d}=e,c=(0,i.useRef)(null),[u,p]=(0,i.useState)(!1),[m,h]=(0,i.useState)(!1),g=(0,r.useRouter)(),{page:y,workspaceId:w}=g.query;(0,i.useEffect)(()=>{c.current&&c.current.focus()});let j=(0,i.useCallback)(()=>{p(!0)},[]),x=(0,i.useCallback)(()=>{p(!1)},[]),v=(0,i.useCallback)(e=>{(async()=>{await g.push({pathname:"/dashboard",query:{page:"workspaces",workspaceId:e}})})()},[g]),f=(0,i.useCallback)(async e=>{h(!0);try{await eX(g,e,d),h(!1),p(!1)}catch(e){throw h(!1),e}},[g,d]);return(0,s.jsxs)(n.Z,{className:"".concat(eY().inDashboard," ").concat(Q().noScroll),children:[(0,s.jsx)(E,{title:(0,s.jsx)(o.Z.Title,{level:2,style:{marginBottom:"0 !important"},children:"Workspaces"})}),(0,s.jsx)(n.Z.Content,{className:Q().noScroll,children:t.length?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(C.ZP,{visible:u,loading:m,title:"Create a new workspace",onCancel:x,onOk:f,children:(0,s.jsx)(b.Z.Item,{label:"Name",name:"name",rules:[{required:!0,message:"Name is required"},{max:50,message:"Max 50 characters"}],children:(0,s.jsx)(k.Z,{ref:c,placeholder:"Workspace's name"})})}),(0,s.jsx)(Z.Z,{type:"editable-card",className:"".concat(Q().noScroll," ").concat(eY().inDashboardTabs),items:t.map(e=>({key:e.id,label:e.name,css:Q().noScroll,closable:!1,children:(0,s.jsx)(eJ,{user:a,page:null!=y?y:sa.workspaces.key,workspace:{id:e.id,name:e.name,projects:e.projects,owners:e.owners,users:e.users,groups:e.groups},organizations:l,swr:{delOneWorkspace:d.delOneWorkspace,mutateOneWorkspace:d.mutateOneWorkspace}})})),defaultActiveKey:"1",activeKey:w,onChange:v,onEdit:j})]}):(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(O.Z,{image:"images/empty.svg",description:"No workspace for now. Get started !",children:(0,s.jsx)(F,{swr:{addOneWorkspace:d.addOneWorkspace}})})})})]})};var e$=t(87547),e0=t(88484),e1=t(93659),e5=t(42661),e3=t(72735),e2=t(19563),e8=t.n(e2),e4=t(48764).lW;let e7={update:"Unable to update informations",upload:"Unable to upload image",badFormat:"Supported formats: jpg, png",badSize:"Image must be smaller than 5MB"},e9=e=>{let a="image/jpeg"===e.type||"image/png"===e.type;a||(0,v.lt)(e7.badFormat);let t=e.size/1024/1024<1;return t||(0,v.lt)(e7.badSize),a&&t},e6=async e=>{let a=new FileReader;return new Promise(t=>{a.addEventListener("load",()=>{t(a.result)}),a.readAsDataURL(e)})},ae=async(e,a,t)=>{if("uploading"===a.file.status)return!0;if("done"!==a.file.status)return!1;try{let s=await e6(a.file.originFileObj);await e3.Z.add({name:a.file.name,uid:a.file.uid,data:s}),await t.mutateUser({...e,avatar:e4.from(s)})}catch(e){(0,v.lt)(e7.upload,e)}return!1},aa=async(e,a,t)=>{try{let s=[];if(e.email!==a.email&&s.push({key:"email",value:a.email}),e.firstname!==a.firstname&&s.push({key:"firstname",value:a.firstname}),e.lastname!==a.lastname&&s.push({key:"lastname",value:a.lastname}),!s.length)return;await e5.Z.update(s),await t.mutateUser({email:a.email,firstname:a.firstname,lastname:a.lastname}),s.find(e=>"email"===e.key)&&(0,v.Ur)("Changes saved","A validation email has been send to "+a.email)}catch(e){throw new e1.H({title:e7.update,err:e})}},at=e=>{var a,t;let{user:r,swr:n}=e,[l,o]=(0,i.useState)(!1),[d,c]=(0,i.useState)(!1),[u,p]=(0,i.useState)(),m=(0,i.useCallback)(e=>{(async()=>{let a=await ae(r,e,n);o(a)})()},[r,n]),h=(0,i.useCallback)(e=>{(async()=>{c(!0);try{await aa(r,e,n),p(void 0)}catch(e){p(e)}finally{c(!1)}})()},[r,n]);return(0,s.jsx)(en.Z,{title:"Contact Details",children:(0,s.jsxs)(L.Z,{direction:"horizontal",className:e8().information,children:[(0,s.jsxs)("div",{className:e8().avatar,children:[(0,s.jsx)(H.C,{size:128,src:r.avatar&&e4.from(r.avatar).toString(),icon:(0,s.jsx)(e$.Z,{})}),(0,s.jsx)(ew.Z,{action:"/api/noop",accept:".jpg,.png",showUploadList:!1,beforeUpload:e9,onChange:m,children:(0,s.jsx)(J.ZP,{loading:l,icon:(0,s.jsx)(e0.Z,{}),children:"Upload new"})})]}),(0,s.jsx)("div",{className:e8().form,children:(0,s.jsxs)(b.Z,{labelCol:{span:4},style:{maxWidth:500},initialValues:{email:r.email,firstname:null!==(a=r.firstname)&&void 0!==a?a:"",lastname:null!==(t=r.lastname)&&void 0!==t?t:""},onFinish:h,children:[(0,s.jsx)(b.Z.Item,{label:"Email",name:"email",rules:[{max:50,message:"Max 50 characters"}],children:(0,s.jsx)(k.Z,{disabled:w()()})}),(0,s.jsx)(b.Z.Item,{label:"First name",name:"firstname",rules:[{max:50,message:"Max 50 characters"}],children:(0,s.jsx)(k.Z,{})}),(0,s.jsx)(b.Z.Item,{label:"Last name",name:"lastname",rules:[{max:50,message:"Max 50 characters"}],children:(0,s.jsx)(k.Z,{})}),(0,s.jsx)(v.Xq,{error:u}),(0,s.jsx)(b.Z.Item,{wrapperCol:{offset:4},children:(0,s.jsx)(J.ZP,{loading:d,type:"primary",htmlType:"submit",children:"Save changes"})})]})})]})})};var as=t(74219);let ar={check:"Unable to check password",update:"Unable to update password",passwordMismatch:"Password and confirmation mismatch",invalid:"Current password is not valid"},ai=async(e,a)=>{let t;try{t=await e5.Z.check({email:e.email,password:a.password})}catch(e){throw new e1.H({title:ar.check,err:e})}if(!t.valid)throw new e1.H({title:ar.invalid});try{await e5.Z.update([{type:"crypt",key:"password",value:a.newPassword}]),(0,v.Ur)("Your password has been changed successfully")}catch(e){throw new e1.H({title:ar.update,err:e})}},an=e=>{let{user:a}=e,[t,r]=(0,i.useState)(!1),[n,l]=(0,i.useState)(),o=(0,i.useCallback)(e=>{(async()=>{r(!0);try{await ai(a,e),l(void 0)}catch(e){l(e)}finally{r(!1)}})()},[a]);return(0,s.jsx)(en.Z,{title:"Your Password",children:(0,s.jsxs)(b.Z,{labelCol:{offset:2},wrapperCol:{offset:2},style:{maxWidth:500},layout:"vertical",onFinish:o,name:"passwordForm",children:[(0,s.jsx)(b.Z.Item,{label:"Current password",name:"password",rules:[{required:!0,message:"Current password is required"}],children:(0,s.jsx)(k.Z.Password,{placeholder:"Current password"})}),(0,s.jsx)(as.o,{name:"newPassword",label:"New password",inputPlaceholder:"Enter a new password",required:!0}),(0,s.jsx)(b.Z.Item,{label:"Password confirmation",name:"passwordConfirm",rules:[{required:!0,message:"Password confirmation is required"},e=>{let{getFieldValue:a}=e;return{validator:(e,t)=>t&&a("newPassword")!==t?Promise.reject(ar.passwordMismatch):Promise.resolve()}}],children:(0,s.jsx)(k.Z.Password,{placeholder:"Confirm your new password"})}),(0,s.jsx)(v.Xq,{error:n}),(0,s.jsx)(b.Z.Item,{children:(0,s.jsx)(L.Z,{children:(0,s.jsx)(J.ZP,{type:"primary",htmlType:"submit",loading:t,children:"Modify password"})})})]})})},al=w()()?"http://localhost:3000":"",ao=async()=>{await fetch(al+"/api/logout")},ad={del:"Unable to delete user"},ac=async e=>{try{await e5.Z.del(),await ao(),await e.clearUser()}catch(e){throw(0,v.lt)(ad.del,e),e}},au=e=>{let{swr:a}=e,[t,r]=(0,i.useState)(!1),n=(0,i.useCallback)(async()=>{r(!0);try{await ac(a)}finally{r(!1)}},[a]);return(0,s.jsx)(en.Z,{title:"Delete your account",children:(0,s.jsx)(D.m1,{title:"Delete your account",text:"This action cannot be undone. If you delete your account, you will permanently lose your workspaces and projects.",bordered:!0,loading:t,onDelete:n,children:"Delete your account"})})};var ap=t(57953),am=t(55276),ah=t(33997),ag=t(34041),ay=t(25935);let aw={update:"Unable to update plugins"},aj=(e,a,t)=>{var r;return(0,s.jsx)(b.Z.Item,{name:a,label:e.label,htmlFor:"input-"+a,tooltip:e.tooltip,rules:e.rules,children:(0,s.jsx)(k.Z,{ref:t,id:"input-"+a,autoComplete:"off",...null!==(r=e.props)&&void 0!==r?r:{}})},a)},ax=(e,a)=>{var t;return(0,s.jsx)(b.Z.Item,{name:a,label:e.label,htmlFor:"input-"+a,tooltip:e.tooltip,rules:e.rules,children:(0,s.jsx)(k.Z.TextArea,{id:"input-"+a,autoComplete:"off",...null!==(t=e.props)&&void 0!==t?t:{}})},a)},av=(e,a)=>{var t;return(0,s.jsx)(b.Z.Item,{name:a,label:e.label,htmlFor:"input-"+a,tooltip:e.tooltip,rules:e.rules,children:(0,s.jsx)(k.Z,{id:"input-"+a,type:"password",autoComplete:"off",...null!==(t=e.props)&&void 0!==t?t:{}})},a)},af=(e,a)=>{var t;return(0,s.jsx)(b.Z.Item,{name:a,label:e.label,htmlFor:"select-"+a,tooltip:e.tooltip,rules:e.rules,children:(0,s.jsx)(ag.Z,{id:"select-"+a,children:e.options.map(a=>(0,s.jsx)(ag.Z.Option,{value:a,...null!==(t=e.props)&&void 0!==t?t:{},children:a},a))})},a)},ab=async(e,a,t,s)=>{try{var r,i;if(a){let a=Y.Z.deepCopy(e);Object.keys(t).forEach(e=>{a.configuration[e].value=t[e]}),a.needReInit=!0,await ah.Z.update(a),await (null===(r=s.mutateOnePlugin)||void 0===r?void 0:r.call(s,a))}else{let a=Y.Z.deepCopy(e);a.uuid="add",Object.keys(t).forEach(e=>{a.configuration[e].value=t[e]}),await ah.Z.add(a),await (null===(i=s.addOnePlugin)||void 0===i?void 0:i.call(s,a))}}catch(e){throw(0,v.lt)(aw.update,e),e}},ak=e=>{var a;let{plugin:t,swr:r,edit:n}=e,l=(0,i.useRef)(null),[d,c]=(0,i.useState)(!1),[u,p]=(0,i.useState)(!1),[m,h]=(0,i.useState)({});(0,i.useEffect)(()=>{let e={};Object.keys(t.configuration).forEach(a=>{var s;e[a]=null!==(s=t.configuration[a].value)&&void 0!==s?s:t.configuration[a].default}),h(e)},[null==t?void 0:t.configuration]),(0,i.useEffect)(()=>{l.current&&l.current.focus()});let g=(0,i.useCallback)(()=>{c(!0)},[]),y=(0,i.useCallback)(()=>{c(!1)},[]),w=(0,i.useCallback)(async e=>{p(!0);try{await ab(t,!!n,e,r),p(!1),c(!1)}catch(e){throw p(!1),e}},[t,r,n]),j=(0,i.useMemo)(()=>Object.keys(t.configuration).map((e,a)=>{let r=t.configuration[e];return"input"===r.type?aj(r,e,0===a?l:void 0):"textarea"===r.type?ax(r,e):"password"===r.type?av(r,e):"select"===r.type?af(r,e):(0,s.jsx)("div",{},e)}),[t.configuration]);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(C.ZP,{title:t.name,visible:d,initialValues:m,onCancel:y,onOk:w,loading:u,children:(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(o.Z.Text,{children:(0,ay.ZP)(null!==(a=t.description)&&void 0!==a?a:"")}),j]})}),n?(0,s.jsx)(D.w6,{onEdit:g,children:"Edit"}):(0,s.jsxs)(D.HS,{onAdd:g,children:["Add a new \xab",t.name,"\xbb configuration"]})]})},aZ={del:"Unable to delete plugin"},aO=async(e,a)=>{try{await ah.Z.del({uuid:e.uuid}),await a.delOnePlugin(e)}catch(e){throw(0,v.lt)(aZ.del,e),e}},aC=e=>{var a;let{plugin:t,swr:r}=e,[n,l]=(0,i.useState)(!1),d=(0,i.useCallback)(async()=>{l(!0);try{await aO(t,r)}finally{l(!1)}},[t,r]);return(0,s.jsx)(D.m1,{loading:n,title:"Delete plugin",text:(0,s.jsxs)(s.Fragment,{children:["Are you sure you want to delete the plugin"," ",(0,s.jsx)(o.Z.Text,{strong:!0,children:null===(a=t.configuration.name)||void 0===a?void 0:a.value}),"?"]}),onDelete:d,children:"Delete"})};var aS=t(33160);let az={refresh:"Unable to refresh plugin"},aP=async e=>{try{let a=Y.Z.deepCopy(e);a.needReInit=!0,await ah.Z.update(a)}catch(e){(0,v.lt)(az.refresh,e)}},aE=e=>{let{plugin:a}=e,[t,r]=(0,i.useState)(!1),n=(0,i.useCallback)(()=>{(async()=>{r(!0),await aP(a),r(!1)})()},[a]);return(0,s.jsx)(J.ZP,{loading:t,icon:(0,s.jsx)(aS.Z,{}),onClick:n,className:"".concat(Q().noBackground," ").concat(Q().noBorder),children:"Refresh"},"refresh")},aN=e=>{let{plugin:a,plugins:t,swr:r}=e,[n,l]=(0,i.useState)([]);return(0,i.useEffect)(()=>{let e=t.map(e=>{var t,i;if(e.key!==a.key)return;let n=e.configuration,l=Object.keys(n).map(e=>{let a;if("name"!==e){if("textarea"===n[e].type){let t=n[e].value;a=(0,s.jsx)(o.Z.Paragraph,{children:(0,s.jsx)("pre",{children:(0,s.jsx)("code",{children:t})})})}else if("password"===n[e].type)a=(0,s.jsx)(o.Z.Text,{children:"******"});else{var t;a=(0,s.jsx)(o.Z.Text,{children:null!==(t=n[e].value)&&void 0!==t?t:"unset"})}return(0,s.jsxs)(o.Z.Paragraph,{children:[(0,s.jsxs)(o.Z.Text,{strong:!0,children:[n[e].label,":"]})," ",a]},e)}}).filter(e=>e),d=[];return d.push((0,s.jsx)(aC,{plugin:{uuid:e.uuid,configuration:e.configuration},swr:{delOnePlugin:r.delOnePlugin}},"delete")),e.haveInit&&d.push((0,s.jsx)(aE,{plugin:e})),d.push((0,s.jsx)(ak,{plugin:e,swr:{mutateOnePlugin:r.mutateOnePlugin},edit:!0},"plugin")),(0,s.jsx)(en.Z,{title:null===(t=n.name)||void 0===t?void 0:t.value,actions:d,children:(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(o.Z.Text,{children:(0,ay.ZP)(null!==(i=e.description)&&void 0!==i?i:"")}),l.length?l:(0,s.jsx)(o.Z.Text,{children:"No configuration data"})]})},e.uuid)}).filter(e=>e);l(e)},[a,t,r]),(0,s.jsx)(L.Z,{direction:"horizontal",wrap:!0,size:20,children:n})},aT={plugins:"Error while loading plugins"},a_=e=>{let{plugin:a}=e,[t,{addOnePlugin:r,delOnePlugin:n,mutateOnePlugin:l,errorPlugins:o,loadingPlugins:d}]=ah.Z.usePlugins();return((0,i.useEffect)(()=>{o&&(0,v.lt)(aT.plugins,o)},[o]),d)?(0,s.jsx)(ap.Z,{}):(0,s.jsxs)(L.Z,{direction:"vertical",className:Q().fullWidth,children:[(0,s.jsx)(ak,{plugin:{uuid:a.uuid,key:a.key,name:a.name,description:a.description,haveInit:a.haveInit,configuration:a.configuration,inUseConfiguration:a.inUseConfiguration},swr:{addOnePlugin:r}}),(0,s.jsx)(aN,{plugin:{key:a.key},plugins:t,swr:{delOnePlugin:n,mutateOnePlugin:l}})]})},aU={plugins:"Unable to load plugins"},aA=async()=>{try{let e=await am.Z.list(),a=e.filter(e=>"HPC"===e.category);if(a.length)return a.map(e=>(0,s.jsx)(en.Z,{title:e.name,children:(0,s.jsx)(a_,{plugin:{key:e.key,name:e.name,description:e.description,haveInit:e.haveInit,configuration:e.configuration,inUseConfiguration:e.inUseConfiguration}})},e.key));return[(0,s.jsx)(en.Z,{title:"No access",children:"You do not have access to any HPC plugin. Request it."},"no-access")]}catch(e){return(0,v.lt)(aU.plugins,e),[(0,s.jsx)(en.Z,{title:"Error",children:"Something led to an error. Please try again later."},"error")]}},aI=()=>{let[e,a]=(0,i.useState)([(0,s.jsx)(en.Z,{title:"Loading",children:(0,s.jsx)(ap.Z,{})},"loading")]);return(0,i.useEffect)(()=>{(async()=>{let e=await aA();a(e)})()},[]),(0,s.jsx)(L.Z,{direction:"vertical",className:"".concat(Q().fullWidth," ").concat(Q().scroll),size:20,children:e})},aR=e=>{let{user:a,swr:t}=e,l=(0,r.useRouter)(),{tab:d}=l.query,c=(0,i.useMemo)(()=>[{key:"personal",label:"Personal Information",children:(0,s.jsxs)(L.Z,{direction:"vertical",className:Q().fullWidth,size:20,children:[(0,s.jsx)(at,{user:{email:a.email,firstname:a.firstname,lastname:a.lastname,avatar:a.avatar},swr:{mutateUser:t.mutateUser}}),!w()()&&(0,s.jsx)(au,{swr:{clearUser:t.clearUser}})]})},w()()?null:{key:"security",label:"Security",children:(0,s.jsx)(L.Z,{direction:"vertical",className:Q().fullWidth,size:20,children:(0,s.jsx)(an,{user:{email:a.email}})})},{key:"hpc",label:"HPC Providers",children:(0,s.jsx)(aI,{})}].filter(e=>e),[a,t]),u=(0,i.useCallback)(e=>{(async()=>{await l.replace({pathname:"/dashboard",query:{page:"account",tab:e}})})()},[l]);return(0,s.jsxs)(n.Z,{className:"".concat(Q().noScroll," ").concat(eY().inDashboard),children:[(0,s.jsx)(E,{title:(0,s.jsx)(o.Z.Title,{level:2,style:{marginBottom:"0 !important"},children:"Account Settings"})}),(0,s.jsx)(n.Z.Content,{className:Q().noScroll,children:(0,s.jsx)(Z.Z,{className:"".concat(Q().noScroll," ").concat(eY().inDashboardTabs),type:"card",items:c,defaultActiveKey:null!=d?d:"personal",onChange:u})})]})};var aD=t(82826);let aq=()=>{var e;let{data:a,error:t,mutate:s}=(0,N.ZP)("/api/organizations",T._),r=null!==(e=null==a?void 0:a.organizations)&&void 0!==e?e:[],n=(0,i.useCallback)(async e=>{let a=[...r,{...e,pendingowners:[],users:[],pendingusers:[],groups:[]}];await s({organizations:a})},[r,s]),l=(0,i.useCallback)(async e=>{let a=r.filter(a=>a.id!==e.id);await s({organizations:a})},[r,s]),o=(0,i.useCallback)(async e=>{let a=r.map(a=>(a.id===e.id&&(a={...a,...e}),a));await s({organizations:a})},[r,s]);return[r,{addOneOrganization:n,delOneOrganization:l,mutateOneOrganization:o,errorOrganizations:t,loadingOrganizations:!a}]},aW=async e=>{let a=await (0,T.R)("/api/organization",{method:"POST",headers:{Accept:"application/json"},body:JSON.stringify(e)});return a.json()},aF=async(e,a)=>{await (0,T.R)("/api/organization",{method:"PUT",body:JSON.stringify({organization:e,data:a})})},aL=async e=>{await (0,T.R)("/api/organization",{method:"DELETE",body:JSON.stringify(e)})},aH=async e=>{await (0,T.R)("/api/organization/"+e.id,{method:"PUT"})},aB=async e=>{await (0,T.R)("/api/organization/"+e.id,{method:"POST"})},aG=async e=>{await (0,T.R)("/api/organization/"+e.id,{method:"DELETE"})};var aM={useOrganizations:aq,add:aW,update:aF,del:aL,accept:aH,decline:aB,quit:aG},aJ=t(17521);let aK={add:"Unable to add user",existing:"This user already exists or its invite is pending"},aY=(e,a)=>{var t,s,r,i,n,l;let o=null===(t=a.owners)||void 0===t?void 0:t.find(a=>a.email===e.email),d=null===(s=a.pendingowners)||void 0===s?void 0:s.find(a=>a.email===e.email),c=null===(r=a.users)||void 0===r?void 0:r.find(a=>a.email===e.email),u=null===(i=a.pendingusers)||void 0===i?void 0:i.find(a=>a.email===e.email);return null!==(l=null!==(n=null!=o?o:d)&&void 0!==n?n:c)&&void 0!==l?l:u},aV=async(e,a,t,s)=>{let r=aY(t,e);if(r)throw(0,v.lt)(aK.existing),Error(aK.existing);try{await aM.update(e,[{key:a,type:"array",method:"append",value:t.email.trim()}]);let r=Y.Z.deepCopy(e);r[a]=[...r[a],{email:t.email}],await s.mutateOneOrganization(r)}catch(e){throw(0,v.lt)(aK.add,e),e}},aX=e=>{let{title:a,organization:t,dBkey:r,swr:n}=e,l=(0,i.useRef)(null),[o,d]=(0,i.useState)(!1),[c,u]=(0,i.useState)(!1);(0,i.useEffect)(()=>{l.current&&l.current.focus()});let p=(0,i.useCallback)(()=>d(!0),[]),m=(0,i.useCallback)(()=>d(!1),[]),h=(0,i.useCallback)(async e=>{u(!0);try{await aV(t,r,e,n),u(!1),d(!1)}catch(e){throw u(!1),e}},[t,r,n]);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(C.ZP,{visible:o,loading:c,title:a,onCancel:m,onOk:h,children:(0,s.jsx)(b.Z.Item,{name:"email",label:"Email",rules:[{required:!0,message:"Email is required"}],children:(0,s.jsx)(k.Z,{ref:l})})}),(0,s.jsx)(D.HS,{onAdd:p,children:a})]})},aQ={del:"Unable to delete user"},a$=async(e,a,t,s)=>{try{await aM.update(a,[{key:t,type:"array",method:"remove",value:e.id}]);let r=Y.Z.deepCopy(a);r[t]=r[t].filter(a=>a.id!==e.id),await s.mutateOneOrganization(r)}catch(e){throw(0,v.lt)(aQ.del,e),e}},a0=e=>{let{disabled:a,user:t,organization:r,dBkey:n,swr:l}=e,[d,c]=(0,i.useState)(!1),u=(0,i.useCallback)(e=>e.firstname||e.lastname?e.firstname+" "+e.lastname:e.email,[]),p=(0,i.useCallback)(async()=>{c(!0);try{await a$(t,r,n,l)}finally{c(!1)}},[t,r,n,l]);return(0,s.jsx)(D.m1,{bordered:!0,disabled:a,title:"Delete organization",text:(0,s.jsxs)(s.Fragment,{children:["Are you sure you want to delete the user"," ",(0,s.jsx)(o.Z.Text,{strong:!0,children:u(t)}),"?"]}),loading:d,onDelete:p})},a1=e=>{let{organization:a,swr:t}=e,[r,n]=(0,i.useState)(),[l,o]=(0,i.useState)(),d=(0,i.useRef)(null),c=(0,i.useRef)(null),u=(0,i.useRef)(null),p=(0,i.useCallback)((e,a)=>Y.Z.userToAvatar(a),[]),m=(0,i.useCallback)(e=>(0,s.jsx)(a0,{disabled:a.owners.length<2&&!e.pending,user:{id:e.id,email:e.email},organization:{id:a.id,owners:a.owners,pendingowners:a.pendingowners,users:a.users,pendingusers:a.pendingusers},dBkey:e.pending?"pendingowners":"owners",swr:{mutateOneOrganization:t.mutateOneOrganization}}),[a,t]),h=(0,i.useCallback)(e=>(0,s.jsx)(a0,{user:{id:e.id,email:e.email,firstname:e.firstname,lastname:e.lastname},organization:{id:a.id,owners:a.owners,pendingowners:a.pendingowners,users:a.users,pendingusers:a.pendingusers},dBkey:e.pending?"pendingusers":"users",swr:{mutateOneOrganization:t.mutateOneOrganization}}),[a,t]),g=(0,i.useMemo)(()=>[{key:"avatar",dataIndex:"avatar",render:p},{key:"lastname",title:"Lastname",dataIndex:"lastname"},{key:"firstname",title:"Firstname",dataIndex:"firstname"},{key:"email",title:"Email",dataIndex:"email"}],[p]),y=(0,i.useMemo)(()=>[...g,{key:"actions",title:"Actions",align:"center",fixed:"right",width:75,render:m}],[g,m]),w=(0,i.useMemo)(()=>[...g,{key:"actions",title:"Actions",align:"center",fixed:"right",width:75,render:h}],[g,h]),j=(0,i.useCallback)(()=>{let e=d.current;if(!e)return;let a=e.clientHeight-15,t=a/2-39-12-32-20-75,s=e.clientHeight,r=e.clientHeight;s>t?n({y:t}):n(void 0),r>t?o({y:t}):o(void 0)},[]);return(0,i.useEffect)(()=>(window.addEventListener("resize",j),()=>{window.removeEventListener("resize",j)}),[j]),(0,i.useEffect)(()=>{j()},[a,j]),(0,s.jsx)("div",{ref:d,style:{height:"calc(100vh - 228px)"},children:(0,s.jsxs)(L.Z,{direction:"vertical",className:Q().fullWidth,size:20,children:[(0,s.jsx)(en.Z,{title:"Administrators",size:"small",children:(0,s.jsxs)(L.Z,{direction:"vertical",className:Q().fullWidth,size:20,children:[(0,s.jsx)(aX,{title:"New administrator",organization:{id:a.id,owners:a.owners,pendingowners:a.pendingowners,pendingusers:a.pendingusers,users:a.users},dBkey:"owners",swr:{mutateOneOrganization:t.mutateOneOrganization}}),(0,s.jsx)(aJ.Z,{loading:t.loadingOrganizations,pagination:!1,size:"small",columns:y,dataSource:[...a.owners.map(e=>({...e,key:e.id})),...a.pendingowners.map(e=>({...e,pending:!0,key:e.id}))],scroll:{y:null==r?void 0:r.y},ref:c})]})}),(0,s.jsx)(en.Z,{title:"Users",size:"small",children:(0,s.jsxs)(L.Z,{direction:"vertical",className:Q().fullWidth,size:20,children:[(0,s.jsx)(aX,{title:"New user",organization:{id:a.id,owners:a.owners,pendingowners:a.pendingowners,pendingusers:a.pendingusers,users:a.users},dBkey:"users",swr:{mutateOneOrganization:t.mutateOneOrganization}}),(0,s.jsx)(aJ.Z,{loading:null==t?void 0:t.loadingOrganizations,pagination:!1,size:"small",columns:w,dataSource:[...a.users.map(e=>({...e,key:e.id})),...a.pendingusers.map(e=>({...e,pending:!0,key:e.id}))],scroll:{y:null==l?void 0:l.y},ref:u})]})})]})})},a5=e=>{var a;let{data:t,error:s,mutate:r}=(0,N.ZP)("/api/groups/"+e,T._),n=null!==(a=null==t?void 0:t.groups)&&void 0!==a?a:[],l=(0,i.useCallback)(async e=>{let a=[...n,e];await r({groups:a})},[n,r]),o=(0,i.useCallback)(async e=>{let a=n.filter(a=>a.id!==e.id);await r({groups:a})},[n,r]),d=(0,i.useCallback)(async e=>{let a=n.map(a=>(a.id===e.id&&(a={...a,...e}),a));await r({groups:a})},[n,r]);return[n,{addOneGroup:l,delOneGroup:o,mutateOneGroup:d,errorGroups:s,loadingGroups:!t}]},a3=async(e,a)=>{let t=await (0,T.R)("/api/group",{method:"POST",body:JSON.stringify({organization:e,group:a})});return t.json()},a2=async(e,a)=>{await (0,T.R)("/api/group",{method:"PUT",body:JSON.stringify({group:e,data:a})})},a8=async e=>{await (0,T.R)("/api/group",{method:"DELETE",body:JSON.stringify(e)})};var a4={useGroups:a5,add:a3,update:a2,del:a8};let a7={del:"Unable to delete group"},a9=async(e,a)=>{try{await a4.del({id:e.id}),await a.delOneGroup({id:e.id})}catch(e){throw(0,v.lt)(a7.del,e),e}},a6=e=>{let{group:a,swr:t}=e,[r,n]=(0,i.useState)(!1),l=(0,i.useCallback)(async()=>{n(!0);try{await a9(a,t)}finally{n(!1)}},[a,t]);return(0,s.jsx)(D.m1,{bordered:!0,title:"Delete group",text:(0,s.jsxs)(s.Fragment,{children:["Are you sure you want to delete the group"," ",(0,s.jsx)(o.Z.Text,{strong:!0,children:a.name}),"?"]}),loading:r,onDelete:l})},te={add:"Unable to add group",update:"Unable to update group"},ta=async(e,a,t)=>{try{let s=await a4.add({id:e.id},{name:a.name,users:a.users});await t.addOneGroup({...s,name:a.name,users:a.users}),await t.mutateOneOrganization({id:e.id,groups:[...e.groups,s]})}catch(e){throw(0,v.lt)(te.add,e),e}},tt=async(e,a,t,s)=>{try{var r;let i=[];if(a.name!==t.name&&i.push({key:"name",value:t.name}),(null===(r=a.users)||void 0===r?void 0:r.map(e=>e.id).toString())!==t.users.toString()&&i.push({key:"users",value:t.users}),!i.length)return;await a4.update({id:a.id},i),await s.mutateOneGroup({...a,...t});let n=e.groups.findIndex(e=>e.id===a.id);await s.mutateOneOrganization({id:e.id,groups:[...e.groups.slice(0,n),a,...e.groups.slice(n+1)]})}catch(e){throw(0,v.lt)(te.update,e),e}},ts=e=>{var a;let{userOptions:t,organization:r,group:n,swr:l}=e,o=(0,i.useRef)(null),[d,c]=(0,i.useState)(!1),[u,p]=(0,i.useState)(!1);(0,i.useEffect)(()=>{o.current&&o.current.focus()});let m=(0,i.useCallback)(()=>c(!0),[]),h=(0,i.useCallback)(()=>c(!1),[]),g=(0,i.useCallback)(async e=>{p(!0);try{n?await tt(r,n,e,{mutateOneOrganization:l.mutateOneOrganization,mutateOneGroup:l.mutateOneGroup}):await ta(r,e,{mutateOneOrganization:l.mutateOneOrganization,addOneGroup:l.addOneGroup}),p(!1),c(!1)}catch(e){throw p(!1),e}},[r,n,l]);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(C.ZP,{title:n?"Edit group":"New group",visible:d,initialValues:n&&{name:n.name,users:null===(a=n.users)||void 0===a?void 0:a.map(e=>e.id)},onCancel:h,onOk:g,loading:u,children:[(0,s.jsx)(b.Z.Item,{name:"name",label:"Name",rules:[{required:!0,message:"Name is requried"}],children:(0,s.jsx)(k.Z,{ref:o})}),(0,s.jsx)(b.Z.Item,{name:"users",label:"Users",rules:[{required:!0,message:"Users selection is required"}],children:(0,s.jsx)(ag.Z,{mode:"multiple",placeholder:"Select users",options:t})})]}),n?(0,s.jsx)(D.w6,{bordered:!0,onEdit:m,children:"Edit"}):(0,s.jsx)(D.HS,{onAdd:m,children:"New group"})]})},tr={groups:"Error while loading groups"},ti=e=>{let{organization:a,swr:t}=e,[r,n]=(0,i.useState)([]),[l,o]=(0,i.useState)(null),d=(0,i.useRef)(null),[c,{addOneGroup:u,mutateOneGroup:p,delOneGroup:m,errorGroups:h,loadingGroups:g}]=a4.useGroups(a.id);(0,i.useEffect)(()=>{let e=a.owners,t=null==a?void 0:a.users,s=[...e,...t],r=s.map(e=>({label:e.firstname||e.lastname?e.firstname+" "+e.lastname:e.email,value:e.id}));n(r)},[a]),(0,i.useEffect)(()=>{h&&(0,v.lt)(tr.groups,h)},[h]);let y=(0,i.useCallback)(e=>(0,s.jsx)(H.C.Group,{maxCount:5,children:e.map(e=>Y.Z.userToAvatar(e))}),[]),w=(0,i.useCallback)((e,i)=>(0,s.jsxs)(L.Z,{children:[(0,s.jsx)(ts,{userOptions:r,organization:{id:a.id,groups:a.groups},group:{id:i.id,name:i.name,users:i.users},swr:{mutateOneOrganization:t.mutateOneOrganization,mutateOneGroup:p}}),(0,s.jsx)(a6,{group:{id:i.id,name:i.name},swr:{delOneGroup:m}})]}),[a,t,r,p,m]),j=(0,i.useMemo)(()=>[{title:"Group name",dataIndex:"name",key:"name"},{title:"Users",dataIndex:"users",key:"users",render:y},{title:"Actions",key:"actions",render:w}],[y,w]),x=(0,i.useCallback)(()=>{let e=d.current;e&&(e.clientHeight>window.innerHeight-e.offsetTop-59?o({y:window.innerHeight-e.offsetTop-59}):o(null))},[]);return(0,i.useEffect)(()=>(window.addEventListener("resize",x),()=>{window.removeEventListener("resize",x)}),[x]),(0,i.useEffect)(()=>{x()},[c,x]),(0,s.jsxs)(L.Z,{direction:"vertical",className:Q().fullWidth,size:20,children:[(0,s.jsx)(ts,{userOptions:r,organization:{id:a.id,groups:a.groups},swr:{mutateOneOrganization:t.mutateOneOrganization,addOneGroup:u}}),(0,s.jsx)(aJ.Z,{loading:g,pagination:!1,size:"small",columns:j,dataSource:c.map(e=>({key:e.id,...e})),scroll:{y:null==l?void 0:l.y},ref:d})]})},tn={name:"Unable to update organization's name"},tl=async(e,a,t)=>{try{await aM.update(e,[{key:"name",value:a}]),await t.mutateOneOrganization({...e,name:a})}catch(e){(0,v.lt)(tn.name,e)}},to=e=>{let{organization:a,swr:t,onClose:r}=e,n=(0,i.useCallback)(e=>{(async()=>{await tl(a,e,{mutateOneOrganization:t.mutateOneOrganization})})()},[a,t]);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:Q().displayFlex,children:[(0,s.jsx)(J.ZP,{style:{marginRight:"20px"},icon:(0,s.jsx)(aD.Z,{}),onClick:r}),(0,s.jsx)(o.Z.Title,{level:3,editable:{onChange:n},children:a.name})]}),(0,s.jsx)(Z.Z,{items:[{key:"users",label:"Users",children:(0,s.jsx)(a1,{organization:{id:a.id,owners:a.owners,pendingowners:a.pendingowners,users:a.users,pendingusers:a.pendingusers},swr:{mutateOneOrganization:t.mutateOneOrganization,loadingOrganizations:t.loadingOrganizations}})},{key:"groups",label:"Groups",children:(0,s.jsx)(ti,{organization:{id:a.id,owners:a.owners,users:a.users,groups:a.groups},swr:{mutateOneOrganization:t.mutateOneOrganization}})}]})]})},td={add:"Unable to add organization"},tc=async(e,a)=>{try{let t=await aM.add({name:e.name});t.name=e.name,await a.addOneOrganization(t)}catch(e){throw(0,v.lt)(td.add,e),e}},tu=e=>{let{swr:a}=e,t=(0,i.useRef)(null),[r,n]=(0,i.useState)(!1),[l,o]=(0,i.useState)(!1);(0,i.useEffect)(()=>{t.current&&t.current.focus()});let d=(0,i.useCallback)(()=>n(!0),[]),c=(0,i.useCallback)(()=>n(!1),[]),u=(0,i.useCallback)(async e=>{o(!0);try{await tc(e,a),o(!1),n(!1)}catch(e){throw o(!1),e}},[a]);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(C.ZP,{title:"New organization",visible:r,onCancel:c,onOk:u,loading:l,children:(0,s.jsx)(b.Z.Item,{name:"name",label:"Name",rules:[{required:!0,message:"Name is required"}],children:(0,s.jsx)(k.Z,{ref:t})})}),(0,s.jsx)(D.HS,{onAdd:d,children:"New organization"})]})};var tp=t(75768),tm=t(8751),th=t(18429);let tg={del:"Unable to delete organization"},ty=async(e,a)=>{try{await aM.del({id:e.id}),await a.delOneOrganization({id:e.id})}catch(e){throw(0,v.lt)(tg.del,e),e}},tw=e=>{let{organization:a,swr:t}=e,[r,n]=(0,i.useState)(!1),l=(0,i.useCallback)(async()=>{n(!0);try{await ty(a,t)}finally{n(!1)}},[a,t]);return(0,s.jsx)(D.m1,{bordered:!0,title:"Delete organization",text:(0,s.jsxs)(s.Fragment,{children:["Are you sure you want to delete the organization"," ",(0,s.jsx)(o.Z.Text,{strong:!0,children:a.name}),"?"]}),onDelete:l,loading:r})},tj={quit:"Unable to quit organization",accept:"Unable to accept invitation",decline:"Unable to decline invitation"},tx=async(e,a,t)=>{try{await aM.quit({id:e.id});let s=Y.Z.deepCopy(e),r=s.users.findIndex(e=>e.id===a.id);s.users.splice(r,1),await t.mutateOneOrganization(s)}catch(e){(0,v.lt)(tj.quit,e)}},tv=async(e,a,t)=>{try{await aM.accept(e);let s=Y.Z.deepCopy(e),r=s.pendingowners.findIndex(e=>e.id===a.id),i=s.pendingowners[r];if(-1!==r)s.pendingowners.splice(r,1),s.owners.push(i);else{let e=s.pendingusers.findIndex(e=>e.id===a.id),t=s.pendingusers[e];s.pendingusers.splice(e,1),s.users.push(t)}await t.mutateOneOrganization(s)}catch(e){(0,v.lt)(tj.accept,e)}},tf=async(e,a,t)=>{try{var s,r;await aM.decline({id:e.id});let i=Y.Z.deepCopy(e),n=null===(s=i.pendingowners)||void 0===s?void 0:s.findIndex(e=>e.id===a.id);if(-1!==n)i.pendingowners.splice(n,1);else{let e=null===(r=i.pendingusers)||void 0===r?void 0:r.findIndex(e=>e.id===a.id);i.pendingusers.splice(e,1)}await t.mutateOneOrganization(i)}catch(e){(0,v.lt)(tj.decline,e)}},tb=e=>{let{organization:a,swr:t,setOrganization:r}=e,n=(0,i.useCallback)(()=>r(a),[a,r]);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(J.ZP,{icon:(0,s.jsx)(p.Z,{}),onClick:n,children:"Manage"}),(0,s.jsx)(tw,{organization:{id:a.id,name:a.name},swr:{delOneOrganization:t.delOneOrganization}})]})},tk=e=>{let{user:a,organization:t,swr:r}=e,n=(0,i.useCallback)(()=>{(async()=>{await tx({id:t.id,users:t.users},{id:a.id},{mutateOneOrganization:r.mutateOneOrganization})})()},[a,t,r]);return(0,s.jsx)(J.ZP,{danger:!0,icon:(0,s.jsx)(tp.Z,{}),onClick:n,children:"Quit"})},tZ=e=>{let{user:a,organization:t,swr:r}=e,n=(0,i.useCallback)(()=>{(async()=>{await tv({id:t.id,owners:t.owners,pendingowners:t.pendingowners,users:t.users,pendingusers:t.pendingusers},{id:a.id},{mutateOneOrganization:r.mutateOneOrganization})})()},[a,t,r]);return(0,s.jsx)(J.ZP,{type:"primary",icon:(0,s.jsx)(tm.Z,{}),onClick:n,children:"Accept invitation"})},tO=e=>{let{user:a,organization:t,swr:r}=e,n=(0,i.useCallback)(()=>{(async()=>{await tf({id:t.id,pendingowners:t.pendingowners,pendingusers:t.pendingusers},{id:a.id},{mutateOneOrganization:r.mutateOneOrganization})})()},[a,t,r]);return(0,s.jsx)(J.ZP,{danger:!0,icon:(0,s.jsx)(th.Z,{}),onClick:n,children:"Decline"})},tC=e=>{var a;let{user:t,organizations:r,swr:n,setOrganization:l}=e,[o,d]=(0,i.useState)(null),c=(0,i.useRef)(null),u=(0,i.useCallback)(e=>(0,s.jsx)(H.C.Group,{maxCount:5,children:null==e?void 0:e.map(e=>Y.Z.userToAvatar(e))}),[]),p=(0,i.useCallback)(e=>(0,s.jsx)(H.C.Group,{maxCount:5,children:null==e?void 0:e.map(e=>Y.Z.userToAvatar(e))}),[]),m=(0,i.useCallback)(e=>(0,s.jsx)(H.C.Group,{maxCount:5,children:null==e?void 0:e.map(e=>Y.Z.groupToAvatar(e))}),[]),h=(0,i.useCallback)(e=>e.owners.find(e=>e.id===t.id)?(0,s.jsx)(L.Z,{wrap:!0,children:(0,s.jsx)(tb,{organization:e,swr:{delOneOrganization:n.delOneOrganization},setOrganization:l})}):e.users.find(e=>e.id===t.id)?(0,s.jsx)(L.Z,{wrap:!0,children:(0,s.jsx)(tk,{user:t,organization:e,swr:{mutateOneOrganization:n.mutateOneOrganization}})}):e.pendingowners.find(e=>e.id===t.id)||e.pendingusers.find(e=>e.id===t.id)?(0,s.jsxs)(L.Z,{wrap:!0,children:[(0,s.jsx)(tZ,{user:t,organization:e,swr:{mutateOneOrganization:n.mutateOneOrganization}}),(0,s.jsx)(tO,{user:t,organization:e,swr:{mutateOneOrganization:n.mutateOneOrganization}})]}):null,[t,n,l]),g=(0,i.useMemo)(()=>[{title:"Name",dataIndex:"name",key:"name",sorter:(e,a)=>{var t,s;let r=null!==(t=e.name)&&void 0!==t?t:"",i=null!==(s=a.name)&&void 0!==s?s:"";return r.localeCompare(i)}},{title:"Administrators",dataIndex:"owners",key:"owners",render:u},{title:"Users",dataIndex:"users",key:"users",render:p},{title:"Groups",dataIndex:"groups",key:"groups",render:m},{title:"Actions",key:"actions",render:h}],[u,p,m,h]),y=(0,i.useCallback)(()=>{let e=c.current;e&&(e.clientHeight>window.innerHeight-e.offsetTop-59?d({y:window.innerHeight-e.offsetTop-59}):d(null))},[]);return(0,i.useEffect)(()=>(window.addEventListener("resize",y),()=>{window.removeEventListener("resize",y)}),[y]),(0,i.useEffect)(()=>{y()},[r,y,null===(a=c.current)||void 0===a?void 0:a.offsetTop]),(0,s.jsx)(aJ.Z,{loading:n.loadingOrganizations,pagination:!1,size:"small",columns:g,dataSource:null==r?void 0:r.map(e=>({key:e.id,id:e.id,name:e.name,owners:e.owners,pendingowners:e.pendingowners,users:e.users,pendingusers:e.pendingusers,groups:e.groups})),ref:c,scroll:{y:null==o?void 0:o.y}})},tS=e=>{let{user:a,organizations:t,swr:l}=e,[d,c]=(0,i.useState)(),u=(0,r.useRouter)(),{organizationId:p}=u.query;(0,i.useEffect)(()=>{if(p){let e=t.find(e=>e.id===p);c(e)}},[p,t]),(0,i.useEffect)(()=>{if(d){let e=t.find(e=>e.id===d.id);JSON.stringify(e)!==JSON.stringify(d)&&c(e)}},[t,d]);let m=(0,i.useCallback)(()=>{(async()=>{await u.push({pathname:"dashboard",query:{page:"organizations"}}),c(null)})()},[u]),h=(0,i.useCallback)(e=>{(async()=>{await u.push({pathname:"dashboard",query:{page:"organizations",organizationId:e.id}}),c(e)})()},[u]);return(0,s.jsxs)(n.Z,{className:eY().inDashboard,children:[(0,s.jsx)(E,{title:(0,s.jsx)(o.Z.Title,{level:2,style:{marginBottom:"0 !important"},children:"Organizations"})}),(0,s.jsx)(n.Z.Content,{className:Q().noScroll,children:d?(0,s.jsx)(to,{organization:{id:d.id,name:d.name,owners:d.owners,pendingowners:d.pendingowners,users:d.users,pendingusers:d.pendingusers,groups:d.groups},swr:{mutateOneOrganization:l.mutateOneOrganization,loadingOrganizations:l.loadingOrganizations},onClose:m}):(0,s.jsxs)(L.Z,{direction:"vertical",className:Q().fullWidth,size:20,children:[(0,s.jsx)(tu,{swr:{addOneOrganization:l.addOneOrganization}}),(0,s.jsx)(tC,{user:{id:a.id},organizations:t,swr:{mutateOneOrganization:l.mutateOneOrganization,delOneOrganization:l.delOneOrganization,loadingOrganizations:l.loadingOrganizations},setOrganization:h})]})})]})};var tz=t(53575),tP=t(55241),tE=t(63606),tN=t(32808),tT=t(69081);let t_={add:"Unable to add user"},tU=async(e,a)=>{try{let t=await e5.Z.add({email:e.email,password:e.password});if(t.alreadyExists)throw Error("User already exists");await e5.Z.updateById(t.id,[{key:"firstname",value:e.firstname},{key:"lastname",value:e.lastname},{key:"authorizedplugins",value:e.authorizedplugins},{key:"superuser",value:!!e.superuser}]);let s={...t,email:e.email,firstname:e.firstname,lastname:e.firstname,superuser:e.superuser};await a.addOneUser(s)}catch(e){throw(0,v.lt)(t_.add,e),e}},tA=e=>{let{plugins:a,swr:t}=e,r=(0,i.useRef)(null),[n,l]=(0,i.useState)(!1),[o,d]=(0,i.useState)(!1),[c]=tT.Z.useSystem();(0,i.useEffect)(()=>{r.current&&r.current.focus()});let u=(0,i.useCallback)(()=>l(!0),[]),p=(0,i.useCallback)(()=>l(!0),[]),m=(0,i.useCallback)(async e=>{d(!0);try{await tU(e,t),d(!1),l(!1)}catch(e){throw d(!1),e}},[t]);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(C.ZP,{title:"New user",visible:n,initialValues:c.defaultplugins&&{authorizedplugins:c.defaultplugins},onCancel:p,onOk:m,loading:o,children:[(0,s.jsx)(b.Z.Item,{name:"firstname",label:"First name",children:(0,s.jsx)(k.Z,{ref:r})}),(0,s.jsx)(b.Z.Item,{name:"lastname",label:"Last name",children:(0,s.jsx)(k.Z,{})}),(0,s.jsx)(b.Z.Item,{name:"email",label:"Email",rules:[{required:!0,message:"Email is required"}],children:(0,s.jsx)(k.Z,{})}),(0,s.jsx)(as.o,{name:"password"}),(0,s.jsx)(b.Z.Item,{name:"authorizedplugins",label:"Plugins",children:(0,s.jsx)(ag.Z,{mode:"multiple",options:a.map(e=>({label:e.name,value:e.key}))})}),(0,s.jsx)(b.Z.Item,{name:"superuser",label:"Administrator",valuePropName:"checked",children:(0,s.jsx)(tN.Z,{})})]}),(0,s.jsx)(D.HS,{onAdd:u,children:"New user"})]})},tI={update:"Unable to update user"},tR=async(e,a,t)=>{try{let s=Object.keys(a).map(t=>{let s=a[t];if(void 0!==s&&"******"!==s&&s!==e[t])return{key:t,value:s,type:"password"===t&&"crypt"}}).filter(e=>e);if(!s.length)return;await e5.Z.updateById(e.id,s),a.password="******";let r={...e,...a};await t.mutateOneUser(r)}catch(e){throw(0,v.lt)(tI.update,e),e}},tD=e=>{let{plugins:a,user:t,swr:r}=e,n=(0,i.useRef)(null),[l,o]=(0,i.useState)(!1),[d,c]=(0,i.useState)(!1);(0,i.useEffect)(()=>{n.current&&n.current.focus()});let u=(0,i.useCallback)(()=>o(!0),[]),p=(0,i.useCallback)(()=>o(!1),[]),m=(0,i.useCallback)(async e=>{c(!0);try{await tR(t,e,r),c(!1),o(!1)}catch(e){throw c(!1),e}},[t,r]);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(C.ZP,{title:"Edit user",visible:l,initialValues:{...t,password:"******",authorizedplugins:t.authorizedplugins},onCancel:p,onOk:m,loading:d,children:[(0,s.jsx)(b.Z.Item,{name:"firstname",label:"First name",children:(0,s.jsx)(k.Z,{ref:n})}),(0,s.jsx)(b.Z.Item,{name:"lastname",label:"Last name",children:(0,s.jsx)(k.Z,{})}),(0,s.jsx)(b.Z.Item,{name:"email",label:"Email",rules:[{required:!0,message:"Email is required"}],children:(0,s.jsx)(k.Z,{})}),(0,s.jsx)(as.o,{name:"password",edit:!0}),(0,s.jsx)(b.Z.Item,{name:"authorizedplugins",label:"Plugins",children:(0,s.jsx)(ag.Z,{mode:"multiple",options:a.map(e=>({label:e.name,value:e.key}))})}),(0,s.jsx)(b.Z.Item,{name:"superuser",label:"Administrator",valuePropName:"checked",children:(0,s.jsx)(tN.Z,{})})]}),(0,s.jsx)(D.w6,{bordered:!0,onEdit:u,children:"Edit"})]})},tq={del:"Unable to delete user"},tW=async(e,a)=>{try{await e5.Z.delById(e.id),await a.delOneUser({id:e.id})}catch(e){throw(0,v.lt)(tq.del,e),e}},tF=e=>{let{user:a,swr:t}=e,[r,n]=(0,i.useState)(!1),l=(0,i.useCallback)(async()=>{n(!0);try{await tW(a,t)}finally{n(!1)}},[a,t]);return(0,s.jsx)(D.m1,{loading:r,bordered:!0,text:(0,s.jsxs)(s.Fragment,{children:["Are you sure you want to delete the user"," ",(0,s.jsx)(o.Z.Text,{strong:!0,children:a.email}),"?"]}),title:"Delete user",onDelete:l})},tL={plugins:"Unable to load plugins"},tH=e=>{var a,t;let{users:r,swr:n}=e,l=(0,i.useRef)(null),[o,d]=(0,i.useState)(),[c,u]=(0,i.useState)(),p=(0,i.useCallback)(e=>{e.sort((e,a)=>e.localeCompare(a));let a=e.map(e=>{let a=null==o?void 0:o.find(a=>a.key===e);if(a)return(0,s.jsx)(tz.Z.Ribbon,{text:a.category,style:{marginTop:"-15px"},children:(0,s.jsx)(en.Z,{size:"small",children:a.name})},e)}),t=(0,s.jsx)(L.Z,{direction:"vertical",children:a});return(0,s.jsx)(tP.Z,{content:t,children:(0,s.jsxs)(J.ZP,{children:[a.length," plugins"]})})},[o]),m=(0,i.useCallback)(e=>e?(0,s.jsx)(tE.Z,{className:Q().textGreen}):null,[]),h=(0,i.useCallback)((e,t)=>(0,s.jsxs)(L.Z,{children:[(0,s.jsx)(tD,{plugins:null!==(a=null==o?void 0:o.map(e=>({key:e.key,name:e.name})))&&void 0!==a?a:[],user:{id:t.id,firstname:t.firstname,lastname:t.lastname,email:t.email,authorizedplugins:t.authorizedplugins,superuser:t.superuser},swr:{mutateOneUser:n.mutateOneUser}}),(0,s.jsx)(tF,{user:{id:t.id,email:t.email},swr:{delOneUser:n.delOneUser}})]}),[o,n]),g=(0,i.useMemo)(()=>[{title:"First name",dataIndex:"firstname",key:"firstname",sorter:(e,a)=>{var t,s;let r=null!==(t=e.firstname)&&void 0!==t?t:"",i=null!==(s=a.firstname)&&void 0!==s?s:"";return r.localeCompare(i)}},{title:"Last name",dataIndex:"lastname",key:"lastname",sorter:(e,a)=>{var t,s;let r=null!==(t=e.lastname)&&void 0!==t?t:"",i=null!==(s=a.lastname)&&void 0!==s?s:"";return r.localeCompare(i)}},{title:"Email",dataIndex:"email",key:"email",sorter:(e,a)=>{let t=e.email,s=a.email;return t.localeCompare(s)}},{title:"Password",key:"password",render:()=>"******"},{title:"Plugins",dataIndex:"authorizedplugins",key:"authorizedplugins",render:p},{title:"Administrator",dataIndex:"superuser",key:"superuser",align:"center",render:m},{title:"Actions",key:"actions",render:h}],[p,m,h]),y=(0,i.useCallback)(()=>{let e=l.current;e&&(e.clientHeight>window.innerHeight-e.offsetTop-59?u({y:window.innerHeight-e.offsetTop-59}):u(void 0))},[]);return(0,x.Z)(()=>(window.addEventListener("resize",y),()=>{window.removeEventListener("resize",y)}),void 0,[y]),(0,x.Z)(()=>{y()},[r],[y]),(0,i.useEffect)(()=>{(async()=>{try{let e=await am.Z.completeList();d(e)}catch(e){(0,v.lt)(tL.plugins,e)}})()},[]),(0,s.jsxs)(L.Z,{direction:"vertical",className:"".concat(Q().fullWidth," ").concat(Q().fullHeight),size:20,children:[(0,s.jsx)(tA,{plugins:null!==(t=null==o?void 0:o.map(e=>({key:e.key,name:e.name})))&&void 0!==t?t:[],swr:{addOneUser:n.addOneUser}}),(0,s.jsx)(aJ.Z,{loading:!o,pagination:!1,size:"small",columns:g,dataSource:r.map(e=>({...e,key:e.id})),ref:l,scroll:{y:null==c?void 0:c.y}})]})};var tB=t(12251),tG=t(59420);let tM={system:"Error while loading system",update:"Unable to update system"},tJ=async(e,a)=>{try{await tT.Z.update([{key:"allowsignup",value:!e.allowsignup}]),await a({allowsignup:!e.allowsignup}),(0,v.Ur)("Changes saved")}catch(e){(0,v.lt)(tM.update,e)}},tK=async(e,a)=>{try{await tT.Z.update([{key:"password",value:e}]),await a({password:e}),(0,v.Ur)("Changes saved")}catch(e){(0,v.lt)(tM.update,e)}},tY=()=>{let[e]=b.Z.useForm(),[a,{mutateSystem:t,errorSystem:r,loadingSystem:n}]=tT.Z.useSystem();(0,i.useEffect)(()=>{r&&(0,v.lt)(tM.system,r)},[r]),(0,i.useEffect)(()=>{var t;n||e.setFieldsValue(null!==(t=null==a?void 0:a.password)&&void 0!==t?t:{min:tG.yL,max:tG.nq,requireLetter:tG.JT,requireNumber:tG.tE,requireSymbol:tG.ah})},[n,e,null==a?void 0:a.password]);let l=(0,i.useCallback)(()=>{(async()=>{await tJ(a,t)})()},[a,t]),o=(0,i.useCallback)(e=>{(async()=>{await tK(e,t)})()},[t]);return n?(0,s.jsx)(f.Z.Simple,{}):(0,s.jsxs)(L.Z,{direction:"vertical",className:Q().fullWidth,size:20,children:[(0,s.jsx)(en.Z,{title:"Signup",children:(0,s.jsx)(tN.Z,{checked:null==a?void 0:a.allowsignup,onChange:l,children:"Allow signup"})}),(0,s.jsx)(en.Z,{title:"Password",children:(0,s.jsx)(b.Z,{form:e,name:"form",onFinish:o,style:{display:"flex",justifyContent:"space-between"},children:(0,s.jsxs)("div",{className:"".concat(Q().displayFlex," ").concat(Q().fullWidth),style:{justifyContent:"space-between"},children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(b.Z.Item,{label:"Minimum number of characters",name:"min",rules:[{required:!0,message:"Minimum number of characters is required"}],children:(0,s.jsx)(tB.Z,{min:0,max:64})}),(0,s.jsx)(b.Z.Item,{label:"Maximum number of characters",name:"max",rules:[{required:!0,message:"Maximum number of characters is required"}],children:(0,s.jsx)(tB.Z,{min:0,max:64})})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(b.Z.Item,{valuePropName:"checked",name:"requireLetter",children:(0,s.jsx)(tN.Z,{children:"Require letter"})}),(0,s.jsx)(b.Z.Item,{valuePropName:"checked",name:"requireNumber",children:(0,s.jsx)(tN.Z,{children:"Require number"})}),(0,s.jsx)(b.Z.Item,{valuePropName:"checked",name:"requireSymbol",children:(0,s.jsx)(tN.Z,{children:"Require symbol"})})]}),(0,s.jsx)("div",{style:{marginTop:"auto"},children:(0,s.jsx)(b.Z.Item,{children:(0,s.jsx)(J.ZP,{type:"primary",icon:(0,s.jsx)(tE.Z,{}),htmlType:"submit",children:"Save changes"})})})]})})})]})},tV={plugins:"Unable to get plugins",update:"Unable to update system"},tX=async(e,a,t,s)=>{try{var r;await tT.Z.update([{key:"defaultplugins",type:"array",method:t?"append":"remove",value:a.key}]);let i=Y.Z.deepCopy(null!==(r=null==e?void 0:e.defaultplugins)&&void 0!==r?r:[]),n=i.indexOf(a.key);t&&-1===n&&i.push(a.key),t||-1===n||i.splice(n,1),await s.mutateSystem({defaultplugins:i})}catch(e){(0,v.lt)(tV.update,e)}},tQ=e=>{let{plugin:a,system:t,swr:r}=e,[n,l]=(0,i.useState)();(0,i.useEffect)(()=>{if(null==t?void 0:t.defaultplugins){let e=t.defaultplugins.includes(a.key);l(e)}},[a,t]);let o=(0,i.useCallback)(e=>{(async()=>{await tX(t,a,e.target.checked,r)})()},[a,t,r]);return(0,s.jsx)(tN.Z,{checked:n,onChange:o})},t$=()=>{let e=(0,i.useRef)(null),[a,t]=(0,i.useState)(),[r,n]=(0,i.useState)(),[l,{mutateSystem:o,loadingSystem:d}]=tT.Z.useSystem();(0,i.useEffect)(()=>{(async()=>{try{let e=await am.Z.completeList();t(e)}catch(e){(0,v.lt)(tV.plugins,e)}})()},[]);let c=(0,i.useCallback)(e=>(0,s.jsx)(tQ,{system:l,plugin:e,swr:{mutateSystem:o}}),[l,o]),u=(0,i.useMemo)(()=>[{title:"Category",dataIndex:"category",key:"category"},{title:"Name",dataIndex:"name",key:"name"},{title:"Default enabled",key:"enable",render:c}],[c]),p=(0,i.useCallback)(()=>{let a=e.current;a&&(a.clientHeight>window.innerHeight-a.offsetTop-59?n({y:window.innerHeight-a.offsetTop-59}):n(null))},[]);return(0,i.useEffect)(()=>(window.addEventListener("resize",p),()=>{window.removeEventListener("resize",p)}),[p]),(0,i.useEffect)(()=>{p()},[a,p]),(0,s.jsx)(aJ.Z,{loading:!a||d,pagination:!1,size:"small",columns:u,dataSource:a,ref:e,scroll:{y:null==r?void 0:r.y}})},t0={users:{label:"Users",key:"users"},registration:{label:"Registration",key:"registration"},plugins:{label:"Plugins",key:"plugins"}},t1={users:"Error while loading users"},t5=()=>{let e=(0,r.useRouter)(),{tab:a}=e.query,[t,{addOneUser:l,mutateOneUser:d,delOneUser:c,errorUsers:u}]=e5.Z.useUsers();(0,i.useEffect)(()=>{u&&(0,v.lt)(t1.users,u)},[u]);let p=(0,i.useCallback)(a=>{(async()=>{await e.replace({pathname:"/dashboard",query:{page:"administration",tab:a}})})()},[e]);return(0,s.jsxs)(n.Z,{className:eY().inDashboard,children:[(0,s.jsx)(E,{title:(0,s.jsx)(o.Z.Title,{level:2,style:{marginBottom:"0 !important"},children:"Administration"})}),(0,s.jsx)(n.Z.Content,{children:(0,s.jsx)(Z.Z,{className:eY().inDashboardTabs,type:"card",items:[{key:t0.users.key,label:t0.users.label,children:(0,s.jsx)(tH,{users:t,swr:{addOneUser:l,mutateOneUser:d,delOneUser:c}})},{key:t0.registration.key,label:t0.registration.label,children:(0,s.jsx)(tY,{})},{key:t0.plugins.key,label:t0.plugins.label,children:(0,s.jsx)(t$,{})}],defaultActiveKey:null!=a?a:"default",onChange:p})})]})};var t3=t(41664),t2=t.n(t3);let t8=()=>(0,s.jsxs)(n.Z,{className:eY().inDashboard,children:[(0,s.jsx)(E,{title:(0,s.jsx)(o.Z.Title,{level:2,style:{marginBottom:"0 !important"},children:"Help"})}),(0,s.jsx)(n.Z.Content,{className:Q().scroll,children:(0,s.jsxs)(L.Z,{direction:"vertical",className:Q().fullWidth,size:20,children:[(0,s.jsxs)(o.Z,{children:[(0,s.jsx)(o.Z.Title,{level:3,children:"Documentation"}),(0,s.jsxs)(o.Z.Text,{children:["Full interface"," ",(0,s.jsx)(t2(),{href:"/doc",target:"_blank",children:"Documentation"})]})]}),(0,s.jsxs)(o.Z,{children:[(0,s.jsx)(o.Z.Title,{level:3,children:"Bug report"}),(0,s.jsxs)(o.Z.Text,{children:[(0,s.jsx)(t2(),{href:"https://github.com/Airthium/tanatloc/issues/new/choose",target:"_blank",children:"Open an issue"})," ","on Github"]})]}),(0,s.jsxs)(o.Z,{children:[(0,s.jsx)(o.Z.Title,{level:3,children:"Feature request"}),(0,s.jsxs)(o.Z.Text,{children:[(0,s.jsx)(t2(),{href:"https://github.com/Airthium/tanatloc/issues/new/choose",target:"_blank",children:"Open an issue"})," ","on Github"]})]})]})})]}),t4=async()=>{if(!w()())return{needed:!1};let e=await fetch("https://api.github.com/repos/Airthium/tanatloc-electron/releases/latest",{method:"GET"}),a=await e.json(),t=j.i8,s=!a.tag_name.includes("alpha")&&!a.tag_name.includes("beta")&&t!==a.tag_name;return{needed:s,res:a}};var t7={needUpdate:t4};let t9=()=>{let[e,a]=(0,i.useState)(),[t,r]=(0,i.useState)(!1);(0,i.useEffect)(()=>{(async()=>{try{let e=await t7.needUpdate();e.needed&&a(e)}catch(e){console.error(e)}})()},[]),(0,i.useEffect)(()=>{(null==e?void 0:e.needed)&&r(!0)},[e]);let n=(0,i.useCallback)(()=>{r(!1)},[]),l=(0,i.useCallback)(async()=>{window.open("https://github.com/Airthium/tanatloc-electron/releases/tag/"+(null==e?void 0:e.res.tag_name),"_blank"),r(!1)},[e]);return(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(C.ZP,{visible:t,title:"Update",okButtonText:"Update",onCancel:n,onOk:l,children:(0,s.jsxs)(L.Z,{direction:"vertical",children:[(0,s.jsx)(o.Z.Text,{children:"A new release is available"}),(0,s.jsxs)(o.Z.Text,{children:["Do you want to update to version"," ",(0,s.jsx)(o.Z.Text,{code:!0,children:null==e?void 0:e.res.tag_name}),"?"]})]})})})};var t6=t(52228);let se={user:"Error while loading user",organizations:"Error while loading organizations",workspaces:"Error while loading workspaces",logout:"Unable to logout"},sa={workspaces:{label:"Workspaces",key:"workspaces"},account:{label:"Account Settings",key:"account"},organizations:{label:"Organizations",key:"organizations"},administration:{label:"Administration",key:"administration"},editor:{label:"Model Editor",key:"editor"},help:{label:"I Need Help",key:"help"},logout:{label:"Logout",key:"logout"}},st=()=>{let[e,a]=(0,i.useState)(),[t,{mutateUser:y,clearUser:b,errorUser:k,loadingUser:Z}]=e5.Z.useUser(),[O,{addOneOrganization:C,delOneOrganization:S,mutateOneOrganization:z,errorOrganizations:P,loadingOrganizations:E}]=aM.useOrganizations(),[N,{addOneWorkspace:T,delOneWorkspace:_,mutateOneWorkspace:U,errorWorkspaces:A,loadingWorkspaces:I}]=R.useWorkspaces(),D=(0,r.useRouter)(),q=(0,i.useCallback)(async()=>{try{await ao(),await b(),await D.push("/")}catch(e){(0,v.lt)(se.logout,e)}},[D,b]),W=(0,i.useCallback)(async e=>{a(e),e===sa.logout.key?await q():e===sa.editor.key?await D.push("/editor"):await D.replace({pathname:"/dashboard",query:{page:e}})},[D,q]),F=(0,i.useCallback)(e=>{let{keyPath:a}=e;(async()=>{let e=a.pop();await W(e)})()},[W]);return((0,x.Z)(()=>{(async()=>{w()()?await (0,t6.x)({email:"admin",password:"password"}):Z||t||await D.replace("/")})()},[t,Z,D]),(0,x.Z)(()=>{(async()=>{let e=new URLSearchParams(window.location.search),t=e.get("page");t?a(t):await W(sa.workspaces.key)})()},[D],[W]),(0,x.Z)(()=>{k&&(0,v.lt)(se.user,k),P&&(0,v.lt)(se.organizations,P),A&&(0,v.lt)(se.workspaces,A)},[k,P,A]),!t||Z||E||I)?(0,s.jsx)(f.Z,{}):(0,s.jsxs)(n.Z,{className:eY().dashboard,children:[(0,s.jsx)(t9,{}),(0,s.jsxs)(n.Z.Sider,{theme:"light",width:"256",className:eY().sider,children:[(0,s.jsx)("div",{className:Q().logo,children:(0,s.jsx)("img",{src:"/images/logo.svg",alt:"Tanatloc"})}),(0,s.jsx)(l.Z,{className:eY().menu,items:[{key:sa.workspaces.key,icon:(0,s.jsx)(d.Z,{}),label:sa.workspaces.label},{key:sa.account.key,icon:(0,s.jsx)(c.Z,{}),label:sa.account.label},{key:sa.organizations.key,icon:(0,s.jsx)(u.Z,{}),label:sa.organizations.label,className:w()()?"display-none":""},{key:sa.administration.key,className:t.superuser&&!w()()?"":"display-none",icon:(0,s.jsx)(p.Z,{}),label:sa.administration.label},{key:sa.editor.key,icon:(0,s.jsx)(m.Z,{}),label:sa.editor.label},{key:sa.help.key,icon:(0,s.jsx)(h.Z,{}),label:sa.help.label},{type:"divider"},{key:sa.logout.key,danger:!0,icon:(0,s.jsx)(g.Z,{}),label:sa.logout.label,className:w()()?"display-none":""},{key:"version",disabled:!0,className:"version",label:(0,s.jsxs)(o.Z.Text,{className:Q().textLight,ellipsis:{tooltip:!0},children:["version ",j.i8]})}],onClick:F,mode:"inline"})]}),(0,s.jsxs)(n.Z.Content,{className:Q().noScroll,children:[e===sa.workspaces.key&&(0,s.jsx)(eQ,{user:{id:t.id},workspaces:N,organizations:O,swr:{addOneWorkspace:T,delOneWorkspace:_,mutateOneWorkspace:U}}),e===sa.account.key&&(0,s.jsx)(aR,{user:{email:t.email,firstname:t.firstname,lastname:t.lastname,avatar:t.avatar},swr:{mutateUser:y,clearUser:b}}),e===sa.organizations.key&&(0,s.jsx)(tS,{user:{id:t.id},organizations:O,swr:{addOneOrganization:C,delOneOrganization:S,mutateOneOrganization:z,loadingOrganizations:E}}),e===sa.administration.key&&(0,s.jsx)(t5,{}),e===sa.help.key&&(0,s.jsx)(t8,{})]})]})},ss=()=>(0,s.jsx)(st,{});var sr=ss},19563:function(e){e.exports={information:"information_information__yYfa0"}},43308:function(e){e.exports={variables:'"@/styles/index.module.css"',colorPrimary:"#fad114",head:"pageHeader_head__Rg3v0",divider:"pageHeader_divider__Q8Uwh"}},89957:function(e){e.exports={variables:'"@/styles/index.module.css"',colorPrimary:"#fad114",dashboard:"dashboard_dashboard__2fbzf",sider:"dashboard_sider__Xow9X",menu:"dashboard_menu__sfMEa","display-none":"dashboard_display-none__qLotk","ant-menu-item-divider":"dashboard_ant-menu-item-divider__K5fZ7",inDashboard:"dashboard_inDashboard__L7TwS",inDashboardTabs:"dashboard_inDashboardTabs__BNSBv"}},80108:function(e){e.exports={loading:"loading_loading__JrCmd",title:"loading_title__ESacg",content:"loading_content__NuP8g",status:"loading_status__UhnSG",errors:"loading_errors__j2ZIA",error:"loading_error__p5Dww",errorCard:"loading_errorCard__BCfHX"}},61131:function(e){e.exports={variables:'"@/styles/variables.css"',colorPrimary:"#fad114",textColorLight:"rgba(0, 0, 0, 0.45)",card:"list_card___5zau",cardArchived:"list_cardArchived__zF3ZU",carousel:"list_carousel__7Kbe3",carouselSnapshot:"list_carouselSnapshot__JE5WI",carouselSnapshotArchived:"list_carouselSnapshotArchived__XZtlt",carouselDescription:"list_carouselDescription__5g2xC",carouselDescriptionArchived:"list_carouselDescriptionArchived__NzAls",empty:"list_empty__xeGxK",emptySearch:"list_emptySearch__MI0zq"}},85318:function(e){e.exports={search:"workspace_search__xni0S",shared:"workspace_shared__UPnwR",tabs:"workspace_tabs__HWnBo"}},4147:function(e){"use strict";e.exports=JSON.parse('{"i8":"1.2.8-beta.3"}')}},function(e){e.O(0,[5336,9391,5813,8027,2441,3363,9014,954,3441,6812,3159,7521,1978,4129,587,7770,9774,2888,179],function(){return e(e.s=9637)}),_N_E=e.O()}]);