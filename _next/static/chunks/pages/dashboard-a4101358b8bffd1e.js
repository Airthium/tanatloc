(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8026],{40528:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/dashboard",function(){return a(44097)}])},37404:function(e,t,a){"use strict";a.d(t,{JT:function(){return n},ah:function(){return s},nq:function(){return i},tE:function(){return l},yL:function(){return r}}),a(83454).env.AUTH_SECRET||Array(33).join("a");let r=6,i=16,n=!0,l=!0,s=!0},5094:function(e,t,a){"use strict";a.d(t,{Z:function(){return n}});var r=a(11425);let i=async(e,t)=>{let a=await (0,r.R)("/api/avatar",{method:"POST",headers:{Accept:"application/json"},body:JSON.stringify({file:e,project:t})});return a.json()};var n={add:i}},4415:function(e,t,a){"use strict";a.d(t,{H:function(){return r}});class r extends Error{constructor(e){super(e.title),this.title=e.title,this.name="APIError",this.render=e.render,this.err=e.err,this.type=e.type||"error"}}},71270:function(e,t,a){"use strict";a.d(t,{Z:function(){return c}});var r=a(11425);let i=async e=>{await (0,r.R)("/api/plugin",{method:"POST",body:JSON.stringify(e)})},n=async e=>{await (0,r.R)("/api/plugin",{method:"PUT",body:JSON.stringify(e)})},l=async e=>{await (0,r.R)("/api/plugin",{method:"DELETE",body:JSON.stringify(e)})};var s=a(59734),o=a(67294);let d=()=>{let{data:e,error:t,mutate:a}=(0,s.ZP)("/api/plugin",r._),i=(null==e?void 0:e.plugins)||[],n=(0,o.useCallback)(e=>{let t=[...i,e];a({plugins:t})},[i,a]),l=(0,o.useCallback)(e=>{let t=i.filter(t=>t.key!==e.key);a({plugins:t})},[i,a]),d=(0,o.useCallback)(e=>{let t=i.map(t=>(t.key===e.key&&(t={...t,...e}),t));a({plugins:t})},[i,a]);return[i,{mutatePlugins:a,addOnePlugin:n,delOnePlugin:l,mutateOnePlugin:d,errorPlugins:t,loadingPlugins:!e}]};var c={add:i,update:n,del:l,usePlugins:d}},10843:function(e,t,a){"use strict";a.d(t,{Z:function(){return l}});var r=a(11425);let i=async()=>{let e=await (0,r.R)("/api/plugins",{method:"GET",headers:{Accept:"application/json"}});return e.json()},n=async()=>{let e=await (0,r.R)("/api/plugins",{method:"POST",headers:{Accept:"application/json"}});return e.json()};var l={list:i,completeList:n}},26791:function(e,t,a){"use strict";a.d(t,{Z:function(){return g}});var r=a(59734),i=a(67294),n=a(11425);let l=e=>{let{data:t,error:a,mutate:l}=(0,r.ZP)(["/api/projects",JSON.stringify({ids:e})],e=>{let[t,a]=e;return(0,n._)(t,a)}),s=(null==t?void 0:t.projects)||[],o=(0,i.useCallback)(e=>{let t=[...s,{...e,users:[],geometries:[],simulations:[],groups:[]}];l({projects:t})},[s,l]),d=(0,i.useCallback)(e=>{let t=s.filter(t=>t.id!==e.id);l({projects:t})},[s,l]),c=(0,i.useCallback)(e=>{let t=s.map(t=>(t.id===e.id&&(t={...t,...e}),t));l({projects:t})},[s,l]);return[s,{addOneProject:o,delOneProject:d,mutateOneProject:c,errorProjects:a,loadingProjects:!t}]},s=e=>{let{data:t,error:a,mutate:l}=(0,r.ZP)("/api/project"+(e?"/"+e:""),n._),s=(null==t?void 0:t.project)||{id:"0"},o=(0,i.useCallback)(e=>{let t={...s,...e};l({project:t})},[s,l]);return[s,{mutateProject:o,errorProject:a,loadingProject:!t}]},o=async(e,t)=>{let a=await (0,n.R)("/api/project",{method:"POST",headers:{Accept:"application/json"},body:JSON.stringify({workspace:{id:e.id},project:t})});return a.json()},d=async(e,t)=>{await (0,n.R)("/api/project/"+e.id,{method:"PUT",body:JSON.stringify(t)})},c=async(e,t)=>{await (0,n.R)("/api/project/"+t.id,{method:"DELETE",body:JSON.stringify({id:e.id})})},u=async e=>(0,n.R)("/api/project/"+e.id+"/archive",{method:"GET",headers:{Accept:"application/json"}}),p=async e=>(0,n.R)("/api/project/"+e.id+"/archive",{method:"PUT"}),h=async e=>(0,n.R)("/api/project/"+e.id+"/archive",{method:"DELETE"}),m=async(e,t)=>(0,n.R)("/api/project/"+e.id+"/archive",{method:"POST",body:JSON.stringify({archive:t})});var g={useProjects:l,useProject:s,add:o,update:d,del:c,archive:u,unarchiveFromServer:p,deleteArchiveFile:h,unarchiveFromFile:m}},92288:function(e,t,a){"use strict";a.d(t,{Z:function(){return o}});var r=a(59734),i=a(67294),n=a(11425);let l=()=>{let{data:e,error:t,mutate:a}=(0,r.ZP)("/api/system",n._),l=(null==e?void 0:e.system)||{},s=(0,i.useCallback)(e=>{a({system:{...l,...e}})},[l,a]);return[l,{mutateSystem:s,errorSystem:t,loadingSystem:!e}]},s=async e=>{await (0,n.R)("/api/system",{method:"PUT",body:JSON.stringify(e)})};var o={useSystem:l,update:s}},18436:function(e,t,a){"use strict";a.d(t,{HS:function(){return c},Lw:function(){return x},m1:function(){return f},o6:function(){return b},w6:function(){return h},ks:function(){return C},Qj:function(){return z}});var r=a(14288),i=a(83062),n=a(71577),l=a(64789),s=a(70917),o=a(86159);let d=e=>{let{disabled:t,primary:a=!0,light:d,dark:c,fullWidth:u,needMargin:p,loading:h,children:m,onAdd:g}=e;return(0,r.tZ)(i.Z,{title:m||"Add",children:(0,r.tZ)(n.ZP,{css:(0,s.iv)([u?o.KP.fullWidth:{},p?o.Ml.marginLeft(5):{},d?o.KP.textLight:{},c?o.KP.textDark:{}]),disabled:t,loading:h,type:a?"primary":"default",icon:(0,r.tZ)(l.Z,{}),onClick:g,children:m})})};var c=d,u=a(86548);let p=e=>{let t,{disabled:a,primary:l=!1,bordered:d,light:c,dark:p,needMargin:h,loading:m,children:g,onEdit:Z}=e;return t=a?"link":l?"primary":"default",(0,r.tZ)(i.Z,{title:g||"Edit",children:(0,r.tZ)(n.ZP,{css:(0,s.iv)(["primary"==t?"":o.KP.noBackground,h?o.Ml.marginLeft(5):{},c?o.KP.textLight:{},p?o.KP.textDark:{},d?{}:o.KP.noBorder]),disabled:a,loading:m,type:t,icon:(0,r.tZ)(u.Z,{}),onClick:Z,children:g})})};var h=p,m=a(67294),g=a(48689),Z=a(28345);let y=e=>{let{disabled:t,loading:a,bordered:l,text:d,title:c,children:u,onDelete:p}=e,[h,y]=(0,m.useState)(!1),f=(0,m.useCallback)(()=>y(!0),[]),v=(0,m.useCallback)(()=>y(!1),[]),w=(0,m.useCallback)(async()=>{await p(),y(!1)},[p]);return(0,r.BX)(r.HY,{children:[(0,r.tZ)(Z.AN,{visible:h,loading:a,title:c||"Delete",onCancel:v,onOk:w,children:d||"Are you sure?"}),(0,r.tZ)(i.Z,{title:u||"Delete",children:(0,r.tZ)(n.ZP,{css:(0,s.iv)([o.KP.noBackground,l?{}:o.KP.noBorder]),danger:!0,disabled:t,type:t?"link":void 0,loading:a,icon:(0,r.tZ)(g.Z,{}),onClick:f,children:u})})]})};var f=y,v=a(23430);let w=e=>{let{disabled:t,loading:a,bordered:l,children:d,onDownload:c}=e;return(0,r.tZ)(i.Z,{title:d||"Download",children:(0,r.tZ)(n.ZP,{css:(0,s.iv)([o.KP.noBackground,l?{}:o.KP.noBorder]),disabled:t,loading:a,icon:(0,r.tZ)(v.Z,{}),onClick:c,children:d})})};var b=w,k=a(82826);let O=e=>{let{children:t,buttonCss:a,onClick:i}=e;return(0,r.tZ)(n.ZP,{css:(0,s.iv)([o.KP.noBorder,a]),icon:(0,r.tZ)(k.Z,{css:(0,s.iv)({color:o.Rl.colorPrimary})}),onClick:i,children:t||"Go back"})};var C=O;let P=e=>{let{disabled:t,loading:a,children:l,onCancel:s}=e;return(0,r.tZ)(i.Z,{title:l||"Cancel",children:(0,r.tZ)(n.ZP,{disabled:t,loading:a,type:"default",onClick:s,children:l||"Cancel"})})};var x=P;let S=e=>{let{children:t,onClick:a}=e;return(0,r.tZ)(n.ZP,{type:"link",onClick:a,style:{padding:0},children:t})};var z=S},47455:function(e,t,a){"use strict";a.d(t,{o:function(){return f}});var r=a(14288),i=a(96108),n=a(69677),l=a(37404),s=a(92288);let o={password:"Please enter a password",passwordTooSmall:e=>"Your password is too small (minimum "+e+" characters)",passwordTooLong:e=>"Your password is too long (maximum "+e+" characters)",passwordRequireLetter:"Your password must contain a letter",passwordRequireNumber:"Your password must contain a number",passwordRequireSymbol:"Your password must contain a symbol"},d=(e,t)=>!(t.length<e),c=(e,t)=>!(t.length>e),u=(e,t)=>-1!==e.search(t),p=(e,t)=>{var a,r;return(null!==(r=null==e?void 0:null===(a=e.password)||void 0===a?void 0:a.requireLetter)&&void 0!==r?!r:!l.JT)||u(t,/[a-zA-Z]/)},h=(e,t)=>{var a,r;return(null!==(r=null==e?void 0:null===(a=e.password)||void 0===a?void 0:a.requireNumber)&&void 0!==r?!r:!l.tE)||u(t,/\d/)},m=(e,t)=>{var a,r;return(null!==(r=null==e?void 0:null===(a=e.password)||void 0===a?void 0:a.requireSymbol)&&void 0!==r?!r:!l.ah)||u(t,/[!@#$%^&*(){}[\]<>?/|.:;_-]/)},g=(e,t,a,r)=>{d(e,a)||r.push(o.passwordTooSmall(e)),c(t,a)||r.push(o.passwordTooLong(t))},Z=(e,t,a)=>{p(e,t)||a.push(o.passwordRequireLetter),h(e,t)||a.push(o.passwordRequireNumber),m(e,t)||a.push(o.passwordRequireSymbol)},y=e=>{var t,a,d,c;let{labelCol:u,wrapperCol:p,name:h,label:m,inputPlaceholder:y,inputAutoComplete:f,edit:v,style:w,required:b}=e,[k]=s.Z.useSystem(),O=null!==(d=null==k?void 0:null===(t=k.password)||void 0===t?void 0:t.min)&&void 0!==d?d:l.yL,C=null!==(c=null==k?void 0:null===(a=k.password)||void 0===a?void 0:a.max)&&void 0!==c?c:l.nq;return(0,r.tZ)(i.Z.Item,{labelCol:u,wrapperCol:p,name:h||"password",label:m||"Password",rules:[()=>({validator(e,t){let a=[];return v&&"******"===t?Promise.resolve():t?(g(O,C,t,a),Z(k,t,a),a.length)?Promise.reject(a):Promise.resolve():Promise.reject(o.password)}}),{required:!!b,message:""}],style:w,children:(0,r.tZ)(n.Z.Password,{placeholder:y,autoComplete:f})})};var f=y},12935:function(e,t,a){"use strict";a.d(t,{Z:function(){return s}});var r=a(67294);let i=(e,t)=>{if(!e||!t)return!1;let a=e.length,r=t.length;return a===r&&e.every((e,a)=>{let r=t[a];return null===e&&null===r||void 0===e&&void 0===r||(Array.isArray(e)?i(e,r):"object"==typeof e?n(e,r):e===r)})},n=(e,t)=>!!e&&!!t&&JSON.stringify(e)===JSON.stringify(t),l=(e,t,a)=>{let n=(0,r.useRef)();(0,r.useEffect)(()=>{if(!n.current||!n.current.length||!i(n.current,t))return n.current=[...null!=t?t:[!0]],e()},[...t||[],...a||[],e])};var s=l},64376:function(e,t,a){"use strict";var r=a(14288),i=a(83062),n=a(53575),l=a(98293),s=a(57953),o=a(13023),d=a(48764).lW;let c=e=>JSON.parse(JSON.stringify(e)),u=e=>{if(!e)return"#FFFFFF";let t=Array.from(e).reduce((e,t)=>t.charCodeAt(0)+((e<<5)-e),0);return"hsl("+t%360+", 100%, 25%)"},p=e=>{if(!e)return"#"+Math.floor(16777215*Math.random()).toString(16);let t=[],a=255/e;for(let r=0;r<e;r++){let e=Math.floor(r*a%255).toString(16).padStart(2,"0"),i=Math.floor((r+1)*a%255).toString(16).padStart(2,"0"),n=Math.floor((r+2)*a%255).toString(16).padStart(2,"0");t.push("#"+e+i+n)}return t},h=e=>{let t=e.toString(16);return 1===t.length?"0"+t:t},m=e=>"#"+h(Math.floor(255*e.r))+h(Math.floor(255*e.g))+h(Math.floor(255*e.b)),g=e=>{let t=e.avatar&&d.from(e.avatar).toString(),a="",o="";return e.firstname||e.lastname?(a=(e.firstname?e.firstname+" ":"")+(e.lastname||""),o=(e.firstname?e.firstname[0]:"")+(e.lastname?e.lastname[0]:"")):e.email&&(a=e.email,o=e.email[0]),(0,r.tZ)(i.Z,{title:a+(e.pending?" (Invite pending)":""),children:(0,r.tZ)(n.Z,{count:e.pending&&"Pending...",offset:[30,5],style:{backgroundColor:"#ff4d4f",zIndex:10},children:(0,r.tZ)(l.C,{src:t,style:{backgroundColor:u(a)},children:o.toUpperCase()||(0,r.tZ)(s.Z,{})})})},e.id||JSON.stringify(e))},Z=e=>{let t=e.name,a="";return t&&(a=t[0]),(0,r.tZ)(i.Z,{title:t,children:(0,r.tZ)(l.C,{style:{backgroundColor:u(t)},children:a.toUpperCase()||(0,r.tZ)(s.Z,{})})},e.id||JSON.stringify(e))},y=e=>!!(0,o.parseOneAddress)(e);t.Z={deepCopy:c,stringToColor:u,colorGenerator:p,rgbToHex:m,rgbToRgba:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return e?"rgba("+255*e.r+", "+255*e.g+", "+255*e.b+", "+t+")":"rgba(255, 255, 255, 0)"},userToAvatar:g,groupToAvatar:Z,validateEmail:y,getGitVersion:()=>"git-front-5235add"}},44097:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return a8}});var r=a(14288),i=a(11163),n=a(67294),l=a(97183),s=a(68508),o=a(22850),d=a(41156),c=a(42952),u=a(55355),p=a(11186),h=a(86548),m=a(25035),g=a(92443),Z=a(59134),y=a.n(Z),f=a(4147),v=a(12935),w=a(12271),b=a(67641),k=a(96108),O=a(69677),C=a(49502),P=a(32983),x=a(70917),S=a(28345),z=a(20137),j=a(86159);let B={head:(0,x.iv)({display:"flex",justifyContent:"space-between","& div:last-child":{padding:"16px 0"}}),divider:(0,x.iv)({borderColor:j.Rl.colorPrimary,margin:"12px 0"})},T=e=>{let{css:t,title:a,footer:i,extra:n,children:l}=e;return(0,r.BX)("div",{css:t,children:[(a||n)&&(0,r.BX)("div",{css:B.head,children:[(0,r.tZ)("div",{children:a}),(0,r.tZ)("div",{children:n})]}),(0,r.tZ)("div",{children:l}),i||(0,r.tZ)(z.Z,{css:B.divider})]})};var E=a(59734),A=a(11425);let X=()=>{let{data:e,error:t,mutate:a}=(0,E.ZP)("/api/workspace",A._),r=(null==e?void 0:e.workspaces)||[],i=(0,n.useCallback)(e=>{let t=[...r,e];a({workspaces:t})},[r,a]),l=(0,n.useCallback)(e=>{let t=r.filter(t=>t.id!==e.id);a({workspaces:t})},[r,a]),s=(0,n.useCallback)(e=>{let t=r.map(t=>(t.id===e.id&&(t={...t,...e}),t));a({workspaces:t})},[r,a]);return[r,{addOneWorkspace:i,delOneWorkspace:l,mutateOneWorkspace:s,errorWorkspaces:t,loadingWorkspaces:!e}]},R=async e=>{let t=await (0,A.R)("/api/workspace",{method:"POST",headers:{Accept:"application/json"},body:JSON.stringify(e)});return t.json()},I=async(e,t)=>{await (0,A.R)("/api/workspace",{method:"PUT",body:JSON.stringify({workspace:e,data:t})})},U=async e=>{await (0,A.R)("/api/workspace",{method:"DELETE",body:JSON.stringify(e)})};var N={useWorkspaces:X,add:R,update:I,del:U},D=a(18436);let H={add:"Unable to add workspace"},q=async(e,t)=>{try{let a=await N.add(e);t.addOneWorkspace(a)}catch(e){throw(0,w.lt)(H.add,e),e}},L=e=>{let{swr:t}=e,a=(0,n.useRef)(null),[i,l]=(0,n.useState)(!1),[s,o]=(0,n.useState)(!1);(0,n.useEffect)(()=>{a.current&&a.current.focus()});let d=(0,n.useCallback)(()=>o(!0),[]),c=(0,n.useCallback)(()=>o(!1),[]),u=(0,n.useCallback)(async e=>{l(!0);try{await q(e,t),l(!1),o(!1)}catch(e){throw l(!1),e}},[t]);return(0,r.BX)(r.HY,{children:[(0,r.tZ)(D.HS,{onAdd:d,children:"Create a new workspace"}),(0,r.tZ)(S.ZP,{visible:s,loading:i,title:"Create a new workspace",onCancel:c,onOk:u,children:(0,r.tZ)(k.Z.Item,{label:"Name",name:"name",rules:[{required:!0,message:"Name is required"},{max:50,message:"Max 50 characters"}],children:(0,r.tZ)(O.Z,{ref:a,placeholder:"Workspace's name"})})})]})};var W=a(26713),K=a(98293),M=a(68795),Y=a(59847),F=a(83062),G=a(71577),J=a(20046),_=a(64376),V=a(26791);let Q={share:"Unable to share"},$=async(e,t,a,r,i)=>{try{if(e){await N.update({id:e.id},[{key:"groups",value:a},{key:"users",value:r}]);let t=_.Z.deepCopy(e);t.groups=a.map(e=>({id:e})),t.users=r.map(e=>({id:e})),i.mutateOneWorkspace(t)}else{await V.Z.update({id:t.id},[{key:"groups",value:a},{key:"users",value:r}]);let e=_.Z.deepCopy(t);e.groups=a.map(e=>({id:e})),e.users=r.map(e=>({id:e})),i.mutateOneProject(e)}}catch(e){throw(0,w.lt)(Q.share,e),e}},ee=e=>{let t=e.email;return(e.lastname||e.firstname)&&(t=(e.lastname?e.lastname+" ":"")+(e.firstname||"")),t},et=e=>{let{disabled:t,workspace:a,project:l,organizations:s,swr:d,style:c}=e,[u,p]=(0,n.useState)(!1),[h,m]=(0,n.useState)(!1),[g,Z]=(0,n.useState)([]),[f,v]=(0,n.useState)([]),[w,b]=(0,n.useState)([]),[O,C]=(0,n.useState)([]),P=(0,i.useRouter)();(0,n.useEffect)(()=>{let e=a||l,t=null==e?void 0:e.groups.map(e=>e.id),r=null==e?void 0:e.users.map(e=>e.id);b(t||[]),C(r||[])},[a,l]),(0,n.useEffect)(()=>{let e=s.map(e=>{let t=e.groups.map(e=>({key:e.id,title:e.name,value:e.id,type:"group"}));return{key:e.id,title:e.name,value:e.id,disabled:!0,checkable:!1,children:t}}),t=[];s.forEach(e=>{e.owners.forEach(e=>{t.push({key:e.id,title:ee(e),value:e.id,type:"user"})}),e.users.forEach(e=>{t.push({key:e.id,title:ee(e),value:e.id,type:"user"})}),e.groups.forEach(e=>{e.users.forEach(e=>{t.push({key:e.id,title:ee(e),value:e.id,type:"user"})})})});let a=t.filter((e,t,a)=>a.findIndex(t=>t.key===e.key)===t);Z(e),v(a)},[s]);let z=(0,n.useCallback)(()=>{P.push({pathname:"/dashboard",query:{page:"organizations"}})},[P]),B=(0,n.useMemo)(()=>g.length?(0,r.BX)(r.HY,{children:[(0,r.tZ)(k.Z.Item,{label:(0,r.BX)(r.HY,{children:["Share this ",a?"workspace":"project"," with organizations groups"]}),children:(0,r.tZ)(Y.Z,{multiple:!0,treeCheckable:!0,treeDefaultExpandAll:!0,showCheckedStrategy:Y.Z.SHOW_ALL,placeholder:"Select groups",dropdownStyle:{maxHeight:400,overflow:"auto"},css:j.KP.fullWidth,treeData:g,value:w,onChange:b})}),(0,r.tZ)(k.Z.Item,{label:(0,r.BX)(r.HY,{children:["Share this ",a?"workspace":"project"," with organizations users"]}),children:(0,r.tZ)(Y.Z,{multiple:!0,treeCheckable:!0,treeDefaultExpandAll:!0,showCheckedStrategy:Y.Z.SHOW_ALL,placeholder:"Select users",dropdownStyle:{maxHeight:400,overflow:"auto"},css:j.KP.fullWidth,treeData:f,value:O,onChange:C})})]}):(0,r.BX)(r.HY,{children:[(0,r.tZ)("br",{}),(0,r.tZ)(o.Z.Text,{strong:!0,children:"There is no organization for now"}),(0,r.tZ)("br",{}),(0,r.BX)(o.Z.Text,{children:["You can create organizations and groups in the"," ",(0,r.tZ)(D.Qj,{onClick:z,children:"Organization menu"}),"."]})]}),[a,g,f,w,O,z]),T=(0,n.useCallback)(()=>p(!0),[]),E=(0,n.useCallback)(()=>p(!1),[]),A=(0,n.useCallback)(async()=>{m(!0);try{await $(a,l,w,O,d),m(!1),p(!1)}catch(e){throw m(!1),e}},[a,l,w,O,d]);return(0,r.BX)(r.HY,{children:[(0,r.tZ)(F.Z,{title:"Share",children:(0,r.tZ)(G.ZP,{css:(0,x.iv)([j.KP.noBackground,(null==c?void 0:c.buttonLight)?j.KP.textLight:{},(null==c?void 0:c.buttonDark)?j.KP.textDark:{},(null==c?void 0:c.buttonBordered)?"":j.KP.noBorder,y()()?j.KP.displayNone:""]),disabled:t,type:t?"link":void 0,icon:(0,r.tZ)(J.Z,{}),onClick:T},"share")}),(0,r.BX)(S.ZP,{title:"Share "+(a?"workspace":"project"),visible:u,onCancel:E,onOk:A,loading:h,children:[(0,r.BX)(o.Z.Title,{level:5,children:[a?"Workspace: ":"Project: ",(null==a?void 0:a.name)||(null==l?void 0:l.title)]}),B]})]})},ea={add:"Unable to add project"},er=async(e,t,a)=>{try{let r=await V.Z.add({id:e.id},t);return a.addOneProject(r),a.mutateOneWorkspace({...e,projects:[...e.projects,r.id]}),r}catch(e){throw(0,w.lt)(ea.add,e),e}},ei=e=>{let{workspace:t,swr:a}=e,l=(0,n.useRef)(null),[s,o]=(0,n.useState)(!1),[d,c]=(0,n.useState)(!1),u=(0,i.useRouter)();(0,n.useEffect)(()=>{l.current&&l.current.focus()});let p=(0,n.useCallback)(()=>o(!0),[]),h=(0,n.useCallback)(()=>o(!1),[]),m=(0,n.useCallback)(e=>e.stopPropagation(),[]),g=(0,n.useCallback)(async e=>{c(!0);try{let r=await er(t,e,a);c(!1),o(!1),u.push({pathname:"/project",query:{page:"workspaces",workspaceId:t.id,projectId:r.id}})}catch(e){throw c(!1),e}},[u,t,a]);return(0,r.BX)(r.HY,{children:[(0,r.tZ)(D.HS,{primary:!1,dark:!0,onAdd:p,children:"Create a new project"}),(0,r.BX)(S.ZP,{title:"Create a new project",visible:s,onCancel:h,onOk:g,loading:d,children:[(0,r.tZ)(k.Z.Item,{label:"Name",name:"title",rules:[{required:!0,message:"Name is required"},{max:50,message:"Max 50 characters"}],children:(0,r.tZ)(O.Z,{ref:l,placeholder:"Project's name"})}),(0,r.tZ)(k.Z.Item,{label:"Description",name:"description",children:(0,r.tZ)(O.Z.TextArea,{showCount:!0,css:j.Ml.marginBottom(20),maxLength:120,placeholder:"Project's description",onKeyUp:m})})]})]})};var en=a(85813),el=a(51904),es=a(91978);let eo={edit:"Unable to edit project"},ed=async(e,t,a)=>{try{await V.Z.update({id:e.id},[{key:"title",value:t.title},{key:"description",value:t.description}]),a.mutateOneProject(e)}catch(e){throw(0,w.lt)(eo.edit,e),e}},ec=e=>{let{disabled:t,project:a,swr:i}=e,l=(0,n.useRef)(null),[s,o]=(0,n.useState)(!1),[d,c]=(0,n.useState)(!1);(0,n.useEffect)(()=>{l.current&&l.current.focus()});let u=(0,n.useCallback)(()=>o(!0),[]),p=(0,n.useCallback)(()=>o(!1),[]),h=(0,n.useCallback)(async e=>{c(!0);try{await ed(a,e,i),c(!1),o(!1)}catch(e){throw c(!1),e}},[a,i]),m=(0,n.useCallback)(e=>e.stopPropagation(),[]);return(0,r.BX)(r.HY,{children:[(0,r.tZ)(D.w6,{disabled:t,dark:!0,onEdit:u}),(0,r.BX)(S.ZP,{title:'Edit "'+a.title+'" project',visible:s,onCancel:p,onOk:h,loading:d,initialValues:{title:a.title,description:a.description},children:[(0,r.tZ)(k.Z.Item,{label:"Name",name:"title",rules:[{required:!0,message:"Name is required"},{max:50,message:"Max 50 characters"}],children:(0,r.tZ)(O.Z,{ref:l,placeholder:"Project's name"})}),(0,r.tZ)(k.Z.Item,{label:"Description",name:"description",children:(0,r.tZ)(O.Z.TextArea,{css:j.Ml.marginBottom(20),placeholder:"Project's description",showCount:!0,maxLength:120,onKeyUp:m})})]})]})};var eu=a(99138);let ep={del:"Unable to delete project"},eh=async(e,t,a)=>{try{await V.Z.del({id:e.id},{id:t.id});let r=e.projects.findIndex(e=>e===t.id);e.projects=[...e.projects.slice(0,r),...e.projects.slice(r+1)],a.mutateOneWorkspace(e),a.delOneProject({id:t.id})}catch(e){throw(0,w.lt)(ep.del,e),e}},em=e=>{let{disabled:t,workspace:a,project:i,swr:l}=e,[s,d]=(0,n.useState)(!1),c=(0,n.useCallback)(async()=>{d(!0);try{await eh(a,i,l)}finally{d(!1)}},[a,i,l]);return(0,r.tZ)(D.m1,{disabled:t,loading:s,title:"Delete the project",text:(0,r.BX)(r.HY,{children:["Are you sure you want to delete the project"," ",(0,r.tZ)(o.Z.Text,{strong:!0,children:i.title}),"?",(0,r.tZ)(eu.Z,{type:"error",message:"If you delete the project, you will no longer be able to restore the archive",style:{marginTop:"16px"}})]}),onDelete:c})};var eg=a(31365),eZ=a(57546),ey=a(238),ef=a(48764).lW;let ev={archive:"Unable to archive project",unarchiveServer:"Unable to unarchive project on server",deleteArchive:"Unable to delete archive",badFormat:"Bad archive format (supported format: .tanatlocarchive)",upload:"Unable to upload archive"},ew=async(e,t,a)=>{try{let r=await V.Z.archive({id:t.id}),i=await r.blob(),n=window.URL.createObjectURL(new Blob([i])),l=document.createElement("a");l.href=n,l.setAttribute("download",t.id+".tanatlocarchive"),l.click(),a.mutateOneProject({...t,archived:!0}),a.mutateOneWorkspace(e)}catch(e){throw(0,w.lt)(ev.archive,e),e}},eb=async(e,t,a)=>{try{await V.Z.unarchiveFromServer({id:t.id}),a.mutateOneProject({...t,archived:!1}),a.mutateOneWorkspace(e)}catch(e){throw(0,w.lt)(ev.unarchiveServer,e),e}},ek=async e=>{try{await V.Z.deleteArchiveFile({id:e.id})}catch(e){(0,w.lt)(ev.deleteArchive,e)}},eO=async e=>{let t=new FileReader;return new Promise(a=>{t.addEventListener("load",()=>{a(t.result)}),t.readAsArrayBuffer(e)})},eC=async(e,t,a,r)=>{if("uploading"===a.file.status)return!0;if("done"===a.file.status)try{let i=await eO(a.file.originFileObj);await V.Z.unarchiveFromFile({id:t.id},ef.from(i)),r.mutateOneProject({...t,archived:!1}),r.mutateOneWorkspace(e)}catch(e){(0,w.lt)(ev.upload,e)}return!1},eP=e=>{let{disabled:t,workspace:a,project:i,swr:l}=e,[s,d]=(0,n.useState)(!1),[c,u]=(0,n.useState)(!1),p=(0,n.useCallback)(()=>d(!0),[]),h=(0,n.useCallback)(()=>d(!1),[]),m=(0,n.useCallback)(async()=>{u(!0);try{await ew(a,i,l),u(!1),d(!1)}catch(e){throw u(!1),e}},[a,i,l]),g=(0,n.useCallback)(async()=>{u(!0);try{await eb(a,i,l),u(!1),d(!1)}catch(e){u(!1)}},[a,i,l]),Z=(0,n.useCallback)(async e=>{let t=await eC(a,i,e,l);u(t),d(t)},[a,i,l]),y=(0,n.useCallback)(async()=>ek(i),[i]);return(0,r.BX)(r.HY,{children:[(0,r.tZ)(S.ZP,{visible:s,loading:c,title:"Archive",onCancel:h,onOk:i.archived?void 0:m,okButtonText:"Archive",children:i.archived?(0,r.BX)(r.HY,{children:[(0,r.tZ)(k.Z.Item,{label:"Restore archive from the server",tooltip:"This will restore the project from the server archive file.",children:(0,r.tZ)(G.ZP,{loading:c,onClick:g,children:"Restore archive from the server"})}),(0,r.tZ)(k.Z.Item,{label:"Restore archive from local file",tooltip:"This will restore the project from your local archive file (.tanatlocarchive file).",children:(0,r.tZ)(eg.Z,{action:"/api/noop",accept:".tanatlocarchive",showUploadList:!1,onChange:Z,children:(0,r.tZ)(G.ZP,{children:"Restore archive from archive file"})})}),(0,r.tZ)(k.Z.Item,{label:"Delete archive from the server",tooltip:"This will delete the archive file from the server, you will have to use a local copy to restore the project.",children:(0,r.tZ)(D.m1,{loading:c,bordered:!0,title:"Delete server archive",text:"Are you sure your want to delete the archive from the server?",onDelete:y,children:"Delete server archive"})})]}):(0,r.BX)(o.Z.Text,{children:["An archive will be downloaded and the project will not be editable anymore, archive the project \xab",i.title,"\xbb?"]})}),(0,r.tZ)(F.Z,{title:i.archived?"Manage archive":"Archive",children:(0,r.tZ)(G.ZP,{disabled:t,type:"link",icon:i.archived?(0,r.tZ)(eZ.Z,{}):(0,r.tZ)(ey.Z,{}),onClick:p})})]})},ex={card:(0,x.iv)({display:"flex",flexDirection:"column",width:"260px",height:"412px","& .ant-card-head":{height:"80px",padding:"0 24px",display:"flex",alignItems:"center"},"& .ant-card-head-title":{whiteSpace:"unset !important"},"& .ant-card-cover":{flex:"1 0 auto",display:"flex",alignItems:"center"},"& .ant-card-body":{height:"70px",borderTop:"1px solid #f0f0f0",padding:"0 24px"},"& .ant-card-actions":{"> li":{margin:"8px 0",flex:"0 1 auto"}}}),cardArchived:(0,x.iv)({backgroundColor:"#fafafa"}),carousel:(0,x.iv)({margin:"auto !important",textAlign:"center","& img":{margin:"auto !important"},"& .dots":{bottom:"10px !important",left:"unset !important",right:"calc(50% - 30px) !important",padding:"1px",paddingLeft:"unset !important",margin:"unset !important",backgroundColor:"rgba(217, 217, 217, 0.5)",borderRadius:"5px !important",li:{height:"10px !important",button:{height:"10px !important",borderRadius:"5px !important",background:j.Rl.colorPrimary+" !important"}}}}),carouselSnapshot:(0,x.iv)({width:"260px",height:"190px",display:"flex",justifyContent:"center",alignItems:"center",padding:"5px",cursor:"pointer",img:{maxWidth:"98%",maxHeight:"98%"}}),carouselSnapshotArchived:(0,x.iv)({cursor:"not-allowed"}),carouselDescription:(0,x.iv)({width:"260px",height:"190px",padding:"5px 10px",cursor:"pointer","& .ant-typography":{marginBottom:0}}),carouselDescriptionArchived:(0,x.iv)({cursor:"not-allowed"}),empty:(0,x.iv)({marginTop:"min(10%, 20px)","& .ant-empty-description":{fontSize:"1.25em",color:j.Rl.textColorLight}}),emptySearch:(0,x.iv)({fontStyle:"italic",color:j.Rl.textColorLight})};var eS=a(48764).lW;let ez=e=>{var t,a,l,s;let{user:d,workspace:c,page:u,project:p,organizations:h,swr:m}=e,g=(0,i.useRouter)(),Z=(0,n.useCallback)(()=>{p.archived||g.push({pathname:"/project",query:{page:u,workspaceId:c.id,projectId:p.id}})},[g,c,u,p]),y=(0,n.useMemo)(()=>p.archived?(0,r.tZ)(P.Z,{description:"Archived project"}):p.avatar?(0,r.tZ)("img",{src:eS.from(p.avatar).toString(),alt:"Tanatloc"}):(0,r.tZ)(P.Z,{image:"images/empty.svg",description:"No preview yet."}),[p]),f=(0,n.useMemo)(()=>(0,r.BX)(W.Z,{direction:"vertical",css:(0,x.iv)([j.KP.fullWidth,j.KP.textAlignLeft]),children:[(0,r.BX)(o.Z.Text,{children:[(0,r.tZ)("b",{children:"Created:"})," ",new Date(p.createddate).toLocaleDateString()]}),(0,r.BX)(o.Z.Text,{children:[(0,r.tZ)("b",{children:"Last modified:"})," ",new Date(p.lastaccess).toLocaleDateString()]}),p.description&&(0,r.tZ)(o.Z.Paragraph,{ellipsis:{rows:4,tooltip:!0},children:p.description})]}),[p]),v=(0,n.useMemo)(()=>{var e;return null===(e=p.owners)||void 0===e?void 0:e.map(e=>_.Z.userToAvatar(e))},[p]),w=(0,n.useMemo)(()=>{var e;return null===(e=p.users)||void 0===e?void 0:e.map(e=>_.Z.userToAvatar(e))},[p]),b=(0,n.useMemo)(()=>{var e;return null==p?void 0:null===(e=p.groups)||void 0===e?void 0:e.map(e=>_.Z.groupToAvatar(e))},[p]);return(0,r.tZ)(en.Z,{title:(0,r.BX)(r.HY,{children:[(0,r.tZ)(o.Z.Paragraph,{ellipsis:{rows:2,tooltip:!0},children:p.title}),p.archived&&(0,r.tZ)(el.Z,{children:"Archived"})]}),css:(0,x.iv)([ex.card,p.archived?ex.cardArchived:{}]),cover:(0,r.BX)(es.Z,{css:ex.carousel,dots:{className:"dots"},children:[(0,r.tZ)("div",{css:(0,x.iv)([ex.carouselSnapshot,p.archived?ex.carouselSnapshotArchived:{}]),onClick:Z,children:y}),(0,r.tZ)("div",{css:(0,x.iv)([ex.carouselDescription,p.archived?ex.carouselDescriptionArchived:{}]),onClick:Z,children:f})]}),actions:[(0,r.tZ)(em,{disabled:!(null==p?void 0:null===(t=p.owners)||void 0===t?void 0:t.find(e=>e.id===(null==d?void 0:d.id))),workspace:{id:c.id,projects:c.projects},project:{id:p.id,title:p.title},swr:{mutateOneWorkspace:m.mutateOneWorkspace,delOneProject:m.delOneProject}},"delete"),(0,r.tZ)(eP,{disabled:!(null==p?void 0:null===(a=p.owners)||void 0===a?void 0:a.find(e=>e.id===(null==d?void 0:d.id))),workspace:{id:c.id},project:{archived:p.archived,id:p.id,title:p.title},swr:{mutateOneWorkspace:m.mutateOneWorkspace,mutateOneProject:m.mutateOneProject}},"archive"),(0,r.tZ)(et,{disabled:!(null==p?void 0:null===(l=p.owners)||void 0===l?void 0:l.find(e=>e.id===(null==d?void 0:d.id))),project:{id:p.id,title:p.title,groups:p.groups,users:p.users},organizations:h,swr:{mutateOneProject:m.mutateOneProject},style:{buttonDark:!0}},"share"),(0,r.tZ)(ec,{disabled:!(null==p?void 0:null===(s=p.owners)||void 0===s?void 0:s.find(e=>e.id===(null==d?void 0:d.id))),project:{id:p.id,title:p.title,description:p.description},swr:{mutateOneProject:m.mutateOneProject}},"edit")],children:(0,r.BX)("div",{style:{padding:"6px 0",display:"grid",gridTemplateColumns:"10fr 1fr 20fr",gridTemplateRows:"auto auto"},children:[(0,r.tZ)("div",{children:"Admin:"}),(0,r.tZ)("div",{}),(0,r.tZ)("div",{children:"Shared with:"}),(0,r.tZ)(K.C.Group,{maxCount:5,children:v}),(0,r.tZ)(z.Z,{type:"vertical",style:{height:"80%",borderColor:"#f0f0f0"}}),(0,r.BX)(K.C.Group,{children:[w,b]})]})},p.id)},ej=e=>{let{user:t,page:a,workspace:i,projects:l,organizations:s,filter:o,sorter:d,swr:c}=e,u=(0,n.useRef)(null),[p,h]=(0,n.useState)(!0),[m,g]=(0,n.useState)([]),[Z,y]=(0,n.useState)(100);return((0,n.useEffect)(()=>{let e=u.current;if(!e)return;let t=e.getBoundingClientRect(),a=t.top,r=window.innerHeight,i=r-a;i!==Z&&y(i)}),(0,n.useEffect)(()=>{let e=l.map(e=>{var t,a;if(!o||(null===(t=null===(a=e.title)||void 0===a?void 0:a.toLowerCase())||void 0===t?void 0:t.includes(o.toLowerCase())))return e}).filter(e=>e);switch(d){case"alphaAsc":e.sort((e,t)=>e.title.localeCompare(t.title));break;case"alphaDesc":e.sort((e,t)=>-1*e.title.localeCompare(t.title));break;case"modifiedDesc":e.sort((e,t)=>new Date(t.lastaccess).getTime()-new Date(e.lastaccess).getTime())}g(e),h(!1)},[l,o,d]),p||c.loadingProjects)?(0,r.tZ)(b.Z.Simple,{}):m.length?(0,r.tZ)("div",{ref:u,style:{height:Z},children:(0,r.tZ)(W.Z,{css:j.Ml.marginBottom(20),wrap:!0,align:"start",size:20,children:m.map(e=>(0,r.tZ)(ez,{user:t,workspace:i,page:a,project:e,organizations:s,swr:c},e.id))})}):(0,r.tZ)(P.Z,{image:"images/empty.svg",css:ex.empty,description:o?(0,r.BX)(r.HY,{children:["No project found with the current search"," ",(0,r.tZ)("span",{css:ex.emptySearch,children:o}),"..."]}):(0,r.tZ)(r.HY,{children:"No project for now... Get started!"})})},eB={update:"Unable to update workspace"},eT=async(e,t,a)=>{try{let r=_.Z.deepCopy(e);e.name=t.name,await N.update({id:e.id},[{key:"name",value:t.name}]),a.mutateOneWorkspace(r)}catch(e){throw(0,w.lt)(eB.update,e),e}},eE=e=>{let{workspace:t,swr:a}=e,i=(0,n.useRef)(null),[l,s]=(0,n.useState)(!1),[o,d]=(0,n.useState)(!1);(0,n.useEffect)(()=>{i.current&&i.current.focus()});let c=(0,n.useCallback)(()=>s(!0),[]),u=(0,n.useCallback)(()=>s(!1),[]),p=(0,n.useCallback)(async e=>{d(!0);try{await eT(t,e,a),d(!1),s(!1)}catch(e){throw d(!1),e}},[t,a]);return(0,r.BX)(r.HY,{children:[(0,r.tZ)(D.w6,{bordered:!0,dark:!0,onEdit:c}),(0,r.tZ)(S.ZP,{visible:l,loading:o,title:"Edit the workspace",initialValues:{name:t.name},onCancel:u,onOk:p,children:(0,r.tZ)(k.Z.Item,{label:"Name",name:"name",rules:[{required:!0,message:"Name is required"},{max:50,message:"Max 50 characters"}],children:(0,r.tZ)(O.Z,{ref:i,placeholder:"Workspace's name"})})})]})},eA={del:"Unable to delete workspace"},eX=async(e,t)=>{try{await N.del({id:e.id}),t.delOneWorkspace({id:e.id})}catch(e){throw(0,w.lt)(eA.del,e),e}},eR=e=>{let{workspace:t,swr:a}=e,[i,l]=(0,n.useState)(!1),s=(0,n.useCallback)(async()=>{l(!0);try{await eX(t,a)}finally{l(!1)}},[t,a]);return(0,r.tZ)(D.m1,{bordered:!0,loading:i,text:"The projects contained in this workspace will be lost.",onDelete:s})},eI={shared:(0,x.iv)({display:"flex",gap:"20px",marginBottom:"16px","& > div":{display:"flex",alignItems:"center"}}),tabs:(0,x.iv)({margin:"16px 0",color:j.Rl.textColorLight,"& .ant-tabs-nav::before":{borderBottom:"none"}})},eU={projects:"Error while loading projects",update:"Unable to update workspace"},eN=e=>{var t,a,i,s,o,d;let{user:c,page:u,workspace:p,organizations:h,swr:m}=e,[g,Z]=(0,n.useState)(),[y,f]=(0,n.useState)(),[v,{addOneProject:b,delOneProject:k,mutateOneProject:P,errorProjects:S,loadingProjects:z}]=V.Z.useProjects(null==p?void 0:p.projects);(0,n.useEffect)(()=>{S&&(0,w.lt)(eU.projects,S)},[S]);let B=(0,n.useCallback)(e=>Z(e.target.value),[]);return(0,r.BX)(l.Z,{css:j.KP.noScroll,children:[(0,r.tZ)(T,{footer:(0,r.BX)(W.Z,{direction:"horizontal",size:"large",css:(0,x.iv)([j.KP.fullWidth,{"& > *:last-child":{marginLeft:"auto !important"}}]),children:[(0,r.tZ)(O.Z,{placeholder:"Enter a project name (case sensitive)",value:g,onChange:B,style:{width:500},suffix:(0,r.tZ)(M.Z,{css:j.KP.textLight})}),(null==p?void 0:null===(t=p.owners)||void 0===t?void 0:t.find(e=>e.id===c.id))?(0,r.BX)(r.HY,{children:[(0,r.tZ)(ei,{workspace:{id:p.id,projects:p.projects},swr:{mutateOneWorkspace:m.mutateOneWorkspace,addOneProject:b}}),(0,r.BX)(W.Z,{size:8,children:[(0,r.tZ)(eE,{workspace:{id:p.id,name:p.name},swr:{mutateOneWorkspace:m.mutateOneWorkspace}}),(0,r.tZ)(et,{workspace:{id:p.id,name:p.name,groups:p.groups,users:p.users},organizations:h,swr:{mutateOneWorkspace:m.mutateOneWorkspace},style:{buttonDark:!0,buttonBordered:!0}}),(0,r.tZ)(eR,{workspace:{id:p.id},swr:{delOneWorkspace:m.delOneWorkspace}})]})]}):(0,r.tZ)("div",{})]}),children:(null===(a=p.users)||void 0===a?void 0:a.length)||(null===(i=p.groups)||void 0===i?void 0:i.length)?(0,r.BX)("div",{css:eI.shared,children:[(0,r.BX)("div",{children:[(0,r.tZ)("span",{css:j.Ml.marginRight(10),children:"Admin:"}),(0,r.tZ)(K.C.Group,{maxCount:5,children:null===(s=p.owners)||void 0===s?void 0:s.map(e=>_.Z.userToAvatar(e))})]}),(0,r.BX)("div",{children:[(0,r.tZ)("span",{css:j.Ml.marginRight(10),children:"Shared with:"}),(0,r.tZ)(K.C.Group,{maxCount:5,children:null===(o=p.users)||void 0===o?void 0:o.map(e=>_.Z.userToAvatar(e))}),(0,r.tZ)(K.C.Group,{maxCount:5,children:null===(d=p.groups)||void 0===d?void 0:d.map(e=>_.Z.groupToAvatar(e))})]})]}):void 0}),(0,r.tZ)(C.Z,{css:eI.tabs,items:[{key:"modifiedDesc",label:"Last modified"},{key:"alphaAsc",label:"Name (A-Z)"},{key:"alphaDesc",label:"Name (Z-A)"}],defaultActiveKey:"modifiedDesc",onChange:f}),(0,r.tZ)(l.Z.Content,{css:j.KP.scroll,children:(0,r.tZ)(ej,{user:c,page:u,workspace:{id:p.id,projects:p.projects},projects:v,organizations:h,filter:g,sorter:y,swr:{mutateOneWorkspace:m.mutateOneWorkspace,delOneProject:k,mutateOneProject:P,loadingProjects:z}})})]})},eD={dashboard:(0,x.iv)({width:"100%",height:"100%",overflow:"hidden"}),sider:(0,x.iv)({"& > div":{position:"relative"}}),menu:(0,x.iv)({overflowX:"hidden",borderRight:"0px !important","& .display-none":{display:"none !important"},"& .ant-menu-item-divider":{border:"1px solid "+j.Rl.colorPrimary+" !important"},"& .version":{position:"absolute !important",bottom:0,left:"5px",cursor:"default",lineHeight:"1em"}}),inDashboard:(0,x.iv)({padding:"0 64px",height:"100vh"}),inDashboardTabs:(0,x.iv)({color:j.Rl.textColorLight})},eH={add:"Unable to add workspace"},eq=async(e,t,a)=>{try{let r=await N.add(t);a.addOneWorkspace(r),e.push({pathname:"/dashboard",query:{page:"workspaces",workspaceId:r.id}})}catch(e){throw(0,w.lt)(eH.add,e),e}},eL=e=>{let{user:t,workspaces:a,organizations:s,swr:d}=e,c=(0,n.useRef)(null),[u,p]=(0,n.useState)(!1),[h,m]=(0,n.useState)(!1),g=(0,i.useRouter)(),{page:Z,workspaceId:y}=g.query;(0,n.useEffect)(()=>{c.current&&c.current.focus()});let f=(0,n.useCallback)(()=>{p(!0)},[]),v=(0,n.useCallback)(()=>{p(!1)},[]),w=(0,n.useCallback)(e=>{g.push({pathname:"/dashboard",query:{page:"workspaces",workspaceId:e}})},[g]),b=(0,n.useCallback)(async e=>{m(!0);try{await eq(g,e,d),m(!1),p(!1)}catch(e){throw m(!1),e}},[g,d]);return(0,r.BX)(l.Z,{css:(0,x.iv)([eD.inDashboard,j.KP.noScroll]),children:[(0,r.tZ)(T,{title:(0,r.tZ)(o.Z.Title,{level:2,css:(0,x.iv)({marginBottom:"0 !important"}),children:"Workspaces"})}),(0,r.tZ)(l.Z.Content,{css:j.KP.noScroll,children:a.length?(0,r.BX)(r.HY,{children:[(0,r.tZ)(S.ZP,{visible:u,loading:h,title:"Create a new workspace",onCancel:v,onOk:b,children:(0,r.tZ)(k.Z.Item,{label:"Name",name:"name",rules:[{required:!0,message:"Name is required"},{max:50,message:"Max 50 characters"}],children:(0,r.tZ)(O.Z,{ref:c,placeholder:"Workspace's name"})})}),(0,r.tZ)(C.Z,{type:"editable-card",css:(0,x.iv)([j.KP.noScroll,eD.inDashboardTabs]),items:a.map(e=>({key:e.id,label:e.name,css:j.KP.noScroll,closable:!1,children:(0,r.tZ)(eN,{user:t,page:Z||a4.workspaces.key,workspace:{id:e.id,name:e.name,projects:e.projects,owners:e.owners,users:e.users,groups:e.groups},organizations:s,swr:{delOneWorkspace:d.delOneWorkspace,mutateOneWorkspace:d.mutateOneWorkspace}})})),defaultActiveKey:"1",activeKey:y,onChange:w,onEdit:f})]}):(0,r.tZ)(r.HY,{children:(0,r.tZ)(P.Z,{image:"images/empty.svg",description:"No workspace for now. Get started !",children:(0,r.tZ)(L,{swr:{addOneWorkspace:d.addOneWorkspace}})})})})]})};var eW=a(87547),eK=a(88484),eM=a(4415),eY=a(55734),eF=a(5094);let eG={information:(0,x.iv)({display:"flex","& > div:first-of-type":{display:"flex",justifyContent:"center",width:"300px","> div":{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",width:"100%","> span:first-of-type":{marginBottom:"10px"}}},"& > div:last-of-type":{flex:"1 1 auto"}})};var eJ=a(48764).lW;let e_={update:"Unable to update informations",upload:"Unable to upload image",badFormat:"Supported formats: jpg, png",badSize:"Image must be smaller than 5MB"},eV=e=>{let t="image/jpeg"===e.type||"image/png"===e.type;t||(0,w.lt)(e_.badFormat);let a=e.size/1024/1024<1;return a||(0,w.lt)(e_.badSize),t&&a},eQ=async e=>{let t=new FileReader;return new Promise(a=>{t.addEventListener("load",()=>{a(t.result)}),t.readAsDataURL(e)})},e$=async(e,t,a)=>{if("uploading"===t.file.status)return!0;if("done"!==t.file.status)return!1;try{let r=await eQ(t.file.originFileObj);await eF.Z.add({name:t.file.name,uid:t.file.uid,data:r}),a.mutateUser({...e,avatar:eJ.from(r)})}catch(e){(0,w.lt)(e_.upload,e)}return!1},e0=async(e,t,a)=>{try{let r=[];if(e.email!==t.email&&r.push({key:"email",value:t.email}),e.firstname!==t.firstname&&r.push({key:"firstname",value:t.firstname}),e.lastname!==t.lastname&&r.push({key:"lastname",value:t.lastname}),!r.length)return;await eY.Z.update(r),a.mutateUser({email:t.email,firstname:t.firstname,lastname:t.lastname}),r.find(e=>"email"===e.key)&&(0,w.Ur)("Changes saved","A validation email has been send to "+t.email)}catch(e){throw new eM.H({title:e_.update,err:e})}},e1=e=>{let{user:t,swr:a}=e,[i,l]=(0,n.useState)(!1),[s,o]=(0,n.useState)(!1),[d,c]=(0,n.useState)(),u=(0,n.useCallback)(async e=>{let r=await e$(t,e,a);l(r)},[t,a]),p=(0,n.useCallback)(async e=>{o(!0);try{await e0(t,e,a),c(null)}catch(e){c(e)}finally{o(!1)}},[t,a]);return(0,r.tZ)(en.Z,{title:"Contact Details",children:(0,r.BX)(W.Z,{direction:"horizontal",css:eG.information,children:[(0,r.BX)("div",{children:[(0,r.tZ)(K.C,{size:128,src:t.avatar&&eJ.from(t.avatar).toString(),icon:(0,r.tZ)(eW.Z,{})}),(0,r.tZ)(eg.Z,{action:"/api/noop",accept:".jpg,.png",showUploadList:!1,beforeUpload:eV,onChange:u,children:(0,r.tZ)(G.ZP,{loading:i,icon:(0,r.tZ)(eK.Z,{}),children:"Upload new"})})]}),(0,r.tZ)("div",{children:(0,r.BX)(k.Z,{labelCol:{span:4},css:j.Ml.maxWidth(500),initialValues:{email:t.email,firstname:t.firstname||"",lastname:t.lastname||""},onFinish:p,children:[(0,r.tZ)(k.Z.Item,{label:"Email",name:"email",rules:[{max:50,message:"Max 50 characters"}],children:(0,r.tZ)(O.Z,{disabled:y()()})}),(0,r.tZ)(k.Z.Item,{label:"First name",name:"firstname",rules:[{max:50,message:"Max 50 characters"}],children:(0,r.tZ)(O.Z,{})}),(0,r.tZ)(k.Z.Item,{label:"Last name",name:"lastname",rules:[{max:50,message:"Max 50 characters"}],children:(0,r.tZ)(O.Z,{})}),(0,r.tZ)(w.Xq,{error:d}),(0,r.tZ)(k.Z.Item,{wrapperCol:{offset:4},children:(0,r.tZ)(G.ZP,{loading:s,type:"primary",htmlType:"submit",children:"Save changes"})})]})})]})})};var e5=a(47455);let e2={check:"Unable to check password",update:"Unable to update password",passwordMismatch:"Password and confirmation mismatch",invalid:"Current password is not valid"},e4=async(e,t)=>{let a;try{a=await eY.Z.check({email:e.email,password:t.password})}catch(e){throw new eM.H({title:e2.check,err:e})}if(!a.valid)throw new eM.H({title:e2.invalid});try{await eY.Z.update([{type:"crypt",key:"password",value:t.newPassword}]),(0,w.Ur)("Your password has been changed successfully")}catch(e){throw new eM.H({title:e2.update,err:e})}},e7=e=>{let{user:t}=e,[a,i]=(0,n.useState)(!1),[l,s]=(0,n.useState)(),o=(0,n.useCallback)(async e=>{i(!0);try{await e4(t,e),s(null)}catch(e){s(e)}finally{i(!1)}},[t]);return(0,r.tZ)(en.Z,{title:"Your Password",children:(0,r.BX)(k.Z,{labelCol:{offset:2},wrapperCol:{offset:2},css:j.Ml.maxWidth(500),layout:"vertical",onFinish:o,name:"passwordForm",children:[(0,r.tZ)(k.Z.Item,{label:"Current password",name:"password",rules:[{required:!0,message:"Current password is required"}],children:(0,r.tZ)(O.Z.Password,{placeholder:"Current password"})}),(0,r.tZ)(e5.o,{name:"newPassword",label:"New password",inputPlaceholder:"Enter a new password",required:!0}),(0,r.tZ)(k.Z.Item,{label:"Password confirmation",name:"passwordConfirm",rules:[{required:!0,message:"Password confirmation is required"},e=>{let{getFieldValue:t}=e;return{validator:(e,a)=>a&&t("newPassword")!==a?Promise.reject(e2.passwordMismatch):Promise.resolve()}}],children:(0,r.tZ)(O.Z.Password,{placeholder:"Confirm your new password"})}),(0,r.tZ)(w.Xq,{error:l}),(0,r.tZ)(k.Z.Item,{children:(0,r.tZ)(W.Z,{children:(0,r.tZ)(G.ZP,{type:"primary",htmlType:"submit",loading:a,children:"Modify password"})})})]})})},e6=y()()?"http://localhost:3000":"",e8=async()=>{await fetch(e6+"/api/logout")},e3={del:"Unable to delete user"},e9=async e=>{try{await eY.Z.del(),await e8(),e.clearUser()}catch(e){throw(0,w.lt)(e3.del,e),e}},te=e=>{let{swr:t}=e,[a,i]=(0,n.useState)(!1),l=(0,n.useCallback)(async()=>{i(!0);try{await e9(t)}finally{i(!1)}},[t]);return(0,r.tZ)(en.Z,{title:"Delete your account",children:(0,r.tZ)(D.m1,{title:"Delete your account",text:"This action cannot be undone. If you delete your account, you will permanently lose your workspaces and projects.",bordered:!0,loading:a,onDelete:l,children:"Delete your account"})})};var tt=a(57953),ta=a(10843),tr=a(71270),ti=a(34041),tn=a(25935);let tl={update:"Unable to update plugins"},ts=(e,t,a)=>(0,r.tZ)(k.Z.Item,{name:t,label:e.label,htmlFor:"input-"+t,tooltip:e.tooltip,rules:e.rules,children:(0,r.tZ)(O.Z,{ref:a,id:"input-"+t,autoComplete:"off",...e.props||{}})},t),to=(e,t)=>(0,r.tZ)(k.Z.Item,{name:t,label:e.label,htmlFor:"input-"+t,tooltip:e.tooltip,rules:e.rules,children:(0,r.tZ)(O.Z.TextArea,{id:"input-"+t,autoComplete:"off",...e.props||{}})},t),td=(e,t)=>(0,r.tZ)(k.Z.Item,{name:t,label:e.label,htmlFor:"input-"+t,tooltip:e.tooltip,rules:e.rules,children:(0,r.tZ)(O.Z,{id:"input-"+t,type:"password",autoComplete:"off",...e.props||{}})},t),tc=(e,t)=>(0,r.tZ)(k.Z.Item,{name:t,label:e.label,htmlFor:"select-"+t,tooltip:e.tooltip,rules:e.rules,children:(0,r.tZ)(ti.Z,{id:"select-"+t,children:e.options.map(t=>(0,r.tZ)(ti.Z.Option,{value:t,...e.props||{},children:t},t))})},t),tu=async(e,t,a,r)=>{try{var i,n;if(t){let t=_.Z.deepCopy(e);Object.keys(a).forEach(e=>{t.configuration[e].value=a[e]}),t.needReInit=!0,await tr.Z.update(t),null===(i=r.mutateOnePlugin)||void 0===i||i.call(r,t)}else{let t=_.Z.deepCopy(e);t.uuid="add",Object.keys(a).forEach(e=>{t.configuration[e].value=a[e]}),await tr.Z.add(t),null===(n=r.addOnePlugin)||void 0===n||n.call(r,t)}}catch(e){throw(0,w.lt)(tl.update,e),e}},tp=e=>{let{plugin:t,swr:a,edit:i}=e,l=(0,n.useRef)(null),[s,d]=(0,n.useState)(!1),[c,u]=(0,n.useState)(!1),[p,h]=(0,n.useState)({});(0,n.useEffect)(()=>{let e={};Object.keys(t.configuration).forEach(a=>{var r;e[a]=null!==(r=t.configuration[a].value)&&void 0!==r?r:t.configuration[a].default}),h(e)},[null==t?void 0:t.configuration]),(0,n.useEffect)(()=>{l.current&&l.current.focus()});let m=(0,n.useCallback)(()=>{d(!0)},[]),g=(0,n.useCallback)(()=>{d(!1)},[]),Z=(0,n.useCallback)(async e=>{u(!0);try{await tu(t,!!i,e,a),u(!1),d(!1)}catch(e){throw u(!1),e}},[t,a,i]),y=(0,n.useMemo)(()=>Object.keys(t.configuration).map((e,a)=>{let i=t.configuration[e];return"input"===i.type?ts(i,e,0===a?l:void 0):"textarea"===i.type?to(i,e):"password"===i.type?td(i,e):"select"===i.type?tc(i,e):(0,r.tZ)("div",{},e)}),[t.configuration]);return(0,r.BX)(r.HY,{children:[(0,r.tZ)(S.ZP,{title:t.name,visible:s,initialValues:p,onCancel:g,onOk:Z,loading:c,children:(0,r.BX)(r.HY,{children:[(0,r.tZ)(o.Z.Text,{children:(0,tn.ZP)(t.description||"")}),y]})}),i?(0,r.tZ)(D.w6,{onEdit:m,children:"Edit"}):(0,r.BX)(D.HS,{onAdd:m,children:["Add a new \xab",t.name,"\xbb configuration"]})]})},th={del:"Unable to delete plugin"},tm=async(e,t)=>{try{await tr.Z.del({uuid:e.uuid}),t.delOnePlugin(e)}catch(e){throw(0,w.lt)(th.del,e),e}},tg=e=>{var t;let{plugin:a,swr:i}=e,[l,s]=(0,n.useState)(!1),d=(0,n.useCallback)(async()=>{s(!0);try{await tm(a,i)}finally{s(!1)}},[a,i]);return(0,r.tZ)(D.m1,{loading:l,title:"Delete plugin",text:(0,r.BX)(r.HY,{children:["Are you sure you want to delete the plugin"," ",(0,r.tZ)(o.Z.Text,{strong:!0,children:null===(t=a.configuration.name)||void 0===t?void 0:t.value}),"?"]}),onDelete:d,children:"Delete"})};var tZ=a(33160);let ty={refresh:"Unable to refresh plugin"},tf=async e=>{try{let t=_.Z.deepCopy(e);t.needReInit=!0,await tr.Z.update(t)}catch(e){(0,w.lt)(ty.refresh,e)}},tv=e=>{let{plugin:t}=e,a=(0,n.useCallback)(async()=>{await tf(t)},[t]);return(0,r.tZ)(G.ZP,{icon:(0,r.tZ)(tZ.Z,{}),onClick:a,css:(0,x.iv)([j.KP.noBackground,j.KP.noBorder]),children:"Refresh"},"refresh")},tw=e=>{let{plugin:t,plugins:a,swr:i}=e,[l,s]=(0,n.useState)([]);return(0,n.useEffect)(()=>{let e=a.map(e=>{var a;if(e.key!==t.key)return;let n=e.configuration,l=Object.keys(n).map(e=>{let t;if("name"!==e){if("textarea"===n[e].type){let a=n[e].value;t=(0,r.tZ)(o.Z.Paragraph,{children:(0,r.tZ)("pre",{children:(0,r.tZ)("code",{children:a})})})}else t="password"===n[e].type?(0,r.tZ)(o.Z.Text,{children:"******"}):(0,r.tZ)(o.Z.Text,{children:n[e].value||"unset"});return(0,r.BX)(o.Z.Paragraph,{children:[(0,r.BX)(o.Z.Text,{strong:!0,children:[n[e].label,":"]})," ",t]},e)}}).filter(e=>e),s=[];return s.push((0,r.tZ)(tg,{plugin:{uuid:e.uuid,configuration:e.configuration},swr:{delOnePlugin:i.delOnePlugin}},"delete")),e.haveInit&&s.push((0,r.tZ)(tv,{plugin:e})),s.push((0,r.tZ)(tp,{plugin:e,swr:{mutateOnePlugin:i.mutateOnePlugin},edit:!0},"plugin")),(0,r.tZ)(en.Z,{title:null===(a=n.name)||void 0===a?void 0:a.value,actions:s,children:(0,r.BX)(r.HY,{children:[(0,r.tZ)(o.Z.Text,{children:(0,tn.ZP)(e.description||"")}),l.length?l:(0,r.tZ)(o.Z.Text,{children:"No configuration data"})]})},e.uuid)}).filter(e=>e);s(e)},[t,a,i]),(0,r.tZ)(W.Z,{direction:"horizontal",wrap:!0,size:20,children:l})},tb={plugins:"Error while loading plugins"},tk=e=>{let{plugin:t}=e,[a,{addOnePlugin:i,delOnePlugin:l,mutateOnePlugin:s,errorPlugins:o,loadingPlugins:d}]=tr.Z.usePlugins();return((0,n.useEffect)(()=>{o&&(0,w.lt)(tb.plugins,o)},[o]),d)?(0,r.tZ)(tt.Z,{}):(0,r.BX)(W.Z,{direction:"vertical",css:j.KP.fullWidth,children:[(0,r.tZ)(tp,{plugin:{uuid:t.uuid,key:t.key,name:t.name,description:t.description,haveInit:t.haveInit,configuration:t.configuration,inUseConfiguration:t.inUseConfiguration},swr:{addOnePlugin:i}}),(0,r.tZ)(tw,{plugin:{key:t.key},plugins:a,swr:{delOnePlugin:l,mutateOnePlugin:s}})]})},tO={plugins:"Unable to load plugins"},tC=async()=>{try{let e=await ta.Z.list(),t=e.filter(e=>"HPC"===e.category);if(t.length)return t.map(e=>(0,r.tZ)(en.Z,{title:e.name,children:(0,r.tZ)(tk,{plugin:{key:e.key,name:e.name,description:e.description,haveInit:e.haveInit,configuration:e.configuration,inUseConfiguration:e.inUseConfiguration}})},e.key));return[(0,r.tZ)(en.Z,{title:"No access",children:"You do not have access to any HPC plugin. Request it."},"no-access")]}catch(e){return(0,w.lt)(tO.plugins,e),[(0,r.tZ)(en.Z,{title:"Error",children:"Something led to an error. Please try again later."},"error")]}},tP=()=>{let[e,t]=(0,n.useState)([(0,r.tZ)(en.Z,{title:"Loading",children:(0,r.tZ)(tt.Z,{})},"loading")]);return(0,n.useEffect)(()=>{tC().then(t)},[]),(0,r.tZ)(W.Z,{direction:"vertical",css:(0,x.iv)([j.KP.fullWidth,j.KP.scroll]),size:20,children:e})},tx=e=>{let{user:t,swr:a}=e,s=(0,i.useRouter)(),{tab:d}=s.query,c=(0,n.useMemo)(()=>[{key:"personal",label:"Personal Information",children:(0,r.BX)(W.Z,{direction:"vertical",css:j.KP.fullWidth,size:20,children:[(0,r.tZ)(e1,{user:{email:t.email,firstname:t.firstname,lastname:t.lastname,avatar:t.avatar},swr:{mutateUser:a.mutateUser}}),!y()()&&(0,r.tZ)(te,{swr:{clearUser:a.clearUser}})]})},y()()?null:{key:"security",label:"Security",children:(0,r.tZ)(W.Z,{direction:"vertical",css:j.KP.fullWidth,size:20,children:(0,r.tZ)(e7,{user:{email:t.email}})})},{key:"hpc",label:"HPC Providers",children:(0,r.tZ)(tP,{})}].filter(e=>e),[t,a]),u=(0,n.useCallback)(e=>{s.replace({pathname:"/dashboard",query:{page:"account",tab:e}})},[s]);return(0,r.BX)(l.Z,{css:(0,x.iv)([j.KP.noScroll,eD.inDashboard]),children:[(0,r.tZ)(T,{title:(0,r.tZ)(o.Z.Title,{level:2,css:(0,x.iv)({marginBottom:"0 !important"}),children:"Account Settings"})}),(0,r.tZ)(l.Z.Content,{css:j.KP.noScroll,children:(0,r.tZ)(C.Z,{css:(0,x.iv)([j.KP.noScroll,eD.inDashboardTabs]),type:"card",items:c,defaultActiveKey:d||"personal",onChange:u})})]})};var tS=a(82826);let tz=()=>{let{data:e,error:t,mutate:a}=(0,E.ZP)("/api/organizations",A._),r=(null==e?void 0:e.organizations)||[],i=(0,n.useCallback)(e=>{let t=[...r,{...e,pendingowners:[],users:[],pendingusers:[],groups:[]}];a({organizations:t})},[r,a]),l=(0,n.useCallback)(e=>{let t=r.filter(t=>t.id!==e.id);a({organizations:t})},[r,a]),s=(0,n.useCallback)(e=>{let t=r.map(t=>(t.id===e.id&&(t={...t,...e}),t));a({organizations:t})},[r,a]);return[r,{addOneOrganization:i,delOneOrganization:l,mutateOneOrganization:s,errorOrganizations:t,loadingOrganizations:!e}]},tj=async e=>{let t=await (0,A.R)("/api/organization",{method:"POST",headers:{Accept:"application/json"},body:JSON.stringify(e)});return t.json()},tB=async(e,t)=>{await (0,A.R)("/api/organization",{method:"PUT",body:JSON.stringify({organization:e,data:t})})},tT=async e=>{await (0,A.R)("/api/organization",{method:"DELETE",body:JSON.stringify(e)})},tE=async e=>{await (0,A.R)("/api/organization/"+e.id,{method:"PUT"})},tA=async e=>{await (0,A.R)("/api/organization/"+e.id,{method:"POST"})},tX=async e=>{await (0,A.R)("/api/organization/"+e.id,{method:"DELETE"})};var tR={useOrganizations:tz,add:tj,update:tB,del:tT,accept:tE,decline:tA,quit:tX},tI=a(17521);let tU={add:"Unable to add user",existing:"This user already exists or its invite is pending"},tN=(e,t)=>{var a,r,i,n;let l=null===(a=t.owners)||void 0===a?void 0:a.find(t=>t.email===e.email),s=null===(r=t.pendingowners)||void 0===r?void 0:r.find(t=>t.email===e.email),o=null===(i=t.users)||void 0===i?void 0:i.find(t=>t.email===e.email),d=null===(n=t.pendingusers)||void 0===n?void 0:n.find(t=>t.email===e.email);return l||s||o||d},tD=async(e,t,a,r)=>{let i=tN(a,e);if(i)throw(0,w.lt)(tU.existing),Error(tU.existing);try{await tR.update(e,[{key:t,type:"array",method:"append",value:a.email.trim()}]);let i=_.Z.deepCopy(e);i[t]=[...i[t],{email:a.email}],r.mutateOneOrganization(i)}catch(e){throw(0,w.lt)(tU.add,e),e}},tH=e=>{let{title:t,organization:a,dBkey:i,swr:l}=e,s=(0,n.useRef)(null),[o,d]=(0,n.useState)(!1),[c,u]=(0,n.useState)(!1);(0,n.useEffect)(()=>{s.current&&s.current.focus()});let p=(0,n.useCallback)(()=>d(!0),[]),h=(0,n.useCallback)(()=>d(!1),[]),m=(0,n.useCallback)(async e=>{u(!0);try{await tD(a,i,e,l),u(!1),d(!1)}catch(e){throw u(!1),e}},[a,i,l]);return(0,r.BX)(r.HY,{children:[(0,r.tZ)(S.ZP,{visible:o,loading:c,title:t,onCancel:h,onOk:m,children:(0,r.tZ)(k.Z.Item,{name:"email",label:"Email",rules:[{required:!0,message:"Email is required"}],children:(0,r.tZ)(O.Z,{ref:s})})}),(0,r.tZ)(D.HS,{onAdd:p,children:t})]})},tq={del:"Unable to delete user"},tL=async(e,t,a,r)=>{try{await tR.update(t,[{key:a,type:"array",method:"remove",value:e.id}]);let i=_.Z.deepCopy(t);i[a]=i[a].filter(t=>t.id!==e.id),r.mutateOneOrganization(i)}catch(e){throw(0,w.lt)(tq.del,e),e}},tW=e=>{let{disabled:t,user:a,organization:i,dBkey:l,swr:s}=e,[d,c]=(0,n.useState)(!1),u=(0,n.useCallback)(e=>e.firstname||e.lastname?e.firstname+" "+e.lastname:e.email,[]),p=(0,n.useCallback)(async()=>{c(!0);try{await tL(a,i,l,s)}finally{c(!1)}},[a,i,l,s]);return(0,r.tZ)(D.m1,{bordered:!0,disabled:t,title:"Delete organization",text:(0,r.BX)(r.HY,{children:["Are you sure you want to delete the user"," ",(0,r.tZ)(o.Z.Text,{strong:!0,children:u(a)}),"?"]}),loading:d,onDelete:p})},tK=e=>{var t,a,i;let{organization:l,swr:s}=e,[o,d]=(0,n.useState)(),[c,u]=(0,n.useState)(),p=(0,n.useRef)(null),h=(0,n.useRef)(null),m=(0,n.useRef)(null),g=(0,n.useCallback)((e,t)=>_.Z.userToAvatar(t),[]),Z=(0,n.useCallback)(e=>(0,r.tZ)(tW,{disabled:l.owners.length<2&&!e.pending,user:{id:e.id,email:e.email},organization:{id:l.id,owners:l.owners,pendingowners:l.pendingowners,users:l.users,pendingusers:l.pendingusers},dBkey:e.pending?"pendingowners":"owners",swr:{mutateOneOrganization:s.mutateOneOrganization}}),[l,s]),y=(0,n.useCallback)(e=>(0,r.tZ)(tW,{user:{id:e.id,email:e.email,firstname:e.firstname,lastname:e.lastname},organization:{id:l.id,owners:l.owners,pendingowners:l.pendingowners,users:l.users,pendingusers:l.pendingusers},dBkey:e.pending?"pendingusers":"users",swr:{mutateOneOrganization:s.mutateOneOrganization}}),[l,s]),f=(0,n.useMemo)(()=>[{key:"avatar",dataIndex:"avatar",render:g},{key:"lastname",title:"Lastname",dataIndex:"lastname"},{key:"firstname",title:"Firstname",dataIndex:"firstname"},{key:"email",title:"Email",dataIndex:"email"}],[g]),v=(0,n.useMemo)(()=>[...f,{key:"actions",title:"Actions",align:"center",fixed:"right",width:75,render:Z}],[f,Z]),w=(0,n.useMemo)(()=>[...f,{key:"actions",title:"Actions",align:"center",fixed:"right",width:75,render:y}],[f,y]),b=(0,n.useCallback)(()=>{let e=p.current;if(!e)return;let t=e.clientHeight-15,a=t/2-39-12-32-20-75,r=e.clientHeight,i=e.clientHeight;r>a?d({y:a}):d(void 0),i>a?u({y:a}):u(void 0)},[]);return(0,n.useEffect)(()=>(window.addEventListener("resize",b),()=>{window.removeEventListener("resize",b)}),[b]),(0,n.useEffect)(()=>{b()},[l,b]),(0,r.tZ)("div",{ref:p,style:{height:"calc(100vh - 228px)"},children:(0,r.BX)(W.Z,{direction:"vertical",css:j.KP.fullWidth,size:20,children:[(0,r.tZ)(en.Z,{title:"Administrators",size:"small",children:(0,r.BX)(W.Z,{direction:"vertical",css:j.KP.fullWidth,size:20,children:[(0,r.tZ)(tH,{title:"New administrator",organization:{id:l.id,owners:l.owners,pendingowners:l.pendingowners,pendingusers:l.pendingusers,users:l.users},dBkey:"owners",swr:{mutateOneOrganization:s.mutateOneOrganization}}),(0,r.tZ)(tI.Z,{loading:s.loadingOrganizations,pagination:!1,size:"small",columns:v,dataSource:[...l.owners.map(e=>({...e,key:e.id})),...null===(t=l.pendingowners)||void 0===t?void 0:t.map(e=>({...e,pending:!0,key:e.id}))],scroll:{y:null==o?void 0:o.y},ref:h})]})}),(0,r.tZ)(en.Z,{title:"Users",size:"small",children:(0,r.BX)(W.Z,{direction:"vertical",css:j.KP.fullWidth,size:20,children:[(0,r.tZ)(tH,{title:"New user",organization:{id:l.id,owners:l.owners,pendingowners:l.pendingowners,pendingusers:l.pendingusers,users:l.users},dBkey:"users",swr:{mutateOneOrganization:s.mutateOneOrganization}}),(0,r.tZ)(tI.Z,{loading:null==s?void 0:s.loadingOrganizations,pagination:!1,size:"small",columns:w,dataSource:[...null===(a=l.users)||void 0===a?void 0:a.map(e=>({...e,key:e.id})),...null===(i=l.pendingusers)||void 0===i?void 0:i.map(e=>({...e,pending:!0,key:e.id}))],scroll:{y:null==c?void 0:c.y},ref:m})]})})]})})},tM=e=>{let{data:t,error:a,mutate:r}=(0,E.ZP)("/api/groups/"+e,A._),i=(null==t?void 0:t.groups)||[],l=(0,n.useCallback)(e=>{let t=[...i,e];r({groups:t})},[i,r]),s=(0,n.useCallback)(e=>{let t=i.filter(t=>t.id!==e.id);r({groups:t})},[i,r]),o=(0,n.useCallback)(e=>{let t=i.map(t=>(t.id===e.id&&(t={...t,...e}),t));r({groups:t})},[i,r]);return[i,{addOneGroup:l,delOneGroup:s,mutateOneGroup:o,errorGroups:a,loadingGroups:!t}]},tY=async(e,t)=>{let a=await (0,A.R)("/api/group",{method:"POST",body:JSON.stringify({organization:e,group:t})});return a.json()},tF=async(e,t)=>{await (0,A.R)("/api/group",{method:"PUT",body:JSON.stringify({group:e,data:t})})},tG=async e=>{await (0,A.R)("/api/group",{method:"DELETE",body:JSON.stringify(e)})};var tJ={useGroups:tM,add:tY,update:tF,del:tG};let t_={del:"Unable to delete group"},tV=async(e,t)=>{try{await tJ.del({id:e.id}),t.delOneGroup({id:e.id})}catch(e){throw(0,w.lt)(t_.del,e),e}},tQ=e=>{let{group:t,swr:a}=e,[i,l]=(0,n.useState)(!1),s=(0,n.useCallback)(async()=>{l(!0);try{await tV(t,a)}finally{l(!1)}},[t,a]);return(0,r.tZ)(D.m1,{bordered:!0,title:"Delete group",text:(0,r.BX)(r.HY,{children:["Are you sure you want to delete the group"," ",(0,r.tZ)(o.Z.Text,{strong:!0,children:t.name}),"?"]}),loading:i,onDelete:s})},t$={add:"Unable to add group",update:"Unable to update group"},t0=async(e,t,a)=>{try{let r=await tJ.add({id:e.id},{name:t.name,users:t.users});a.addOneGroup({...r,name:t.name,users:t.users}),a.mutateOneOrganization({id:e.id,groups:[...e.groups,r]})}catch(e){throw(0,w.lt)(t$.add,e),e}},t1=async(e,t,a,r)=>{try{var i,n,l,s;let o=[];if(t.name!==a.name&&o.push({key:"name",value:a.name}),(null===(i=t.users)||void 0===i?void 0:i.map(e=>e.id).toString())!==a.users.toString()&&o.push({key:"users",value:a.users}),!o.length)return;await tJ.update({id:t.id},o),r.mutateOneGroup({...t,...a});let d=null===(n=e.groups)||void 0===n?void 0:n.findIndex(e=>e.id===t.id);r.mutateOneOrganization({id:e.id,groups:[...null===(l=e.groups)||void 0===l?void 0:l.slice(0,d),t,...null===(s=e.groups)||void 0===s?void 0:s.slice(d+1)]})}catch(e){throw(0,w.lt)(t$.update,e),e}},t5=e=>{var t;let{userOptions:a,organization:i,group:l,swr:s}=e,o=(0,n.useRef)(null),[d,c]=(0,n.useState)(!1),[u,p]=(0,n.useState)(!1);(0,n.useEffect)(()=>{o.current&&o.current.focus()});let h=(0,n.useCallback)(()=>c(!0),[]),m=(0,n.useCallback)(()=>c(!1),[]),g=(0,n.useCallback)(async e=>{p(!0);try{l?await t1(i,l,e,{mutateOneOrganization:s.mutateOneOrganization,mutateOneGroup:s.mutateOneGroup}):await t0(i,e,{mutateOneOrganization:s.mutateOneOrganization,addOneGroup:s.addOneGroup}),p(!1),c(!1)}catch(e){throw p(!1),e}},[i,l,s]);return(0,r.BX)(r.HY,{children:[(0,r.BX)(S.ZP,{title:l?"Edit group":"New group",visible:d,initialValues:l&&{name:l.name,users:null===(t=l.users)||void 0===t?void 0:t.map(e=>e.id)},onCancel:m,onOk:g,loading:u,children:[(0,r.tZ)(k.Z.Item,{name:"name",label:"Name",rules:[{required:!0,message:"Name is requried"}],children:(0,r.tZ)(O.Z,{ref:o})}),(0,r.tZ)(k.Z.Item,{name:"users",label:"Users",rules:[{required:!0,message:"Users selection is required"}],children:(0,r.tZ)(ti.Z,{mode:"multiple",placeholder:"Select users",options:a})})]}),l?(0,r.tZ)(D.w6,{bordered:!0,onEdit:h,children:"Edit"}):(0,r.tZ)(D.HS,{onAdd:h,children:"New group"})]})},t2={groups:"Error while loading groups"},t4=e=>{let{organization:t,swr:a}=e,[i,l]=(0,n.useState)([]),[s,o]=(0,n.useState)(null),d=(0,n.useRef)(null),[c,{addOneGroup:u,mutateOneGroup:p,delOneGroup:h,errorGroups:m,loadingGroups:g}]=tJ.useGroups(t.id);(0,n.useEffect)(()=>{let e=t.owners,a=null==t?void 0:t.users,r=[...e,...a],i=r.map(e=>({label:e.firstname||e.lastname?e.firstname+" "+e.lastname:e.email,value:e.id}));l(i)},[t]),(0,n.useEffect)(()=>{m&&(0,w.lt)(t2.groups,m)},[m]);let Z=(0,n.useCallback)(e=>(0,r.tZ)(K.C.Group,{maxCount:5,children:e.map(e=>_.Z.userToAvatar(e))}),[]),y=(0,n.useCallback)((e,n)=>(0,r.BX)(W.Z,{children:[(0,r.tZ)(t5,{userOptions:i,organization:{id:t.id,groups:t.groups},group:{id:n.id,name:n.name,users:n.users},swr:{mutateOneOrganization:a.mutateOneOrganization,mutateOneGroup:p}}),(0,r.tZ)(tQ,{group:{id:n.id,name:n.name},swr:{delOneGroup:h}})]}),[t,a,i,p,h]),f=(0,n.useMemo)(()=>[{title:"Group name",dataIndex:"name",key:"name"},{title:"Users",dataIndex:"users",key:"users",render:Z},{title:"Actions",key:"actions",render:y}],[Z,y]),v=(0,n.useCallback)(()=>{let e=d.current;e&&(e.clientHeight>window.innerHeight-e.offsetTop-59?o({y:window.innerHeight-e.offsetTop-59}):o(null))},[]);return(0,n.useEffect)(()=>(window.addEventListener("resize",v),()=>{window.removeEventListener("resize",v)}),[v]),(0,n.useEffect)(()=>{v()},[c,v]),(0,r.BX)(W.Z,{direction:"vertical",css:j.KP.fullWidth,size:20,children:[(0,r.tZ)(t5,{userOptions:i,organization:{id:t.id,groups:t.groups},swr:{mutateOneOrganization:a.mutateOneOrganization,addOneGroup:u}}),(0,r.tZ)(tI.Z,{loading:g,pagination:!1,size:"small",columns:f,dataSource:c.map(e=>({key:e.id,...e})),scroll:{y:null==s?void 0:s.y},ref:d})]})},t7={name:"Unable to update organization's name"},t6=async(e,t,a)=>{try{await tR.update(e,[{key:"name",value:t}]),a.mutateOneOrganization({...e,name:t})}catch(e){(0,w.lt)(t7.name,e)}},t8=e=>{let{organization:t,swr:a,onClose:i}=e,l=(0,n.useCallback)(async e=>t6(t,e,{mutateOneOrganization:a.mutateOneOrganization}),[t,a]);return(0,r.BX)(r.HY,{children:[(0,r.BX)("div",{css:j.KP.displayFlex,children:[(0,r.tZ)(G.ZP,{css:j.Ml.marginRight(20),icon:(0,r.tZ)(tS.Z,{}),onClick:i}),(0,r.tZ)(o.Z.Title,{level:3,editable:{onChange:l},children:t.name})]}),(0,r.tZ)(C.Z,{items:[{key:"users",label:"Users",children:(0,r.tZ)(tK,{organization:{id:t.id,owners:t.owners,pendingowners:t.pendingowners,users:t.users,pendingusers:t.pendingusers},swr:{mutateOneOrganization:a.mutateOneOrganization,loadingOrganizations:a.loadingOrganizations}})},{key:"groups",label:"Groups",children:(0,r.tZ)(t4,{organization:{id:t.id,owners:t.owners,users:t.users,groups:t.groups},swr:{mutateOneOrganization:a.mutateOneOrganization}})}]})]})},t3={add:"Unable to add organization"},t9=async(e,t)=>{try{let a=await tR.add({name:e.name});a.name=e.name,t.addOneOrganization(a)}catch(e){throw(0,w.lt)(t3.add,e),e}},ae=e=>{let{swr:t}=e,a=(0,n.useRef)(null),[i,l]=(0,n.useState)(!1),[s,o]=(0,n.useState)(!1);(0,n.useEffect)(()=>{a.current&&a.current.focus()});let d=(0,n.useCallback)(()=>l(!0),[]),c=(0,n.useCallback)(()=>l(!1),[]),u=(0,n.useCallback)(async e=>{o(!0);try{await t9(e,t),o(!1),l(!1)}catch(e){throw o(!1),e}},[t]);return(0,r.BX)(r.HY,{children:[(0,r.tZ)(S.ZP,{title:"New organization",visible:i,onCancel:c,onOk:u,loading:s,children:(0,r.tZ)(k.Z.Item,{name:"name",label:"Name",rules:[{required:!0,message:"Name is required"}],children:(0,r.tZ)(O.Z,{ref:a})})}),(0,r.tZ)(D.HS,{onAdd:d,children:"New organization"})]})};var at=a(75768),aa=a(8751),ar=a(18429);let ai={del:"Unable to delete organization"},an=async(e,t)=>{try{await tR.del({id:e.id}),t.delOneOrganization({id:e.id})}catch(e){throw(0,w.lt)(ai.del,e),e}},al=e=>{let{organization:t,swr:a}=e,[i,l]=(0,n.useState)(!1),s=(0,n.useCallback)(async()=>{l(!0);try{await an(t,a)}finally{l(!1)}},[t,a]);return(0,r.tZ)(D.m1,{bordered:!0,title:"Delete organization",text:(0,r.BX)(r.HY,{children:["Are you sure you want to delete the organization"," ",(0,r.tZ)(o.Z.Text,{strong:!0,children:t.name}),"?"]}),onDelete:s,loading:i})},as={quit:"Unable to quit organization",accept:"Unable to accept invitation",decline:"Unable to decline invitation"},ao=async(e,t,a)=>{try{await tR.quit({id:e.id});let r=_.Z.deepCopy(e),i=r.users.findIndex(e=>e.id===t.id);r.users.splice(i,1),a.mutateOneOrganization(r)}catch(e){(0,w.lt)(as.quit,e)}},ad=async(e,t,a)=>{try{await tR.accept(e);let r=_.Z.deepCopy(e),i=r.pendingowners.findIndex(e=>e.id===t.id),n=r.pendingowners[i];if(-1!==i)r.pendingowners.splice(i,1),r.owners.push(n);else{let e=r.pendingusers.findIndex(e=>e.id===t.id),a=r.pendingusers[e];r.pendingusers.splice(e,1),r.users.push(a)}a.mutateOneOrganization(r)}catch(e){(0,w.lt)(as.accept,e)}},ac=async(e,t,a)=>{try{var r,i;await tR.decline({id:e.id});let n=_.Z.deepCopy(e),l=null===(r=n.pendingowners)||void 0===r?void 0:r.findIndex(e=>e.id===t.id);if(-1!==l)n.pendingowners.splice(l,1);else{let e=null===(i=n.pendingusers)||void 0===i?void 0:i.findIndex(e=>e.id===t.id);n.pendingusers.splice(e,1)}a.mutateOneOrganization(n)}catch(e){(0,w.lt)(as.decline,e)}},au=e=>{let{organization:t,swr:a,setOrganization:i}=e,l=(0,n.useCallback)(()=>i(t),[t,i]);return(0,r.BX)(r.HY,{children:[(0,r.tZ)(G.ZP,{icon:(0,r.tZ)(p.Z,{}),onClick:l,children:"Manage"}),(0,r.tZ)(al,{organization:{id:t.id,name:t.name},swr:{delOneOrganization:a.delOneOrganization}})]})},ap=e=>{let{user:t,organization:a,swr:i}=e,l=(0,n.useCallback)(()=>ao({id:a.id,users:a.users},{id:t.id},{mutateOneOrganization:i.mutateOneOrganization}),[t,a,i]);return(0,r.tZ)(G.ZP,{danger:!0,icon:(0,r.tZ)(at.Z,{}),onClick:l,children:"Quit"})},ah=e=>{let{user:t,organization:a,swr:i}=e,l=(0,n.useCallback)(async()=>ad({id:a.id,owners:a.owners,pendingowners:a.pendingowners,users:a.users,pendingusers:a.pendingusers},{id:t.id},{mutateOneOrganization:i.mutateOneOrganization}),[t,a,i]);return(0,r.tZ)(G.ZP,{type:"primary",icon:(0,r.tZ)(aa.Z,{}),onClick:l,children:"Accept invitation"})},am=e=>{let{user:t,organization:a,swr:i}=e,l=(0,n.useCallback)(()=>ac({id:a.id,pendingowners:a.pendingowners,pendingusers:a.pendingusers},{id:t.id},{mutateOneOrganization:i.mutateOneOrganization}),[t,a,i]);return(0,r.tZ)(G.ZP,{danger:!0,icon:(0,r.tZ)(ar.Z,{}),onClick:l,children:"Decline"})},ag=e=>{var t;let{user:a,organizations:i,swr:l,setOrganization:s}=e,[o,d]=(0,n.useState)(null),c=(0,n.useRef)(null),u=(0,n.useCallback)(e=>(0,r.tZ)(K.C.Group,{maxCount:5,children:null==e?void 0:e.map(e=>_.Z.userToAvatar(e))}),[]),p=(0,n.useCallback)(e=>(0,r.tZ)(K.C.Group,{maxCount:5,children:null==e?void 0:e.map(e=>_.Z.userToAvatar(e))}),[]),h=(0,n.useCallback)(e=>(0,r.tZ)(K.C.Group,{maxCount:5,children:null==e?void 0:e.map(e=>_.Z.groupToAvatar(e))}),[]),m=(0,n.useCallback)(e=>e.owners.find(e=>e.id===a.id)?(0,r.tZ)(W.Z,{wrap:!0,children:(0,r.tZ)(au,{organization:e,swr:{delOneOrganization:l.delOneOrganization},setOrganization:s})}):e.users.find(e=>e.id===a.id)?(0,r.tZ)(W.Z,{wrap:!0,children:(0,r.tZ)(ap,{user:a,organization:e,swr:{mutateOneOrganization:l.mutateOneOrganization}})}):e.pendingowners.find(e=>e.id===a.id)||e.pendingusers.find(e=>e.id===a.id)?(0,r.BX)(W.Z,{wrap:!0,children:[(0,r.tZ)(ah,{user:a,organization:e,swr:{mutateOneOrganization:l.mutateOneOrganization}}),(0,r.tZ)(am,{user:a,organization:e,swr:{mutateOneOrganization:l.mutateOneOrganization}})]}):void 0,[a,l,s]),g=(0,n.useMemo)(()=>[{title:"Name",dataIndex:"name",key:"name",sorter:(e,t)=>{let a=e.name||"",r=t.name||"";return a.localeCompare(r)}},{title:"Administrators",dataIndex:"owners",key:"owners",render:u},{title:"Users",dataIndex:"users",key:"users",render:p},{title:"Groups",dataIndex:"groups",key:"groups",render:h},{title:"Actions",key:"actions",render:m}],[u,p,h,m]),Z=(0,n.useCallback)(()=>{let e=c.current;e&&(e.clientHeight>window.innerHeight-e.offsetTop-59?d({y:window.innerHeight-e.offsetTop-59}):d(null))},[]);return(0,n.useEffect)(()=>(window.addEventListener("resize",Z),()=>{window.removeEventListener("resize",Z)}),[Z]),(0,n.useEffect)(()=>{Z()},[i,Z,null===(t=c.current)||void 0===t?void 0:t.offsetTop]),(0,r.tZ)(tI.Z,{loading:l.loadingOrganizations,pagination:!1,size:"small",columns:g,dataSource:null==i?void 0:i.map(e=>({key:e.id,id:e.id,name:e.name,owners:e.owners,pendingowners:e.pendingowners,users:e.users,pendingusers:e.pendingusers,groups:e.groups})),ref:c,scroll:{y:null==o?void 0:o.y}})},aZ=e=>{let{user:t,organizations:a,swr:s}=e,[d,c]=(0,n.useState)(),u=(0,i.useRouter)(),{organizationId:p}=u.query;(0,n.useEffect)(()=>{if(p){let e=a.find(e=>e.id===p);c(e)}},[p,a]),(0,n.useEffect)(()=>{if(d){let e=a.find(e=>e.id===d.id);JSON.stringify(e)!==JSON.stringify(d)&&c(e)}},[a,d]);let h=(0,n.useCallback)(()=>{u.push({pathname:"dashboard",query:{page:"organizations"}}),c(null)},[u]),m=(0,n.useCallback)(e=>{u.push({pathname:"dashboard",query:{page:"organizations",organizationId:e.id}}),c(e)},[u]);return(0,r.BX)(l.Z,{css:eD.inDashboard,children:[(0,r.tZ)(T,{title:(0,r.tZ)(o.Z.Title,{level:2,css:(0,x.iv)({marginBottom:"0 !important"}),children:"Organizations"})}),(0,r.tZ)(l.Z.Content,{css:j.KP.noScroll,children:d?(0,r.tZ)(t8,{organization:{id:d.id,name:d.name,owners:d.owners,pendingowners:d.pendingowners,users:d.users,pendingusers:d.pendingusers,groups:d.groups},swr:{mutateOneOrganization:s.mutateOneOrganization,loadingOrganizations:s.loadingOrganizations},onClose:h}):(0,r.BX)(W.Z,{direction:"vertical",css:j.KP.fullWidth,size:20,children:[(0,r.tZ)(ae,{swr:{addOneOrganization:s.addOneOrganization}}),(0,r.tZ)(ag,{user:{id:t.id},organizations:a,swr:{mutateOneOrganization:s.mutateOneOrganization,delOneOrganization:s.delOneOrganization,loadingOrganizations:s.loadingOrganizations},setOrganization:m})]})})]})};var ay=a(53575),af=a(74627),av=a(63606),aw=a(32808),ab=a(92288);let ak={add:"Unable to add user"},aO=async(e,t)=>{try{let a=await eY.Z.add({email:e.email,password:e.password});if(a.alreadyExists)throw Error("User already exists");await eY.Z.updateById(a.id,[{key:"firstname",value:e.firstname},{key:"lastname",value:e.lastname},{key:"authorizedplugins",value:e.authorizedplugins},{key:"superuser",value:!!e.superuser}]);let r={...a,email:e.email,firstname:e.firstname,lastname:e.firstname,superuser:e.superuser};t.addOneUser(r)}catch(e){throw(0,w.lt)(ak.add,e),e}},aC=e=>{let{plugins:t,swr:a}=e,i=(0,n.useRef)(null),[l,s]=(0,n.useState)(!1),[o,d]=(0,n.useState)(!1),[c]=ab.Z.useSystem();(0,n.useEffect)(()=>{i.current&&i.current.focus()});let u=(0,n.useCallback)(()=>s(!0),[]),p=(0,n.useCallback)(()=>s(!0),[]),h=(0,n.useCallback)(async e=>{d(!0);try{await aO(e,a),d(!1),s(!1)}catch(e){throw d(!1),e}},[a]);return(0,r.BX)(r.HY,{children:[(0,r.BX)(S.ZP,{title:"New user",visible:l,initialValues:c.defaultplugins&&{authorizedplugins:c.defaultplugins},onCancel:p,onOk:h,loading:o,children:[(0,r.tZ)(k.Z.Item,{name:"firstname",label:"First name",children:(0,r.tZ)(O.Z,{ref:i})}),(0,r.tZ)(k.Z.Item,{name:"lastname",label:"Last name",children:(0,r.tZ)(O.Z,{})}),(0,r.tZ)(k.Z.Item,{name:"email",label:"Email",rules:[{required:!0,message:"Email is required"}],children:(0,r.tZ)(O.Z,{})}),(0,r.tZ)(e5.o,{name:"password"}),(0,r.tZ)(k.Z.Item,{name:"authorizedplugins",label:"Plugins",children:(0,r.tZ)(ti.Z,{mode:"multiple",options:t.map(e=>({label:e.name,value:e.key}))})}),(0,r.tZ)(k.Z.Item,{name:"superuser",label:"Administrator",valuePropName:"checked",children:(0,r.tZ)(aw.Z,{})})]}),(0,r.tZ)(D.HS,{onAdd:u,children:"New user"})]})},aP={update:"Unable to update user"},ax=async(e,t,a)=>{try{let r=Object.keys(t).map(a=>{let r=t[a];if(void 0!==r&&"******"!==r&&r!==e[a])return{key:a,value:r,type:"password"===a&&"crypt"}}).filter(e=>e);if(!r.length)return;await eY.Z.updateById(e.id,r),t.password="******";let i={...e,...t};a.mutateOneUser(i)}catch(e){throw(0,w.lt)(aP.update,e),e}},aS=e=>{let{plugins:t,user:a,swr:i}=e,l=(0,n.useRef)(null),[s,o]=(0,n.useState)(!1),[d,c]=(0,n.useState)(!1);(0,n.useEffect)(()=>{l.current&&l.current.focus()});let u=(0,n.useCallback)(()=>o(!0),[]),p=(0,n.useCallback)(()=>o(!1),[]),h=(0,n.useCallback)(async e=>{c(!0);try{await ax(a,e,i),c(!1),o(!1)}catch(e){throw c(!1),e}},[a,i]);return(0,r.BX)(r.HY,{children:[(0,r.BX)(S.ZP,{title:"Edit user",visible:s,initialValues:{...a,password:"******",authorizedplugins:a.authorizedplugins},onCancel:p,onOk:h,loading:d,children:[(0,r.tZ)(k.Z.Item,{name:"firstname",label:"First name",children:(0,r.tZ)(O.Z,{ref:l})}),(0,r.tZ)(k.Z.Item,{name:"lastname",label:"Last name",children:(0,r.tZ)(O.Z,{})}),(0,r.tZ)(k.Z.Item,{name:"email",label:"Email",rules:[{required:!0,message:"Email is required"}],children:(0,r.tZ)(O.Z,{})}),(0,r.tZ)(e5.o,{name:"password",edit:!0}),(0,r.tZ)(k.Z.Item,{name:"authorizedplugins",label:"Plugins",children:(0,r.tZ)(ti.Z,{mode:"multiple",options:t.map(e=>({label:e.name,value:e.key}))})}),(0,r.tZ)(k.Z.Item,{name:"superuser",label:"Administrator",valuePropName:"checked",children:(0,r.tZ)(aw.Z,{})})]}),(0,r.tZ)(D.w6,{bordered:!0,onEdit:u,children:"Edit"})]})},az={del:"Unable to delete user"},aj=async(e,t)=>{try{await eY.Z.delById(e.id),t.delOneUser({id:e.id})}catch(e){throw(0,w.lt)(az.del,e),e}},aB=e=>{let{user:t,swr:a}=e,[i,l]=(0,n.useState)(!1),s=(0,n.useCallback)(async()=>{l(!0);try{await aj(t,a)}finally{l(!1)}},[t,a]);return(0,r.tZ)(D.m1,{loading:i,bordered:!0,text:(0,r.BX)(r.HY,{children:["Are you sure you want to delete the user"," ",(0,r.tZ)(o.Z.Text,{strong:!0,children:t.email}),"?"]}),title:"Delete user",onDelete:s})},aT={plugins:"Unable to load plugins"},aE=e=>{let{users:t,swr:a}=e,i=(0,n.useRef)(null),[l,s]=(0,n.useState)(),[o,d]=(0,n.useState)(),c=(0,n.useCallback)(e=>{e.sort();let t=e.map(e=>{let t=null==l?void 0:l.find(t=>t.key===e);if(t)return(0,r.tZ)(ay.Z.Ribbon,{text:t.category,style:{marginTop:"-15px"},children:(0,r.tZ)(en.Z,{size:"small",children:t.name})},e)}),a=(0,r.tZ)(W.Z,{direction:"vertical",children:t});return(0,r.tZ)(af.Z,{content:a,children:(0,r.BX)(G.ZP,{children:[t.length," plugins"]})})},[l]),u=(0,n.useCallback)(e=>e&&(0,r.tZ)(av.Z,{css:j.KP.textGreen}),[]),p=(0,n.useCallback)((e,t)=>(0,r.BX)(W.Z,{children:[(0,r.tZ)(aS,{plugins:(null==l?void 0:l.map(e=>({key:e.key,name:e.name})))||[],user:{id:t.id,firstname:t.firstname,lastname:t.lastname,email:t.email,authorizedplugins:t.authorizedplugins,superuser:t.superuser},swr:{mutateOneUser:a.mutateOneUser}}),(0,r.tZ)(aB,{user:{id:t.id,email:t.email},swr:{delOneUser:a.delOneUser}})]}),[l,a]),h=(0,n.useMemo)(()=>[{title:"First name",dataIndex:"firstname",key:"firstname",sorter:(e,t)=>{let a=e.firstname||"",r=t.firstname||"";return a.localeCompare(r)}},{title:"Last name",dataIndex:"lastname",key:"lastname",sorter:(e,t)=>{let a=e.lastname||"",r=t.lastname||"";return a.localeCompare(r)}},{title:"Email",dataIndex:"email",key:"email",sorter:(e,t)=>{let a=e.email,r=t.email;return a.localeCompare(r)}},{title:"Password",key:"password",render:()=>"******"},{title:"Plugins",dataIndex:"authorizedplugins",key:"authorizedplugins",render:c},{title:"Administrator",dataIndex:"superuser",key:"superuser",align:"center",render:u},{title:"Actions",key:"actions",render:p}],[c,u,p]),m=(0,n.useCallback)(()=>{let e=i.current;e&&(e.clientHeight>window.innerHeight-e.offsetTop-59?d({y:window.innerHeight-e.offsetTop-59}):d(void 0))},[]);return(0,v.Z)(()=>(window.addEventListener("resize",m),()=>{window.removeEventListener("resize",m)}),void 0,[m]),(0,v.Z)(()=>{m()},[t],[m]),(0,n.useEffect)(()=>{ta.Z.completeList().then(e=>{s(e)}).catch(e=>{(0,w.lt)(aT.plugins,e)})},[]),(0,r.BX)(W.Z,{direction:"vertical",css:(0,x.iv)([j.KP.fullWidth,j.KP.fullHeight]),size:20,children:[(0,r.tZ)(aC,{plugins:(null==l?void 0:l.map(e=>({key:e.key,name:e.name})))||[],swr:{addOneUser:a.addOneUser}}),(0,r.tZ)(tI.Z,{loading:!l,pagination:!1,size:"small",columns:h,dataSource:t.map(e=>({...e,key:e.id})),ref:i,scroll:{y:null==o?void 0:o.y}})]})};var aA=a(43262),aX=a(37404);let aR={system:"Error while loading system",update:"Unable to update system"},aI=async(e,t)=>{try{await ab.Z.update([{key:"allowsignup",value:!e.allowsignup}]),t({allowsignup:!e.allowsignup}),(0,w.Ur)("Changes saved")}catch(e){(0,w.lt)(aR.update,e)}},aU=async(e,t)=>{try{await ab.Z.update([{key:"password",value:e}]),t({password:e}),(0,w.Ur)("Changes saved")}catch(e){(0,w.lt)(aR.update,e)}},aN=()=>{let[e]=k.Z.useForm(),[t,{mutateSystem:a,errorSystem:i,loadingSystem:l}]=ab.Z.useSystem();(0,n.useEffect)(()=>{i&&(0,w.lt)(aR.system,i)},[i]),(0,n.useEffect)(()=>{l||e.setFieldsValue((null==t?void 0:t.password)||{min:aX.yL,max:aX.nq,requireLetter:aX.JT,requireNumber:aX.tE,requireSymbol:aX.ah})},[l,e,null==t?void 0:t.password]);let s=(0,n.useCallback)(()=>aI(t,a),[t,a]),o=(0,n.useCallback)(async e=>aU(e,a),[a]);return l?(0,r.tZ)(b.Z.Simple,{}):(0,r.BX)(W.Z,{direction:"vertical",css:j.KP.fullWidth,size:20,children:[(0,r.tZ)(en.Z,{title:"Signup",children:(0,r.tZ)(aw.Z,{checked:null==t?void 0:t.allowsignup,onChange:s,children:"Allow signup"})}),(0,r.tZ)(en.Z,{title:"Password",children:(0,r.tZ)(k.Z,{form:e,name:"form",onFinish:o,css:(0,x.iv)({display:"flex",justifyContent:"space-between"}),children:(0,r.BX)("div",{css:(0,x.iv)([j.KP.displayFlex,j.KP.fullWidth,{justifyContent:"space-between"}]),children:[(0,r.BX)("div",{children:[(0,r.tZ)(k.Z.Item,{label:"Minimum number of characters",name:"min",rules:[{required:!0,message:"Minimum number of characters is required"}],children:(0,r.tZ)(aA.Z,{min:0,max:64})}),(0,r.tZ)(k.Z.Item,{label:"Maximum number of characters",name:"max",rules:[{required:!0,message:"Maximum number of characters is required"}],children:(0,r.tZ)(aA.Z,{min:0,max:64})})]}),(0,r.BX)("div",{children:[(0,r.tZ)(k.Z.Item,{valuePropName:"checked",name:"requireLetter",children:(0,r.tZ)(aw.Z,{children:"Require letter"})}),(0,r.tZ)(k.Z.Item,{valuePropName:"checked",name:"requireNumber",children:(0,r.tZ)(aw.Z,{children:"Require number"})}),(0,r.tZ)(k.Z.Item,{valuePropName:"checked",name:"requireSymbol",children:(0,r.tZ)(aw.Z,{children:"Require symbol"})})]}),(0,r.tZ)("div",{css:j.Ml.marginTop("auto"),children:(0,r.tZ)(k.Z.Item,{children:(0,r.tZ)(G.ZP,{type:"primary",icon:(0,r.tZ)(av.Z,{}),htmlType:"submit",children:"Save changes"})})})]})})})]})},aD={plugins:"Unable to get plugins",update:"Unable to update system"},aH=async(e,t,a,r)=>{try{await ab.Z.update([{key:"defaultplugins",type:"array",method:a?"append":"remove",value:t.key}]);let i=_.Z.deepCopy((null==e?void 0:e.defaultplugins)||[]),n=i.indexOf(t.key);a&&-1===n&&i.push(t.key),a||-1===n||i.splice(n,1),r.mutateSystem({defaultplugins:i})}catch(e){(0,w.lt)(aD.update,e)}},aq=e=>{let{plugin:t,system:a,swr:i}=e,[l,s]=(0,n.useState)();(0,n.useEffect)(()=>{if(null==a?void 0:a.defaultplugins){let e=a.defaultplugins.includes(t.key);s(e)}},[t,a]);let o=(0,n.useCallback)(async e=>aH(a,t,e.target.checked,i),[t,a,i]);return(0,r.tZ)(aw.Z,{checked:l,onChange:o})},aL=()=>{let e=(0,n.useRef)(null),[t,a]=(0,n.useState)(),[i,l]=(0,n.useState)(),[s,{mutateSystem:o,loadingSystem:d}]=ab.Z.useSystem();(0,n.useEffect)(()=>{ta.Z.completeList().then(e=>{a(e)}).catch(e=>{(0,w.lt)(aD.plugins,e)})},[]);let c=(0,n.useCallback)(e=>(0,r.tZ)(aq,{system:s,plugin:e,swr:{mutateSystem:o}}),[s,o]),u=(0,n.useMemo)(()=>[{title:"Category",dataIndex:"category",key:"category"},{title:"Name",dataIndex:"name",key:"name"},{title:"Default enabled",key:"enable",render:c}],[c]),p=(0,n.useCallback)(()=>{let t=e.current;t&&(t.clientHeight>window.innerHeight-t.offsetTop-59?l({y:window.innerHeight-t.offsetTop-59}):l(null))},[]);return(0,n.useEffect)(()=>(window.addEventListener("resize",p),()=>{window.removeEventListener("resize",p)}),[p]),(0,n.useEffect)(()=>{p()},[t,p]),(0,r.tZ)(tI.Z,{loading:!t||d,pagination:!1,size:"small",columns:u,dataSource:t,ref:e,scroll:{y:null==i?void 0:i.y}})},aW={users:{label:"Users",key:"users"},registration:{label:"Registration",key:"registration"},plugins:{label:"Plugins",key:"plugins"}},aK={users:"Error while loading users"},aM=()=>{let e=(0,i.useRouter)(),{tab:t}=e.query,[a,{addOneUser:s,mutateOneUser:d,delOneUser:c,errorUsers:u}]=eY.Z.useUsers();(0,n.useEffect)(()=>{u&&(0,w.lt)(aK.users,u)},[u]);let p=(0,n.useCallback)(t=>{e.replace({pathname:"/dashboard",query:{page:"administration",tab:t}})},[e]);return(0,r.BX)(l.Z,{css:eD.inDashboard,children:[(0,r.tZ)(T,{title:(0,r.tZ)(o.Z.Title,{level:2,css:(0,x.iv)({marginBottom:"0 !important"}),children:"Administration"})}),(0,r.tZ)(l.Z.Content,{children:(0,r.tZ)(C.Z,{css:eD.inDashboardTabs,type:"card",items:[{key:aW.users.key,label:aW.users.label,children:(0,r.tZ)(aE,{users:a,swr:{addOneUser:s,mutateOneUser:d,delOneUser:c}})},{key:aW.registration.key,label:aW.registration.label,children:(0,r.tZ)(aN,{})},{key:aW.plugins.key,label:aW.plugins.label,children:(0,r.tZ)(aL,{})}],defaultActiveKey:t||"default",onChange:p})})]})};var aY=a(51158);let aF=()=>{let e=(0,n.useCallback)(e=>(0,r.BX)(aY.ZP.Item,{children:[" - ",e]}),[]);return(0,r.tZ)(en.Z,{title:"Standard workflow",children:(0,r.tZ)(aY.ZP,{dataSource:["Go to account settings","Fill your first name, last name, change your password if needed","Create an HPC provider, you will need that to run a simulation","Create a new workspace","Create a new project","Upload a geometry (STEP file for 3D or DXF file for 2D)","Select a simulation model","Configure your simulation: geometry, materials, parameters, boundary conditions, depending on your simulation, HPC resource","Run your simulation","Display the results","Depending on your simulation, visualize data","Depending on your simulation, post-process the result"],renderItem:e})})},aG=()=>(0,r.tZ)(en.Z,{title:"Workspace",children:(0,r.BX)(o.Z.Text,{children:["The workspace is the place where all the projects are. You can create several workspaces to sort your different projects.",(0,r.tZ)("br",{}),"You can share your workspace with other users or groups throught organizations."]})}),aJ=()=>(0,r.BX)(en.Z,{title:"Project",children:[(0,r.tZ)(o.Z.Text,{children:"The project is used to manage geometries and simulation."}),(0,r.tZ)(o.Z.Title,{level:5,children:"Archive Project"}),(0,r.BX)(o.Z.Text,{children:["You can archive a project to save disk space.",(0,r.tZ)("br",{}),"Once archived, a project is not editable anymore.",(0,r.tZ)("br",{}),"At the archive time, you can download a ",(0,r.tZ)("code",{children:".tanatlocarchive"})," ","file that contains all the data to restore your project later.",(0,r.tZ)("br",{}),"There is several options to manage an archived projects:",(0,r.BX)("ul",{children:[(0,r.tZ)("li",{children:"Restore the project from the previously downloaded archive file;"}),(0,r.tZ)("li",{children:"Restore the project from the archive file on the server;"}),(0,r.tZ)("li",{children:"Delete the archive file on the server, in the case you will not be able to restore the project from the server archive file."})]})]})]}),a_=()=>(0,r.BX)(en.Z,{title:"Account / HPC plugins",children:[(0,r.tZ)(o.Z.Title,{level:5,children:"Local plugin"}),(0,r.tZ)(o.Z.Text,{children:"Allow to compute a simulation directly on the frontal server."}),(0,r.tZ)(o.Z.Text,{children:"This plugin is only reserved for test purposes."}),(0,r.tZ)(o.Z.Title,{level:5,children:"Rescale plugin"}),(0,r.BX)(o.Z.Text,{children:["Allow to compute a simulation on"," ",(0,r.tZ)("a",{href:"https://www.rescale.com/",children:"Rescale"}),"."]}),(0,r.tZ)(o.Z.Text,{children:"You have to fill the following informations:"}),(0,r.BX)("ul",{children:[(0,r.tZ)("li",{children:"Name: a name to retrieve your configuration during the simulation parameterization;"}),(0,r.BX)("li",{children:["Token: your API token. You can find it in your"," ",(0,r.tZ)("a",{href:"https://platform.rescale.jp/user/settings/api-key/",children:"Rescale account"}),";"]}),(0,r.tZ)("li",{children:"Platform: the platform you use. USA, Europe or Japan;"}),(0,r.tZ)("li",{children:"[Optional] Organization name: the organization you are in;"}),(0,r.tZ)("li",{children:"[Optional] Project id: the financial project identifier;"}),(0,r.tZ)("li",{children:"[Optional] Default walltime: the default value for the run walltime;"}),(0,r.tZ)("li",{children:"[Optional] Additional files: additional files you have to use with your simulations. Generally FreeFEM custom plugins."})]}),(0,r.tZ)(o.Z.Text,{children:"When you save this informations, Tanatloc will check your API key, the available core types, and the available FreeFEM versions."})]}),aV=()=>(0,r.BX)(en.Z,{title:"Administration",children:[(0,r.tZ)(o.Z.Text,{children:"Your need to be an administrator to have acces to this part"}),(0,r.tZ)(o.Z.Title,{level:5,children:"Users"}),(0,r.tZ)(o.Z.Text,{children:"You can manage users: create, delete or modify informations."}),(0,r.tZ)(o.Z.Title,{level:5,children:"Registration"}),(0,r.tZ)(o.Z.Text,{children:"Allow you to enable / disable the signup and to manage the required pattern for passwords."})]}),aQ=()=>(0,r.BX)(en.Z,{title:"Organization",children:[(0,r.tZ)(o.Z.Text,{children:"Allow you to manage an organization, and associated groups for sharing purpose."}),(0,r.tZ)(o.Z.Title,{level:5,children:"Users"}),(0,r.BX)(o.Z.Text,{children:["Add or remove owners and users.",(0,r.tZ)("br",{}),"Owners and users in an organization can be used to share a workspace or a project."]}),(0,r.tZ)(o.Z.Title,{level:5,children:"Groups"}),(0,r.BX)(o.Z.Text,{children:["Add, modify or remove groups.",(0,r.tZ)("br",{}),"Groups in an organization can be used to share a workspace or a project."]})]});var a$=a(73461),a0=a.n(a$);let a1=()=>(0,r.BX)(en.Z,{title:"About",children:[(0,r.BX)(o.Z,{children:["Version: ",(0,r.tZ)(o.Z.Text,{code:!0,children:f.i8})]}),(0,r.tZ)("br",{}),(0,r.BX)(o.Z,{children:["Git version:"," ",(0,r.tZ)(o.Z.Text,{code:!0,children:_.Z.getGitVersion()})]}),(0,r.tZ)("br",{}),(0,r.BX)(o.Z,{children:["Browser: ",(0,r.tZ)(o.Z.Text,{code:!0,children:navigator.userAgent})]}),(0,r.tZ)("br",{}),(0,r.BX)(o.Z,{children:["OS: ",(0,r.tZ)(o.Z.Text,{code:!0,children:a0().platform()})]})]}),a5=()=>(0,r.BX)(l.Z,{css:eD.inDashboard,children:[(0,r.tZ)(T,{title:(0,r.tZ)(o.Z.Title,{level:2,css:(0,x.iv)({marginBottom:"0 !important"}),children:"Help"}),extra:(0,r.tZ)("a",{href:"https://github.com/Airthium/tanatloc/issues/new/choose",target:"_blank",rel:"noreferrer",children:"Open an issue"})}),(0,r.tZ)(l.Z.Content,{css:j.KP.scroll,children:(0,r.BX)(W.Z,{direction:"vertical",css:j.KP.fullWidth,size:20,children:[(0,r.tZ)(aF,{}),(0,r.tZ)(aG,{}),(0,r.tZ)(aJ,{}),(0,r.tZ)(a_,{}),(0,r.tZ)(aQ,{}),(0,r.tZ)(aV,{}),(0,r.tZ)(a1,{})]})})]}),a2={user:"Error while loading user",organizations:"Error while loading organizations",workspaces:"Error while loading workspaces",logout:"Unable to logout"},a4={workspaces:{label:"Workspaces",key:"workspaces"},account:{label:"Account Settings",key:"account"},organizations:{label:"Organizations",key:"organizations"},administration:{label:"Administration",key:"administration"},editor:{label:"Editor",key:"editor"},help:{label:"I Need Help",key:"help"},logout:{label:"Logout",key:"logout"}},a7=()=>{let[e,t]=(0,n.useState)(),[a,{mutateUser:Z,clearUser:k,errorUser:O,loadingUser:C}]=eY.Z.useUser(),[P,{addOneOrganization:x,delOneOrganization:S,mutateOneOrganization:z,errorOrganizations:B,loadingOrganizations:T}]=tR.useOrganizations(),[E,{addOneWorkspace:A,delOneWorkspace:X,mutateOneWorkspace:R,errorWorkspaces:I,loadingWorkspaces:U}]=N.useWorkspaces(),D=(0,i.useRouter)(),H=(0,n.useCallback)(async()=>{try{await e8(),k(),D.push("/")}catch(e){(0,w.lt)(a2.logout,e)}},[D,k]),q=(0,n.useCallback)(e=>{t(e),e===a4.logout.key?H():e===a4.editor.key?D.push("/editor"):D.replace({pathname:"/dashboard",query:{page:e}})},[D,H]),L=(0,n.useCallback)(e=>{let{keyPath:t}=e,a=t.pop();q(a)},[q]);return((0,v.Z)(()=>{C||a||D.replace("/")},[a,C,D]),(0,v.Z)(()=>{let e=new URLSearchParams(window.location.search),a=e.get("page");a?t(a):q(a4.workspaces.key)},[D],[q]),(0,v.Z)(()=>{O&&(0,w.lt)(a2.user,O),B&&(0,w.lt)(a2.organizations,B),I&&(0,w.lt)(a2.workspaces,I)},[O,B,I]),!a||C||T||U)?(0,r.tZ)(b.Z,{}):(0,r.BX)(l.Z,{css:eD.dashboard,children:[(0,r.BX)(l.Z.Sider,{theme:"light",width:"256",css:eD.sider,children:[(0,r.tZ)("div",{css:j.KP.logo,children:(0,r.tZ)("img",{src:"/images/logo.svg",alt:"Tanatloc"})}),(0,r.tZ)(s.Z,{css:eD.menu,items:[{key:a4.workspaces.key,icon:(0,r.tZ)(d.Z,{}),label:a4.workspaces.label},{key:a4.account.key,icon:(0,r.tZ)(c.Z,{}),label:a4.account.label},{key:a4.organizations.key,icon:(0,r.tZ)(u.Z,{}),label:a4.organizations.label,className:y()()?"display-none":""},{key:a4.administration.key,className:a.superuser&&!y()()?"":"display-none",icon:(0,r.tZ)(p.Z,{}),label:a4.administration.label},{key:a4.editor.key,icon:(0,r.tZ)(h.Z,{}),label:a4.editor.label},{key:a4.help.key,icon:(0,r.tZ)(m.Z,{}),label:a4.help.label},{type:"divider"},{key:a4.logout.key,danger:!0,icon:(0,r.tZ)(g.Z,{}),label:a4.logout.label,className:y()()?"display-none":""},{key:"version",disabled:!0,className:"version",label:(0,r.BX)(o.Z.Text,{css:j.KP.textLight,ellipsis:{tooltip:!0},children:["version ",f.i8]})}],onClick:L,mode:"inline"})]}),(0,r.BX)(l.Z.Content,{css:j.KP.noScroll,children:[e===a4.workspaces.key&&(0,r.tZ)(eL,{user:{id:a.id},workspaces:E,organizations:P,swr:{addOneWorkspace:A,delOneWorkspace:X,mutateOneWorkspace:R}}),e===a4.account.key&&(0,r.tZ)(tx,{user:{email:a.email,firstname:a.firstname,lastname:a.lastname,avatar:a.avatar},swr:{mutateUser:Z,clearUser:k}}),e===a4.organizations.key&&(0,r.tZ)(aZ,{user:{id:a.id},organizations:P,swr:{addOneOrganization:x,delOneOrganization:S,mutateOneOrganization:z,loadingOrganizations:T}}),e===a4.administration.key&&(0,r.tZ)(aM,{}),e===a4.help.key&&(0,r.tZ)(a5,{})]})]})},a6=()=>(0,r.tZ)(a7,{});var a8=a6},4147:function(e){"use strict";e.exports={i8:"1.2.6"}}},function(e){e.O(0,[5336,4875,992,5813,1577,4234,2969,3624,3363,1417,974,4119,6557,1158,5117,7521,1032,7450,9774,2888,179],function(){return e(e.s=40528)}),_N_E=e.O()}]);