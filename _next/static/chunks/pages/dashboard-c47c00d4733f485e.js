(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8026],{9637:function(e,a,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/dashboard",function(){return t(96324)}])},74989:function(e,a,t){"use strict";var s;t.d(a,{JT:function(){return n},ah:function(){return o},nq:function(){return i},tE:function(){return l},yL:function(){return r}}),null!==(s=t(34155).env.AUTH_SECRET)&&void 0!==s||Array(33).join("a");let r=6,i=16,n=!0,l=!0,o=!0},51305:function(e,a){"use strict";a.Z={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M924.8 625.7l-65.5-56c3.1-19 4.7-38.4 4.7-57.8s-1.6-38.8-4.7-57.8l65.5-56a32.03 32.03 0 009.3-35.2l-.9-2.6a443.74 443.74 0 00-79.7-137.9l-1.8-2.1a32.12 32.12 0 00-35.1-9.5l-81.3 28.9c-30-24.6-63.5-44-99.7-57.6l-15.7-85a32.05 32.05 0 00-25.8-25.7l-2.7-.5c-52.1-9.4-106.9-9.4-159 0l-2.7.5a32.05 32.05 0 00-25.8 25.7l-15.8 85.4a351.86 351.86 0 00-99 57.4l-81.9-29.1a32 32 0 00-35.1 9.5l-1.8 2.1a446.02 446.02 0 00-79.7 137.9l-.9 2.6c-4.5 12.5-.8 26.5 9.3 35.2l66.3 56.6c-3.1 18.8-4.6 38-4.6 57.1 0 19.2 1.5 38.4 4.6 57.1L99 625.5a32.03 32.03 0 00-9.3 35.2l.9 2.6c18.1 50.4 44.9 96.9 79.7 137.9l1.8 2.1a32.12 32.12 0 0035.1 9.5l81.9-29.1c29.8 24.5 63.1 43.9 99 57.4l15.8 85.4a32.05 32.05 0 0025.8 25.7l2.7.5a449.4 449.4 0 00159 0l2.7-.5a32.05 32.05 0 0025.8-25.7l15.7-85a350 350 0 0099.7-57.6l81.3 28.9a32 32 0 0035.1-9.5l1.8-2.1c34.8-41.1 61.6-87.5 79.7-137.9l.9-2.6c4.5-12.3.8-26.3-9.3-35zM788.3 465.9c2.5 15.1 3.8 30.6 3.8 46.1s-1.3 31-3.8 46.1l-6.6 40.1 74.7 63.9a370.03 370.03 0 01-42.6 73.6L721 702.8l-31.4 25.8c-23.9 19.6-50.5 35-79.3 45.8l-38.1 14.3-17.9 97a377.5 377.5 0 01-85 0l-17.9-97.2-37.8-14.5c-28.5-10.8-55-26.2-78.7-45.7l-31.4-25.9-93.4 33.2c-17-22.9-31.2-47.6-42.6-73.6l75.5-64.5-6.5-40c-2.4-14.9-3.7-30.3-3.7-45.5 0-15.3 1.2-30.6 3.7-45.5l6.5-40-75.5-64.5c11.3-26.1 25.6-50.7 42.6-73.6l93.4 33.2 31.4-25.9c23.7-19.5 50.2-34.9 78.7-45.7l37.9-14.3 17.9-97.2c28.1-3.2 56.8-3.2 85 0l17.9 97 38.1 14.3c28.7 10.8 55.4 26.2 79.3 45.8l31.4 25.8 92.8-32.9c17 22.9 31.2 47.6 42.6 73.6L781.8 426l6.5 39.9zM512 326c-97.2 0-176 78.8-176 176s78.8 176 176 176 176-78.8 176-176-78.8-176-176-176zm79.2 255.2A111.6 111.6 0 01512 614c-29.9 0-58-11.7-79.2-32.8A111.6 111.6 0 01400 502c0-29.9 11.7-58 32.8-79.2C454 401.6 482.1 390 512 390c29.9 0 58 11.6 79.2 32.8A111.6 111.6 0 01624 502c0 29.9-11.7 58-32.8 79.2z"}}]},name:"setting",theme:"outlined"}},23739:function(e,a,t){"use strict";t.d(a,{Z:function(){return l}});var s=t(87462),r=t(67294),i={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880 112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V144c0-17.7-14.3-32-32-32zm-40 728H184V184h656v656zM340 683v77c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8v-77c-10.1 3.3-20.8 5-32 5s-21.9-1.8-32-5zm64-198V264c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v221c10.1-3.3 20.8-5 32-5s21.9 1.8 32 5zm-64 198c10.1 3.3 20.8 5 32 5s21.9-1.8 32-5c41.8-13.5 72-52.7 72-99s-30.2-85.5-72-99c-10.1-3.3-20.8-5-32-5s-21.9 1.8-32 5c-41.8 13.5-72 52.7-72 99s30.2 85.5 72 99zm.1-115.7c.3-.6.7-1.2 1-1.8v-.1l1.2-1.8c.1-.2.2-.3.3-.5.3-.5.7-.9 1-1.4.1-.1.2-.3.3-.4.5-.6.9-1.1 1.4-1.6l.3-.3 1.2-1.2.4-.4c.5-.5 1-.9 1.6-1.4.6-.5 1.1-.9 1.7-1.3.2-.1.3-.2.5-.3.5-.3.9-.7 1.4-1 .1-.1.3-.2.4-.3.6-.4 1.2-.7 1.9-1.1.1-.1.3-.1.4-.2.5-.3 1-.5 1.6-.8l.6-.3c.7-.3 1.3-.6 2-.8.7-.3 1.4-.5 2.1-.7.2-.1.4-.1.6-.2.6-.2 1.1-.3 1.7-.4.2 0 .3-.1.5-.1.7-.2 1.5-.3 2.2-.4.2 0 .3 0 .5-.1.6-.1 1.2-.1 1.8-.2h.6c.8 0 1.5-.1 2.3-.1s1.5 0 2.3.1h.6c.6 0 1.2.1 1.8.2.2 0 .3 0 .5.1.7.1 1.5.2 2.2.4.2 0 .3.1.5.1.6.1 1.2.3 1.7.4.2.1.4.1.6.2.7.2 1.4.4 2.1.7.7.2 1.3.5 2 .8l.6.3c.5.2 1.1.5 1.6.8.1.1.3.1.4.2.6.3 1.3.7 1.9 1.1.1.1.3.2.4.3.5.3 1 .6 1.4 1 .2.1.3.2.5.3.6.4 1.2.9 1.7 1.3s1.1.9 1.6 1.4l.4.4 1.2 1.2.3.3c.5.5 1 1.1 1.4 1.6.1.1.2.3.3.4.4.4.7.9 1 1.4.1.2.2.3.3.5l1.2 1.8s0 .1.1.1a36.18 36.18 0 015.1 18.5c0 6-1.5 11.7-4.1 16.7-.3.6-.7 1.2-1 1.8 0 0 0 .1-.1.1l-1.2 1.8c-.1.2-.2.3-.3.5-.3.5-.7.9-1 1.4-.1.1-.2.3-.3.4-.5.6-.9 1.1-1.4 1.6l-.3.3-1.2 1.2-.4.4c-.5.5-1 .9-1.6 1.4-.6.5-1.1.9-1.7 1.3-.2.1-.3.2-.5.3-.5.3-.9.7-1.4 1-.1.1-.3.2-.4.3-.6.4-1.2.7-1.9 1.1-.1.1-.3.1-.4.2-.5.3-1 .5-1.6.8l-.6.3c-.7.3-1.3.6-2 .8-.7.3-1.4.5-2.1.7-.2.1-.4.1-.6.2-.6.2-1.1.3-1.7.4-.2 0-.3.1-.5.1-.7.2-1.5.3-2.2.4-.2 0-.3 0-.5.1-.6.1-1.2.1-1.8.2h-.6c-.8 0-1.5.1-2.3.1s-1.5 0-2.3-.1h-.6c-.6 0-1.2-.1-1.8-.2-.2 0-.3 0-.5-.1-.7-.1-1.5-.2-2.2-.4-.2 0-.3-.1-.5-.1-.6-.1-1.2-.3-1.7-.4-.2-.1-.4-.1-.6-.2-.7-.2-1.4-.4-2.1-.7-.7-.2-1.3-.5-2-.8l-.6-.3c-.5-.2-1.1-.5-1.6-.8-.1-.1-.3-.1-.4-.2-.6-.3-1.3-.7-1.9-1.1-.1-.1-.3-.2-.4-.3-.5-.3-1-.6-1.4-1-.2-.1-.3-.2-.5-.3-.6-.4-1.2-.9-1.7-1.3s-1.1-.9-1.6-1.4l-.4-.4-1.2-1.2-.3-.3c-.5-.5-1-1.1-1.4-1.6-.1-.1-.2-.3-.3-.4-.4-.4-.7-.9-1-1.4-.1-.2-.2-.3-.3-.5l-1.2-1.8v-.1c-.4-.6-.7-1.2-1-1.8-2.6-5-4.1-10.7-4.1-16.7s1.5-11.7 4.1-16.7zM620 539v221c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V539c-10.1 3.3-20.8 5-32 5s-21.9-1.8-32-5zm64-198v-77c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v77c10.1-3.3 20.8-5 32-5s21.9 1.8 32 5zm-64 198c10.1 3.3 20.8 5 32 5s21.9-1.8 32-5c41.8-13.5 72-52.7 72-99s-30.2-85.5-72-99c-10.1-3.3-20.8-5-32-5s-21.9 1.8-32 5c-41.8 13.5-72 52.7-72 99s30.2 85.5 72 99zm.1-115.7c.3-.6.7-1.2 1-1.8v-.1l1.2-1.8c.1-.2.2-.3.3-.5.3-.5.7-.9 1-1.4.1-.1.2-.3.3-.4.5-.6.9-1.1 1.4-1.6l.3-.3 1.2-1.2.4-.4c.5-.5 1-.9 1.6-1.4.6-.5 1.1-.9 1.7-1.3.2-.1.3-.2.5-.3.5-.3.9-.7 1.4-1 .1-.1.3-.2.4-.3.6-.4 1.2-.7 1.9-1.1.1-.1.3-.1.4-.2.5-.3 1-.5 1.6-.8l.6-.3c.7-.3 1.3-.6 2-.8.7-.3 1.4-.5 2.1-.7.2-.1.4-.1.6-.2.6-.2 1.1-.3 1.7-.4.2 0 .3-.1.5-.1.7-.2 1.5-.3 2.2-.4.2 0 .3 0 .5-.1.6-.1 1.2-.1 1.8-.2h.6c.8 0 1.5-.1 2.3-.1s1.5 0 2.3.1h.6c.6 0 1.2.1 1.8.2.2 0 .3 0 .5.1.7.1 1.5.2 2.2.4.2 0 .3.1.5.1.6.1 1.2.3 1.7.4.2.1.4.1.6.2.7.2 1.4.4 2.1.7.7.2 1.3.5 2 .8l.6.3c.5.2 1.1.5 1.6.8.1.1.3.1.4.2.6.3 1.3.7 1.9 1.1.1.1.3.2.4.3.5.3 1 .6 1.4 1 .2.1.3.2.5.3.6.4 1.2.9 1.7 1.3s1.1.9 1.6 1.4l.4.4 1.2 1.2.3.3c.5.5 1 1.1 1.4 1.6.1.1.2.3.3.4.4.4.7.9 1 1.4.1.2.2.3.3.5l1.2 1.8v.1a36.18 36.18 0 015.1 18.5c0 6-1.5 11.7-4.1 16.7-.3.6-.7 1.2-1 1.8v.1l-1.2 1.8c-.1.2-.2.3-.3.5-.3.5-.7.9-1 1.4-.1.1-.2.3-.3.4-.5.6-.9 1.1-1.4 1.6l-.3.3-1.2 1.2-.4.4c-.5.5-1 .9-1.6 1.4-.6.5-1.1.9-1.7 1.3-.2.1-.3.2-.5.3-.5.3-.9.7-1.4 1-.1.1-.3.2-.4.3-.6.4-1.2.7-1.9 1.1-.1.1-.3.1-.4.2-.5.3-1 .5-1.6.8l-.6.3c-.7.3-1.3.6-2 .8-.7.3-1.4.5-2.1.7-.2.1-.4.1-.6.2-.6.2-1.1.3-1.7.4-.2 0-.3.1-.5.1-.7.2-1.5.3-2.2.4-.2 0-.3 0-.5.1-.6.1-1.2.1-1.8.2h-.6c-.8 0-1.5.1-2.3.1s-1.5 0-2.3-.1h-.6c-.6 0-1.2-.1-1.8-.2-.2 0-.3 0-.5-.1-.7-.1-1.5-.2-2.2-.4-.2 0-.3-.1-.5-.1-.6-.1-1.2-.3-1.7-.4-.2-.1-.4-.1-.6-.2-.7-.2-1.4-.4-2.1-.7-.7-.2-1.3-.5-2-.8l-.6-.3c-.5-.2-1.1-.5-1.6-.8-.1-.1-.3-.1-.4-.2-.6-.3-1.3-.7-1.9-1.1-.1-.1-.3-.2-.4-.3-.5-.3-1-.6-1.4-1-.2-.1-.3-.2-.5-.3-.6-.4-1.2-.9-1.7-1.3s-1.1-.9-1.6-1.4l-.4-.4-1.2-1.2-.3-.3c-.5-.5-1-1.1-1.4-1.6-.1-.1-.2-.3-.3-.4-.4-.4-.7-.9-1-1.4-.1-.2-.2-.3-.3-.5l-1.2-1.8v-.1c-.4-.6-.7-1.2-1-1.8-2.6-5-4.1-10.7-4.1-16.7s1.5-11.7 4.1-16.7z"}}]},name:"control",theme:"outlined"},n=t(91266),l=r.forwardRef(function(e,a){return r.createElement(n.Z,(0,s.Z)({},e,{ref:a,icon:i}))})},8626:function(e,a,t){"use strict";t.d(a,{Z:function(){return l}});var s=t(87462),r=t(67294),i={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M832 64H192c-17.7 0-32 14.3-32 32v832c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V96c0-17.7-14.3-32-32-32zm-600 72h560v208H232V136zm560 480H232V408h560v208zm0 272H232V680h560v208zM496 208H312c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h184c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8zM312 544h184c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8H312c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8zm328 244a40 40 0 1080 0 40 40 0 10-80 0z"}}]},name:"hdd",theme:"outlined"},n=t(91266),l=r.forwardRef(function(e,a){return r.createElement(n.Z,(0,s.Z)({},e,{ref:a,icon:i}))})},99758:function(e,a,t){"use strict";t.d(a,{Z:function(){return l}});var s=t(87462),r=t(67294),i={icon:{tag:"svg",attrs:{"fill-rule":"evenodd",viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880 912H144c-17.7 0-32-14.3-32-32V144c0-17.7 14.3-32 32-32h360c4.4 0 8 3.6 8 8v56c0 4.4-3.6 8-8 8H184v656h656V520c0-4.4 3.6-8 8-8h56c4.4 0 8 3.6 8 8v360c0 17.7-14.3 32-32 32zM653.3 424.6l52.2 52.2a8.01 8.01 0 01-4.7 13.6l-179.4 21c-5.1.6-9.5-3.7-8.9-8.9l21-179.4c.8-6.6 8.9-9.4 13.6-4.7l52.4 52.4 256.2-256.2c3.1-3.1 8.2-3.1 11.3 0l42.4 42.4c3.1 3.1 3.1 8.2 0 11.3L653.3 424.6z"}}]},name:"import",theme:"outlined"},n=t(91266),l=r.forwardRef(function(e,a){return r.createElement(n.Z,(0,s.Z)({},e,{ref:a,icon:i}))})},26569:function(e,a,t){"use strict";var s=t(87462),r=t(67294),i=t(51305),n=t(91266),l=r.forwardRef(function(e,a){return r.createElement(n.Z,(0,s.Z)({},e,{ref:a,icon:i.Z}))});a.Z=l},61950:function(e,a,t){"use strict";t.d(a,{Z:function(){return r}});var s=t(10914),r={add:async(e,a)=>(await (0,s.R)("/api/avatar",{method:"POST",headers:{Accept:"application/json"},body:JSON.stringify({file:e,project:a})})).json()}},69037:function(e,a,t){"use strict";t.d(a,{H:function(){return s}});class s extends Error{constructor(e){var a;super(e.title),this.title=e.title,this.name="APIError",this.render=e.render,this.err=e.err,this.type=null!==(a=e.type)&&void 0!==a?a:"error"}}},68115:function(e,a,t){"use strict";t.d(a,{Z:function(){return n}});var s=t(81758),r=t(67294),i=t(10914),n={useGeometries:e=>{var a;let{data:t,error:n,mutate:l}=(0,s.ZP)(["/api/geometries",JSON.stringify({ids:e})],e=>{let[a,t]=e;return(0,i._)(a,t)}),o=null!==(a=null==t?void 0:t.geometries)&&void 0!==a?a:[],d=(0,r.useCallback)(async e=>{let a=[...o,e];await l({geometries:a})},[o,l]),c=(0,r.useCallback)(async e=>{let a=o.filter(a=>a.id!==e.id);await l({geometries:a})},[o,l]),u=(0,r.useCallback)(async e=>{let a=o.map(a=>(a.id===e.id&&(a={...a,...e}),a));await l({geometries:a})},[o,l]);return[o,{addOneGeometry:d,delOneGeometry:c,mutateOneGeometry:u,errorGeometries:n,loadingGeometries:!t}]},add:async(e,a)=>(await (0,i.R)("/api/geometry",{method:"POST",body:JSON.stringify({project:e,geometry:a})})).json(),update:async(e,a)=>{await (0,i.R)("/api/geometry/"+e.id,{method:"PUT",body:JSON.stringify(a)})},del:async e=>{await (0,i.R)("/api/geometry/"+e.id,{method:"DELETE"})},download:async e=>(await (0,i.R)("/api/geometry/"+e.id+"/download")).json(),getPart:async e=>(await (0,i.R)("/api/geometry/"+e.id+"/part")).json(),splitStep:async(e,a)=>(await (0,i.R)("/api/geometry/"+a.id+"/splitStep",{method:"POST",body:JSON.stringify({project:e})})).json()}},59973:function(e,a,t){"use strict";t.d(a,{x:function(){return i}});var s=t(59134);let r=t.n(s)()()?"http://localhost:3000":"",i=async e=>{let a=await fetch(r+"/api/login",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({email:e.email,password:e.password})});return 200===a.status?{ok:!0,...await a.json()}:{ok:!1}}},27509:function(e,a,t){"use strict";t.d(a,{Z:function(){return n}});var s=t(81758),r=t(67294),i=t(10914),n={useSystem:()=>{var e;let{data:a,error:t,mutate:n}=(0,s.ZP)("/api/system",i._),l=null!==(e=null==a?void 0:a.system)&&void 0!==e?e:{},o=(0,r.useCallback)(async e=>{await n({system:{...l,...e}})},[l,n]);return[l,{mutateSystem:o,errorSystem:t,loadingSystem:!a}]},update:async e=>{await (0,i.R)("/api/system",{method:"PUT",body:JSON.stringify(e)})}}},6280:function(e,a,t){"use strict";t.d(a,{o:function(){return x}});var s=t(85893),r=t(60594),i=t(27829),n=t(74989),l=t(27509);let o={password:"Please enter a password",passwordTooSmall:e=>"Your password is too small (minimum "+e+" characters)",passwordTooLong:e=>"Your password is too long (maximum "+e+" characters)",passwordRequireLetter:"Your password must contain a letter",passwordRequireNumber:"Your password must contain a number",passwordRequireSymbol:"Your password must contain a symbol"},d=(e,a)=>!(a.length<e),c=(e,a)=>!(a.length>e),u=(e,a)=>-1!==e.search(a),m=(e,a)=>{var t,s;return(null!==(s=null==e?void 0:null===(t=e.password)||void 0===t?void 0:t.requireLetter)&&void 0!==s?!s:!n.JT)||u(a,/[a-zA-Z]/)},p=(e,a)=>{var t,s;return(null!==(s=null==e?void 0:null===(t=e.password)||void 0===t?void 0:t.requireNumber)&&void 0!==s?!s:!n.tE)||u(a,/\d/)},h=(e,a)=>{var t,s;return(null!==(s=null==e?void 0:null===(t=e.password)||void 0===t?void 0:t.requireSymbol)&&void 0!==s?!s:!n.ah)||u(a,/[!@#$%^&*(){}[\]<>?/|.:;_-]/)},g=(e,a,t,s)=>{d(e,t)||s.push(o.passwordTooSmall(e)),c(a,t)||s.push(o.passwordTooLong(a))},w=(e,a,t)=>{m(e,a)||t.push(o.passwordRequireLetter),p(e,a)||t.push(o.passwordRequireNumber),h(e,a)||t.push(o.passwordRequireSymbol)};var x=e=>{var a,t,d,c;let{labelCol:u,wrapperCol:m,name:p,label:h,inputPlaceholder:x,inputAutoComplete:v,edit:j,style:y,required:f}=e,[b]=l.Z.useSystem(),k=null!==(d=null==b?void 0:null===(a=b.password)||void 0===a?void 0:a.min)&&void 0!==d?d:n.yL,Z=null!==(c=null==b?void 0:null===(t=b.password)||void 0===t?void 0:t.max)&&void 0!==c?c:n.nq;return(0,s.jsx)(r.Z.Item,{labelCol:u,wrapperCol:m,name:null!=p?p:"password",label:null!=h?h:"Password",rules:[()=>({validator(e,a){let t=[];return j&&"******"===a?Promise.resolve():a?(g(k,Z,a,t),w(b,a,t),t.length)?Promise.reject(t):Promise.resolve():Promise.reject(o.password)}}),{required:!!f,message:""}],style:y,children:(0,s.jsx)(i.Z.Password,{placeholder:x,autoComplete:v})})}},96324:function(e,a,t){"use strict";t.r(a),t.d(a,{default:function(){return sh}});var s=t(85893),r=t(11163),i=t(67294),n=t(32312),l=t(29956),o=t(81812),d=t(87462),c={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M464 144H160c-8.8 0-16 7.2-16 16v304c0 8.8 7.2 16 16 16h304c8.8 0 16-7.2 16-16V160c0-8.8-7.2-16-16-16zm-52 268H212V212h200v200zm452-268H560c-8.8 0-16 7.2-16 16v304c0 8.8 7.2 16 16 16h304c8.8 0 16-7.2 16-16V160c0-8.8-7.2-16-16-16zm-52 268H612V212h200v200zM464 544H160c-8.8 0-16 7.2-16 16v304c0 8.8 7.2 16 16 16h304c8.8 0 16-7.2 16-16V560c0-8.8-7.2-16-16-16zm-52 268H212V612h200v200zm452-268H560c-8.8 0-16 7.2-16 16v304c0 8.8 7.2 16 16 16h304c8.8 0 16-7.2 16-16V560c0-8.8-7.2-16-16-16zm-52 268H612V612h200v200z"}}]},name:"appstore",theme:"outlined"},u=t(91266),m=i.forwardRef(function(e,a){return i.createElement(u.Z,(0,d.Z)({},e,{ref:a,icon:c}))}),p=t(26569),h={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M824.2 699.9a301.55 301.55 0 00-86.4-60.4C783.1 602.8 812 546.8 812 484c0-110.8-92.4-201.7-203.2-200-109.1 1.7-197 90.6-197 200 0 62.8 29 118.8 74.2 155.5a300.95 300.95 0 00-86.4 60.4C345 754.6 314 826.8 312 903.8a8 8 0 008 8.2h56c4.3 0 7.9-3.4 8-7.7 1.9-58 25.4-112.3 66.7-153.5A226.62 226.62 0 01612 684c60.9 0 118.2 23.7 161.3 66.8C814.5 792 838 846.3 840 904.3c.1 4.3 3.7 7.7 8 7.7h56a8 8 0 008-8.2c-2-77-33-149.2-87.8-203.9zM612 612c-34.2 0-66.4-13.3-90.5-37.5a126.86 126.86 0 01-37.5-91.8c.3-32.8 13.4-64.5 36.3-88 24-24.6 56.1-38.3 90.4-38.7 33.9-.3 66.8 12.9 91 36.6 24.8 24.3 38.4 56.8 38.4 91.4 0 34.2-13.3 66.3-37.5 90.5A127.3 127.3 0 01612 612zM361.5 510.4c-.9-8.7-1.4-17.5-1.4-26.4 0-15.9 1.5-31.4 4.3-46.5.7-3.6-1.2-7.3-4.5-8.8-13.6-6.1-26.1-14.5-36.9-25.1a127.54 127.54 0 01-38.7-95.4c.9-32.1 13.8-62.6 36.3-85.6 24.7-25.3 57.9-39.1 93.2-38.7 31.9.3 62.7 12.6 86 34.4 7.9 7.4 14.7 15.6 20.4 24.4 2 3.1 5.9 4.4 9.3 3.2 17.6-6.1 36.2-10.4 55.3-12.4 5.6-.6 8.8-6.6 6.3-11.6-32.5-64.3-98.9-108.7-175.7-109.9-110.9-1.7-203.3 89.2-203.3 199.9 0 62.8 28.9 118.8 74.2 155.5-31.8 14.7-61.1 35-86.5 60.4-54.8 54.7-85.8 126.9-87.8 204a8 8 0 008 8.2h56.1c4.3 0 7.9-3.4 8-7.7 1.9-58 25.4-112.3 66.7-153.5 29.4-29.4 65.4-49.8 104.7-59.7 3.9-1 6.5-4.7 6-8.7z"}}]},name:"team",theme:"outlined"},g=i.forwardRef(function(e,a){return i.createElement(u.Z,(0,d.Z)({},e,{ref:a,icon:h}))}),w=t(23739),x=t(53618),v=t(59055),j=i.forwardRef(function(e,a){return i.createElement(u.Z,(0,d.Z)({},e,{ref:a,icon:v.Z}))}),y={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M868 732h-70.3c-4.8 0-9.3 2.1-12.3 5.8-7 8.5-14.5 16.7-22.4 24.5a353.84 353.84 0 01-112.7 75.9A352.8 352.8 0 01512.4 866c-47.9 0-94.3-9.4-137.9-27.8a353.84 353.84 0 01-112.7-75.9 353.28 353.28 0 01-76-112.5C167.3 606.2 158 559.9 158 512s9.4-94.2 27.8-137.8c17.8-42.1 43.4-80 76-112.5s70.5-58.1 112.7-75.9c43.6-18.4 90-27.8 137.9-27.8 47.9 0 94.3 9.3 137.9 27.8 42.2 17.8 80.1 43.4 112.7 75.9 7.9 7.9 15.3 16.1 22.4 24.5 3 3.7 7.6 5.8 12.3 5.8H868c6.3 0 10.2-7 6.7-12.3C798 160.5 663.8 81.6 511.3 82 271.7 82.6 79.6 277.1 82 516.4 84.4 751.9 276.2 942 512.4 942c152.1 0 285.7-78.8 362.3-197.7 3.4-5.3-.4-12.3-6.7-12.3zm88.9-226.3L815 393.7c-5.3-4.2-13-.4-13 6.3v76H488c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h314v76c0 6.7 7.8 10.5 13 6.3l141.9-112a8 8 0 000-12.6z"}}]},name:"logout",theme:"outlined"},f=i.forwardRef(function(e,a){return i.createElement(u.Z,(0,d.Z)({},e,{ref:a,icon:y}))}),b=t(59134),k=t.n(b),Z=t(4147),C=t(56243),O=t(79877),z=t(11681),S=t(12732),T=t(91093),P=t(60594),E=t(27829),N=t(28485),A=t(7987),_=t(96550),I=t(84369),U=t(44689),R={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 472a40 40 0 1080 0 40 40 0 10-80 0zm367 352.9L696.3 352V178H768v-68H256v68h71.7v174L145 824.9c-2.8 7.4-4.3 15.2-4.3 23.1 0 35.3 28.7 64 64 64h614.6c7.9 0 15.7-1.5 23.1-4.3 33-12.7 49.4-49.8 36.6-82.8zM395.7 364.7V180h232.6v184.7L719.2 600c-20.7-5.3-42.1-8-63.9-8-61.2 0-119.2 21.5-165.3 60a188.78 188.78 0 01-121.3 43.9c-32.7 0-64.1-8.3-91.8-23.7l118.8-307.5zM210.5 844l41.7-107.8c35.7 18.1 75.4 27.8 116.6 27.8 61.2 0 119.2-21.5 165.3-60 33.9-28.2 76.3-43.9 121.3-43.9 35 0 68.4 9.5 97.6 27.1L813.5 844h-603z"}}]},name:"experiment",theme:"outlined"},q=i.forwardRef(function(e,a){return i.createElement(u.Z,(0,d.Z)({},e,{ref:a,icon:R}))}),D=t(61511),L=t(48044),W=t(81100),M=t(89499),H=t.n(M),F=e=>{let{className:a,title:t,footer:r,extra:i,children:n}=e;return(0,s.jsxs)("div",{className:a,children:[(t||i)&&(0,s.jsxs)("div",{className:H().head,children:[(0,s.jsx)("div",{children:t}),(0,s.jsx)("div",{children:i})]}),(0,s.jsx)("div",{children:n}),null!=r?r:(0,s.jsx)(W.Z,{className:H().divider})]})},G=t(52767),B=t(99940);let V={add:"Unable to add workspace"},J=async(e,a)=>{let t=await G.Z.add(e);await a.addOneWorkspace(t)};var K=e=>{let{swr:a}=e,t=(0,i.useRef)(null),[r,n]=(0,i.useState)(!1),[l,o]=(0,i.useState)(!1),{dispatch:d}=(0,i.useContext)(C.uj);(0,i.useEffect)(()=>{t.current&&t.current.focus()});let c=(0,i.useCallback)(()=>o(!0),[]),u=(0,i.useCallback)(()=>o(!1),[]),m=(0,i.useCallback)(async e=>{n(!0);try{await J(e,a),n(!1),o(!1)}catch(e){throw d((0,O.iT)({title:V.add,err:e})),n(!1),e}},[a,d]);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(B.HS,{onAdd:c,children:"Create a new workspace"}),(0,s.jsx)(L.ZP,{visible:l,loading:r,title:"Create a new workspace",onCancel:u,onOk:m,children:(0,s.jsx)(P.Z.Item,{label:"Name",name:"name",rules:[{required:!0,message:"Name is required"},{max:50,message:"Max 50 characters"}],children:(0,s.jsx)(E.Z,{ref:t,placeholder:"Workspace's name"})})})]})},Y=t(56999),$=t(4123),X=t(46170),Q=t(19646),ee=t(80617);let ea={add:"Unable to add project"},et=async(e,a,t)=>{let s=await ee.Z.add({id:e.id},a);return await t.addOneProject(s),await t.mutateOneWorkspace({...e,projects:[...e.projects,s.id]}),s};var es=e=>{let{workspace:a,swr:t}=e,n=(0,i.useRef)(null),[l,o]=(0,i.useState)(!1),[d,c]=(0,i.useState)(!1),{dispatch:u}=(0,i.useContext)(C.uj),m=(0,r.useRouter)();(0,i.useEffect)(()=>{n.current&&n.current.focus()});let p=(0,i.useCallback)(()=>o(!0),[]),h=(0,i.useCallback)(()=>o(!1),[]),g=(0,i.useCallback)(e=>e.stopPropagation(),[]),w=(0,i.useCallback)(async e=>{c(!0);try{let s=await et(a,e,t);c(!1),o(!1),await m.push({pathname:"/project",query:{page:"workspaces",workspaceId:a.id,projectId:s.id}})}catch(e){throw u((0,O.iT)({title:ea.add,err:e})),c(!1),e}},[m,a,t,u]);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(B.HS,{primary:!1,dark:!0,onAdd:p,children:"Create a new project"}),(0,s.jsxs)(L.ZP,{title:"Create a new project",visible:l,onCancel:h,onOk:w,loading:d,children:[(0,s.jsx)(P.Z.Item,{label:"Name",name:"title",rules:[{required:!0,message:"Name is required"},{max:50,message:"Max 50 characters"}],children:(0,s.jsx)(E.Z,{ref:n,placeholder:"Project's name"})}),(0,s.jsx)(P.Z.Item,{label:"Description",name:"description",children:(0,s.jsx)(E.Z.TextArea,{showCount:!0,style:{marginBottom:"20px"},maxLength:120,placeholder:"Project's description",onKeyUp:g})})]})]})},er=t(98123),ei=t(38556),en=t(32695),el=t(68601),eo=t(42210),ed=i.forwardRef(function(e,a){return i.createElement(u.Z,(0,d.Z)({},e,{ref:a,icon:eo.Z}))});let ec={edit:"Unable to edit project"},eu=async(e,a,t)=>{await ee.Z.update({id:e.id},[{key:"title",value:a.title},{key:"description",value:a.description}]),await t.mutateOneProject(e)};var em=e=>{let{disabled:a,project:t,swr:r}=e,n=(0,i.useRef)(null),[l,o]=(0,i.useState)(!1),[d,c]=(0,i.useState)(!1),{dispatch:u}=(0,i.useContext)(C.uj);(0,i.useEffect)(()=>{n.current&&n.current.focus()});let m=(0,i.useCallback)(()=>o(!0),[]),p=(0,i.useCallback)(()=>o(!1),[]),h=(0,i.useCallback)(async e=>{c(!0);try{await eu(t,e,r),c(!1),o(!1)}catch(e){throw u((0,O.iT)({title:ec.edit,err:e})),c(!1),e}},[t,r,u]),g=(0,i.useCallback)(e=>e.stopPropagation(),[]);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(B.w6,{disabled:a,dark:!0,onEdit:m}),(0,s.jsxs)(L.ZP,{title:'Edit "'+t.title+'" project',visible:l,onCancel:p,onOk:h,loading:d,initialValues:{title:t.title,description:t.description},children:[(0,s.jsx)(P.Z.Item,{label:"Name",name:"title",rules:[{required:!0,message:"Name is required"},{max:50,message:"Max 50 characters"}],children:(0,s.jsx)(E.Z,{ref:n,placeholder:"Project's name"})}),(0,s.jsx)(P.Z.Item,{label:"Description",name:"description",children:(0,s.jsx)(E.Z.TextArea,{style:{marginBottom:"20px"},placeholder:"Project's description",showCount:!0,maxLength:120,onKeyUp:g})})]})]})},ep=t(90945);let eh={del:"Unable to delete project"},eg=async(e,a,t)=>{await ee.Z.del({id:e.id},{id:a.id});let s=e.projects.findIndex(e=>e===a.id);e.projects=[...e.projects.slice(0,s),...e.projects.slice(s+1)],await t.mutateOneWorkspace(e),await t.delOneProject({id:a.id})};var ew=e=>{let{disabled:a,workspace:t,project:r,swr:n}=e,[l,d]=(0,i.useState)(!1),{dispatch:c}=(0,i.useContext)(C.uj),u=(0,i.useCallback)(async()=>{d(!0);try{await eg(t,r,n)}catch(e){throw c((0,O.iT)({title:eh.del,err:e})),e}finally{d(!1)}},[t,r,n,c]);return(0,s.jsx)(B.m1,{disabled:a,loading:l,title:"Delete the project",text:(0,s.jsxs)(s.Fragment,{children:["Are you sure you want to delete the project"," ",(0,s.jsx)(o.Z.Text,{strong:!0,children:r.title}),"?",(0,s.jsx)(ep.Z,{type:"error",message:"If you delete the project, you will no longer be able to restore the archive",style:{marginTop:"16px"}})]}),onDelete:u})},ex=t(57630),ev=t(99758),ej=t(8626),ey=t(48764).lW;let ef={archive:"Unable to archive project",unarchiveServer:"Unable to unarchive project on server",deleteArchive:"Unable to delete archive",upload:"Unable to upload archive"},eb=async(e,a,t)=>{let s=await ee.Z.archive({id:a.id}),r=await s.blob(),i=window.URL.createObjectURL(new Blob([r])),n=document.createElement("a");n.href=i,n.setAttribute("download",a.id+".tanatlocarchive"),n.click(),await t.mutateOneProject({...a,archived:!0}),await t.mutateOneWorkspace(e)},ek=async(e,a,t)=>{await ee.Z.unarchiveFromServer({id:a.id}),await t.mutateOneProject({...a,archived:!1}),await t.mutateOneWorkspace(e)},eZ=async e=>await ee.Z.deleteArchiveFile({id:e.id}),eC=async e=>{let a=new FileReader;return new Promise(t=>{a.addEventListener("load",()=>{t(a.result)}),a.readAsArrayBuffer(e)})},eO=async(e,a,t,s,r)=>{if("uploading"===t.file.status)return!0;if("done"===t.file.status)try{let r=await eC(t.file.originFileObj);await ee.Z.unarchiveFromFile({id:a.id},ey.from(r)),await s.mutateOneProject({...a,archived:!1}),await s.mutateOneWorkspace(e)}catch(e){r(ef.upload,e)}return!1};var ez=e=>{let{disabled:a,workspace:t,project:r,swr:n}=e,[l,d]=(0,i.useState)(!1),[c,u]=(0,i.useState)(!1),{dispatch:m}=(0,i.useContext)(C.uj),p=(0,i.useCallback)(()=>d(!0),[]),h=(0,i.useCallback)(()=>d(!1),[]),g=(0,i.useCallback)(async()=>{u(!0);try{await eb(t,r,n),u(!1),d(!1)}catch(e){throw m((0,O.iT)({title:ef.archive,err:e})),u(!1),e}},[t,r,n,m]),w=(0,i.useCallback)(()=>{(0,S.u)(async()=>{u(!0);try{await ek(t,r,n),u(!1),d(!1)}catch(e){m((0,O.iT)({title:ef.unarchiveServer,err:e})),u(!1)}})},[t,r,n,m]),x=(0,i.useCallback)(e=>{(0,S.u)(async()=>{let a=await eO(t,r,e,n,(e,a)=>m((0,O.iT)({title:e,err:a})));u(a),d(a)})},[t,r,n,m]),v=(0,i.useCallback)(async()=>{try{await eZ(r)}catch(e){m((0,O.iT)({title:ef.deleteArchive,err:e}))}},[r,m]);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(L.ZP,{visible:l,loading:c,title:"Archive",onCancel:h,onOk:r.archived?void 0:g,okButtonText:"Archive",children:r.archived?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(P.Z.Item,{label:"Restore archive from the server",tooltip:"This will restore the project from the server archive file.",children:(0,s.jsx)(I.ZP,{loading:c,onClick:w,children:"Restore archive from the server"})}),(0,s.jsx)(P.Z.Item,{label:"Restore archive from local file",tooltip:"This will restore the project from your local archive file (.tanatlocarchive file).",children:(0,s.jsx)(ex.Z,{action:"/api/noop",accept:".tanatlocarchive",showUploadList:!1,onChange:x,children:(0,s.jsx)(I.ZP,{children:"Restore archive from archive file"})})}),(0,s.jsx)(P.Z.Item,{label:"Delete archive from the server",tooltip:"This will delete the archive file from the server, you will have to use a local copy to restore the project.",children:(0,s.jsx)(B.m1,{loading:c,bordered:!0,title:"Delete server archive",text:"Are you sure your want to delete the archive from the server?",onDelete:v,children:"Delete server archive"})})]}):(0,s.jsxs)(o.Z.Text,{children:["An archive will be downloaded and the project will not be editable anymore, archive the project \xab",r.title,"\xbb?"]})}),(0,s.jsx)(A.Z,{title:r.archived?"Manage archive":"Archive",children:(0,s.jsx)(I.ZP,{disabled:a,type:"link",icon:r.archived?(0,s.jsx)(ev.Z,{}):(0,s.jsx)(ej.Z,{}),onClick:p})})]})},eS=t(42476),eT=t(41017),eP=t.n(eT);let eE={copy:"Unable to copy project"},eN=async(e,a,t)=>{let s=await ee.Z.copy(e,a);await t.addOneProject(s),e.projects.push(s.id),await t.mutateOneWorkspace(e)};var eA=e=>{let{workspace:a,project:t,swr:r}=e,{dispatch:n}=(0,i.useContext)(C.uj),l=(0,i.useCallback)(()=>{(0,S.u)(async()=>{try{await eN(a,t,r)}catch(e){n((0,O.iT)({title:eE.copy,err:e}))}})},[a,t,r,n]);return(0,s.jsx)(A.Z,{title:"Copy",children:(0,s.jsx)(I.ZP,{icon:(0,s.jsx)(eS.Z,{}),className:"".concat(eP().noBorder," ").concat(eP().noBackground),onClick:l})})},e_=t(66526),eI=t(2194),eU=t.n(eI),eR=t(48764).lW;let eq=e=>{var a,t,n,l;let{user:d,workspace:c,page:u,project:m,organizations:p,swr:h}=e,g=(0,r.useRouter)(),w=(0,i.useMemo)(()=>m.archived?(0,s.jsx)(_.Z,{description:"Archived project"}):m.avatar?(0,s.jsx)("img",{src:eR.from(m.avatar).toString(),alt:"Tanatloc"}):(0,s.jsx)(_.Z,{image:"images/empty.svg",description:"No preview yet."}),[m.archived,m.avatar]),x=(0,i.useMemo)(()=>(0,s.jsxs)(Y.Z,{direction:"vertical",className:"".concat(eP().fullWidth," ").concat(eP().textAlignLeft),children:[(0,s.jsxs)(o.Z.Text,{children:[(0,s.jsx)("b",{children:"Created:"})," ",new Date(m.createddate).toLocaleDateString()]}),(0,s.jsxs)(o.Z.Text,{children:[(0,s.jsx)("b",{children:"Last modified:"})," ",new Date(m.lastaccess).toLocaleDateString()]}),m.description&&(0,s.jsx)(o.Z.Paragraph,{ellipsis:{rows:4,tooltip:!0},children:m.description})]}),[m.createddate,m.lastaccess,m.description]),v=(0,i.useMemo)(()=>m.owners.map(e=>e_.Z.userToAvatar(e)),[m.owners]),j=(0,i.useMemo)(()=>m.users.map(e=>e_.Z.userToAvatar(e)),[m.users]),y=(0,i.useMemo)(()=>m.groups.map(e=>e_.Z.groupToAvatar(e)),[m.groups]),f=(0,i.useCallback)(()=>{(0,S.u)(async()=>{m.archived||await g.push({pathname:"/project",query:{page:u,workspaceId:c.id,projectId:m.id}})})},[g,c.id,u,m.id,m.archived]);return(0,s.jsx)(er.Z,{title:(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(o.Z.Paragraph,{ellipsis:{rows:2,tooltip:!0},children:m.title}),m.archived&&(0,s.jsx)(ei.Z,{children:"Archived"})]}),className:"".concat(eU().card," ").concat(m.archived?eU().cardArchived:""),cover:(0,s.jsxs)(en.Z,{className:eU().carousel,dots:{className:"dots"},children:[(0,s.jsx)(I.ZP,{className:"".concat(eU().carouselSnapshot," ").concat(m.archived?eU().carouselSnapshotArchived:""),onClick:f,children:w}),(0,s.jsx)(I.ZP,{className:"".concat(eU().carouselDescription," ").concat(m.archived?eU().carouselDescriptionArchived:""),onClick:f,children:x})]}),actions:[(0,s.jsx)(em,{disabled:!(null==m?void 0:null===(a=m.owners)||void 0===a?void 0:a.find(e=>e.id===(null==d?void 0:d.id))),project:{id:m.id,title:m.title,description:m.description},swr:{mutateOneProject:h.mutateOneProject}},"edit"),(0,s.jsx)(Q.ZP,{disabled:!(null==m?void 0:null===(t=m.owners)||void 0===t?void 0:t.find(e=>e.id===(null==d?void 0:d.id))),project:{id:m.id,title:m.title,groups:m.groups,users:m.users},organizations:p,swr:{mutateOneProject:h.mutateOneProject},style:{buttonDark:!0}},"share"),(0,s.jsx)(eA,{workspace:{id:c.id,projects:c.projects},project:{id:m.id},swr:{addOneProject:h.addOneProject,mutateOneWorkspace:h.mutateOneWorkspace}},"copy"),(0,s.jsx)(el.Z,{trigger:["click"],menu:{items:[{key:"archive",label:(0,s.jsx)(ez,{disabled:!(null==m?void 0:null===(n=m.owners)||void 0===n?void 0:n.find(e=>e.id===(null==d?void 0:d.id))),workspace:{id:c.id},project:{archived:m.archived,id:m.id,title:m.title},swr:{mutateOneWorkspace:h.mutateOneWorkspace,mutateOneProject:h.mutateOneProject}},"archive")},{key:"delete",label:(0,s.jsx)(ew,{disabled:!(null==m?void 0:null===(l=m.owners)||void 0===l?void 0:l.find(e=>e.id===(null==d?void 0:d.id))),workspace:{id:c.id,projects:c.projects},project:{id:m.id,title:m.title},swr:{mutateOneWorkspace:h.mutateOneWorkspace,delOneProject:h.delOneProject}})}]},children:(0,s.jsx)(I.ZP,{icon:(0,s.jsx)(ed,{}),className:eP().noBorder})},"more")],children:(0,s.jsxs)("div",{className:eU().cardUsers,children:[(0,s.jsx)("div",{children:"Admin:"}),(0,s.jsx)("div",{}),(0,s.jsx)("div",{children:"Shared with:"}),(0,s.jsx)($.C.Group,{maxCount:5,children:v}),(0,s.jsx)(W.Z,{type:"vertical",className:eU().cardDivider}),(0,s.jsxs)($.C.Group,{children:[j,y]})]})},m.id)};var eD=e=>{let{user:a,page:t,workspace:r,projects:n,organizations:l,filter:o,sorter:d,swr:c}=e,u=(0,i.useRef)(null),[m,p]=(0,i.useState)(!0),[h,g]=(0,i.useState)([]),[w,x]=(0,i.useState)(100),v=(0,i.useCallback)(()=>{let e=u.current;if(!e){setTimeout(()=>v(),100);return}let a=e.getBoundingClientRect().top,t=window.innerHeight-a;t!==w&&x(t)},[w]);return((0,i.useEffect)(()=>(window.addEventListener("resize",v),v(),()=>{window.removeEventListener("resize",v)}),[v]),(0,i.useEffect)(()=>{let e=n.map(e=>{var a,t;if(!o||(null===(t=e.title)||void 0===t?void 0:null===(a=t.toLowerCase())||void 0===a?void 0:a.includes(o.toLowerCase())))return e}).filter(e=>e);switch(d){case"alphaAsc":e.sort((e,a)=>e.title.localeCompare(a.title));break;case"alphaDesc":e.sort((e,a)=>-1*e.title.localeCompare(a.title));break;case"modifiedDesc":e.sort((e,a)=>new Date(a.lastaccess).getTime()-new Date(e.lastaccess).getTime())}g(e),p(!1)},[n,o,d]),m||c.loadingProjects)?(0,s.jsx)(T.Z.Simple,{}):h.length?(0,s.jsx)("div",{ref:u,style:{height:w},children:(0,s.jsx)(Y.Z,{style:{marginBottom:"20px"},wrap:!0,align:"start",size:20,children:h.map(e=>(0,s.jsx)(eq,{user:a,workspace:r,page:t,project:e,organizations:l,swr:c},e.id))})}):(0,s.jsx)(_.Z,{image:"images/empty.svg",className:eU().empty,description:o?(0,s.jsxs)(s.Fragment,{children:["No project found with the current search"," ",(0,s.jsx)("span",{className:eU().emptySearch,children:o}),"..."]}):(0,s.jsx)(s.Fragment,{children:"No project for now... Get started!"})})};let eL={update:"Unable to update workspace"},eW=async(e,a,t)=>{let s=e_.Z.deepCopy(e);e.name=a.name,await G.Z.update({id:e.id},[{key:"name",value:a.name}]),await t.mutateOneWorkspace(s)};var eM=e=>{let{workspace:a,swr:t}=e,r=(0,i.useRef)(null),[n,l]=(0,i.useState)(!1),[o,d]=(0,i.useState)(!1),{dispatch:c}=(0,i.useContext)(C.uj);(0,i.useEffect)(()=>{r.current&&r.current.focus()});let u=(0,i.useCallback)(()=>l(!0),[]),m=(0,i.useCallback)(()=>l(!1),[]),p=(0,i.useCallback)(async e=>{d(!0);try{await eW(a,e,t),d(!1),l(!1)}catch(e){throw c((0,O.iT)({title:eL.update,err:e})),d(!1),e}},[a,t,c]);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(B.w6,{bordered:!0,dark:!0,onEdit:u}),(0,s.jsx)(L.ZP,{visible:n,loading:o,title:"Edit the workspace",initialValues:{name:a.name},onCancel:m,onOk:p,children:(0,s.jsx)(P.Z.Item,{label:"Name",name:"name",rules:[{required:!0,message:"Name is required"},{max:50,message:"Max 50 characters"}],children:(0,s.jsx)(E.Z,{ref:r,placeholder:"Workspace's name"})})})]})};let eH={del:"Unable to delete workspace"},eF=async(e,a)=>{await G.Z.del({id:e.id}),await a.delOneWorkspace({id:e.id})};var eG=e=>{let{workspace:a,swr:t}=e,[n,l]=(0,i.useState)(!1),{dispatch:o}=(0,i.useContext)(C.uj),d=(0,r.useRouter)(),c=(0,i.useCallback)(async()=>{l(!0);try{await eF(a,t),await d.push({pathname:"/dashboard",query:{page:"workspaces"}})}catch(e){throw o((0,O.iT)({title:eH.del,err:e})),e}finally{l(!1)}},[d,a,t,o]);return(0,s.jsx)(B.m1,{bordered:!0,loading:n,text:"The projects contained in this workspace will be lost.",onDelete:c})},eB=t(88357),eV=t.n(eB);let eJ={projects:"Error while loading projects"};var eK=e=>{var a,t,r,l,o,d;let{user:c,page:u,workspace:m,organizations:p,swr:h}=e,[g,w]=(0,i.useState)(),[x,v]=(0,i.useState)("alphaAsc"),{dispatch:j}=(0,i.useContext)(C.uj),[y,{addOneProject:f,delOneProject:b,mutateOneProject:k,errorProjects:Z,loadingProjects:z}]=ee.Z.useProjects(null==m?void 0:m.projects);(0,i.useEffect)(()=>{Z&&j((0,O.iT)({title:eJ.projects,err:Z}))},[Z,j]);let S=(0,i.useCallback)(e=>w(e.target.value),[]);return(0,s.jsxs)(n.Z,{className:eP().noScroll,children:[(0,s.jsx)(F,{footer:(0,s.jsxs)(Y.Z,{direction:"horizontal",size:"large",className:"".concat(eV().search," ").concat(eP().fullWidth),children:[(0,s.jsx)(E.Z,{placeholder:"Enter a project name (case sensitive)",value:g,onChange:S,style:{width:500},suffix:(0,s.jsx)(X.Z,{className:eP().textLight})}),(null==m?void 0:null===(a=m.owners)||void 0===a?void 0:a.find(e=>e.id===c.id))?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(es,{workspace:{id:m.id,projects:m.projects},swr:{mutateOneWorkspace:h.mutateOneWorkspace,addOneProject:f}}),(0,s.jsxs)(Y.Z,{size:8,children:[(0,s.jsx)(eM,{workspace:{id:m.id,name:m.name},swr:{mutateOneWorkspace:h.mutateOneWorkspace}}),(0,s.jsx)(Q.ZP,{workspace:{id:m.id,name:m.name,groups:m.groups,users:m.users},organizations:p,swr:{mutateOneWorkspace:h.mutateOneWorkspace},style:{buttonDark:!0,buttonBordered:!0}}),(0,s.jsx)(eG,{workspace:{id:m.id},swr:{delOneWorkspace:h.delOneWorkspace}})]})]}):(0,s.jsx)("div",{})]}),children:(null===(t=m.users)||void 0===t?void 0:t.length)||(null===(r=m.groups)||void 0===r?void 0:r.length)?(0,s.jsxs)("div",{className:eV().shared,children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{style:{marginRight:"10px"},children:"Admin:"}),(0,s.jsx)($.C.Group,{maxCount:5,children:null===(l=m.owners)||void 0===l?void 0:l.map(e=>e_.Z.userToAvatar(e))})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{style:{marginRight:"10px"},children:"Shared with:"}),(0,s.jsx)($.C.Group,{maxCount:5,children:null===(o=m.users)||void 0===o?void 0:o.map(e=>e_.Z.userToAvatar(e))}),(0,s.jsx)($.C.Group,{maxCount:5,children:null===(d=m.groups)||void 0===d?void 0:d.map(e=>e_.Z.groupToAvatar(e))})]})]}):void 0}),(0,s.jsx)(N.Z,{className:eV().tabs,items:[{key:"modifiedDesc",label:"Last modified"},{key:"alphaAsc",label:"Name (A-Z)"},{key:"alphaDesc",label:"Name (Z-A)"}],activeKey:x,onChange:v}),(0,s.jsx)(n.Z.Content,{className:eP().scroll,children:(0,s.jsx)(eD,{user:c,page:u,workspace:{id:m.id,projects:m.projects},projects:y,organizations:p,filter:g,sorter:x,swr:{addOneProject:f,mutateOneWorkspace:h.mutateOneWorkspace,delOneProject:b,mutateOneProject:k,loadingProjects:z}})})]})},eY=t(75435),e$=t(72796),eX=t(57632),eQ=t(18841),e0=t(68115),e1=t(92951),e2=t(48764).lW;let e3={addWorkspace:"Unable to add workspace",addProject:"Unable to add project",addGeometry:"Unable to add geometry"},e4=async e=>await G.Z.add(e),e6=async(e,a)=>await ee.Z.add({id:e.id},a),e5=async()=>{let e=await fetch("/doc/cube.stp"),a=await e.blob(),t=new FileReader;return new Promise(e=>{t.addEventListener("load",()=>{e(t.result)}),t.readAsArrayBuffer(a)})},e8=async e=>{let a=await e5();return await e0.Z.add({id:e.id},{name:"cube.stp",uid:(0,eX.Z)(),buffer:e2.from(a)})},e7=async(e,a,t)=>{var s,r,i,n;let l=eQ.Z.find(e=>"poisson"===e.algorithm);l.configuration.geometry.children=[{...l.configuration.geometry.children[0],value:t.id}],l.configuration.geometry.done=!0,l.configuration.parameters.done=!0,l.configuration.boundaryConditions.dirichlet.values=[{uuid:"0",name:"Boundary 0",type:{key:"dirichlet",label:"Dirichlet",children:[{label:"u",htmlEntity:"formula",default:"0"}]},geometry:t.id,selected:[{label:2,uuid:null===(r=t.summary.faces)||void 0===r?void 0:null===(s=r.find(e=>2===e.label))||void 0===s?void 0:s.uuid}],values:[{checked:!0,value:0}]},{uuid:"1",name:"Boundary 1",type:{key:"dirichlet",label:"Dirichlet",children:[{label:"u",htmlEntity:"formula",default:"0"}]},geometry:t.id,selected:[{label:4,uuid:null===(n=t.summary.faces)||void 0===n?void 0:null===(i=n.find(e=>4===e.label))||void 0===i?void 0:i.uuid}],values:[{checked:!0,value:1}]}],l.configuration.boundaryConditions.done=!0;let o=e.plugins.find(e=>"local"===e.key);return l.configuration.run.cloudServer=o,await e1.Z.add({id:a.id},{name:l.name,scheme:l})};var e9=e=>{let{visible:a,setVisible:t,user:n,swr:l}=e,[o,d]=(0,i.useState)(!1),{dispatch:c}=(0,i.useContext)(C.uj),u=(0,r.useRouter)(),m=(0,i.useCallback)(()=>t(!1),[t]),p=(0,i.useCallback)(async()=>{d(!0);try{let e,a,t;try{e=await e4({name:"Example Workspace"})}catch(e){throw c((0,O.iT)({title:e3.addWorkspace,err:e})),e}try{a=await e6(e,{title:"Example Project",description:"This is an example project solving the Poisson's equation"})}catch(e){throw c((0,O.iT)({title:e3.addProject,err:e})),e}try{t=await e8(a)}catch(e){throw c((0,O.iT)({title:e3.addGeometry,err:e})),e}try{await e7(n,a,t)}catch(e){throw c((0,O.iT)({title:e3.addProject,err:e})),e}l.addOneWorkspace(e),d(!1),m(),await u.push({pathname:"/dashboard",query:{page:"workspaces",workspaceId:e.id}})}catch(e){throw d(!1),e}},[u,n,l,m,c]),h=(0,i.useCallback)(e=>(0,s.jsx)(eY.Z.Item,{children:e&&(0,s.jsxs)("div",{children:[(0,s.jsx)(e$.Z,{style:{margin:"0 10px"}}),e]})}),[]);return(0,s.jsx)(L.ZP,{visible:a,loading:o,title:"Sample workspace",onCancel:m,onOk:p,children:(0,s.jsxs)(s.Fragment,{children:["Create a new workspace with predefined configuration:",(0,s.jsx)(eY.Z,{dataSource:["","Cube geometry","Poisson's equation","0 & 1 dirichlet boundary conditions","Local computing server",""],renderItem:h}),"You just have to run the simulation!"]})})},ae=t(51946),aa=t.n(ae);let at={add:"Unable to add workspace"},as=async(e,a,t)=>{let s=await G.Z.add(a);await t.addOneWorkspace(s),await e.push({pathname:"/dashboard",query:{page:"workspaces",workspaceId:s.id}}).catch()};var ar=e=>{let{user:a,workspaces:t,organizations:l,swr:d}=e,c=(0,i.useRef)(null),[u,m]=(0,i.useState)(!1),[p,h]=(0,i.useState)(!1),[g,w]=(0,i.useState)(!1),{dispatch:x}=(0,i.useContext)(C.uj),v=(0,r.useRouter)(),{page:j,workspaceId:y}=v.query;(0,i.useEffect)(()=>{c.current&&c.current.focus()});let f=(0,i.useCallback)(()=>{m(!1)},[]),b=(0,i.useCallback)(()=>{w(!0)},[]),k=(0,i.useCallback)(e=>{(0,S.u)(async()=>{"add"===e?m(!0):"sample"===e?w(!0):await v.push({pathname:"/dashboard",query:{page:"workspaces",workspaceId:e}})})},[v]),Z=(0,i.useCallback)(async e=>{h(!0);try{await as(v,e,d),h(!1),m(!1)}catch(e){throw x((0,O.iT)({title:at.add,err:e})),h(!1),e}},[v,d,x]);return(0,s.jsxs)(n.Z,{className:"".concat(aa().inDashboard," ").concat(eP().noScroll),children:[(0,s.jsx)(F,{title:(0,s.jsx)(o.Z.Title,{level:2,style:{marginBottom:"0 !important"},children:"Workspaces"})}),(0,s.jsxs)(n.Z.Content,{className:eP().noScroll,children:[(0,s.jsx)(e9,{visible:g,setVisible:w,user:a,swr:{addOneWorkspace:d.addOneWorkspace}}),t.length?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(L.ZP,{visible:u,loading:p,title:"Create a new workspace",onCancel:f,onOk:Z,children:(0,s.jsx)(P.Z.Item,{label:"Name",name:"name",rules:[{required:!0,message:"Name is required"},{max:50,message:"Max 50 characters"}],children:(0,s.jsx)(E.Z,{ref:c,placeholder:"Workspace's name"})})}),(0,s.jsx)(N.Z,{type:"editable-card",hideAdd:!0,className:"".concat(eP().noScroll," ").concat(aa().inDashboardTabs," ").concat(eV().tabs),items:[...t.map(e=>({key:e.id,label:e.name,css:eP().noScroll,closable:!1,children:(0,s.jsx)(eK,{user:a,page:null!=j?j:sm.workspaces.key,workspace:{id:e.id,name:e.name,projects:e.projects,owners:e.owners,users:e.users,groups:e.groups},organizations:l,swr:{delOneWorkspace:d.delOneWorkspace,mutateOneWorkspace:d.mutateOneWorkspace}})})),{key:"add",label:(0,s.jsx)(A.Z,{title:"New workspace",children:(0,s.jsx)(U.Z,{})}),closable:!1},{key:"sample",label:(0,s.jsx)(A.Z,{title:"Sample workspace",children:(0,s.jsx)(q,{})}),closable:!1}],defaultActiveKey:"1",activeKey:y,onChange:k})]}):(0,s.jsxs)(_.Z,{className:eV().empty,image:"images/empty.svg",description:"No workspace for now. Get started !",children:[(0,s.jsx)(K,{swr:{addOneWorkspace:d.addOneWorkspace}}),(0,s.jsx)(I.ZP,{type:"primary",icon:(0,s.jsx)(D.Z,{}),onClick:b,children:"Create a sample workspace"})]})]})]})},ai={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M858.5 763.6a374 374 0 00-80.6-119.5 375.63 375.63 0 00-119.5-80.6c-.4-.2-.8-.3-1.2-.5C719.5 518 760 444.7 760 362c0-137-111-248-248-248S264 225 264 362c0 82.7 40.5 156 102.8 201.1-.4.2-.8.3-1.2.5-44.8 18.9-85 46-119.5 80.6a375.63 375.63 0 00-80.6 119.5A371.7 371.7 0 00136 901.8a8 8 0 008 8.2h60c4.4 0 7.9-3.5 8-7.8 2-77.2 33-149.5 87.8-204.3 56.7-56.7 132-87.9 212.2-87.9s155.5 31.2 212.2 87.9C779 752.7 810 825 812 902.2c.1 4.4 3.6 7.8 8 7.8h60a8 8 0 008-8.2c-1-47.8-10.9-94.3-29.5-138.2zM512 534c-45.9 0-89.1-17.9-121.6-50.4S340 407.9 340 362c0-45.9 17.9-89.1 50.4-121.6S466.1 190 512 190s89.1 17.9 121.6 50.4S684 316.1 684 362c0 45.9-17.9 89.1-50.4 121.6S557.9 534 512 534z"}}]},name:"user",theme:"outlined"},an=i.forwardRef(function(e,a){return i.createElement(u.Z,(0,d.Z)({},e,{ref:a,icon:ai}))}),al=t(92385),ao=t(52382),ad=t(69037),ac=t(30792),au=t(61950),am=t(28357),ap=t.n(am),ah=t(48764).lW;let ag={update:"Unable to update informations",upload:"Unable to upload image",badFormat:"Supported formats: jpg, png",badSize:"Image must be smaller than 5MB"},aw=(e,a)=>{let t="image/jpeg"===e.type||"image/png"===e.type;t||a(ag.badFormat);let s=e.size/1024/1024<1;return s||a(ag.badSize),t&&s},ax=async e=>{let a=new FileReader;return new Promise(t=>{a.addEventListener("load",()=>{t(a.result)}),a.readAsDataURL(e)})},av=async(e,a,t)=>{if("uploading"===a.file.status)return!0;if("done"!==a.file.status)return!1;{let s=await ax(a.file.originFileObj);return await au.Z.add({name:a.file.name,uid:a.file.uid,data:s}),await t.mutateUser({...e,avatar:ah.from(s)}),!1}},aj=async(e,a,t,s)=>{try{let r=[];if(e.email!==a.email&&r.push({key:"email",value:a.email}),e.firstname!==a.firstname&&r.push({key:"firstname",value:a.firstname}),e.lastname!==a.lastname&&r.push({key:"lastname",value:a.lastname}),!r.length)return;await ac.Z.update(r),await t.mutateUser({email:a.email,firstname:a.firstname,lastname:a.lastname}),r.find(e=>"email"===e.key)&&s("Changes saved","A validation email has been send to "+a.email)}catch(e){throw new ad.H({title:ag.update,err:e})}};var ay=e=>{var a,t;let{user:r,swr:n}=e,[l,o]=(0,i.useState)(!1),[d,c]=(0,i.useState)(!1),[u,m]=(0,i.useState)(),{dispatch:p}=(0,i.useContext)(C.uj),h=(0,i.useMemo)(()=>({labelCol:{span:4}}),[]),g=(0,i.useMemo)(()=>({wrapperCol:{offset:4}}),[]),w=(0,i.useCallback)(e=>aw(e,e=>p((0,O.iT)({title:e}))),[p]),x=(0,i.useCallback)(e=>{(0,S.u)(async()=>{try{let a=await av(r,e,n);o(a)}catch(e){p((0,O.iT)({title:ag.upload,err:e})),o(!1)}})},[r,n,p]),v=(0,i.useCallback)(e=>{(0,S.u)(async()=>{c(!0);try{await aj(r,e,n,(e,a)=>p((0,O.$E)({title:e,description:a}))),m(void 0)}catch(e){m(e)}finally{c(!1)}})},[r,n,p]);return(0,s.jsx)(er.Z,{title:"Contact Details",children:(0,s.jsxs)(Y.Z,{direction:"horizontal",className:ap().information,children:[(0,s.jsxs)("div",{className:ap().avatar,children:[(0,s.jsx)($.C,{size:128,src:r.avatar&&ah.from(r.avatar).toString(),icon:(0,s.jsx)(an,{})}),(0,s.jsx)(ex.Z,{action:"/api/noop",accept:".jpg,.png",showUploadList:!1,beforeUpload:w,onChange:x,children:(0,s.jsx)(I.ZP,{loading:l,icon:(0,s.jsx)(al.Z,{}),children:"Upload new"})})]}),(0,s.jsx)("div",{className:ap().form,children:(0,s.jsxs)(P.Z,{...h,style:{maxWidth:500},initialValues:{email:r.email,firstname:null!==(a=r.firstname)&&void 0!==a?a:"",lastname:null!==(t=r.lastname)&&void 0!==t?t:""},onFinish:v,children:[(0,s.jsx)(P.Z.Item,{label:"Email",name:"email",rules:[{max:50,message:"Max 50 characters"}],children:(0,s.jsx)(E.Z,{disabled:k()()})}),(0,s.jsx)(P.Z.Item,{label:"First name",name:"firstname",rules:[{max:50,message:"Max 50 characters"}],children:(0,s.jsx)(E.Z,{})}),(0,s.jsx)(P.Z.Item,{label:"Last name",name:"lastname",rules:[{max:50,message:"Max 50 characters"}],children:(0,s.jsx)(E.Z,{})}),(0,s.jsx)(ao.Xq,{error:u}),(0,s.jsx)(P.Z.Item,{...g,children:(0,s.jsx)(I.ZP,{loading:d,type:"primary",htmlType:"submit",children:"Save changes"})})]})})]})})},af=t(6280);let ab={check:"Unable to check password",update:"Unable to update password",passwordMismatch:"Password and confirmation mismatch",invalid:"Current password is not valid"},ak=async(e,a)=>{let t;try{t=await ac.Z.check({email:e.email,password:a.password})}catch(e){throw new ad.H({title:ab.check,err:e})}if(!t.valid)throw new ad.H({title:ab.invalid});try{await ac.Z.update([{type:"crypt",key:"password",value:a.newPassword}])}catch(e){throw new ad.H({title:ab.update,err:e})}};var aZ=e=>{let{user:a}=e,[t,r]=(0,i.useState)(!1),[n,l]=(0,i.useState)(),{dispatch:o}=(0,i.useContext)(C.uj),d=(0,i.useCallback)(e=>{(0,S.u)(async()=>{r(!0);try{await ak(a,e),l(void 0),o((0,O.$E)({title:"Your password has been changed successfully"}))}catch(e){l(e)}finally{r(!1)}})},[a,o]);return(0,s.jsx)(er.Z,{title:"Your Password",children:(0,s.jsxs)(P.Z,{labelCol:{offset:2},wrapperCol:{offset:2},style:{maxWidth:500},layout:"vertical",onFinish:d,name:"passwordForm",children:[(0,s.jsx)(P.Z.Item,{label:"Current password",name:"password",rules:[{required:!0,message:"Current password is required"}],children:(0,s.jsx)(E.Z.Password,{placeholder:"Current password"})}),(0,s.jsx)(af.o,{name:"newPassword",label:"New password",inputPlaceholder:"Enter a new password",required:!0}),(0,s.jsx)(P.Z.Item,{label:"Password confirmation",name:"passwordConfirm",rules:[{required:!0,message:"Password confirmation is required"},e=>{let{getFieldValue:a}=e;return{validator:(e,t)=>t&&a("newPassword")!==t?Promise.reject(ab.passwordMismatch):Promise.resolve()}}],children:(0,s.jsx)(E.Z.Password,{placeholder:"Confirm your new password"})}),(0,s.jsx)(ao.Xq,{error:n}),(0,s.jsx)(P.Z.Item,{children:(0,s.jsx)(Y.Z,{children:(0,s.jsx)(I.ZP,{type:"primary",htmlType:"submit",loading:t,children:"Modify password"})})})]})})};let aC=k()()?"http://localhost:3000":"",aO=async()=>{await fetch(aC+"/api/logout")},az={del:"Unable to delete user"},aS=async e=>{await ac.Z.del(),await aO(),await e.clearUser()};var aT=e=>{let{swr:a}=e,[t,r]=(0,i.useState)(!1),{dispatch:n}=(0,i.useContext)(C.uj),l=(0,i.useCallback)(async()=>{r(!0);try{await aS(a)}catch(e){throw n((0,O.iT)({title:az.del,err:e})),e}finally{r(!1)}},[a,n]);return(0,s.jsx)(er.Z,{title:"Delete your account",children:(0,s.jsx)(B.m1,{title:"Delete your account",text:"This action cannot be undone. If you delete your account, you will permanently lose your workspaces and projects.",bordered:!0,loading:t,onDelete:l,children:"Delete your account"})})},aP=t(47945),aE=t(81855),aN=t(78554),aA=t(35386),a_=t(47311);let aI={update:"Unable to update plugins"},aU=(e,a,t)=>{var r;return(0,s.jsx)(P.Z.Item,{name:a,label:e.label,htmlFor:"input-"+a,tooltip:e.tooltip,rules:e.rules,children:(0,s.jsx)(E.Z,{ref:t,id:"input-"+a,autoComplete:"off",...null!==(r=e.props)&&void 0!==r?r:{}})},a)},aR=(e,a)=>{var t;return(0,s.jsx)(P.Z.Item,{name:a,label:e.label,htmlFor:"input-"+a,tooltip:e.tooltip,rules:e.rules,children:(0,s.jsx)(E.Z.TextArea,{id:"input-"+a,autoComplete:"off",...null!==(t=e.props)&&void 0!==t?t:{}})},a)},aq=(e,a)=>{var t;return(0,s.jsx)(P.Z.Item,{name:a,label:e.label,htmlFor:"input-"+a,tooltip:e.tooltip,rules:e.rules,children:(0,s.jsx)(E.Z,{id:"input-"+a,type:"password",autoComplete:"off",...null!==(t=e.props)&&void 0!==t?t:{}})},a)},aD=(e,a)=>{var t;return(0,s.jsx)(P.Z.Item,{name:a,label:e.label,htmlFor:"select-"+a,tooltip:e.tooltip,rules:e.rules,children:(0,s.jsx)(aA.Z,{id:"select-"+a,children:null===(t=e.options)||void 0===t?void 0:t.map(a=>{var t;return(0,s.jsx)(aA.Z.Option,{value:a,...null!==(t=e.props)&&void 0!==t?t:{},children:a},a)})})},a)},aL=async(e,a,t,s)=>{var r,i;if(a){let a=e_.Z.deepCopy(e);Object.keys(t).forEach(e=>{a.configuration[e].value=t[e]}),a.needReInit=!0,await aN.Z.update(a),await (null===(r=s.mutateOnePlugin)||void 0===r?void 0:r.call(s,a))}else{let a=e_.Z.deepCopy(e);a.uuid="add",Object.keys(t).forEach(e=>{a.configuration[e].value=t[e]}),await aN.Z.add(a),await (null===(i=s.addOnePlugin)||void 0===i?void 0:i.call(s,a))}};var aW=e=>{var a;let{plugin:t,swr:r,edit:n}=e,l=(0,i.useRef)(null),[d,c]=(0,i.useState)(!1),[u,m]=(0,i.useState)(!1),{dispatch:p}=(0,i.useContext)(C.uj),h=(0,i.useMemo)(()=>Object.keys(t.configuration).map((e,a)=>{let r=t.configuration[e];return"input"===r.type?aU(r,e,0===a?l:void 0):"textarea"===r.type?aR(r,e):"password"===r.type?aq(r,e):"select"===r.type?aD(r,e):(0,s.jsx)("div",{},e)}),[t.configuration]),g=(0,i.useMemo)(()=>{let e={};return Object.keys(t.configuration).forEach(a=>{var s;e[a]=null!==(s=t.configuration[a].value)&&void 0!==s?s:t.configuration[a].default}),e},[null==t?void 0:t.configuration]);(0,i.useEffect)(()=>{l.current&&l.current.focus()});let w=(0,i.useCallback)(()=>{c(!0)},[]),x=(0,i.useCallback)(()=>{c(!1)},[]),v=(0,i.useCallback)(async e=>{m(!0);try{await aL(t,!!n,e,r),m(!1),c(!1)}catch(e){throw p((0,O.iT)({title:aI.update,err:e})),m(!1),e}},[t,r,n,p]);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(L.ZP,{title:t.name,visible:d,initialValues:g,onCancel:x,onOk:v,loading:u,children:(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(o.Z.Text,{children:(0,a_.ZP)(null!==(a=t.description)&&void 0!==a?a:"")}),h]})}),n?(0,s.jsx)(B.w6,{onEdit:w,children:"Edit"}):(0,s.jsx)(B.HS,{onAdd:w,children:(0,s.jsxs)(s.Fragment,{children:["Add a new \xab",t.name,"\xbb configuration"]})})]})};let aM={del:"Unable to delete plugin"},aH=async(e,a)=>{await aN.Z.del({uuid:e.uuid}),await a.delOnePlugin(e)};var aF=e=>{var a;let{plugin:t,swr:r}=e,[n,l]=(0,i.useState)(!1),{dispatch:d}=(0,i.useContext)(C.uj),c=(0,i.useCallback)(async()=>{l(!0);try{await aH(t,r)}catch(e){throw d((0,O.iT)({title:aM.del,err:e})),e}finally{l(!1)}},[t,r,d]);return(0,s.jsx)(B.m1,{loading:n,title:"Delete plugin",text:(0,s.jsxs)(s.Fragment,{children:["Are you sure you want to delete the plugin"," ",(0,s.jsx)(o.Z.Text,{strong:!0,children:null===(a=t.configuration.name)||void 0===a?void 0:a.value}),"?"]}),onDelete:c,children:"Delete"})},aG={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M909.1 209.3l-56.4 44.1C775.8 155.1 656.2 92 521.9 92 290 92 102.3 279.5 102 511.5 101.7 743.7 289.8 932 521.9 932c181.3 0 335.8-115 394.6-276.1 1.5-4.2-.7-8.9-4.9-10.3l-56.7-19.5a8 8 0 00-10.1 4.8c-1.8 5-3.8 10-5.9 14.9-17.3 41-42.1 77.8-73.7 109.4A344.77 344.77 0 01655.9 829c-42.3 17.9-87.4 27-133.8 27-46.5 0-91.5-9.1-133.8-27A341.5 341.5 0 01279 755.2a342.16 342.16 0 01-73.7-109.4c-17.9-42.4-27-87.4-27-133.9s9.1-91.5 27-133.9c17.3-41 42.1-77.8 73.7-109.4 31.6-31.6 68.4-56.4 109.3-73.8 42.3-17.9 87.4-27 133.8-27 46.5 0 91.5 9.1 133.8 27a341.5 341.5 0 01109.3 73.8c9.9 9.9 19.2 20.4 27.8 31.4l-60.2 47a8 8 0 003 14.1l175.6 43c5 1.2 9.9-2.6 9.9-7.7l.8-180.9c-.1-6.6-7.8-10.3-13-6.2z"}}]},name:"reload",theme:"outlined"},aB=i.forwardRef(function(e,a){return i.createElement(u.Z,(0,d.Z)({},e,{ref:a,icon:aG}))});let aV={refresh:"Unable to refresh plugin"},aJ=async e=>{let a=e_.Z.deepCopy(e);a.needReInit=!0,await aN.Z.update(a)};var aK=e=>{let{plugin:a}=e,[t,r]=(0,i.useState)(!1),{dispatch:n}=(0,i.useContext)(C.uj),l=(0,i.useCallback)(()=>{(0,S.u)(async()=>{r(!0);try{await aJ(a)}catch(e){n((0,O.iT)({title:aV.refresh,err:e}))}finally{r(!1)}})},[a,n]);return(0,s.jsx)(I.ZP,{loading:t,icon:(0,s.jsx)(aB,{}),onClick:l,className:"".concat(eP().noBackground," ").concat(eP().noBorder),children:"Refresh"},"refresh")},aY=e=>{let{plugin:a,plugins:t,swr:r}=e,n=(0,i.useMemo)(()=>t.map(e=>{var t,i;if(e.key!==a.key)return;let n=e.configuration,l=Object.keys(n).map(e=>{let a;if("name"!==e){if("textarea"===n[e].type){let t=n[e].value;a=(0,s.jsx)(o.Z.Paragraph,{children:(0,s.jsx)("pre",{children:(0,s.jsx)("code",{children:t})})})}else if("password"===n[e].type)a=(0,s.jsx)(o.Z.Text,{children:"******"});else{var t;a=(0,s.jsx)(o.Z.Text,{children:null!==(t=n[e].value)&&void 0!==t?t:"unset"})}return(0,s.jsxs)(o.Z.Paragraph,{children:[(0,s.jsxs)(o.Z.Text,{strong:!0,children:[n[e].label,":"]})," ",a]},e)}}).filter(e=>e),d=[];return d.push((0,s.jsx)(aF,{plugin:{key:e.key,uuid:e.uuid,configuration:e.configuration},swr:{delOnePlugin:r.delOnePlugin}},"delete")),e.haveInit&&d.push((0,s.jsx)(aK,{plugin:e})),d.push((0,s.jsx)(aW,{plugin:e,swr:{mutateOnePlugin:r.mutateOnePlugin},edit:!0},"plugin")),(0,s.jsx)(er.Z,{title:null===(t=n.name)||void 0===t?void 0:t.value,actions:d,children:(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(o.Z.Text,{children:(0,a_.ZP)(null!==(i=e.description)&&void 0!==i?i:"")}),l.length?l:(0,s.jsx)(o.Z.Text,{children:"No configuration data"})]})},e.uuid)}).filter(e=>e),[a,t,r]);return(0,s.jsx)(Y.Z,{direction:"horizontal",wrap:!0,size:20,children:n})};let a$={plugins:"Error while loading plugins"};var aX=e=>{let{plugin:a}=e,[t,{addOnePlugin:r,delOnePlugin:n,mutateOnePlugin:l,errorPlugins:o,loadingPlugins:d}]=aN.Z.usePlugins(),{dispatch:c}=(0,i.useContext)(C.uj);return((0,i.useEffect)(()=>{o&&c((0,O.iT)({title:a$.plugins,err:o}))},[o,c]),d)?(0,s.jsx)(aP.Z,{}):(0,s.jsxs)(Y.Z,{direction:"vertical",className:eP().fullWidth,children:[(0,s.jsx)(aW,{plugin:a,swr:{addOnePlugin:r}}),(0,s.jsx)(aY,{plugin:{key:a.key},plugins:t,swr:{delOnePlugin:n,mutateOnePlugin:l}})]})};let aQ={plugins:"Unable to load plugins"},a0=async()=>{let e=(await aE.Z.list()).filter(e=>"HPC"===e.category);return e.length?e.map(e=>(0,s.jsx)(er.Z,{title:e.name,children:(0,s.jsx)(aX,{plugin:e})},e.key)):(0,s.jsx)(er.Z,{title:"No access",children:"You do not have access to any HPC plugin. Request it."})};var a1=()=>{let e=(0,i.useRef)(null),[a,t]=(0,i.useState)([(0,s.jsx)(er.Z,{title:"Loading",children:(0,s.jsx)(aP.Z,{})},"loading")]),[r,n]=(0,i.useState)(100),{dispatch:l}=(0,i.useContext)(C.uj),o=(0,i.useCallback)(()=>{let a=e.current;if(!a){setTimeout(()=>o(),100);return}let t=a.getBoundingClientRect().top,s=window.innerHeight-t;s!==r&&n(s)},[r]);return(0,i.useEffect)(()=>{(0,S.u)(async()=>{try{let e=await a0();t(e)}catch(e){l((0,O.iT)({title:aQ.plugins,err:e})),t((0,s.jsx)(er.Z,{title:"Error",children:"Something leads to an error. Please try again later."},"error"))}})},[l]),(0,i.useEffect)(()=>(window.addEventListener("resize",o),o(),()=>{window.removeEventListener("resize",o)}),[o]),(0,s.jsx)(Y.Z,{ref:e,direction:"vertical",className:"".concat(eP().fullWidth," ").concat(eP().scroll),size:20,style:{height:r-20},children:a})},a2=e=>{let{user:a,swr:t}=e,l=(0,r.useRouter)(),{tab:d}=l.query,c=(0,i.useMemo)(()=>[{key:"personal",label:"Personal Information",children:(0,s.jsxs)(Y.Z,{direction:"vertical",className:eP().fullWidth,size:20,children:[(0,s.jsx)(ay,{user:{email:a.email,firstname:a.firstname,lastname:a.lastname,avatar:a.avatar},swr:{mutateUser:t.mutateUser}}),!k()()&&(0,s.jsx)(aT,{swr:{clearUser:t.clearUser}})]})},k()()?null:{key:"security",label:"Security",children:(0,s.jsx)(Y.Z,{direction:"vertical",className:eP().fullWidth,size:20,children:(0,s.jsx)(aZ,{user:{email:a.email}})})},{key:"hpc",label:"HPC Providers",children:(0,s.jsx)(a1,{})}].filter(e=>e),[a,t]),u=(0,i.useCallback)(e=>{(0,S.u)(async()=>{await l.replace({pathname:"/dashboard",query:{page:"account",tab:e}})})},[l]);return(0,s.jsxs)(n.Z,{className:"".concat(eP().noScroll," ").concat(aa().inDashboard),children:[(0,s.jsx)(F,{title:(0,s.jsx)(o.Z.Title,{level:2,style:{marginBottom:"0 !important"},children:"Account Settings"})}),(0,s.jsx)(n.Z.Content,{className:eP().noScroll,children:(0,s.jsx)(N.Z,{className:"".concat(eP().noScroll," ").concat(aa().inDashboardTabs),type:"card",items:c,defaultActiveKey:null!=d?d:"personal",onChange:u})})]})},a3=t(72583),a4=t(69808),a6=t(35705);let a5={add:"Unable to add user",existing:"This user already exists or its invite is pending"},a8=(e,a)=>{var t,s,r,i,n,l;let o=null===(t=a.owners)||void 0===t?void 0:t.find(a=>a.email===e.email),d=null===(s=a.pendingowners)||void 0===s?void 0:s.find(a=>a.email===e.email),c=null===(r=a.users)||void 0===r?void 0:r.find(a=>a.email===e.email),u=null===(i=a.pendingusers)||void 0===i?void 0:i.find(a=>a.email===e.email);return null!==(l=null!==(n=null!=o?o:d)&&void 0!==n?n:c)&&void 0!==l?l:u},a7=async(e,a,t,s)=>{if(a8(t,e))throw Error(a5.existing);try{await a4.Z.update(e,[{key:a,type:"array",method:"append",value:t.email.trim()}]);let r=e_.Z.deepCopy(e);r[a]=[...r[a],{email:t.email}],await s.mutateOneOrganization(r)}catch(e){throw Error(a5.add)}};var a9=e=>{let{title:a,organization:t,dBkey:r,swr:n}=e,l=(0,i.useRef)(null),[o,d]=(0,i.useState)(!1),[c,u]=(0,i.useState)(!1),{dispatch:m}=(0,i.useContext)(C.uj);(0,i.useEffect)(()=>{l.current&&l.current.focus()});let p=(0,i.useCallback)(()=>d(!0),[]),h=(0,i.useCallback)(()=>d(!1),[]),g=(0,i.useCallback)(async e=>{u(!0);try{await a7(t,r,e,n),u(!1),d(!1)}catch(e){throw m((0,O.iT)({title:e.message,err:e})),u(!1),e}},[t,r,n,m]);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(L.ZP,{visible:o,loading:c,title:a,onCancel:h,onOk:g,children:(0,s.jsx)(P.Z.Item,{name:"email",label:"Email",rules:[{required:!0,message:"Email is required"}],children:(0,s.jsx)(E.Z,{ref:l})})}),(0,s.jsx)(B.HS,{onAdd:p,children:a})]})};let te={del:"Unable to delete user"},ta=async(e,a,t,s)=>{await a4.Z.update(a,[{key:t,type:"array",method:"remove",value:e.id}]);let r=e_.Z.deepCopy(a);r[t]=r[t].filter(a=>a.id!==e.id),await s.mutateOneOrganization(r)};var tt=e=>{let{disabled:a,user:t,organization:r,dBkey:n,swr:l}=e,[d,c]=(0,i.useState)(!1),{dispatch:u}=(0,i.useContext)(C.uj),m=(0,i.useCallback)(e=>e.firstname||e.lastname?e.firstname+" "+e.lastname:e.email,[]),p=(0,i.useCallback)(async()=>{c(!0);try{await ta(t,r,n,l)}catch(e){throw u((0,O.iT)({title:te.del,err:e})),e}finally{c(!1)}},[t,r,n,l,u]);return(0,s.jsx)(B.m1,{bordered:!0,disabled:a,title:"Delete organization",text:(0,s.jsxs)(s.Fragment,{children:["Are you sure you want to delete the user"," ",(0,s.jsx)(o.Z.Text,{strong:!0,children:m(t)}),"?"]}),loading:d,onDelete:p})},ts=e=>{let{organization:a,swr:t}=e,[r,n]=(0,i.useState)(),[l,o]=(0,i.useState)(),d=(0,i.useRef)(null),c=(0,i.useRef)(null),u=(0,i.useRef)(null),m=(0,i.useCallback)((e,a)=>e_.Z.userToAvatar(a),[]),p=(0,i.useCallback)(e=>(0,s.jsx)($.C.Group,{maxCount:5,children:null==e?void 0:e.map(e=>e_.Z.workspaceToAvatar(e))}),[]),h=(0,i.useCallback)(e=>(0,s.jsx)($.C.Group,{maxCount:5,children:null==e?void 0:e.map(e=>e_.Z.projectToAvatar(e))}),[]),g=(0,i.useCallback)(e=>(0,s.jsx)($.C.Group,{maxCount:5,children:null==e?void 0:e.map(e=>e_.Z.usermodelToAvatar(e))}),[]),w=(0,i.useCallback)(e=>(0,s.jsx)(tt,{disabled:a.owners.length<2&&!e.pending,user:{id:e.id,email:e.email},organization:{id:a.id,owners:a.owners,pendingowners:a.pendingowners,users:a.users,pendingusers:a.pendingusers},dBkey:e.pending?"pendingowners":"owners",swr:{mutateOneOrganization:t.mutateOneOrganization}}),[a,t]),x=(0,i.useCallback)(e=>(0,s.jsx)(tt,{user:{id:e.id,email:e.email,firstname:e.firstname,lastname:e.lastname},organization:{id:a.id,owners:a.owners,pendingowners:a.pendingowners,users:a.users,pendingusers:a.pendingusers},dBkey:e.pending?"pendingusers":"users",swr:{mutateOneOrganization:t.mutateOneOrganization}}),[a,t]),v=(0,i.useMemo)(()=>[{key:"avatar",dataIndex:"avatar",align:"center",render:m},{key:"lastname",title:"Lastname",dataIndex:"lastname",align:"center"},{key:"firstname",title:"Firstname",dataIndex:"firstname",align:"center"},{key:"email",title:"Email",dataIndex:"email",align:"center"},{key:"workspaces",title:"Workspaces",dataIndex:"workspaces",align:"center",render:p},{key:"projects",title:"Projects",dataIndex:"projects",align:"center",render:h},{key:"usermodels",title:"User models",dataIndex:"usermodels",align:"center",render:g}],[m,p,h,g]),j=(0,i.useMemo)(()=>[...v,{key:"actions",title:"Actions",align:"center",fixed:"right",render:w}],[v,w]),y=(0,i.useMemo)(()=>[...v,{key:"actions",title:"Actions",align:"center",fixed:"right",render:x}],[v,x]),f=(0,i.useCallback)(()=>{let e=d.current;if(!e)return;let a=(e.clientHeight-15)/2-39-12-32-20-75,t=e.clientHeight,s=e.clientHeight;t>a?n({y:a}):n(void 0),s>a?o({y:a}):o(void 0)},[]);return(0,i.useEffect)(()=>(window.addEventListener("resize",f),()=>{window.removeEventListener("resize",f)}),[f]),(0,i.useEffect)(()=>{f()},[a,f]),(0,s.jsx)("div",{ref:d,style:{height:"calc(100vh - 228px)"},children:(0,s.jsxs)(Y.Z,{direction:"vertical",className:eP().fullWidth,size:20,children:[(0,s.jsx)(er.Z,{title:"Administrators",size:"small",children:(0,s.jsxs)(Y.Z,{direction:"vertical",className:eP().fullWidth,size:20,children:[(0,s.jsx)(a9,{title:"New administrator",organization:{id:a.id,owners:a.owners,pendingowners:a.pendingowners,pendingusers:a.pendingusers,users:a.users},dBkey:"owners",swr:{mutateOneOrganization:t.mutateOneOrganization}}),(0,s.jsx)(a6.Z,{loading:t.loadingOrganizations,pagination:!1,size:"small",columns:j,dataSource:[...a.owners.map(e=>({...e,key:e.id})),...a.pendingowners.map(e=>({...e,workspaces:[],projects:[],usermodels:[],pending:!0,key:e.id}))],scroll:{x:1200,y:null==r?void 0:r.y},ref:c})]})}),(0,s.jsx)(er.Z,{title:"Users",size:"small",children:(0,s.jsxs)(Y.Z,{direction:"vertical",className:eP().fullWidth,size:20,children:[(0,s.jsx)(a9,{title:"New user",organization:{id:a.id,owners:a.owners,pendingowners:a.pendingowners,pendingusers:a.pendingusers,users:a.users},dBkey:"users",swr:{mutateOneOrganization:t.mutateOneOrganization}}),(0,s.jsx)(a6.Z,{loading:null==t?void 0:t.loadingOrganizations,pagination:!1,size:"small",columns:y,dataSource:[...a.users.map(e=>({...e,key:e.id})),...a.pendingusers.map(e=>({...e,workspaces:[],projects:[],usermodels:[],pending:!0,key:e.id}))],scroll:{x:1200,y:null==l?void 0:l.y},ref:u})]})})]})})},tr=t(81758),ti=t(10914),tn={useGroups:e=>{var a;let{data:t,error:s,mutate:r}=(0,tr.ZP)("/api/groups/"+e,ti._),n=null!==(a=null==t?void 0:t.groups)&&void 0!==a?a:[],l=(0,i.useCallback)(async e=>{let a=[...n,e];await r({groups:a})},[n,r]),o=(0,i.useCallback)(async e=>{let a=n.filter(a=>a.id!==e.id);await r({groups:a})},[n,r]),d=(0,i.useCallback)(async e=>{let a=n.map(a=>(a.id===e.id&&(a={...a,...e}),a));await r({groups:a})},[n,r]);return[n,{addOneGroup:l,delOneGroup:o,mutateOneGroup:d,errorGroups:s,loadingGroups:!t}]},add:async(e,a)=>(await (0,ti.R)("/api/group",{method:"POST",body:JSON.stringify({organization:e,group:a})})).json(),update:async(e,a)=>{await (0,ti.R)("/api/group",{method:"PUT",body:JSON.stringify({group:e,data:a})})},del:async e=>{await (0,ti.R)("/api/group",{method:"DELETE",body:JSON.stringify(e)})}};let tl={del:"Unable to delete group"},to=async(e,a)=>{await tn.del({id:e.id}),await a.delOneGroup({id:e.id})};var td=e=>{let{group:a,swr:t}=e,[r,n]=(0,i.useState)(!1),{dispatch:l}=(0,i.useContext)(C.uj),d=(0,i.useCallback)(async()=>{n(!0);try{await to(a,t)}catch(e){throw l((0,O.iT)({title:tl.del,err:e})),e}finally{n(!1)}},[a,t,l]);return(0,s.jsx)(B.m1,{bordered:!0,title:"Delete group",text:(0,s.jsxs)(s.Fragment,{children:["Are you sure you want to delete the group"," ",(0,s.jsx)(o.Z.Text,{strong:!0,children:a.name}),"?"]}),loading:r,onDelete:d})};let tc={add:"Unable to add group",update:"Unable to update group"},tu=async(e,a,t)=>{let s=await tn.add({id:e.id},{name:a.name,users:a.users});await t.addOneGroup({...s,name:a.name,users:a.users}),await t.mutateOneOrganization({id:e.id,groups:[...e.groups,s]})},tm=async(e,a,t,s)=>{var r;let i=[];if(a.name!==t.name&&i.push({key:"name",value:t.name}),(null===(r=a.users)||void 0===r?void 0:r.map(e=>e.id).toString())!==t.users.toString()&&i.push({key:"users",value:t.users}),!i.length)return;await tn.update({id:a.id},i),await s.mutateOneGroup({...a,...t});let n=e.groups.findIndex(e=>e.id===a.id);await s.mutateOneOrganization({id:e.id,groups:[...e.groups.slice(0,n),a,...e.groups.slice(n+1)]})};var tp=e=>{var a;let{userOptions:t,organization:r,group:n,swr:l}=e,o=(0,i.useRef)(null),[d,c]=(0,i.useState)(!1),[u,m]=(0,i.useState)(!1),{dispatch:p}=(0,i.useContext)(C.uj);(0,i.useEffect)(()=>{o.current&&o.current.focus()});let h=(0,i.useCallback)(()=>c(!0),[]),g=(0,i.useCallback)(()=>c(!1),[]),w=(0,i.useCallback)(async e=>{m(!0);try{if(n)try{await tm(r,n,e,{mutateOneOrganization:l.mutateOneOrganization,mutateOneGroup:l.mutateOneGroup})}catch(e){throw p((0,O.iT)({title:tc.update,err:e})),e}else try{await tu(r,e,{mutateOneOrganization:l.mutateOneOrganization,addOneGroup:l.addOneGroup})}catch(e){throw p((0,O.iT)({title:tc.add,err:e})),e}m(!1),c(!1)}catch(e){throw m(!1),e}},[r,n,l,p]);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(L.ZP,{title:n?"Edit group":"New group",visible:d,initialValues:n&&{name:n.name,users:null===(a=n.users)||void 0===a?void 0:a.map(e=>e.id)},onCancel:g,onOk:w,loading:u,children:[(0,s.jsx)(P.Z.Item,{name:"name",label:"Name",rules:[{required:!0,message:"Name is requried"}],children:(0,s.jsx)(E.Z,{ref:o})}),(0,s.jsx)(P.Z.Item,{name:"users",label:"Users",rules:[{required:!0,message:"Users selection is required"}],children:(0,s.jsx)(aA.Z,{mode:"multiple",placeholder:"Select users",options:t})})]}),n?(0,s.jsx)(B.w6,{bordered:!0,onEdit:h,children:"Edit"}):(0,s.jsx)(B.HS,{onAdd:h,children:"New group"})]})};let th={groups:"Error while loading groups"};var tg=e=>{let{organization:a,swr:t}=e,r=(0,i.useRef)(null),[n,l]=(0,i.useState)(null),{dispatch:o}=(0,i.useContext)(C.uj),[d,{addOneGroup:c,mutateOneGroup:u,delOneGroup:m,errorGroups:p,loadingGroups:h}]=tn.useGroups(a.id),g=(0,i.useMemo)(()=>[...a.owners,...null==a?void 0:a.users].map(e=>({label:e.firstname||e.lastname?e.firstname+" "+e.lastname:e.email,value:e.id})),[a]);(0,i.useEffect)(()=>{p&&o((0,O.iT)({title:th.groups,err:p}))},[p,o]);let w=(0,i.useCallback)(e=>(0,s.jsx)($.C.Group,{maxCount:5,children:e.map(e=>e_.Z.userToAvatar(e))}),[]),x=(0,i.useCallback)(e=>(0,s.jsx)($.C.Group,{maxCount:5,children:e.map(e=>e_.Z.workspaceToAvatar(e))}),[]),v=(0,i.useCallback)(e=>(0,s.jsx)($.C.Group,{maxCount:5,children:e.map(e=>e_.Z.projectToAvatar(e))}),[]),j=(0,i.useCallback)(e=>(0,s.jsx)($.C.Group,{maxCount:5,children:e.map(e=>e_.Z.usermodelToAvatar(e))}),[]),y=(0,i.useCallback)((e,r)=>(0,s.jsxs)(Y.Z,{children:[(0,s.jsx)(tp,{userOptions:g,organization:{id:a.id,groups:a.groups},group:{id:r.id,name:r.name,users:r.users},swr:{mutateOneOrganization:t.mutateOneOrganization,mutateOneGroup:u}}),(0,s.jsx)(td,{group:{id:r.id,name:r.name},swr:{delOneGroup:m}})]}),[a,t,g,u,m]),f=(0,i.useMemo)(()=>[{title:"Group name",dataIndex:"name",key:"name",align:"center"},{title:"Users",dataIndex:"users",key:"users",align:"center",render:w},{title:"Workspaces",dataIndex:"workspaces",key:"workspaces",align:"center",render:x},{title:"Projects",dataIndex:"projects",key:"projects",align:"center",render:v},{title:"User models",dataIndex:"usermodels",key:"usermodels",align:"center",render:j},{title:"Actions",key:"actions",align:"center",fixed:"right",render:y}],[w,x,v,j,y]),b=(0,i.useCallback)(()=>{let e=r.current;e&&(e.clientHeight>window.innerHeight-e.offsetTop-59?l({y:window.innerHeight-e.offsetTop-59}):l(null))},[]);return(0,i.useEffect)(()=>(window.addEventListener("resize",b),()=>{window.removeEventListener("resize",b)}),[b]),(0,i.useEffect)(()=>{b()},[d,b]),(0,s.jsxs)(Y.Z,{direction:"vertical",className:eP().fullWidth,size:20,children:[(0,s.jsx)(tp,{userOptions:g,organization:{id:a.id,groups:a.groups},swr:{mutateOneOrganization:t.mutateOneOrganization,addOneGroup:c}}),(0,s.jsx)(a6.Z,{loading:h,pagination:!1,size:"small",columns:f,dataSource:d.map(e=>({key:e.id,...e})),scroll:{x:1200,y:null==n?void 0:n.y},ref:r})]})};let tw={name:"Unable to update organization's name"},tx=async(e,a,t)=>{await a4.Z.update(e,[{key:"name",value:a}]),await t.mutateOneOrganization({...e,name:a})};var tv=e=>{let{organization:a,swr:t,onClose:r}=e,{dispatch:n}=(0,i.useContext)(C.uj),l=(0,i.useCallback)(e=>{(0,S.u)(async()=>{try{await tx(a,e,{mutateOneOrganization:t.mutateOneOrganization})}catch(e){n((0,O.iT)({title:tw.name,err:e}))}})},[a,t,n]);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:eP().displayFlex,children:[(0,s.jsx)(I.ZP,{style:{marginRight:"20px"},icon:(0,s.jsx)(a3.Z,{}),onClick:r}),(0,s.jsx)(o.Z.Title,{level:3,editable:{onChange:l},children:a.name})]}),(0,s.jsx)(N.Z,{items:[{key:"users",label:"Users",children:(0,s.jsx)(ts,{organization:{id:a.id,owners:a.owners,pendingowners:a.pendingowners,users:a.users,pendingusers:a.pendingusers},swr:{mutateOneOrganization:t.mutateOneOrganization,loadingOrganizations:t.loadingOrganizations}})},{key:"groups",label:"Groups",children:(0,s.jsx)(tg,{organization:{id:a.id,owners:a.owners,users:a.users,groups:a.groups},swr:{mutateOneOrganization:t.mutateOneOrganization}})}]})]})};let tj={add:"Unable to add organization"},ty=async(e,a)=>{let t=await a4.Z.add({name:e.name});t.name=e.name,await a.addOneOrganization(t)};var tf=e=>{let{swr:a}=e,t=(0,i.useRef)(null),[r,n]=(0,i.useState)(!1),[l,o]=(0,i.useState)(!1),{dispatch:d}=(0,i.useContext)(C.uj);(0,i.useEffect)(()=>{t.current&&t.current.focus()});let c=(0,i.useCallback)(()=>n(!0),[]),u=(0,i.useCallback)(()=>n(!1),[]),m=(0,i.useCallback)(async e=>{o(!0);try{await ty(e,a),o(!1),n(!1)}catch(e){throw d((0,O.iT)({title:tj.add,err:e})),o(!1),e}},[a,d]);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(L.ZP,{title:"New organization",visible:r,onCancel:u,onOk:m,loading:l,children:(0,s.jsx)(P.Z.Item,{name:"name",label:"Name",rules:[{required:!0,message:"Name is required"}],children:(0,s.jsx)(E.Z,{ref:t})})}),(0,s.jsx)(B.HS,{onAdd:c,children:"New organization"})]})},tb={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M365.3 518.5l246 178c5.3 3.8 12.7 0 12.7-6.5v-46.9c0-10.2-4.9-19.9-13.2-25.9L465.4 512l145.4-105.2c8.3-6 13.2-15.6 13.2-25.9V334c0-6.5-7.4-10.3-12.7-6.5l-246 178a8.05 8.05 0 000 13z"}},{tag:"path",attrs:{d:"M880 112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V144c0-17.7-14.3-32-32-32zm-40 728H184V184h656v656z"}}]},name:"left-square",theme:"outlined"},tk=i.forwardRef(function(e,a){return i.createElement(u.Z,(0,d.Z)({},e,{ref:a,icon:tb}))}),tZ=t(51189),tC=t(72362);let tO={del:"Unable to delete organization"},tz=async(e,a)=>{await a4.Z.del({id:e.id}),await a.delOneOrganization({id:e.id})};var tS=e=>{let{organization:a,swr:t}=e,[r,n]=(0,i.useState)(!1),{dispatch:l}=(0,i.useContext)(C.uj),d=(0,i.useCallback)(async()=>{n(!0);try{await tz(a,t)}catch(e){throw l((0,O.iT)({title:tO.del,err:e})),e}finally{n(!1)}},[a,t,l]);return(0,s.jsx)(B.m1,{bordered:!0,title:"Delete organization",text:(0,s.jsxs)(s.Fragment,{children:["Are you sure you want to delete the organization"," ",(0,s.jsx)(o.Z.Text,{strong:!0,children:a.name}),"?"]}),onDelete:d,loading:r})};let tT={quit:"Unable to quit organization",accept:"Unable to accept invitation",decline:"Unable to decline invitation"},tP=async(e,a,t)=>{await a4.Z.quit({id:e.id});let s=e_.Z.deepCopy(e),r=s.users.findIndex(e=>e.id===a.id);s.users.splice(r,1),await t.mutateOneOrganization(s)},tE=async(e,a,t)=>{await a4.Z.accept(e);let s=e_.Z.deepCopy(e),r=s.pendingowners.findIndex(e=>e.id===a.id),i=s.pendingowners[r];if(-1!==r)s.pendingowners.splice(r,1),s.owners.push({...i,workspaces:[],projects:[],usermodels:[]});else{let e=s.pendingusers.findIndex(e=>e.id===a.id),t=s.pendingusers[e];s.pendingusers.splice(e,1),s.users.push({...t,workspaces:[],projects:[],usermodels:[]})}await t.mutateOneOrganization(s)},tN=async(e,a,t)=>{var s,r;await a4.Z.decline({id:e.id});let i=e_.Z.deepCopy(e),n=null===(s=i.pendingowners)||void 0===s?void 0:s.findIndex(e=>e.id===a.id);if(-1!==n)i.pendingowners.splice(n,1);else{let e=null===(r=i.pendingusers)||void 0===r?void 0:r.findIndex(e=>e.id===a.id);i.pendingusers.splice(e,1)}await t.mutateOneOrganization(i)},tA=e=>{let{organization:a,swr:t,setOrganization:r}=e,n=(0,i.useCallback)(()=>r(a),[a,r]);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(I.ZP,{icon:(0,s.jsx)(w.Z,{}),onClick:n,children:"Manage"}),(0,s.jsx)(tS,{organization:{id:a.id,name:a.name},swr:{delOneOrganization:t.delOneOrganization}})]})},t_=e=>{let{user:a,organization:t,swr:r,dispatch:n}=e,l=(0,i.useCallback)(()=>{(0,S.u)(async()=>{try{await tP({id:t.id,users:t.users},{id:a.id},{mutateOneOrganization:r.mutateOneOrganization})}catch(e){n((0,O.iT)({title:tT.quit,err:e}))}})},[a,t,r,n]);return(0,s.jsx)(I.ZP,{danger:!0,icon:(0,s.jsx)(tk,{}),onClick:l,children:"Quit"})},tI=e=>{let{user:a,organization:t,swr:r,dispatch:n}=e,l=(0,i.useCallback)(()=>{(0,S.u)(async()=>{try{await tE({id:t.id,owners:t.owners,pendingowners:t.pendingowners,users:t.users,pendingusers:t.pendingusers},{id:a.id},{mutateOneOrganization:r.mutateOneOrganization})}catch(e){n((0,O.iT)({title:tT.accept,err:e}))}})},[a,t,r,n]);return(0,s.jsx)(I.ZP,{type:"primary",icon:(0,s.jsx)(tZ.Z,{}),onClick:l,children:"Accept invitation"})},tU=e=>{let{user:a,organization:t,swr:r,dispatch:n}=e,l=(0,i.useCallback)(()=>{(0,S.u)(async()=>{try{await tN({id:t.id,pendingowners:t.pendingowners,pendingusers:t.pendingusers},{id:a.id},{mutateOneOrganization:r.mutateOneOrganization})}catch(e){n((0,O.iT)({title:tT.decline,err:e}))}})},[a,t,r,n]);return(0,s.jsx)(I.ZP,{danger:!0,icon:(0,s.jsx)(tC.Z,{}),onClick:l,children:"Decline"})};var tR=e=>{var a;let{user:t,organizations:r,swr:n,setOrganization:l}=e,[o,d]=(0,i.useState)(null),{dispatch:c}=(0,i.useContext)(C.uj),u=(0,i.useRef)(null),m=(0,i.useCallback)(e=>(0,s.jsx)($.C.Group,{maxCount:5,children:null==e?void 0:e.map(e=>e_.Z.userToAvatar(e))}),[]),p=(0,i.useCallback)(e=>(0,s.jsx)($.C.Group,{maxCount:5,children:null==e?void 0:e.map(e=>e_.Z.userToAvatar(e))}),[]),h=(0,i.useCallback)(e=>(0,s.jsx)($.C.Group,{maxCount:5,children:null==e?void 0:e.map(e=>e_.Z.groupToAvatar(e))}),[]),g=(0,i.useCallback)(e=>e.owners.find(e=>e.id===t.id)?(0,s.jsx)(Y.Z,{wrap:!0,children:(0,s.jsx)(tA,{organization:e,swr:{delOneOrganization:n.delOneOrganization},setOrganization:l})}):e.users.find(e=>e.id===t.id)?(0,s.jsx)(Y.Z,{wrap:!0,children:(0,s.jsx)(t_,{user:t,organization:e,swr:{mutateOneOrganization:n.mutateOneOrganization},dispatch:c})}):e.pendingowners.find(e=>e.id===t.id)||e.pendingusers.find(e=>e.id===t.id)?(0,s.jsxs)(Y.Z,{wrap:!0,children:[(0,s.jsx)(tI,{user:t,organization:e,swr:{mutateOneOrganization:n.mutateOneOrganization},dispatch:c}),(0,s.jsx)(tU,{user:t,organization:e,swr:{mutateOneOrganization:n.mutateOneOrganization},dispatch:c})]}):null,[t,n,l,c]),w=(0,i.useMemo)(()=>[{title:"Name",dataIndex:"name",key:"name",sorter:(e,a)=>{var t,s;let r=null!==(t=e.name)&&void 0!==t?t:"",i=null!==(s=a.name)&&void 0!==s?s:"";return r.localeCompare(i)}},{title:"Administrators",dataIndex:"owners",key:"owners",render:m},{title:"Users",dataIndex:"users",key:"users",render:p},{title:"Groups",dataIndex:"groups",key:"groups",render:h},{title:"Actions",key:"actions",render:g}],[m,p,h,g]),x=(0,i.useCallback)(()=>{let e=u.current;e&&(e.clientHeight>window.innerHeight-e.offsetTop-59?d({y:window.innerHeight-e.offsetTop-59}):d(null))},[]);return(0,i.useEffect)(()=>(window.addEventListener("resize",x),()=>{window.removeEventListener("resize",x)}),[x]),(0,i.useEffect)(()=>{x()},[r,x,null===(a=u.current)||void 0===a?void 0:a.offsetTop]),(0,s.jsx)(a6.Z,{loading:n.loadingOrganizations,pagination:!1,size:"small",columns:w,dataSource:null==r?void 0:r.map(e=>({key:e.id,id:e.id,name:e.name,owners:e.owners,pendingowners:e.pendingowners,users:e.users,pendingusers:e.pendingusers,groups:e.groups})),ref:u,scroll:{y:null==o?void 0:o.y}})},tq=e=>{let{user:a,organizations:t,swr:l}=e,[d,c]=(0,i.useState)(),u=(0,r.useRouter)(),{organizationId:m}=u.query;(0,i.useEffect)(()=>{m&&c(t.find(e=>e.id===m))},[m,t]),(0,i.useEffect)(()=>{if(d){let e=t.find(e=>e.id===d.id);JSON.stringify(e)!==JSON.stringify(d)&&c(e)}},[t,d]);let p=(0,i.useCallback)(()=>{(0,S.u)(async()=>{await u.push({pathname:"dashboard",query:{page:"organizations"}}),c(null)})},[u]),h=(0,i.useCallback)(e=>{(0,S.u)(async()=>{await u.push({pathname:"dashboard",query:{page:"organizations",organizationId:e.id}}),c(e)})},[u]);return(0,s.jsxs)(n.Z,{className:aa().inDashboard,children:[(0,s.jsx)(F,{title:(0,s.jsx)(o.Z.Title,{level:2,style:{marginBottom:"0 !important"},children:"Organizations"})}),(0,s.jsx)(n.Z.Content,{className:eP().noScroll,children:d?(0,s.jsx)(tv,{organization:{id:d.id,name:d.name,owners:d.owners,pendingowners:d.pendingowners,users:d.users,pendingusers:d.pendingusers,groups:d.groups},swr:{mutateOneOrganization:l.mutateOneOrganization,loadingOrganizations:l.loadingOrganizations},onClose:p}):(0,s.jsxs)(Y.Z,{direction:"vertical",className:eP().fullWidth,size:20,children:[(0,s.jsx)(tf,{swr:{addOneOrganization:l.addOneOrganization}}),(0,s.jsx)(tR,{user:{id:a.id},organizations:t,swr:{mutateOneOrganization:l.mutateOneOrganization,delOneOrganization:l.delOneOrganization,loadingOrganizations:l.loadingOrganizations},setOrganization:h})]})})]})},tD=t(27492),tL=t(33606),tW=t(40264),tM=i.forwardRef(function(e,a){return i.createElement(u.Z,(0,d.Z)({},e,{ref:a,icon:tW.Z}))}),tH=t(9569),tF=t(27509);let tG={add:"Unable to add user"},tB=async(e,a)=>{let t=await ac.Z.add({email:e.email,password:e.password});if(t.alreadyExists)throw Error("User already exists");await ac.Z.updateById(t.id,[{key:"firstname",value:e.firstname},{key:"lastname",value:e.lastname},{key:"authorizedplugins",value:e.authorizedplugins},{key:"superuser",value:!!e.superuser}]);let s={...t,email:e.email,firstname:e.firstname,lastname:e.firstname,superuser:e.superuser};await a.addOneUser(s)};var tV=e=>{let{plugins:a,swr:t}=e,r=(0,i.useRef)(null),[n,l]=(0,i.useState)(!1),[o,d]=(0,i.useState)(!1),{dispatch:c}=(0,i.useContext)(C.uj),[u]=tF.Z.useSystem();(0,i.useEffect)(()=>{r.current&&r.current.focus()});let m=(0,i.useCallback)(()=>l(!0),[]),p=(0,i.useCallback)(()=>l(!0),[]),h=(0,i.useCallback)(async e=>{d(!0);try{await tB(e,t),d(!1),l(!1)}catch(e){throw d(!1),c((0,O.iT)({title:tG.add,err:e})),e}},[t,c]);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(L.ZP,{title:"New user",visible:n,initialValues:u.defaultplugins&&{authorizedplugins:u.defaultplugins},onCancel:p,onOk:h,loading:o,children:[(0,s.jsx)(P.Z.Item,{name:"firstname",label:"First name",children:(0,s.jsx)(E.Z,{ref:r})}),(0,s.jsx)(P.Z.Item,{name:"lastname",label:"Last name",children:(0,s.jsx)(E.Z,{})}),(0,s.jsx)(P.Z.Item,{name:"email",label:"Email",rules:[{required:!0,message:"Email is required"}],children:(0,s.jsx)(E.Z,{})}),(0,s.jsx)(af.o,{name:"password"}),(0,s.jsx)(P.Z.Item,{name:"authorizedplugins",label:"Plugins",children:(0,s.jsx)(aA.Z,{mode:"multiple",options:a.map(e=>({label:e.name,value:e.key}))})}),(0,s.jsx)(P.Z.Item,{name:"superuser",label:"Administrator",valuePropName:"checked",children:(0,s.jsx)(tH.Z,{})})]}),(0,s.jsx)(B.HS,{onAdd:m,children:"New user"})]})};let tJ={update:"Unable to update user"},tK=async(e,a,t)=>{let s=Object.keys(a).map(t=>{let s=a[t];if(void 0!==s&&"******"!==s&&s!==e[t])return{key:t,value:s,type:"password"===t&&"crypt"}}).filter(e=>e);if(!s.length)return;await ac.Z.updateById(e.id,s),a.password="******";let r={...e,...a};await t.mutateOneUser(r)};var tY=e=>{let{plugins:a,user:t,swr:r}=e,n=(0,i.useRef)(null),[l,o]=(0,i.useState)(!1),[d,c]=(0,i.useState)(!1),{dispatch:u}=(0,i.useContext)(C.uj);(0,i.useEffect)(()=>{n.current&&n.current.focus()});let m=(0,i.useCallback)(()=>o(!0),[]),p=(0,i.useCallback)(()=>o(!1),[]),h=(0,i.useCallback)(async e=>{c(!0);try{await tK(t,e,r),c(!1),o(!1)}catch(e){throw c(!1),u((0,O.iT)({title:tJ.update,err:e})),e}},[t,r,u]);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(L.ZP,{title:"Edit user",visible:l,initialValues:{...t,password:"******",authorizedplugins:t.authorizedplugins},onCancel:p,onOk:h,loading:d,children:[(0,s.jsx)(P.Z.Item,{name:"firstname",label:"First name",children:(0,s.jsx)(E.Z,{ref:n})}),(0,s.jsx)(P.Z.Item,{name:"lastname",label:"Last name",children:(0,s.jsx)(E.Z,{})}),(0,s.jsx)(P.Z.Item,{name:"email",label:"Email",rules:[{required:!0,message:"Email is required"}],children:(0,s.jsx)(E.Z,{})}),(0,s.jsx)(af.o,{name:"password",edit:!0}),(0,s.jsx)(P.Z.Item,{name:"authorizedplugins",label:"Plugins",children:(0,s.jsx)(aA.Z,{mode:"multiple",options:a.map(e=>({label:e.name,value:e.key}))})}),(0,s.jsx)(P.Z.Item,{name:"superuser",label:"Administrator",valuePropName:"checked",children:(0,s.jsx)(tH.Z,{})})]}),(0,s.jsx)(B.w6,{bordered:!0,onEdit:m,children:"Edit"})]})};let t$={del:"Unable to delete user"},tX=async(e,a)=>{await ac.Z.delById(e.id),await a.delOneUser({id:e.id})};var tQ=e=>{let{user:a,swr:t}=e,[r,n]=(0,i.useState)(!1),{dispatch:l}=(0,i.useContext)(C.uj),d=(0,i.useCallback)(async()=>{n(!0);try{await tX(a,t)}catch(e){throw l((0,O.iT)({title:t$.del,err:e})),e}finally{n(!1)}},[a,t,l]);return(0,s.jsx)(B.m1,{loading:r,bordered:!0,text:(0,s.jsxs)(s.Fragment,{children:["Are you sure you want to delete the user"," ",(0,s.jsx)(o.Z.Text,{strong:!0,children:a.email}),"?"]}),title:"Delete user",onDelete:d})};let t0={plugins:"Unable to load plugins"};var t1=e=>{var a;let{users:t,swr:r}=e,n=(0,i.useRef)(null),[l,o]=(0,i.useState)(),[d,c]=(0,i.useState)(),{dispatch:u}=(0,i.useContext)(C.uj),m=(0,i.useCallback)(e=>{e.sort((e,a)=>e.localeCompare(a));let a=e.map(e=>{let a=null==l?void 0:l.find(a=>a.key===e);if(a)return(0,s.jsx)(tD.Z.Ribbon,{text:a.category,style:{marginTop:"-15px"},children:(0,s.jsx)(er.Z,{size:"small",children:a.name})},e)}),t=(0,s.jsx)(Y.Z,{direction:"vertical",children:a});return(0,s.jsx)(tL.Z,{content:t,children:(0,s.jsxs)(I.ZP,{children:[a.length," plugins"]})})},[l]),p=(0,i.useCallback)(e=>e?(0,s.jsx)(tM,{className:eP().textGreen}):null,[]),h=(0,i.useCallback)((e,a)=>{var t;return(0,s.jsxs)(Y.Z,{children:[(0,s.jsx)(tY,{plugins:null!==(t=null==l?void 0:l.map(e=>({key:e.key,name:e.name})))&&void 0!==t?t:[],user:{id:a.id,firstname:a.firstname,lastname:a.lastname,email:a.email,authorizedplugins:a.authorizedplugins,superuser:a.superuser},swr:{mutateOneUser:r.mutateOneUser}}),(0,s.jsx)(tQ,{user:{id:a.id,email:a.email},swr:{delOneUser:r.delOneUser}})]})},[l,r]),g=(0,i.useMemo)(()=>[{title:"First name",dataIndex:"firstname",key:"firstname",sorter:(e,a)=>{var t,s;let r=null!==(t=e.firstname)&&void 0!==t?t:"",i=null!==(s=a.firstname)&&void 0!==s?s:"";return r.localeCompare(i)}},{title:"Last name",dataIndex:"lastname",key:"lastname",sorter:(e,a)=>{var t,s;let r=null!==(t=e.lastname)&&void 0!==t?t:"",i=null!==(s=a.lastname)&&void 0!==s?s:"";return r.localeCompare(i)}},{title:"Email",dataIndex:"email",key:"email",sorter:(e,a)=>{let t=e.email,s=a.email;return t.localeCompare(s)}},{title:"Password",key:"password",render:()=>"******"},{title:"Plugins",dataIndex:"authorizedplugins",key:"authorizedplugins",render:m},{title:"Administrator",dataIndex:"superuser",key:"superuser",align:"center",render:p},{title:"Actions",key:"actions",render:h}],[m,p,h]),w=(0,i.useCallback)(()=>{let e=n.current;e&&(e.clientHeight>window.innerHeight-e.offsetTop-59?c({y:window.innerHeight-e.offsetTop-59}):c(void 0))},[]);return(0,i.useEffect)(()=>(window.addEventListener("resize",w),()=>{window.removeEventListener("resize",w)}),[w]),(0,z.Z)(()=>{w()},[t],[w]),(0,i.useEffect)(()=>{(0,S.u)(async()=>{try{let e=await aE.Z.completeList();o(e)}catch(e){u((0,O.iT)({title:t0.plugins,err:e}))}})},[u]),(0,s.jsxs)(Y.Z,{direction:"vertical",className:"".concat(eP().fullWidth," ").concat(eP().fullHeight),size:20,children:[(0,s.jsx)(tV,{plugins:null!==(a=null==l?void 0:l.map(e=>({key:e.key,name:e.name})))&&void 0!==a?a:[],swr:{addOneUser:r.addOneUser}}),(0,s.jsx)(a6.Z,{loading:!l,pagination:!1,size:"small",columns:g,dataSource:t.map(e=>({...e,key:e.id})),ref:n,scroll:{y:null==d?void 0:d.y}})]})},t2=t(23335),t3=t(74989);let t4={system:"Error while loading system",update:"Unable to update system"},t6=async(e,a)=>{await tF.Z.update([{key:"allowsignup",value:!e.allowsignup}]),await a({allowsignup:!e.allowsignup})},t5=async(e,a)=>{await tF.Z.update([{key:"password",value:e}]),await a({password:e})};var t8=()=>{let{dispatch:e}=(0,i.useContext)(C.uj),[a]=P.Z.useForm(),[t,{mutateSystem:r,errorSystem:n,loadingSystem:l}]=tF.Z.useSystem();(0,i.useEffect)(()=>{n&&e((0,O.iT)({title:t4.system,err:n}))},[n,e]),(0,i.useEffect)(()=>{var e;l||a.setFieldsValue(null!==(e=null==t?void 0:t.password)&&void 0!==e?e:{min:t3.yL,max:t3.nq,requireLetter:t3.JT,requireNumber:t3.tE,requireSymbol:t3.ah})},[l,a,null==t?void 0:t.password]);let o=(0,i.useCallback)(()=>{(0,S.u)(async()=>{try{await t6(t,r),e((0,O.$E)({title:"Changes saved"}))}catch(a){e((0,O.iT)({title:t4.update,err:a}))}})},[t,r,e]),d=(0,i.useCallback)(a=>{(0,S.u)(async()=>{try{await t5(a,r),e((0,O.$E)({title:"Changes saved"}))}catch(a){e((0,O.iT)({title:t4.update,err:a}))}})},[r,e]);return l?(0,s.jsx)(T.Z.Simple,{}):(0,s.jsxs)(Y.Z,{direction:"vertical",className:eP().fullWidth,size:20,children:[(0,s.jsx)(er.Z,{title:"Signup",children:(0,s.jsx)(tH.Z,{checked:null==t?void 0:t.allowsignup,onChange:o,children:"Allow signup"})}),(0,s.jsx)(er.Z,{title:"Password",children:(0,s.jsx)(P.Z,{form:a,name:"form",onFinish:d,style:{display:"flex",justifyContent:"space-between"},children:(0,s.jsxs)("div",{className:"".concat(eP().displayFlex," ").concat(eP().fullWidth),style:{justifyContent:"space-between"},children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(P.Z.Item,{label:"Minimum number of characters",name:"min",rules:[{required:!0,message:"Minimum number of characters is required"}],children:(0,s.jsx)(t2.Z,{min:0,max:64})}),(0,s.jsx)(P.Z.Item,{label:"Maximum number of characters",name:"max",rules:[{required:!0,message:"Maximum number of characters is required"}],children:(0,s.jsx)(t2.Z,{min:0,max:64})})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(P.Z.Item,{valuePropName:"checked",name:"requireLetter",children:(0,s.jsx)(tH.Z,{children:"Require letter"})}),(0,s.jsx)(P.Z.Item,{valuePropName:"checked",name:"requireNumber",children:(0,s.jsx)(tH.Z,{children:"Require number"})}),(0,s.jsx)(P.Z.Item,{valuePropName:"checked",name:"requireSymbol",children:(0,s.jsx)(tH.Z,{children:"Require symbol"})})]}),(0,s.jsx)("div",{style:{marginTop:"auto"},children:(0,s.jsx)(P.Z.Item,{children:(0,s.jsx)(I.ZP,{type:"primary",icon:(0,s.jsx)(tM,{}),htmlType:"submit",children:"Save changes"})})})]})})})]})};let t7={plugins:"Unable to get plugins",update:"Unable to update system"},t9=async(e,a,t,s)=>{var r;await tF.Z.update([{key:"defaultplugins",type:"array",method:t?"append":"remove",value:a.key}]);let i=e_.Z.deepCopy(null!==(r=null==e?void 0:e.defaultplugins)&&void 0!==r?r:[]),n=i.indexOf(a.key);t&&-1===n&&i.push(a.key),t||-1===n||i.splice(n,1),await s.mutateSystem({defaultplugins:i})},se=e=>{let{plugin:a,system:t,swr:r,dispatch:n}=e,[l,o]=(0,i.useState)();(0,i.useEffect)(()=>{(null==t?void 0:t.defaultplugins)&&o(t.defaultplugins.includes(a.key))},[a,t]);let d=(0,i.useCallback)(e=>{(0,S.u)(async()=>{try{await t9(t,a,e.target.checked,r)}catch(e){n((0,O.iT)({title:t7.update,err:e}))}})},[a,t,r,n]);return(0,s.jsx)(tH.Z,{checked:l,onChange:d})};var sa=()=>{let e=(0,i.useRef)(null),{dispatch:a}=(0,i.useContext)(C.uj),[t,r]=(0,i.useState)(),[n,l]=(0,i.useState)(),[o,{mutateSystem:d,loadingSystem:c}]=tF.Z.useSystem();(0,i.useEffect)(()=>{(0,S.u)(async()=>{try{let e=await aE.Z.completeList();r(e)}catch(e){a((0,O.iT)({title:t7.plugins,err:e}))}})},[a]);let u=(0,i.useCallback)(e=>(0,s.jsx)(se,{system:o,plugin:e,swr:{mutateSystem:d},dispatch:a}),[o,d,a]),m=(0,i.useMemo)(()=>[{title:"Category",dataIndex:"category",key:"category"},{title:"Name",dataIndex:"name",key:"name"},{title:"Default enabled",key:"enable",render:u}],[u]),p=(0,i.useCallback)(()=>{let a=e.current;a&&(a.clientHeight>window.innerHeight-a.offsetTop-59?l({y:window.innerHeight-a.offsetTop-59}):l(null))},[]);return(0,i.useEffect)(()=>(window.addEventListener("resize",p),()=>{window.removeEventListener("resize",p)}),[p]),(0,i.useEffect)(()=>{p()},[t,p]),(0,s.jsx)(a6.Z,{ref:e,loading:!t||c,pagination:!1,size:"small",columns:m,dataSource:t,scroll:{y:null==n?void 0:n.y}})};let st={users:{label:"Users",key:"users"},registration:{label:"Registration",key:"registration"},plugins:{label:"Plugins",key:"plugins"}},ss={users:"Error while loading users"};var sr=()=>{let{dispatch:e}=(0,i.useContext)(C.uj),a=(0,r.useRouter)(),{tab:t}=a.query,[l,{addOneUser:d,mutateOneUser:c,delOneUser:u,errorUsers:m}]=ac.Z.useUsers();(0,i.useEffect)(()=>{m&&e((0,O.iT)({title:ss.users,err:m}))},[m,e]);let p=(0,i.useCallback)(e=>{(0,S.u)(async()=>{await a.replace({pathname:"/dashboard",query:{page:"administration",tab:e}})})},[a]);return(0,s.jsxs)(n.Z,{className:aa().inDashboard,children:[(0,s.jsx)(F,{title:(0,s.jsx)(o.Z.Title,{level:2,style:{marginBottom:"0 !important"},children:"Administration"})}),(0,s.jsx)(n.Z.Content,{children:(0,s.jsx)(N.Z,{className:aa().inDashboardTabs,type:"card",items:[{key:st.users.key,label:st.users.label,children:(0,s.jsx)(t1,{users:l,swr:{addOneUser:d,mutateOneUser:c,delOneUser:u}})},{key:st.registration.key,label:st.registration.label,children:(0,s.jsx)(t8,{})},{key:st.plugins.key,label:st.plugins.label,children:(0,s.jsx)(sa,{})}],defaultActiveKey:null!=t?t:"default",onChange:p})})]})},si=t(41664),sn=t.n(si),sl=()=>(0,s.jsxs)(n.Z,{className:aa().inDashboard,children:[(0,s.jsx)(F,{title:(0,s.jsx)(o.Z.Title,{level:2,style:{marginBottom:"0 !important"},children:"Help"})}),(0,s.jsx)(n.Z.Content,{className:eP().scroll,children:(0,s.jsxs)(Y.Z,{direction:"vertical",className:eP().fullWidth,size:20,children:[(0,s.jsxs)(o.Z,{children:[(0,s.jsx)(o.Z.Title,{level:3,children:"Documentation"}),(0,s.jsxs)(o.Z.Text,{children:["Full interface"," ",(0,s.jsx)(sn(),{href:"/doc",target:"_blank",children:"Documentation"})]})]}),(0,s.jsxs)(o.Z,{children:[(0,s.jsx)(o.Z.Title,{level:3,children:"Bug report"}),(0,s.jsxs)(o.Z.Text,{children:[(0,s.jsx)(sn(),{href:"https://github.com/Airthium/tanatloc/issues/new/choose",target:"_blank",children:"Open an issue"})," ","on Github"]})]}),(0,s.jsxs)(o.Z,{children:[(0,s.jsx)(o.Z.Title,{level:3,children:"Feature request"}),(0,s.jsxs)(o.Z.Text,{children:[(0,s.jsx)(sn(),{href:"https://github.com/Airthium/tanatloc/issues/new/choose",target:"_blank",children:"Open an issue"})," ","on Github"]})]})]})})]}),so={needUpdate:async()=>{if(!k()())return{needed:!1};let e=await fetch("https://api.github.com/repos/Airthium/tanatloc-electron/releases/latest",{method:"GET"}),a=await e.json(),t=Z.i8;return{needed:!a.tag_name.includes("alpha")&&!a.tag_name.includes("beta")&&t!==a.tag_name&&"v"+t!==a.tag_name,res:a}}},sd=()=>{let[e,a]=(0,i.useState)(),[t,r]=(0,i.useState)(!1);(0,i.useEffect)(()=>{(0,S.u)(async()=>{let e=await so.needUpdate();e.needed&&a(e)})},[]),(0,i.useEffect)(()=>{(null==e?void 0:e.needed)&&r(!0)},[e]);let n=(0,i.useCallback)(()=>{r(!1)},[]),l=(0,i.useCallback)(async()=>{window.open("https://github.com/Airthium/tanatloc-electron/releases/tag/"+(null==e?void 0:e.res.tag_name),"_blank"),r(!1)},[e]);return(0,s.jsx)(L.ZP,{visible:t,title:"Update",okButtonText:"Update",onCancel:n,onOk:l,children:(0,s.jsxs)(Y.Z,{direction:"vertical",children:[(0,s.jsx)(o.Z.Text,{children:"A new release is available"}),(0,s.jsxs)(o.Z.Text,{children:["Do you want to update to version"," ",(0,s.jsx)(o.Z.Text,{code:!0,children:null==e?void 0:e.res.tag_name}),"?"]})]})})},sc=t(59973);let su={user:"Error while loading user",organizations:"Error while loading organizations",workspaces:"Error while loading workspaces",logout:"Unable to logout"},sm={workspaces:{label:"Workspaces",key:"workspaces"},account:{label:"Account Settings",key:"account"},organizations:{label:"Organizations",key:"organizations"},administration:{label:"Administration",key:"administration"},editor:{label:"Model Editor",key:"editor"},help:{label:"I Need Help",key:"help"},logout:{label:"Logout",key:"logout"}};var sp=()=>{let[e,a]=(0,i.useState)(),{dispatch:t}=(0,i.useContext)(C.uj),[d,{mutateUser:c,clearUser:u,errorUser:h,loadingUser:v}]=ac.Z.useUser(),[y,{addOneOrganization:b,delOneOrganization:P,mutateOneOrganization:E,errorOrganizations:N,loadingOrganizations:A}]=a4.Z.useOrganizations(),[_,{addOneWorkspace:I,delOneWorkspace:U,mutateOneWorkspace:R,errorWorkspaces:q,loadingWorkspaces:D}]=G.Z.useWorkspaces(),L=(0,r.useRouter)(),W=(0,i.useCallback)(async()=>{try{await aO(),await u()}catch(e){t((0,O.iT)({title:su.logout,err:e}))}},[u,t]),M=(0,i.useCallback)(async e=>{a(e),e===sm.logout.key?await W():e===sm.editor.key?await L.push("/editor"):await L.replace({pathname:"/dashboard",query:{page:e}})},[L,W]),H=(0,i.useCallback)(e=>{let{keyPath:a}=e;(0,S.u)(async()=>{let e=a.pop();await M(e)})},[M]);return((0,z.Z)(()=>{(0,S.u)(async()=>{k()()?await (0,sc.x)({email:"admin",password:"password"}):v||d||await L.replace("/")})},[d,v,L]),(0,z.Z)(()=>{(0,S.u)(async()=>{let e=new URLSearchParams(window.location.search).get("page");e?a(e):await M(sm.workspaces.key)})},[L],[M]),(0,z.Z)(()=>{h&&t((0,O.iT)({title:su.user,err:h})),N&&t((0,O.iT)({title:su.organizations,err:N})),q&&t((0,O.iT)({title:su.workspaces,err:q}))},[h,N,q]),!d||v||A||D)?(0,s.jsx)(T.Z,{}):(0,s.jsxs)(n.Z,{className:aa().dashboard,children:[(0,s.jsx)(sd,{}),(0,s.jsxs)(n.Z.Sider,{theme:"light",width:"256",className:aa().sider,children:[(0,s.jsx)("div",{className:eP().logo,children:(0,s.jsx)("img",{src:"/images/logo.svg",alt:"Tanatloc"})}),(0,s.jsx)(l.Z,{className:aa().menu,items:[{key:sm.workspaces.key,icon:(0,s.jsx)(m,{}),label:sm.workspaces.label},{key:sm.account.key,icon:(0,s.jsx)(p.Z,{}),label:sm.account.label},{key:sm.organizations.key,icon:(0,s.jsx)(g,{}),label:sm.organizations.label,className:k()()?"display-none":""},{key:sm.administration.key,className:d.superuser&&!k()()?"":"display-none",icon:(0,s.jsx)(w.Z,{}),label:sm.administration.label},{key:sm.editor.key,icon:(0,s.jsx)(x.Z,{}),label:sm.editor.label},{key:sm.help.key,icon:(0,s.jsx)(j,{}),label:sm.help.label},{type:"divider"},{key:sm.logout.key,danger:!0,icon:(0,s.jsx)(f,{}),label:sm.logout.label,className:k()()?"display-none":""},{key:"version",disabled:!0,className:"version",label:(0,s.jsxs)(o.Z.Text,{className:eP().textLight,ellipsis:{tooltip:!0},children:["version ",Z.i8]})}],onClick:H,mode:"inline"})]}),(0,s.jsxs)(n.Z.Content,{className:eP().noScroll,children:[e===sm.workspaces.key&&(0,s.jsx)(ar,{user:{id:d.id,plugins:d.plugins},workspaces:_,organizations:y,swr:{addOneWorkspace:I,delOneWorkspace:U,mutateOneWorkspace:R}}),e===sm.account.key&&(0,s.jsx)(a2,{user:{email:d.email,firstname:d.firstname,lastname:d.lastname,avatar:d.avatar},swr:{mutateUser:c,clearUser:u}}),e===sm.organizations.key&&(0,s.jsx)(tq,{user:{id:d.id},organizations:y,swr:{addOneOrganization:b,delOneOrganization:P,mutateOneOrganization:E,loadingOrganizations:A}}),e===sm.administration.key&&(0,s.jsx)(sr,{}),e===sm.help.key&&(0,s.jsx)(sl,{})]})]})},sh=()=>(0,s.jsx)(sp,{})},28357:function(e){e.exports={information:"information_information__JyH_D"}},89499:function(e){e.exports={variables:'"@/styles/index.module.css"',colorPrimary:"#fad114",head:"pageHeader_head__R_sEo",divider:"pageHeader_divider__wx9MS"}},51946:function(e){e.exports={variables:'"@/styles/index.module.css"',colorPrimary:"#fad114",dashboard:"dashboard_dashboard__3usL4",sider:"dashboard_sider__QlZ6b",menu:"dashboard_menu__7pd_G","ant-menu-item-divider":"dashboard_ant-menu-item-divider__CDKa1",inDashboard:"dashboard_inDashboard__PEL1z",inDashboardTabs:"dashboard_inDashboardTabs__1L_iA"}},2194:function(e){e.exports={variables:'"@/styles/variables.css"',colorPrimary:"#fad114",textColorLight:"rgba(0, 0, 0, 0.45)",card:"list_card__qxs0D",cardArchived:"list_cardArchived___a_uA",cardUsers:"list_cardUsers__wEI0q",cardDivider:"list_cardDivider__SdGoI",carousel:"list_carousel__rAygP",carouselSnapshot:"list_carouselSnapshot__wturO",carouselSnapshotArchived:"list_carouselSnapshotArchived__OFeKM",carouselDescription:"list_carouselDescription__AUEPz",carouselDescriptionArchived:"list_carouselDescriptionArchived__ypoxh",empty:"list_empty__JWMqP",emptySearch:"list_emptySearch__nZ3dG"}},88357:function(e){e.exports={empty:"workspace_empty__1O3ic",search:"workspace_search__lZrCd",shared:"workspace_shared__r0geC",tabs:"workspace_tabs__Ukwpy"}},4147:function(e){"use strict";e.exports={i8:"1.3.7"}}},function(e){e.O(0,[9774,2312,688,8485,8123,6162,8764,1715,5054,7829,1758,2227,4961,8446,5435,2117,2695,8405,3335,3985,8121,7640,2888,179],function(){return e(e.s=9637)}),_N_E=e.O()}]);