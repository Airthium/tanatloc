(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[26],{40528:function(__unused_webpack_module,__unused_webpack_exports,__webpack_require__){(window.__NEXT_P=window.__NEXT_P||[]).push(["/dashboard",function(){return __webpack_require__(90037)}])},37404:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,{JT:function(){return REQUIRE_LETTER},ah:function(){return REQUIRE_SYMBOL},nq:function(){return MAX_SIZE},tE:function(){return REQUIRE_NUMBER},yL:function(){return MIN_SIZE}}),__webpack_require__(83454).env.AUTH_SECRET||Array(33).join("a");let MIN_SIZE=6,MAX_SIZE=16,REQUIRE_LETTER=!0,REQUIRE_NUMBER=!0,REQUIRE_SYMBOL=!0},5094:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,{Z:function(){return avatar}});var call=__webpack_require__(11425);let add=async(file,project)=>{let response=await (0,call.R)("/api/avatar",{method:"POST",headers:{Accept:"application/json"},body:JSON.stringify({file,project})});return response.json()};var avatar={add:add}},4415:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,{H:function(){return APIError}});class APIError extends Error{constructor(params){super(params.title),this.title=params.title,this.name="APIError",this.render=params.render,this.err=params.err,this.type=params.type||"error"}}},71270:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,{Z:function(){return api_plugin}});var call=__webpack_require__(11425);let add=async plugin=>{await (0,call.R)("/api/plugin",{method:"POST",body:JSON.stringify(plugin)})},update=async plugin=>{await (0,call.R)("/api/plugin",{method:"PUT",body:JSON.stringify(plugin)})},del=async plugin=>{await (0,call.R)("/api/plugin",{method:"DELETE",body:JSON.stringify(plugin)})};var dist=__webpack_require__(8100),react=__webpack_require__(67294);let usePlugins=()=>{let{data,error,mutate}=(0,dist.ZP)("/api/plugin",call._),plugins=(null==data?void 0:data.plugins)||[],addOne=(0,react.useCallback)(plugin=>{let newPlugins=[...plugins,plugin];mutate({plugins:newPlugins})},[plugins,mutate]),delOne=(0,react.useCallback)(plugin=>{let filteredPlugins=plugins.filter(p=>p.key!==plugin.key);mutate({plugins:filteredPlugins})},[plugins,mutate]),mutateOne=(0,react.useCallback)(plugin=>{let mutatedPlugin=plugins.map(p=>(p.key===plugin.key&&(p={...p,...plugin}),p));mutate({plugins:mutatedPlugin})},[plugins,mutate]);return[plugins,{mutatePlugins:mutate,addOnePlugin:addOne,delOnePlugin:delOne,mutateOnePlugin:mutateOne,errorPlugins:error,loadingPlugins:!data}]};var api_plugin={add:add,update:update,del:del,usePlugins:usePlugins}},10843:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,{Z:function(){return plugins}});var call=__webpack_require__(11425);let list=async()=>{let response=await (0,call.R)("/api/plugins",{method:"GET",headers:{Accept:"application/json"}});return response.json()},completeList=async()=>{let response=await (0,call.R)("/api/plugins",{method:"POST",headers:{Accept:"application/json"}});return response.json()};var plugins={list:list,completeList:completeList}},26791:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,{Z:function(){return project}});var dist=__webpack_require__(8100),react=__webpack_require__(67294),call=__webpack_require__(11425);let useProjects=ids=>{let{data,error,mutate}=(0,dist.ZP)(["/api/projects",JSON.stringify({ids})],call._),projects=(null==data?void 0:data.projects)||[],addOne=(0,react.useCallback)(project=>{let newProjects=[...projects,{...project,users:[],geometries:[],simulations:[],groups:[]}];mutate({projects:newProjects})},[projects,mutate]),delOne=(0,react.useCallback)(project=>{let filteredProjects=projects.filter(p=>p.id!==project.id);mutate({projects:filteredProjects})},[projects,mutate]),mutateOne=(0,react.useCallback)(project=>{let mutatedProjects=projects.map(p=>(p.id===project.id&&(p={...p,...project}),p));mutate({projects:mutatedProjects})},[projects,mutate]);return[projects,{addOneProject:addOne,delOneProject:delOne,mutateOneProject:mutateOne,errorProjects:error,loadingProjects:!data}]},useProject=id=>{let{data,error,mutate}=(0,dist.ZP)("/api/project"+(id?"/"+id:""),call._),project=(null==data?void 0:data.project)||{id:"0"},localMutate=(0,react.useCallback)(update=>{let mutatedProject={...project,...update};mutate({project:mutatedProject})},[project,mutate]);return[project,{mutateProject:localMutate,errorProject:error,loadingProject:!data}]},add=async(workspace,project)=>{let response=await (0,call.R)("/api/project",{method:"POST",headers:{Accept:"application/json"},body:JSON.stringify({workspace:{id:workspace.id},project:project})});return response.json()},update=async(project,data)=>{await (0,call.R)("/api/project/"+project.id,{method:"PUT",body:JSON.stringify(data)})},del=async(workspace,project)=>{await (0,call.R)("/api/project/"+project.id,{method:"DELETE",body:JSON.stringify({id:workspace.id})})},archive=async project=>(0,call.R)("/api/project/"+project.id+"/archive",{method:"GET",headers:{Accept:"application/json"}}),unarchiveFromServer=async project=>(0,call.R)("/api/project/"+project.id+"/archive",{method:"PUT"}),deleteArchiveFile=async project=>(0,call.R)("/api/project/"+project.id+"/archive",{method:"DELETE"}),unarchiveFromFile=async(project,archive)=>(0,call.R)("/api/project/"+project.id+"/archive",{method:"POST",body:JSON.stringify({archive})});var project={useProjects:useProjects,useProject:useProject,add:add,update:update,del:del,archive:archive,unarchiveFromServer:unarchiveFromServer,deleteArchiveFile:deleteArchiveFile,unarchiveFromFile:unarchiveFromFile}},92288:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,{Z:function(){return system}});var dist=__webpack_require__(8100),react=__webpack_require__(67294),call=__webpack_require__(11425);let useSystem=()=>{let{data,error,mutate}=(0,dist.ZP)("/api/system",call._),system=(null==data?void 0:data.system)||{},localMutate=(0,react.useCallback)(update=>{mutate({system:{...system,...update}})},[system,mutate]);return[system,{mutateSystem:localMutate,errorSystem:error,loadingSystem:!data}]},update=async data=>{await (0,call.R)("/api/system",{method:"PUT",body:JSON.stringify(data)})};var system={useSystem:useSystem,update:update}},18436:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,{HS:function(){return add},Lw:function(){return cancel},m1:function(){return button_delete},o6:function(){return download},w6:function(){return edit},ks:function(){return goBack},Qj:function(){return button_link}});var jsx_runtime=__webpack_require__(85893),tooltip=__webpack_require__(84908),es_button=__webpack_require__(71577),PlusCircleOutlined=__webpack_require__(64789);let AddButton=param=>{let{disabled,primary=!0,light,dark,fullWidth,needMargin,loading,children,onAdd}=param;return(0,jsx_runtime.jsx)(tooltip.Z,{title:children||"Add",children:(0,jsx_runtime.jsx)(es_button.Z,{className:(fullWidth?"full-width":"")+(needMargin?" marginLeft-5":"")+(light?" text-light":"")+(dark?" text-dark":""),disabled:disabled,loading:loading,type:primary?"primary":"default",icon:(0,jsx_runtime.jsx)(PlusCircleOutlined.Z,{}),onClick:()=>onAdd(),children:children})})};var add=AddButton,EditOutlined=__webpack_require__(86548);let EditButton=param=>{let{disabled,primary=!1,bordered,light,dark,needMargin,loading,children,onEdit}=param;return(0,jsx_runtime.jsx)(tooltip.Z,{title:children||"Edit",children:(0,jsx_runtime.jsx)(es_button.Z,{className:"no-background "+(needMargin?"marginLeft-5 ":"")+(light?"text-light ":"")+(dark?"text-dark ":"")+(bordered?"":"no-border "),disabled:disabled,loading:loading,type:disabled?"link":primary?"primary":"default",icon:(0,jsx_runtime.jsx)(EditOutlined.Z,{}),onClick:onEdit,children:children})})};var edit=EditButton,react=__webpack_require__(67294),DeleteOutlined=__webpack_require__(48689),dialog=__webpack_require__(28345);let DeleteButton=param=>{let{disabled,loading,bordered,text,title,children,onDelete}=param,[visible,setVisible]=(0,react.useState)(!1);return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(dialog.AN,{visible:visible,loading:loading,title:title||"Delete",onCancel:()=>setVisible(!1),async onOk(){await onDelete(),setVisible(!1)},children:text||"Are you sure?"}),(0,jsx_runtime.jsx)(tooltip.Z,{title:children||"Delete",children:(0,jsx_runtime.jsx)(es_button.Z,{className:"no-background "+(bordered?"":"no-border"),danger:!0,disabled:disabled,type:disabled?"link":void 0,loading:loading,icon:(0,jsx_runtime.jsx)(DeleteOutlined.Z,{}),onClick:()=>setVisible(!0),children:children})})]})};var button_delete=DeleteButton,DownloadOutlined=__webpack_require__(23430);let DownloadButton=param=>{let{disabled,loading,bordered,children,onDownload}=param;return(0,jsx_runtime.jsx)(tooltip.Z,{title:children||"Download",children:(0,jsx_runtime.jsx)(es_button.Z,{className:"no-background "+(bordered?"":"no-border"),disabled:disabled,loading:loading,icon:(0,jsx_runtime.jsx)(DownloadOutlined.Z,{}),onClick:()=>onDownload(),children:children})})};var download=DownloadButton,ArrowLeftOutlined=__webpack_require__(82826);let GoBack=param=>{let{children,onClick}=param;return(0,jsx_runtime.jsx)(es_button.Z,{className:"no-border",icon:(0,jsx_runtime.jsx)(ArrowLeftOutlined.Z,{className:"color-primary"}),onClick:onClick,children:children||"Go back"})};var goBack=GoBack;let CancelButton=param=>{let{disabled,loading,children,onCancel}=param;return(0,jsx_runtime.jsx)(tooltip.Z,{title:children||"Cancel",children:(0,jsx_runtime.jsx)(es_button.Z,{disabled:disabled,loading:loading,type:"default",onClick:onCancel,children:children||"Cancel"})})};var cancel=CancelButton;let Link=param=>{let{children,onClick}=param;return(0,jsx_runtime.jsx)(es_button.Z,{type:"link",onClick:onClick,style:{padding:0},children:children})};var button_link=Link},47455:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,{o:function(){return input_password}});var jsx_runtime=__webpack_require__(85893),es_form=__webpack_require__(81579),input=__webpack_require__(69677),auth=__webpack_require__(37404),api_system=__webpack_require__(92288);let errors={password:"Please enter a password",passwordTooSmall:min=>"Your password is too small (minimum "+min+" characters)",passwordTooLong:max=>"Your password is too long (maximum "+max+" characters)",passwordRequireLetter:"Your password must contain a letter",passwordRequireNumber:"Your password must contain a number",passwordRequireSymbol:"Your password must contain a symbol"},checkMin=(passwordMinSize,value)=>!(value.length<passwordMinSize),checkMax=(passwordMaxSize,value)=>!(value.length>passwordMaxSize),checkRegex=(value,regex)=>-1!==value.search(regex),requireLetter=(system,value)=>{var ref,ref1;return(null!==(ref1=null==system?void 0:null===(ref=system.password)||void 0===ref?void 0:ref.requireLetter)&&void 0!==ref1?!ref1:!auth.JT)||checkRegex(value,/[a-zA-Z]/)},requireNumber=(system,value)=>{var ref,ref1;return(null!==(ref1=null==system?void 0:null===(ref=system.password)||void 0===ref?void 0:ref.requireNumber)&&void 0!==ref1?!ref1:!auth.tE)||checkRegex(value,/\d/)},requireSymbol=(system,value)=>{var ref,ref1;return(null!==(ref1=null==system?void 0:null===(ref=system.password)||void 0===ref?void 0:ref.requireSymbol)&&void 0!==ref1?!ref1:!auth.ah)||checkRegex(value,/[!@#$%^&*(){}[\]<>?/|.:;_-]/)},checkSize=(passwordMinSize,passwordMaxSize,value,err)=>{checkMin(passwordMinSize,value)||err.push(errors.passwordTooSmall(passwordMinSize)),checkMax(passwordMaxSize,value)||err.push(errors.passwordTooLong(passwordMaxSize))},checkFormat=(system,value,err)=>{requireLetter(system,value)||err.push(errors.passwordRequireLetter),requireNumber(system,value)||err.push(errors.passwordRequireNumber),requireSymbol(system,value)||err.push(errors.passwordRequireSymbol)},PasswordItem=param=>{var ref,ref1,ref2,ref3;let{labelCol,wrapperCol,name,label,inputPlaceholder,inputAutoComplete,edit,style,required,className}=param,[system]=api_system.Z.useSystem(),passwordMinSize=null!==(ref2=null==system?void 0:null===(ref=system.password)||void 0===ref?void 0:ref.min)&&void 0!==ref2?ref2:auth.yL,passwordMaxSize=null!==(ref3=null==system?void 0:null===(ref1=system.password)||void 0===ref1?void 0:ref1.max)&&void 0!==ref3?ref3:auth.nq;return(0,jsx_runtime.jsx)(es_form.Z.Item,{className:className,labelCol:labelCol,wrapperCol:wrapperCol,name:name||"password",label:label||"Password",rules:[()=>({validator(_,value){let err=[];return edit&&"******"===value?Promise.resolve():value?(checkSize(passwordMinSize,passwordMaxSize,value,err),checkFormat(system,value,err),err.length)?Promise.reject(err):Promise.resolve():Promise.reject(errors.password)}}),{required:!!required,message:""}],style:style,children:(0,jsx_runtime.jsx)(input.Z.Password,{placeholder:inputPlaceholder,autoComplete:inputAutoComplete})})};var input_password=PasswordItem},64376:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(85893),antd__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(84908),antd__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(63922),antd__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(24093),antd__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(11382),email_addresses__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(13023),Buffer=__webpack_require__(48764).lW;let deepCopy=object=>JSON.parse(JSON.stringify(object)),stringToColor=str=>{if(!str)return"#FFFFFF";let stringHash=Array.from(str).reduce((acc,char)=>char.charCodeAt(0)+((acc<<5)-acc),0);return"hsl("+stringHash%360+", 100%, 25%)"},colorGenerator=quantity=>{if(!quantity)return"#"+Math.floor(16777215*Math.random()).toString(16);let result=[],segments=255/quantity;for(let i=0;i<quantity;i++){let r=Math.floor(i*segments%255).toString(16).padStart(2,"0"),g=Math.floor((i+1)*segments%255).toString(16).padStart(2,"0"),b=Math.floor((i+2)*segments%255).toString(16).padStart(2,"0");result.push("#"+r+g+b)}return result},componentToHex=c=>{let hex=c.toString(16);return 1===hex.length?"0"+hex:hex},rgbToHex=color=>"#"+componentToHex(Math.floor(255*color.r))+componentToHex(Math.floor(255*color.g))+componentToHex(Math.floor(255*color.b)),userToAvatar=user=>{let avatar=user.avatar&&Buffer.from(user.avatar).toString(),name="",abbrev="";return user.firstname||user.lastname?(name=(user.firstname?user.firstname+" ":"")+(user.lastname||""),abbrev=(user.firstname?user.firstname[0]:"")+(user.lastname?user.lastname[0]:"")):user.email&&(name=user.email,abbrev=user.email[0]),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(antd__WEBPACK_IMPORTED_MODULE_2__.Z,{title:name+(user.pending?" (Invite pending)":""),children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(antd__WEBPACK_IMPORTED_MODULE_3__.Z,{count:user.pending&&"Pending...",offset:[30,5],style:{backgroundColor:"#ff4d4f",zIndex:10},children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(antd__WEBPACK_IMPORTED_MODULE_4__.C,{src:avatar,style:{backgroundColor:stringToColor(name)},children:abbrev.toUpperCase()||(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(antd__WEBPACK_IMPORTED_MODULE_5__.Z,{})})})},user.id||JSON.stringify(user))},groupToAvatar=group=>{let name=group.name,abbrev="";return name&&(abbrev=name[0]),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(antd__WEBPACK_IMPORTED_MODULE_2__.Z,{title:name,children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(antd__WEBPACK_IMPORTED_MODULE_4__.C,{style:{backgroundColor:stringToColor(name)},children:abbrev.toUpperCase()||(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(antd__WEBPACK_IMPORTED_MODULE_5__.Z,{})})},group.id||JSON.stringify(group))},validateEmail=email=>!!(0,email_addresses__WEBPACK_IMPORTED_MODULE_1__.parseOneAddress)(email);__webpack_exports__.Z={deepCopy,stringToColor,colorGenerator,rgbToHex,rgbToRgba:function(color){let alpha=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return color?"rgba("+255*color.r+", "+255*color.g+", "+255*color.b+", "+alpha+")":"rgba(255, 255, 255, 0)"},userToAvatar,groupToAvatar,validateEmail,getGitVersion:()=>"git-front-eefeaf2"}},90037:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:function(){return pages_dashboard}});var jsx_runtime=__webpack_require__(85893),next_router=__webpack_require__(11163),react=__webpack_require__(67294),layout=__webpack_require__(97183),menu=__webpack_require__(66516),typography=__webpack_require__(6880),AppstoreOutlined=__webpack_require__(41156),SettingOutlined=__webpack_require__(42952),TeamOutlined=__webpack_require__(55355),ControlOutlined=__webpack_require__(11186),QuestionCircleOutlined=__webpack_require__(25035),LogoutOutlined=__webpack_require__(92443),is_electron=__webpack_require__(59134),is_electron_default=__webpack_require__.n(is_electron),package_0=__webpack_require__(4147),notification=__webpack_require__(67582),components_loading=__webpack_require__(54666),page_header=__webpack_require__(7614),divider=__webpack_require__(27049),es_form=__webpack_require__(81579),input=__webpack_require__(69677),tabs=__webpack_require__(50741),empty=__webpack_require__(62986),dialog=__webpack_require__(28345),dist=__webpack_require__(8100),call=__webpack_require__(11425);let useWorkspaces=()=>{let{data,error,mutate}=(0,dist.ZP)("/api/workspace",call._),workspaces=(null==data?void 0:data.workspaces)||[],addOne=(0,react.useCallback)(workspace=>{let newWorkspaces=[...workspaces,workspace];mutate({workspaces:newWorkspaces})},[workspaces,mutate]),delOne=(0,react.useCallback)(workspace=>{let filteredWorkspaces=workspaces.filter(w=>w.id!==workspace.id);mutate({workspaces:filteredWorkspaces})},[workspaces,mutate]),mutateOne=(0,react.useCallback)(workspace=>{let mutatedWorkspaces=workspaces.map(w=>(w.id===workspace.id&&(w={...w,...workspace}),w));mutate({workspaces:mutatedWorkspaces})},[workspaces,mutate]);return[workspaces,{addOneWorkspace:addOne,delOneWorkspace:delOne,mutateOneWorkspace:mutateOne,errorWorkspaces:error,loadingWorkspaces:!data}]},add=async workspace=>{let response=await (0,call.R)("/api/workspace",{method:"POST",headers:{Accept:"application/json"},body:JSON.stringify(workspace)});return response.json()},update=async(workspace,data)=>{await (0,call.R)("/api/workspace",{method:"PUT",body:JSON.stringify({workspace:workspace,data:data})})},del=async workspace=>{await (0,call.R)("/api/workspace",{method:"DELETE",body:JSON.stringify(workspace)})};var api_workspace={useWorkspaces:useWorkspaces,add:add,update:update,del:del},space=__webpack_require__(26713),avatar=__webpack_require__(24093),SearchOutlined=__webpack_require__(68795),tree_select=__webpack_require__(97986),tooltip=__webpack_require__(84908),es_button=__webpack_require__(71577),ShareAltOutlined=__webpack_require__(20046),assets_button=__webpack_require__(18436),utils=__webpack_require__(64376),api_project=__webpack_require__(26791);let errors={share:"Unable to share"},onShare=async(workspace,project,groupsSelected,usersSelected,swr)=>{try{if(workspace){await api_workspace.update({id:workspace.id},[{key:"groups",value:groupsSelected},{key:"users",value:usersSelected}]);let newWorkspace=utils.Z.deepCopy(workspace);newWorkspace.groups=groupsSelected.map(group=>({id:group})),newWorkspace.users=usersSelected.map(user=>({id:user})),swr.mutateOneWorkspace(newWorkspace)}else{await api_project.Z.update({id:project.id},[{key:"groups",value:groupsSelected},{key:"users",value:usersSelected}]);let newProject=utils.Z.deepCopy(project);newProject.groups=groupsSelected.map(group=>({id:group})),newProject.users=usersSelected.map(user=>({id:user})),swr.mutateOneProject(newProject)}}catch(err){throw(0,notification.lt)(errors.share,err),err}},userTitle=user=>{let title=user.email;return(user.lastname||user.firstname)&&(title=(user.lastname?user.lastname+" ":"")+(user.firstname||"")),title},Share=param=>{let{disabled,workspace,project,organizations,swr,style}=param,[visible,setVisible]=(0,react.useState)(!1),[loading,setLoading]=(0,react.useState)(!1),[treeGroupsData,setTreeGroupsData]=(0,react.useState)([]),[treeUsersData,setTreeUsersData]=(0,react.useState)([]),[groupsSelected,setGroupsSelected]=(0,react.useState)([]),[usersSelected,setUsersSelected]=(0,react.useState)([]),router=(0,next_router.useRouter)();(0,react.useEffect)(()=>{let parent=workspace||project,defaultGroups=null==parent?void 0:parent.groups.map(g=>g.id),defaultUsers=null==parent?void 0:parent.users.map(u=>u.id);setGroupsSelected(defaultGroups||[]),setUsersSelected(defaultUsers||[])},[workspace,project]),(0,react.useEffect)(()=>{let groupsData=organizations.map(organization=>{let groups=organization.groups.map(group=>({key:group.id,title:group.name,value:group.id,type:"group"}));return{key:organization.id,title:organization.name,value:organization.id,disabled:!0,checkable:!1,children:groups}}),users=[];organizations.forEach(organization=>{organization.owners.forEach(owner=>{users.push({key:owner.id,title:userTitle(owner),value:owner.id,type:"user"})}),organization.users.forEach(user=>{users.push({key:user.id,title:userTitle(user),value:user.id,type:"user"})}),organization.groups.forEach(group=>{group.users.forEach(user=>{users.push({key:user.id,title:userTitle(user),value:user.id,type:"user"})})})});let uniqueUsersData=users.filter((user,index,self1)=>self1.findIndex(s=>s.key===user.key)===index);setTreeGroupsData(groupsData),setTreeUsersData(uniqueUsersData)},[organizations]);let selector=null;return selector=treeGroupsData.length?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(es_form.Z.Item,{label:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["Share this ",workspace?"workspace":"project"," with organizations groups"]}),children:(0,jsx_runtime.jsx)(tree_select.Z,{multiple:!0,treeCheckable:!0,treeDefaultExpandAll:!0,showCheckedStrategy:tree_select.Z.SHOW_ALL,placeholder:"Select groups",dropdownStyle:{maxHeight:400,overflow:"auto"},className:"full-width",treeData:treeGroupsData,value:groupsSelected,onChange:value=>setGroupsSelected(value)})}),(0,jsx_runtime.jsx)(es_form.Z.Item,{label:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["Share this ",workspace?"workspace":"project"," with organizations users"]}),children:(0,jsx_runtime.jsx)(tree_select.Z,{multiple:!0,treeCheckable:!0,treeDefaultExpandAll:!0,showCheckedStrategy:tree_select.Z.SHOW_ALL,placeholder:"Select users",dropdownStyle:{maxHeight:400,overflow:"auto"},className:"full-width",treeData:treeUsersData,value:usersSelected,onChange:value=>setUsersSelected(value)})})]}):(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("br",{}),(0,jsx_runtime.jsx)(typography.Z.Text,{strong:!0,children:"There is no organization for now"}),(0,jsx_runtime.jsx)("br",{}),(0,jsx_runtime.jsxs)(typography.Z.Text,{children:["You can create organizations and groups in the"," ",(0,jsx_runtime.jsx)(assets_button.Qj,{onClick:()=>router.push({pathname:"/dashboard",query:{page:"organizations"}}),children:"Organization menu"}),"."]})]}),(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(tooltip.Z,{title:"Share",children:(0,jsx_runtime.jsx)(es_button.Z,{className:"no-background "+((null==style?void 0:style.buttonLight)?"text-light ":"")+((null==style?void 0:style.buttonDark)?" text-dark ":"")+((null==style?void 0:style.buttonBordered)?" ":"no-border ")+(is_electron_default()()?"display-none ":" "),disabled:disabled,type:disabled?"link":void 0,icon:(0,jsx_runtime.jsx)(ShareAltOutlined.Z,{}),onClick:()=>setVisible(!0)},"share")}),(0,jsx_runtime.jsxs)(dialog.ZP,{title:"Share "+(workspace?"workspace":"project"),visible:visible,onCancel:()=>setVisible(!1),async onOk(){setLoading(!0);try{await onShare(workspace,project,groupsSelected,usersSelected,swr),setLoading(!1),setVisible(!1)}catch(err){throw setLoading(!1),err}},loading:loading,children:[(0,jsx_runtime.jsxs)(typography.Z.Title,{level:5,children:[workspace?"Workspace: ":"Project: ",(null==workspace?void 0:workspace.name)||(null==project?void 0:project.title)]}),selector]})]})},add_errors={add:"Unable to add project"},onAdd=async(workspace,values,swr)=>{try{let project=await api_project.Z.add({id:workspace.id},values);return swr.addOneProject(project),swr.mutateOneWorkspace({...workspace,projects:[...workspace.projects,project.id]}),project}catch(err){throw(0,notification.lt)(add_errors.add,err),err}},Add=param=>{let{workspace,swr}=param,[visible,setVisible]=(0,react.useState)(!1),[loading,setLoading]=(0,react.useState)(!1),router=(0,next_router.useRouter)();return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(assets_button.HS,{primary:!1,dark:!0,onAdd:()=>setVisible(!0),children:"Create a new project"}),(0,jsx_runtime.jsxs)(dialog.ZP,{title:"Create a new project",visible:visible,onCancel:()=>setVisible(!1),async onOk(values){setLoading(!0);try{let newProject=await onAdd(workspace,values,swr);setLoading(!1),setVisible(!1),router.push({pathname:"/project",query:{page:"workspaces",workspaceId:workspace.id,projectId:newProject.id}})}catch(err){throw setLoading(!1),err}},loading:loading,children:[(0,jsx_runtime.jsx)(es_form.Z.Item,{label:"Name",name:"title",rules:[{required:!0,message:"Name is required"},{max:50,message:"Max 50 characters"}],children:(0,jsx_runtime.jsx)(input.Z,{placeholder:"Project's name"})}),(0,jsx_runtime.jsx)(es_form.Z.Item,{label:"Description",name:"description",children:(0,jsx_runtime.jsx)(input.Z.TextArea,{showCount:!0,maxLength:120,placeholder:"Project's description"})})]})]})};var card=__webpack_require__(81474),tag=__webpack_require__(20550),carousel=__webpack_require__(61980);let edit_errors={edit:"Unable to edit project"},onEdit=async(project,values,swr)=>{try{await api_project.Z.update({id:project.id},[{key:"title",value:values.title},{key:"description",value:values.description}]),swr.mutateOneProject(project)}catch(err){throw(0,notification.lt)(edit_errors.edit,err),err}},Edit=param=>{let{disabled,project,swr}=param,[visible,setVisible]=(0,react.useState)(!1),[loading,setLoading]=(0,react.useState)(!1);return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(assets_button.w6,{disabled:disabled,dark:!0,onEdit:()=>setVisible(!0)}),(0,jsx_runtime.jsxs)(dialog.ZP,{title:'Edit "'+project.title+'" project',visible:visible,onCancel:()=>setVisible(!1),async onOk(values){setLoading(!0);try{await onEdit(project,values,swr),setLoading(!1),setVisible(!1)}catch(err){throw setLoading(!1),err}},loading:loading,initialValues:{title:project.title,description:project.description},children:[(0,jsx_runtime.jsx)(es_form.Z.Item,{label:"Name",name:"title",rules:[{required:!0,message:"Name is required"},{max:50,message:"Max 50 characters"}],children:(0,jsx_runtime.jsx)(input.Z,{placeholder:"Project's name"})}),(0,jsx_runtime.jsx)(es_form.Z.Item,{label:"Description",name:"description",children:(0,jsx_runtime.jsx)(input.Z.TextArea,{placeholder:"Project's description",showCount:!0,maxLength:120})})]})]})};var es_alert=__webpack_require__(14670);let delete_errors={del:"Unable to delete project"},onDelete=async(workspace,project,swr)=>{try{await api_project.Z.del({id:workspace.id},{id:project.id});let index=workspace.projects.findIndex(p=>p===project.id);workspace.projects=[...workspace.projects.slice(0,index),...workspace.projects.slice(index+1)],swr.mutateOneWorkspace(workspace),swr.delOneProject({id:project.id})}catch(err){throw(0,notification.lt)(delete_errors.del,err),err}},Delete=param=>{let{disabled,workspace,project,swr}=param,[loading,setLoading]=(0,react.useState)(!1);return(0,jsx_runtime.jsx)(assets_button.m1,{disabled:disabled,loading:loading,title:"Delete the project",text:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["Are you sure you want to delete the project"," ",(0,jsx_runtime.jsx)(typography.Z.Text,{strong:!0,children:project.title}),"?",(0,jsx_runtime.jsx)(es_alert.Z,{type:"error",message:"If you delete the project, you will no longer be able to restore the archive",style:{marginTop:"16px"}})]}),async onDelete(){setLoading(!0);try{await onDelete(workspace,project,swr)}finally{setLoading(!1)}}})};var upload=__webpack_require__(78116),ImportOutlined=__webpack_require__(57546),HddOutlined=__webpack_require__(238),Buffer=__webpack_require__(48764).lW;let archive_errors={archive:"Unable to archive project",unarchiveServer:"Unable to unarchive project on server",deleteArchive:"Unable to delete archive",badFormat:"Bad archive format (supported format: .tanatlocarchive)",upload:"Unable to upload archive"},onArchive=async(workspace,project,swr)=>{try{let archive=await api_project.Z.archive({id:project.id}),content=await archive.blob(),url=window.URL.createObjectURL(new Blob([content])),link=document.createElement("a");link.href=url,link.setAttribute("download",project.id+".tanatlocarchive"),link.click(),swr.mutateOneProject({...project,archived:!0}),swr.mutateOneWorkspace(workspace)}catch(err){throw(0,notification.lt)(archive_errors.archive,err),err}},onUnarchiveServer=async(workspace,project,swr)=>{try{await api_project.Z.unarchiveFromServer({id:project.id}),swr.mutateOneProject({...project,archived:!1}),swr.mutateOneWorkspace(workspace)}catch(err){throw(0,notification.lt)(archive_errors.unarchiveServer,err),err}},onArchiveDelete=async project=>{try{await api_project.Z.deleteArchiveFile({id:project.id})}catch(err){(0,notification.lt)(archive_errors.deleteArchive,err)}},getFile=async file=>{let reader=new FileReader;return new Promise(resolve=>{reader.addEventListener("load",()=>{resolve(reader.result)}),reader.readAsArrayBuffer(file)})},onUpload=async(workspace,project,info,swr)=>{if("uploading"===info.file.status)return!0;if("done"===info.file.status)try{let archive=await getFile(info.file.originFileObj);await api_project.Z.unarchiveFromFile({id:project.id},Buffer.from(archive)),swr.mutateOneProject({...project,archived:!1}),swr.mutateOneWorkspace(workspace)}catch(err){(0,notification.lt)(archive_errors.upload,err)}return!1},Archive=param=>{let{disabled,workspace,project,swr}=param,[visible,setVisible]=(0,react.useState)(!1),[loading,setLoading]=(0,react.useState)(!1);return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(dialog.ZP,{visible:visible,loading:loading,title:"Archive",onCancel:()=>setVisible(!1),onOk:project.archived?void 0:async()=>{setLoading(!0);try{await onArchive(workspace,project,swr),setLoading(!1),setVisible(!1)}catch(err){throw setLoading(!1),err}},okButtonText:"Archive",children:project.archived?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(es_form.Z.Item,{label:"Restore archive from the server",tooltip:"This will restore the project from the server archive file.",children:(0,jsx_runtime.jsx)(es_button.Z,{loading:loading,async onClick(){setLoading(!0);try{await onUnarchiveServer(workspace,project,swr),setLoading(!1),setVisible(!1)}catch(err){setLoading(!1)}},children:"Restore archive from the server"})}),(0,jsx_runtime.jsx)(es_form.Z.Item,{label:"Restore archive from local file",tooltip:"This will restore the project from your local archive file (.tanatlocarchive file).",children:(0,jsx_runtime.jsx)(upload.Z,{action:"/api/noop",accept:".tanatlocarchive",showUploadList:!1,async onChange(info){let load=await onUpload(workspace,project,info,swr);setLoading(load),setVisible(load)},children:(0,jsx_runtime.jsx)(es_button.Z,{children:"Restore archive from archive file"})})}),(0,jsx_runtime.jsx)(es_form.Z.Item,{label:"Delete archive from the server",tooltip:"This will delete the archive file from the server, you will have to use a local copy to restore the project.",children:(0,jsx_runtime.jsx)(assets_button.m1,{loading:loading,bordered:!0,title:"Delete server archive",text:"Are you sure your want to delete the archive from the server?",onDelete:async()=>onArchiveDelete(project),children:"Delete server archive"})})]}):(0,jsx_runtime.jsxs)(typography.Z.Text,{children:["An archive will be downloaded and the project will not be editable anymore, archive the project \xab",project.title,"\xbb?"]})}),(0,jsx_runtime.jsx)(tooltip.Z,{title:project.archived?"Manage archive":"Archive",children:(0,jsx_runtime.jsx)(es_button.Z,{disabled:disabled,type:"link",icon:project.archived?(0,jsx_runtime.jsx)(ImportOutlined.Z,{}):(0,jsx_runtime.jsx)(HddOutlined.Z,{}),onClick:()=>setVisible(!0)})})]})};var list_Buffer=__webpack_require__(48764).lW;let ProjectList=param=>{let{user,page,workspace,projects,organizations,filter,sorter,swr}=param,containerRef=(0,react.useRef)(null),[loading,setLoading]=(0,react.useState)(!0),[list,setList]=(0,react.useState)([]),[height,setHeight]=(0,react.useState)(100),router=(0,next_router.useRouter)();(0,react.useEffect)(()=>{let div=containerRef.current;if(!div)return;let offsets=div.getBoundingClientRect(),top=offsets.top,totalHeight=window.innerHeight,newHeight=totalHeight-top;newHeight!==height&&setHeight(newHeight)}),(0,react.useEffect)(()=>{let currentList=projects.map(project=>{var ref,ref1,ref2,ref3,ref4;let snapshot;if(filter&&!(null===(ref1=null===(ref=project.title)||void 0===ref?void 0:ref.toLowerCase())||void 0===ref1?void 0:ref1.includes(filter.toLowerCase())))return;snapshot=project.archived?(0,jsx_runtime.jsx)(empty.Z,{description:"Archived project"}):project.avatar?(0,jsx_runtime.jsx)("img",{src:project&&list_Buffer.from(project.avatar).toString(),alt:"Tanatloc"}):(0,jsx_runtime.jsx)(empty.Z,{image:"images/empty.svg",description:"No preview yet."});let description=(0,jsx_runtime.jsxs)(space.Z,{direction:"vertical",className:"full-width text-left",children:[(0,jsx_runtime.jsxs)(typography.Z.Text,{children:[(0,jsx_runtime.jsx)("b",{children:"Created:"})," ",new Date(project.createddate).toLocaleDateString()]}),(0,jsx_runtime.jsxs)(typography.Z.Text,{children:[(0,jsx_runtime.jsx)("b",{children:"Last modified:"})," ",new Date(project.lastaccess).toLocaleDateString()]}),project.description&&(0,jsx_runtime.jsx)(typography.Z.Paragraph,{ellipsis:{rows:4,tooltip:!0},children:project.description})]}),owners=null==project?void 0:null===(ref2=project.owners)||void 0===ref2?void 0:ref2.map(o=>utils.Z.userToAvatar(o)),users=null==project?void 0:null===(ref3=project.users)||void 0===ref3?void 0:ref3.map(u=>utils.Z.userToAvatar(u)),groups=null==project?void 0:null===(ref4=project.groups)||void 0===ref4?void 0:ref4.map(g=>utils.Z.groupToAvatar(g));return{...project,snapshotRender:snapshot,descriptionRender:description,ownersRender:owners,usersRender:users,groupsRender:groups}}).filter(p=>p);switch(sorter){case"alphaAsc":currentList.sort((a,b)=>a.title.localeCompare(b.title));break;case"alphaDesc":currentList.sort((a,b)=>-1*a.title.localeCompare(b.title));break;case"modifiedDesc":currentList.sort((a,b)=>new Date(b.lastaccess).getTime()-new Date(a.lastaccess).getTime())}setList(currentList),setLoading(!1)},[projects,filter,sorter]);let openProject=project=>{router.push({pathname:"/project",query:{page:page,workspaceId:workspace.id,projectId:project.id}})};return loading||swr.loadingProjects?(0,jsx_runtime.jsx)(components_loading.Z.Simple,{}):list.length?(0,jsx_runtime.jsx)("div",{ref:containerRef,style:{height:height},children:(0,jsx_runtime.jsx)(space.Z,{className:"marginBottom-20",wrap:!0,align:"start",size:20,children:list.map(project=>{var ref,ref1,ref2,ref3;return(0,jsx_runtime.jsx)(card.Z,{title:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(typography.Z.Paragraph,{ellipsis:{rows:2,tooltip:!0},children:project.title}),project.archived&&(0,jsx_runtime.jsx)(tag.Z,{children:"Archived"})]}),className:"Project-Card"+(project.archived?" archive":""),cover:(0,jsx_runtime.jsxs)(carousel.Z,{className:"Project-Carousel",dots:{className:"Project-Carousel-dots"},children:[(0,jsx_runtime.jsx)("div",{className:"Project-Carousel-snapshot"+(project.archived?" archive":""),onClick:()=>!project.archived&&openProject({id:project.id}),children:project.snapshotRender}),(0,jsx_runtime.jsx)("div",{className:"Project-Carousel-description"+(project.archived?" archive":""),onClick:()=>!project.archived&&openProject({id:project.id}),children:project.descriptionRender})]}),actions:[(0,jsx_runtime.jsx)(Delete,{disabled:!(null==project?void 0:null===(ref=project.owners)||void 0===ref?void 0:ref.find(o=>o.id===(null==user?void 0:user.id))),workspace:{id:workspace.id,projects:workspace.projects},project:{id:project.id,title:project.title},swr:{mutateOneWorkspace:swr.mutateOneWorkspace,delOneProject:swr.delOneProject}},"delete"),(0,jsx_runtime.jsx)(Archive,{disabled:!(null==project?void 0:null===(ref1=project.owners)||void 0===ref1?void 0:ref1.find(o=>o.id===(null==user?void 0:user.id))),workspace:{id:workspace.id},project:{archived:project.archived,id:project.id,title:project.title},swr:{mutateOneWorkspace:swr.mutateOneWorkspace,mutateOneProject:swr.mutateOneProject}},"archive"),(0,jsx_runtime.jsx)(Share,{disabled:!(null==project?void 0:null===(ref2=project.owners)||void 0===ref2?void 0:ref2.find(o=>o.id===(null==user?void 0:user.id))),project:{id:project.id,title:project.title,groups:project.groups,users:project.users},organizations:organizations,swr:{mutateOneProject:swr.mutateOneProject},style:{buttonDark:!0}},"share"),(0,jsx_runtime.jsx)(Edit,{disabled:!(null==project?void 0:null===(ref3=project.owners)||void 0===ref3?void 0:ref3.find(o=>o.id===(null==user?void 0:user.id))),project:{id:project.id,title:project.title,description:project.description},swr:{mutateOneProject:swr.mutateOneProject}},"edit")],children:(0,jsx_runtime.jsxs)("div",{style:{padding:"6px 0",display:"grid",gridTemplateColumns:"10fr 1fr 20fr",gridTemplateRows:"auto auto"},children:[(0,jsx_runtime.jsx)("div",{children:"Admin:"}),(0,jsx_runtime.jsx)("div",{}),(0,jsx_runtime.jsx)("div",{children:"Shared with:"}),(0,jsx_runtime.jsx)(avatar.C.Group,{maxCount:5,children:project.ownersRender}),(0,jsx_runtime.jsx)(divider.Z,{type:"vertical",style:{height:"80%",borderColor:"#f0f0f0"}}),(0,jsx_runtime.jsxs)(avatar.C.Group,{children:[project.usersRender,project.groupsRender]})]})},project.id)})})}):(0,jsx_runtime.jsx)(empty.Z,{image:"images/empty.svg",className:"Project-Empty",description:filter?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["No project found with the current search"," ",(0,jsx_runtime.jsx)("span",{className:"Project-Empty-search-value",children:filter}),"..."]}):(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"No project for now... Get started!"})})},workspace_edit_errors={update:"Unable to update workspace"},edit_onEdit=async(workspace,values,swr)=>{try{let newWorkspace=utils.Z.deepCopy(workspace);workspace.name=values.name,await api_workspace.update({id:workspace.id},[{key:"name",value:values.name}]),swr.mutateOneWorkspace(newWorkspace)}catch(err){throw(0,notification.lt)(workspace_edit_errors.update,err),err}},edit_Edit=param=>{let{workspace,swr}=param,[visible,setVisible]=(0,react.useState)(!1),[loading,setLoading]=(0,react.useState)(!1);return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(assets_button.w6,{bordered:!0,dark:!0,onEdit:()=>setVisible(!0)}),(0,jsx_runtime.jsx)(dialog.ZP,{visible:visible,loading:loading,title:"Edit the workspace",initialValues:{name:workspace.name},onCancel:()=>setVisible(!1),async onOk(values){setLoading(!0);try{await edit_onEdit(workspace,values,swr),setLoading(!1),setVisible(!1)}catch(err){throw setLoading(!1),err}},children:(0,jsx_runtime.jsx)(es_form.Z.Item,{label:"Name",name:"name",rules:[{required:!0,message:"Name is required"},{max:50,message:"Max 50 characters"}],children:(0,jsx_runtime.jsx)(input.Z,{placeholder:"Workspace's name"})})})]})},workspace_delete_errors={del:"Unable to delete workspace"},delete_onDelete=async(workspace,swr)=>{try{await api_workspace.del({id:workspace.id}),swr.delOneWorkspace({id:workspace.id})}catch(err){throw(0,notification.lt)(workspace_delete_errors.del,err),err}},delete_Delete=param=>{let{workspace,swr}=param,[loading,setLoading]=(0,react.useState)(!1);return(0,jsx_runtime.jsx)(assets_button.m1,{bordered:!0,loading:loading,text:"The projects contained in this workspace will be lost.",async onDelete(){setLoading(!0);try{await delete_onDelete(workspace,swr)}finally{setLoading(!1)}}})},workspace_errors={projects:"Error while loading projects",update:"Unable to update workspace"},workspace_Workspace=param=>{var ref,ref1,ref2,ref3,ref4,ref5;let{user,page,workspace,organizations,swr}=param,[filter,setFilter]=(0,react.useState)(),[sorter,setSorter]=(0,react.useState)(),[projects,{addOneProject,delOneProject,mutateOneProject,errorProjects,loadingProjects}]=api_project.Z.useProjects(null==workspace?void 0:workspace.projects);return(0,react.useEffect)(()=>{errorProjects&&(0,notification.lt)(workspace_errors.projects,errorProjects)},[errorProjects]),(0,jsx_runtime.jsxs)(layout.Z,{className:"no-scroll",children:[(0,jsx_runtime.jsx)(page_header.Z,{className:"inWorkspace-PageHeader",backIcon:!1,footer:(0,jsx_runtime.jsxs)(space.Z,{direction:"horizontal",size:"large",className:"full-width lastchild-marginLeft-auto",children:[(0,jsx_runtime.jsx)(input.Z,{placeholder:"Enter a project name (case sensitive)",value:filter,onChange:event=>setFilter(event.target.value),style:{width:500},suffix:(0,jsx_runtime.jsx)(SearchOutlined.Z,{className:"text-light"})}),(null==workspace?void 0:null===(ref=workspace.owners)||void 0===ref?void 0:ref.find(o=>o.id===user.id))?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(Add,{workspace:{id:workspace.id,projects:workspace.projects},swr:{mutateOneWorkspace:swr.mutateOneWorkspace,addOneProject}}),(0,jsx_runtime.jsxs)(space.Z,{size:8,children:[(0,jsx_runtime.jsx)(edit_Edit,{workspace:{id:workspace.id,name:workspace.name},swr:{mutateOneWorkspace:swr.mutateOneWorkspace}}),(0,jsx_runtime.jsx)(Share,{workspace:{id:workspace.id,name:workspace.name,groups:workspace.groups,users:workspace.users},organizations:organizations,swr:{mutateOneWorkspace:swr.mutateOneWorkspace},style:{buttonDark:!0,buttonBordered:!0}}),(0,jsx_runtime.jsx)(delete_Delete,{workspace:{id:workspace.id},swr:{delOneWorkspace:swr.delOneWorkspace}})]})]}):(0,jsx_runtime.jsx)("div",{})]}),children:(null===(ref1=workspace.users)||void 0===ref1?void 0:ref1.length)||(null===(ref2=workspace.groups)||void 0===ref2?void 0:ref2.length)?(0,jsx_runtime.jsxs)("div",{className:"inWorkspace-shared",children:[(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("span",{className:"marginRight-10",children:"Admin:"}),(0,jsx_runtime.jsx)(avatar.C.Group,{maxCount:5,children:null===(ref3=workspace.owners)||void 0===ref3?void 0:ref3.map(u=>utils.Z.userToAvatar(u))})]}),(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("span",{className:"marginRight-10",children:"Shared with:"}),(0,jsx_runtime.jsx)(avatar.C.Group,{maxCount:5,children:null===(ref4=workspace.users)||void 0===ref4?void 0:ref4.map(u=>utils.Z.userToAvatar(u))}),(0,jsx_runtime.jsx)(avatar.C.Group,{maxCount:5,children:null===(ref5=workspace.groups)||void 0===ref5?void 0:ref5.map(g=>utils.Z.groupToAvatar(g))})]})]}):null}),(0,jsx_runtime.jsx)(tabs.Z,{className:"inWorkspace-Tabs",items:[{key:"modifiedDesc",label:"Last modified"},{key:"alphaAsc",label:"Name (A-Z)"},{key:"alphaDesc",label:"Name (Z-A)"}],defaultActiveKey:"modifiedDesc",onChange:key=>setSorter(key)}),(0,jsx_runtime.jsx)(layout.Z.Content,{className:"scroll",children:(0,jsx_runtime.jsx)(ProjectList,{user:user,page:page,workspace:{id:workspace.id,projects:workspace.projects},projects:projects,organizations:organizations,filter:filter,sorter:sorter,swr:{mutateOneWorkspace:swr.mutateOneWorkspace,delOneProject,mutateOneProject,loadingProjects}})})]})},workspace_add_errors={add:"Unable to add workspace"},onOk=async(values,swr)=>{try{let workspace=await api_workspace.add(values);swr.addOneWorkspace(workspace)}catch(err){throw(0,notification.lt)(workspace_add_errors.add,err),err}},add_Add=param=>{let{swr}=param,[loading,setLoading]=(0,react.useState)(!1),[visible,setVisible]=(0,react.useState)(!1);return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(assets_button.HS,{onAdd:()=>setVisible(!0),children:"Create a new workspace"}),(0,jsx_runtime.jsx)(dialog.ZP,{visible:visible,loading:loading,title:"Create a new workspace",onCancel:()=>setVisible(!1),async onOk(values){setLoading(!0);try{await onOk(values,swr),setLoading(!1),setVisible(!1)}catch(err){throw setLoading(!1),err}},children:(0,jsx_runtime.jsx)(es_form.Z.Item,{label:"Name",name:"name",rules:[{required:!0,message:"Name is required"},{max:50,message:"Max 50 characters"}],children:(0,jsx_runtime.jsx)(input.Z,{placeholder:"Workspace's name"})})})]})},list_errors={add:"Unable to add workspace"},list_onOk=async(router,values,swr)=>{try{let workspace=await api_workspace.add(values);swr.addOneWorkspace(workspace),router.push({pathname:"/dashboard",query:{page:"workspaces",workspaceId:workspace.id}})}catch(err){throw(0,notification.lt)(list_errors.add,err),err}},WorkspacesList=param=>{let{user,workspaces,organizations,swr}=param,[visible,setVisible]=(0,react.useState)(!1),[loading,setLoading]=(0,react.useState)(!1),router=(0,next_router.useRouter)(),{page,workspaceId}=router.query;return(0,jsx_runtime.jsxs)(layout.Z,{className:"inDashboard Workspace no-scroll",children:[(0,jsx_runtime.jsx)(page_header.Z,{className:"inDashboard-PageHeader",backIcon:!1,title:(0,jsx_runtime.jsx)(typography.Z.Title,{level:2,className:"inDashboard-PageHeader-title",children:"Workspaces"}),footer:(0,jsx_runtime.jsx)(divider.Z,{})}),(0,jsx_runtime.jsx)(layout.Z.Content,{className:"no-scroll",children:workspaces.length?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(dialog.ZP,{visible:visible,loading:loading,title:"Create a new workspace",onCancel:()=>setVisible(!1),async onOk(values){setLoading(!0);try{await list_onOk(router,values,swr),setLoading(!1),setVisible(!1)}catch(err){throw setLoading(!1),err}},children:(0,jsx_runtime.jsx)(es_form.Z.Item,{label:"Name",name:"name",rules:[{required:!0,message:"Name is required"},{max:50,message:"Max 50 characters"}],children:(0,jsx_runtime.jsx)(input.Z,{placeholder:"Workspace's name"})})}),(0,jsx_runtime.jsx)(tabs.Z,{type:"editable-card",className:"inDashboard-Tabs no-scroll",items:workspaces.map(workspace=>({key:workspace.id,label:workspace.name,className:"no-scroll",closable:!1,children:(0,jsx_runtime.jsx)(workspace_Workspace,{user:user,page:page||menuItems.workspaces.key,workspace:{id:workspace.id,name:workspace.name,projects:workspace.projects,owners:workspace.owners,users:workspace.users,groups:workspace.groups},organizations:organizations,swr:{delOneWorkspace:swr.delOneWorkspace,mutateOneWorkspace:swr.mutateOneWorkspace}})})),defaultActiveKey:workspaceId||"1",onEdit:()=>setVisible(!0)})]}):(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsx)(empty.Z,{image:"images/empty.svg",description:"No workspace for now. Get started !",children:(0,jsx_runtime.jsx)(add_Add,{swr:{addOneWorkspace:swr.addOneWorkspace}})})})})]})};var UserOutlined=__webpack_require__(87547),UploadOutlined=__webpack_require__(88484),error=__webpack_require__(4415),api_user=__webpack_require__(55734),api_avatar=__webpack_require__(5094),information_Buffer=__webpack_require__(48764).lW;let information_errors={update:"Unable to update informations",upload:"Unable to upload image",badFormat:"Supported formats: jpg, png",badSize:"Image must be smaller than 5MB"},beforeUpload=file=>{let goodFormat="image/jpeg"===file.type||"image/png"===file.type;goodFormat||(0,notification.lt)(information_errors.badFormat);let goodSize=file.size/1024/1024<1;return goodSize||(0,notification.lt)(information_errors.badSize),goodFormat&&goodSize},getBase64=async file=>{let reader=new FileReader;return new Promise(resolve=>{reader.addEventListener("load",()=>{resolve(reader.result)}),reader.readAsDataURL(file)})},onChange=async(user,info,swr)=>{if("uploading"===info.file.status)return!0;if("done"!==info.file.status)return!1;try{let img=await getBase64(info.file.originFileObj);await api_avatar.Z.add({name:info.file.name,uid:info.file.uid,data:img}),swr.mutateUser({...user,avatar:information_Buffer.from(img)})}catch(err){(0,notification.lt)(information_errors.upload,err)}return!1},onFinish=async(user,values,swr)=>{try{let toUpdate=[];if(user.email!==values.email&&toUpdate.push({key:"email",value:values.email}),user.firstname!==values.firstname&&toUpdate.push({key:"firstname",value:values.firstname}),user.lastname!==values.lastname&&toUpdate.push({key:"lastname",value:values.lastname}),!toUpdate.length)return;await api_user.Z.update(toUpdate),swr.mutateUser({email:values.email,firstname:values.firstname,lastname:values.lastname}),toUpdate.find(u=>"email"===u.key)&&(0,notification.Ur)("Changes saved","A validation email has been send to "+values.email)}catch(err){throw new error.H({title:information_errors.update,err})}},Information=param=>{let{user,swr}=param,[uploading,setUploading]=(0,react.useState)(!1),[loading,setLoading]=(0,react.useState)(!1),[formError,setFormError]=(0,react.useState)();return(0,jsx_runtime.jsx)(card.Z,{title:"Contact Details",children:(0,jsx_runtime.jsxs)(space.Z,{direction:"horizontal",className:"Account-Information",children:[(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)(avatar.C,{size:128,src:user.avatar&&information_Buffer.from(user.avatar).toString(),icon:(0,jsx_runtime.jsx)(UserOutlined.Z,{})}),(0,jsx_runtime.jsx)(upload.Z,{action:"/api/noop",accept:".jpg,.png",showUploadList:!1,beforeUpload:beforeUpload,async onChange(info){let upload=await onChange(user,info,swr);setUploading(upload)},children:(0,jsx_runtime.jsx)(es_button.Z,{loading:uploading,icon:(0,jsx_runtime.jsx)(UploadOutlined.Z,{}),children:"Upload new"})})]}),(0,jsx_runtime.jsx)("div",{children:(0,jsx_runtime.jsxs)(es_form.Z,{labelCol:{span:4},className:"max-width-500",initialValues:{email:user.email,firstname:user.firstname||"",lastname:user.lastname||""},async onFinish(values){setLoading(!0);try{await onFinish(user,values,swr),setFormError(null)}catch(err){setFormError(err)}finally{setLoading(!1)}},children:[(0,jsx_runtime.jsx)(es_form.Z.Item,{label:"Email",name:"email",rules:[is_electron_default()()?{type:"email",message:"This is not a valid email"}:void 0,{max:50,message:"Max 50 characters"}].filter(r=>r),children:(0,jsx_runtime.jsx)(input.Z,{disabled:is_electron_default()()})}),(0,jsx_runtime.jsx)(es_form.Z.Item,{label:"First name",name:"firstname",rules:[{max:50,message:"Max 50 characters"}],children:(0,jsx_runtime.jsx)(input.Z,{})}),(0,jsx_runtime.jsx)(es_form.Z.Item,{label:"Last name",name:"lastname",rules:[{max:50,message:"Max 50 characters"}],children:(0,jsx_runtime.jsx)(input.Z,{})}),(0,jsx_runtime.jsx)(notification.Xq,{error:formError}),(0,jsx_runtime.jsx)(es_form.Z.Item,{wrapperCol:{offset:4},children:(0,jsx_runtime.jsx)(es_button.Z,{loading:loading,type:"primary",htmlType:"submit",children:"Save changes"})})]})})]})})};var assets_input=__webpack_require__(47455);let password_errors={check:"Unable to check password",update:"Unable to update password",passwordMismatch:"Password and confirmation mismatch",invalid:"Current password is not valid"},password_onFinish=async(user,values)=>{let current;try{current=await api_user.Z.check({email:user.email,password:values.password})}catch(err){throw new error.H({title:password_errors.check,err})}if(!current.valid)throw new error.H({title:password_errors.invalid});try{await api_user.Z.update([{type:"crypt",key:"password",value:values.newPassword}]),(0,notification.Ur)("Your password has been changed successfully")}catch(err1){throw new error.H({title:password_errors.update,err:err1})}},Password=param=>{let{user}=param,[loading,setLoading]=(0,react.useState)(!1),[formError,setFormError]=(0,react.useState)();return(0,jsx_runtime.jsx)(card.Z,{title:"Your Password",children:(0,jsx_runtime.jsxs)(es_form.Z,{labelCol:{offset:2},wrapperCol:{offset:2},className:"max-width-500",layout:"vertical",async onFinish(values){setLoading(!0);try{await password_onFinish(user,values),setFormError(null)}catch(err){setFormError(err)}finally{setLoading(!1)}},name:"passwordForm",children:[(0,jsx_runtime.jsx)(es_form.Z.Item,{label:"Current password",name:"password",rules:[{required:!0,message:"Current password is required"}],children:(0,jsx_runtime.jsx)(input.Z.Password,{placeholder:"Current password"})}),(0,jsx_runtime.jsx)(assets_input.o,{name:"newPassword",label:"New password",inputPlaceholder:"Enter a new password",required:!0}),(0,jsx_runtime.jsx)(es_form.Z.Item,{label:"Password confirmation",name:"passwordConfirm",rules:[{required:!0,message:"Password confirmation is required"},param=>{let{getFieldValue}=param;return{validator:(_,value)=>value&&getFieldValue("newPassword")!==value?Promise.reject(password_errors.passwordMismatch):Promise.resolve()}}],children:(0,jsx_runtime.jsx)(input.Z.Password,{placeholder:"Confirm your new password"})}),(0,jsx_runtime.jsx)(notification.Xq,{error:formError}),(0,jsx_runtime.jsx)(es_form.Z.Item,{children:(0,jsx_runtime.jsx)(space.Z,{children:(0,jsx_runtime.jsx)(es_button.Z,{type:"primary",htmlType:"submit",loading:loading,children:"Modify password"})})})]})})},base=is_electron_default()()?"http://localhost:3000":"",logout=async()=>{await fetch(base+"/api/logout")},account_delete_errors={del:"Unable to delete user"},account_delete_onDelete=async swr=>{try{await api_user.Z.del(),await logout(),swr.clearUser()}catch(err){throw(0,notification.lt)(account_delete_errors.del,err),err}},account_delete_Delete=param=>{let{swr}=param,[loading,setLoading]=(0,react.useState)(!1);return(0,jsx_runtime.jsx)(card.Z,{title:"Delete your account",children:(0,jsx_runtime.jsx)(assets_button.m1,{title:"Delete your account",text:"This action cannot be undone. If you delete your account, you will permanently lose your workspaces and projects.",bordered:!0,loading:loading,async onDelete(){setLoading(!0);try{await account_delete_onDelete(swr)}finally{setLoading(!1)}},children:"Delete your account"})})};var spin=__webpack_require__(11382),api_plugins=__webpack_require__(10843),es_select=__webpack_require__(40038),html_react_parser=__webpack_require__(25935),api_plugin=__webpack_require__(71270);let dialog_errors={update:"Unable to update plugins"},inputItem=(item,key)=>(0,jsx_runtime.jsx)(es_form.Z.Item,{name:key,label:item.label,htmlFor:"input-"+key,tooltip:item.tooltip,rules:item.rules,children:(0,jsx_runtime.jsx)(input.Z,{id:"input-"+key,autoComplete:"off",...item.props||{}})},item.label),textareaItem=(item,key)=>(0,jsx_runtime.jsx)(es_form.Z.Item,{name:key,label:item.label,htmlFor:"input-"+key,tooltip:item.tooltip,rules:item.rules,children:(0,jsx_runtime.jsx)(input.Z.TextArea,{id:"input-"+key,autoComplete:"off",...item.props||{}})},item.label),passwordItem=(item,key)=>(0,jsx_runtime.jsx)(es_form.Z.Item,{name:key,label:item.label,htmlFor:"input-"+key,tooltip:item.tooltip,rules:item.rules,children:(0,jsx_runtime.jsx)(input.Z,{id:"input-"+key,type:"password",autoComplete:"off",...item.props||{}})},item.label),selectItem=(item,key)=>(0,jsx_runtime.jsx)(es_form.Z.Item,{name:key,label:item.label,htmlFor:"select-"+key,tooltip:item.tooltip,rules:item.rules,children:(0,jsx_runtime.jsx)(es_select.Z,{id:"select-"+key,children:item.options.map(option=>(0,jsx_runtime.jsx)(es_select.Z.Option,{value:option,...item.props||{},children:option},option))})},item.label),dialog_onFinish=async(plugin,edit,values,swr)=>{try{var ref,ref1;if(edit){let initialPlugin=utils.Z.deepCopy(plugin);Object.keys(values).forEach(key=>{initialPlugin.configuration[key].value=values[key]}),initialPlugin.needReInit=!0,await api_plugin.Z.update(initialPlugin),null===(ref=swr.mutateOnePlugin)||void 0===ref||ref.call(swr,initialPlugin)}else{let newPlugin=utils.Z.deepCopy(plugin);Object.keys(values).forEach(key=>{newPlugin.configuration[key].value=values[key]}),await api_plugin.Z.add(newPlugin),null===(ref1=swr.addOnePlugin)||void 0===ref1||ref1.call(swr,newPlugin)}}catch(err){throw(0,notification.lt)(dialog_errors.update,err),err}},PluginDialog=param=>{let{plugin,swr,edit}=param,[visible,setVisible]=(0,react.useState)(!1),[loading,setLoading]=(0,react.useState)(!1),[initialValues,setInitialValues]=(0,react.useState)({});return(0,react.useEffect)(()=>{let currentInitialValues={};Object.keys(plugin.configuration).forEach(key=>{var _value;currentInitialValues[key]=null!==(_value=plugin.configuration[key].value)&&void 0!==_value?_value:plugin.configuration[key].default}),setInitialValues(currentInitialValues)},[null==plugin?void 0:plugin.configuration]),(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(dialog.ZP,{title:plugin.name,visible:visible,initialValues:initialValues,onCancel:()=>setVisible(!1),async onOk(values){setLoading(!0);try{await dialog_onFinish(plugin,!!edit,values,swr),setLoading(!1),setVisible(!1)}catch(err){throw setLoading(!1),err}},loading:loading,children:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(typography.Z.Text,{children:(0,html_react_parser.ZP)(plugin.description||"")}),Object.keys(plugin.configuration).map(key=>{let item=plugin.configuration[key];return"input"===item.type?inputItem(item,key):"textarea"===item.type?textareaItem(item,key):"password"===item.type?passwordItem(item,key):"select"===item.type?selectItem(item,key):(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{})})]})}),edit?(0,jsx_runtime.jsx)(assets_button.w6,{onEdit:()=>setVisible(!0),children:"Edit"}):(0,jsx_runtime.jsxs)(assets_button.HS,{onAdd:()=>setVisible(!0),children:["Add a new \xab",plugin.name,"\xbb configuration"]})]})},plugin_delete_errors={del:"Unable to delete plugin"},plugin_delete_onDelete=async(plugin,swr)=>{try{await api_plugin.Z.del({uuid:plugin.uuid}),swr.delOnePlugin(plugin)}catch(err){throw(0,notification.lt)(plugin_delete_errors.del,err),err}},plugin_delete_Delete=param=>{var ref;let{plugin,swr}=param,[loading,setLoading]=(0,react.useState)(!1);return(0,jsx_runtime.jsx)(assets_button.m1,{loading:loading,title:"Delete plugin",text:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["Are you sure you want to delete the plugin"," ",(0,jsx_runtime.jsx)(typography.Z.Text,{strong:!0,children:null===(ref=plugin.configuration.name)||void 0===ref?void 0:ref.value}),"?"]}),async onDelete(){setLoading(!0);try{await plugin_delete_onDelete(plugin,swr)}finally{setLoading(!1)}},children:"Delete"})},List=param=>{let{plugin,plugins,swr}=param,[list,setList]=(0,react.useState)([]);return(0,react.useEffect)(()=>{let pluginsList=plugins.map(p=>{var ref;if(p.key!==plugin.key)return;let configuration=p.configuration,children=Object.keys(configuration).map(key=>{let content;if("name"!==key){if("textarea"===configuration[key].type){let code=configuration[key].value;content=(0,jsx_runtime.jsx)(typography.Z.Paragraph,{children:(0,jsx_runtime.jsx)("pre",{children:(0,jsx_runtime.jsx)("code",{children:code})})})}else content="password"===configuration[key].type?(0,jsx_runtime.jsx)(typography.Z.Text,{children:"******"}):(0,jsx_runtime.jsx)(typography.Z.Text,{children:configuration[key].value||"unset"});return(0,jsx_runtime.jsxs)(typography.Z.Paragraph,{children:[(0,jsx_runtime.jsxs)(typography.Z.Text,{strong:!0,children:[configuration[key].label,":"]})," ",content]},key)}}).filter(c=>c);return(0,jsx_runtime.jsx)(card.Z,{title:null===(ref=configuration.name)||void 0===ref?void 0:ref.value,actions:[(0,jsx_runtime.jsx)(plugin_delete_Delete,{plugin:{uuid:p.uuid,configuration:p.configuration},swr:{delOnePlugin:swr.delOnePlugin}},"delete"),(0,jsx_runtime.jsx)(PluginDialog,{plugin:{uuid:p.uuid,key:p.key,name:p.name,needInit:p.needInit,configuration:p.configuration,inUseConfiguration:p.inUseConfiguration},swr:{mutateOnePlugin:swr.mutateOnePlugin},edit:!0},"plugin")],children:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(typography.Z.Text,{children:(0,html_react_parser.ZP)(p.description||"")}),children.length?children:(0,jsx_runtime.jsx)(typography.Z.Text,{children:"No configuration data"})]})},p.uuid)}).filter(c=>c);setList(pluginsList)},[plugin,plugins,swr]),(0,jsx_runtime.jsx)(space.Z,{direction:"horizontal",wrap:!0,size:20,children:list})},plugin_errors={plugins:"Error while loading plugins"},Plugin=param=>{let{plugin}=param,[plugins,{addOnePlugin,delOnePlugin,mutateOnePlugin,errorPlugins,loadingPlugins}]=api_plugin.Z.usePlugins();return((0,react.useEffect)(()=>{errorPlugins&&(0,notification.lt)(plugin_errors.plugins,errorPlugins)},[errorPlugins]),loadingPlugins)?(0,jsx_runtime.jsx)(spin.Z,{}):(0,jsx_runtime.jsxs)(space.Z,{direction:"vertical",className:"full-width",children:[(0,jsx_runtime.jsx)(PluginDialog,{plugin:{uuid:plugin.uuid,key:plugin.key,name:plugin.name,description:plugin.description,needInit:plugin.needInit,configuration:plugin.configuration,inUseConfiguration:plugin.inUseConfiguration},swr:{addOnePlugin}}),(0,jsx_runtime.jsx)(List,{plugin:{key:plugin.key},plugins:plugins,swr:{delOnePlugin,mutateOnePlugin}})]})},hpc_errors={plugins:"Unable to load plugins"},pluginsList=async()=>{try{let plugins=await api_plugins.Z.list(),HPCPlugins=plugins.filter(plugin=>"HPC"===plugin.category);if(HPCPlugins.length)return HPCPlugins.map(plugin=>(0,jsx_runtime.jsx)(card.Z,{title:plugin.name,children:(0,jsx_runtime.jsx)(Plugin,{plugin:{key:plugin.key,name:plugin.name,description:plugin.description,needInit:!!plugin.needInit,configuration:plugin.configuration,inUseConfiguration:plugin.inUseConfiguration}})},plugin.key));return[(0,jsx_runtime.jsx)(card.Z,{title:"No access",children:"You do not have access to any HPC plugin. Request it."},"no-access")]}catch(err){return(0,notification.lt)(hpc_errors.plugins,err),[(0,jsx_runtime.jsx)(card.Z,{title:"Error",children:"Something led to an error. Please try again later."},"error")]}},HPC=()=>{let[list,setList]=(0,react.useState)([(0,jsx_runtime.jsx)(card.Z,{title:"Loading",children:(0,jsx_runtime.jsx)(spin.Z,{})},"loading")]);return(0,react.useEffect)(()=>{pluginsList().then(setList)},[]),(0,jsx_runtime.jsx)(space.Z,{direction:"vertical",className:"full-width scroll",size:20,children:list})},account_onChange=(router,key)=>{router.replace({pathname:"/dashboard",query:{page:"account",tab:key}})},Account=param=>{let{user,swr}=param,router=(0,next_router.useRouter)(),{tab}=router.query,tabItems=[];return tabItems.push({key:"personal",label:"Personal Information",children:(0,jsx_runtime.jsxs)(space.Z,{direction:"vertical",className:"full-width",size:20,children:[(0,jsx_runtime.jsx)(Information,{user:{email:user.email,firstname:user.firstname,lastname:user.lastname,avatar:user.avatar},swr:{mutateUser:swr.mutateUser}}),!is_electron_default()()&&(0,jsx_runtime.jsx)(account_delete_Delete,{swr:{clearUser:swr.clearUser}})]})}),is_electron_default()()||tabItems.push({key:"security",label:"Security",children:(0,jsx_runtime.jsx)(space.Z,{direction:"vertical",className:"full-width",size:20,children:(0,jsx_runtime.jsx)(Password,{user:{email:user.email}})})}),tabItems.push({key:"hpc",label:"HPC Providers",children:(0,jsx_runtime.jsx)(HPC,{})}),(0,jsx_runtime.jsxs)(layout.Z,{className:"inDashboard Account no-scroll",children:[(0,jsx_runtime.jsx)(page_header.Z,{className:"inDashboard-PageHeader",backIcon:!1,title:(0,jsx_runtime.jsx)(typography.Z.Title,{level:2,className:"inDashboard-PageHeader-title",children:"Account Settings"}),footer:(0,jsx_runtime.jsx)(divider.Z,{})}),(0,jsx_runtime.jsx)(layout.Z.Content,{className:"no-scroll",children:(0,jsx_runtime.jsx)(tabs.Z,{className:"inDashboard-Tabs no-scroll",type:"card",items:tabItems,defaultActiveKey:tab||"personal",onChange:key=>account_onChange(router,key)})})]})};var ArrowLeftOutlined=__webpack_require__(82826);let useOrganizations=()=>{let{data,error,mutate}=(0,dist.ZP)("/api/organizations",call._),organizations=(null==data?void 0:data.organizations)||[],addOne=(0,react.useCallback)(organization=>{let newOrganizations=[...organizations,{...organization,pendingowners:[],users:[],pendingusers:[],groups:[]}];mutate({organizations:newOrganizations})},[organizations,mutate]),delOne=(0,react.useCallback)(organization=>{let filteredOrganizations=organizations.filter(o=>o.id!==organization.id);mutate({organizations:filteredOrganizations})},[organizations,mutate]),mutateOne=(0,react.useCallback)(organization=>{let mutatedOrganizations=organizations.map(o=>(o.id===organization.id&&(o={...o,...organization}),o));mutate({organizations:mutatedOrganizations})},[organizations,mutate]);return[organizations,{addOneOrganization:addOne,delOneOrganization:delOne,mutateOneOrganization:mutateOne,errorOrganizations:error,loadingOrganizations:!data}]},add_add=async organization=>{let response=await (0,call.R)("/api/organization",{method:"POST",headers:{Accept:"application/json"},body:JSON.stringify(organization)});return response.json()},update_update=async(organization,data)=>{await (0,call.R)("/api/organization",{method:"PUT",body:JSON.stringify({organization,data})})},del_del=async organization=>{await (0,call.R)("/api/organization",{method:"DELETE",body:JSON.stringify(organization)})},accept=async organization=>{await (0,call.R)("/api/organization/"+organization.id,{method:"PUT"})},decline=async organization=>{await (0,call.R)("/api/organization/"+organization.id,{method:"POST"})},quit=async organization=>{await (0,call.R)("/api/organization/"+organization.id,{method:"DELETE"})};var api_organization={useOrganizations:useOrganizations,add:add_add,update:update_update,del:del_del,accept:accept,decline:decline,quit:quit},table=__webpack_require__(70584);let users_add_errors={add:"Unable to add user",existing:"This user already exists or its invite is pending"},checkAlreadyAdded=(user,organization)=>{var ref,ref1,ref2,ref3;let inOwners=null===(ref=organization.owners)||void 0===ref?void 0:ref.find(o=>o.email===user.email),inPendingowners=null===(ref1=organization.pendingowners)||void 0===ref1?void 0:ref1.find(po=>po.email===user.email),inUsers=null===(ref2=organization.users)||void 0===ref2?void 0:ref2.find(u=>u.email===user.email),inPendingusers=null===(ref3=organization.pendingusers)||void 0===ref3?void 0:ref3.find(pu=>pu.email===user.email);return inOwners||inPendingowners||inUsers||inPendingusers},add_onFinish=async(organization,dBkey,values,swr)=>{let exists=checkAlreadyAdded(values,organization);if(exists)throw(0,notification.lt)(users_add_errors.existing),Error(users_add_errors.existing);try{await api_organization.update(organization,[{key:dBkey,type:"array",method:"append",value:values.email.trim()}]);let newOrganization=utils.Z.deepCopy(organization);newOrganization[dBkey]=[...newOrganization[dBkey],{email:values.email}],swr.mutateOneOrganization(newOrganization)}catch(err){throw(0,notification.lt)(users_add_errors.add,err),err}},users_add_Add=param=>{let{title,organization,dBkey,swr}=param,[visible,setVisible]=(0,react.useState)(!1),[loading,setLoading]=(0,react.useState)(!1);return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(dialog.ZP,{visible:visible,loading:loading,title:title,onCancel:()=>setVisible(!1),async onOk(values){setLoading(!0);try{await add_onFinish(organization,dBkey,values,swr),setLoading(!1),setVisible(!1)}catch(err){throw setLoading(!1),err}},children:(0,jsx_runtime.jsx)(es_form.Z.Item,{name:"email",label:"Email",rules:[{required:!0,message:"Email is required"}],children:(0,jsx_runtime.jsx)(input.Z,{})})}),(0,jsx_runtime.jsx)(assets_button.HS,{onAdd:()=>setVisible(!0),children:title})]})},users_delete_errors={del:"Unable to delete user"},users_delete_onDelete=async(organization,user,dBkey,swr)=>{try{await api_organization.update(organization,[{key:dBkey,type:"array",method:"remove",value:user.id}]);let newOrganization=utils.Z.deepCopy(organization);newOrganization[dBkey]=newOrganization[dBkey].filter(u=>u.id!==user.id),swr.mutateOneOrganization(newOrganization)}catch(err){throw(0,notification.lt)(users_delete_errors.del,err),err}},users_delete_Delete=param=>{let{disabled,user,organization,dBkey,swr}=param,[loading,setLoading]=(0,react.useState)(!1),setName=(0,react.useCallback)(u=>u.firstname||u.lastname?u.firstname+" "+u.lastname:u.email,[]);return(0,jsx_runtime.jsx)(assets_button.m1,{bordered:!0,disabled:disabled,title:"Delete organization",text:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["Are you sure you want to delete the user"," ",(0,jsx_runtime.jsx)(typography.Z.Text,{strong:!0,children:setName(user)}),"?"]}),loading:loading,async onDelete(){setLoading(!0);try{await users_delete_onDelete(organization,user,dBkey,swr)}finally{setLoading(!1)}}})},Users=param=>{var ref,ref1,ref2;let{organization,swr}=param,[scrollAdmin,setScrollAdmin]=(0,react.useState)(),[scrollUsers,setScrollUsers]=(0,react.useState)(),refWrapper=(0,react.useRef)(null),refTableAdmin=(0,react.useRef)(null),refTableUsers=(0,react.useRef)(null),avatarRender=(_,user)=>utils.Z.userToAvatar(user),ownerActionsRender=owner=>(0,jsx_runtime.jsx)(users_delete_Delete,{disabled:organization.owners.length<2&&!owner.pending,user:{id:owner.id,email:owner.email},organization:{id:organization.id,owners:organization.owners,pendingowners:organization.pendingowners,users:organization.users,pendingusers:organization.pendingusers},dBkey:owner.pending?"pendingowners":"owners",swr:{mutateOneOrganization:swr.mutateOneOrganization}}),userActionsRender=user=>(0,jsx_runtime.jsx)(users_delete_Delete,{user:{id:user.id,email:user.email,firstname:user.firstname,lastname:user.lastname},organization:{id:organization.id,owners:organization.owners,pendingowners:organization.pendingowners,users:organization.users,pendingusers:organization.pendingusers},dBkey:user.pending?"pendingusers":"users",swr:{mutateOneOrganization:swr.mutateOneOrganization}}),columns=[{key:"avatar",dataIndex:"avatar",render:avatarRender},{key:"lastname",title:"Lastname",dataIndex:"lastname"},{key:"firstname",title:"Firstname",dataIndex:"firstname"},{key:"email",title:"Email",dataIndex:"email"}],ownersColumns=[...columns,{key:"actions",title:"Actions",align:"center",fixed:"right",width:75,render:ownerActionsRender}],usersColumns=[...columns,{key:"actions",title:"Actions",align:"center",fixed:"right",width:75,render:userActionsRender}],onResize=(0,react.useCallback)(()=>{let table=refWrapper.current;if(!table)return;let wrapperHeight=table.clientHeight-15,eachSpace=wrapperHeight/2-39-12-32-20-75,tableAdminHeight=table.clientHeight,tableUsersHeight=table.clientHeight;tableAdminHeight>eachSpace?setScrollAdmin({y:eachSpace}):setScrollAdmin(void 0),tableUsersHeight>eachSpace?setScrollUsers({y:eachSpace}):setScrollUsers(void 0)},[]);return(0,react.useEffect)(()=>(window.addEventListener("resize",onResize),()=>{window.removeEventListener("resize",onResize)}),[onResize]),(0,react.useEffect)(()=>{onResize()},[organization,onResize]),(0,jsx_runtime.jsx)("div",{ref:refWrapper,style:{height:"calc(100vh - 228px)"},children:(0,jsx_runtime.jsxs)(space.Z,{direction:"vertical",className:"full-width",size:20,children:[(0,jsx_runtime.jsx)(card.Z,{title:"Administrators",size:"small",children:(0,jsx_runtime.jsxs)(space.Z,{direction:"vertical",className:"full-width",size:20,children:[(0,jsx_runtime.jsx)(users_add_Add,{title:"New administrator",organization:{id:organization.id,owners:organization.owners,pendingowners:organization.pendingowners,pendingusers:organization.pendingusers,users:organization.users},dBkey:"owners",swr:{mutateOneOrganization:swr.mutateOneOrganization}}),(0,jsx_runtime.jsx)(table.Z,{loading:swr.loadingOrganizations,pagination:!1,size:"small",columns:ownersColumns,dataSource:[...organization.owners.map(o=>({...o,key:o.id})),...null===(ref=organization.pendingowners)||void 0===ref?void 0:ref.map(o=>({...o,pending:!0,key:o.id}))],scroll:{y:null==scrollAdmin?void 0:scrollAdmin.y},ref:refTableAdmin})]})}),(0,jsx_runtime.jsx)(card.Z,{title:"Users",size:"small",children:(0,jsx_runtime.jsxs)(space.Z,{direction:"vertical",className:"full-width",size:20,children:[(0,jsx_runtime.jsx)(users_add_Add,{title:"New user",organization:{id:organization.id,owners:organization.owners,pendingowners:organization.pendingowners,pendingusers:organization.pendingusers,users:organization.users},dBkey:"users",swr:{mutateOneOrganization:swr.mutateOneOrganization}}),(0,jsx_runtime.jsx)(table.Z,{loading:null==swr?void 0:swr.loadingOrganizations,pagination:!1,size:"small",columns:usersColumns,dataSource:[...null===(ref1=organization.users)||void 0===ref1?void 0:ref1.map(u=>({...u,key:u.id})),...null===(ref2=organization.pendingusers)||void 0===ref2?void 0:ref2.map(u=>({...u,pending:!0,key:u.id}))],scroll:{y:null==scrollUsers?void 0:scrollUsers.y},ref:refTableUsers})]})})]})})},useGroups=id=>{let{data,error,mutate}=(0,dist.ZP)("/api/groups/"+id,call._),groups=(null==data?void 0:data.groups)||[],addOne=(0,react.useCallback)(group=>{let newGroups=[...groups,group];mutate({groups:newGroups})},[groups,mutate]),delOne=(0,react.useCallback)(group=>{let filteredGroups=groups.filter(g=>g.id!==group.id);mutate({groups:filteredGroups})},[groups,mutate]),mutateOne=(0,react.useCallback)(group=>{let mutatedGroups=groups.map(g=>(g.id===group.id&&(g={...g,...group}),g));mutate({groups:mutatedGroups})},[groups,mutate]);return[groups,{addOneGroup:addOne,delOneGroup:delOne,mutateOneGroup:mutateOne,errorGroups:error,loadingGroups:!data}]},group_add_add=async(organization,group)=>{let response=await (0,call.R)("/api/group",{method:"POST",body:JSON.stringify({organization,group})});return response.json()},group_update_update=async(group,data)=>{await (0,call.R)("/api/group",{method:"PUT",body:JSON.stringify({group,data})})},group_del_del=async group=>{await (0,call.R)("/api/group",{method:"DELETE",body:JSON.stringify(group)})};var api_group={useGroups:useGroups,add:group_add_add,update:group_update_update,del:group_del_del};let group_delete_errors={del:"Unable to delete group"},group_delete_onDelete=async(group,swr)=>{try{await api_group.del({id:group.id}),swr.delOneGroup({id:group.id})}catch(err){throw(0,notification.lt)(group_delete_errors.del,err),err}},group_delete_Delete=param=>{let{group,swr}=param,[loading,setLoading]=(0,react.useState)(!1);return(0,jsx_runtime.jsx)(assets_button.m1,{bordered:!0,title:"Delete group",text:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["Are you sure you want to delete the group"," ",(0,jsx_runtime.jsx)(typography.Z.Text,{strong:!0,children:group.name}),"?"]}),loading:loading,async onDelete(){setLoading(!0);try{await group_delete_onDelete(group,swr)}finally{setLoading(!1)}}})},group_errors={add:"Unable to add group",update:"Unable to update group"},group_onAdd=async(organization,values,swr)=>{try{let newGroup=await api_group.add({id:organization.id},{name:values.name,users:values.users});swr.addOneGroup({...newGroup,name:values.name,users:values.users}),swr.mutateOneOrganization({id:organization.id,groups:[...organization.groups,newGroup]})}catch(err){throw(0,notification.lt)(group_errors.add,err),err}},onUpdate=async(organization,group,values,swr)=>{try{var ref,ref1,ref2,ref3;let toUpdate=[];if(group.name!==values.name&&toUpdate.push({key:"name",value:values.name}),(null===(ref=group.users)||void 0===ref?void 0:ref.map(u=>u.id).toString())!==values.users.toString()&&toUpdate.push({key:"users",value:values.users}),!toUpdate.length)return;await api_group.update({id:group.id},toUpdate),swr.mutateOneGroup({...group,...values});let groupIndex=null===(ref1=organization.groups)||void 0===ref1?void 0:ref1.findIndex(g=>g.id===group.id);swr.mutateOneOrganization({id:organization.id,groups:[...null===(ref2=organization.groups)||void 0===ref2?void 0:ref2.slice(0,groupIndex),group,...null===(ref3=organization.groups)||void 0===ref3?void 0:ref3.slice(groupIndex+1)]})}catch(err){throw(0,notification.lt)(group_errors.update,err),err}},group_Group=param=>{var ref;let{userOptions,organization,group,swr}=param,[visible,setVisible]=(0,react.useState)(!1),[loading,setLoading]=(0,react.useState)(!1);return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)(dialog.ZP,{title:group?"Edit group":"New group",visible:visible,initialValues:group&&{name:group.name,users:null===(ref=group.users)||void 0===ref?void 0:ref.map(u=>u.id)},onCancel:()=>setVisible(!1),async onOk(values){setLoading(!0);try{group?await onUpdate(organization,group,values,{mutateOneOrganization:swr.mutateOneOrganization,mutateOneGroup:swr.mutateOneGroup}):await group_onAdd(organization,values,{mutateOneOrganization:swr.mutateOneOrganization,addOneGroup:swr.addOneGroup}),setLoading(!1),setVisible(!1)}catch(err){throw setLoading(!1),err}},loading:loading,children:[(0,jsx_runtime.jsx)(es_form.Z.Item,{name:"name",label:"Name",rules:[{required:!0,message:"Name is requried"}],children:(0,jsx_runtime.jsx)(input.Z,{})}),(0,jsx_runtime.jsx)(es_form.Z.Item,{name:"users",label:"Users",rules:[{required:!0,message:"Users selection is required"}],children:(0,jsx_runtime.jsx)(es_select.Z,{mode:"multiple",placeholder:"Select users",options:userOptions})})]}),group?(0,jsx_runtime.jsx)(assets_button.w6,{bordered:!0,onEdit:()=>setVisible(!0),children:"Edit"}):(0,jsx_runtime.jsx)(assets_button.HS,{onAdd:()=>setVisible(!0),children:"New group"})]})},groups_errors={groups:"Error while loading groups"},Groups=param=>{let{organization,swr}=param,[userOptions,setUserOptions]=(0,react.useState)([]),[scroll,setScroll]=(0,react.useState)(null),refTableGroup=(0,react.useRef)(null),[groups,{addOneGroup,mutateOneGroup,delOneGroup,errorGroups,loadingGroups}]=api_group.useGroups(organization.id);(0,react.useEffect)(()=>{let owners=organization.owners,users=null==organization?void 0:organization.users,allUsers=[...owners,...users],options=allUsers.map(user=>({label:user.firstname||user.lastname?user.firstname+" "+user.lastname:user.email,value:user.id}));setUserOptions(options)},[organization]),(0,react.useEffect)(()=>{errorGroups&&(0,notification.lt)(groups_errors.groups,errorGroups)},[errorGroups]);let usersRender=u=>(0,jsx_runtime.jsx)(avatar.C.Group,{maxCount:5,children:u.map(user=>utils.Z.userToAvatar(user))}),actionsRender=(_,group)=>(0,jsx_runtime.jsxs)(space.Z,{children:[(0,jsx_runtime.jsx)(group_Group,{userOptions:userOptions,organization:{id:organization.id,groups:organization.groups},group:{id:group.id,name:group.name,users:group.users},swr:{mutateOneOrganization:swr.mutateOneOrganization,mutateOneGroup}}),(0,jsx_runtime.jsx)(group_delete_Delete,{group:{id:group.id,name:group.name},swr:{delOneGroup}})]}),onResize=(0,react.useCallback)(()=>{let table=refTableGroup.current;table&&(table.clientHeight>window.innerHeight-table.offsetTop-59?setScroll({y:window.innerHeight-table.offsetTop-59}):setScroll(null))},[]);return(0,react.useEffect)(()=>(window.addEventListener("resize",onResize),()=>{window.removeEventListener("resize",onResize)}),[onResize]),(0,react.useEffect)(()=>{onResize()},[groups,onResize]),(0,jsx_runtime.jsxs)(space.Z,{direction:"vertical",className:"full-width",size:20,children:[(0,jsx_runtime.jsx)(group_Group,{userOptions:userOptions,organization:{id:organization.id,groups:organization.groups},swr:{mutateOneOrganization:swr.mutateOneOrganization,addOneGroup}}),(0,jsx_runtime.jsx)(table.Z,{loading:loadingGroups,pagination:!1,size:"small",columns:[{title:"Group name",dataIndex:"name",key:"name"},{title:"Users",dataIndex:"users",key:"users",render:usersRender},{title:"Actions",key:"actions",render:actionsRender}],dataSource:groups.map(g=>({key:g.id,...g})),scroll:{y:null==scroll?void 0:scroll.y},ref:refTableGroup})]})},organization_errors={name:"Unable to update organization's name"},onName=async(organization,name,swr)=>{try{await api_organization.update(organization,[{key:"name",value:name}]),swr.mutateOneOrganization({...organization,name:name})}catch(err){(0,notification.lt)(organization_errors.name,err)}},organization_Organization=param=>{let{organization,swr,onClose}=param;return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)("div",{className:"display-flex",children:[(0,jsx_runtime.jsx)(es_button.Z,{className:"marginRight-20",icon:(0,jsx_runtime.jsx)(ArrowLeftOutlined.Z,{}),onClick:()=>onClose()}),(0,jsx_runtime.jsx)(typography.Z.Title,{level:3,editable:{onChange:async name=>onName(organization,name,{mutateOneOrganization:swr.mutateOneOrganization})},children:organization.name})]}),(0,jsx_runtime.jsx)(tabs.Z,{items:[{key:"users",label:"Users",children:(0,jsx_runtime.jsx)(Users,{organization:{id:organization.id,owners:organization.owners,pendingowners:organization.pendingowners,users:organization.users,pendingusers:organization.pendingusers},swr:{mutateOneOrganization:swr.mutateOneOrganization,loadingOrganizations:swr.loadingOrganizations}})},{key:"groups",label:"Groups",children:(0,jsx_runtime.jsx)(Groups,{organization:{id:organization.id,owners:organization.owners,users:organization.users,groups:organization.groups},swr:{mutateOneOrganization:swr.mutateOneOrganization}})}]})]})},organizations_add_errors={add:"Unable to add organization"},add_onAdd=async(values,swr)=>{try{let organization=await api_organization.add({name:values.name});organization.name=values.name,swr.addOneOrganization(organization)}catch(err){throw(0,notification.lt)(organizations_add_errors.add,err),err}},organizations_add_Add=param=>{let{swr}=param,[visible,setVisible]=(0,react.useState)(!1),[loading,setLoading]=(0,react.useState)(!1);return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(dialog.ZP,{title:"New organization",visible:visible,onCancel:()=>setVisible(!1),async onOk(values){setLoading(!0);try{await add_onAdd(values,swr),setLoading(!1),setVisible(!1)}catch(err){throw setLoading(!1),err}},loading:loading,children:(0,jsx_runtime.jsx)(es_form.Z.Item,{name:"name",label:"Name",rules:[{required:!0,message:"Name is required"}],children:(0,jsx_runtime.jsx)(input.Z,{})})}),(0,jsx_runtime.jsx)(assets_button.HS,{onAdd:()=>setVisible(!0),children:"New organization"})]})};var LeftSquareOutlined=__webpack_require__(75768),CheckCircleOutlined=__webpack_require__(8751),CloseCircleOutlined=__webpack_require__(18429);let organizations_delete_errors={del:"Unable to delete organization"},organizations_delete_onDelete=async(organization,swr)=>{try{await api_organization.del({id:organization.id}),swr.delOneOrganization({id:organization.id})}catch(err){throw(0,notification.lt)(organizations_delete_errors.del,err),err}},organizations_delete_Delete=param=>{let{organization,swr}=param,[loading,setLoading]=(0,react.useState)(!1);return(0,jsx_runtime.jsx)(assets_button.m1,{bordered:!0,title:"Delete organization",text:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["Are you sure you want to delete the organization"," ",(0,jsx_runtime.jsx)(typography.Z.Text,{strong:!0,children:organization.name}),"?"]}),async onDelete(){setLoading(!0);try{await organizations_delete_onDelete(organization,swr)}finally{setLoading(!1)}},loading:loading})},organizations_list_errors={quit:"Unable to quit organization",accept:"Unable to accept invitation",decline:"Unable to decline invitation"},onQuit=async(organization,user,swr)=>{try{await api_organization.quit({id:organization.id});let newOrganization=utils.Z.deepCopy(organization),userIndex=newOrganization.users.findIndex(u=>u.id===user.id);newOrganization.users.splice(userIndex,1),swr.mutateOneOrganization(newOrganization)}catch(err){(0,notification.lt)(organizations_list_errors.quit,err)}},onAccept=async(organization,user,swr)=>{try{await api_organization.accept(organization);let newOrganization=utils.Z.deepCopy(organization),ownerIndex=newOrganization.pendingowners.findIndex(o=>o.id===user.id),pendingowner=newOrganization.pendingowners[ownerIndex];if(-1!==ownerIndex)newOrganization.pendingowners.splice(ownerIndex,1),newOrganization.owners.push(pendingowner);else{let userIndex=newOrganization.pendingusers.findIndex(u=>u.id===user.id),pendinguser=newOrganization.pendingusers[userIndex];newOrganization.pendingusers.splice(userIndex,1),newOrganization.users.push(pendinguser)}swr.mutateOneOrganization(newOrganization)}catch(err){(0,notification.lt)(organizations_list_errors.accept,err)}},onDecline=async(organization,user,swr)=>{try{var ref,ref1;await api_organization.decline({id:organization.id});let newOrganization=utils.Z.deepCopy(organization),ownerIndex=null===(ref=newOrganization.pendingowners)||void 0===ref?void 0:ref.findIndex(o=>o.id===user.id);if(-1!==ownerIndex)newOrganization.pendingowners.splice(ownerIndex,1);else{let userIndex=null===(ref1=newOrganization.pendingusers)||void 0===ref1?void 0:ref1.findIndex(u=>u.id===user.id);newOrganization.pendingusers.splice(userIndex,1)}swr.mutateOneOrganization(newOrganization)}catch(err){(0,notification.lt)(organizations_list_errors.decline,err)}},list_List=param=>{var ref;let{user,organizations,swr,setOrganization}=param,[scroll,setScroll]=(0,react.useState)(null),refTableOrga=(0,react.useRef)(null),ownersRender=owners=>(0,jsx_runtime.jsx)(avatar.C.Group,{maxCount:5,children:null==owners?void 0:owners.map(o=>utils.Z.userToAvatar(o))}),usersRender=users=>(0,jsx_runtime.jsx)(avatar.C.Group,{maxCount:5,children:null==users?void 0:users.map(u=>utils.Z.userToAvatar(u))}),groupsRender=groups=>(0,jsx_runtime.jsx)(avatar.C.Group,{maxCount:5,children:null==groups?void 0:groups.map(g=>utils.Z.groupToAvatar(g))}),actionsRender=org=>org.owners.find(o=>o.id===user.id)?(0,jsx_runtime.jsxs)(space.Z,{wrap:!0,children:[(0,jsx_runtime.jsx)(es_button.Z,{icon:(0,jsx_runtime.jsx)(ControlOutlined.Z,{}),onClick:()=>setOrganization(org),children:"Manage"}),(0,jsx_runtime.jsx)(organizations_delete_Delete,{organization:{id:org.id,name:org.name},swr:{delOneOrganization:swr.delOneOrganization}})]}):org.users.find(u=>u.id===user.id)?(0,jsx_runtime.jsx)(space.Z,{wrap:!0,children:(0,jsx_runtime.jsx)(es_button.Z,{danger:!0,icon:(0,jsx_runtime.jsx)(LeftSquareOutlined.Z,{}),onClick:()=>onQuit({id:org.id,users:org.users},{id:user.id},{mutateOneOrganization:swr.mutateOneOrganization}),children:"Quit"})}):org.pendingowners.find(o=>o.id===user.id)||org.pendingusers.find(u=>u.id===user.id)?(0,jsx_runtime.jsxs)(space.Z,{wrap:!0,children:[(0,jsx_runtime.jsx)(es_button.Z,{type:"primary",icon:(0,jsx_runtime.jsx)(CheckCircleOutlined.Z,{}),onClick:async()=>onAccept({id:org.id,owners:org.owners,pendingowners:org.pendingowners,users:org.users,pendingusers:org.pendingusers},{id:user.id},{mutateOneOrganization:swr.mutateOneOrganization}),children:"Accept invitation"}),(0,jsx_runtime.jsx)(es_button.Z,{danger:!0,icon:(0,jsx_runtime.jsx)(CloseCircleOutlined.Z,{}),onClick:()=>onDecline({id:org.id,pendingowners:org.pendingowners,pendingusers:org.pendingusers},{id:user.id},{mutateOneOrganization:swr.mutateOneOrganization}),children:"Decline"})]}):void 0,onResize=(0,react.useCallback)(()=>{let table=refTableOrga.current;table&&(table.clientHeight>window.innerHeight-table.offsetTop-59?setScroll({y:window.innerHeight-table.offsetTop-59}):setScroll(null))},[]);return(0,react.useEffect)(()=>(window.addEventListener("resize",onResize),()=>{window.removeEventListener("resize",onResize)}),[onResize]),(0,react.useEffect)(()=>{onResize()},[organizations,onResize,null===(ref=refTableOrga.current)||void 0===ref?void 0:ref.offsetTop]),(0,jsx_runtime.jsx)(table.Z,{loading:swr.loadingOrganizations,pagination:!1,size:"small",columns:[{title:"Name",dataIndex:"name",key:"name",sorter(a,b){let na=a.name||"",nb=b.name||"";return na.localeCompare(nb)}},{title:"Administrators",dataIndex:"owners",key:"owners",render:ownersRender},{title:"Users",dataIndex:"users",key:"users",render:usersRender},{title:"Groups",dataIndex:"groups",key:"groups",render:groupsRender},{title:"Actions",key:"actions",render:actionsRender}],dataSource:null==organizations?void 0:organizations.map(organization=>({key:organization.id,id:organization.id,name:organization.name,owners:organization.owners,pendingowners:organization.pendingowners,users:organization.users,pendingusers:organization.pendingusers,groups:organization.groups})),ref:refTableOrga,scroll:{y:null==scroll?void 0:scroll.y}})},Organizations=param=>{let{user,organizations,swr}=param,[organization,setOrganization]=(0,react.useState)(),router=(0,next_router.useRouter)(),{organizationId}=router.query;return(0,react.useEffect)(()=>{if(organizationId){let currentOrganization=organizations.find(o=>o.id===organizationId);setOrganization(currentOrganization)}},[organizationId,organizations]),(0,react.useEffect)(()=>{if(organization){let currentOrganization=organizations.find(o=>o.id===organization.id);JSON.stringify(currentOrganization)!==JSON.stringify(organization)&&setOrganization(currentOrganization)}},[organizations,organization]),(0,jsx_runtime.jsxs)(layout.Z,{className:"inDashboard Organization",children:[(0,jsx_runtime.jsx)(page_header.Z,{className:"inDashboard-PageHeader",backIcon:!1,title:(0,jsx_runtime.jsx)(typography.Z.Title,{level:2,className:"inDashboard-PageHeader-title",children:"Organizations"}),footer:(0,jsx_runtime.jsx)(divider.Z,{})}),(0,jsx_runtime.jsx)(layout.Z.Content,{className:"no-scroll",children:organization?(0,jsx_runtime.jsx)(organization_Organization,{organization:{id:organization.id,name:organization.name,owners:organization.owners,pendingowners:organization.pendingowners,users:organization.users,pendingusers:organization.pendingusers,groups:organization.groups},swr:{mutateOneOrganization:swr.mutateOneOrganization,loadingOrganizations:swr.loadingOrganizations},onClose(){router.push({pathname:"dashboard",query:{page:"organizations"}}),setOrganization(null)}}):(0,jsx_runtime.jsxs)(space.Z,{direction:"vertical",className:"full-width",size:20,children:[(0,jsx_runtime.jsx)(organizations_add_Add,{swr:{addOneOrganization:swr.addOneOrganization}}),(0,jsx_runtime.jsx)(list_List,{user:{id:user.id},organizations:organizations,swr:{mutateOneOrganization:swr.mutateOneOrganization,delOneOrganization:swr.delOneOrganization,loadingOrganizations:swr.loadingOrganizations},setOrganization(org){router.push({pathname:"dashboard",query:{page:"organizations",organizationId:org.id}}),setOrganization(org)}})]})})]})};var badge=__webpack_require__(63922),popover=__webpack_require__(10808),CheckOutlined=__webpack_require__(63606),es_checkbox=__webpack_require__(32808),api_system=__webpack_require__(92288);let administration_users_add_errors={add:"Unable to add user"},users_add_onAdd=async(values,swr)=>{try{let newUser=await api_user.Z.add({email:values.email,password:values.password});if(newUser.alreadyExists)throw Error("User already exists");await api_user.Z.updateById(newUser.id,[{key:"firstname",value:values.firstname},{key:"lastname",value:values.lastname},{key:"authorizedplugins",value:values.authorizedplugins},{key:"superuser",value:!!values.superuser}]);let newUserWithData={...newUser,email:values.email,firstname:values.firstname,lastname:values.firstname,superuser:values.superuser};swr.addOneUser(newUserWithData)}catch(err){throw(0,notification.lt)(administration_users_add_errors.add,err),err}},administration_users_add_Add=param=>{let{plugins,swr}=param,[visible,setVisible]=(0,react.useState)(!1),[loading,setLoading]=(0,react.useState)(!1),[system]=api_system.Z.useSystem();return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)(dialog.ZP,{title:"New user",visible:visible,initialValues:system.defaultplugins&&{authorizedplugins:system.defaultplugins},onCancel:()=>setVisible(!1),async onOk(values){setLoading(!0);try{await users_add_onAdd(values,swr),setLoading(!1),setVisible(!1)}catch(err){throw setLoading(!1),err}},loading:loading,children:[(0,jsx_runtime.jsx)(es_form.Z.Item,{name:"firstname",label:"First name",children:(0,jsx_runtime.jsx)(input.Z,{})}),(0,jsx_runtime.jsx)(es_form.Z.Item,{name:"lastname",label:"Last name",children:(0,jsx_runtime.jsx)(input.Z,{})}),(0,jsx_runtime.jsx)(es_form.Z.Item,{name:"email",label:"Email",rules:[{required:!0,message:"Email is required"}],children:(0,jsx_runtime.jsx)(input.Z,{})}),(0,jsx_runtime.jsx)(assets_input.o,{name:"password"}),(0,jsx_runtime.jsx)(es_form.Z.Item,{name:"authorizedplugins",label:"Plugins",children:(0,jsx_runtime.jsx)(es_select.Z,{mode:"multiple",options:plugins.map(plugin=>({label:plugin.name,value:plugin.key}))})}),(0,jsx_runtime.jsx)(es_form.Z.Item,{name:"superuser",label:"Administrator",valuePropName:"checked",children:(0,jsx_runtime.jsx)(es_checkbox.Z,{})})]}),(0,jsx_runtime.jsx)(assets_button.HS,{onAdd:()=>setVisible(!0),children:"New user"})]})},users_edit_errors={update:"Unable to update user"},edit_onUpdate=async(user,values,swr)=>{try{let toUpdate=Object.keys(values).map(key=>{let value=values[key];if(void 0!==value&&"******"!==value&&value!==user[key])return{key,value,type:"password"===key&&"crypt"}}).filter(u=>u);if(!toUpdate.length)return;await api_user.Z.updateById(user.id,toUpdate),values.password="******";let newUser={...user,...values};swr.mutateOneUser(newUser)}catch(err){throw(0,notification.lt)(users_edit_errors.update,err),err}},users_edit_Edit=param=>{let{plugins,user,swr}=param,[visible,setVisible]=(0,react.useState)(!1),[loading,setLoading]=(0,react.useState)(!1);return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)(dialog.ZP,{title:"Edit user",visible:visible,initialValues:{...user,password:"******",authorizedplugins:user.authorizedplugins},onCancel:()=>setVisible(!1),async onOk(values){setLoading(!0);try{await edit_onUpdate(user,values,swr),setLoading(!1),setVisible(!1)}catch(err){throw setLoading(!1),err}},loading:loading,children:[(0,jsx_runtime.jsx)(es_form.Z.Item,{name:"firstname",label:"First name",children:(0,jsx_runtime.jsx)(input.Z,{})}),(0,jsx_runtime.jsx)(es_form.Z.Item,{name:"lastname",label:"Last name",children:(0,jsx_runtime.jsx)(input.Z,{})}),(0,jsx_runtime.jsx)(es_form.Z.Item,{name:"email",label:"Email",rules:[{required:!0,message:"Email is required"}],children:(0,jsx_runtime.jsx)(input.Z,{})}),(0,jsx_runtime.jsx)(assets_input.o,{name:"password",edit:!0}),(0,jsx_runtime.jsx)(es_form.Z.Item,{name:"authorizedplugins",label:"Plugins",children:(0,jsx_runtime.jsx)(es_select.Z,{mode:"multiple",options:plugins.map(plugin=>({label:plugin.name,value:plugin.key}))})}),(0,jsx_runtime.jsx)(es_form.Z.Item,{name:"superuser",label:"Administrator",valuePropName:"checked",children:(0,jsx_runtime.jsx)(es_checkbox.Z,{})})]}),(0,jsx_runtime.jsx)(assets_button.w6,{bordered:!0,onEdit:()=>setVisible(!0),children:"Edit"})]})},administration_users_delete_errors={del:"Unable to delete user"},administration_users_delete_onDelete=async(user,swr)=>{try{await api_user.Z.delById(user.id),swr.delOneUser({id:user.id})}catch(err){throw(0,notification.lt)(administration_users_delete_errors.del,err),err}},administration_users_delete_Delete=param=>{let{user,swr}=param,[loading,setLoading]=(0,react.useState)(!1);return(0,jsx_runtime.jsx)(assets_button.m1,{loading:loading,bordered:!0,text:(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:["Are you sure you want to delete the user"," ",(0,jsx_runtime.jsx)(typography.Z.Text,{strong:!0,children:user.email}),"?"]}),title:"Delete user",async onDelete(){setLoading(!0);try{await administration_users_delete_onDelete(user,swr)}finally{setLoading(!1)}}})},users_errors={plugins:"Unable to load plugins"},users_Users=param=>{let{users,swr}=param,[plugins,setPlugins]=(0,react.useState)(),[scroll,setScroll]=(0,react.useState)(),refTable=(0,react.useRef)(null),authorizedpluginsRender=authorizedplugins=>{authorizedplugins.sort();let list=authorizedplugins.map(authorizedplugin=>{let plugin=null==plugins?void 0:plugins.find(p=>p.key===authorizedplugin);if(plugin)return(0,jsx_runtime.jsx)(badge.Z.Ribbon,{text:plugin.category,style:{marginTop:"-15px"},children:(0,jsx_runtime.jsx)(card.Z,{size:"small",children:plugin.name})},authorizedplugin)}),content=(0,jsx_runtime.jsx)(space.Z,{direction:"vertical",children:list});return(0,jsx_runtime.jsx)(popover.Z,{content:content,children:(0,jsx_runtime.jsxs)(es_button.Z,{children:[list.length," plugins"]})})},superuserRender=superuser=>superuser&&(0,jsx_runtime.jsx)(CheckOutlined.Z,{className:"color-green"}),actionsRender=(_,record)=>(0,jsx_runtime.jsxs)(space.Z,{children:[(0,jsx_runtime.jsx)(users_edit_Edit,{plugins:(null==plugins?void 0:plugins.map(plugin=>({key:plugin.key,name:plugin.name})))||[],user:{id:record.id,firstname:record.firstname,lastname:record.lastname,email:record.email,authorizedplugins:record.authorizedplugins,superuser:record.superuser},swr:{mutateOneUser:swr.mutateOneUser}}),(0,jsx_runtime.jsx)(administration_users_delete_Delete,{user:{id:record.id,email:record.email},swr:{delOneUser:swr.delOneUser}})]}),onResize=(0,react.useCallback)(()=>{let table=refTable.current;table&&(table.clientHeight>window.innerHeight-table.offsetTop-59?setScroll({y:window.innerHeight-table.offsetTop-59}):setScroll(void 0))},[]);return(0,react.useEffect)(()=>{api_plugins.Z.completeList().then(list=>{setPlugins(list)}).catch(err=>{(0,notification.lt)(users_errors.plugins,err)})},[]),(0,react.useEffect)(()=>(window.addEventListener("resize",onResize),()=>{window.removeEventListener("resize",onResize)}),[onResize]),(0,react.useEffect)(()=>{onResize()},[users,onResize]),(0,jsx_runtime.jsxs)(space.Z,{direction:"vertical",className:"full-width full-height",size:20,children:[(0,jsx_runtime.jsx)(administration_users_add_Add,{plugins:(null==plugins?void 0:plugins.map(plugin=>({key:plugin.key,name:plugin.name})))||[],swr:{addOneUser:swr.addOneUser}}),(0,jsx_runtime.jsx)(table.Z,{loading:!plugins,pagination:!1,size:"small",columns:[{title:"First name",dataIndex:"firstname",key:"firstname",sorter(a,b){let fa=a.firstname||"",fb=b.firstname||"";return fa.localeCompare(fb)}},{title:"Last name",dataIndex:"lastname",key:"lastname",sorter(a,b){let la=a.lastname||"",lb=b.lastname||"";return la.localeCompare(lb)}},{title:"Email",dataIndex:"email",key:"email",sorter(a,b){let ea=a.email,eb=b.email;return ea.localeCompare(eb)}},{title:"Password",key:"password",render:()=>"******"},{title:"Plugins",dataIndex:"authorizedplugins",key:"authorizedplugins",render:authorizedpluginsRender},{title:"Administrator",dataIndex:"superuser",key:"superuser",render:superuserRender},{title:"Actions",key:"actions",render:actionsRender}],dataSource:users.map(u=>({...u,key:u.id})),ref:refTable,scroll:{y:null==scroll?void 0:scroll.y}})]})};var input_number=__webpack_require__(79915),auth=__webpack_require__(37404);let registration_errors={system:"Error while loading system",update:"Unable to update system"},onAllowSignup=async(system,mutateSystem)=>{try{await api_system.Z.update([{key:"allowsignup",value:!system.allowsignup}]),mutateSystem({allowsignup:!system.allowsignup}),(0,notification.Ur)("Changes saved")}catch(err){(0,notification.lt)(registration_errors.update,err)}},onPasswordFinish=async(values,mutateSystem)=>{try{await api_system.Z.update([{key:"password",value:values}]),mutateSystem({password:values}),(0,notification.Ur)("Changes saved")}catch(err){(0,notification.lt)(registration_errors.update,err)}},Registration=()=>{let[form]=es_form.Z.useForm(),[system,{mutateSystem,errorSystem,loadingSystem}]=api_system.Z.useSystem(),tailLayout={wrapperCol:{offset:8,span:16}};return((0,react.useEffect)(()=>{errorSystem&&(0,notification.lt)(registration_errors.system,errorSystem)},[errorSystem]),(0,react.useEffect)(()=>{loadingSystem||form.setFieldsValue((null==system?void 0:system.password)||{min:auth.yL,max:auth.nq,requireLetter:auth.JT,requireNumber:auth.tE,requireSymbol:auth.ah})},[loadingSystem,form,null==system?void 0:system.password]),loadingSystem)?(0,jsx_runtime.jsx)(components_loading.Z.Simple,{}):(0,jsx_runtime.jsxs)(space.Z,{direction:"vertical",className:"full-width",size:20,children:[(0,jsx_runtime.jsx)(card.Z,{title:"Signup",children:(0,jsx_runtime.jsx)(es_checkbox.Z,{checked:null==system?void 0:system.allowsignup,onChange:()=>onAllowSignup(system,mutateSystem),children:"Allow signup"})}),(0,jsx_runtime.jsx)(card.Z,{title:"Password",children:(0,jsx_runtime.jsxs)(es_form.Z,{labelCol:{span:8},wrapperCol:{span:16},form:form,name:"form",onFinish:async values=>onPasswordFinish(values,mutateSystem),children:[(0,jsx_runtime.jsx)(es_form.Z.Item,{label:"Minimum number of characters",name:"min",rules:[{required:!0,message:"Minimum number of characters is required"}],children:(0,jsx_runtime.jsx)(input_number.Z,{min:0,max:64})}),(0,jsx_runtime.jsx)(es_form.Z.Item,{label:"Maximum number of characters",name:"max",rules:[{required:!0,message:"Maximum number of characters is required"}],children:(0,jsx_runtime.jsx)(input_number.Z,{min:0,max:64})}),(0,jsx_runtime.jsx)(es_form.Z.Item,{...tailLayout,valuePropName:"checked",name:"requireLetter",children:(0,jsx_runtime.jsx)(es_checkbox.Z,{children:"Require letter"})}),(0,jsx_runtime.jsx)(es_form.Z.Item,{...tailLayout,valuePropName:"checked",name:"requireNumber",children:(0,jsx_runtime.jsx)(es_checkbox.Z,{children:"Require number"})}),(0,jsx_runtime.jsx)(es_form.Z.Item,{...tailLayout,valuePropName:"checked",name:"requireSymbol",children:(0,jsx_runtime.jsx)(es_checkbox.Z,{children:"Require symbol"})}),(0,jsx_runtime.jsx)(es_form.Z.Item,{...tailLayout,children:(0,jsx_runtime.jsx)(es_button.Z,{type:"primary",icon:(0,jsx_runtime.jsx)(CheckOutlined.Z,{}),htmlType:"submit"})})]})})]})},plugins_errors={plugins:"Unable to get plugins",update:"Unable to update system"},plugins_onChange=async(system,plugin,checked,swr)=>{try{await api_system.Z.update([{key:"defaultplugins",type:"array",method:checked?"append":"remove",value:plugin.key}]);let defaultplugins=(null==system?void 0:system.defaultplugins)||[],index=defaultplugins.indexOf(plugin.key);checked&&-1===index&&defaultplugins.push(plugin.key),checked||-1===index||defaultplugins.splice(index,1),swr.mutateSystem({defaultplugins})}catch(err){(0,notification.lt)(plugins_errors.update,err)}},Plugins=()=>{let tableRef=(0,react.useRef)(null),[plugins,setPlugins]=(0,react.useState)(),[scroll,setScroll]=(0,react.useState)(),[system,{mutateSystem,loadingSystem}]=api_system.Z.useSystem();(0,react.useEffect)(()=>{api_plugins.Z.completeList().then(list=>{setPlugins(list)}).catch(err=>{(0,notification.lt)(plugins_errors.plugins,err)})},[]);let onResize=(0,react.useCallback)(()=>{let table=tableRef.current;table&&(table.clientHeight>window.innerHeight-table.offsetTop-59?setScroll({y:window.innerHeight-table.offsetTop-59}):setScroll(null))},[]);return(0,react.useEffect)(()=>(window.addEventListener("resize",onResize),()=>{window.removeEventListener("resize",onResize)}),[onResize]),(0,react.useEffect)(()=>{onResize()},[plugins,onResize]),(0,jsx_runtime.jsx)(table.Z,{loading:!plugins||loadingSystem,pagination:!1,size:"small",columns:[{title:"Category",dataIndex:"category",key:"category"},{title:"Name",dataIndex:"name",key:"name"},{title:"Default enabled",key:"enable",render(plugin){var ref;let checked=null==system?void 0:null===(ref=system.defaultplugins)||void 0===ref?void 0:ref.includes(plugin.key);return(0,jsx_runtime.jsx)(es_checkbox.Z,{checked:checked,onChange:async e=>plugins_onChange(system,plugin,e.target.checked,{mutateSystem})})}}],dataSource:plugins,ref:tableRef,scroll:{y:null==scroll?void 0:scroll.y}})},tabItems={users:{label:"Users",key:"users"},registration:{label:"Registration",key:"registration"},plugins:{label:"Plugins",key:"plugins"}},administration_errors={users:"Error while loading users"},administration_onChange=(router,key)=>{router.replace({pathname:"/dashboard",query:{page:"administration",tab:key}})},Administration=()=>{let router=(0,next_router.useRouter)(),{tab}=router.query,[users,{addOneUser,mutateOneUser,delOneUser,errorUsers}]=api_user.Z.useUsers();return(0,react.useEffect)(()=>{errorUsers&&(0,notification.lt)(administration_errors.users,errorUsers)},[errorUsers]),(0,jsx_runtime.jsxs)(layout.Z,{className:"inDashboard Administration",children:[(0,jsx_runtime.jsx)(page_header.Z,{className:"inDashboard-PageHeader",backIcon:!1,title:(0,jsx_runtime.jsx)(typography.Z.Title,{level:2,className:"inDashboard-PageHeader-title",children:"Administration"}),footer:(0,jsx_runtime.jsx)(divider.Z,{})}),(0,jsx_runtime.jsx)(layout.Z.Content,{children:(0,jsx_runtime.jsx)(tabs.Z,{className:"inDashboard-Tabs",type:"card",items:[{key:tabItems.users.key,label:tabItems.users.label,children:(0,jsx_runtime.jsx)(users_Users,{users:users,swr:{addOneUser,mutateOneUser,delOneUser}})},{key:tabItems.registration.key,label:tabItems.registration.label,children:(0,jsx_runtime.jsx)(Registration,{})},{key:tabItems.plugins.key,label:tabItems.plugins.label,children:(0,jsx_runtime.jsx)(Plugins,{})}],defaultActiveKey:tab||"default",onChange:key=>administration_onChange(router,key)})})]})};var es_list=__webpack_require__(95507);let Workflow=()=>(0,jsx_runtime.jsx)(card.Z,{title:"Standard workflow",children:(0,jsx_runtime.jsx)(es_list.ZP,{dataSource:["Go to account settings","Fill your first name, last name, change your password if needed","Create an HPC provider, you will need that to run a simulation","Create a new workspace","Create a new project","Upload a geometry (STEP file for 3D or DXF file for 2D)","Select a simulation model","Configure your simulation: geometry, materials, parameters, boundary conditions, depending on your simulation, HPC resource","Run your simulation","Display the results","Depending on your simulation, visualize data","Depending on your simulation, post-process the result"],renderItem:item=>(0,jsx_runtime.jsxs)(es_list.ZP.Item,{children:[" - ",item]})})}),doc_workspace_Workspace=()=>(0,jsx_runtime.jsx)(card.Z,{title:"Workspace",children:(0,jsx_runtime.jsxs)(typography.Z.Text,{children:["The workspace is the place where all the projects are. You can create several workspaces to sort your different projects.",(0,jsx_runtime.jsx)("br",{}),"You can share your workspace with other users or groups throught organizations."]})});var collapse=__webpack_require__(54907);let Project=()=>(0,jsx_runtime.jsxs)(card.Z,{title:"Project",children:[(0,jsx_runtime.jsx)(typography.Z.Text,{children:"The project is used to manage geometries and simulation."}),(0,jsx_runtime.jsx)(collapse.Z,{children:(0,jsx_runtime.jsx)(collapse.Z.Panel,{header:"Archive Project",children:(0,jsx_runtime.jsxs)(typography.Z.Text,{children:["You can archive a project to save disk space.",(0,jsx_runtime.jsx)("br",{}),"Once archived, a project is not editable anymore.",(0,jsx_runtime.jsx)("br",{}),"At the archive time, you can download a"," ",(0,jsx_runtime.jsx)("code",{children:".tanatlocarchive"})," file that contains all the data to restore your project later.",(0,jsx_runtime.jsx)("br",{}),"There is several options to manage an archived projects:",(0,jsx_runtime.jsxs)("ul",{children:[(0,jsx_runtime.jsx)("li",{children:"Restore the project from the previously downloaded archive file;"}),(0,jsx_runtime.jsx)("li",{children:"Restore the project from the archive file on the server;"}),(0,jsx_runtime.jsx)("li",{children:"Delete the archive file on the server, in the case you will not be able to restore the project from the server archive file."})]})]})},"archive")})]}),hpc_HPC=()=>(0,jsx_runtime.jsx)(card.Z,{title:"Account / HPC plugins",children:(0,jsx_runtime.jsxs)(collapse.Z,{children:[(0,jsx_runtime.jsxs)(collapse.Z.Panel,{header:"Local plugin",children:[(0,jsx_runtime.jsx)(typography.Z.Text,{children:"Allow to compute a simulation directly on the frontal server."}),(0,jsx_runtime.jsx)(typography.Z.Text,{children:"This plugin is only reserved for test purposes."})]},"local"),(0,jsx_runtime.jsxs)(collapse.Z.Panel,{header:"Rescale plugin",children:[(0,jsx_runtime.jsxs)(typography.Z.Text,{children:["Allow to compute a simulation on"," ",(0,jsx_runtime.jsx)("a",{href:"https://www.rescale.com/",children:"Rescale"}),"."]}),(0,jsx_runtime.jsx)(typography.Z.Text,{children:"You have to fill the following informations:"}),(0,jsx_runtime.jsxs)("ul",{children:[(0,jsx_runtime.jsx)("li",{children:"Name: a name to retrieve your configuration during the simulation parameterization;"}),(0,jsx_runtime.jsxs)("li",{children:["Token: your API token. You can find it in your"," ",(0,jsx_runtime.jsx)("a",{href:"https://platform.rescale.jp/user/settings/api-key/",children:"Rescale account"}),";"]}),(0,jsx_runtime.jsx)("li",{children:"Platform: the platform you use. USA, Europe or Japan;"}),(0,jsx_runtime.jsx)("li",{children:"[Optional] Organization name: the organization you are in;"}),(0,jsx_runtime.jsx)("li",{children:"[Optional] Project id: the financial project identifier;"}),(0,jsx_runtime.jsx)("li",{children:"[Optional] Default walltime: the default value for the run walltime;"}),(0,jsx_runtime.jsx)("li",{children:"[Optional] Additional files: additional files you have to use with your simulations. Generally FreeFEM custom plugins."})]}),(0,jsx_runtime.jsx)(typography.Z.Text,{children:"When you save this informations, Tanatloc will check your API key, the available core types, and the available FreeFEM versions."})]},"rescale")]})}),administration_Administration=()=>(0,jsx_runtime.jsxs)(card.Z,{title:"Administration",children:[(0,jsx_runtime.jsx)(typography.Z.Text,{children:"Your need to be an administrator to have acces to this part"}),(0,jsx_runtime.jsxs)(collapse.Z,{children:[(0,jsx_runtime.jsx)(collapse.Z.Panel,{header:"Users",children:(0,jsx_runtime.jsx)(typography.Z.Text,{children:"You can manage users: create, delete or modify informations."})},"users"),(0,jsx_runtime.jsx)(collapse.Z.Panel,{header:"Registration",children:(0,jsx_runtime.jsx)(typography.Z.Text,{children:"Allow you to enable / disable the signup and to manage the required pattern for passwords."})},"registration")]})]}),organizations_Organizations=()=>(0,jsx_runtime.jsxs)(card.Z,{title:"Organization",children:[(0,jsx_runtime.jsx)(typography.Z.Text,{children:"Allow you to manage an organization, and associated groups for sharing purpose."}),(0,jsx_runtime.jsxs)(collapse.Z,{children:[(0,jsx_runtime.jsx)(collapse.Z.Panel,{header:"Users",children:(0,jsx_runtime.jsxs)(typography.Z.Text,{children:["Add or remove owners and users.",(0,jsx_runtime.jsx)("br",{}),"Owners and users in an organization can be used to share a workspace or a project."]})},"users"),(0,jsx_runtime.jsx)(collapse.Z.Panel,{header:"Groups",children:(0,jsx_runtime.jsxs)(typography.Z.Text,{children:["Add, modify or remove groups.",(0,jsx_runtime.jsx)("br",{}),"Groups in an organization can be used to share a workspace or a project."]})},"groups")]})]});var browser=__webpack_require__(73461),browser_default=__webpack_require__.n(browser);let About=()=>(0,jsx_runtime.jsxs)(card.Z,{title:"About",children:[(0,jsx_runtime.jsxs)(typography.Z,{children:["Version: ",(0,jsx_runtime.jsx)(typography.Z.Text,{code:!0,children:package_0.i8})]}),(0,jsx_runtime.jsx)("br",{}),(0,jsx_runtime.jsxs)(typography.Z,{children:["Git version:"," ",(0,jsx_runtime.jsx)(typography.Z.Text,{code:!0,children:utils.Z.getGitVersion()})]}),(0,jsx_runtime.jsx)("br",{}),(0,jsx_runtime.jsxs)(typography.Z,{children:["Browser: ",(0,jsx_runtime.jsx)(typography.Z.Text,{code:!0,children:navigator.userAgent})]}),(0,jsx_runtime.jsx)("br",{}),(0,jsx_runtime.jsxs)(typography.Z,{children:["OS: ",(0,jsx_runtime.jsx)(typography.Z.Text,{code:!0,children:browser_default().platform()})]})]}),Help=()=>(0,jsx_runtime.jsxs)(layout.Z,{className:"inDashboard Help",children:[(0,jsx_runtime.jsx)(page_header.Z,{className:"inDashboard-PageHeader",backIcon:!1,title:(0,jsx_runtime.jsx)(typography.Z.Title,{level:2,className:"inDashboard-PageHeader-title",children:"Help"}),extra:(0,jsx_runtime.jsx)("a",{href:"https://github.com/Airthium/tanatloc/issues/new/choose",target:"_blank",rel:"noreferrer",children:"Open an issue"}),footer:(0,jsx_runtime.jsx)(divider.Z,{})}),(0,jsx_runtime.jsx)(layout.Z.Content,{className:"scroll",children:(0,jsx_runtime.jsxs)(space.Z,{direction:"vertical",className:"full-width",size:20,children:[(0,jsx_runtime.jsx)(Workflow,{}),(0,jsx_runtime.jsx)(doc_workspace_Workspace,{}),(0,jsx_runtime.jsx)(Project,{}),(0,jsx_runtime.jsx)(hpc_HPC,{}),(0,jsx_runtime.jsx)(organizations_Organizations,{}),(0,jsx_runtime.jsx)(administration_Administration,{}),(0,jsx_runtime.jsx)(About,{})]})})]}),dashboard_errors={user:"Error while loading user",organizations:"Error while loading organizations",workspaces:"Error while loading workspaces",logout:"Unable to logout"},menuItems={workspaces:{label:"Workspaces",key:"workspaces"},account:{label:"Account Settings",key:"account"},organizations:{label:"Organizations",key:"organizations"},administration:{label:"Administration",key:"administration"},help:{label:"I Need Help",key:"help"},logout:{label:"Logout",key:"logout"}},onSelect=(router,key,clearUser)=>{key===menuItems.logout.key?onLogout(router,clearUser):router.replace({pathname:"/dashboard",query:{page:key}})},onLogout=async(router,clearUser)=>{try{await logout(),clearUser(),router.push("/")}catch(err){(0,notification.lt)(dashboard_errors.logout,err)}},Dashboard=()=>{let[currentKey,setCurrentKey]=(0,react.useState)(),[user,{mutateUser,clearUser,errorUser,loadingUser}]=api_user.Z.useUser(),[organizations,{addOneOrganization,delOneOrganization,mutateOneOrganization,errorOrganizations,loadingOrganizations}]=api_organization.useOrganizations(),[workspaces,{addOneWorkspace,delOneWorkspace,mutateOneWorkspace,errorWorkspaces,loadingWorkspaces}]=api_workspace.useWorkspaces(),router=(0,next_router.useRouter)();return((0,react.useEffect)(()=>{loadingUser||user||router.replace("/")},[user,loadingUser,router]),(0,react.useEffect)(()=>{let params=new URLSearchParams(window.location.search),page=params.get("page");page?setCurrentKey(page):(setCurrentKey(menuItems.workspaces.key),onSelect(router,menuItems.workspaces.key,clearUser))},[router,clearUser]),(0,react.useEffect)(()=>{errorUser&&(0,notification.lt)(dashboard_errors.user,errorUser),errorOrganizations&&(0,notification.lt)(dashboard_errors.organizations,errorOrganizations),errorWorkspaces&&(0,notification.lt)(dashboard_errors.workspaces,errorWorkspaces)},[errorUser,errorOrganizations,errorWorkspaces]),!user||loadingUser||loadingOrganizations||loadingWorkspaces)?(0,jsx_runtime.jsx)(components_loading.Z,{}):(0,jsx_runtime.jsxs)(layout.Z,{className:"Dashboard",children:[(0,jsx_runtime.jsxs)(layout.Z.Sider,{theme:"light",width:"256",className:"Dashboard-Sider",children:[(0,jsx_runtime.jsx)("div",{className:"logo",children:(0,jsx_runtime.jsx)("img",{src:"/images/logo.svg",alt:"Tanatloc"})}),(0,jsx_runtime.jsx)(menu.Z,{className:"Dashboard-Menu",theme:"light",items:[{key:menuItems.workspaces.key,icon:(0,jsx_runtime.jsx)(AppstoreOutlined.Z,{}),label:menuItems.workspaces.label},{key:menuItems.account.key,icon:(0,jsx_runtime.jsx)(SettingOutlined.Z,{}),label:menuItems.account.label},{key:menuItems.organizations.key,icon:(0,jsx_runtime.jsx)(TeamOutlined.Z,{}),label:menuItems.organizations.label,className:is_electron_default()()?"display-none":""},{key:menuItems.administration.key,className:user.superuser&&!is_electron_default()()?"":"display-none",icon:(0,jsx_runtime.jsx)(ControlOutlined.Z,{}),label:menuItems.administration.label},{key:menuItems.help.key,icon:(0,jsx_runtime.jsx)(QuestionCircleOutlined.Z,{}),label:menuItems.help.label},{type:"divider"},{key:menuItems.logout.key,danger:!0,icon:(0,jsx_runtime.jsx)(LogoutOutlined.Z,{}),label:menuItems.logout.label,className:is_electron_default()()?"display-none":""},{key:"version",disabled:!0,className:"version",label:(0,jsx_runtime.jsxs)(typography.Z.Text,{className:"text-light",ellipsis:{tooltip:!0},children:["version ",package_0.i8]})}],onClick(param){let{keyPath}=param,key=keyPath.pop();setCurrentKey(key),onSelect(router,key,clearUser)},mode:"inline"})]}),(0,jsx_runtime.jsxs)(layout.Z.Content,{className:"no-scroll",children:[currentKey===menuItems.workspaces.key&&(0,jsx_runtime.jsx)(WorkspacesList,{user:{id:user.id},workspaces:workspaces,organizations:organizations,swr:{addOneWorkspace,delOneWorkspace,mutateOneWorkspace}}),currentKey===menuItems.account.key&&(0,jsx_runtime.jsx)(Account,{user:{email:user.email,firstname:user.firstname,lastname:user.lastname,avatar:user.avatar},swr:{mutateUser,clearUser}}),currentKey===menuItems.organizations.key&&(0,jsx_runtime.jsx)(Organizations,{user:{id:user.id},organizations:organizations,swr:{addOneOrganization,delOneOrganization,mutateOneOrganization,loadingOrganizations}}),currentKey===menuItems.administration.key&&(0,jsx_runtime.jsx)(Administration,{}),currentKey===menuItems.help.key&&(0,jsx_runtime.jsx)(Help,{})]})]})},dashboard_Dashboard=()=>(0,jsx_runtime.jsx)(Dashboard,{});var pages_dashboard=dashboard_Dashboard},4147:function(module){"use strict";module.exports={i8:"1.1.5"}}},function(__webpack_require__){__webpack_require__.O(0,[305,362,474,266,495,347,690,485,650,566,40,326,620,507,630,584,477,407,774,888,179],function(){return __webpack_require__(__webpack_require__.s=40528)}),_N_E=__webpack_require__.O()}]);