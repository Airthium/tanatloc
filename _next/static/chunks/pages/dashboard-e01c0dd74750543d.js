(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8026],{9637:function(e,a,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/dashboard",function(){return t(33586)}])},59420:function(e,a,t){"use strict";var s;t.d(a,{JT:function(){return n},ah:function(){return o},nq:function(){return i},tE:function(){return l},yL:function(){return r}}),null!==(s=t(83454).env.AUTH_SECRET)&&void 0!==s||Array(33).join("a");let r=6,i=16,n=!0,l=!0,o=!0},72735:function(e,a,t){"use strict";t.d(a,{Z:function(){return i}});var s=t(83755);let r=async(e,a)=>{let t=await (0,s.R)("/api/avatar",{method:"POST",headers:{Accept:"application/json"},body:JSON.stringify({file:e,project:a})});return t.json()};var i={add:r}},93659:function(e,a,t){"use strict";t.d(a,{H:function(){return s}});class s extends Error{constructor(e){var a;super(e.title),this.title=e.title,this.name="APIError",this.render=e.render,this.err=e.err,this.type=null!==(a=e.type)&&void 0!==a?a:"error"}}},52228:function(e,a,t){"use strict";t.d(a,{x:function(){return n}});var s=t(59134),r=t.n(s);let i=r()()?"http://localhost:3000":"",n=async e=>{let a=await fetch(i+"/api/login",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({email:e.email,password:e.password})});return 200===a.status?{ok:!0,...await a.json()}:{ok:!1}}},69081:function(e,a,t){"use strict";t.d(a,{Z:function(){return l}});var s=t(59734),r=t(67294),i=t(83755);let n=async e=>{await (0,i.R)("/api/system",{method:"PUT",body:JSON.stringify(e)})};var l={useSystem:()=>{var e;let{data:a,error:t,mutate:n}=(0,s.ZP)("/api/system",i._),l=null!==(e=null==a?void 0:a.system)&&void 0!==e?e:{},o=(0,r.useCallback)(async e=>{await n({system:{...l,...e}})},[l,n]);return[l,{mutateSystem:o,errorSystem:t,loadingSystem:!a}]},update:n}},74219:function(e,a,t){"use strict";t.d(a,{o:function(){return w}});var s=t(85893),r=t(638),i=t(69677),n=t(59420),l=t(69081);let o={password:"Please enter a password",passwordTooSmall:e=>"Your password is too small (minimum "+e+" characters)",passwordTooLong:e=>"Your password is too long (maximum "+e+" characters)",passwordRequireLetter:"Your password must contain a letter",passwordRequireNumber:"Your password must contain a number",passwordRequireSymbol:"Your password must contain a symbol"},d=(e,a)=>!(a.length<e),c=(e,a)=>!(a.length>e),u=(e,a)=>-1!==e.search(a),m=(e,a)=>{var t,s;return(null!==(s=null==e?void 0:null===(t=e.password)||void 0===t?void 0:t.requireLetter)&&void 0!==s?!s:!n.JT)||u(a,/[a-zA-Z]/)},p=(e,a)=>{var t,s;return(null!==(s=null==e?void 0:null===(t=e.password)||void 0===t?void 0:t.requireNumber)&&void 0!==s?!s:!n.tE)||u(a,/\d/)},h=(e,a)=>{var t,s;return(null!==(s=null==e?void 0:null===(t=e.password)||void 0===t?void 0:t.requireSymbol)&&void 0!==s?!s:!n.ah)||u(a,/[!@#$%^&*(){}[\]<>?/|.:;_-]/)},g=(e,a,t,s)=>{d(e,t)||s.push(o.passwordTooSmall(e)),c(a,t)||s.push(o.passwordTooLong(a))},x=(e,a,t)=>{m(e,a)||t.push(o.passwordRequireLetter),p(e,a)||t.push(o.passwordRequireNumber),h(e,a)||t.push(o.passwordRequireSymbol)};var w=e=>{var a,t,d,c;let{labelCol:u,wrapperCol:m,name:p,label:h,inputPlaceholder:w,inputAutoComplete:y,edit:j,style:v,required:f}=e,[b]=l.Z.useSystem(),k=null!==(d=null==b?void 0:null===(a=b.password)||void 0===a?void 0:a.min)&&void 0!==d?d:n.yL,Z=null!==(c=null==b?void 0:null===(t=b.password)||void 0===t?void 0:t.max)&&void 0!==c?c:n.nq;return(0,s.jsx)(r.Z.Item,{labelCol:u,wrapperCol:m,name:null!=p?p:"password",label:null!=h?h:"Password",rules:[()=>({validator(e,a){let t=[];return j&&"******"===a?Promise.resolve():a?(g(k,Z,a,t),x(b,a,t),t.length)?Promise.reject(t):Promise.resolve():Promise.reject(o.password)}}),{required:!!f,message:""}],style:v,children:(0,s.jsx)(i.Z.Password,{placeholder:w,autoComplete:y})})}},33586:function(e,a,t){"use strict";t.r(a),t.d(a,{default:function(){return tV}});var s=t(85893),r=t(11163),i=t(67294),n=t(97183),l=t(68508),o=t(22850),d=t(41156),c=t(42952),u=t(55355),m=t(11186),p=t(86548),h=t(25035),g=t(92443),x=t(59134),w=t.n(x),y=t(4147),j=t(36642),v=t(9242),f=t(94725),b=t(638),k=t(69677),Z=t(44442),O=t(32983),C=t(86373),z=t(96074),S=t(43308),P=t.n(S),N=e=>{let{className:a,title:t,footer:r,extra:i,children:n}=e;return(0,s.jsxs)("div",{className:a,children:[(t||i)&&(0,s.jsxs)("div",{className:P().head,children:[(0,s.jsx)("div",{children:t}),(0,s.jsx)("div",{children:i})]}),(0,s.jsx)("div",{children:n}),null!=r?r:(0,s.jsx)(z.Z,{className:P().divider})]})},E=t(64590),T=t(51302);let A={add:"Unable to add workspace"},I=async(e,a)=>{try{let t=await E.Z.add(e);await a.addOneWorkspace(t)}catch(e){throw(0,v.lt)(A.add,e),e}};var U=e=>{let{swr:a}=e,t=(0,i.useRef)(null),[r,n]=(0,i.useState)(!1),[l,o]=(0,i.useState)(!1);(0,i.useEffect)(()=>{t.current&&t.current.focus()});let d=(0,i.useCallback)(()=>o(!0),[]),c=(0,i.useCallback)(()=>o(!1),[]),u=(0,i.useCallback)(async e=>{n(!0);try{await I(e,a),n(!1),o(!1)}catch(e){throw n(!1),e}},[a]);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(T.HS,{onAdd:d,children:"Create a new workspace"}),(0,s.jsx)(C.ZP,{visible:l,loading:r,title:"Create a new workspace",onCancel:c,onOk:u,children:(0,s.jsx)(b.Z.Item,{label:"Name",name:"name",rules:[{required:!0,message:"Name is required"},{max:50,message:"Max 50 characters"}],children:(0,s.jsx)(k.Z,{ref:t,placeholder:"Workspace's name"})})})]})},_=t(42075),q=t(98293),D=t(68795),R=t(42592),W=t(77149);let F={add:"Unable to add project"},L=async(e,a,t)=>{try{let s=await W.Z.add({id:e.id},a);return await t.addOneProject(s),await t.mutateOneWorkspace({...e,projects:[...e.projects,s.id]}),s}catch(e){throw(0,v.lt)(F.add,e),e}};var G=e=>{let{workspace:a,swr:t}=e,n=(0,i.useRef)(null),[l,o]=(0,i.useState)(!1),[d,c]=(0,i.useState)(!1),u=(0,r.useRouter)();(0,i.useEffect)(()=>{n.current&&n.current.focus()});let m=(0,i.useCallback)(()=>o(!0),[]),p=(0,i.useCallback)(()=>o(!1),[]),h=(0,i.useCallback)(e=>e.stopPropagation(),[]),g=(0,i.useCallback)(async e=>{c(!0);try{let s=await L(a,e,t);c(!1),o(!1),await u.push({pathname:"/project",query:{page:"workspaces",workspaceId:a.id,projectId:s.id}})}catch(e){throw c(!1),e}},[u,a,t]);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(T.HS,{primary:!1,dark:!0,onAdd:m,children:"Create a new project"}),(0,s.jsxs)(C.ZP,{title:"Create a new project",visible:l,onCancel:p,onOk:g,loading:d,children:[(0,s.jsx)(b.Z.Item,{label:"Name",name:"title",rules:[{required:!0,message:"Name is required"},{max:50,message:"Max 50 characters"}],children:(0,s.jsx)(k.Z,{ref:n,placeholder:"Project's name"})}),(0,s.jsx)(b.Z.Item,{label:"Description",name:"description",children:(0,s.jsx)(k.Z.TextArea,{showCount:!0,style:{marginBottom:"20px"},maxLength:120,placeholder:"Project's description",onKeyUp:h})})]})]})},H=t(85813),M=t(51904),B=t(91978),J=t(83159),K=t(71577);let Y={edit:"Unable to edit project"},V=async(e,a,t)=>{try{await W.Z.update({id:e.id},[{key:"title",value:a.title},{key:"description",value:a.description}]),await t.mutateOneProject(e)}catch(e){throw(0,v.lt)(Y.edit,e),e}};var X=e=>{let{disabled:a,project:t,swr:r}=e,n=(0,i.useRef)(null),[l,o]=(0,i.useState)(!1),[d,c]=(0,i.useState)(!1);(0,i.useEffect)(()=>{n.current&&n.current.focus()});let u=(0,i.useCallback)(()=>o(!0),[]),m=(0,i.useCallback)(()=>o(!1),[]),p=(0,i.useCallback)(async e=>{c(!0);try{await V(t,e,r),c(!1),o(!1)}catch(e){throw c(!1),e}},[t,r]),h=(0,i.useCallback)(e=>e.stopPropagation(),[]);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(T.w6,{disabled:a,dark:!0,onEdit:u}),(0,s.jsxs)(C.ZP,{title:'Edit "'+t.title+'" project',visible:l,onCancel:m,onOk:p,loading:d,initialValues:{title:t.title,description:t.description},children:[(0,s.jsx)(b.Z.Item,{label:"Name",name:"title",rules:[{required:!0,message:"Name is required"},{max:50,message:"Max 50 characters"}],children:(0,s.jsx)(k.Z,{ref:n,placeholder:"Project's name"})}),(0,s.jsx)(b.Z.Item,{label:"Description",name:"description",children:(0,s.jsx)(k.Z.TextArea,{style:{marginBottom:"20px"},placeholder:"Project's description",showCount:!0,maxLength:120,onKeyUp:h})})]})]})},Q=t(99138);let $={del:"Unable to delete project"},ee=async(e,a,t)=>{try{await W.Z.del({id:e.id},{id:a.id});let s=e.projects.findIndex(e=>e===a.id);e.projects=[...e.projects.slice(0,s),...e.projects.slice(s+1)],await t.mutateOneWorkspace(e),await t.delOneProject({id:a.id})}catch(e){throw(0,v.lt)($.del,e),e}};var ea=e=>{let{disabled:a,workspace:t,project:r,swr:n}=e,[l,d]=(0,i.useState)(!1),c=(0,i.useCallback)(async()=>{d(!0);try{await ee(t,r,n)}finally{d(!1)}},[t,r,n]);return(0,s.jsx)(T.m1,{disabled:a,loading:l,title:"Delete the project",text:(0,s.jsxs)(s.Fragment,{children:["Are you sure you want to delete the project"," ",(0,s.jsx)(o.Z.Text,{strong:!0,children:r.title}),"?",(0,s.jsx)(Q.Z,{type:"error",message:"If you delete the project, you will no longer be able to restore the archive",style:{marginTop:"16px"}})]}),onDelete:c})},et=t(31365),es=t(83062),er=t(57546),ei=t(238),en=t(48764).lW;let el={archive:"Unable to archive project",unarchiveServer:"Unable to unarchive project on server",deleteArchive:"Unable to delete archive",badFormat:"Bad archive format (supported format: .tanatlocarchive)",upload:"Unable to upload archive"},eo=async(e,a,t)=>{try{let s=await W.Z.archive({id:a.id}),r=await s.blob(),i=window.URL.createObjectURL(new Blob([r])),n=document.createElement("a");n.href=i,n.setAttribute("download",a.id+".tanatlocarchive"),n.click(),await t.mutateOneProject({...a,archived:!0}),await t.mutateOneWorkspace(e)}catch(e){throw(0,v.lt)(el.archive,e),e}},ed=async(e,a,t)=>{try{await W.Z.unarchiveFromServer({id:a.id}),await t.mutateOneProject({...a,archived:!1}),await t.mutateOneWorkspace(e)}catch(e){throw(0,v.lt)(el.unarchiveServer,e),e}},ec=async e=>{try{await W.Z.deleteArchiveFile({id:e.id})}catch(e){(0,v.lt)(el.deleteArchive,e)}},eu=async e=>{let a=new FileReader;return new Promise(t=>{a.addEventListener("load",()=>{t(a.result)}),a.readAsArrayBuffer(e)})},em=async(e,a,t,s)=>{if("uploading"===t.file.status)return!0;if("done"===t.file.status)try{let r=await eu(t.file.originFileObj);await W.Z.unarchiveFromFile({id:a.id},en.from(r)),await s.mutateOneProject({...a,archived:!1}),await s.mutateOneWorkspace(e)}catch(e){(0,v.lt)(el.upload,e)}return!1};var ep=e=>{let{disabled:a,workspace:t,project:r,swr:n}=e,[l,d]=(0,i.useState)(!1),[c,u]=(0,i.useState)(!1),m=(0,i.useCallback)(()=>d(!0),[]),p=(0,i.useCallback)(()=>d(!1),[]),h=(0,i.useCallback)(async()=>{u(!0);try{await eo(t,r,n),u(!1),d(!1)}catch(e){throw u(!1),e}},[t,r,n]),g=(0,i.useCallback)(()=>{(async()=>{u(!0);try{await ed(t,r,n),u(!1),d(!1)}catch(e){u(!1)}})()},[t,r,n]),x=(0,i.useCallback)(e=>{(async()=>{let a=await em(t,r,e,n);u(a),d(a)})()},[t,r,n]),w=(0,i.useCallback)(async()=>ec(r),[r]);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(C.ZP,{visible:l,loading:c,title:"Archive",onCancel:p,onOk:r.archived?void 0:h,okButtonText:"Archive",children:r.archived?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(b.Z.Item,{label:"Restore archive from the server",tooltip:"This will restore the project from the server archive file.",children:(0,s.jsx)(K.ZP,{loading:c,onClick:g,children:"Restore archive from the server"})}),(0,s.jsx)(b.Z.Item,{label:"Restore archive from local file",tooltip:"This will restore the project from your local archive file (.tanatlocarchive file).",children:(0,s.jsx)(et.Z,{action:"/api/noop",accept:".tanatlocarchive",showUploadList:!1,onChange:x,children:(0,s.jsx)(K.ZP,{children:"Restore archive from archive file"})})}),(0,s.jsx)(b.Z.Item,{label:"Delete archive from the server",tooltip:"This will delete the archive file from the server, you will have to use a local copy to restore the project.",children:(0,s.jsx)(T.m1,{loading:c,bordered:!0,title:"Delete server archive",text:"Are you sure your want to delete the archive from the server?",onDelete:w,children:"Delete server archive"})})]}):(0,s.jsxs)(o.Z.Text,{children:["An archive will be downloaded and the project will not be editable anymore, archive the project \xab",r.title,"\xbb?"]})}),(0,s.jsx)(es.Z,{title:r.archived?"Manage archive":"Archive",children:(0,s.jsx)(K.ZP,{disabled:a,type:"link",icon:r.archived?(0,s.jsx)(er.Z,{}):(0,s.jsx)(ei.Z,{}),onClick:m})})]})},eh=t(57132),eg=t(14856),ex=t.n(eg);let ew={copy:"Unable to copy project"},ey=async(e,a,t)=>{try{let s=await W.Z.copy(e,a);await t.addOneProject(s),e.projects.push(s.id),await t.mutateOneWorkspace(e)}catch(e){(0,v.lt)(ew.copy,e)}};var ej=e=>{let{workspace:a,project:t,swr:r}=e,n=(0,i.useCallback)(()=>{(async()=>{await ey(a,t,r)})()},[a,t,r]);return(0,s.jsx)(es.Z,{title:"Copy",children:(0,s.jsx)(K.ZP,{icon:(0,s.jsx)(eh.Z,{}),className:"".concat(ex().noBorder," ").concat(ex().noBackground),onClick:n})})},ev=t(87782),ef=t(61131),eb=t.n(ef),ek=t(89705),eZ=t(48764).lW;let eO=e=>{var a,t,n,l;let{user:d,workspace:c,page:u,project:m,organizations:p,swr:h}=e,g=(0,r.useRouter)(),x=(0,i.useCallback)(()=>{(async()=>{m.archived||await g.push({pathname:"/project",query:{page:u,workspaceId:c.id,projectId:m.id}})})()},[g,c,u,m]),w=(0,i.useMemo)(()=>m.archived?(0,s.jsx)(O.Z,{description:"Archived project"}):m.avatar?(0,s.jsx)("img",{src:eZ.from(m.avatar).toString(),alt:"Tanatloc"}):(0,s.jsx)(O.Z,{image:"images/empty.svg",description:"No preview yet."}),[m]),y=(0,i.useMemo)(()=>(0,s.jsxs)(_.Z,{direction:"vertical",className:"".concat(ex().fullWidth," ").concat(ex().textAlignLeft),children:[(0,s.jsxs)(o.Z.Text,{children:[(0,s.jsx)("b",{children:"Created:"})," ",new Date(m.createddate).toLocaleDateString()]}),(0,s.jsxs)(o.Z.Text,{children:[(0,s.jsx)("b",{children:"Last modified:"})," ",new Date(m.lastaccess).toLocaleDateString()]}),m.description&&(0,s.jsx)(o.Z.Paragraph,{ellipsis:{rows:4,tooltip:!0},children:m.description})]}),[m]),j=(0,i.useMemo)(()=>{var e;return null===(e=m.owners)||void 0===e?void 0:e.map(e=>ev.Z.userToAvatar(e))},[m]),v=(0,i.useMemo)(()=>{var e;return null===(e=m.users)||void 0===e?void 0:e.map(e=>ev.Z.userToAvatar(e))},[m]),f=(0,i.useMemo)(()=>{var e;return null==m?void 0:null===(e=m.groups)||void 0===e?void 0:e.map(e=>ev.Z.groupToAvatar(e))},[m]);return(0,s.jsx)(H.Z,{title:(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(o.Z.Paragraph,{ellipsis:{rows:2,tooltip:!0},children:m.title}),m.archived&&(0,s.jsx)(M.Z,{children:"Archived"})]}),className:"".concat(eb().card," ").concat(m.archived?eb().cardArchived:""),cover:(0,s.jsxs)(B.Z,{className:eb().carousel,dots:{className:"dots"},children:[(0,s.jsx)("div",{className:"".concat(eb().carouselSnapshot," ").concat(m.archived?eb().carouselSnapshotArchived:""),onClick:x,children:w}),(0,s.jsx)("div",{className:"".concat(eb().carouselDescription," ").concat(m.archived?eb().carouselDescriptionArchived:""),onClick:x,children:y})]}),actions:[(0,s.jsx)(X,{disabled:!(null==m?void 0:null===(a=m.owners)||void 0===a?void 0:a.find(e=>e.id===(null==d?void 0:d.id))),project:{id:m.id,title:m.title,description:m.description},swr:{mutateOneProject:h.mutateOneProject}},"edit"),(0,s.jsx)(R.ZP,{disabled:!(null==m?void 0:null===(t=m.owners)||void 0===t?void 0:t.find(e=>e.id===(null==d?void 0:d.id))),project:{id:m.id,title:m.title,groups:m.groups,users:m.users},organizations:p,swr:{mutateOneProject:h.mutateOneProject},style:{buttonDark:!0}},"share"),(0,s.jsx)(ej,{workspace:{id:c.id,projects:c.projects},project:{id:m.id},swr:{addOneProject:h.addOneProject,mutateOneWorkspace:h.mutateOneWorkspace}},"copy"),(0,s.jsx)(J.Z,{menu:{items:[{key:"archive",label:(0,s.jsx)(ep,{disabled:!(null==m?void 0:null===(n=m.owners)||void 0===n?void 0:n.find(e=>e.id===(null==d?void 0:d.id))),workspace:{id:c.id},project:{archived:m.archived,id:m.id,title:m.title},swr:{mutateOneWorkspace:h.mutateOneWorkspace,mutateOneProject:h.mutateOneProject}},"archive")},{key:"delete",label:(0,s.jsx)(ea,{disabled:!(null==m?void 0:null===(l=m.owners)||void 0===l?void 0:l.find(e=>e.id===(null==d?void 0:d.id))),workspace:{id:c.id,projects:c.projects},project:{id:m.id,title:m.title},swr:{mutateOneWorkspace:h.mutateOneWorkspace,delOneProject:h.delOneProject}})}]},children:(0,s.jsx)(K.ZP,{icon:(0,s.jsx)(ek.Z,{}),className:ex().noBorder})},"more")],children:(0,s.jsxs)("div",{style:{padding:"6px 0",display:"grid",gridTemplateColumns:"10fr 1fr 20fr",gridTemplateRows:"auto auto"},children:[(0,s.jsx)("div",{children:"Admin:"}),(0,s.jsx)("div",{}),(0,s.jsx)("div",{children:"Shared with:"}),(0,s.jsx)(q.C.Group,{maxCount:5,children:j}),(0,s.jsx)(z.Z,{type:"vertical",style:{height:"80%",borderColor:"#f0f0f0"}}),(0,s.jsxs)(q.C.Group,{children:[v,f]})]})},m.id)};var eC=e=>{let{user:a,page:t,workspace:r,projects:n,organizations:l,filter:o,sorter:d,swr:c}=e,[u,m]=(0,i.useState)(!0),[p,h]=(0,i.useState)([]);return((0,i.useEffect)(()=>{let e=n.map(e=>{var a,t;if(!o||(null===(a=null===(t=e.title)||void 0===t?void 0:t.toLowerCase())||void 0===a?void 0:a.includes(o.toLowerCase())))return e}).filter(e=>e);switch(d){case"alphaAsc":e.sort((e,a)=>e.title.localeCompare(a.title));break;case"alphaDesc":e.sort((e,a)=>-1*e.title.localeCompare(a.title));break;case"modifiedDesc":e.sort((e,a)=>new Date(a.lastaccess).getTime()-new Date(e.lastaccess).getTime())}h(e),m(!1)},[n,o,d]),u||c.loadingProjects)?(0,s.jsx)(f.Z.Simple,{}):p.length?(0,s.jsx)("div",{children:(0,s.jsx)(_.Z,{style:{marginBottom:"20px"},wrap:!0,align:"start",size:20,children:p.map(e=>(0,s.jsx)(eO,{user:a,workspace:r,page:t,project:e,organizations:l,swr:c},e.id))})}):(0,s.jsx)(O.Z,{image:"images/empty.svg",className:eb().empty,description:o?(0,s.jsxs)(s.Fragment,{children:["No project found with the current search"," ",(0,s.jsx)("span",{className:eb().emptySearch,children:o}),"..."]}):(0,s.jsx)(s.Fragment,{children:"No project for now... Get started!"})})};let ez={update:"Unable to update workspace"},eS=async(e,a,t)=>{try{let s=ev.Z.deepCopy(e);e.name=a.name,await E.Z.update({id:e.id},[{key:"name",value:a.name}]),await t.mutateOneWorkspace(s)}catch(e){throw(0,v.lt)(ez.update,e),e}};var eP=e=>{let{workspace:a,swr:t}=e,r=(0,i.useRef)(null),[n,l]=(0,i.useState)(!1),[o,d]=(0,i.useState)(!1);(0,i.useEffect)(()=>{r.current&&r.current.focus()});let c=(0,i.useCallback)(()=>l(!0),[]),u=(0,i.useCallback)(()=>l(!1),[]),m=(0,i.useCallback)(async e=>{d(!0);try{await eS(a,e,t),d(!1),l(!1)}catch(e){throw d(!1),e}},[a,t]);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(T.w6,{bordered:!0,dark:!0,onEdit:c}),(0,s.jsx)(C.ZP,{visible:n,loading:o,title:"Edit the workspace",initialValues:{name:a.name},onCancel:u,onOk:m,children:(0,s.jsx)(b.Z.Item,{label:"Name",name:"name",rules:[{required:!0,message:"Name is required"},{max:50,message:"Max 50 characters"}],children:(0,s.jsx)(k.Z,{ref:r,placeholder:"Workspace's name"})})})]})};let eN={del:"Unable to delete workspace"},eE=async(e,a)=>{try{await E.Z.del({id:e.id}),await a.delOneWorkspace({id:e.id})}catch(e){throw(0,v.lt)(eN.del,e),e}};var eT=e=>{let{workspace:a,swr:t}=e,[r,n]=(0,i.useState)(!1),l=(0,i.useCallback)(async()=>{n(!0);try{await eE(a,t)}finally{n(!1)}},[a,t]);return(0,s.jsx)(T.m1,{bordered:!0,loading:r,text:"The projects contained in this workspace will be lost.",onDelete:l})},eA=t(85318),eI=t.n(eA);let eU={projects:"Error while loading projects",update:"Unable to update workspace"};var e_=e=>{var a,t,r,l,o,d;let{user:c,page:u,workspace:m,organizations:p,swr:h}=e,[g,x]=(0,i.useState)(),[w,y]=(0,i.useState)(),[j,{addOneProject:f,delOneProject:b,mutateOneProject:O,errorProjects:C,loadingProjects:z}]=W.Z.useProjects(null==m?void 0:m.projects);(0,i.useEffect)(()=>{C&&(0,v.lt)(eU.projects,C)},[C]);let S=(0,i.useCallback)(e=>x(e.target.value),[]);return(0,s.jsxs)(n.Z,{className:ex().noScroll,children:[(0,s.jsx)(N,{footer:(0,s.jsxs)(_.Z,{direction:"horizontal",size:"large",className:"".concat(eI().search," ").concat(ex().fullWidth),children:[(0,s.jsx)(k.Z,{placeholder:"Enter a project name (case sensitive)",value:g,onChange:S,style:{width:500},suffix:(0,s.jsx)(D.Z,{className:ex().textLight})}),(null==m?void 0:null===(a=m.owners)||void 0===a?void 0:a.find(e=>e.id===c.id))?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(G,{workspace:{id:m.id,projects:m.projects},swr:{mutateOneWorkspace:h.mutateOneWorkspace,addOneProject:f}}),(0,s.jsxs)(_.Z,{size:8,children:[(0,s.jsx)(eP,{workspace:{id:m.id,name:m.name},swr:{mutateOneWorkspace:h.mutateOneWorkspace}}),(0,s.jsx)(R.ZP,{workspace:{id:m.id,name:m.name,groups:m.groups,users:m.users},organizations:p,swr:{mutateOneWorkspace:h.mutateOneWorkspace},style:{buttonDark:!0,buttonBordered:!0}}),(0,s.jsx)(eT,{workspace:{id:m.id},swr:{delOneWorkspace:h.delOneWorkspace}})]})]}):(0,s.jsx)("div",{})]}),children:(null===(t=m.users)||void 0===t?void 0:t.length)||(null===(r=m.groups)||void 0===r?void 0:r.length)?(0,s.jsxs)("div",{className:eI().shared,children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{style:{marginRight:"10px"},children:"Admin:"}),(0,s.jsx)(q.C.Group,{maxCount:5,children:null===(l=m.owners)||void 0===l?void 0:l.map(e=>ev.Z.userToAvatar(e))})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{style:{marginRight:"10px"},children:"Shared with:"}),(0,s.jsx)(q.C.Group,{maxCount:5,children:null===(o=m.users)||void 0===o?void 0:o.map(e=>ev.Z.userToAvatar(e))}),(0,s.jsx)(q.C.Group,{maxCount:5,children:null===(d=m.groups)||void 0===d?void 0:d.map(e=>ev.Z.groupToAvatar(e))})]})]}):void 0}),(0,s.jsx)(Z.Z,{className:eI().tabs,items:[{key:"modifiedDesc",label:"Last modified"},{key:"alphaAsc",label:"Name (A-Z)"},{key:"alphaDesc",label:"Name (Z-A)"}],defaultActiveKey:"modifiedDesc",onChange:y}),(0,s.jsx)(n.Z.Content,{className:ex().scroll,style:{height:"50vh"},children:(0,s.jsx)(eC,{user:c,page:u,workspace:{id:m.id,projects:m.projects},projects:j,organizations:p,filter:g,sorter:w,swr:{addOneProject:f,mutateOneWorkspace:h.mutateOneWorkspace,delOneProject:b,mutateOneProject:O,loadingProjects:z}})})]})},eq=t(89957),eD=t.n(eq);let eR={add:"Unable to add workspace"},eW=async(e,a,t)=>{try{let s=await E.Z.add(a);await t.addOneWorkspace(s),await e.push({pathname:"/dashboard",query:{page:"workspaces",workspaceId:s.id}}).catch()}catch(e){throw(0,v.lt)(eR.add,e),e}};var eF=e=>{let{user:a,workspaces:t,organizations:l,swr:d}=e,c=(0,i.useRef)(null),[u,m]=(0,i.useState)(!1),[p,h]=(0,i.useState)(!1),g=(0,r.useRouter)(),{page:x,workspaceId:w}=g.query;(0,i.useEffect)(()=>{c.current&&c.current.focus()});let y=(0,i.useCallback)(()=>{m(!0)},[]),j=(0,i.useCallback)(()=>{m(!1)},[]),v=(0,i.useCallback)(e=>{(async()=>{await g.push({pathname:"/dashboard",query:{page:"workspaces",workspaceId:e}})})()},[g]),f=(0,i.useCallback)(async e=>{h(!0);try{await eW(g,e,d),h(!1),m(!1)}catch(e){throw h(!1),e}},[g,d]);return(0,s.jsxs)(n.Z,{className:"".concat(eD().inDashboard," ").concat(ex().noScroll),children:[(0,s.jsx)(N,{title:(0,s.jsx)(o.Z.Title,{level:2,style:{marginBottom:"0 !important"},children:"Workspaces"})}),(0,s.jsx)(n.Z.Content,{className:ex().noScroll,children:t.length?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(C.ZP,{visible:u,loading:p,title:"Create a new workspace",onCancel:j,onOk:f,children:(0,s.jsx)(b.Z.Item,{label:"Name",name:"name",rules:[{required:!0,message:"Name is required"},{max:50,message:"Max 50 characters"}],children:(0,s.jsx)(k.Z,{ref:c,placeholder:"Workspace's name"})})}),(0,s.jsx)(Z.Z,{type:"editable-card",className:"".concat(ex().noScroll," ").concat(eD().inDashboardTabs),items:t.map(e=>({key:e.id,label:e.name,css:ex().noScroll,closable:!1,children:(0,s.jsx)(e_,{user:a,page:null!=x?x:tK.workspaces.key,workspace:{id:e.id,name:e.name,projects:e.projects,owners:e.owners,users:e.users,groups:e.groups},organizations:l,swr:{delOneWorkspace:d.delOneWorkspace,mutateOneWorkspace:d.mutateOneWorkspace}})})),defaultActiveKey:"1",activeKey:w,onChange:v,onEdit:y})]}):(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(O.Z,{image:"images/empty.svg",description:"No workspace for now. Get started !",children:(0,s.jsx)(U,{swr:{addOneWorkspace:d.addOneWorkspace}})})})})]})},eL=t(87547),eG=t(88484),eH=t(93659),eM=t(42661),eB=t(72735),eJ=t(19563),eK=t.n(eJ),eY=t(48764).lW;let eV={update:"Unable to update informations",upload:"Unable to upload image",badFormat:"Supported formats: jpg, png",badSize:"Image must be smaller than 5MB"},eX=e=>{let a="image/jpeg"===e.type||"image/png"===e.type;a||(0,v.lt)(eV.badFormat);let t=e.size/1024/1024<1;return t||(0,v.lt)(eV.badSize),a&&t},eQ=async e=>{let a=new FileReader;return new Promise(t=>{a.addEventListener("load",()=>{t(a.result)}),a.readAsDataURL(e)})},e$=async(e,a,t)=>{if("uploading"===a.file.status)return!0;if("done"!==a.file.status)return!1;try{let s=await eQ(a.file.originFileObj);await eB.Z.add({name:a.file.name,uid:a.file.uid,data:s}),await t.mutateUser({...e,avatar:eY.from(s)})}catch(e){(0,v.lt)(eV.upload,e)}return!1},e0=async(e,a,t)=>{try{let s=[];if(e.email!==a.email&&s.push({key:"email",value:a.email}),e.firstname!==a.firstname&&s.push({key:"firstname",value:a.firstname}),e.lastname!==a.lastname&&s.push({key:"lastname",value:a.lastname}),!s.length)return;await eM.Z.update(s),await t.mutateUser({email:a.email,firstname:a.firstname,lastname:a.lastname}),s.find(e=>"email"===e.key)&&(0,v.Ur)("Changes saved","A validation email has been send to "+a.email)}catch(e){throw new eH.H({title:eV.update,err:e})}};var e1=e=>{var a,t;let{user:r,swr:n}=e,[l,o]=(0,i.useState)(!1),[d,c]=(0,i.useState)(!1),[u,m]=(0,i.useState)(),p=(0,i.useCallback)(e=>{(async()=>{let a=await e$(r,e,n);o(a)})()},[r,n]),h=(0,i.useCallback)(e=>{(async()=>{c(!0);try{await e0(r,e,n),m(void 0)}catch(e){m(e)}finally{c(!1)}})()},[r,n]);return(0,s.jsx)(H.Z,{title:"Contact Details",children:(0,s.jsxs)(_.Z,{direction:"horizontal",className:eK().information,children:[(0,s.jsxs)("div",{className:eK().avatar,children:[(0,s.jsx)(q.C,{size:128,src:r.avatar&&eY.from(r.avatar).toString(),icon:(0,s.jsx)(eL.Z,{})}),(0,s.jsx)(et.Z,{action:"/api/noop",accept:".jpg,.png",showUploadList:!1,beforeUpload:eX,onChange:p,children:(0,s.jsx)(K.ZP,{loading:l,icon:(0,s.jsx)(eG.Z,{}),children:"Upload new"})})]}),(0,s.jsx)("div",{className:eK().form,children:(0,s.jsxs)(b.Z,{labelCol:{span:4},style:{maxWidth:500},initialValues:{email:r.email,firstname:null!==(a=r.firstname)&&void 0!==a?a:"",lastname:null!==(t=r.lastname)&&void 0!==t?t:""},onFinish:h,children:[(0,s.jsx)(b.Z.Item,{label:"Email",name:"email",rules:[{max:50,message:"Max 50 characters"}],children:(0,s.jsx)(k.Z,{disabled:w()()})}),(0,s.jsx)(b.Z.Item,{label:"First name",name:"firstname",rules:[{max:50,message:"Max 50 characters"}],children:(0,s.jsx)(k.Z,{})}),(0,s.jsx)(b.Z.Item,{label:"Last name",name:"lastname",rules:[{max:50,message:"Max 50 characters"}],children:(0,s.jsx)(k.Z,{})}),(0,s.jsx)(v.Xq,{error:u}),(0,s.jsx)(b.Z.Item,{wrapperCol:{offset:4},children:(0,s.jsx)(K.ZP,{loading:d,type:"primary",htmlType:"submit",children:"Save changes"})})]})})]})})},e5=t(74219);let e2={check:"Unable to check password",update:"Unable to update password",passwordMismatch:"Password and confirmation mismatch",invalid:"Current password is not valid"},e3=async(e,a)=>{let t;try{t=await eM.Z.check({email:e.email,password:a.password})}catch(e){throw new eH.H({title:e2.check,err:e})}if(!t.valid)throw new eH.H({title:e2.invalid});try{await eM.Z.update([{type:"crypt",key:"password",value:a.newPassword}]),(0,v.Ur)("Your password has been changed successfully")}catch(e){throw new eH.H({title:e2.update,err:e})}};var e8=e=>{let{user:a}=e,[t,r]=(0,i.useState)(!1),[n,l]=(0,i.useState)(),o=(0,i.useCallback)(e=>{(async()=>{r(!0);try{await e3(a,e),l(void 0)}catch(e){l(e)}finally{r(!1)}})()},[a]);return(0,s.jsx)(H.Z,{title:"Your Password",children:(0,s.jsxs)(b.Z,{labelCol:{offset:2},wrapperCol:{offset:2},style:{maxWidth:500},layout:"vertical",onFinish:o,name:"passwordForm",children:[(0,s.jsx)(b.Z.Item,{label:"Current password",name:"password",rules:[{required:!0,message:"Current password is required"}],children:(0,s.jsx)(k.Z.Password,{placeholder:"Current password"})}),(0,s.jsx)(e5.o,{name:"newPassword",label:"New password",inputPlaceholder:"Enter a new password",required:!0}),(0,s.jsx)(b.Z.Item,{label:"Password confirmation",name:"passwordConfirm",rules:[{required:!0,message:"Password confirmation is required"},e=>{let{getFieldValue:a}=e;return{validator:(e,t)=>t&&a("newPassword")!==t?Promise.reject(e2.passwordMismatch):Promise.resolve()}}],children:(0,s.jsx)(k.Z.Password,{placeholder:"Confirm your new password"})}),(0,s.jsx)(v.Xq,{error:n}),(0,s.jsx)(b.Z.Item,{children:(0,s.jsx)(_.Z,{children:(0,s.jsx)(K.ZP,{type:"primary",htmlType:"submit",loading:t,children:"Modify password"})})})]})})};let e4=w()()?"http://localhost:3000":"",e9=async()=>{await fetch(e4+"/api/logout")},e6={del:"Unable to delete user"},e7=async e=>{try{await eM.Z.del(),await e9(),await e.clearUser()}catch(e){throw(0,v.lt)(e6.del,e),e}};var ae=e=>{let{swr:a}=e,[t,r]=(0,i.useState)(!1),n=(0,i.useCallback)(async()=>{r(!0);try{await e7(a)}finally{r(!1)}},[a]);return(0,s.jsx)(H.Z,{title:"Delete your account",children:(0,s.jsx)(T.m1,{title:"Delete your account",text:"This action cannot be undone. If you delete your account, you will permanently lose your workspaces and projects.",bordered:!0,loading:t,onDelete:n,children:"Delete your account"})})},aa=t(57953),at=t(55276),as=t(33997),ar=t(34041),ai=t(25935);let an={update:"Unable to update plugins"},al=(e,a,t)=>{var r;return(0,s.jsx)(b.Z.Item,{name:a,label:e.label,htmlFor:"input-"+a,tooltip:e.tooltip,rules:e.rules,children:(0,s.jsx)(k.Z,{ref:t,id:"input-"+a,autoComplete:"off",...null!==(r=e.props)&&void 0!==r?r:{}})},a)},ao=(e,a)=>{var t;return(0,s.jsx)(b.Z.Item,{name:a,label:e.label,htmlFor:"input-"+a,tooltip:e.tooltip,rules:e.rules,children:(0,s.jsx)(k.Z.TextArea,{id:"input-"+a,autoComplete:"off",...null!==(t=e.props)&&void 0!==t?t:{}})},a)},ad=(e,a)=>{var t;return(0,s.jsx)(b.Z.Item,{name:a,label:e.label,htmlFor:"input-"+a,tooltip:e.tooltip,rules:e.rules,children:(0,s.jsx)(k.Z,{id:"input-"+a,type:"password",autoComplete:"off",...null!==(t=e.props)&&void 0!==t?t:{}})},a)},ac=(e,a)=>{var t;return(0,s.jsx)(b.Z.Item,{name:a,label:e.label,htmlFor:"select-"+a,tooltip:e.tooltip,rules:e.rules,children:(0,s.jsx)(ar.Z,{id:"select-"+a,children:e.options.map(a=>(0,s.jsx)(ar.Z.Option,{value:a,...null!==(t=e.props)&&void 0!==t?t:{},children:a},a))})},a)},au=async(e,a,t,s)=>{try{var r,i;if(a){let a=ev.Z.deepCopy(e);Object.keys(t).forEach(e=>{a.configuration[e].value=t[e]}),a.needReInit=!0,await as.Z.update(a),await (null===(r=s.mutateOnePlugin)||void 0===r?void 0:r.call(s,a))}else{let a=ev.Z.deepCopy(e);a.uuid="add",Object.keys(t).forEach(e=>{a.configuration[e].value=t[e]}),await as.Z.add(a),await (null===(i=s.addOnePlugin)||void 0===i?void 0:i.call(s,a))}}catch(e){throw(0,v.lt)(an.update,e),e}};var am=e=>{var a;let{plugin:t,swr:r,edit:n}=e,l=(0,i.useRef)(null),[d,c]=(0,i.useState)(!1),[u,m]=(0,i.useState)(!1),[p,h]=(0,i.useState)({});(0,i.useEffect)(()=>{let e={};Object.keys(t.configuration).forEach(a=>{var s;e[a]=null!==(s=t.configuration[a].value)&&void 0!==s?s:t.configuration[a].default}),h(e)},[null==t?void 0:t.configuration]),(0,i.useEffect)(()=>{l.current&&l.current.focus()});let g=(0,i.useCallback)(()=>{c(!0)},[]),x=(0,i.useCallback)(()=>{c(!1)},[]),w=(0,i.useCallback)(async e=>{m(!0);try{await au(t,!!n,e,r),m(!1),c(!1)}catch(e){throw m(!1),e}},[t,r,n]),y=(0,i.useMemo)(()=>Object.keys(t.configuration).map((e,a)=>{let r=t.configuration[e];return"input"===r.type?al(r,e,0===a?l:void 0):"textarea"===r.type?ao(r,e):"password"===r.type?ad(r,e):"select"===r.type?ac(r,e):(0,s.jsx)("div",{},e)}),[t.configuration]);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(C.ZP,{title:t.name,visible:d,initialValues:p,onCancel:x,onOk:w,loading:u,children:(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(o.Z.Text,{children:(0,ai.ZP)(null!==(a=t.description)&&void 0!==a?a:"")}),y]})}),n?(0,s.jsx)(T.w6,{onEdit:g,children:"Edit"}):(0,s.jsxs)(T.HS,{onAdd:g,children:["Add a new \xab",t.name,"\xbb configuration"]})]})};let ap={del:"Unable to delete plugin"},ah=async(e,a)=>{try{await as.Z.del({uuid:e.uuid}),await a.delOnePlugin(e)}catch(e){throw(0,v.lt)(ap.del,e),e}};var ag=e=>{var a;let{plugin:t,swr:r}=e,[n,l]=(0,i.useState)(!1),d=(0,i.useCallback)(async()=>{l(!0);try{await ah(t,r)}finally{l(!1)}},[t,r]);return(0,s.jsx)(T.m1,{loading:n,title:"Delete plugin",text:(0,s.jsxs)(s.Fragment,{children:["Are you sure you want to delete the plugin"," ",(0,s.jsx)(o.Z.Text,{strong:!0,children:null===(a=t.configuration.name)||void 0===a?void 0:a.value}),"?"]}),onDelete:d,children:"Delete"})},ax=t(33160);let aw={refresh:"Unable to refresh plugin"},ay=async e=>{try{let a=ev.Z.deepCopy(e);a.needReInit=!0,await as.Z.update(a)}catch(e){(0,v.lt)(aw.refresh,e)}};var aj=e=>{let{plugin:a}=e,[t,r]=(0,i.useState)(!1),n=(0,i.useCallback)(()=>{(async()=>{r(!0),await ay(a),r(!1)})()},[a]);return(0,s.jsx)(K.ZP,{loading:t,icon:(0,s.jsx)(ax.Z,{}),onClick:n,className:"".concat(ex().noBackground," ").concat(ex().noBorder),children:"Refresh"},"refresh")},av=e=>{let{plugin:a,plugins:t,swr:r}=e,[n,l]=(0,i.useState)([]);return(0,i.useEffect)(()=>{let e=t.map(e=>{var t,i;if(e.key!==a.key)return;let n=e.configuration,l=Object.keys(n).map(e=>{let a;if("name"!==e){if("textarea"===n[e].type){let t=n[e].value;a=(0,s.jsx)(o.Z.Paragraph,{children:(0,s.jsx)("pre",{children:(0,s.jsx)("code",{children:t})})})}else if("password"===n[e].type)a=(0,s.jsx)(o.Z.Text,{children:"******"});else{var t;a=(0,s.jsx)(o.Z.Text,{children:null!==(t=n[e].value)&&void 0!==t?t:"unset"})}return(0,s.jsxs)(o.Z.Paragraph,{children:[(0,s.jsxs)(o.Z.Text,{strong:!0,children:[n[e].label,":"]})," ",a]},e)}}).filter(e=>e),d=[];return d.push((0,s.jsx)(ag,{plugin:{uuid:e.uuid,configuration:e.configuration},swr:{delOnePlugin:r.delOnePlugin}},"delete")),e.haveInit&&d.push((0,s.jsx)(aj,{plugin:e})),d.push((0,s.jsx)(am,{plugin:e,swr:{mutateOnePlugin:r.mutateOnePlugin},edit:!0},"plugin")),(0,s.jsx)(H.Z,{title:null===(t=n.name)||void 0===t?void 0:t.value,actions:d,children:(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(o.Z.Text,{children:(0,ai.ZP)(null!==(i=e.description)&&void 0!==i?i:"")}),l.length?l:(0,s.jsx)(o.Z.Text,{children:"No configuration data"})]})},e.uuid)}).filter(e=>e);l(e)},[a,t,r]),(0,s.jsx)(_.Z,{direction:"horizontal",wrap:!0,size:20,children:n})};let af={plugins:"Error while loading plugins"};var ab=e=>{let{plugin:a}=e,[t,{addOnePlugin:r,delOnePlugin:n,mutateOnePlugin:l,errorPlugins:o,loadingPlugins:d}]=as.Z.usePlugins();return((0,i.useEffect)(()=>{o&&(0,v.lt)(af.plugins,o)},[o]),d)?(0,s.jsx)(aa.Z,{}):(0,s.jsxs)(_.Z,{direction:"vertical",className:ex().fullWidth,children:[(0,s.jsx)(am,{plugin:{uuid:a.uuid,key:a.key,name:a.name,description:a.description,haveInit:a.haveInit,configuration:a.configuration,inUseConfiguration:a.inUseConfiguration},swr:{addOnePlugin:r}}),(0,s.jsx)(av,{plugin:{key:a.key},plugins:t,swr:{delOnePlugin:n,mutateOnePlugin:l}})]})};let ak={plugins:"Unable to load plugins"},aZ=async()=>{try{let e=await at.Z.list(),a=e.filter(e=>"HPC"===e.category);if(a.length)return a.map(e=>(0,s.jsx)(H.Z,{title:e.name,children:(0,s.jsx)(ab,{plugin:{key:e.key,name:e.name,description:e.description,haveInit:e.haveInit,configuration:e.configuration,inUseConfiguration:e.inUseConfiguration}})},e.key));return[(0,s.jsx)(H.Z,{title:"No access",children:"You do not have access to any HPC plugin. Request it."},"no-access")]}catch(e){return(0,v.lt)(ak.plugins,e),[(0,s.jsx)(H.Z,{title:"Error",children:"Something led to an error. Please try again later."},"error")]}};var aO=()=>{let[e,a]=(0,i.useState)([(0,s.jsx)(H.Z,{title:"Loading",children:(0,s.jsx)(aa.Z,{})},"loading")]);return(0,i.useEffect)(()=>{(async()=>{let e=await aZ();a(e)})()},[]),(0,s.jsx)(_.Z,{direction:"vertical",className:"".concat(ex().fullWidth," ").concat(ex().scroll),size:20,children:e})},aC=e=>{let{user:a,swr:t}=e,l=(0,r.useRouter)(),{tab:d}=l.query,c=(0,i.useMemo)(()=>[{key:"personal",label:"Personal Information",children:(0,s.jsxs)(_.Z,{direction:"vertical",className:ex().fullWidth,size:20,children:[(0,s.jsx)(e1,{user:{email:a.email,firstname:a.firstname,lastname:a.lastname,avatar:a.avatar},swr:{mutateUser:t.mutateUser}}),!w()()&&(0,s.jsx)(ae,{swr:{clearUser:t.clearUser}})]})},w()()?null:{key:"security",label:"Security",children:(0,s.jsx)(_.Z,{direction:"vertical",className:ex().fullWidth,size:20,children:(0,s.jsx)(e8,{user:{email:a.email}})})},{key:"hpc",label:"HPC Providers",children:(0,s.jsx)(aO,{})}].filter(e=>e),[a,t]),u=(0,i.useCallback)(e=>{(async()=>{await l.replace({pathname:"/dashboard",query:{page:"account",tab:e}})})()},[l]);return(0,s.jsxs)(n.Z,{className:"".concat(ex().noScroll," ").concat(eD().inDashboard),children:[(0,s.jsx)(N,{title:(0,s.jsx)(o.Z.Title,{level:2,style:{marginBottom:"0 !important"},children:"Account Settings"})}),(0,s.jsx)(n.Z.Content,{className:ex().noScroll,children:(0,s.jsx)(Z.Z,{className:"".concat(ex().noScroll," ").concat(eD().inDashboardTabs),type:"card",items:c,defaultActiveKey:null!=d?d:"personal",onChange:u})})]})},az=t(82826),aS=t(13464),aP=t(58824);let aN={add:"Unable to add user",existing:"This user already exists or its invite is pending"},aE=(e,a)=>{var t,s,r,i,n,l;let o=null===(t=a.owners)||void 0===t?void 0:t.find(a=>a.email===e.email),d=null===(s=a.pendingowners)||void 0===s?void 0:s.find(a=>a.email===e.email),c=null===(r=a.users)||void 0===r?void 0:r.find(a=>a.email===e.email),u=null===(i=a.pendingusers)||void 0===i?void 0:i.find(a=>a.email===e.email);return null!==(l=null!==(n=null!=o?o:d)&&void 0!==n?n:c)&&void 0!==l?l:u},aT=async(e,a,t,s)=>{let r=aE(t,e);if(r)throw(0,v.lt)(aN.existing),Error(aN.existing);try{await aS.Z.update(e,[{key:a,type:"array",method:"append",value:t.email.trim()}]);let r=ev.Z.deepCopy(e);r[a]=[...r[a],{email:t.email}],await s.mutateOneOrganization(r)}catch(e){throw(0,v.lt)(aN.add,e),e}};var aA=e=>{let{title:a,organization:t,dBkey:r,swr:n}=e,l=(0,i.useRef)(null),[o,d]=(0,i.useState)(!1),[c,u]=(0,i.useState)(!1);(0,i.useEffect)(()=>{l.current&&l.current.focus()});let m=(0,i.useCallback)(()=>d(!0),[]),p=(0,i.useCallback)(()=>d(!1),[]),h=(0,i.useCallback)(async e=>{u(!0);try{await aT(t,r,e,n),u(!1),d(!1)}catch(e){throw u(!1),e}},[t,r,n]);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(C.ZP,{visible:o,loading:c,title:a,onCancel:p,onOk:h,children:(0,s.jsx)(b.Z.Item,{name:"email",label:"Email",rules:[{required:!0,message:"Email is required"}],children:(0,s.jsx)(k.Z,{ref:l})})}),(0,s.jsx)(T.HS,{onAdd:m,children:a})]})};let aI={del:"Unable to delete user"},aU=async(e,a,t,s)=>{try{await aS.Z.update(a,[{key:t,type:"array",method:"remove",value:e.id}]);let r=ev.Z.deepCopy(a);r[t]=r[t].filter(a=>a.id!==e.id),await s.mutateOneOrganization(r)}catch(e){throw(0,v.lt)(aI.del,e),e}};var a_=e=>{let{disabled:a,user:t,organization:r,dBkey:n,swr:l}=e,[d,c]=(0,i.useState)(!1),u=(0,i.useCallback)(e=>e.firstname||e.lastname?e.firstname+" "+e.lastname:e.email,[]),m=(0,i.useCallback)(async()=>{c(!0);try{await aU(t,r,n,l)}finally{c(!1)}},[t,r,n,l]);return(0,s.jsx)(T.m1,{bordered:!0,disabled:a,title:"Delete organization",text:(0,s.jsxs)(s.Fragment,{children:["Are you sure you want to delete the user"," ",(0,s.jsx)(o.Z.Text,{strong:!0,children:u(t)}),"?"]}),loading:d,onDelete:m})},aq=e=>{let{organization:a,swr:t}=e,[r,n]=(0,i.useState)(),[l,o]=(0,i.useState)(),d=(0,i.useRef)(null),c=(0,i.useRef)(null),u=(0,i.useRef)(null),m=(0,i.useCallback)((e,a)=>ev.Z.userToAvatar(a),[]),p=(0,i.useCallback)(e=>(0,s.jsx)(q.C.Group,{maxCount:5,children:null==e?void 0:e.map(e=>ev.Z.workspaceToAvatar(e))}),[]),h=(0,i.useCallback)(e=>(0,s.jsx)(q.C.Group,{maxCount:5,children:null==e?void 0:e.map(e=>ev.Z.projectToAvatar(e))}),[]),g=(0,i.useCallback)(e=>(0,s.jsx)(q.C.Group,{maxCount:5,children:null==e?void 0:e.map(e=>ev.Z.usermodelToAvatar(e))}),[]),x=(0,i.useCallback)(e=>(0,s.jsx)(a_,{disabled:a.owners.length<2&&!e.pending,user:{id:e.id,email:e.email},organization:{id:a.id,owners:a.owners,pendingowners:a.pendingowners,users:a.users,pendingusers:a.pendingusers},dBkey:e.pending?"pendingowners":"owners",swr:{mutateOneOrganization:t.mutateOneOrganization}}),[a,t]),w=(0,i.useCallback)(e=>(0,s.jsx)(a_,{user:{id:e.id,email:e.email,firstname:e.firstname,lastname:e.lastname},organization:{id:a.id,owners:a.owners,pendingowners:a.pendingowners,users:a.users,pendingusers:a.pendingusers},dBkey:e.pending?"pendingusers":"users",swr:{mutateOneOrganization:t.mutateOneOrganization}}),[a,t]),y=(0,i.useMemo)(()=>[{key:"avatar",dataIndex:"avatar",align:"center",render:m},{key:"lastname",title:"Lastname",dataIndex:"lastname",align:"center"},{key:"firstname",title:"Firstname",dataIndex:"firstname",align:"center"},{key:"email",title:"Email",dataIndex:"email",align:"center"},{key:"workspaces",title:"Workspaces",dataIndex:"workspaces",align:"center",render:p},{key:"projects",title:"Projects",dataIndex:"projects",align:"center",render:h},{key:"usermodels",title:"User models",dataIndex:"usermodels",align:"center",render:g}],[m,p,h,g]),j=(0,i.useMemo)(()=>[...y,{key:"actions",title:"Actions",align:"center",fixed:"right",render:x}],[y,x]),v=(0,i.useMemo)(()=>[...y,{key:"actions",title:"Actions",align:"center",fixed:"right",render:w}],[y,w]),f=(0,i.useCallback)(()=>{let e=d.current;if(!e)return;let a=e.clientHeight-15,t=a/2-39-12-32-20-75,s=e.clientHeight,r=e.clientHeight;s>t?n({y:t}):n(void 0),r>t?o({y:t}):o(void 0)},[]);return(0,i.useEffect)(()=>(window.addEventListener("resize",f),()=>{window.removeEventListener("resize",f)}),[f]),(0,i.useEffect)(()=>{f()},[a,f]),(0,s.jsx)("div",{ref:d,style:{height:"calc(100vh - 228px)"},children:(0,s.jsxs)(_.Z,{direction:"vertical",className:ex().fullWidth,size:20,children:[(0,s.jsx)(H.Z,{title:"Administrators",size:"small",children:(0,s.jsxs)(_.Z,{direction:"vertical",className:ex().fullWidth,size:20,children:[(0,s.jsx)(aA,{title:"New administrator",organization:{id:a.id,owners:a.owners,pendingowners:a.pendingowners,pendingusers:a.pendingusers,users:a.users},dBkey:"owners",swr:{mutateOneOrganization:t.mutateOneOrganization}}),(0,s.jsx)(aP.Z,{loading:t.loadingOrganizations,pagination:!1,size:"small",columns:j,dataSource:[...a.owners.map(e=>({...e,key:e.id})),...a.pendingowners.map(e=>({...e,workspaces:[],projects:[],usermodels:[],pending:!0,key:e.id}))],scroll:{x:1200,y:null==r?void 0:r.y},ref:c})]})}),(0,s.jsx)(H.Z,{title:"Users",size:"small",children:(0,s.jsxs)(_.Z,{direction:"vertical",className:ex().fullWidth,size:20,children:[(0,s.jsx)(aA,{title:"New user",organization:{id:a.id,owners:a.owners,pendingowners:a.pendingowners,pendingusers:a.pendingusers,users:a.users},dBkey:"users",swr:{mutateOneOrganization:t.mutateOneOrganization}}),(0,s.jsx)(aP.Z,{loading:null==t?void 0:t.loadingOrganizations,pagination:!1,size:"small",columns:v,dataSource:[...a.users.map(e=>({...e,key:e.id})),...a.pendingusers.map(e=>({...e,workspaces:[],projects:[],usermodels:[],pending:!0,key:e.id}))],scroll:{x:1200,y:null==l?void 0:l.y},ref:u})]})})]})})},aD=t(59734),aR=t(83755);let aW=async(e,a)=>{let t=await (0,aR.R)("/api/group",{method:"POST",body:JSON.stringify({organization:e,group:a})});return t.json()},aF=async(e,a)=>{await (0,aR.R)("/api/group",{method:"PUT",body:JSON.stringify({group:e,data:a})})},aL=async e=>{await (0,aR.R)("/api/group",{method:"DELETE",body:JSON.stringify(e)})};var aG={useGroups:e=>{var a;let{data:t,error:s,mutate:r}=(0,aD.ZP)("/api/groups/"+e,aR._),n=null!==(a=null==t?void 0:t.groups)&&void 0!==a?a:[],l=(0,i.useCallback)(async e=>{let a=[...n,e];await r({groups:a})},[n,r]),o=(0,i.useCallback)(async e=>{let a=n.filter(a=>a.id!==e.id);await r({groups:a})},[n,r]),d=(0,i.useCallback)(async e=>{let a=n.map(a=>(a.id===e.id&&(a={...a,...e}),a));await r({groups:a})},[n,r]);return[n,{addOneGroup:l,delOneGroup:o,mutateOneGroup:d,errorGroups:s,loadingGroups:!t}]},add:aW,update:aF,del:aL};let aH={del:"Unable to delete group"},aM=async(e,a)=>{try{await aG.del({id:e.id}),await a.delOneGroup({id:e.id})}catch(e){throw(0,v.lt)(aH.del,e),e}};var aB=e=>{let{group:a,swr:t}=e,[r,n]=(0,i.useState)(!1),l=(0,i.useCallback)(async()=>{n(!0);try{await aM(a,t)}finally{n(!1)}},[a,t]);return(0,s.jsx)(T.m1,{bordered:!0,title:"Delete group",text:(0,s.jsxs)(s.Fragment,{children:["Are you sure you want to delete the group"," ",(0,s.jsx)(o.Z.Text,{strong:!0,children:a.name}),"?"]}),loading:r,onDelete:l})};let aJ={add:"Unable to add group",update:"Unable to update group"},aK=async(e,a,t)=>{try{let s=await aG.add({id:e.id},{name:a.name,users:a.users});await t.addOneGroup({...s,name:a.name,users:a.users}),await t.mutateOneOrganization({id:e.id,groups:[...e.groups,s]})}catch(e){throw(0,v.lt)(aJ.add,e),e}},aY=async(e,a,t,s)=>{try{var r;let i=[];if(a.name!==t.name&&i.push({key:"name",value:t.name}),(null===(r=a.users)||void 0===r?void 0:r.map(e=>e.id).toString())!==t.users.toString()&&i.push({key:"users",value:t.users}),!i.length)return;await aG.update({id:a.id},i),await s.mutateOneGroup({...a,...t});let n=e.groups.findIndex(e=>e.id===a.id);await s.mutateOneOrganization({id:e.id,groups:[...e.groups.slice(0,n),a,...e.groups.slice(n+1)]})}catch(e){throw(0,v.lt)(aJ.update,e),e}};var aV=e=>{var a;let{userOptions:t,organization:r,group:n,swr:l}=e,o=(0,i.useRef)(null),[d,c]=(0,i.useState)(!1),[u,m]=(0,i.useState)(!1);(0,i.useEffect)(()=>{o.current&&o.current.focus()});let p=(0,i.useCallback)(()=>c(!0),[]),h=(0,i.useCallback)(()=>c(!1),[]),g=(0,i.useCallback)(async e=>{m(!0);try{n?await aY(r,n,e,{mutateOneOrganization:l.mutateOneOrganization,mutateOneGroup:l.mutateOneGroup}):await aK(r,e,{mutateOneOrganization:l.mutateOneOrganization,addOneGroup:l.addOneGroup}),m(!1),c(!1)}catch(e){throw m(!1),e}},[r,n,l]);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(C.ZP,{title:n?"Edit group":"New group",visible:d,initialValues:n&&{name:n.name,users:null===(a=n.users)||void 0===a?void 0:a.map(e=>e.id)},onCancel:h,onOk:g,loading:u,children:[(0,s.jsx)(b.Z.Item,{name:"name",label:"Name",rules:[{required:!0,message:"Name is requried"}],children:(0,s.jsx)(k.Z,{ref:o})}),(0,s.jsx)(b.Z.Item,{name:"users",label:"Users",rules:[{required:!0,message:"Users selection is required"}],children:(0,s.jsx)(ar.Z,{mode:"multiple",placeholder:"Select users",options:t})})]}),n?(0,s.jsx)(T.w6,{bordered:!0,onEdit:p,children:"Edit"}):(0,s.jsx)(T.HS,{onAdd:p,children:"New group"})]})};let aX={groups:"Error while loading groups"};var aQ=e=>{let{organization:a,swr:t}=e,[r,n]=(0,i.useState)([]),[l,o]=(0,i.useState)(null),d=(0,i.useRef)(null),[c,{addOneGroup:u,mutateOneGroup:m,delOneGroup:p,errorGroups:h,loadingGroups:g}]=aG.useGroups(a.id);(0,i.useEffect)(()=>{let e=a.owners,t=null==a?void 0:a.users,s=[...e,...t],r=s.map(e=>({label:e.firstname||e.lastname?e.firstname+" "+e.lastname:e.email,value:e.id}));n(r)},[a]),(0,i.useEffect)(()=>{h&&(0,v.lt)(aX.groups,h)},[h]);let x=(0,i.useCallback)(e=>(0,s.jsx)(q.C.Group,{maxCount:5,children:e.map(e=>ev.Z.userToAvatar(e))}),[]),w=(0,i.useCallback)(e=>(0,s.jsx)(q.C.Group,{maxCount:5,children:e.map(e=>ev.Z.workspaceToAvatar(e))}),[]),y=(0,i.useCallback)(e=>(0,s.jsx)(q.C.Group,{maxCount:5,children:e.map(e=>ev.Z.projectToAvatar(e))}),[]),j=(0,i.useCallback)(e=>(0,s.jsx)(q.C.Group,{maxCount:5,children:e.map(e=>ev.Z.usermodelToAvatar(e))}),[]),f=(0,i.useCallback)((e,i)=>(0,s.jsxs)(_.Z,{children:[(0,s.jsx)(aV,{userOptions:r,organization:{id:a.id,groups:a.groups},group:{id:i.id,name:i.name,users:i.users},swr:{mutateOneOrganization:t.mutateOneOrganization,mutateOneGroup:m}}),(0,s.jsx)(aB,{group:{id:i.id,name:i.name},swr:{delOneGroup:p}})]}),[a,t,r,m,p]),b=(0,i.useMemo)(()=>[{title:"Group name",dataIndex:"name",key:"name",align:"center"},{title:"Users",dataIndex:"users",key:"users",align:"center",render:x},{title:"Workspaces",dataIndex:"workspaces",key:"workspaces",align:"center",render:w},{title:"Projects",dataIndex:"projects",key:"projects",align:"center",render:y},{title:"User models",dataIndex:"usermodels",key:"usermodels",align:"center",render:j},{title:"Actions",key:"actions",align:"center",fixed:"right",render:f}],[x,w,y,j,f]),k=(0,i.useCallback)(()=>{let e=d.current;e&&(e.clientHeight>window.innerHeight-e.offsetTop-59?o({y:window.innerHeight-e.offsetTop-59}):o(null))},[]);return(0,i.useEffect)(()=>(window.addEventListener("resize",k),()=>{window.removeEventListener("resize",k)}),[k]),(0,i.useEffect)(()=>{k()},[c,k]),(0,s.jsxs)(_.Z,{direction:"vertical",className:ex().fullWidth,size:20,children:[(0,s.jsx)(aV,{userOptions:r,organization:{id:a.id,groups:a.groups},swr:{mutateOneOrganization:t.mutateOneOrganization,addOneGroup:u}}),(0,s.jsx)(aP.Z,{loading:g,pagination:!1,size:"small",columns:b,dataSource:c.map(e=>({key:e.id,...e})),scroll:{x:1200,y:null==l?void 0:l.y},ref:d})]})};let a$={name:"Unable to update organization's name"},a0=async(e,a,t)=>{try{await aS.Z.update(e,[{key:"name",value:a}]),await t.mutateOneOrganization({...e,name:a})}catch(e){(0,v.lt)(a$.name,e)}};var a1=e=>{let{organization:a,swr:t,onClose:r}=e,n=(0,i.useCallback)(e=>{(async()=>{await a0(a,e,{mutateOneOrganization:t.mutateOneOrganization})})()},[a,t]);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:ex().displayFlex,children:[(0,s.jsx)(K.ZP,{style:{marginRight:"20px"},icon:(0,s.jsx)(az.Z,{}),onClick:r}),(0,s.jsx)(o.Z.Title,{level:3,editable:{onChange:n},children:a.name})]}),(0,s.jsx)(Z.Z,{items:[{key:"users",label:"Users",children:(0,s.jsx)(aq,{organization:{id:a.id,owners:a.owners,pendingowners:a.pendingowners,users:a.users,pendingusers:a.pendingusers},swr:{mutateOneOrganization:t.mutateOneOrganization,loadingOrganizations:t.loadingOrganizations}})},{key:"groups",label:"Groups",children:(0,s.jsx)(aQ,{organization:{id:a.id,owners:a.owners,users:a.users,groups:a.groups},swr:{mutateOneOrganization:t.mutateOneOrganization}})}]})]})};let a5={add:"Unable to add organization"},a2=async(e,a)=>{try{let t=await aS.Z.add({name:e.name});t.name=e.name,await a.addOneOrganization(t)}catch(e){throw(0,v.lt)(a5.add,e),e}};var a3=e=>{let{swr:a}=e,t=(0,i.useRef)(null),[r,n]=(0,i.useState)(!1),[l,o]=(0,i.useState)(!1);(0,i.useEffect)(()=>{t.current&&t.current.focus()});let d=(0,i.useCallback)(()=>n(!0),[]),c=(0,i.useCallback)(()=>n(!1),[]),u=(0,i.useCallback)(async e=>{o(!0);try{await a2(e,a),o(!1),n(!1)}catch(e){throw o(!1),e}},[a]);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(C.ZP,{title:"New organization",visible:r,onCancel:c,onOk:u,loading:l,children:(0,s.jsx)(b.Z.Item,{name:"name",label:"Name",rules:[{required:!0,message:"Name is required"}],children:(0,s.jsx)(k.Z,{ref:t})})}),(0,s.jsx)(T.HS,{onAdd:d,children:"New organization"})]})},a8=t(75768),a4=t(8751),a9=t(18429);let a6={del:"Unable to delete organization"},a7=async(e,a)=>{try{await aS.Z.del({id:e.id}),await a.delOneOrganization({id:e.id})}catch(e){throw(0,v.lt)(a6.del,e),e}};var te=e=>{let{organization:a,swr:t}=e,[r,n]=(0,i.useState)(!1),l=(0,i.useCallback)(async()=>{n(!0);try{await a7(a,t)}finally{n(!1)}},[a,t]);return(0,s.jsx)(T.m1,{bordered:!0,title:"Delete organization",text:(0,s.jsxs)(s.Fragment,{children:["Are you sure you want to delete the organization"," ",(0,s.jsx)(o.Z.Text,{strong:!0,children:a.name}),"?"]}),onDelete:l,loading:r})};let ta={quit:"Unable to quit organization",accept:"Unable to accept invitation",decline:"Unable to decline invitation"},tt=async(e,a,t)=>{try{await aS.Z.quit({id:e.id});let s=ev.Z.deepCopy(e),r=s.users.findIndex(e=>e.id===a.id);s.users.splice(r,1),await t.mutateOneOrganization(s)}catch(e){(0,v.lt)(ta.quit,e)}},ts=async(e,a,t)=>{try{await aS.Z.accept(e);let s=ev.Z.deepCopy(e),r=s.pendingowners.findIndex(e=>e.id===a.id),i=s.pendingowners[r];if(-1!==r)s.pendingowners.splice(r,1),s.owners.push({...i,workspaces:[],projects:[],usermodels:[]});else{let e=s.pendingusers.findIndex(e=>e.id===a.id),t=s.pendingusers[e];s.pendingusers.splice(e,1),s.users.push({...t,workspaces:[],projects:[],usermodels:[]})}await t.mutateOneOrganization(s)}catch(e){(0,v.lt)(ta.accept,e)}},tr=async(e,a,t)=>{try{var s,r;await aS.Z.decline({id:e.id});let i=ev.Z.deepCopy(e),n=null===(s=i.pendingowners)||void 0===s?void 0:s.findIndex(e=>e.id===a.id);if(-1!==n)i.pendingowners.splice(n,1);else{let e=null===(r=i.pendingusers)||void 0===r?void 0:r.findIndex(e=>e.id===a.id);i.pendingusers.splice(e,1)}await t.mutateOneOrganization(i)}catch(e){(0,v.lt)(ta.decline,e)}},ti=e=>{let{organization:a,swr:t,setOrganization:r}=e,n=(0,i.useCallback)(()=>r(a),[a,r]);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(K.ZP,{icon:(0,s.jsx)(m.Z,{}),onClick:n,children:"Manage"}),(0,s.jsx)(te,{organization:{id:a.id,name:a.name},swr:{delOneOrganization:t.delOneOrganization}})]})},tn=e=>{let{user:a,organization:t,swr:r}=e,n=(0,i.useCallback)(()=>{(async()=>{await tt({id:t.id,users:t.users},{id:a.id},{mutateOneOrganization:r.mutateOneOrganization})})()},[a,t,r]);return(0,s.jsx)(K.ZP,{danger:!0,icon:(0,s.jsx)(a8.Z,{}),onClick:n,children:"Quit"})},tl=e=>{let{user:a,organization:t,swr:r}=e,n=(0,i.useCallback)(()=>{(async()=>{await ts({id:t.id,owners:t.owners,pendingowners:t.pendingowners,users:t.users,pendingusers:t.pendingusers},{id:a.id},{mutateOneOrganization:r.mutateOneOrganization})})()},[a,t,r]);return(0,s.jsx)(K.ZP,{type:"primary",icon:(0,s.jsx)(a4.Z,{}),onClick:n,children:"Accept invitation"})},to=e=>{let{user:a,organization:t,swr:r}=e,n=(0,i.useCallback)(()=>{(async()=>{await tr({id:t.id,pendingowners:t.pendingowners,pendingusers:t.pendingusers},{id:a.id},{mutateOneOrganization:r.mutateOneOrganization})})()},[a,t,r]);return(0,s.jsx)(K.ZP,{danger:!0,icon:(0,s.jsx)(a9.Z,{}),onClick:n,children:"Decline"})};var td=e=>{var a;let{user:t,organizations:r,swr:n,setOrganization:l}=e,[o,d]=(0,i.useState)(null),c=(0,i.useRef)(null),u=(0,i.useCallback)(e=>(0,s.jsx)(q.C.Group,{maxCount:5,children:null==e?void 0:e.map(e=>ev.Z.userToAvatar(e))}),[]),m=(0,i.useCallback)(e=>(0,s.jsx)(q.C.Group,{maxCount:5,children:null==e?void 0:e.map(e=>ev.Z.userToAvatar(e))}),[]),p=(0,i.useCallback)(e=>(0,s.jsx)(q.C.Group,{maxCount:5,children:null==e?void 0:e.map(e=>ev.Z.groupToAvatar(e))}),[]),h=(0,i.useCallback)(e=>e.owners.find(e=>e.id===t.id)?(0,s.jsx)(_.Z,{wrap:!0,children:(0,s.jsx)(ti,{organization:e,swr:{delOneOrganization:n.delOneOrganization},setOrganization:l})}):e.users.find(e=>e.id===t.id)?(0,s.jsx)(_.Z,{wrap:!0,children:(0,s.jsx)(tn,{user:t,organization:e,swr:{mutateOneOrganization:n.mutateOneOrganization}})}):e.pendingowners.find(e=>e.id===t.id)||e.pendingusers.find(e=>e.id===t.id)?(0,s.jsxs)(_.Z,{wrap:!0,children:[(0,s.jsx)(tl,{user:t,organization:e,swr:{mutateOneOrganization:n.mutateOneOrganization}}),(0,s.jsx)(to,{user:t,organization:e,swr:{mutateOneOrganization:n.mutateOneOrganization}})]}):null,[t,n,l]),g=(0,i.useMemo)(()=>[{title:"Name",dataIndex:"name",key:"name",sorter:(e,a)=>{var t,s;let r=null!==(t=e.name)&&void 0!==t?t:"",i=null!==(s=a.name)&&void 0!==s?s:"";return r.localeCompare(i)}},{title:"Administrators",dataIndex:"owners",key:"owners",render:u},{title:"Users",dataIndex:"users",key:"users",render:m},{title:"Groups",dataIndex:"groups",key:"groups",render:p},{title:"Actions",key:"actions",render:h}],[u,m,p,h]),x=(0,i.useCallback)(()=>{let e=c.current;e&&(e.clientHeight>window.innerHeight-e.offsetTop-59?d({y:window.innerHeight-e.offsetTop-59}):d(null))},[]);return(0,i.useEffect)(()=>(window.addEventListener("resize",x),()=>{window.removeEventListener("resize",x)}),[x]),(0,i.useEffect)(()=>{x()},[r,x,null===(a=c.current)||void 0===a?void 0:a.offsetTop]),(0,s.jsx)(aP.Z,{loading:n.loadingOrganizations,pagination:!1,size:"small",columns:g,dataSource:null==r?void 0:r.map(e=>({key:e.id,id:e.id,name:e.name,owners:e.owners,pendingowners:e.pendingowners,users:e.users,pendingusers:e.pendingusers,groups:e.groups})),ref:c,scroll:{y:null==o?void 0:o.y}})},tc=e=>{let{user:a,organizations:t,swr:l}=e,[d,c]=(0,i.useState)(),u=(0,r.useRouter)(),{organizationId:m}=u.query;(0,i.useEffect)(()=>{if(m){let e=t.find(e=>e.id===m);c(e)}},[m,t]),(0,i.useEffect)(()=>{if(d){let e=t.find(e=>e.id===d.id);JSON.stringify(e)!==JSON.stringify(d)&&c(e)}},[t,d]);let p=(0,i.useCallback)(()=>{(async()=>{await u.push({pathname:"dashboard",query:{page:"organizations"}}),c(null)})()},[u]),h=(0,i.useCallback)(e=>{(async()=>{await u.push({pathname:"dashboard",query:{page:"organizations",organizationId:e.id}}),c(e)})()},[u]);return(0,s.jsxs)(n.Z,{className:eD().inDashboard,children:[(0,s.jsx)(N,{title:(0,s.jsx)(o.Z.Title,{level:2,style:{marginBottom:"0 !important"},children:"Organizations"})}),(0,s.jsx)(n.Z.Content,{className:ex().noScroll,children:d?(0,s.jsx)(a1,{organization:{id:d.id,name:d.name,owners:d.owners,pendingowners:d.pendingowners,users:d.users,pendingusers:d.pendingusers,groups:d.groups},swr:{mutateOneOrganization:l.mutateOneOrganization,loadingOrganizations:l.loadingOrganizations},onClose:p}):(0,s.jsxs)(_.Z,{direction:"vertical",className:ex().fullWidth,size:20,children:[(0,s.jsx)(a3,{swr:{addOneOrganization:l.addOneOrganization}}),(0,s.jsx)(td,{user:{id:a.id},organizations:t,swr:{mutateOneOrganization:l.mutateOneOrganization,delOneOrganization:l.delOneOrganization,loadingOrganizations:l.loadingOrganizations},setOrganization:h})]})})]})},tu=t(53575),tm=t(55241),tp=t(63606),th=t(32808),tg=t(69081);let tx={add:"Unable to add user"},tw=async(e,a)=>{try{let t=await eM.Z.add({email:e.email,password:e.password});if(t.alreadyExists)throw Error("User already exists");await eM.Z.updateById(t.id,[{key:"firstname",value:e.firstname},{key:"lastname",value:e.lastname},{key:"authorizedplugins",value:e.authorizedplugins},{key:"superuser",value:!!e.superuser}]);let s={...t,email:e.email,firstname:e.firstname,lastname:e.firstname,superuser:e.superuser};await a.addOneUser(s)}catch(e){throw(0,v.lt)(tx.add,e),e}};var ty=e=>{let{plugins:a,swr:t}=e,r=(0,i.useRef)(null),[n,l]=(0,i.useState)(!1),[o,d]=(0,i.useState)(!1),[c]=tg.Z.useSystem();(0,i.useEffect)(()=>{r.current&&r.current.focus()});let u=(0,i.useCallback)(()=>l(!0),[]),m=(0,i.useCallback)(()=>l(!0),[]),p=(0,i.useCallback)(async e=>{d(!0);try{await tw(e,t),d(!1),l(!1)}catch(e){throw d(!1),e}},[t]);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(C.ZP,{title:"New user",visible:n,initialValues:c.defaultplugins&&{authorizedplugins:c.defaultplugins},onCancel:m,onOk:p,loading:o,children:[(0,s.jsx)(b.Z.Item,{name:"firstname",label:"First name",children:(0,s.jsx)(k.Z,{ref:r})}),(0,s.jsx)(b.Z.Item,{name:"lastname",label:"Last name",children:(0,s.jsx)(k.Z,{})}),(0,s.jsx)(b.Z.Item,{name:"email",label:"Email",rules:[{required:!0,message:"Email is required"}],children:(0,s.jsx)(k.Z,{})}),(0,s.jsx)(e5.o,{name:"password"}),(0,s.jsx)(b.Z.Item,{name:"authorizedplugins",label:"Plugins",children:(0,s.jsx)(ar.Z,{mode:"multiple",options:a.map(e=>({label:e.name,value:e.key}))})}),(0,s.jsx)(b.Z.Item,{name:"superuser",label:"Administrator",valuePropName:"checked",children:(0,s.jsx)(th.Z,{})})]}),(0,s.jsx)(T.HS,{onAdd:u,children:"New user"})]})};let tj={update:"Unable to update user"},tv=async(e,a,t)=>{try{let s=Object.keys(a).map(t=>{let s=a[t];if(void 0!==s&&"******"!==s&&s!==e[t])return{key:t,value:s,type:"password"===t&&"crypt"}}).filter(e=>e);if(!s.length)return;await eM.Z.updateById(e.id,s),a.password="******";let r={...e,...a};await t.mutateOneUser(r)}catch(e){throw(0,v.lt)(tj.update,e),e}};var tf=e=>{let{plugins:a,user:t,swr:r}=e,n=(0,i.useRef)(null),[l,o]=(0,i.useState)(!1),[d,c]=(0,i.useState)(!1);(0,i.useEffect)(()=>{n.current&&n.current.focus()});let u=(0,i.useCallback)(()=>o(!0),[]),m=(0,i.useCallback)(()=>o(!1),[]),p=(0,i.useCallback)(async e=>{c(!0);try{await tv(t,e,r),c(!1),o(!1)}catch(e){throw c(!1),e}},[t,r]);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(C.ZP,{title:"Edit user",visible:l,initialValues:{...t,password:"******",authorizedplugins:t.authorizedplugins},onCancel:m,onOk:p,loading:d,children:[(0,s.jsx)(b.Z.Item,{name:"firstname",label:"First name",children:(0,s.jsx)(k.Z,{ref:n})}),(0,s.jsx)(b.Z.Item,{name:"lastname",label:"Last name",children:(0,s.jsx)(k.Z,{})}),(0,s.jsx)(b.Z.Item,{name:"email",label:"Email",rules:[{required:!0,message:"Email is required"}],children:(0,s.jsx)(k.Z,{})}),(0,s.jsx)(e5.o,{name:"password",edit:!0}),(0,s.jsx)(b.Z.Item,{name:"authorizedplugins",label:"Plugins",children:(0,s.jsx)(ar.Z,{mode:"multiple",options:a.map(e=>({label:e.name,value:e.key}))})}),(0,s.jsx)(b.Z.Item,{name:"superuser",label:"Administrator",valuePropName:"checked",children:(0,s.jsx)(th.Z,{})})]}),(0,s.jsx)(T.w6,{bordered:!0,onEdit:u,children:"Edit"})]})};let tb={del:"Unable to delete user"},tk=async(e,a)=>{try{await eM.Z.delById(e.id),await a.delOneUser({id:e.id})}catch(e){throw(0,v.lt)(tb.del,e),e}};var tZ=e=>{let{user:a,swr:t}=e,[r,n]=(0,i.useState)(!1),l=(0,i.useCallback)(async()=>{n(!0);try{await tk(a,t)}finally{n(!1)}},[a,t]);return(0,s.jsx)(T.m1,{loading:r,bordered:!0,text:(0,s.jsxs)(s.Fragment,{children:["Are you sure you want to delete the user"," ",(0,s.jsx)(o.Z.Text,{strong:!0,children:a.email}),"?"]}),title:"Delete user",onDelete:l})};let tO={plugins:"Unable to load plugins"};var tC=e=>{var a,t;let{users:r,swr:n}=e,l=(0,i.useRef)(null),[o,d]=(0,i.useState)(),[c,u]=(0,i.useState)(),m=(0,i.useCallback)(e=>{e.sort((e,a)=>e.localeCompare(a));let a=e.map(e=>{let a=null==o?void 0:o.find(a=>a.key===e);if(a)return(0,s.jsx)(tu.Z.Ribbon,{text:a.category,style:{marginTop:"-15px"},children:(0,s.jsx)(H.Z,{size:"small",children:a.name})},e)}),t=(0,s.jsx)(_.Z,{direction:"vertical",children:a});return(0,s.jsx)(tm.Z,{content:t,children:(0,s.jsxs)(K.ZP,{children:[a.length," plugins"]})})},[o]),p=(0,i.useCallback)(e=>e?(0,s.jsx)(tp.Z,{className:ex().textGreen}):null,[]),h=(0,i.useCallback)((e,t)=>(0,s.jsxs)(_.Z,{children:[(0,s.jsx)(tf,{plugins:null!==(a=null==o?void 0:o.map(e=>({key:e.key,name:e.name})))&&void 0!==a?a:[],user:{id:t.id,firstname:t.firstname,lastname:t.lastname,email:t.email,authorizedplugins:t.authorizedplugins,superuser:t.superuser},swr:{mutateOneUser:n.mutateOneUser}}),(0,s.jsx)(tZ,{user:{id:t.id,email:t.email},swr:{delOneUser:n.delOneUser}})]}),[o,n]),g=(0,i.useMemo)(()=>[{title:"First name",dataIndex:"firstname",key:"firstname",sorter:(e,a)=>{var t,s;let r=null!==(t=e.firstname)&&void 0!==t?t:"",i=null!==(s=a.firstname)&&void 0!==s?s:"";return r.localeCompare(i)}},{title:"Last name",dataIndex:"lastname",key:"lastname",sorter:(e,a)=>{var t,s;let r=null!==(t=e.lastname)&&void 0!==t?t:"",i=null!==(s=a.lastname)&&void 0!==s?s:"";return r.localeCompare(i)}},{title:"Email",dataIndex:"email",key:"email",sorter:(e,a)=>{let t=e.email,s=a.email;return t.localeCompare(s)}},{title:"Password",key:"password",render:()=>"******"},{title:"Plugins",dataIndex:"authorizedplugins",key:"authorizedplugins",render:m},{title:"Administrator",dataIndex:"superuser",key:"superuser",align:"center",render:p},{title:"Actions",key:"actions",render:h}],[m,p,h]),x=(0,i.useCallback)(()=>{let e=l.current;e&&(e.clientHeight>window.innerHeight-e.offsetTop-59?u({y:window.innerHeight-e.offsetTop-59}):u(void 0))},[]);return(0,j.Z)(()=>(window.addEventListener("resize",x),()=>{window.removeEventListener("resize",x)}),void 0,[x]),(0,j.Z)(()=>{x()},[r],[x]),(0,i.useEffect)(()=>{(async()=>{try{let e=await at.Z.completeList();d(e)}catch(e){(0,v.lt)(tO.plugins,e)}})()},[]),(0,s.jsxs)(_.Z,{direction:"vertical",className:"".concat(ex().fullWidth," ").concat(ex().fullHeight),size:20,children:[(0,s.jsx)(ty,{plugins:null!==(t=null==o?void 0:o.map(e=>({key:e.key,name:e.name})))&&void 0!==t?t:[],swr:{addOneUser:n.addOneUser}}),(0,s.jsx)(aP.Z,{loading:!o,pagination:!1,size:"small",columns:g,dataSource:r.map(e=>({...e,key:e.id})),ref:l,scroll:{y:null==c?void 0:c.y}})]})},tz=t(12251),tS=t(59420);let tP={system:"Error while loading system",update:"Unable to update system"},tN=async(e,a)=>{try{await tg.Z.update([{key:"allowsignup",value:!e.allowsignup}]),await a({allowsignup:!e.allowsignup}),(0,v.Ur)("Changes saved")}catch(e){(0,v.lt)(tP.update,e)}},tE=async(e,a)=>{try{await tg.Z.update([{key:"password",value:e}]),await a({password:e}),(0,v.Ur)("Changes saved")}catch(e){(0,v.lt)(tP.update,e)}};var tT=()=>{let[e]=b.Z.useForm(),[a,{mutateSystem:t,errorSystem:r,loadingSystem:n}]=tg.Z.useSystem();(0,i.useEffect)(()=>{r&&(0,v.lt)(tP.system,r)},[r]),(0,i.useEffect)(()=>{var t;n||e.setFieldsValue(null!==(t=null==a?void 0:a.password)&&void 0!==t?t:{min:tS.yL,max:tS.nq,requireLetter:tS.JT,requireNumber:tS.tE,requireSymbol:tS.ah})},[n,e,null==a?void 0:a.password]);let l=(0,i.useCallback)(()=>{(async()=>{await tN(a,t)})()},[a,t]),o=(0,i.useCallback)(e=>{(async()=>{await tE(e,t)})()},[t]);return n?(0,s.jsx)(f.Z.Simple,{}):(0,s.jsxs)(_.Z,{direction:"vertical",className:ex().fullWidth,size:20,children:[(0,s.jsx)(H.Z,{title:"Signup",children:(0,s.jsx)(th.Z,{checked:null==a?void 0:a.allowsignup,onChange:l,children:"Allow signup"})}),(0,s.jsx)(H.Z,{title:"Password",children:(0,s.jsx)(b.Z,{form:e,name:"form",onFinish:o,style:{display:"flex",justifyContent:"space-between"},children:(0,s.jsxs)("div",{className:"".concat(ex().displayFlex," ").concat(ex().fullWidth),style:{justifyContent:"space-between"},children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(b.Z.Item,{label:"Minimum number of characters",name:"min",rules:[{required:!0,message:"Minimum number of characters is required"}],children:(0,s.jsx)(tz.Z,{min:0,max:64})}),(0,s.jsx)(b.Z.Item,{label:"Maximum number of characters",name:"max",rules:[{required:!0,message:"Maximum number of characters is required"}],children:(0,s.jsx)(tz.Z,{min:0,max:64})})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(b.Z.Item,{valuePropName:"checked",name:"requireLetter",children:(0,s.jsx)(th.Z,{children:"Require letter"})}),(0,s.jsx)(b.Z.Item,{valuePropName:"checked",name:"requireNumber",children:(0,s.jsx)(th.Z,{children:"Require number"})}),(0,s.jsx)(b.Z.Item,{valuePropName:"checked",name:"requireSymbol",children:(0,s.jsx)(th.Z,{children:"Require symbol"})})]}),(0,s.jsx)("div",{style:{marginTop:"auto"},children:(0,s.jsx)(b.Z.Item,{children:(0,s.jsx)(K.ZP,{type:"primary",icon:(0,s.jsx)(tp.Z,{}),htmlType:"submit",children:"Save changes"})})})]})})})]})};let tA={plugins:"Unable to get plugins",update:"Unable to update system"},tI=async(e,a,t,s)=>{try{var r;await tg.Z.update([{key:"defaultplugins",type:"array",method:t?"append":"remove",value:a.key}]);let i=ev.Z.deepCopy(null!==(r=null==e?void 0:e.defaultplugins)&&void 0!==r?r:[]),n=i.indexOf(a.key);t&&-1===n&&i.push(a.key),t||-1===n||i.splice(n,1),await s.mutateSystem({defaultplugins:i})}catch(e){(0,v.lt)(tA.update,e)}},tU=e=>{let{plugin:a,system:t,swr:r}=e,[n,l]=(0,i.useState)();(0,i.useEffect)(()=>{if(null==t?void 0:t.defaultplugins){let e=t.defaultplugins.includes(a.key);l(e)}},[a,t]);let o=(0,i.useCallback)(e=>{(async()=>{await tI(t,a,e.target.checked,r)})()},[a,t,r]);return(0,s.jsx)(th.Z,{checked:n,onChange:o})};var t_=()=>{let e=(0,i.useRef)(null),[a,t]=(0,i.useState)(),[r,n]=(0,i.useState)(),[l,{mutateSystem:o,loadingSystem:d}]=tg.Z.useSystem();(0,i.useEffect)(()=>{(async()=>{try{let e=await at.Z.completeList();t(e)}catch(e){(0,v.lt)(tA.plugins,e)}})()},[]);let c=(0,i.useCallback)(e=>(0,s.jsx)(tU,{system:l,plugin:e,swr:{mutateSystem:o}}),[l,o]),u=(0,i.useMemo)(()=>[{title:"Category",dataIndex:"category",key:"category"},{title:"Name",dataIndex:"name",key:"name"},{title:"Default enabled",key:"enable",render:c}],[c]),m=(0,i.useCallback)(()=>{let a=e.current;a&&(a.clientHeight>window.innerHeight-a.offsetTop-59?n({y:window.innerHeight-a.offsetTop-59}):n(null))},[]);return(0,i.useEffect)(()=>(window.addEventListener("resize",m),()=>{window.removeEventListener("resize",m)}),[m]),(0,i.useEffect)(()=>{m()},[a,m]),(0,s.jsx)(aP.Z,{loading:!a||d,pagination:!1,size:"small",columns:u,dataSource:a,ref:e,scroll:{y:null==r?void 0:r.y}})};let tq={users:{label:"Users",key:"users"},registration:{label:"Registration",key:"registration"},plugins:{label:"Plugins",key:"plugins"}},tD={users:"Error while loading users"};var tR=()=>{let e=(0,r.useRouter)(),{tab:a}=e.query,[t,{addOneUser:l,mutateOneUser:d,delOneUser:c,errorUsers:u}]=eM.Z.useUsers();(0,i.useEffect)(()=>{u&&(0,v.lt)(tD.users,u)},[u]);let m=(0,i.useCallback)(a=>{(async()=>{await e.replace({pathname:"/dashboard",query:{page:"administration",tab:a}})})()},[e]);return(0,s.jsxs)(n.Z,{className:eD().inDashboard,children:[(0,s.jsx)(N,{title:(0,s.jsx)(o.Z.Title,{level:2,style:{marginBottom:"0 !important"},children:"Administration"})}),(0,s.jsx)(n.Z.Content,{children:(0,s.jsx)(Z.Z,{className:eD().inDashboardTabs,type:"card",items:[{key:tq.users.key,label:tq.users.label,children:(0,s.jsx)(tC,{users:t,swr:{addOneUser:l,mutateOneUser:d,delOneUser:c}})},{key:tq.registration.key,label:tq.registration.label,children:(0,s.jsx)(tT,{})},{key:tq.plugins.key,label:tq.plugins.label,children:(0,s.jsx)(t_,{})}],defaultActiveKey:null!=a?a:"default",onChange:m})})]})},tW=t(41664),tF=t.n(tW),tL=()=>(0,s.jsxs)(n.Z,{className:eD().inDashboard,children:[(0,s.jsx)(N,{title:(0,s.jsx)(o.Z.Title,{level:2,style:{marginBottom:"0 !important"},children:"Help"})}),(0,s.jsx)(n.Z.Content,{className:ex().scroll,children:(0,s.jsxs)(_.Z,{direction:"vertical",className:ex().fullWidth,size:20,children:[(0,s.jsxs)(o.Z,{children:[(0,s.jsx)(o.Z.Title,{level:3,children:"Documentation"}),(0,s.jsxs)(o.Z.Text,{children:["Full interface"," ",(0,s.jsx)(tF(),{href:"/doc",target:"_blank",children:"Documentation"})]})]}),(0,s.jsxs)(o.Z,{children:[(0,s.jsx)(o.Z.Title,{level:3,children:"Bug report"}),(0,s.jsxs)(o.Z.Text,{children:[(0,s.jsx)(tF(),{href:"https://github.com/Airthium/tanatloc/issues/new/choose",target:"_blank",children:"Open an issue"})," ","on Github"]})]}),(0,s.jsxs)(o.Z,{children:[(0,s.jsx)(o.Z.Title,{level:3,children:"Feature request"}),(0,s.jsxs)(o.Z.Text,{children:[(0,s.jsx)(tF(),{href:"https://github.com/Airthium/tanatloc/issues/new/choose",target:"_blank",children:"Open an issue"})," ","on Github"]})]})]})})]});let tG=async()=>{if(!w()())return{needed:!1};let e=await fetch("https://api.github.com/repos/Airthium/tanatloc-electron/releases/latest",{method:"GET"}),a=await e.json(),t=y.i8,s=!a.tag_name.includes("alpha")&&!a.tag_name.includes("beta")&&t!==a.tag_name&&"v"+t!==a.tag_name;return{needed:s,res:a}};var tH={needUpdate:tG},tM=()=>{let[e,a]=(0,i.useState)(),[t,r]=(0,i.useState)(!1);(0,i.useEffect)(()=>{(async()=>{try{let e=await tH.needUpdate();e.needed&&a(e)}catch(e){console.error(e)}})()},[]),(0,i.useEffect)(()=>{(null==e?void 0:e.needed)&&r(!0)},[e]);let n=(0,i.useCallback)(()=>{r(!1)},[]),l=(0,i.useCallback)(async()=>{window.open("https://github.com/Airthium/tanatloc-electron/releases/tag/"+(null==e?void 0:e.res.tag_name),"_blank"),r(!1)},[e]);return(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(C.ZP,{visible:t,title:"Update",okButtonText:"Update",onCancel:n,onOk:l,children:(0,s.jsxs)(_.Z,{direction:"vertical",children:[(0,s.jsx)(o.Z.Text,{children:"A new release is available"}),(0,s.jsxs)(o.Z.Text,{children:["Do you want to update to version"," ",(0,s.jsx)(o.Z.Text,{code:!0,children:null==e?void 0:e.res.tag_name}),"?"]})]})})})},tB=t(52228);let tJ={user:"Error while loading user",organizations:"Error while loading organizations",workspaces:"Error while loading workspaces",logout:"Unable to logout"},tK={workspaces:{label:"Workspaces",key:"workspaces"},account:{label:"Account Settings",key:"account"},organizations:{label:"Organizations",key:"organizations"},administration:{label:"Administration",key:"administration"},editor:{label:"Model Editor",key:"editor"},help:{label:"I Need Help",key:"help"},logout:{label:"Logout",key:"logout"}};var tY=()=>{let[e,a]=(0,i.useState)(),[t,{mutateUser:x,clearUser:b,errorUser:k,loadingUser:Z}]=eM.Z.useUser(),[O,{addOneOrganization:C,delOneOrganization:z,mutateOneOrganization:S,errorOrganizations:P,loadingOrganizations:N}]=aS.Z.useOrganizations(),[T,{addOneWorkspace:A,delOneWorkspace:I,mutateOneWorkspace:U,errorWorkspaces:_,loadingWorkspaces:q}]=E.Z.useWorkspaces(),D=(0,r.useRouter)(),R=(0,i.useCallback)(async()=>{try{await e9(),await b(),await D.push("/")}catch(e){(0,v.lt)(tJ.logout,e)}},[D,b]),W=(0,i.useCallback)(async e=>{a(e),e===tK.logout.key?await R():e===tK.editor.key?await D.push("/editor"):await D.replace({pathname:"/dashboard",query:{page:e}})},[D,R]),F=(0,i.useCallback)(e=>{let{keyPath:a}=e;(async()=>{let e=a.pop();await W(e)})()},[W]);return((0,j.Z)(()=>{(async()=>{w()()?await (0,tB.x)({email:"admin",password:"password"}):Z||t||await D.replace("/")})()},[t,Z,D]),(0,j.Z)(()=>{(async()=>{let e=new URLSearchParams(window.location.search),t=e.get("page");t?a(t):await W(tK.workspaces.key)})()},[D],[W]),(0,j.Z)(()=>{k&&(0,v.lt)(tJ.user,k),P&&(0,v.lt)(tJ.organizations,P),_&&(0,v.lt)(tJ.workspaces,_)},[k,P,_]),!t||Z||N||q)?(0,s.jsx)(f.Z,{}):(0,s.jsxs)(n.Z,{className:eD().dashboard,children:[(0,s.jsx)(tM,{}),(0,s.jsxs)(n.Z.Sider,{theme:"light",width:"256",className:eD().sider,children:[(0,s.jsx)("div",{className:ex().logo,children:(0,s.jsx)("img",{src:"/images/logo.svg",alt:"Tanatloc"})}),(0,s.jsx)(l.Z,{className:eD().menu,items:[{key:tK.workspaces.key,icon:(0,s.jsx)(d.Z,{}),label:tK.workspaces.label},{key:tK.account.key,icon:(0,s.jsx)(c.Z,{}),label:tK.account.label},{key:tK.organizations.key,icon:(0,s.jsx)(u.Z,{}),label:tK.organizations.label,className:w()()?"display-none":""},{key:tK.administration.key,className:t.superuser&&!w()()?"":"display-none",icon:(0,s.jsx)(m.Z,{}),label:tK.administration.label},{key:tK.editor.key,icon:(0,s.jsx)(p.Z,{}),label:tK.editor.label},{key:tK.help.key,icon:(0,s.jsx)(h.Z,{}),label:tK.help.label},{type:"divider"},{key:tK.logout.key,danger:!0,icon:(0,s.jsx)(g.Z,{}),label:tK.logout.label,className:w()()?"display-none":""},{key:"version",disabled:!0,className:"version",label:(0,s.jsxs)(o.Z.Text,{className:ex().textLight,ellipsis:{tooltip:!0},children:["version ",y.i8]})}],onClick:F,mode:"inline"})]}),(0,s.jsxs)(n.Z.Content,{className:ex().noScroll,children:[e===tK.workspaces.key&&(0,s.jsx)(eF,{user:{id:t.id},workspaces:T,organizations:O,swr:{addOneWorkspace:A,delOneWorkspace:I,mutateOneWorkspace:U}}),e===tK.account.key&&(0,s.jsx)(aC,{user:{email:t.email,firstname:t.firstname,lastname:t.lastname,avatar:t.avatar},swr:{mutateUser:x,clearUser:b}}),e===tK.organizations.key&&(0,s.jsx)(tc,{user:{id:t.id},organizations:O,swr:{addOneOrganization:C,delOneOrganization:z,mutateOneOrganization:S,loadingOrganizations:N}}),e===tK.administration.key&&(0,s.jsx)(tR,{}),e===tK.help.key&&(0,s.jsx)(tL,{})]})]})},tV=()=>(0,s.jsx)(tY,{})},19563:function(e){e.exports={information:"information_information__yYfa0"}},43308:function(e){e.exports={variables:'"@/styles/index.module.css"',colorPrimary:"#fad114",head:"pageHeader_head__Rg3v0",divider:"pageHeader_divider__Q8Uwh"}},89957:function(e){e.exports={variables:'"@/styles/index.module.css"',colorPrimary:"#fad114",dashboard:"dashboard_dashboard__2fbzf",sider:"dashboard_sider__Xow9X",menu:"dashboard_menu__sfMEa","display-none":"dashboard_display-none__qLotk","ant-menu-item-divider":"dashboard_ant-menu-item-divider__K5fZ7",inDashboard:"dashboard_inDashboard__L7TwS",inDashboardTabs:"dashboard_inDashboardTabs__BNSBv"}},61131:function(e){e.exports={variables:'"@/styles/variables.css"',colorPrimary:"#fad114",textColorLight:"rgba(0, 0, 0, 0.45)",card:"list_card___5zau",cardArchived:"list_cardArchived__zF3ZU",carousel:"list_carousel__7Kbe3",carouselSnapshot:"list_carouselSnapshot__JE5WI",carouselSnapshotArchived:"list_carouselSnapshotArchived__XZtlt",carouselDescription:"list_carouselDescription__5g2xC",carouselDescriptionArchived:"list_carouselDescriptionArchived__NzAls",empty:"list_empty__xeGxK",emptySearch:"list_emptySearch__MI0zq"}},85318:function(e){e.exports={search:"workspace_search__xni0S",shared:"workspace_shared__UPnwR",tabs:"workspace_tabs__HWnBo"}},4147:function(e){"use strict";e.exports={i8:"1.2.9"}}},function(e){e.O(0,[5336,9391,5813,223,2441,3363,9099,1417,3441,6812,2210,3159,8824,1978,4129,3422,2866,7770,5650,4507,9774,2888,179],function(){return e(e.s=9637)}),_N_E=e.O()}]);