(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4154],{31832:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/editor",function(){return n(3803)}])},55061:function(e,t,n){"use strict";n.d(t,{ET:function(){return s},KJ:function(){return a},j1:function(){return r},pj:function(){return o},zX:function(){return l}});var i=n(11409);let l=e=>({type:i.Hp.SETTEMPLATE,value:e}),r=e=>({type:i.Hp.SETMODEL,value:e}),a=e=>({type:i.Hp.SETCURSOR,value:e}),o=e=>({type:i.Hp.SETTEMPLATEVALID,value:e}),s=e=>({type:i.Hp.SETMODELVALID,value:e})},11409:function(e,t,n){"use strict";n.d(t,{Hp:function(){return a},rU:function(){return o}});var i=n(14288),l=n(67294);let r={template:"",model:"",dispatch:()=>void 0,templateValid:!1,modelValid:!1},a={SETTEMPLATE:"SETTEMPLATE",SETMODEL:"SETMODEL",SETCURSOR:"SETCURSOR",SETTEMPLATEVALID:"SETTEMPLATEVALID",SETMODELVALID:"SETMODELVALID"},o=(0,l.createContext)(r),s=(e,t)=>{switch(t.type){case a.SETTEMPLATE:return{...e,template:t.value};case a.SETMODEL:return{...e,model:t.value};case a.SETCURSOR:return{...e,cursor:t.value};case a.SETTEMPLATEVALID:return{...e,templateValid:t.value};case a.SETMODELVALID:return{...e,modelValid:t.value};default:return e}},c=e=>{let{children:t}=e,[n,a]=(0,l.useReducer)(s,r);return(0,i.tZ)(o.Provider,{value:{...n,dispatch:a},children:t})};t.ZP=c},3803:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return eV}});var i=n(14288),l=n(11163),r=n(67294),a=n(33009),o=n(97183),s=n(68508),c=n(20137),d=n(22850),u=n(26713),m=n(83062),h=n(71577),Z=n(20046),p=n(18436),v=n(67641),f=n(55734),g=n(11409),y=n(3363),b=n(11142),E=n.n(b),w=n(55061);let S=e=>{if(!e.category)throw Error("missing category");if(!e.name)throw Error("missing name");if(!e.algorithm)throw Error("missing algorithm");if(!e.code)throw Error("missing code");if(!e.version)throw Error("missing version");if(!e.description)throw Error("missing description");if(!e.configuration)throw Error("missing configuration");C(e.configuration.geometry),x(e.configuration.materials),P(e.configuration.parameters),X(e.configuration.initialization),j(e.configuration.boundaryConditions),B(e.configuration.run)},k=(e,t)=>{if(e){if(!e.index)throw Error("missing configuration."+t+".index");if(!e.title)throw Error("missing configuration."+t+".title")}},C=e=>{if(!e)throw Error("missing configuration.geometry");if(k(e,"geometry"),void 0===e.meshable)throw Error("missing configuration.geometry.meshable")},x=e=>{if(e){if(k(e,"materials"),!e.children)throw Error("missing configuration.materials.children");e.children.forEach((e,t)=>{if(!e.label)throw Error("missing configuration.materials.children["+t+"].label");if(!e.name)throw Error("missing configuration.materials.children["+t+"].name");if(!e.htmlEntity)throw Error("missing configuration.materials.children["+t+"].htmlEntity");if(void 0===e.default)throw Error("missing configuration.materials.children["+t+"].default");if(!e.unit)throw Error("missing configuration.materials.children["+t+"].unit")})}},P=e=>{if(!e)throw Error("missing configuration.parameters");k(e,"parameters"),Object.keys(e).forEach(t=>{if("index"===t||"title"===t||"done"===t)return;let n=e[t];if(!n.label)throw Error("missing configuration.parameters."+t+".label");if(!n.children)throw Error("missing configuration.parameters."+t+".children");T(n,t)})},T=(e,t)=>{e.children.forEach((e,n)=>{if(!e.label)throw Error("missing configuration.parameters."+t+".children["+n+"].label");if(!e.htmlEntity)throw Error("missing configuration.parameters."+t+".children["+n+"].htmlEntity");if(void 0===e.default)throw Error("missing configuration.parameters."+t+".children["+n+"].default")})},X=e=>{e&&k(e,"initialization")},j=e=>{if(!e)throw Error("missing configuration.boundaryConditions");k(e,"boundaryConditions"),Object.keys(e).forEach(t=>{if("title"===t||"index"===t||"done"===t)return;let n=e[t];if(!n.label)throw Error("missing configuration.boundaryConditions."+t+".label")})},B=e=>{if(!e)throw Error("missing configuration.run")};var O=n(70917),I=n(86159);let R={editor:(0,O.iv)({width:"100%",height:"100%",overflow:"hidden","& .ant-menu-item-divider":{border:"1px solid "+I.Rl.colorPrimary+" !important",margin:"0 30px !important"}}),header:(0,O.iv)({background:"white !important","& > div":{display:"flex",justifyContent:"space-between",alignItems:"center"}}),steps:(0,O.iv)({width:"206px",margin:"25px","& .ant-steps-item-title":{lineHeight:"20px !important"}}),code:(0,O.iv)({display:"flex",width:"100%",height:"100%"})},D=e=>{var t,n,l,a,o,s,c,d,u,m,Z,p,v;let{setName:f}=e,[b,k]=(0,r.useState)({}),{template:C,model:x,dispatch:P}=(0,r.useContext)(g.rU);return(0,r.useEffect)(()=>{if(!C){k(e=>({...e,template:{status:"wait",err:""},test:{status:"wait"}})),P((0,w.pj)(!1));return}k(e=>{var t;return{...e,template:{status:"finish"},test:{status:(null===(t=e.model)||void 0===t?void 0:t.status)==="finish"?"process":"wait"}}}),P((0,w.pj)(!0))},[C,P]),(0,r.useEffect)(()=>{if(!x){k(e=>({...e,model:{status:"wait"},test:{status:"wait"}})),P((0,w.ET)(!1));return}try{let e;try{e=JSON.parse(x)}catch(t){e=E().parse(x),P((0,w.j1)(JSON.stringify(e,null,"	")))}e.name&&f(e.name),S(e),k(e=>{var t;return{...e,model:{status:"finish"},test:{status:(null===(t=e.template)||void 0===t?void 0:t.status)==="finish"?"process":"wait"}}}),P((0,w.ET)(!0))}catch(n){k(e=>({...e,model:{status:"error",err:n.message},test:{status:"wait"}})),P((0,w.ET)(!1))}},[x,f,P]),(0,i.tZ)(y.Z,{css:R.steps,direction:"vertical",items:[{title:"Check template format",description:null!==(u=null===(t=b.template)||void 0===t?void 0:t.err)&&void 0!==u?u:"EJS + FreeFEM",status:null!==(m=null===(n=b.template)||void 0===n?void 0:n.status)&&void 0!==m?m:"wait"},{title:"Check description format",description:null!==(Z=null===(l=b.model)||void 0===l?void 0:null===(a=l.err)||void 0===a?void 0:a.replace(/\./g," > "))&&void 0!==Z?Z:"JSON",status:null!==(p=null===(o=b.model)||void 0===o?void 0:o.status)&&void 0!==p?p:"wait"},{title:"Test template + description",description:(0,i.BX)(i.HY,{children:[(0,i.tZ)(h.Z,{disabled:!((null===(s=b.template)||void 0===s?void 0:s.status)==="finish"&&(null===(c=b.model)||void 0===c?void 0:c.status)==="finish"),onClick:console.log,children:"Run"})," ","template on Tanatloc server"]}),status:null!==(v=null===(d=b.test)||void 0===d?void 0:d.status)&&void 0!==v?v:"wait"}]})};var M=n(15045),U=n(62806),L=n(69677),K=n(28345);let H=(e,t,n,i,l)=>{var r;let a;t.includes("include('/blobs/mesh.edp.ejs'")||(eZ(t,"<%# Mesh -%>\n<%\nconst mesh = geometry.mesh\nmesh.name = '".concat(e.name,"'\n-%>\n<%- include('/blobs/mesh.edp.ejs', {\n  dimension,\n  mesh\n}) -%>\n"),i,l),l((0,w.KJ)({row:((null==i?void 0:i.row)||0)+9,column:0})));try{a=JSON.parse(n)}catch(o){a={}}let s=Object.keys(a.configuration||{}).length;a.configuration={...a.configuration||{},geometry:{index:s+1,title:"Geometry",mesh:{name:e.name},...(null===(r=a.configuration)||void 0===r?void 0:r.geometry)||{},meshable:!0}},l((0,w.j1)(JSON.stringify(a,null,"	")))},J=()=>{let e=(0,r.useRef)(null),[t,n]=(0,r.useState)(!1),[l,a]=(0,r.useState)(!1),{template:o,model:s,cursor:c,dispatch:d}=(0,r.useContext)(g.rU);return(0,r.useEffect)(()=>{e.current&&e.current.focus()}),(0,i.BX)(i.HY,{children:[(0,i.tZ)(K.ZP,{title:"Mesh",visible:t,loading:l,async onOk(e){a(!0),H(e,o,s,c,d),a(!1),n(!1)},onCancel:()=>n(!1),children:(0,i.tZ)(U.Z.Item,{name:"name",label:"Name",rules:[{required:!0}],children:(0,i.tZ)(L.Z,{ref:e})})}),(0,i.tZ)(h.Z,{css:I.KP.fullWidth,onClick:()=>n(!0),children:"Mesh"})]})};var N=n(34041),F=n(3089),A=n(24969),V=n(23226);let Y=(e,t,n,i,l)=>{var r,a,o;let s;if(!e.materials||!e.materials.length)return;let c=e.materials.map(e=>{let t=V.j[e.symbol],n=t.label,i=t.symbol,l=t.unit;return{label:n,name:i,default:e.default,unit:l}});t.includes("include('/blobs/materials.edp.ejs'")||(eZ(t,"<%# Material -%>\n<%- include('/blobs/materials.edp.ejs', {\n  materials\n}) -%>\n",i,l),l((0,w.KJ)({row:((null==i?void 0:i.row)||4)+0,column:0})));try{s=JSON.parse(n)}catch(d){s={}}let u=Object.keys(s.configuration||{}).length;s.configuration={...s.configuration||{},materials:{index:u+1,title:"Materials",...(null===(r=s.configuration)||void 0===r?void 0:r.materials)||{},children:[...(null===(a=s.configuration)||void 0===a?void 0:null===(o=a.materials)||void 0===o?void 0:o.children)||[],...c.map(e=>({label:e.label,name:e.name,htmlEntity:"formula",default:+e.default,unit:e.unit}))]}},l((0,w.j1)(JSON.stringify(s,null,"	")))},q=()=>{let[e,t]=(0,r.useState)(!1),[n,l]=(0,r.useState)(!1),{template:a,model:o,cursor:s,dispatch:c}=(0,r.useContext)(g.rU);return(0,i.BX)(i.HY,{children:[(0,i.tZ)(K.ZP,{title:"Materials",visible:e,loading:n,async onOk(e){l(!0),Y(e,a,o,s,c),l(!1),t(!1)},onCancel:()=>t(!1),children:(0,i.tZ)(U.Z.List,{name:"materials",children(e,t,n){let{add:l,remove:r}=t,{errors:a}=n;return(0,i.BX)(i.HY,{children:[e.map((e,t)=>(0,i.BX)(U.Z.Item,{label:(0,i.BX)("div",{children:[(0,i.tZ)(F.Z,{style:{fontSize:"16px",color:"red",marginRight:"10px"},onClick:()=>r(e.name)}),"Material ",t+1]}),children:[(0,i.tZ)(U.Z.Item,{name:[e.name,"symbol"],label:"Physical parameter",rules:[{required:!0}],children:(0,i.tZ)(N.Z,{options:V.j.map((e,t)=>({label:e.symbol+": "+e.label,value:t}))})}),(0,i.tZ)(U.Z.Item,{name:[e.name,"default"],label:"Default",rules:[{required:!0}],children:(0,i.tZ)(L.Z,{})})]},e.key)),(0,i.BX)(U.Z.Item,{children:[(0,i.tZ)(h.Z,{type:"dashed",onClick:()=>l(),style:{width:"60%"},icon:(0,i.tZ)(A.Z,{}),children:"Add material"}),(0,i.tZ)(U.Z.ErrorList,{errors:a})]})]})}})}),(0,i.tZ)(h.Z,{css:I.KP.fullWidth,onClick:()=>t(!0),children:"Materials"})]})},W=(e,t,n,i,l)=>{var r,a,o,s,c,d;let u;if(!e.options||!e.options.length)return;eZ(t,"<%# Finite element space -%>\n<%\nconst finiteElementSpace = parameters.finiteElementSpace.children[0]\nfiniteElementSpace.name = '".concat(e.name,"'\n-%>\n<%- include('/blobs/fespace.edp.ejs', {\n  mesh,\n  finiteElementSpace\n}) -%>\n"),i,l),l((0,w.KJ)({row:((null==i?void 0:i.row)||9)+0,column:0}));try{u=JSON.parse(n)}catch(m){u={}}let h=Object.keys(u.configuration||{}).length;u.configuration={...u.configuration||{},parameters:{index:h+1,title:"Parameters",...(null===(r=u.configuration)||void 0===r?void 0:r.parameters)||{},finiteElementSpace:{advanced:!0,label:"Finite element space",...(null===(a=u.configuration)||void 0===a?void 0:null===(o=a.parameters)||void 0===o?void 0:o.finiteElementSpace)||{},children:[...(null===(s=null===(c=u.configuration)||void 0===c?void 0:null===(d=c.parameters)||void 0===d?void 0:d.finiteElementSpace)||void 0===s?void 0:s.children)||[],{label:"Finite element space label",label2D:"Finite element space label (2D)",htmlEntity:"select",options:e.options,default:e.options[0].value,default2D:e.options[0].value2D}]}}},l((0,w.j1)(JSON.stringify(u,null,"	")))},z=()=>{let e=(0,r.useRef)(null),[t,n]=(0,r.useState)(!1),[l,a]=(0,r.useState)(!1),{template:o,model:s,cursor:c,dispatch:d}=(0,r.useContext)(g.rU);return(0,r.useEffect)(()=>{e.current&&e.current.focus()}),(0,i.BX)(i.HY,{children:[(0,i.BX)(K.ZP,{title:"Finite element space",visible:t,loading:l,async onOk(e){a(!0),W(e,o,s,c,d),a(!1),n(!1)},onCancel:()=>n(!1),children:[(0,i.tZ)(U.Z.Item,{name:"name",label:"Name",rules:[{required:!0}],children:(0,i.tZ)(L.Z,{ref:e})}),(0,i.tZ)(U.Z.List,{name:"datas",children(e,t,n){let{add:l,remove:r}=t,{errors:a}=n;return(0,i.BX)(i.HY,{children:[e.map((e,t)=>(0,i.BX)(U.Z.Item,{label:(0,i.BX)("div",{children:[(0,i.tZ)(F.Z,{style:{fontSize:"16px",color:"red",marginRight:"10px"},onClick:()=>r(e.name)}),"Option ",t+1]}),children:[(0,i.tZ)(U.Z.Item,{name:[e.name,"label"],label:"Display name",rules:[{required:!0}],children:(0,i.tZ)(L.Z,{placeholder:"P1"})}),(0,i.tZ)(U.Z.Item,{name:[e.name,"value"],label:"Value",rules:[{required:!0}],children:(0,i.tZ)(L.Z,{placeholder:"[P1, P1, P1]"})}),(0,i.tZ)(U.Z.Item,{name:[e.name,"value2D"],label:"Value 2D",rules:[{required:!0}],children:(0,i.tZ)(L.Z,{placeholder:"[P1, P1]"})})]},e.key)),(0,i.BX)(U.Z.Item,{children:[(0,i.tZ)(h.Z,{type:"dashed",onClick:()=>l(),style:{width:"60%"},icon:(0,i.tZ)(A.Z,{}),children:"Add data"}),(0,i.tZ)(U.Z.ErrorList,{errors:a})]})]})}})]}),(0,i.tZ)(h.Z,{css:I.KP.fullWidth,onClick:()=>n(!0),children:"Finite element space"})]})},_=(e,t,n)=>{eZ(e,"<%# Headers -%>\n<%- include('/blobs/headers.edp.ejs') -%>\n",t,n),n((0,w.KJ)({row:((null==t?void 0:t.row)||0)+2,column:0}))},G=()=>{let{template:e,cursor:t,dispatch:n}=(0,r.useContext)(g.rU);return(0,i.tZ)(h.Z,{css:I.KP.fullWidth,onClick:()=>_(e,t,n),children:"Header"})},Q=(e,t,n)=>{eZ(e,"<%# Dimension -%>\n<%- include('/blobs/dimensioning.edp.ejs', {\n    dimension\n}) -%>\n",t,n),n((0,w.KJ)({row:((null==t?void 0:t.row)||0)+4,column:0}))},$=()=>{let{template:e,cursor:t,dispatch:n}=(0,r.useContext)(g.rU);return(0,i.tZ)(h.Z,{css:I.KP.fullWidth,onClick:()=>Q(e,t,n),children:"Dimension"})},ee=(e,t,n,i)=>{eZ(t,"<%# Finite element function -%>\n<%\nconst testFunction = dimension === 2 ? '[".concat(e.test1,", ").concat(e.test2,"]' : '[").concat(e.test1,", ").concat(e.test2,", ").concat(e.test3,"]'\nconst unknownFunction = dimension === 2 ? '[").concat(e.unknown1,", ").concat(e.unknown2,"]' : '[").concat(e.unknown1,", ").concat(e.unknown2,", ").concat(e.unknown3,"]'\n-%>\n<%- include('/blobs/fespaceFunction.edp.ejs', {\n    finiteElementSpace,\n    finiteElementFunction: testFunction\n  }) -%>\n  <%- include('/blobs/fespaceFunction.edp.ejs', {\n    finiteElementSpace,\n    finiteElementFunction: unknownFunction\n}) -%>\n"),n,i),i((0,w.KJ)({row:((null==n?void 0:n.row)||9)+0,column:0}))},et=()=>{let e=(0,r.useRef)(null),[t,n]=(0,r.useState)(!1),[l,a]=(0,r.useState)(!1),{template:o,cursor:s,dispatch:c}=(0,r.useContext)(g.rU);return(0,r.useEffect)(()=>{e.current&&e.current.focus()}),(0,i.BX)(i.HY,{children:[(0,i.BX)(K.ZP,{title:"Finite element function",visible:t,loading:l,async onOk(e){a(!0),ee(e,o,s,c),a(!1),n(!1)},onCancel:()=>n(!1),children:[(0,i.BX)(U.Z.Item,{label:(0,i.tZ)(d.Z.Text,{strong:!0,children:"Test function"}),children:[(0,i.tZ)(U.Z.Item,{label:"First coordinate",name:"test1",children:(0,i.tZ)(L.Z,{ref:e,placeholder:"Ux"})}),(0,i.tZ)(U.Z.Item,{label:"Second coordinate",name:"test2",children:(0,i.tZ)(L.Z,{placeholder:"Uy"})}),(0,i.tZ)(U.Z.Item,{label:"Third coordinate",name:"test3",children:(0,i.tZ)(L.Z,{placeholder:"Uz"})})]}),(0,i.BX)(U.Z.Item,{label:(0,i.tZ)(d.Z.Text,{strong:!0,children:"Unknows function"}),children:[(0,i.tZ)(U.Z.Item,{label:"First coordinate",name:"unknown1",children:(0,i.tZ)(L.Z,{placeholder:"Uhx"})}),(0,i.tZ)(U.Z.Item,{label:"Second coordinate",name:"unknown2",children:(0,i.tZ)(L.Z,{placeholder:"Uhy"})}),(0,i.tZ)(U.Z.Item,{label:"Third coordinate",name:"unknown3",children:(0,i.tZ)(L.Z,{placeholder:"Uhz"})})]})]}),(0,i.tZ)(h.Z,{css:I.KP.fullWidth,onClick:()=>n(!0),children:"Finite element function"})]})};var en=n(32808);let ei=(e,t,n,i)=>{let l=e.macros.map(e=>"'"+e+"'").join(", ");eZ(t,"<%# Macro -%>\n<%- include('/blobs/macro.edp.ejs', {\n    dimension,\n    type: [".concat(l,"]\n}) -%>\n"),n,i),i((0,w.KJ)({row:((null==n?void 0:n.row)||5)+0,column:0}))},el=()=>{let[e,t]=(0,r.useState)(!1),[n,l]=(0,r.useState)(!1),{template:a,cursor:o,dispatch:s}=(0,r.useContext)(g.rU);return(0,i.BX)(i.HY,{children:[(0,i.tZ)(K.ZP,{title:"Macros",visible:e,loading:n,async onOk(e){l(!0),ei(e,a,o,s),l(!1),t(!1)},onCancel:()=>t(!1),children:(0,i.tZ)(U.Z.Item,{label:"Type",name:"macros",children:(0,i.tZ)(en.Z.Group,{options:[{label:"Scalar gradient",value:"scalarGradient"},{label:"Vectorial divergence",value:"vectorialDivergence"},{label:"Vectorial divergence axisymmetric",value:"vectorialDivergenceRZ"},{label:"Vectorial epsilon",value:"vectorialEpsilon"},{label:"Vectorial gradient",value:"vectorialGradient"},{label:"Vectorial R divergence axisymmetric",value:"vectorialRdivergenceRZ"}],style:{display:"flex",flexDirection:"column"}})})}),(0,i.tZ)(h.Z,{css:I.KP.fullWidth,onClick:()=>t(!0),children:"Macros"})]})},er=(e,t,n,i,l)=>{var r,a,o,s,c,d;let u;eZ(t,"<%# Solver -%>\n<% const solver = parameters.solver.children[0].value ?? parameters.solver.children[0].default -%>\n<%- include('/blobs/solver.edp.ejs', {\n    solver\n}) -%>",i,l),l((0,w.KJ)({row:((null==i?void 0:i.row)||9)+0,column:0}));try{u=JSON.parse(n)}catch(m){u={}}let h=Object.keys(u.configuration||{}).length;u.configuration={...u.configuration||{},parameters:{index:h+1,title:"Parameters",...(null===(r=u.configuration)||void 0===r?void 0:r.parameters)||{},solver:{advanced:!0,label:"Solver",...(null===(a=u.configuration)||void 0===a?void 0:null===(o=a.parameters)||void 0===o?void 0:o.solver)||{},children:[...(null===(s=null===(c=u.configuration)||void 0===c?void 0:null===(d=c.parameters)||void 0===d?void 0:d.solver)||void 0===s?void 0:s.children)||[],{label:"System resolution",htmlEntity:"select",options:e.solvers.map(e=>({label:e,value:e})),default:"MUMPS"}]}}},l((0,w.j1)(JSON.stringify(u,null,"	")))},ea=()=>{let[e,t]=(0,r.useState)(!1),[n,l]=(0,r.useState)(!1),{template:a,model:o,cursor:s,dispatch:c}=(0,r.useContext)(g.rU);return(0,i.BX)(i.HY,{children:[(0,i.tZ)(K.ZP,{title:"Solver",visible:e,loading:n,async onOk(e){l(!0),er(e,a,o,s,c),l(!1),t(!1)},onCancel:()=>t(!1),children:(0,i.tZ)(U.Z.Item,{name:"solvers",label:"Availables",children:(0,i.tZ)(en.Z.Group,{options:["UMFPCK","CG","Cholesky","Crout","GMRES","LU","sparsesolver","MUMPS"],style:{display:"flex",flexDirection:"column"}})})}),(0,i.tZ)(h.Z,{css:I.KP.fullWidth,onClick:()=>t(!0),children:"Solver"})]})},eo=e=>{var t,n,i,l,r,a,o,s;let c=null===(t=null===(n=e.scalarResults)||void 0===n?void 0:n.map(e=>"'".concat(e.variable,"'")))||void 0===t?void 0:t.join(", "),d=null===(i=null===(l=e.vectorialResults)||void 0===l?void 0:l.map(e=>"dimension === 2 ? ['".concat(e.variable1,"', '").concat(e.variable2,"', '0'] : ['").concat(e.variable1,"', '").concat(e.variable2,"', '").concat(e.variable3,"']")))||void 0===i?void 0:i.join(", "),u=null===(r=null===(a=e.scalarResults)||void 0===a?void 0:a.map(e=>1))||void 0===r?void 0:r.join(", "),m=null===(o=null===(s=e.vectorialResults)||void 0===s?void 0:s.map(e=>1))||void 0===o?void 0:o.join(", ");return{results:(c?c+", ":"")+(null!=d?d:""),order:(u?u+", ":"")+(null!=m?m:"")}},es=(e,t,n,i,l)=>{var r,a,o,s,c,d,u,m;let h;if(!e.scalarResults&&!e.vectorialResults||!(null===(r=e.scalarResults)||void 0===r?void 0:r.length)&&!(null===(a=e.vectorialResults)||void 0===a?void 0:a.length))return;let Z=eo(e);eZ(t,"<%# Save -%>\n<%- include('/blobs/save.edp.ejs', {\n    solution: {\n        path: run.resultPath,\n        name: '\"Result\"',\n        mesh: mesh.name,\n        sol: [".concat(Z.results,"],\n        dataName: run.results.map(r => r.name),\n        order: [").concat(Z.order,"]\n    }\n}) -%>\n"),i,l),l((0,w.KJ)({row:((null==i?void 0:i.row)||4)+0,column:0}));try{h=JSON.parse(n)}catch(p){h={}}let v=Object.keys(h.configuration||{}).length;h.configuration={...h.configuration||{},run:{index:v+1,title:"Run",...null!==(m=null===(o=h.configuration)||void 0===o?void 0:o.run)&&void 0!==m?m:{},results:[...(null===(s=h.configuration)||void 0===s?void 0:null===(c=s.run)||void 0===c?void 0:c.results)||[],...(null===(d=e.scalarResults)||void 0===d?void 0:d.map(e=>({name:e.name})))||[],...(null===(u=e.vectorialResults)||void 0===u?void 0:u.map(e=>({name:e.name})))||[]]}},l((0,w.j1)(JSON.stringify(h,null,"	")))},ec=()=>{let[e,t]=(0,r.useState)(!1),[n,l]=(0,r.useState)(!1),{template:a,model:o,cursor:s,dispatch:c}=(0,r.useContext)(g.rU);return(0,i.BX)(i.HY,{children:[(0,i.BX)(K.ZP,{title:"Save",visible:e,loading:n,async onOk(e){l(!0),es(e,a,o,s,c),l(!1),t(!1)},onCancel:()=>t(!1),children:[(0,i.tZ)(U.Z.List,{name:"scalarResults",children(e,t,n){let{add:l,remove:r}=t,{errors:a}=n;return(0,i.BX)(i.HY,{children:[e.map((e,t)=>(0,i.BX)(U.Z.Item,{label:(0,i.BX)("div",{children:[(0,i.tZ)(F.Z,{style:{fontSize:"16px",color:"red",marginRight:"10px"},onClick:()=>r(e.name)}),"Scalar result ",t+1]}),children:[(0,i.tZ)(U.Z.Item,{name:[e.name,"name"],label:"Display name",rules:[{required:!0}],children:(0,i.tZ)(L.Z,{})}),(0,i.tZ)(U.Z.Item,{name:[e.name,"variable"],label:"Variable name",rules:[{required:!0}],children:(0,i.tZ)(L.Z,{})})]},e.key)),(0,i.BX)(U.Z.Item,{children:[(0,i.tZ)(h.Z,{type:"dashed",onClick:()=>l(),style:{width:"60%"},icon:(0,i.tZ)(A.Z,{}),children:"Add scalar result"}),(0,i.tZ)(U.Z.ErrorList,{errors:a})]})]})}}),(0,i.tZ)(U.Z.List,{name:"vectorialResults",children(e,t,n){let{add:l,remove:r}=t,{errors:a}=n;return(0,i.BX)(i.HY,{children:[e.map((e,t)=>(0,i.BX)(U.Z.Item,{label:(0,i.BX)("div",{children:[(0,i.tZ)(F.Z,{style:{fontSize:"16px",color:"red",marginRight:"10px"},onClick:()=>r(e.name)}),"Vectorial result ",t+1]}),children:[(0,i.tZ)(U.Z.Item,{name:[e.name,"name"],label:"Display name",rules:[{required:!0}],children:(0,i.tZ)(L.Z,{})}),(0,i.tZ)(U.Z.Item,{name:[e.name,"variable1"],label:"First component variable name",rules:[{required:!0}],children:(0,i.tZ)(L.Z,{})}),(0,i.tZ)(U.Z.Item,{name:[e.name,"variable2"],label:"Second component variable name",rules:[{required:!0}],children:(0,i.tZ)(L.Z,{})}),(0,i.tZ)(U.Z.Item,{name:[e.name,"variable3"],label:"Third component variable name",rules:[{required:!0}],children:(0,i.tZ)(L.Z,{})})]},e.key)),(0,i.BX)(U.Z.Item,{children:[(0,i.tZ)(h.Z,{type:"dashed",onClick:()=>l(),style:{width:"60%"},icon:(0,i.tZ)(A.Z,{}),children:"Add vectorial result"}),(0,i.tZ)(U.Z.ErrorList,{errors:a})]})]})}})]}),(0,i.tZ)(h.Z,{css:I.KP.fullWidth,onClick:()=>t(!0),children:"Save"})]})},ed=(e,t,n,i)=>{e.datas&&e.datas.length&&(eZ(t,"<%- include('/blobs/data.edp.ejs', {\n    title: '".concat(e.title,"',\n    path: run.dataPath,\n    fileName: '\"iter_\"+timeIter',\n    dataNames: [").concat(e.datas.map(e=>"'".concat(e.name,"'")).join(", "),"],\n    x: '").concat(e.x,"',\n    ys: [").concat(e.datas.map(e=>"'".concat(e.y,"'")).join(", "),"]\n}) -%>"),n,i),i((0,w.KJ)({row:((null==n?void 0:n.row)||4)+0,column:0})))},eu=()=>{let e=(0,r.useRef)(null),[t,n]=(0,r.useState)(!1),[l,a]=(0,r.useState)(!1),{template:o,cursor:s,dispatch:c}=(0,r.useContext)(g.rU);return(0,r.useEffect)(()=>{e.current&&e.current.focus()}),(0,i.BX)(i.HY,{children:[(0,i.BX)(K.ZP,{title:"Data",visible:t,loading:l,async onOk(e){a(!0),ed(e,o,s,c),a(!1),n(!1)},onCancel:()=>n(!1),children:[(0,i.tZ)(U.Z.Item,{label:"Title",name:"title",rules:[{required:!0}],children:(0,i.tZ)(L.Z,{ref:e})}),(0,i.tZ)(U.Z.Item,{label:"X axis variable",name:"x",rules:[{required:!0}],children:(0,i.tZ)(L.Z,{})}),(0,i.tZ)(U.Z.List,{name:"datas",children(e,t,n){let{add:l,remove:r}=t,{errors:a}=n;return(0,i.BX)(i.HY,{children:[e.map((e,t)=>(0,i.BX)(U.Z.Item,{label:(0,i.BX)("div",{children:[(0,i.tZ)(F.Z,{style:{fontSize:"16px",color:"red",marginRight:"10px"},onClick:()=>r(e.name)}),"Data ",t+1]}),children:[(0,i.tZ)(U.Z.Item,{name:[e.name,"name"],label:"Display name",rules:[{required:!0}],children:(0,i.tZ)(L.Z,{})}),(0,i.tZ)(U.Z.Item,{name:[e.name,"y"],label:"Y axis variable",rules:[{required:!0}],children:(0,i.tZ)(L.Z,{})})]},e.key)),(0,i.BX)(U.Z.Item,{children:[(0,i.tZ)(h.Z,{type:"dashed",onClick:()=>l(),style:{width:"60%"},icon:(0,i.tZ)(A.Z,{}),children:"Add data"}),(0,i.tZ)(U.Z.ErrorList,{errors:a})]})]})}})]}),(0,i.tZ)(h.Z,{css:I.KP.fullWidth,onClick:()=>n(!0),children:"Data"})]})},em=(e,t,n,i)=>{eZ(t,"<%# Sensors -%>\n<%- helpers.indent(include('/blobs/sensors.edp.ejs', {\n    path: run.dataPath,\n    x: '".concat(e.x,"',\n    sensors: run.sensors\n}), 2) -%>"),n,i),i((0,w.KJ)({row:((null==n?void 0:n.row)||4)+0,column:0}))},eh=()=>{let e=(0,r.useRef)(null),[t,n]=(0,r.useState)(!1),[l,a]=(0,r.useState)(!1),{template:o,cursor:s,dispatch:c}=(0,r.useContext)(g.rU);return(0,r.useEffect)(()=>{e.current&&e.current.focus()}),(0,i.BX)(i.HY,{children:[(0,i.tZ)(K.ZP,{title:"Sensors",visible:t,loading:l,async onOk(e){a(!0),em(e,o,s,c),a(!1),n(!1)},onCancel:()=>n(!1),children:(0,i.tZ)(U.Z.Item,{label:"X axis variable",name:"x",rules:[{required:!0}],children:(0,i.tZ)(L.Z,{ref:e})})}),(0,i.tZ)(h.Z,{css:I.KP.fullWidth,onClick:()=>n(!0),children:"Sensors"})]})},eZ=(e,t,n,i)=>{if(n){let l=n.row,r=(e||"").split("\n"),a=[...r.slice(0,l+1),...t.split("\n"),...r.slice(l+1)];i((0,w.zX)(a.join("\n")))}else i((0,w.zX)((e||"")+t))},ep=()=>(0,i.tZ)(i.HY,{children:(0,i.BX)(M.Z,{style:{overflow:"auto",maxHeight:"calc(100% - 443px)"},children:[(0,i.tZ)(M.Z.Panel,{header:"Head",children:(0,i.BX)(u.Z,{direction:"vertical",css:I.KP.fullWidth,children:[(0,i.tZ)(G,{}),(0,i.tZ)($,{})]})},"head"),(0,i.tZ)(M.Z.Panel,{header:"Components",children:(0,i.BX)(u.Z,{direction:"vertical",css:I.KP.fullWidth,children:[(0,i.tZ)(J,{}),(0,i.tZ)(q,{}),(0,i.tZ)(z,{}),(0,i.tZ)(et,{}),(0,i.tZ)(el,{}),(0,i.tZ)(ea,{})]})},"components"),(0,i.tZ)(M.Z.Panel,{header:"Results",children:(0,i.BX)(u.Z,{direction:"vertical",css:I.KP.fullWidth,children:[(0,i.tZ)(ec,{}),(0,i.tZ)(eu,{}),(0,i.tZ)(eh,{})]})},"results")]})});var ev=n(43008);let ef=e=>{e((0,w.zX)("try{\n<%# Headers -%>\n<%- include('/blobs/headers.edp.ejs') -%>\n\n<%# Dimension -%>\n<%- include('/blobs/dimensioning.edp.ejs', {\n	dimension\n}) -%>\n\n// WRITE YOUR TEMPLATE HERE\n\n} catch(...) {\n	appendError(\"An internal error occurs\");\n	exit(-1);\n}\n")),e((0,w.j1)(JSON.stringify({category:"Category",name:"My new model",algorithm:"Algorithm",code:"FreeFEM",version:"1.0.0",description:"",configuration:{}},null,"	")+"\n"))},eg=()=>{let{dispatch:e}=(0,r.useContext)(g.rU);return(0,i.tZ)(m.Z,{title:"New model",children:(0,i.tZ)(h.Z,{icon:(0,i.tZ)(ev.Z,{}),onClick:()=>ef(e)})})};var ey=n(67875),eb=n(95591),eE=n(39553),ew={gmsh2D:"gmsh2D.geo.ejs",gmsh3D:"gmsh3D.geo.ejs",poisson:"poisson.edp.ejs",linearElasticity:"linearElasticity.edp.ejs",linearElasticityTime:"linearElasticityTime.edp.ejs",linearElasticityModal:"linearElasticityModal.edp.ejs",stokes:"stokes.edp.ejs",navierStokesTime:"navierStokesTime.edp.ejs",thermicDiffusion:"thermicDiffusion.edp.ejs"},eS=n(12271),ek=n(64376);let eC={delete:"Unable to delete model"},ex=async(e,t,n)=>{try{let i=e.models[t],l=e.templates[t];await f.Z.update([{key:"models",type:"array",method:"remove",value:i},{key:"templates",type:"array",method:"remove",value:l}]);let r=ek.Z.deepCopy(e);r.models=[...r.models.slice(0,t),...r.models.slice(t+1)],r.templates=[...r.templates.slice(0,t),...r.templates.slice(t+1)],n.mutateUser(r)}catch(a){throw(0,eS.lt)(eC.delete,a),a}},eP=e=>{let{user:t,index:n,swr:l}=e;return(0,i.tZ)(p.m1,{onDelete:async()=>ex(t,n,l)})},eT={load:"Unable to load current model"},eX=async(e,t)=>{try{let n=eE.Z[e];t((0,w.j1)(JSON.stringify(n,null,"	")));let i=n.algorithm,l=ew[i],r=await fetch("/templates/"+l),a=await r.text();t((0,w.zX)(a))}catch(o){(0,eS.lt)(eT.load,o)}},ej=async(e,t,n)=>{try{e.user&&delete e.user,n((0,w.j1)(JSON.stringify(e,null,"	"))),n((0,w.zX)(t))}catch(i){(0,eS.lt)(eT.load,i)}},eB=e=>{let{user:t,swr:n}=e,[l,a]=(0,r.useState)(!1),[o,s]=(0,r.useState)(!1),{dispatch:c}=(0,r.useContext)(g.rU);return(0,i.BX)(i.HY,{children:[(0,i.tZ)(K.ZP,{title:"Models browser",visible:l,loading:o,onCancel:()=>a(!1),children:(0,i.tZ)(ey.Z,{items:[{key:"models",label:"Tanatloc models",children:(0,i.tZ)(u.Z,{direction:"vertical",css:I.KP.fullWidth,children:eE.Z.map((e,t)=>(0,i.BX)("div",{css:I.KP.displayFlex,style:{justifyContent:"space-between",alignItems:"center"},children:[e.name,(0,i.tZ)(m.Z,{title:"Open",children:(0,i.tZ)(h.Z,{async onClick(){s(!0);try{await eX(t,c)}finally{s(!1),a(!1)}},icon:(0,i.tZ)(eb.Z,{})})})]},t))})},{key:"personalModels",label:"My models",children:(0,i.tZ)(u.Z,{direction:"vertical",css:I.KP.fullWidth,children:t.models.map((e,l)=>(0,i.BX)("div",{css:I.KP.displayFlex,style:{justifyContent:"space-between",alignItems:"center"},children:[e.name,(0,i.BX)("div",{children:[(0,i.tZ)(m.Z,{title:"Open",children:(0,i.tZ)(h.Z,{async onClick(){s(!0);try{await ej(e,t.templates[l],c)}finally{s(!1),a(!1)}},icon:(0,i.tZ)(eb.Z,{})})}),(0,i.tZ)(eP,{user:t,index:l,swr:n})]})]},l))})}]})}),(0,i.tZ)(m.Z,{title:"Browse existing model",children:(0,i.tZ)(h.Z,{icon:(0,i.tZ)(eb.Z,{}),onClick:()=>a(!0)})})]})};var eO=n(60974),eI=n(60219);let eR={json:"Model definition is not valid",check:"Unable to check",save:"Unable to save"},eD=async(e,t,n,i)=>{let l;try{l=JSON.parse(n)}catch(r){(0,eS.lt)(eR.json,r);return}try{let a=e.models.find(e=>e.algorithm===l.algorithm);a?eO.Z.confirm({title:"A model with the same algorithm entry already exists. Do you want to override it?",async onOk(){let n=e.models.findIndex(e=>e.algorithm===l.algorithm);await eM(e,t,l,i,n)}}):await eM(e,t,l,i)}catch(o){(0,eS.lt)(eR.check,o)}},eM=async(e,t,n,i,l)=>{if(void 0===l)try{await f.Z.update([{key:"models",type:"array",method:"append",value:{...n,user:e.id}},{key:"templates",type:"array",method:"append",value:i}]);let r=ek.Z.deepCopy(e);r.models.push(n),t.mutateUser(r)}catch(a){(0,eS.lt)(eR.save,a)}else try{await f.Z.update([{key:"models",type:"array",method:"set",index:l,value:{...n,user:e.id}},{key:"templates",type:"array",method:"set",index:l,value:i}]);let o=ek.Z.deepCopy(e);o.models[l]=n,t.mutateUser(o)}catch(s){(0,eS.lt)(eR.save,s)}},eU=e=>{let{user:t,swr:n}=e,[l,a]=(0,r.useState)(!1),[o,s]=(0,r.useState)(!1),{model:c,template:d,templateValid:u,modelValid:Z}=(0,r.useContext)(g.rU);return(0,r.useEffect)(()=>{u&&Z?a(!1):a(!0)},[u,Z]),(0,i.tZ)(m.Z,{title:"Save",children:(0,i.tZ)(h.Z,{disabled:l,loading:o,icon:(0,i.tZ)(eI.Z,{}),async onClick(){s(!0),await eD(t,n,c,d),s(!1)}})})};var eL=n(5152),eK=n.n(eL);let eH=eK()(()=>Promise.all([n.e(4281),n.e(3700),n.e(4716)]).then(n.bind(n,34716)).catch(e=>{let t=()=>(0,i.BX)("div",{children:[(0,i.tZ)("p",{children:"Unable to load FreeFEM-EJS editor"}),(0,i.tZ)("p",{children:e.message})]});return t}),{loadableGenerated:{webpack:()=>[34716]},ssr:!1}),eJ=eK()(()=>Promise.all([n.e(4281),n.e(3700),n.e(1119)]).then(n.bind(n,71119)).catch(e=>{let t=()=>(0,i.BX)("div",{children:[(0,i.tZ)("p",{children:"Unable to load JSON editor"}),(0,i.tZ)("p",{children:e.message})]});return t}),{loadableGenerated:{webpack:()=>[71119]},ssr:!1}),eN=()=>(0,i.BX)("div",{css:R.code,children:[(0,i.tZ)(eH,{}),(0,i.tZ)(eJ,{})]}),eF=()=>{let[e,t]=(0,r.useState)(),n=(0,l.useRouter)(),[y,{loadingUser:b,mutateUser:E}]=f.Z.useUser();(0,r.useEffect)(()=>{b||y||n.replace("/")},[y,b,n]),(0,r.useEffect)(()=>{a.Z.warning({message:"This is a beta version",description:(0,i.BX)(i.HY,{children:[(0,i.tZ)("br",{}),"- You may encounter unexpected bugs",(0,i.tZ)("br",{}),"- Some features are not totally functionnal"]}),placement:"top",duration:0})},[]);let w=(0,r.useCallback)(()=>{n.push({pathname:"/dashboard"})},[n]);return b||!y?(0,i.tZ)(v.Z,{}):(0,i.tZ)(g.ZP,{children:(0,i.BX)(o.Z,{css:R.editor,children:[(0,i.BX)(o.Z.Sider,{theme:"light",width:"256",children:[(0,i.tZ)("div",{css:I.KP.logo,children:(0,i.tZ)("img",{src:"/images/logo.svg",alt:"Tanatloc"})}),(0,i.tZ)(s.Z,{mode:"inline",items:[{key:"menu-go-back",disabled:!0,style:{cursor:"unset",margin:"10px 0",paddingLeft:10},label:(0,i.tZ)(p.ks,{onClick:w,children:"Return to dashboard"})},{type:"divider"}]}),(0,i.tZ)(D,{setName:t}),(0,i.tZ)(c.Z,{}),(0,i.tZ)(ep,{})]}),(0,i.BX)(o.Z.Content,{css:I.KP.noScroll,children:[(0,i.tZ)(o.Z.Header,{css:R.header,children:(0,i.BX)("div",{children:[(0,i.tZ)(d.Z.Text,{strong:!0,children:e}),(0,i.BX)(u.Z,{children:[(0,i.tZ)(eg,{}),(0,i.tZ)(eB,{user:{id:y.id,models:y.models,templates:y.templates},swr:{mutateUser:E}}),(0,i.tZ)(eU,{user:{id:y.id,models:y.models},swr:{mutateUser:E}}),(0,i.tZ)(m.Z,{title:"Coming soon",children:(0,i.tZ)(h.Z,{disabled:!0,icon:(0,i.tZ)(Z.Z,{})})})]})]})}),(0,i.tZ)(eN,{})]})]})})},eA=()=>(0,i.tZ)(eF,{});var eV=eA}},function(e){e.O(0,[4875,992,1183,5813,1577,3239,2833,4702,1473,3363,974,2022,2525,6859,6990,7450,168,9774,2888,179],function(){return e(e.s=31832)}),_N_E=e.O()}]);