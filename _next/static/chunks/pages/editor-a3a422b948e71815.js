(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4154],{59261:function(e,l,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/editor",function(){return t(87461)}])},17644:function(e,l,t){"use strict";t.d(l,{ET:function(){return o},KJ:function(){return s},j1:function(){return a},pj:function(){return r},zX:function(){return i}});var n=t(55190);let i=e=>({type:n.Hp.SETTEMPLATE,value:e}),a=e=>({type:n.Hp.SETMODEL,value:e}),s=e=>({type:n.Hp.SETCURSOR,value:e}),r=e=>({type:n.Hp.SETTEMPLATEVALID,value:e}),o=e=>({type:n.Hp.SETMODELVALID,value:e})},55190:function(e,l,t){"use strict";t.d(l,{Hp:function(){return s},rU:function(){return r}});var n=t(85893),i=t(67294);let a={template:"",model:"",dispatch:()=>void 0,templateValid:!1,modelValid:!1},s={SETTEMPLATE:"SETTEMPLATE",SETMODEL:"SETMODEL",SETCURSOR:"SETCURSOR",SETTEMPLATEVALID:"SETTEMPLATEVALID",SETMODELVALID:"SETMODELVALID"},r=(0,i.createContext)(a),o=(e,l)=>{switch(l.type){case s.SETTEMPLATE:return{...e,template:l.value};case s.SETMODEL:return{...e,model:l.value};case s.SETCURSOR:return{...e,cursor:l.value};case s.SETTEMPLATEVALID:return{...e,templateValid:l.value};case s.SETMODELVALID:return{...e,modelValid:l.value};default:return e}},c=e=>{let{children:l}=e,[t,s]=(0,i.useReducer)(o,a),c=(0,i.useMemo)(()=>({...t,dispatch:s}),[t]);return(0,n.jsx)(r.Provider,{value:c,children:l})};l.ZP=c},87461:function(e,l,t){"use strict";t.r(l),t.d(l,{default:function(){return e$}});var n=t(85893),i=t(11163),a=t(67294),s=t(97183),r=t(68508),o=t(96074),c=t(22850),d=t(26713),u=t(71577),m=t(83062),h=t(93531),p=t(20046),v=t(55190),x=t(51302),j=t(94725),f=t(42661),b=t(3363),g=t(11142),y=t.n(g),Z=t(17644),E=t(26231);let k=e=>{if(!e.category)throw Error("missing category");if(!e.name)throw Error("missing name");if(!e.algorithm)throw Error("missing algorithm");if(!e.code)throw Error("missing code");if(!e.version)throw Error("missing version");if(!e.description)throw Error("missing description");if(!e.configuration)throw Error("missing configuration");C(e.configuration.geometry),S(e.configuration.materials),P(e.configuration.parameters),N(e.configuration.initialization),O(e.configuration.boundaryConditions),I(e.configuration.run)},w=(e,l)=>{if(e){if(!e.index)throw Error("missing configuration."+l+".index");if(!e.title)throw Error("missing configuration."+l+".title")}},C=e=>{if(!e)throw Error("missing configuration.geometry");if(w(e,"geometry"),void 0===e.meshable)throw Error("missing configuration.geometry.meshable")},S=e=>{if(e){if(w(e,"materials"),!e.children)throw Error("missing configuration.materials.children");e.children.forEach((e,l)=>{if(!e.label)throw Error("missing configuration.materials.children["+l+"].label");if(!e.name)throw Error("missing configuration.materials.children["+l+"].name");if(!e.htmlEntity)throw Error("missing configuration.materials.children["+l+"].htmlEntity");if(void 0===e.default)throw Error("missing configuration.materials.children["+l+"].default");if(!e.unit)throw Error("missing configuration.materials.children["+l+"].unit")})}},P=e=>{if(!e)throw Error("missing configuration.parameters");w(e,"parameters"),Object.keys(e).forEach(l=>{if("index"===l||"title"===l||"done"===l)return;let t=e[l];if(!t.label)throw Error("missing configuration.parameters."+l+".label");if(!t.children)throw Error("missing configuration.parameters."+l+".children");T(t,l)})},T=(e,l)=>{e.children.forEach((e,t)=>{if(!e.label)throw Error("missing configuration.parameters."+l+".children["+t+"].label");if(!e.htmlEntity)throw Error("missing configuration.parameters."+l+".children["+t+"].htmlEntity");if(void 0===e.default)throw Error("missing configuration.parameters."+l+".children["+t+"].default")})},N=e=>{e&&w(e,"initialization")},O=e=>{if(!e)throw Error("missing configuration.boundaryConditions");w(e,"boundaryConditions"),Object.keys(e).forEach(l=>{if("title"===l||"index"===l||"done"===l)return;let t=e[l];if(!t.label)throw Error("missing configuration.boundaryConditions."+l+".label")})},I=e=>{if(!e)throw Error("missing configuration.run")};var M=t(36294),D=t.n(M);let F=e=>{var l,t,i,s,r,o,c,d,m,h,p;let{setName:x}=e,[j,f]=(0,a.useState)({}),{template:g,model:w,dispatch:C}=(0,a.useContext)(v.rU);return(0,E.Z)(()=>{if(!g){f(e=>({...e,template:{status:"wait",err:""},test:{status:"wait"}})),C((0,Z.pj)(!1));return}f(e=>{var l;return{...e,template:{status:"finish"},test:{status:(null===(l=e.model)||void 0===l?void 0:l.status)==="finish"?"process":"wait"}}}),C((0,Z.pj)(!0))},[g],[C]),(0,E.Z)(()=>{if(!w){f(e=>({...e,model:{status:"wait"},test:{status:"wait"}})),C((0,Z.ET)(!1));return}try{let e;try{e=JSON.parse(w)}catch(l){e=y().parse(w),C((0,Z.j1)(JSON.stringify(e,null,"	")))}e.name&&x(e.name),k(e),f(e=>{var l;return{...e,model:{status:"finish"},test:{status:(null===(l=e.template)||void 0===l?void 0:l.status)==="finish"?"process":"wait"}}}),C((0,Z.ET)(!0))}catch(e){f(l=>({...l,model:{status:"error",err:e.message},test:{status:"wait"}})),C((0,Z.ET)(!1))}},[w],[x,C]),(0,n.jsx)("div",{id:"steps",children:(0,n.jsx)(b.Z,{className:D().steps,direction:"vertical",items:[{title:"Check template format",description:null!==(c=null===(l=j.template)||void 0===l?void 0:l.err)&&void 0!==c?c:"EJS + FreeFEM",status:null!==(d=null===(t=j.template)||void 0===t?void 0:t.status)&&void 0!==d?d:"wait"},{title:"Check description format",description:null!==(m=null===(i=j.model)||void 0===i?void 0:null===(s=i.err)||void 0===s?void 0:s.replace(/\./g," > "))&&void 0!==m?m:"JSON",status:null!==(h=null===(r=j.model)||void 0===r?void 0:r.status)&&void 0!==h?h:"wait"},{title:"Test template + description",description:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(u.ZP,{disabled:!0,onClick:console.log,children:"Run"})," ","template on Tanatloc server"]}),status:null!==(p=null===(o=j.test)||void 0===o?void 0:o.status)&&void 0!==p?p:"wait"}]})})};var R=t(15045),U=t(96108),L=t(69677),J=t(86373),_=t(14856),A=t.n(_);let V=(e,l,t,n,i)=>{var a;let s;l.includes("include('/blobs/mesh.edp.ejs'")||(ef(l,"<%# Mesh -%>\n<%\nconst mesh = geometry.mesh\nmesh.name = '".concat(e.name,"'\n-%>\n<%- include('/blobs/mesh.edp.ejs', {\n  dimension,\n  mesh\n}) -%>\n"),n,i),i((0,Z.KJ)({row:((null==n?void 0:n.row)||0)+9,column:0})));try{s=JSON.parse(t)}catch(e){s={}}let r=Object.keys(s.configuration||{}).length;s.configuration={...s.configuration||{},geometry:{index:r+1,title:"Geometry",mesh:{name:e.name},...(null===(a=s.configuration)||void 0===a?void 0:a.geometry)||{},meshable:!0}},i((0,Z.j1)(JSON.stringify(s,null,"	")))},W=()=>{let e=(0,a.useRef)(null),[l,t]=(0,a.useState)(!1),[i,s]=(0,a.useState)(!1),{template:r,model:o,cursor:c,dispatch:d}=(0,a.useContext)(v.rU);(0,a.useEffect)(()=>{e.current&&e.current.focus()});let m=(0,a.useCallback)(()=>t(!0),[]),h=(0,a.useCallback)(()=>t(!1),[]),p=(0,a.useCallback)(async e=>{s(!0),V(e,r,o,c,d),s(!1),t(!1)},[r,o,c,d]);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(J.ZP,{title:"Mesh",visible:l,loading:i,onOk:p,onCancel:h,children:(0,n.jsx)(U.Z.Item,{name:"name",label:"Name",rules:[{required:!0}],children:(0,n.jsx)(L.Z,{ref:e})})}),(0,n.jsx)(u.ZP,{className:A().fullWidth,onClick:m,children:"Mesh"})]})};var q=t(34041),H=t(27588),K=t(24969);let z=e=>{let{children:l,label:t,errors:i,add:s}=e,r=(0,a.useCallback)(()=>s(),[s]);return(0,n.jsxs)(n.Fragment,{children:[l,(0,n.jsxs)(U.Z.Item,{children:[(0,n.jsxs)(u.ZP,{type:"dashed",onClick:r,style:{width:"60%"},icon:(0,n.jsx)(K.Z,{}),children:["Add ",t]}),(0,n.jsx)(U.Z.ErrorList,{errors:i})]})]})};var X=t(3089);let G=e=>{let{children:l,field:t,label:i,index:s,remove:r}=e,o=(0,a.useCallback)(()=>r(t.name),[t,r]);return(0,n.jsx)(U.Z.Item,{label:(0,n.jsxs)("div",{children:[(0,n.jsx)(X.Z,{style:{fontSize:"16px",color:"red",marginRight:"10px"},onClick:o}),i," ",s+1]}),children:l},t.key)},B=(e,l,t,n,i)=>{var a,s,r;let o;if(!e.materials||!e.materials.length)return;let c=e.materials.map(e=>{let l=H.j[e.symbol],t=l.label,n=l.symbol,i=l.unit;return{label:t,name:n,default:e.default,unit:i}});l.includes("include('/blobs/materials.edp.ejs'")||(ef(l,"<%# Material -%>\n<%- include('/blobs/materials.edp.ejs', {\n  materials\n}) -%>\n",n,i),i((0,Z.KJ)({row:((null==n?void 0:n.row)||4)+0,column:0})));try{o=JSON.parse(t)}catch(e){o={}}let d=Object.keys(o.configuration||{}).length;o.configuration={...o.configuration||{},materials:{index:d+1,title:"Materials",...(null===(a=o.configuration)||void 0===a?void 0:a.materials)||{},children:[...(null===(s=o.configuration)||void 0===s?void 0:null===(r=s.materials)||void 0===r?void 0:r.children)||[],...c.map(e=>({label:e.label,name:e.name,htmlEntity:"formula",default:+e.default,unit:e.unit}))]}},i((0,Z.j1)(JSON.stringify(o,null,"	")))},Y=()=>{let[e,l]=(0,a.useState)(!1),[t,i]=(0,a.useState)(!1),{template:s,model:r,cursor:o,dispatch:c}=(0,a.useContext)(v.rU),d=(0,a.useCallback)(()=>l(!0),[]),m=(0,a.useCallback)(()=>l(!1),[]),h=(0,a.useCallback)(async e=>{i(!0),B(e,s,r,o,c),i(!1),l(!1)},[s,r,o,c]);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(J.ZP,{title:"Materials",visible:e,loading:t,onOk:h,onCancel:m,children:(0,n.jsx)(U.Z.List,{name:"materials",children:(e,l,t)=>{let{add:i,remove:a}=l,{errors:s}=t;return(0,n.jsx)(z,{label:"material",add:i,errors:s,children:e.map((e,l)=>(0,n.jsxs)(G,{label:"Material",field:e,index:l,remove:a,children:[(0,n.jsx)(U.Z.Item,{name:[e.name,"symbol"],label:"Physical parameter",rules:[{required:!0}],children:(0,n.jsx)(q.Z,{options:H.j.map((e,l)=>({label:e.symbol+": "+e.label,value:l}))})}),(0,n.jsx)(U.Z.Item,{name:[e.name,"default"],label:"Default",rules:[{required:!0}],children:(0,n.jsx)(L.Z,{})})]},e.key))})}})}),(0,n.jsx)(u.ZP,{className:A().fullWidth,onClick:d,children:"Materials"})]})},Q=(e,l,t,n,i)=>{var a,s,r,o,c,d;let u;if(!e.options||!e.options.length)return;ef(l,"<%# Finite element space -%>\n<%\nconst finiteElementSpace = parameters.finiteElementSpace.children[0]\nfiniteElementSpace.name = '".concat(e.name,"'\n-%>\n<%- include('/blobs/fespace.edp.ejs', {\n  mesh,\n  finiteElementSpace\n}) -%>\n"),n,i),i((0,Z.KJ)({row:((null==n?void 0:n.row)||9)+0,column:0}));try{u=JSON.parse(t)}catch(e){u={}}let m=Object.keys(u.configuration||{}).length;u.configuration={...u.configuration||{},parameters:{index:m+1,title:"Parameters",...(null===(a=u.configuration)||void 0===a?void 0:a.parameters)||{},finiteElementSpace:{advanced:!0,label:"Finite element space",...(null===(s=u.configuration)||void 0===s?void 0:null===(r=s.parameters)||void 0===r?void 0:r.finiteElementSpace)||{},children:[...(null===(o=null===(c=u.configuration)||void 0===c?void 0:null===(d=c.parameters)||void 0===d?void 0:d.finiteElementSpace)||void 0===o?void 0:o.children)||[],{label:"Finite element space label",label2D:"Finite element space label (2D)",htmlEntity:"select",options:e.options,default:e.options[0].value,default2D:e.options[0].value2D}]}}},i((0,Z.j1)(JSON.stringify(u,null,"	")))},$=()=>{let e=(0,a.useRef)(null),[l,t]=(0,a.useState)(!1),[i,s]=(0,a.useState)(!1),{template:r,model:o,cursor:c,dispatch:d}=(0,a.useContext)(v.rU);(0,a.useEffect)(()=>{e.current&&e.current.focus()});let m=(0,a.useCallback)(()=>t(!0),[]),h=(0,a.useCallback)(()=>t(!1),[]),p=(0,a.useCallback)(async e=>{s(!0),Q(e,r,o,c,d),s(!1),t(!1)},[r,o,c,d]);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(J.ZP,{title:"Finite element space",visible:l,loading:i,onOk:p,onCancel:h,children:[(0,n.jsx)(U.Z.Item,{name:"name",label:"Name",rules:[{required:!0}],children:(0,n.jsx)(L.Z,{ref:e})}),(0,n.jsx)(U.Z.List,{name:"datas",children:(e,l,t)=>{let{add:i,remove:a}=l,{errors:s}=t;return(0,n.jsx)(z,{label:"finite element space",add:i,errors:s,children:e.map((e,l)=>(0,n.jsxs)(G,{label:"Option",field:e,index:l,remove:a,children:[(0,n.jsx)(U.Z.Item,{name:[e.name,"label"],label:"Display name",rules:[{required:!0}],children:(0,n.jsx)(L.Z,{placeholder:"P1"})}),(0,n.jsx)(U.Z.Item,{name:[e.name,"value"],label:"Value",rules:[{required:!0}],children:(0,n.jsx)(L.Z,{placeholder:"[P1, P1, P1]"})}),(0,n.jsx)(U.Z.Item,{name:[e.name,"value2D"],label:"Value 2D",rules:[{required:!0}],children:(0,n.jsx)(L.Z,{placeholder:"[P1, P1]"})})]},e.key))})}})]}),(0,n.jsx)(u.ZP,{className:A().fullWidth,onClick:m,children:"Finite element space"})]})},ee=(e,l,t)=>{ef(e,"<%# Headers -%>\n<%- include('/blobs/headers.edp.ejs') -%>\n",l,t),t((0,Z.KJ)({row:((null==l?void 0:l.row)||0)+2,column:0}))},el=()=>{let{template:e,cursor:l,dispatch:t}=(0,a.useContext)(v.rU),i=(0,a.useCallback)(()=>ee(e,l,t),[e,l,t]);return(0,n.jsx)(u.ZP,{className:A().fullWidth,onClick:i,children:"Header"})},et=(e,l,t)=>{ef(e,"<%# Dimension -%>\n<%- include('/blobs/dimensioning.edp.ejs', {\n    dimension\n}) -%>\n",l,t),t((0,Z.KJ)({row:((null==l?void 0:l.row)||0)+4,column:0}))},en=()=>{let{template:e,cursor:l,dispatch:t}=(0,a.useContext)(v.rU),i=(0,a.useCallback)(()=>et(e,l,t),[e,l,t]);return(0,n.jsx)(u.ZP,{className:A().fullWidth,onClick:i,children:"Dimension"})},ei=(e,l,t,n)=>{ef(l,"<%# Finite element function -%>\n<%\nconst testFunction = dimension === 2 ? '[".concat(e.test1,", ").concat(e.test2,"]' : '[").concat(e.test1,", ").concat(e.test2,", ").concat(e.test3,"]'\nconst unknownFunction = dimension === 2 ? '[").concat(e.unknown1,", ").concat(e.unknown2,"]' : '[").concat(e.unknown1,", ").concat(e.unknown2,", ").concat(e.unknown3,"]'\n-%>\n<%- include('/blobs/fespaceFunction.edp.ejs', {\n    finiteElementSpace,\n    finiteElementFunction: testFunction\n  }) -%>\n  <%- include('/blobs/fespaceFunction.edp.ejs', {\n    finiteElementSpace,\n    finiteElementFunction: unknownFunction\n}) -%>\n"),t,n),n((0,Z.KJ)({row:((null==t?void 0:t.row)||9)+0,column:0}))},ea=()=>{let e=(0,a.useRef)(null),[l,t]=(0,a.useState)(!1),[i,s]=(0,a.useState)(!1),{template:r,cursor:o,dispatch:d}=(0,a.useContext)(v.rU);(0,a.useEffect)(()=>{e.current&&e.current.focus()});let m=(0,a.useCallback)(()=>t(!0),[]),h=(0,a.useCallback)(()=>t(!1),[]),p=(0,a.useCallback)(async e=>{s(!0),ei(e,r,o,d),s(!1),t(!1)},[r,o,d]);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(J.ZP,{title:"Finite element function",visible:l,loading:i,onOk:p,onCancel:h,children:[(0,n.jsxs)(U.Z.Item,{label:(0,n.jsx)(c.Z.Text,{strong:!0,children:"Test function"}),children:[(0,n.jsx)(U.Z.Item,{label:"First coordinate",name:"test1",children:(0,n.jsx)(L.Z,{ref:e,placeholder:"Ux"})}),(0,n.jsx)(U.Z.Item,{label:"Second coordinate",name:"test2",children:(0,n.jsx)(L.Z,{placeholder:"Uy"})}),(0,n.jsx)(U.Z.Item,{label:"Third coordinate",name:"test3",children:(0,n.jsx)(L.Z,{placeholder:"Uz"})})]}),(0,n.jsxs)(U.Z.Item,{label:(0,n.jsx)(c.Z.Text,{strong:!0,children:"Unknows function"}),children:[(0,n.jsx)(U.Z.Item,{label:"First coordinate",name:"unknown1",children:(0,n.jsx)(L.Z,{placeholder:"Uhx"})}),(0,n.jsx)(U.Z.Item,{label:"Second coordinate",name:"unknown2",children:(0,n.jsx)(L.Z,{placeholder:"Uhy"})}),(0,n.jsx)(U.Z.Item,{label:"Third coordinate",name:"unknown3",children:(0,n.jsx)(L.Z,{placeholder:"Uhz"})})]})]}),(0,n.jsx)(u.ZP,{className:A().fullWidth,onClick:m,children:"Finite element function"})]})};var es=t(32808);let er=(e,l,t,n)=>{let i=e.macros.map(e=>"'"+e+"'").join(", ");ef(l,"<%# Macro -%>\n<%- include('/blobs/macro.edp.ejs', {\n    dimension,\n    type: [".concat(i,"]\n}) -%>\n"),t,n),n((0,Z.KJ)({row:((null==t?void 0:t.row)||5)+0,column:0}))},eo=()=>{let[e,l]=(0,a.useState)(!1),[t,i]=(0,a.useState)(!1),{template:s,cursor:r,dispatch:o}=(0,a.useContext)(v.rU),c=(0,a.useCallback)(()=>l(!0),[]),d=(0,a.useCallback)(()=>l(!1),[]),m=(0,a.useCallback)(async e=>{i(!0),er(e,s,r,o),i(!1),l(!1)},[s,r,o]);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(J.ZP,{title:"Macros",visible:e,loading:t,onOk:m,onCancel:d,children:(0,n.jsx)(U.Z.Item,{label:"Type",name:"macros",children:(0,n.jsx)(es.Z.Group,{options:[{label:"Scalar gradient",value:"scalarGradient"},{label:"Vectorial divergence",value:"vectorialDivergence"},{label:"Vectorial divergence axisymmetric",value:"vectorialDivergenceRZ"},{label:"Vectorial epsilon",value:"vectorialEpsilon"},{label:"Vectorial gradient",value:"vectorialGradient"},{label:"Vectorial R divergence axisymmetric",value:"vectorialRdivergenceRZ"}],style:{display:"flex",flexDirection:"column"}})})}),(0,n.jsx)(u.ZP,{className:A().fullWidth,onClick:c,children:"Macros"})]})},ec=(e,l,t,n,i)=>{var a,s,r,o,c,d;let u;ef(l,"<%# Solver -%>\n<% const solver = parameters.solver.children[0].value ?? parameters.solver.children[0].default -%>\n<%- include('/blobs/solver.edp.ejs', {\n    solver\n}) -%>",n,i),i((0,Z.KJ)({row:((null==n?void 0:n.row)||9)+0,column:0}));try{u=JSON.parse(t)}catch(e){u={}}let m=Object.keys(u.configuration||{}).length;u.configuration={...u.configuration||{},parameters:{index:m+1,title:"Parameters",...(null===(a=u.configuration)||void 0===a?void 0:a.parameters)||{},solver:{advanced:!0,label:"Solver",...(null===(s=u.configuration)||void 0===s?void 0:null===(r=s.parameters)||void 0===r?void 0:r.solver)||{},children:[...(null===(o=null===(c=u.configuration)||void 0===c?void 0:null===(d=c.parameters)||void 0===d?void 0:d.solver)||void 0===o?void 0:o.children)||[],{label:"System resolution",htmlEntity:"select",options:e.solvers.map(e=>({label:e,value:e})),default:"MUMPS"}]}}},i((0,Z.j1)(JSON.stringify(u,null,"	")))},ed=()=>{let[e,l]=(0,a.useState)(!1),[t,i]=(0,a.useState)(!1),{template:s,model:r,cursor:o,dispatch:c}=(0,a.useContext)(v.rU),d=(0,a.useCallback)(()=>l(!0),[]),m=(0,a.useCallback)(()=>l(!1),[]),h=(0,a.useCallback)(async e=>{i(!0),ec(e,s,r,o,c),i(!1),l(!1)},[s,r,o,c]);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(J.ZP,{title:"Solver",visible:e,loading:t,onOk:h,onCancel:m,children:(0,n.jsx)(U.Z.Item,{name:"solvers",label:"Availables",children:(0,n.jsx)(es.Z.Group,{options:["UMFPCK","CG","Cholesky","Crout","GMRES","LU","sparsesolver","MUMPS"],style:{display:"flex",flexDirection:"column"}})})}),(0,n.jsx)(u.ZP,{className:A().fullWidth,onClick:d,children:"Solver"})]})},eu=e=>{var l,t,n,i,a,s,r,o;let c=null===(l=null===(t=e.scalarResults)||void 0===t?void 0:t.map(e=>"'".concat(e.variable,"'")))||void 0===l?void 0:l.join(", "),d=null===(n=null===(i=e.vectorialResults)||void 0===i?void 0:i.map(e=>"dimension === 2 ? ['".concat(e.variable1,"', '").concat(e.variable2,"', '0'] : ['").concat(e.variable1,"', '").concat(e.variable2,"', '").concat(e.variable3,"']")))||void 0===n?void 0:n.join(", "),u=null===(a=null===(s=e.scalarResults)||void 0===s?void 0:s.map(e=>1))||void 0===a?void 0:a.join(", "),m=null===(r=null===(o=e.vectorialResults)||void 0===o?void 0:o.map(e=>1))||void 0===r?void 0:r.join(", ");return{results:(c?c+", ":"")+(null!=d?d:""),order:(u?u+", ":"")+(null!=m?m:"")}},em=(e,l,t,n,i)=>{var a,s,r,o,c,d,u,m;let h;if(!e.scalarResults&&!e.vectorialResults||!(null===(a=e.scalarResults)||void 0===a?void 0:a.length)&&!(null===(s=e.vectorialResults)||void 0===s?void 0:s.length))return;let p=eu(e);ef(l,"<%# Save -%>\n<%- include('/blobs/save.edp.ejs', {\n    solution: {\n        path: run.resultPath,\n        name: '\"Result\"',\n        mesh: mesh.name,\n        sol: [".concat(p.results,"],\n        dataName: run.results.map(r => r.name),\n        order: [").concat(p.order,"]\n    }\n}) -%>\n"),n,i),i((0,Z.KJ)({row:((null==n?void 0:n.row)||4)+0,column:0}));try{h=JSON.parse(t)}catch(e){h={}}let v=Object.keys(h.configuration||{}).length;h.configuration={...h.configuration||{},run:{index:v+1,title:"Run",...null!==(m=null===(r=h.configuration)||void 0===r?void 0:r.run)&&void 0!==m?m:{},results:[...(null===(o=h.configuration)||void 0===o?void 0:null===(c=o.run)||void 0===c?void 0:c.results)||[],...(null===(d=e.scalarResults)||void 0===d?void 0:d.map(e=>({name:e.name})))||[],...(null===(u=e.vectorialResults)||void 0===u?void 0:u.map(e=>({name:e.name})))||[]]}},i((0,Z.j1)(JSON.stringify(h,null,"	")))},eh=()=>{let[e,l]=(0,a.useState)(!1),[t,i]=(0,a.useState)(!1),{template:s,model:r,cursor:o,dispatch:c}=(0,a.useContext)(v.rU),d=(0,a.useCallback)(()=>l(!0),[]),m=(0,a.useCallback)(()=>l(!1),[]),h=(0,a.useCallback)(async e=>{i(!0),em(e,s,r,o,c),i(!1),l(!1)},[s,r,o,c]);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(J.ZP,{title:"Save",visible:e,loading:t,onOk:h,onCancel:m,children:[(0,n.jsx)(U.Z.List,{name:"scalarResults",children:(e,l,t)=>{let{add:i,remove:a}=l,{errors:s}=t;return(0,n.jsx)(z,{label:"scalar result",add:i,errors:s,children:e.map((e,l)=>(0,n.jsxs)(G,{label:"Scalar result",field:e,index:l,remove:a,children:[(0,n.jsx)(U.Z.Item,{name:[e.name,"name"],label:"Display name",rules:[{required:!0}],children:(0,n.jsx)(L.Z,{})}),(0,n.jsx)(U.Z.Item,{name:[e.name,"variable"],label:"Variable name",rules:[{required:!0}],children:(0,n.jsx)(L.Z,{})})]},e.key))})}}),(0,n.jsx)(U.Z.List,{name:"vectorialResults",children:(e,l,t)=>{let{add:i,remove:a}=l,{errors:s}=t;return(0,n.jsx)(z,{label:"vectorial result",add:i,errors:s,children:e.map((e,l)=>(0,n.jsxs)(G,{label:"Vectorial result",field:e,index:l,remove:a,children:[(0,n.jsx)(U.Z.Item,{name:[e.name,"name"],label:"Display name",rules:[{required:!0}],children:(0,n.jsx)(L.Z,{})}),(0,n.jsx)(U.Z.Item,{name:[e.name,"variable1"],label:"First component variable name",rules:[{required:!0}],children:(0,n.jsx)(L.Z,{})}),(0,n.jsx)(U.Z.Item,{name:[e.name,"variable2"],label:"Second component variable name",rules:[{required:!0}],children:(0,n.jsx)(L.Z,{})}),(0,n.jsx)(U.Z.Item,{name:[e.name,"variable3"],label:"Third component variable name",rules:[{required:!0}],children:(0,n.jsx)(L.Z,{})})]},e.key))})}})]}),(0,n.jsx)(u.ZP,{className:A().fullWidth,onClick:d,children:"Save"})]})},ep=(e,l,t,n)=>{e.datas&&e.datas.length&&(ef(l,"<%- include('/blobs/data.edp.ejs', {\n    title: '".concat(e.title,"',\n    path: run.dataPath,\n    fileName: '\"iter_\"+timeIter',\n    dataNames: [").concat(e.datas.map(e=>"'".concat(e.name,"'")).join(", "),"],\n    x: '").concat(e.x,"',\n    ys: [").concat(e.datas.map(e=>"'".concat(e.y,"'")).join(", "),"]\n}) -%>"),t,n),n((0,Z.KJ)({row:((null==t?void 0:t.row)||4)+0,column:0})))},ev=()=>{let e=(0,a.useRef)(null),[l,t]=(0,a.useState)(!1),[i,s]=(0,a.useState)(!1),{template:r,cursor:o,dispatch:c}=(0,a.useContext)(v.rU);(0,a.useEffect)(()=>{e.current&&e.current.focus()});let d=(0,a.useCallback)(()=>t(!1),[]),m=(0,a.useCallback)(()=>t(!0),[]),h=(0,a.useCallback)(async e=>{s(!0),ep(e,r,o,c),s(!1),t(!1)},[r,o,c]);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(J.ZP,{title:"Data",visible:l,loading:i,onOk:h,onCancel:d,children:[(0,n.jsx)(U.Z.Item,{label:"Title",name:"title",rules:[{required:!0}],children:(0,n.jsx)(L.Z,{ref:e})}),(0,n.jsx)(U.Z.Item,{label:"X axis variable",name:"x",rules:[{required:!0}],children:(0,n.jsx)(L.Z,{})}),(0,n.jsx)(U.Z.List,{name:"datas",children:(e,l,t)=>{let{add:i,remove:a}=l,{errors:s}=t;return(0,n.jsx)(z,{label:"data",add:i,errors:s,children:e.map((e,l)=>(0,n.jsxs)(G,{label:"Data",field:e,index:l,remove:a,children:[(0,n.jsx)(U.Z.Item,{name:[e.name,"name"],label:"Display name",rules:[{required:!0}],children:(0,n.jsx)(L.Z,{})}),(0,n.jsx)(U.Z.Item,{name:[e.name,"y"],label:"Y axis variable",rules:[{required:!0}],children:(0,n.jsx)(L.Z,{})})]},e.key))})}})]}),(0,n.jsx)(u.ZP,{className:A().fullWidth,onClick:m,children:"Data"})]})},ex=(e,l,t,n)=>{ef(l,"<%# Sensors -%>\n<%- helpers.indent(include('/blobs/sensors.edp.ejs', {\n    path: run.dataPath,\n    x: '".concat(e.x,"',\n    sensors: run.sensors\n}), 2) -%>"),t,n),n((0,Z.KJ)({row:((null==t?void 0:t.row)||4)+0,column:0}))},ej=()=>{let e=(0,a.useRef)(null),[l,t]=(0,a.useState)(!1),[i,s]=(0,a.useState)(!1),{template:r,cursor:o,dispatch:c}=(0,a.useContext)(v.rU);(0,a.useEffect)(()=>{e.current&&e.current.focus()});let d=(0,a.useCallback)(()=>t(!0),[]),m=(0,a.useCallback)(()=>t(!1),[]),h=(0,a.useCallback)(async e=>{s(!0),ex(e,r,o,c),s(!1),t(!1)},[r,o,c]);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(J.ZP,{title:"Sensors",visible:l,loading:i,onOk:h,onCancel:m,children:(0,n.jsx)(U.Z.Item,{label:"X axis variable",name:"x",rules:[{required:!0}],children:(0,n.jsx)(L.Z,{ref:e})})}),(0,n.jsx)(u.ZP,{className:A().fullWidth,onClick:d,children:"Sensors"})]})},ef=(e,l,t,n)=>{if(t){let i=t.row,a=(e||"").split("\n"),s=[...a.slice(0,i+1),...l.split("\n"),...a.slice(i+1)];n((0,Z.zX)(s.join("\n")))}else n((0,Z.zX)((e||"")+l))},eb=()=>(0,n.jsx)("div",{id:"blobs",children:(0,n.jsxs)(R.Z,{style:{overflow:"auto",maxHeight:"calc(100% - 443px)"},children:[(0,n.jsx)(R.Z.Panel,{header:"Head",children:(0,n.jsxs)(d.Z,{direction:"vertical",className:A().fullWidth,children:[(0,n.jsx)(el,{}),(0,n.jsx)(en,{})]})},"head"),(0,n.jsx)(R.Z.Panel,{header:"Components",children:(0,n.jsxs)(d.Z,{direction:"vertical",className:A().fullWidth,children:[(0,n.jsx)(W,{}),(0,n.jsx)(Y,{}),(0,n.jsx)($,{}),(0,n.jsx)(ea,{}),(0,n.jsx)(eo,{}),(0,n.jsx)(ed,{})]})},"components"),(0,n.jsx)(R.Z.Panel,{header:"Results",children:(0,n.jsxs)(d.Z,{direction:"vertical",className:A().fullWidth,children:[(0,n.jsx)(eh,{}),(0,n.jsx)(ev,{}),(0,n.jsx)(ej,{})]})},"results")]})});var eg=t(43008);let ey=e=>{e((0,Z.zX)("try{\n<%# Headers -%>\n<%- include('/blobs/headers.edp.ejs') -%>\n\n<%# Dimension -%>\n<%- include('/blobs/dimensioning.edp.ejs', {\n	dimension\n}) -%>\n\n// WRITE YOUR TEMPLATE HERE\n\n} catch(...) {\n	appendError(\"An internal error occurs\");\n	exit(-1);\n}\n")),e((0,Z.j1)(JSON.stringify({category:"Category",name:"My new model",algorithm:"Algorithm",code:"FreeFEM",version:"1.0.0",description:"",configuration:{}},null,"	")+"\n"))},eZ=()=>{let{dispatch:e}=(0,a.useContext)(v.rU),l=(0,a.useCallback)(()=>ey(e),[e]);return(0,n.jsx)(m.Z,{title:"New model",children:(0,n.jsx)(u.ZP,{icon:(0,n.jsx)(eg.Z,{}),onClick:l,id:"new"})})};var eE=t(44442),ek=t(15360),ew=t(31545),eC=t(46210),eS={gmsh2D:"gmsh2D.geo.ejs",gmsh3D:"gmsh3D.geo.ejs",poisson:"poisson.edp.ejs",linearElasticity:"linearElasticity.edp.ejs",linearElasticityTime:"linearElasticityTime.edp.ejs",linearElasticityModal:"linearElasticityModal.edp.ejs",stokes:"stokes.edp.ejs",navierStokesTime:"navierStokesTime.edp.ejs",thermicDiffusion:"thermicDiffusion.edp.ejs"},eP=t(9242),eT=t(87782);let eN={delete:"Unable to delete model"},eO=async(e,l,t)=>{try{let n=e.models[l],i=e.templates[l];await f.Z.update([{key:"models",type:"array",method:"remove",value:n},{key:"templates",type:"array",method:"remove",value:i}]);let a=eT.Z.deepCopy(e);a.models=[...a.models.slice(0,l),...a.models.slice(l+1)],a.templates=[...a.templates.slice(0,l),...a.templates.slice(l+1)],t.mutateUser(a)}catch(e){throw(0,eP.lt)(eN.delete,e),e}},eI=e=>{let{user:l,index:t,swr:i}=e,s=(0,a.useCallback)(async()=>eO(l,t,i),[l,t,i]);return(0,n.jsx)(x.m1,{onDelete:s})},eM={load:"Unable to load current model"},eD=async(e,l)=>{try{l((0,Z.j1)(JSON.stringify(e,null,"	")));let t=e.algorithm,n=eS[t],i=await fetch("/templates/"+n),a=await i.text();l((0,Z.zX)(a))}catch(e){(0,eP.lt)(eM.load,e)}},eF=async(e,l,t)=>{try{e.user&&delete e.user,t((0,Z.j1)(JSON.stringify(e,null,"	"))),t((0,Z.zX)(l))}catch(e){(0,eP.lt)(eM.load,e)}},eR=e=>{let{model:l,setLoading:t,setVisible:i,dispatch:s}=e,r=(0,a.useCallback)(async()=>{t(!0);try{await eD(l,s)}finally{t(!1),i(!1)}},[l,t,i,s]);return(0,n.jsxs)("div",{className:A().displayFlex,style:{justifyContent:"space-between",alignItems:"center"},children:[l.name,(0,n.jsx)(m.Z,{title:"Open",children:(0,n.jsx)(u.ZP,{onClick:r,icon:(0,n.jsx)(ek.Z,{})})})]})},eU=e=>{let{user:l,index:t,swr:i,setLoading:s,setVisible:r,dispatch:o}=e,c=(0,a.useMemo)(()=>l.models[t],[l,t]),d=(0,a.useMemo)(()=>l.templates[t],[l,t]),h=(0,a.useCallback)(async()=>{s(!0);try{await eF(c,d,o)}finally{s(!1),r(!1)}},[c,d,s,r,o]);return(0,n.jsxs)("div",{className:A().displayFlex,style:{justifyContent:"space-between",alignItems:"center"},children:[c.name,(0,n.jsxs)("div",{children:[(0,n.jsx)(m.Z,{title:"Open",children:(0,n.jsx)(u.ZP,{onClick:h,icon:(0,n.jsx)(ek.Z,{})})}),(0,n.jsx)(eI,{user:l,index:t,swr:i})]})]})},eL=e=>{let{user:l,swr:t}=e,[i,s]=(0,a.useState)(!1),[r,o]=(0,a.useState)(!1),{dispatch:c}=(0,a.useContext)(v.rU),h=(0,a.useCallback)(()=>s(!0),[]),p=(0,a.useCallback)(()=>s(!1),[]),x=(0,a.useMemo)(()=>eC.Z.map(e=>(0,n.jsx)(eR,{model:e,setLoading:o,setVisible:s,dispatch:c},e.algorithm)),[c]),j=(0,a.useMemo)(()=>l.models.map((e,i)=>(0,n.jsx)(eU,{user:l,index:i,swr:t,setLoading:o,setVisible:s,dispatch:c},e.algorithm)),[l,t,c]);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(J.ZP,{title:"Models browser",visible:i,loading:r,onCancel:p,children:(0,n.jsx)(eE.Z,{items:[{key:"models",label:"Tanatloc models",children:(0,n.jsx)(d.Z,{direction:"vertical",className:A().fullWidth,children:x})},{key:"personalModels",label:"My models",children:(0,n.jsx)(d.Z,{direction:"vertical",className:A().fullWidth,children:j})}]})}),(0,n.jsx)(m.Z,{title:"Browse existing models",children:(0,n.jsx)(u.ZP,{icon:(0,n.jsx)(ew.Z,{}),onClick:h,id:"browser"})})]})};var eJ=t(39014),e_=t(60219);let eA={json:"Model definition is not valid",check:"Unable to check",save:"Unable to save"},eV=async(e,l,t,n)=>{let i;try{i=JSON.parse(t)}catch(e){(0,eP.lt)(eA.json,e);return}try{let t=e.models.find(e=>e.algorithm===i.algorithm);t?eJ.Z.confirm({title:"A model with the same algorithm entry already exists. Do you want to override it?",onOk:async()=>{let t=e.models.findIndex(e=>e.algorithm===i.algorithm);await eW(e,l,i,n,t)}}):await eW(e,l,i,n)}catch(e){(0,eP.lt)(eA.check,e)}},eW=async(e,l,t,n,i)=>{if(void 0===i)try{await f.Z.update([{key:"models",type:"array",method:"append",value:{...t,user:e.id}},{key:"templates",type:"array",method:"append",value:n}]);let i=eT.Z.deepCopy(e);i.models.push(t),l.mutateUser(i)}catch(e){(0,eP.lt)(eA.save,e)}else try{await f.Z.update([{key:"models",type:"array",method:"set",index:i,value:{...t,user:e.id}},{key:"templates",type:"array",method:"set",index:i,value:n}]);let a=eT.Z.deepCopy(e);a.models[i]=t,l.mutateUser(a)}catch(e){(0,eP.lt)(eA.save,e)}},eq=e=>{let{user:l,swr:t}=e,[i,s]=(0,a.useState)(!1),[r,o]=(0,a.useState)(!1),{model:c,template:d,templateValid:h,modelValid:p}=(0,a.useContext)(v.rU);(0,a.useEffect)(()=>{h&&p?s(!1):s(!0)},[h,p]);let x=(0,a.useCallback)(async()=>{o(!0),await eV(l,t,c,d),o(!1)},[l,c,d,t]);return(0,n.jsx)(m.Z,{title:"Save",children:(0,n.jsx)(u.ZP,{disabled:i,loading:r,icon:(0,n.jsx)(e_.Z,{}),onClick:x,id:"save"})})};var eH=t(5152),eK=t.n(eH);let ez=eK()(()=>Promise.all([t.e(4281),t.e(1664),t.e(9742),t.e(2679),t.e(8751)]).then(t.bind(t,68751)).catch(e=>{let l=()=>(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{children:"Unable to load FreeFEM-EJS editor"}),(0,n.jsx)("p",{children:e.message})]});return l}),{loadableGenerated:{webpack:()=>[68751]},ssr:!1}),eX=eK()(()=>Promise.all([t.e(4281),t.e(9742),t.e(8963)]).then(t.bind(t,98963)).catch(e=>{let l=()=>(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{children:"Unable to load JSON editor"}),(0,n.jsx)("p",{children:e.message})]});return l}),{loadableGenerated:{webpack:()=>[98963]},ssr:!1}),eG=()=>(0,n.jsxs)("div",{className:D().code,children:[(0,n.jsx)(ez,{}),(0,n.jsx)("div",{className:"divider"}),(0,n.jsx)(eX,{})]}),eB=[{title:"New",description:"Create your brand new script.",target:()=>document.getElementById("new")},{title:"Code browser",description:"Find one of your previous script or choose a predefined one.",target:()=>document.getElementById("browser")},{title:"Save",description:"Save your script so you can access it later.",target:()=>document.getElementById("save")},{title:"",description:"It checks if you are doing correctly. Keep an eye on these steps to make sure everything is ok.",target:()=>document.getElementById("steps")},{title:"",description:"Write your script here. You can find examples of working scripts by clicking the browse button on top of the JSON editor."},{title:"Blobs",description:"Are you struggling to write your script ? Find some predefined parts of code right here.",target:()=>document.getElementById("blobs")}],eY=()=>{let[e,l]=(0,a.useState)(),[t,b]=(0,a.useState)(!1),g=(0,i.useRouter)(),[y,{loadingUser:Z,mutateUser:E}]=f.Z.useUser();(0,a.useEffect)(()=>{Z||y||g.replace("/")},[y,Z,g]);let k=(0,a.useCallback)(()=>{b(!0)},[]),w=(0,a.useCallback)(()=>{b(!1)},[]),C=(0,a.useCallback)(()=>{g.push({pathname:"/dashboard"})},[g]);return Z||!y?(0,n.jsx)(j.Z,{}):(0,n.jsx)(v.ZP,{children:(0,n.jsxs)(s.Z,{className:D().editor,children:[(0,n.jsxs)(s.Z.Sider,{theme:"light",width:"256",children:[(0,n.jsx)("div",{className:A().logo,children:(0,n.jsx)("img",{src:"/images/logo.svg",alt:"Tanatloc"})}),(0,n.jsx)(r.Z,{mode:"inline",items:[{key:"menu-go-back",disabled:!0,style:{cursor:"unset",margin:"10px 0",paddingLeft:10},label:(0,n.jsx)(x.ks,{onClick:C,children:"Return to dashboard"})},{type:"divider"}]}),(0,n.jsx)(F,{setName:l}),(0,n.jsx)(o.Z,{}),(0,n.jsx)(eb,{})]}),(0,n.jsxs)(s.Z.Content,{className:A().noScroll,children:[(0,n.jsx)(s.Z.Header,{className:D().header,children:(0,n.jsxs)("div",{children:[(0,n.jsx)(c.Z.Text,{strong:!0,children:e}),(0,n.jsxs)(d.Z,{children:[(0,n.jsx)(u.ZP,{onClick:k,children:"Start guide"}),(0,n.jsx)(eZ,{}),(0,n.jsx)(eL,{user:{id:y.id,models:y.models,templates:y.templates},swr:{mutateUser:E}}),(0,n.jsx)(eq,{user:{id:y.id,models:y.models},swr:{mutateUser:E}}),(0,n.jsx)(m.Z,{title:"Coming soon",children:(0,n.jsx)(u.ZP,{disabled:!0,icon:(0,n.jsx)(p.Z,{})})})]})]})}),(0,n.jsx)(s.Z.Header,{className:D().header,children:(0,n.jsxs)("div",{style:{display:"flex"},children:[(0,n.jsx)("h2",{style:{width:"50%"},children:"FREEFEM EDITOR"}),(0,n.jsx)("h2",{style:{width:"50%",paddingInline:"50px"},children:"JSON EDITOR"})]})}),(0,n.jsx)(eG,{}),(0,n.jsx)(h.Z,{open:t,onClose:w,steps:eB})]})]})})},eQ=()=>(0,n.jsx)(eY,{});var e$=eQ},36294:function(e){e.exports={variables:'"@/styles/variables.css"',colorPrimary:"#fad114",editor:"editor_editor__vhC5B",header:"editor_header__EAFxp",steps:"editor_steps__8Zh42",code:"editor_code__MLS9F",tooltip:"editor_tooltip__W20v5"}}},function(e){e.O(0,[5336,7138,992,4442,5813,1577,3947,8727,3363,9014,954,9103,3822,2290,7770,266,9774,2888,179],function(){return e(e.s=59261)}),_N_E=e.O()}]);