(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4154],{59261:function(e,t,i){(window.__NEXT_P=window.__NEXT_P||[]).push(["/editor",function(){return i(93396)}])},65292:function(e,t,i){"use strict";i.d(t,{ET:function(){return m},GW:function(){return u},Gw:function(){return d},dJ:function(){return o},gc:function(){return s},j1:function(){return a},pj:function(){return p},qh:function(){return l},s6:function(){return c},zX:function(){return r}});var n=i(43367);let l=e=>({type:n.Hp.SETID,value:e}),r=e=>({type:n.Hp.SETTEMPLATE,value:e}),a=e=>({type:n.Hp.SETMODEL,value:e}),s=e=>({type:n.Hp.SETJSONHIGHLIGHT,value:e}),o=e=>({type:n.Hp.SETTEMPLATEHIGHLIGHT,value:e}),d=e=>({type:n.Hp.SETJSONCURSOR,value:e}),u=e=>({type:n.Hp.SETTEMPLATECURSOR,value:e}),c=e=>({type:n.Hp.SETJSONERROR,value:e}),p=e=>({type:n.Hp.SETTEMPLATEVALID,value:e}),m=e=>({type:n.Hp.SETMODELVALID,value:e})},43367:function(e,t,i){"use strict";i.d(t,{Hp:function(){return a},rU:function(){return s}});var n=i(85893),l=i(67294);let r={template:"",model:"",dispatch:()=>void 0,templateValid:!1,modelValid:!1},a={SETID:"SETID",SETTEMPLATE:"SETTEMPLATE",SETMODEL:"SETMODEL",SETJSONHIGHLIGHT:"SETJSONHIGHLIGHT",SETTEMPLATEHIGHLIGHT:"SETTEMPLATEHIGHLIGHT",SETJSONCURSOR:"SETJSONCURSOR",SETTEMPLATECURSOR:"SETTEMPLATECURSOR",SETJSONERROR:"SETJSONERROR",SETTEMPLATEERROR:"SETTEMPLATEERROR",SETTEMPLATEVALID:"SETTEMPLATEVALID",SETMODELVALID:"SETMODELVALID"},s=(0,l.createContext)(r),o=(e,t)=>{switch(t.type){case a.SETID:return{...e,id:t.value};case a.SETTEMPLATE:return{...e,template:t.value};case a.SETMODEL:return{...e,model:t.value};case a.SETJSONHIGHLIGHT:return{...e,jsonHighlight:t.value};case a.SETTEMPLATEHIGHLIGHT:return{...e,templateHighlight:t.value};case a.SETJSONCURSOR:return{...e,jsonCursor:t.value};case a.SETTEMPLATECURSOR:return{...e,templateCursor:t.value};case a.SETJSONERROR:return{...e,jsonError:t.value};case a.SETTEMPLATEERROR:return{...e,templateError:t.value};case a.SETTEMPLATEVALID:return{...e,templateValid:t.value};case a.SETMODELVALID:return{...e,modelValid:t.value};default:return e}};t.ZP=e=>{let{children:t}=e,[i,a]=(0,l.useReducer)(o,r),d=(0,l.useMemo)(()=>({...i,dispatch:a}),[i]);return(0,n.jsx)(s.Provider,{value:d,children:t})}},93396:function(e,t,i){"use strict";i.r(t),i.d(t,{default:function(){return e9}});var n=i(85893),l=i(67294),r=i(11163),a=i(16373),s=i(12386),o=i(74048),d=i(65400),u=i.n(d),c=i(53740),p=i(74253),m=i(94055),y=i(6847),f=i(88752),b=i(43367),v=i(64352),g=i(88053),h=i(40561),j=i(40144),x=i(91326),E=i(94704),S=i(11142),C=i.n(S),k=i(1581),w=i.n(k),I=i(65292),P=i(95590),T=JSON.parse('{"$ref":"#/definitions/IModel","$schema":"http://json-schema.org/draft-07/schema#","definitions":{"HPCClientPlugin":{"additionalProperties":false,"description":"HPC client plugin","properties":{"category":{"const":"HPC","type":"string"},"configuration":{"additionalProperties":{"additionalProperties":false,"properties":{"default":{"type":["boolean","number","string"]},"label":{"type":"string"},"options":{"items":{"type":"string"},"type":"array"},"props":{},"rules":{"items":{"additionalProperties":false,"properties":{"max":{"type":"number"},"message":{"type":"string"},"min":{"type":"number"},"required":{"type":"boolean"}},"type":"object"},"type":"array"},"secret":{"type":"boolean"},"tooltip":{"type":"string"},"type":{"enum":["input","textarea","password","select"],"type":"string"},"value":{"type":["boolean","number","string"]}},"required":["label","type"],"type":"object"},"type":"object"},"data":{"type":"object"},"description":{"type":"string"},"extra":{"additionalProperties":{"additionalProperties":false,"properties":{"action":{"type":"string"},"icon":{"type":"string"},"label":{"type":"string"},"type":{"const":"button","type":"string"}},"required":["type","label","action","icon"],"type":"object"},"type":"object"},"haveInit":{"const":true,"type":"boolean"},"inUseConfiguration":{"additionalProperties":{"additionalProperties":false,"properties":{"label":{"type":"string"},"parallelOnly":{"type":"boolean"},"value":{"type":["boolean","number","string"]}},"required":["label"],"type":"object"},"type":"object"},"key":{"type":"string"},"name":{"type":"string"},"needReInit":{"type":"boolean"},"rootDirectory":{"type":"string"},"uuid":{"type":"string"}},"required":["category","configuration","description","key","name"],"type":"object"},"IHtmlEntity":{"description":"HTML entity","enum":["formula","select","checkbox","radio"],"type":"string"},"IModel":{"additionalProperties":false,"description":"Model","properties":{"algorithm":{"type":"string"},"category":{"anyOf":[{"type":"string"},{"items":{"type":"string"},"type":"array"}]},"code":{"type":"string"},"configuration":{"additionalProperties":false,"properties":{"boundaryConditions":{"$ref":"#/definitions/IModelBoundaryConditions"},"dimension":{"type":"number"},"geometry":{"$ref":"#/definitions/IModelGeometry"},"initialization":{"$ref":"#/definitions/IModelInitialization"},"materials":{"$ref":"#/definitions/IModelMaterials"},"parameters":{"$ref":"#/definitions/IModelParameters"},"run":{"$ref":"#/definitions/IModelRun"}},"required":["geometry","parameters","boundaryConditions","run"],"type":"object"},"customFreeFEMPlugins":{"items":{"additionalProperties":false,"properties":{"file":{"type":"string"},"headers":{"items":{"type":"string"},"type":"array"},"mpi":{"type":"boolean"},"path":{"type":"string"}},"required":["path","file"],"type":"object"},"type":"array"},"description":{"type":"string"},"name":{"type":"string"},"parallel":{"type":"boolean"},"sequential":{"type":"boolean"},"userModelId":{"type":"string"},"variables":{"items":{"$ref":"#/definitions/IModelVariable"},"type":"array"},"version":{"type":"string"}},"required":["category","name","algorithm","code","version","description","configuration"],"type":"object"},"IModelBoundaryCondition":{"additionalProperties":false,"properties":{"default":{"$ref":"#/definitions/TValue"},"htmlEntity":{"$ref":"#/definitions/IHtmlEntity"},"label":{"type":"string"},"only3D":{"type":"boolean"},"unit":{"$ref":"#/definitions/IUnit"},"units":{"items":{"$ref":"#/definitions/IUnit"},"type":"array"}},"required":["label","htmlEntity","default"],"type":"object"},"IModelBoundaryConditionValue":{"additionalProperties":false,"properties":{"geometry":{"type":"string"},"labels":{"type":"string"},"name":{"type":"string"},"selected":{"items":{"additionalProperties":false,"properties":{"label":{"type":"number"},"uuid":{"type":"string"}},"required":["uuid","label"],"type":"object"},"type":"array"},"type":{"additionalProperties":false,"properties":{"children":{"items":{"$ref":"#/definitions/IModelBoundaryCondition"},"type":"array"},"key":{"type":"string"},"label":{"type":"string"}},"required":["key","label"],"type":"object"},"uuid":{"type":"string"},"values":{"items":{"additionalProperties":false,"properties":{"checked":{"type":"boolean"},"unit":{"$ref":"#/definitions/IUnit"},"value":{"$ref":"#/definitions/TValue"}},"type":"object"},"type":"array"}},"required":["uuid","name","type","geometry","selected"],"type":"object"},"IModelBoundaryConditions":{"additionalProperties":{"anyOf":[{"$ref":"#/definitions/IModelTypedBoundaryCondition"},{"not":{}},{"type":["boolean","number","string","object"]}]},"description":"Boundary conditions","properties":{"done":{"type":"boolean"},"error":{"anyOf":[{"type":"string"},{"additionalProperties":false,"properties":{"message":{"type":"string"},"name":{"type":"string"},"stack":{"type":"string"}},"required":["name","message"],"type":"object"}]},"index":{"type":"number"},"title":{"type":"string"}},"required":["index","title"],"type":"object"},"IModelGeometry":{"additionalProperties":false,"description":"Geometry","properties":{"children":{"items":{"additionalProperties":false,"properties":{"data":{"additionalProperties":false,"properties":{"file":{"type":"string"},"name":{"type":"string"},"path":{"type":"string"}},"type":"object"},"dimension":{"type":"number"},"label":{"type":"string"},"mesh":{"additionalProperties":false,"properties":{"extra":{"items":{"additionalProperties":false,"properties":{"name":{"type":"string"},"unit":{"$ref":"#/definitions/IUnit"},"units":{"items":{"$ref":"#/definitions/IUnit"},"type":"array"}},"required":["name"],"type":"object"},"type":"array"},"fileName":{"type":"string"},"geometry":{"type":"string"},"glb":{"type":"string"},"json":{"type":"string"},"name":{"type":"string"},"number":{"type":"number"},"originPath":{"type":"string"},"renderPath":{"type":"string"},"type":{"type":"string"}},"type":"object"},"meshParameters":{"anyOf":[{"$ref":"#/definitions/IModelMeshSizeManual"},{"$ref":"#/definitions/IModelMeshSizeAuto"},{"$ref":"#/definitions/IModelMeshSizeFactor"}]},"noMeshable":{"const":true,"type":"boolean"},"tag":{"type":"string"},"value":{"type":"string"}},"required":["label"],"type":"object"},"type":"array"},"done":{"type":"boolean"},"error":{"anyOf":[{"type":"string"},{"additionalProperties":false,"properties":{"message":{"type":"string"},"name":{"type":"string"},"stack":{"type":"string"}},"required":["name","message"],"type":"object"}]},"index":{"type":"number"},"title":{"type":"string"}},"required":["children","index","title"],"type":"object"},"IModelInitialization":{"additionalProperties":false,"description":"Initialization","properties":{"coupling":{"$ref":"#/definitions/IModelInitializationCoupling"},"direct":{"$ref":"#/definitions/IModelInitializationDirect"},"done":{"type":"boolean"},"error":{"anyOf":[{"type":"string"},{"additionalProperties":false,"properties":{"message":{"type":"string"},"name":{"type":"string"},"stack":{"type":"string"}},"required":["name","message"],"type":"object"}]},"index":{"type":"number"},"title":{"type":"string"},"value":{"$ref":"#/definitions/IModelInitializationValue"}},"required":["index","title"],"type":"object"},"IModelInitializationCoupling":{"additionalProperties":false,"properties":{"compatibility":{"items":{"additionalProperties":false,"properties":{"algorithm":{"type":"string"},"filter":{"additionalProperties":false,"properties":{"multiplicator":{"items":{"type":"string"},"type":"array"},"name":{"type":"string"},"pattern":{"type":"string"},"prefixPattern":{"type":"string"},"suffixPattern":{"type":"string"}},"required":["name","prefixPattern","suffixPattern","pattern"],"type":"object"},"map":{"items":{"type":"number"},"type":"array"}},"required":["algorithm","filter"],"type":"object"},"type":"array"},"label":{"type":"string"}},"required":["label","compatibility"],"type":"object"},"IModelInitializationDirect":{"additionalProperties":false,"properties":{"children":{"items":{"$ref":"#/definitions/IModelInitializationDirectChild"},"type":"array"},"label":{"type":"string"}},"required":["label","children"],"type":"object"},"IModelInitializationDirectChild":{"additionalProperties":false,"properties":{"default":{"$ref":"#/definitions/TValue"},"htmlEntity":{"$ref":"#/definitions/IHtmlEntity"},"label":{"type":"string"},"only3D":{"type":"boolean"},"options":{"items":{"additionalProperties":false,"properties":{"label":{"type":"string"},"value":{"type":"string"}},"required":["label","value"],"type":"object"},"type":"array"},"unit":{"$ref":"#/definitions/IUnit"},"units":{"items":{"$ref":"#/definitions/IUnit"},"type":"array"},"value":{"$ref":"#/definitions/TValue"}},"required":["label","htmlEntity","default"],"type":"object"},"IModelInitializationValue":{"additionalProperties":false,"properties":{"dat":{"type":"string"},"mesh":{"type":"string"},"number":{"type":"number"},"result":{"type":"string"},"simulation":{"type":"string"},"type":{"enum":["none","direct","coupling"],"type":"string"},"values":{"items":{"type":"string"},"type":"array"}},"required":["type"],"type":"object"},"IModelMaterials":{"additionalProperties":false,"description":"Materials","properties":{"children":{"items":{"$ref":"#/definitions/IModelMaterialsChild"},"type":"array"},"done":{"type":"boolean"},"error":{"anyOf":[{"type":"string"},{"additionalProperties":false,"properties":{"message":{"type":"string"},"name":{"type":"string"},"stack":{"type":"string"}},"required":["name","message"],"type":"object"}]},"index":{"type":"number"},"title":{"type":"string"},"values":{"items":{"$ref":"#/definitions/IModelMaterialsValue"},"type":"array"}},"required":["children","index","title"],"type":"object"},"IModelMaterialsChild":{"additionalProperties":false,"properties":{"default":{"type":["number","string"]},"htmlEntity":{"$ref":"#/definitions/IHtmlEntity"},"label":{"type":"string"},"name":{"type":"string"},"unit":{"$ref":"#/definitions/IUnit"},"units":{"items":{"$ref":"#/definitions/IUnit"},"type":"array"}},"required":["label","name","htmlEntity","default"],"type":"object"},"IModelMaterialsValue":{"additionalProperties":false,"properties":{"geometry":{"type":"string"},"material":{"additionalProperties":false,"properties":{"children":{"items":{"additionalProperties":false,"properties":{"label":{"type":"string"},"symbol":{"type":"string"},"unit":{"$ref":"#/definitions/IUnit"},"value":{"type":["number","string"]}},"required":["label","symbol","value"],"type":"object"},"type":"array"},"label":{"type":"string"}},"required":["label","children"],"type":"object"},"selected":{"items":{"additionalProperties":false,"properties":{"label":{"type":"number"},"uuid":{"type":"string"}},"required":["uuid","label"],"type":"object"},"type":"array"},"uuid":{"type":"string"}},"required":["uuid","material","geometry","selected"],"type":"object"},"IModelMeshRefinement":{"additionalProperties":false,"properties":{"factor":{"type":"number"},"selected":{"items":{"additionalProperties":false,"properties":{"label":{"type":["number","string"]}},"required":["label"],"type":"object"},"type":"array"},"type":{"enum":["manual","auto","factor"],"type":"string"},"value":{"type":"number"}},"required":["type","selected"],"type":"object"},"IModelMeshSizeAuto":{"additionalProperties":false,"properties":{"refinements":{"items":{"$ref":"#/definitions/IModelMeshRefinement"},"type":"array"},"type":{"const":"auto","type":"string"},"value":{"enum":["veryfine","fine","normal","coarse","verycoarse"],"type":"string"}},"required":["type","value"],"type":"object"},"IModelMeshSizeFactor":{"additionalProperties":false,"properties":{"refinements":{"items":{"$ref":"#/definitions/IModelMeshRefinement"},"type":"array"},"type":{"const":"factor","type":"string"},"value":{"type":["number","string"]}},"required":["type","value"],"type":"object"},"IModelMeshSizeManual":{"additionalProperties":false,"properties":{"refinements":{"items":{"$ref":"#/definitions/IModelMeshRefinement"},"type":"array"},"type":{"const":"manual","type":"string"},"unit":{"$ref":"#/definitions/IUnit"},"value":{"type":["number","string"]}},"required":["type","value"],"type":"object"},"IModelParameters":{"additionalProperties":{"anyOf":[{"not":{}},{"type":["boolean","number","string","object"]}]},"description":"Parameters","properties":{"done":{"type":"boolean"},"error":{"anyOf":[{"type":"string"},{"additionalProperties":false,"properties":{"message":{"type":"string"},"name":{"type":"string"},"stack":{"type":"string"}},"required":["name","message"],"type":"object"}]},"index":{"type":"number"},"title":{"type":"string"}},"required":["index","title"],"type":"object"},"IModelRun":{"additionalProperties":false,"properties":{"cloudServer":{"$ref":"#/definitions/HPCClientPlugin"},"done":{"type":"boolean"},"error":{"anyOf":[{"type":"string"},{"additionalProperties":false,"properties":{"message":{"type":"string"},"name":{"type":"string"},"stack":{"type":"string"}},"required":["name","message"],"type":"object"}]},"index":{"type":"number"},"postprocessing":{"items":{"additionalProperties":false,"properties":{"key":{"type":"string"},"parameters":{"items":{"additionalProperties":false,"properties":{"key":{"type":"string"},"options":{"items":{"type":"string"},"type":"array"},"value":{"type":"string"}},"required":["key"],"type":"object"},"type":"array"}},"required":["key"],"type":"object"},"type":"array"},"results":{"items":{"items":{"$ref":"#/definitions/IModelRunResult"},"type":"array"},"type":"array"},"resultsFilter":{"additionalProperties":false,"properties":{"multiplicator":{"items":{"type":"string"},"type":"array"},"name":{"type":"string"},"pattern":{"anyOf":[{"items":{"type":"string"},"type":"array"},{"items":{"type":"string"},"type":"array"},{"type":"string"},{"type":"string"}]},"prefixPattern":{"anyOf":[{"items":{"type":"string"},"type":"array"},{"items":{"type":"string"},"type":"array"},{"type":"string"},{"type":"string"}]},"suffixPattern":{"anyOf":[{"items":{"type":"string"},"type":"array"},{"items":{"type":"string"},"type":"array"},{"type":"string"},{"type":"string"}]}},"required":["name","prefixPattern","suffixPattern","pattern"],"type":"object"},"sensors":{"items":{"$ref":"#/definitions/IModelSensor"},"type":"array"},"title":{"type":"string"}},"required":["index","title"],"type":"object"},"IModelRunResult":{"additionalProperties":false,"description":"Run","properties":{"data":{"anyOf":[{"type":"string"},{"items":{"type":"string"},"type":"array"}]},"data2D":{"anyOf":[{"type":"string"},{"items":{"type":"string"},"type":"array"}]},"name":{"type":"string"},"unit":{"$ref":"#/definitions/IUnit"},"units":{"items":{"$ref":"#/definitions/IUnit"},"type":"array"}},"required":["name","data"],"type":"object"},"IModelSensor":{"additionalProperties":false,"properties":{"formula":{"type":"string"},"geometry":{"type":"string"},"name":{"type":"string"},"point":{"additionalProperties":false,"properties":{"x":{"type":"number"},"y":{"type":"number"},"z":{"type":"number"}},"required":["x","y","z"],"type":"object"}},"required":["name","geometry","point","formula"],"type":"object"},"IModelTypedBoundaryCondition":{"additionalProperties":false,"properties":{"children":{"items":{"$ref":"#/definitions/IModelBoundaryCondition"},"type":"array"},"label":{"type":"string"},"refineFactor":{"type":"number"},"values":{"items":{"$ref":"#/definitions/IModelBoundaryConditionValue"},"type":"array"}},"required":["label"],"type":"object"},"IModelVariable":{"additionalProperties":false,"properties":{"label":{"type":"string"},"only3D":{"type":"boolean"},"value":{"type":"string"}},"required":["label","value"],"type":"object"},"IUnit":{"additionalProperties":false,"description":"Adder should be used only in field with number only (no formula)","properties":{"adder":{"type":"number"},"label":{"type":"string"},"multiplicator":{"type":"number"}},"required":["label"],"type":"object"},"TValue":{"type":["boolean","number","string"]}}}'),M=i(22679),Z=i.n(M),O=e=>{var t,i,r,a;let{setName:s}=e,[o,d]=(0,l.useState)({}),{template:u,model:c,dispatch:p}=(0,l.useContext)(b.rU);(0,P.Z)(()=>{if(!u){d(e=>({...e,template:{status:"wait",err:""}})),p((0,I.pj)(!1));return}d(e=>({...e,template:{status:"finish"}})),p((0,I.pj)(!0))},[u],[p]),(0,P.Z)(()=>{if(!c){d(e=>({...e,model:{status:"wait"}})),p((0,I.ET)(!1));return}try{let t=new(w())({allowUnionTypes:!0}),i=t.compile(T),n=i(C().parse(c));if(n)d(e=>({...e,model:{status:"finish"}})),p((0,I.ET)(!0)),p((0,I.s6)()),s(C().parse(c).name);else{var e;let t=null===(e=i.errors)||void 0===e?void 0:e.map(e=>e.message+' in "'+(e.instancePath||"root")+'"').join(" ");d(e=>({...e,model:{status:"error",err:t}})),p((0,I.ET)(!1))}}catch(i){let e=i.lineNumber-1,t=i.columnNumber;p((0,I.s6)({title:"Syntax error",description:i.message,type:"error",row:e,column:t})),d(e=>({...e,model:{status:"error",err:i.message}})),p((0,I.ET)(!1))}},[c],[s,p]);let m=(e,t)=>{if(!(null==e?void 0:e.err))return t;let i=e.err.replace(/\./g," > ").replace(/must/g,"\n  - Must").split("\n");return(0,n.jsx)("span",{children:i})};return(0,n.jsx)("div",{id:"steps",children:(0,n.jsx)(E.Z,{className:Z().steps,direction:"vertical",items:[{title:"Check template format",status:null!==(r=null===(t=o.template)||void 0===t?void 0:t.status)&&void 0!==r?r:"wait",description:m(o.template,"EJS + FreeFEM")},{title:"Check description format",status:null!==(a=null===(i=o.model)||void 0===i?void 0:i.status)&&void 0!==a?a:"wait",description:m(o.model,"Check description format")}]})})},R=i(68469),q=i(97538),N=i(51024),D=i(51274);let U=(e,t)=>{let i=e.split("\n"),n=t.split("\n"),l=n.map((e,t)=>{if(!i.includes(e))return t}).filter(e=>e);return{begin:l[0],end:l[l.length-1]}};var L=i(35304),H=i.n(L);let G=(e,t,i,n,l)=>{var r,a,s,o,d,u,c;let p;t.includes("include('/blobs/mesh.edp.ejs'")||(eb(t,"<%# Mesh -%>\n<%\nconst mesh = geometry.mesh\nmesh.name = '".concat(e.name,"'\n-%>\n<%- include('/blobs/mesh.edp.ejs', {\n  dimension,\n  mesh\n}) -%>\n"),n,l),l((0,I.dJ)({begin:(null!==(a=null==n?void 0:n.row)&&void 0!==a?a:0)+1,end:(null!==(s=null==n?void 0:n.row)&&void 0!==s?s:0)+9})),l((0,I.GW)({row:(null!==(o=null==n?void 0:n.row)&&void 0!==o?o:0)+9,column:0})));try{p=C().parse(i)}catch(e){p={}}let m=JSON.stringify(p,null,"	"),y=Object.keys(null!==(d=p.configuration)&&void 0!==d?d:{}).length;p.configuration={...null!==(u=p.configuration)&&void 0!==u?u:{},geometry:{index:y+1,title:"Geometry",children:[{label:"Domain",mesh:{name:e.name}}],...null!==(c=null===(r=p.configuration)||void 0===r?void 0:r.geometry)&&void 0!==c?c:{}}};let f=JSON.stringify(p,null,"	"),b=U(m,f);l((0,I.gc)(b)),l((0,I.Gw)({row:b.end,column:0})),l((0,I.j1)(C().stringify(p,null,"	")))};var F=()=>{let e=(0,l.useRef)(null),[t,i]=(0,l.useState)(!1),[r,a]=(0,l.useState)(!1),{template:s,model:o,templateCursor:d,dispatch:c}=(0,l.useContext)(b.rU);(0,l.useEffect)(()=>{e.current&&e.current.focus()});let p=(0,l.useCallback)(()=>i(!0),[]),m=(0,l.useCallback)(()=>i(!1),[]),y=(0,l.useCallback)(async e=>{a(!0),G(e,s,o,d,c),a(!1),i(!1)},[s,o,d,c]);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(D.ZP,{title:"Mesh",visible:t,loading:r,onOk:y,onCancel:m,children:(0,n.jsx)(q.Z.Item,{name:"name",label:"Name",rules:[{required:!0}],children:(0,n.jsx)(N.default,{ref:e})})}),(0,n.jsx)(u(),{className:H().fullWidth,onClick:p,children:"Mesh"})]})},$=i(64749),_=i(9819),A=i(32615),z=e=>{let{children:t,label:i,errors:r,add:a}=e,s=(0,l.useCallback)(()=>a(),[a]);return(0,n.jsxs)(n.Fragment,{children:[t,(0,n.jsxs)(q.Z.Item,{children:[(0,n.jsxs)(u(),{type:"dashed",onClick:s,style:{width:"60%"},icon:(0,n.jsx)(A.default,{}),children:["Add ",i]}),(0,n.jsx)(q.Z.ErrorList,{errors:r})]})]})},J=i(12362),V=e=>{let{children:t,field:i,label:r,index:a,remove:s}=e,o=(0,l.useCallback)(()=>s(i.name),[i,s]);return(0,n.jsx)(q.Z.Item,{label:(0,n.jsxs)("div",{children:[(0,n.jsx)(J.Z,{style:{fontSize:"16px",color:"red",marginRight:"10px"},onClick:o}),r," ",a+1]}),children:t},i.key)};let W=(e,t,i,n,l)=>{var r,a,s,o,d,u,c,p,m,y;let f;if(!e.materials||!e.materials.length)return;let b=e.materials.map(e=>{let t=_.j[e.symbol],i=t.label,n=t.symbol,l=t.units,r=t.unit;return{label:i,name:n,default:e.default,units:l,unit:r}});t.includes("include('/blobs/materials.edp.ejs'")||(eb(t,"<%# Material -%>\n<%- include('/blobs/materials.edp.ejs', {\n  materials\n}) -%>\n",n,l),l((0,I.dJ)({begin:(null!==(o=null==n?void 0:n.row)&&void 0!==o?o:0)+1,end:(null!==(d=null==n?void 0:n.row)&&void 0!==d?d:0)+4})),l((0,I.GW)({row:(null!==(u=null==n?void 0:n.row)&&void 0!==u?u:0)+4,column:0})));try{f=C().parse(i)}catch(e){f={}}let v=JSON.stringify(f,null,"	"),g=Object.keys(null!==(c=f.configuration)&&void 0!==c?c:{}).length;f.configuration={...null!==(p=f.configuration)&&void 0!==p?p:{},materials:{index:g+1,title:"Materials",...null!==(m=null===(r=f.configuration)||void 0===r?void 0:r.materials)&&void 0!==m?m:{},children:[...null!==(y=null===(s=f.configuration)||void 0===s?void 0:null===(a=s.materials)||void 0===a?void 0:a.children)&&void 0!==y?y:[],...b.map(e=>({label:e.label,name:e.name,htmlEntity:"formula",default:+e.default,units:e.units,unit:e.unit}))]}};let h=JSON.stringify(f,null,"	"),j=U(v,h);l((0,I.gc)(j)),l((0,I.Gw)({row:j.end,column:0})),l((0,I.j1)(C().stringify(f,null,"	")))};var B=()=>{let[e,t]=(0,l.useState)(!1),[i,r]=(0,l.useState)(!1),{template:a,model:s,templateCursor:o,dispatch:d}=(0,l.useContext)(b.rU),c=(0,l.useCallback)(()=>t(!0),[]),p=(0,l.useCallback)(()=>t(!1),[]),m=(0,l.useCallback)(async e=>{r(!0),W(e,a,s,o,d),r(!1),t(!1)},[a,s,o,d]);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(D.ZP,{title:"Materials",visible:e,loading:i,onOk:m,onCancel:p,children:(0,n.jsx)(q.Z.List,{name:"materials",children:(e,t,i)=>{let{add:l,remove:r}=t,{errors:a}=i;return(0,n.jsx)(z,{label:"material",add:l,errors:a,children:e.map((e,t)=>(0,n.jsxs)(V,{label:"Material",field:e,index:t,remove:r,children:[(0,n.jsx)(q.Z.Item,{name:[e.name,"symbol"],label:"Physical parameter",rules:[{required:!0}],children:(0,n.jsx)($.default,{options:_.j.map((e,t)=>({label:e.symbol+": "+e.label,value:t}))})}),(0,n.jsx)(q.Z.Item,{name:[e.name,"default"],label:"Default",rules:[{required:!0}],children:(0,n.jsx)(N.default,{})})]},e.key))})}})}),(0,n.jsx)(u(),{className:H().fullWidth,onClick:c,children:"Materials"})]})};let X=(e,t,i,n,l)=>{var r,a,s,o,d,u,c,p,m,y,f,b,v,g;let h;if(!e.options||!e.options.length)return;eb(t,"<%# Finite element space -%>\n<%\nconst finiteElementSpace = parameters.finiteElementSpace.children[0]\nfiniteElementSpace.name = '".concat(e.name,"'\n-%>\n<%- include('/blobs/fespace.edp.ejs', {\n  mesh,\n  finiteElementSpace\n}) -%>\n"),n,l),l((0,I.dJ)({begin:null!==(c=null==n?void 0:n.row)&&void 0!==c?c:0,end:(null!==(p=null==n?void 0:n.row)&&void 0!==p?p:0)+9})),l((0,I.GW)({row:(null!==(m=null==n?void 0:n.row)&&void 0!==m?m:0)+9,column:0}));try{h=C().parse(i)}catch(e){h={}}let j=JSON.stringify(h,null,"	"),x=Object.keys(null!==(y=h.configuration)&&void 0!==y?y:{}).length;h.configuration={...null!==(f=h.configuration)&&void 0!==f?f:{},parameters:{index:x+1,title:"Parameters",...null!==(b=null===(r=h.configuration)||void 0===r?void 0:r.parameters)&&void 0!==b?b:{},finiteElementSpace:{advanced:!0,label:"Finite element space",...null!==(v=null===(s=h.configuration)||void 0===s?void 0:null===(a=s.parameters)||void 0===a?void 0:a.finiteElementSpace)&&void 0!==v?v:{},children:[...null!==(g=null===(o=null===(u=h.configuration)||void 0===u?void 0:null===(d=u.parameters)||void 0===d?void 0:d.finiteElementSpace)||void 0===o?void 0:o.children)&&void 0!==g?g:[],{label:"Finite element space label",label2D:"Finite element space label (2D)",htmlEntity:"select",options:e.options,default:e.options[0].value,default2D:e.options[0].value2D}]}}};let E=JSON.stringify(h,null,"	"),S=U(j,E);l((0,I.gc)(S)),l((0,I.Gw)({row:S.end,column:0})),l((0,I.j1)(C().stringify(h,null,"	")))};var Y=()=>{let e=(0,l.useRef)(null),[t,i]=(0,l.useState)(!1),[r,a]=(0,l.useState)(!1),{template:s,model:o,templateCursor:d,dispatch:c}=(0,l.useContext)(b.rU);(0,l.useEffect)(()=>{e.current&&e.current.focus()});let p=(0,l.useCallback)(()=>i(!0),[]),m=(0,l.useCallback)(()=>i(!1),[]),y=(0,l.useCallback)(async e=>{a(!0),X(e,s,o,d,c),a(!1),i(!1)},[s,o,d,c]);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(D.ZP,{title:"Finite element space",visible:t,loading:r,onOk:y,onCancel:m,children:[(0,n.jsx)(q.Z.Item,{name:"name",label:"Name",rules:[{required:!0}],children:(0,n.jsx)(N.default,{ref:e})}),(0,n.jsx)(q.Z.List,{name:"datas",children:(e,t,i)=>{let{add:l,remove:r}=t,{errors:a}=i;return(0,n.jsx)(z,{label:"finite element space",add:l,errors:a,children:e.map((e,t)=>(0,n.jsxs)(V,{label:"Option",field:e,index:t,remove:r,children:[(0,n.jsx)(q.Z.Item,{name:[e.name,"label"],label:"Display name",rules:[{required:!0}],children:(0,n.jsx)(N.default,{placeholder:"P1"})}),(0,n.jsx)(q.Z.Item,{name:[e.name,"value"],label:"Value",rules:[{required:!0}],children:(0,n.jsx)(N.default,{placeholder:"[P1, P1, P1]"})}),(0,n.jsx)(q.Z.Item,{name:[e.name,"value2D"],label:"Value 2D",rules:[{required:!0}],children:(0,n.jsx)(N.default,{placeholder:"[P1, P1]"})})]},e.key))})}})]}),(0,n.jsx)(u(),{className:H().fullWidth,onClick:p,children:"Finite element space"})]})};let K=(e,t,i)=>{var n,l,r;eb(e,"<%# Headers -%>\n<%- include('/blobs/headers.edp.ejs') -%>\n",t,i),i((0,I.dJ)({begin:(null!==(n=null==t?void 0:t.row)&&void 0!==n?n:0)+1,end:(null!==(l=null==t?void 0:t.row)&&void 0!==l?l:0)+2})),i((0,I.GW)({row:(null!==(r=null==t?void 0:t.row)&&void 0!==r?r:0)+2,column:0}))};var Q=()=>{let{template:e,templateCursor:t,dispatch:i}=(0,l.useContext)(b.rU),r=(0,l.useCallback)(()=>K(e,t,i),[e,t,i]);return(0,n.jsx)(u(),{className:H().fullWidth,onClick:r,children:"Header"})};let ee=(e,t,i)=>{var n,l,r;eb(e,"<%# Dimension -%>\n<%- include('/blobs/dimensioning.edp.ejs', {\n    dimension\n}) -%>\n",t,i),i((0,I.dJ)({begin:null!==(n=null==t?void 0:t.row)&&void 0!==n?n:0,end:(null!==(l=null==t?void 0:t.row)&&void 0!==l?l:0)+4})),i((0,I.GW)({row:(null!==(r=null==t?void 0:t.row)&&void 0!==r?r:0)+4,column:0}))};var et=()=>{let{template:e,templateCursor:t,dispatch:i}=(0,l.useContext)(b.rU),r=(0,l.useCallback)(()=>ee(e,t,i),[e,t,i]);return(0,n.jsx)(u(),{className:H().fullWidth,onClick:r,children:"Dimension"})};let ei=(e,t,i,n)=>{var l,r,a;eb(t,"<%# Finite element function -%>\n<%\nconst testFunction = dimension === 2 ? '[".concat(e.test1,", ").concat(e.test2,"]' : '[").concat(e.test1,", ").concat(e.test2,", ").concat(e.test3,"]'\nconst unknownFunction = dimension === 2 ? '[").concat(e.unknown1,", ").concat(e.unknown2,"]' : '[").concat(e.unknown1,", ").concat(e.unknown2,", ").concat(e.unknown3,"]'\n-%>\n<%- include('/blobs/fespaceFunction.edp.ejs', {\n    finiteElementSpace,\n    finiteElementFunction: testFunction\n  }) -%>\n  <%- include('/blobs/fespaceFunction.edp.ejs', {\n    finiteElementSpace,\n    finiteElementFunction: unknownFunction\n}) -%>\n"),i,n),n((0,I.dJ)({begin:null!==(l=null==i?void 0:i.row)&&void 0!==l?l:0,end:(null!==(r=null==i?void 0:i.row)&&void 0!==r?r:0)+13})),n((0,I.GW)({row:(null!==(a=null==i?void 0:i.row)&&void 0!==a?a:0)+13,column:0}))};var en=()=>{let e=(0,l.useRef)(null),[t,i]=(0,l.useState)(!1),[r,a]=(0,l.useState)(!1),{template:s,templateCursor:o,dispatch:d}=(0,l.useContext)(b.rU);(0,l.useEffect)(()=>{e.current&&e.current.focus()});let p=(0,l.useCallback)(()=>i(!0),[]),m=(0,l.useCallback)(()=>i(!1),[]),y=(0,l.useCallback)(async e=>{a(!0),ei(e,s,o,d),a(!1),i(!1)},[s,o,d]);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(D.ZP,{title:"Finite element function",visible:t,loading:r,onOk:y,onCancel:m,children:[(0,n.jsxs)(q.Z.Item,{label:(0,n.jsx)(c.Z.Text,{strong:!0,children:"Test function"}),children:[(0,n.jsx)(q.Z.Item,{label:"First coordinate",name:"test1",children:(0,n.jsx)(N.default,{ref:e,placeholder:"Ux"})}),(0,n.jsx)(q.Z.Item,{label:"Second coordinate",name:"test2",children:(0,n.jsx)(N.default,{placeholder:"Uy"})}),(0,n.jsx)(q.Z.Item,{label:"Third coordinate",name:"test3",children:(0,n.jsx)(N.default,{placeholder:"Uz"})})]}),(0,n.jsxs)(q.Z.Item,{label:(0,n.jsx)(c.Z.Text,{strong:!0,children:"Unknows function"}),children:[(0,n.jsx)(q.Z.Item,{label:"First coordinate",name:"unknown1",children:(0,n.jsx)(N.default,{placeholder:"Uhx"})}),(0,n.jsx)(q.Z.Item,{label:"Second coordinate",name:"unknown2",children:(0,n.jsx)(N.default,{placeholder:"Uhy"})}),(0,n.jsx)(q.Z.Item,{label:"Third coordinate",name:"unknown3",children:(0,n.jsx)(N.default,{placeholder:"Uhz"})})]})]}),(0,n.jsx)(u(),{className:H().fullWidth,onClick:p,children:"Finite element function"})]})},el=i(31059);let er=(e,t,i,n)=>{var l,r,a;let s=e.macros.map(e=>"'"+e+"'").join(", ");eb(t,"<%# Macro -%>\n<%- include('/blobs/macro.edp.ejs', {\n    dimension,\n    type: [".concat(s,"]\n}) -%>\n"),i,n),n((0,I.dJ)({begin:(null!==(l=null==i?void 0:i.row)&&void 0!==l?l:0)+1,end:(null!==(r=null==i?void 0:i.row)&&void 0!==r?r:0)+5})),n((0,I.GW)({row:(null!==(a=null==i?void 0:i.row)&&void 0!==a?a:0)+5,column:0}))};var ea=()=>{let[e,t]=(0,l.useState)(!1),[i,r]=(0,l.useState)(!1),{template:a,templateCursor:s,dispatch:o}=(0,l.useContext)(b.rU),d=(0,l.useCallback)(()=>t(!0),[]),c=(0,l.useCallback)(()=>t(!1),[]),p=(0,l.useCallback)(async e=>{r(!0),er(e,a,s,o),r(!1),t(!1)},[a,s,o]);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(D.ZP,{title:"Macros",visible:e,loading:i,onOk:p,onCancel:c,children:(0,n.jsx)(q.Z.Item,{label:"Type",name:"macros",children:(0,n.jsx)(el.default.Group,{options:[{label:"Scalar gradient",value:"scalarGradient"},{label:"Vectorial divergence",value:"vectorialDivergence"},{label:"Vectorial divergence axisymmetric",value:"vectorialDivergenceRZ"},{label:"Vectorial epsilon",value:"vectorialEpsilon"},{label:"Vectorial gradient",value:"vectorialGradient"},{label:"Vectorial R divergence axisymmetric",value:"vectorialRdivergenceRZ"}],style:{display:"flex",flexDirection:"column"}})})}),(0,n.jsx)(u(),{className:H().fullWidth,onClick:d,children:"Macros"})]})};let es=(e,t,i,n,l)=>{var r,a,s,o,d,u,c,p,m,y,f,b,v,g;let h;eb(t,"<%# Solver -%>\n<% const solver = parameters.solver.children[0].value ?? parameters.solver.children[0].default -%>\n<%- include('/blobs/solver.edp.ejs', {\n    solver\n}) -%>",n,l),l((0,I.dJ)({begin:(null!==(c=null==n?void 0:n.row)&&void 0!==c?c:0)+1,end:(null!==(p=null==n?void 0:n.row)&&void 0!==p?p:0)+5})),l((0,I.GW)({row:(null!==(m=null==n?void 0:n.row)&&void 0!==m?m:0)+5,column:0}));try{h=C().parse(i)}catch(e){h={}}let j=JSON.stringify(h,null,"	"),x=Object.keys(null!==(y=h.configuration)&&void 0!==y?y:{}).length;h.configuration={...null!==(f=h.configuration)&&void 0!==f?f:{},parameters:{index:x+1,title:"Parameters",...null!==(b=null===(r=h.configuration)||void 0===r?void 0:r.parameters)&&void 0!==b?b:{},solver:{advanced:!0,label:"Solver",...null!==(v=null===(s=h.configuration)||void 0===s?void 0:null===(a=s.parameters)||void 0===a?void 0:a.solver)&&void 0!==v?v:{},children:[...null!==(g=null===(o=null===(u=h.configuration)||void 0===u?void 0:null===(d=u.parameters)||void 0===d?void 0:d.solver)||void 0===o?void 0:o.children)&&void 0!==g?g:[],{label:"System resolution",htmlEntity:"select",options:e.solvers.map(e=>({label:e,value:e})),default:"MUMPS"}]}}};let E=JSON.stringify(h,null,"	"),S=U(j,E);l((0,I.gc)(S)),l((0,I.Gw)({row:S.end,column:0})),l((0,I.j1)(C().stringify(h,null,"	")))};var eo=()=>{let[e,t]=(0,l.useState)(!1),[i,r]=(0,l.useState)(!1),{template:a,model:s,templateCursor:o,dispatch:d}=(0,l.useContext)(b.rU),c=(0,l.useCallback)(()=>t(!0),[]),p=(0,l.useCallback)(()=>t(!1),[]),m=(0,l.useCallback)(async e=>{r(!0),es(e,a,s,o,d),r(!1),t(!1)},[a,s,o,d]);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(D.ZP,{title:"Solver",visible:e,loading:i,onOk:m,onCancel:p,children:(0,n.jsx)(q.Z.Item,{name:"solvers",label:"Availables",children:(0,n.jsx)(el.default.Group,{options:["UMFPCK","CG","Cholesky","Crout","GMRES","LU","sparsesolver","MUMPS"],style:{display:"flex",flexDirection:"column"}})})}),(0,n.jsx)(u(),{className:H().fullWidth,onClick:c,children:"Solver"})]})};let ed=e=>{var t,i,n,l,r,a,s,o;let d=null===(i=e.scalarResults)||void 0===i?void 0:null===(t=i.map(e=>"'".concat(e.variable,"'")))||void 0===t?void 0:t.join(", "),u=null===(l=e.vectorialResults)||void 0===l?void 0:null===(n=l.map(e=>"dimension === 2 ? ['".concat(e.variable1,"', '").concat(e.variable2,"', '0'] : ['").concat(e.variable1,"', '").concat(e.variable2,"', '").concat(e.variable3,"']")))||void 0===n?void 0:n.join(", "),c=null===(a=e.scalarResults)||void 0===a?void 0:null===(r=a.map(e=>1))||void 0===r?void 0:r.join(", "),p=null===(o=e.vectorialResults)||void 0===o?void 0:null===(s=o.map(e=>1))||void 0===s?void 0:s.join(", ");return{results:(d?d+", ":"")+(null!=u?u:""),order:(c?c+", ":"")+(null!=p?p:"")}},eu=(e,t,i,n,l)=>{var r,a,s,o,d,u,c,p,m,y,f,b,v,g,h,j;let x;if(!e.scalarResults&&!e.vectorialResults||!(null===(r=e.scalarResults)||void 0===r?void 0:r.length)&&!(null===(a=e.vectorialResults)||void 0===a?void 0:a.length))return;let E=ed(e);eb(t,"<%# Save -%>\n<%- include('/blobs/save.edp.ejs', {\n    solution: {\n        path: run.resultPath,\n        name: '\"Result\"',\n        mesh: mesh.name,\n        sol: [".concat(E.results,"],\n        dataName: run.results.map(r => r.name),\n        order: [").concat(E.order,"]\n    }\n}) -%>\n"),n,l),l((0,I.dJ)({begin:(null!==(p=null==n?void 0:n.row)&&void 0!==p?p:0)+1,end:(null!==(m=null==n?void 0:n.row)&&void 0!==m?m:0)+11})),l((0,I.GW)({row:(null!==(y=null==n?void 0:n.row)&&void 0!==y?y:0)+11,column:0}));try{x=C().parse(i)}catch(e){x={}}let S=JSON.stringify(x,null,"	"),k=Object.keys(null!==(f=x.configuration)&&void 0!==f?f:{}).length;x.configuration={...null!==(b=x.configuration)&&void 0!==b?b:{},run:{index:k+1,title:"Run",...null!==(v=null===(s=x.configuration)||void 0===s?void 0:s.run)&&void 0!==v?v:{},results:[...null!==(g=null===(d=x.configuration)||void 0===d?void 0:null===(o=d.run)||void 0===o?void 0:o.results)&&void 0!==g?g:[],...null!==(h=null===(u=e.scalarResults)||void 0===u?void 0:u.map(e=>({name:e.name})))&&void 0!==h?h:[],...null!==(j=null===(c=e.vectorialResults)||void 0===c?void 0:c.map(e=>({name:e.name})))&&void 0!==j?j:[]]}};let w=JSON.stringify(x,null,"	"),P=U(S,w);l((0,I.gc)(P)),l((0,I.Gw)({row:P.end,column:0})),l((0,I.j1)(C().stringify(x,null,"	")))};var ec=()=>{let[e,t]=(0,l.useState)(!1),[i,r]=(0,l.useState)(!1),{template:a,model:s,templateCursor:o,dispatch:d}=(0,l.useContext)(b.rU),c=(0,l.useCallback)(()=>t(!0),[]),p=(0,l.useCallback)(()=>t(!1),[]),m=(0,l.useCallback)(async e=>{r(!0),eu(e,a,s,o,d),r(!1),t(!1)},[a,s,o,d]);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(D.ZP,{title:"Save",visible:e,loading:i,onOk:m,onCancel:p,children:[(0,n.jsx)(q.Z.List,{name:"scalarResults",children:(e,t,i)=>{let{add:l,remove:r}=t,{errors:a}=i;return(0,n.jsx)(z,{label:"scalar result",add:l,errors:a,children:e.map((e,t)=>(0,n.jsxs)(V,{label:"Scalar result",field:e,index:t,remove:r,children:[(0,n.jsx)(q.Z.Item,{name:[e.name,"name"],label:"Display name",rules:[{required:!0}],children:(0,n.jsx)(N.default,{})}),(0,n.jsx)(q.Z.Item,{name:[e.name,"variable"],label:"Variable name",rules:[{required:!0}],children:(0,n.jsx)(N.default,{})})]},e.key))})}}),(0,n.jsx)(q.Z.List,{name:"vectorialResults",children:(e,t,i)=>{let{add:l,remove:r}=t,{errors:a}=i;return(0,n.jsx)(z,{label:"vectorial result",add:l,errors:a,children:e.map((e,t)=>(0,n.jsxs)(V,{label:"Vectorial result",field:e,index:t,remove:r,children:[(0,n.jsx)(q.Z.Item,{name:[e.name,"name"],label:"Display name",rules:[{required:!0}],children:(0,n.jsx)(N.default,{})}),(0,n.jsx)(q.Z.Item,{name:[e.name,"variable1"],label:"First component variable name",rules:[{required:!0}],children:(0,n.jsx)(N.default,{})}),(0,n.jsx)(q.Z.Item,{name:[e.name,"variable2"],label:"Second component variable name",rules:[{required:!0}],children:(0,n.jsx)(N.default,{})}),(0,n.jsx)(q.Z.Item,{name:[e.name,"variable3"],label:"Third component variable name",rules:[{required:!0}],children:(0,n.jsx)(N.default,{})})]},e.key))})}})]}),(0,n.jsx)(u(),{className:H().fullWidth,onClick:c,children:"Save"})]})};let ep=(e,t,i,n)=>{var l,r,a;e.datas&&e.datas.length&&(eb(t,"<%- include('/blobs/data.edp.ejs', {\n    title: '".concat(e.title,"',\n    path: run.dataPath,\n    fileName: '\"iter_\"+timeIter',\n    dataNames: [").concat(e.datas.map(e=>"'".concat(e.name,"'")).join(", "),"],\n    x: '").concat(e.x,"',\n    ys: [").concat(e.datas.map(e=>"'".concat(e.y,"'")).join(", "),"]\n}) -%>"),i,n),n((0,I.dJ)({begin:null!==(l=null==i?void 0:i.row)&&void 0!==l?l:0,end:(null!==(r=null==i?void 0:i.row)&&void 0!==r?r:0)+8})),n((0,I.GW)({row:(null!==(a=null==i?void 0:i.row)&&void 0!==a?a:0)+8,column:0})))};var em=()=>{let e=(0,l.useRef)(null),[t,i]=(0,l.useState)(!1),[r,a]=(0,l.useState)(!1),{template:s,templateCursor:o,dispatch:d}=(0,l.useContext)(b.rU);(0,l.useEffect)(()=>{e.current&&e.current.focus()});let c=(0,l.useCallback)(()=>i(!1),[]),p=(0,l.useCallback)(()=>i(!0),[]),m=(0,l.useCallback)(async e=>{a(!0),ep(e,s,o,d),a(!1),i(!1)},[s,o,d]);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(D.ZP,{title:"Data",visible:t,loading:r,onOk:m,onCancel:c,children:[(0,n.jsx)(q.Z.Item,{label:"Title",name:"title",rules:[{required:!0}],children:(0,n.jsx)(N.default,{ref:e})}),(0,n.jsx)(q.Z.Item,{label:"X axis variable",name:"x",rules:[{required:!0}],children:(0,n.jsx)(N.default,{})}),(0,n.jsx)(q.Z.List,{name:"datas",children:(e,t,i)=>{let{add:l,remove:r}=t,{errors:a}=i;return(0,n.jsx)(z,{label:"data",add:l,errors:a,children:e.map((e,t)=>(0,n.jsxs)(V,{label:"Data",field:e,index:t,remove:r,children:[(0,n.jsx)(q.Z.Item,{name:[e.name,"name"],label:"Display name",rules:[{required:!0}],children:(0,n.jsx)(N.default,{})}),(0,n.jsx)(q.Z.Item,{name:[e.name,"y"],label:"Y axis variable",rules:[{required:!0}],children:(0,n.jsx)(N.default,{})})]},e.key))})}})]}),(0,n.jsx)(u(),{className:H().fullWidth,onClick:p,children:"Data"})]})};let ey=(e,t,i,n)=>{var l,r,a;eb(t,"<%# Sensors -%>\n<%- helpers.indent(include('/blobs/sensors.edp.ejs', {\n    path: run.dataPath,\n    x: '".concat(e.x,"',\n    sensors: run.sensors\n}), 2) -%>"),i,n),n((0,I.dJ)({begin:(null!==(l=null==i?void 0:i.row)&&void 0!==l?l:0)+1,end:(null!==(r=null==i?void 0:i.row)&&void 0!==r?r:0)+6})),n((0,I.GW)({row:(null!==(a=null==i?void 0:i.row)&&void 0!==a?a:0)+6,column:0}))};var ef=()=>{let e=(0,l.useRef)(null),[t,i]=(0,l.useState)(!1),[r,a]=(0,l.useState)(!1),{template:s,templateCursor:o,dispatch:d}=(0,l.useContext)(b.rU);(0,l.useEffect)(()=>{e.current&&e.current.focus()});let c=(0,l.useCallback)(()=>i(!0),[]),p=(0,l.useCallback)(()=>i(!1),[]),m=(0,l.useCallback)(async e=>{a(!0),ey(e,s,o,d),a(!1),i(!1)},[s,o,d]);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(D.ZP,{title:"Sensors",visible:t,loading:r,onOk:m,onCancel:p,children:(0,n.jsx)(q.Z.Item,{label:"X axis variable",name:"x",rules:[{required:!0}],children:(0,n.jsx)(N.default,{ref:e})})}),(0,n.jsx)(u(),{className:H().fullWidth,onClick:c,children:"Sensors"})]})};let eb=(e,t,i,n)=>{if(i){let l=i.row,r=e.split("\n"),a=[...r.slice(0,l+1),...t.split("\n"),...r.slice(l+1)];n((0,I.zX)(a.join("\n")))}else n((0,I.zX)(e+t))};var ev=()=>(0,n.jsx)("div",{id:"blobs",children:(0,n.jsx)(R.Z,{style:{overflow:"auto",maxHeight:"calc(100% - 443px)"},items:[{key:"head",label:"Head",children:(0,n.jsxs)(o.default,{direction:"vertical",className:H().fullWidth,children:[(0,n.jsx)(Q,{}),(0,n.jsx)(et,{})]})},{key:"components",label:"Components",children:(0,n.jsxs)(o.default,{direction:"vertical",className:H().fullWidth,children:[(0,n.jsx)(F,{}),(0,n.jsx)(B,{}),(0,n.jsx)(Y,{}),(0,n.jsx)(en,{}),(0,n.jsx)(ea,{}),(0,n.jsx)(eo,{})]})},{key:"results",label:"Results",children:(0,n.jsxs)(o.default,{direction:"vertical",className:H().fullWidth,children:[(0,n.jsx)(ec,{}),(0,n.jsx)(em,{}),(0,n.jsx)(ef,{})]})}]})}),eg=i(21632),eh=i(56697);let ej=e=>{e((0,I.zX)("try{\n<%# Headers -%>\n<%- include('/blobs/headers.edp.ejs') -%>\n\n<%# Dimension -%>\n<%- include('/blobs/dimensioning.edp.ejs', {\n	dimension\n}) -%>\n\n// WRITE YOUR TEMPLATE HERE\n\n} catch(...) {\n	appendError(\"An internal error occurs\");\n	exit(-1);\n}\n")),e((0,I.j1)(C().stringify({category:"Category",name:"My new model",algorithm:"Algorithm",code:"FreeFEM",version:"1.0.0",description:"",configuration:{}},null,"	")+"\n"))};var ex=()=>{let{dispatch:e}=(0,l.useContext)(b.rU),t=(0,l.useCallback)(()=>{eh.Z.confirm({title:"Your modifications will be lost. Do you want to continue?",onOk:()=>ej(e)})},[e]);return(0,n.jsx)(m.default,{title:"New model",children:(0,n.jsx)(u(),{icon:(0,n.jsx)(eg.Z,{}),onClick:t,id:"new"})})},eE=i(65132),eS=i(8061),eC=i(54509),ek={gmsh2D:"gmsh2D.geo.ejs",gmsh3D:"gmsh3D.geo.ejs",poisson:"poisson.edp.ejs",linearElasticity:"linearElasticity.edp.ejs",linearElasticityTime:"linearElasticityTime.edp.ejs",linearElasticityModal:"linearElasticityModal.edp.ejs",stokes:"stokes.edp.ejs",stokesTime:"stokesTime.edp.ejs",navierStokesTime:"navierStokesTime.edp.ejs",thermicDiffusion:"thermicDiffusion.edp.ejs",magnetostatic:"magnetostatic.edp.ejs",magnetostatic2Bodies:"magnetostatic2Bodies.edp.ejs"},ew=i(15753),eI=i(2524),eP=i(97221);let eT={load:"Unable to load current model",delete:"Unable to delete model"},eM=async(e,t,i,n)=>{try{let n=e.usermodels[t];await eI.Z.del({id:n.id});let l=eP.Z.deepCopy(e);l.usermodels=[...l.usermodels.slice(0,t),...l.usermodels.slice(t+1)],await i.mutateUser(l)}catch(e){n((0,eC.iT)({title:eT.delete,err:e}))}};var eZ=e=>{let{user:t,swr:i}=e,[r,a]=(0,l.useState)(!1),{dispatch:s}=(0,l.useContext)(b.rU),{dispatch:o}=(0,l.useContext)(eS.uj),d=(0,l.useCallback)(()=>a(!0),[]),c=(0,l.useCallback)(()=>a(!1),[]),p=(0,l.useCallback)(async e=>{try{if(e.id)delete e.model.userModelId;else{let t=ek[e.model.algorithm],i=await fetch("/templates/"+t),n=await i.text();e.template=n}s((0,I.qh)(e.id)),s((0,I.j1)(C().stringify(e.model,null,"	"))),s((0,I.zX)(e.template)),a(!1)}catch(e){o((0,eC.iT)({title:eT.load,err:e}))}},[s,o]),y=(0,l.useCallback)(async e=>{await eM(t,e,i,o)},[t,i,o]);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(ew.ZP.Selector,{visible:r,user:{...t,authorizedplugins:[]},title:"Choose simulation",okText:"Choose",onCancel:c,onOk:p,onDelete:y}),(0,n.jsx)(m.default,{title:"Browse existing models",children:(0,n.jsx)(u(),{icon:(0,n.jsx)(eE.Z,{}),onClick:d,id:"browser"})})]})},eO=i(51942);let eR={json:"Model definition is not valid",check:"Unable to check",save:"Unable to save"},eq=async(e,t,i,n,l,r)=>{let a;try{a=C().parse(i)}catch(e){r((0,eC.iT)({title:eR.json,err:e}));return}try{let i=e.usermodels.find(e=>e.model.algorithm===a.algorithm);i?i.owners.find(t=>t.id===e.id)?eh.Z.confirm({title:"A model with the same algorithm entry already exists. Do you want to override it?",onOk:async()=>{await eN(e,t,{id:i.id,model:a,template:n},l,r)}}):eh.Z.confirm({title:"You are not the owner of this algoirhtm. Do you want to create a new one in your account?",onOk:async()=>{await eN(e,t,{id:"0",model:a,template:n},l,r)}}):await eN(e,t,{id:"0",model:a,template:n},l,r)}catch(e){r((0,eC.iT)({title:eR.check,err:e}))}},eN=async(e,t,i,n,l)=>{if("0"===i.id)try{let l=await eI.Z.add({model:i.model,template:i.template});n((0,I.qh)(l.id));let r=eP.Z.deepCopy(e);r.usermodels.push({...l,owners:[e],groups:[],users:[]}),await t.mutateUser(r)}catch(e){l((0,eC.iT)({title:eR.save,err:e}))}else try{await eI.Z.update({id:i.id},[{key:"model",value:i.model},{key:"template",value:i.template}]);let n=eP.Z.deepCopy(e),l=n.usermodels.findIndex(e=>e.id===i.id);n.usermodels[l]={...n.usermodels[l],model:i.model,template:i.template},await t.mutateUser(n)}catch(e){l((0,eC.iT)({title:eR.save,err:e}))}};var eD=e=>{let{user:t,swr:i}=e,[r,a]=(0,l.useState)(!1),[s,o]=(0,l.useState)(!1),{model:d,template:c,templateValid:p,modelValid:y,dispatch:f}=(0,l.useContext)(b.rU),{dispatch:g}=(0,l.useContext)(eS.uj);(0,l.useEffect)(()=>{p&&y?a(!1):a(!0)},[p,y]);let h=(0,l.useCallback)(()=>{(0,v.u)(async()=>{o(!0),await eq(t,i,d,c,f,g),o(!1)})},[t,d,c,i,f,g]);return(0,n.jsx)(m.default,{title:"Save",children:(0,n.jsx)(u(),{disabled:r,loading:s,icon:(0,n.jsx)(eO.Z,{}),onClick:h,id:"save"})})},eU=i(5152),eL=i.n(eU),eH=i(85317),eG=i(91724),eF=i(3157),e$=i.n(eF);let e_=e=>{let{onMove:t,onDoubleClick:i}=e,[r,a]=(0,l.useState)(!1),s=(0,l.useCallback)(()=>{a(!0)},[]),o=(0,l.useCallback)(e=>{r&&(e.preventDefault(),t(e.clientX))},[r,t]),d=(0,l.useCallback)(()=>{a(!1)},[]);return(0,l.useEffect)(()=>(window.addEventListener("mousemove",o),window.addEventListener("mouseup",d),()=>{window.removeEventListener("mousemove",o),window.removeEventListener("mouseup",d)})),(0,n.jsxs)("button",{role:"Divider",className:e$().divider,onMouseDown:s,onDoubleClick:i,children:[(0,n.jsx)("div",{className:"circle"}),(0,n.jsx)(eH.Z,{className:"arrowLeft",style:{fontSize:20,fontWeight:"bold"}}),(0,n.jsx)(eG.Z,{className:"arrowRight",style:{fontSize:20,fontWeight:"bold"}})]})};var eA=e=>{let{className:t,leftChild:i,rightChild:r}=e,a=(0,l.useRef)(null),[s,o]=(0,l.useState)(),[d,u]=(0,l.useState)(),[c,p]=(0,l.useState)(),m=(0,l.useCallback)(()=>{if(!a.current)return;let e=a.current.getBoundingClientRect();o({left:e.left,width:e.width}),u((e.width-5)/2),p((e.width-5)/2)},[]),y=(0,l.useCallback)(e=>{if(!a.current||!s)return;let t=e-s.left,i=s.width-e+s.left;i<50?(i=0,t=s.width-5):t<50&&(t=0,i=s.width-5),u(t),p(i)},[s]);return(0,l.useEffect)(()=>(window.addEventListener("resize",m),setTimeout(m,500),()=>{window.removeEventListener("resize",m)}),[m]),(0,n.jsxs)("div",{ref:a,className:"".concat(e$().container," ").concat(null!=t?t:""),children:[(0,n.jsx)("div",{style:{width:d},children:i}),(0,n.jsx)(e_,{onMove:y,onDoubleClick:m}),(0,n.jsx)("div",{style:{width:c},children:r})]})};let ez=eL()(()=>Promise.all([i.e(4281),i.e(3022),i.e(2679),i.e(8333)]).then(i.bind(i,98333)).catch(e=>()=>(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{children:"Unable to load FreeFEM-EJS editor"}),(0,n.jsx)("p",{children:e.message})]})),{loadableGenerated:{webpack:()=>[98333]},ssr:!1}),eJ=eL()(()=>Promise.all([i.e(4281),i.e(3022),i.e(6785)]).then(i.bind(i,16785)).catch(e=>()=>(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{children:"Unable to load JSON editor"}),(0,n.jsx)("p",{children:e.message})]})),{loadableGenerated:{webpack:()=>[16785]},ssr:!1});var eV=()=>(0,n.jsx)(eA,{className:Z().code,leftChild:(0,n.jsx)(ez,{}),rightChild:(0,n.jsx)(eJ,{})}),eW=i(59134),eB=i.n(eW),eX=i(17072),eY=e=>{let{user:t,organizations:i,swr:r}=e,[a,s]=(0,l.useState)(!0),[o,d]=(0,l.useState)(!0),[u,c]=(0,l.useState)(),{id:p}=(0,l.useContext)(b.rU);return((0,l.useEffect)(()=>{eB()()?s(!1):s(!0)},[]),(0,l.useEffect)(()=>{let e=t.usermodels.find(e=>e.id===p);(null==e?void 0:e.owners.find(e=>e.id===t.id))?d(!1):d(!0),c(e)},[t,p]),a)?(0,n.jsx)(eX.ZP,{disabled:o,userModel:u,organizations:i,swr:r,style:{buttonBordered:!0}}):(0,n.jsx)(n.Fragment,{})},eK=i(40987),eQ=i(39888),e0=i(10708),e1=()=>{let[e,t]=(0,l.useState)(!0),[i,r]=(0,l.useState)(!0),[a,s]=(0,e0.Z)(["accepted"]),{model:o,template:d,dispatch:c}=(0,l.useContext)(b.rU);(0,l.useEffect)(()=>{if(a.accepted){if(t(!1),i){let e=setInterval(()=>{sessionStorage.setItem("model",o),sessionStorage.setItem("template",d)},3e4);return()=>clearInterval(e)}}else t(!0)},[a.accepted,i,o,d,s]);let p=(0,l.useCallback)(e=>{r(e)},[]),y=(0,l.useCallback)(()=>{let e=sessionStorage.getItem("model"),t=sessionStorage.getItem("template");c((0,I.j1)(null!=e?e:"")),c((0,I.zX)(null!=t?t:""))},[c]);return(0,n.jsxs)("div",{id:"autoSave",className:Z().autoSave,children:[(0,n.jsx)(m.default,{title:"Auto-save"+(e?" (Essential privacy policy must be activated)":""),children:(0,n.jsx)(eK.Z,{size:"small",disabled:e,checked:i,checkedChildren:"on",unCheckedChildren:"off",onChange:p})}),(0,n.jsx)(m.default,{title:"Reload auto-saved"+(e?" (Essential privacy policy must be activated)":""),children:(0,n.jsx)(u(),{size:"small",disabled:e,icon:(0,n.jsx)(eQ.Z,{}),onClick:y})})]})},e2=i(84960),e3=i(70302),e5=e=>{let{user:t}=e,[i,r]=(0,l.useState)(),{id:a}=(0,l.useContext)(b.rU);return((0,l.useEffect)(()=>{let e=t.usermodels.find(e=>e.id===a);r(e)},[t,a]),eB()()||!i)?(0,n.jsx)(n.Fragment,{}):(0,n.jsxs)("div",{className:Z().info,children:[(0,n.jsx)(e3.Z,{size:"small",title:"Owners",className:Z().infoCard,children:(0,n.jsx)(e2.ZP.Group,{maxCount:5,children:i.owners.map(e=>eP.Z.userToAvatar(e))})}),i.users.length?(0,n.jsx)(e3.Z,{size:"small",title:"Users",className:Z().infoCard,children:(0,n.jsx)(e2.ZP.Group,{maxCount:5,children:i.users.map(e=>eP.Z.userToAvatar(e))})}):null,i.groups.length?(0,n.jsx)(e3.Z,{size:"small",title:"Groups",className:Z().infoCard,children:(0,n.jsx)(e2.ZP.Group,{maxCount:5,children:i.groups.map(e=>eP.Z.groupToAvatar(e))})}):null]})};let e4=[{title:"New",description:"Create your brand new script.",target:()=>document.getElementById("new")},{title:"Code browser",description:"Find one of your previous script or choose a predefined one.",target:()=>document.getElementById("browser")},{title:"Save",description:"Save your script so you can access it later.",target:()=>document.getElementById("save")},{title:"Share",description:"Share your template with groups and users",target:()=>document.getElementById("share")},{title:"Auto-save",description:"Activate / desactivate automatic save and reload auto-saved code (Essential privacy policy must be activated)",target:()=>document.getElementById("autoSave")},{title:"Steps",description:"It checks if you are doing correctly. Keep an eye on these steps to make sure everything is ok.",target:()=>document.getElementById("steps")},{title:"Code",description:"Write your script here. You can find examples of working scripts by clicking the browse button on top of the JSON editor."},{title:"Blobs",description:"Are you struggling to write your script ? Find some predefined parts of code right here.",target:()=>document.getElementById("blobs")}];var e6=()=>{let[e,t]=(0,l.useState)(),[i,d]=(0,l.useState)(!1),E=(0,r.useRouter)(),[S,{loadingUser:C,mutateUser:k}]=j.Z.useUser(),[w]=x.Z.useOrganizations();(0,l.useEffect)(()=>{(0,v.u)(async()=>{C||S||await E.replace("/")})},[S,C,E]);let I=(0,l.useCallback)(()=>{d(!0)},[]),P=(0,l.useCallback)(()=>{d(!1)},[]),T=(0,l.useCallback)(()=>{(0,v.u)(async()=>{await E.push({pathname:"/dashboard"})})},[E]);return C||!S?(0,n.jsx)(h.Z,{}):(0,n.jsx)(b.ZP,{children:(0,n.jsxs)(a.Z,{className:Z().editor,children:[(0,n.jsxs)(a.Z.Sider,{theme:"light",width:"256",children:[(0,n.jsx)("div",{className:H().logo,children:(0,n.jsx)("img",{src:"/images/logo.svg",alt:"Tanatloc"})}),(0,n.jsx)(s.default,{mode:"inline",items:[{key:"menu-go-back",disabled:!0,style:{cursor:"unset",margin:"10px 0",paddingLeft:10},label:(0,n.jsx)(g.ks,{onClick:T,children:"Return to dashboard"})},{type:"divider"}]}),(0,n.jsx)(O,{setName:t}),(0,n.jsx)(p.Z,{}),(0,n.jsx)(ev,{})]}),(0,n.jsxs)(a.Z.Content,{className:H().noScroll,children:[(0,n.jsx)(a.Z.Header,{className:Z().header,children:(0,n.jsxs)("div",{children:[(0,n.jsx)(c.Z.Text,{strong:!0,children:e}),(0,n.jsxs)(o.default,{children:[(0,n.jsx)(e5,{user:{usermodels:S.usermodels}}),(0,n.jsx)(m.default,{title:"Start tour",children:(0,n.jsx)(u(),{icon:(0,n.jsx)(f.Z,{}),onClick:I})}),(0,n.jsx)(ex,{}),(0,n.jsx)(eZ,{user:{id:S.id,usermodels:S.usermodels},swr:{mutateUser:k}}),(0,n.jsx)(eD,{user:{id:S.id,usermodels:S.usermodels},swr:{mutateUser:k}}),(0,n.jsx)(eY,{user:{id:S.id,usermodels:S.usermodels},organizations:w,swr:{mutateUser:k}}),(0,n.jsx)(e1,{})]})]})}),(0,n.jsx)(eV,{}),(0,n.jsx)(y.Z,{open:i,onClose:P,steps:e4})]})]})})},e9=()=>(0,n.jsx)(e6,{})},3157:function(e){e.exports={container:"sidePanels_container__hLrES",divider:"sidePanels_divider__GnbJr"}},22679:function(e){e.exports={variables:'"@/styles/variables.css"',colorPrimary:"#fad114",editor:"editor_editor__LJrsy",header:"editor_header__gjbgv",info:"editor_info__nUKFT",infoCard:"editor_infoCard__XZ5Sh",autoSave:"editor_autoSave__t3d3L",steps:"editor_steps__KQ0O8",code:"editor_code__pGlQ0",codeBlock:"editor_codeBlock__5DcLF",tooltip:"editor_tooltip__Ru5yR"}}},function(e){e.O(0,[9774,6373,9003,1350,302,8905,1664,4704,5143,1024,9734,1269,5179,6590,1825,2618,3482,7753,231,9818,9326,5753,4278,2888,179],function(){return e(e.s=59261)}),_N_E=e.O()}]);