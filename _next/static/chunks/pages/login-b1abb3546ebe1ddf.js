(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3459],{74250:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/login",function(){return r(1311)}])},70265:function(e,t,r){"use strict";var n;r.d(t,{EQ:function(){return i},kD:function(){return a},o3:function(){return s},x_:function(){return l}});let s=null!==(n=r(34155).env.EMAIL_TOKEN)&&void 0!==n?n:"",a="subscribe",l="passwordRecovery",i="revalidate"},83192:function(e,t,r){"use strict";r.d(t,{Z:function(){return i}});var n=r(87462),s=r(67294),a={icon:function(e,t){return{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z",fill:e}},{tag:"path",attrs:{d:"M512 140c-205.4 0-372 166.6-372 372s166.6 372 372 372 372-166.6 372-372-166.6-372-372-372zm-32 156c0-4.4 3.6-8 8-8h48c4.4 0 8 3.6 8 8v272c0 4.4-3.6 8-8 8h-48c-4.4 0-8-3.6-8-8V296zm32 440a48.01 48.01 0 010-96 48.01 48.01 0 010 96z",fill:t}},{tag:"path",attrs:{d:"M488 576h48c4.4 0 8-3.6 8-8V296c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v272c0 4.4 3.6 8 8 8zm-24 112a48 48 0 1096 0 48 48 0 10-96 0z",fill:e}}]}},name:"exclamation-circle",theme:"twotone"},l=r(87275),i=s.forwardRef(function(e,t){return s.createElement(l.Z,(0,n.Z)({},e,{ref:t,icon:a}))})},99832:function(e,t,r){"use strict";r.d(t,{Z:function(){return i}});var n=r(87462),s=r(67294),a={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M464 720a48 48 0 1096 0 48 48 0 10-96 0zm16-304v184c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V416c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8zm475.7 440l-416-720c-6.2-10.7-16.9-16-27.7-16s-21.6 5.3-27.7 16l-416 720C56 877.4 71.4 904 96 904h832c24.6 0 40-26.6 27.7-48zm-783.5-27.9L512 239.9l339.8 588.2H172.2z"}}]},name:"warning",theme:"outlined"},l=r(87275),i=s.forwardRef(function(e,t){return s.createElement(l.Z,(0,n.Z)({},e,{ref:t,icon:a}))})},45002:function(e,t,r){"use strict";r.d(t,{i:function(){return i}});var n=r(67294),s=r(54043),a=r(61057),l=r(93565);function i(e){return t=>n.createElement(a.ZP,{theme:{token:{motion:!1,zIndexPopupBase:0}}},n.createElement(e,Object.assign({},t)))}t.Z=(e,t,r,a)=>i(i=>{let{prefixCls:o,style:c}=i,u=n.useRef(null),[d,h]=n.useState(0),[p,f]=n.useState(0),[m,g]=(0,s.Z)(!1,{value:i.open}),{getPrefixCls:y}=n.useContext(l.E_),x=y(t||"select",o);n.useEffect(()=>{if(g(!0),"undefined"!=typeof ResizeObserver){let e=new ResizeObserver(e=>{let t=e[0].target;h(t.offsetHeight+8),f(t.offsetWidth)}),t=setInterval(()=>{var n;let s=r?".".concat(r(x)):".".concat(x,"-dropdown"),a=null===(n=u.current)||void 0===n?void 0:n.querySelector(s);a&&(clearInterval(t),e.observe(a))},10);return()=>{clearInterval(t),e.disconnect()}}},[]);let _=Object.assign(Object.assign({},i),{style:Object.assign(Object.assign({},c),{margin:0}),open:m,visible:m,getPopupContainer:()=>u.current});return a&&(_=a(_)),n.createElement("div",{ref:u,style:{paddingBottom:d,position:"relative",minWidth:p}},n.createElement(e,Object.assign({},_)))})},9496:function(e,t,r){"use strict";r.d(t,{Z:function(){return v}});var n=r(97640),s=r(76036),a=r(51212),l=r(67294),i=r(93967),o=r.n(i),c=r(25167),u=r(45002),d=r(93565),h=r(36076),p=r(59134),f=r(52350),m=r(1993),g=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&0>t.indexOf(n)&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var s=0,n=Object.getOwnPropertySymbols(e);s<n.length;s++)0>t.indexOf(n[s])&&Object.prototype.propertyIsEnumerable.call(e,n[s])&&(r[n[s]]=e[n[s]]);return r},y=(0,u.i)(e=>{let{prefixCls:t,className:r,closeIcon:n,closable:s,type:a,title:i,children:u,footer:y}=e,x=g(e,["prefixCls","className","closeIcon","closable","type","title","children","footer"]),{getPrefixCls:_}=l.useContext(d.E_),j=_(),v=t||_("modal"),b=(0,h.Z)(j),[w,k,Z]=(0,m.ZP)(v,b),C="".concat(v,"-confirm"),E={};return E=a?{closable:null!=s&&s,title:"",footer:"",children:l.createElement(p.O,Object.assign({},e,{prefixCls:v,confirmPrefixCls:C,rootPrefixCls:j,content:u}))}:{closable:null==s||s,title:i,footer:null!==y&&l.createElement(f.$,Object.assign({},e)),children:u},w(l.createElement(c.s,Object.assign({prefixCls:v,className:o()(k,"".concat(v,"-pure-panel"),a&&C,a&&"".concat(C,"-").concat(a),r,Z,b)},x,{closeIcon:(0,f.b)(v,n),closable:s},E)))}),x=r(5993);function _(e){return(0,n.ZP)((0,n.uW)(e))}let j=a.Z;j.useModal=x.Z,j.info=function(e){return(0,n.ZP)((0,n.cw)(e))},j.success=function(e){return(0,n.ZP)((0,n.vq)(e))},j.error=function(e){return(0,n.ZP)((0,n.AQ)(e))},j.warning=_,j.warn=_,j.confirm=function(e){return(0,n.ZP)((0,n.Au)(e))},j.destroyAll=function(){for(;s.Z.length;){let e=s.Z.pop();e&&e()}},j.config=n.ai,j._InternalPanelDoNotUseOrYouWillBeFired=y;var v=j},16647:function(e,t,r){"use strict";r.d(t,{R:function(){return c},_:function(){return o}});var n=r(37643),s=r.n(n),a=r(34155);let l=a.env.PORT?parseInt(a.env.PORT):3e3,i=s()()?"http://localhost:"+l:"",o=async(e,t)=>{let r=await fetch(i+e,{method:t?"POST":"GET",headers:{accept:"application/json","Content-Type":"application/json"},...t&&{body:t}}),n=r.headers.get("Content-Type");if(!r.ok){let e=Error("An error occured while fetching data.");throw e.info=(null==n?void 0:n.includes("application/json"))&&await r.json(),e.status=r.status,e}return r.json()},c=async(e,t)=>{var r;let n=await fetch(i+e,{...t,method:null!==(r=null==t?void 0:t.method)&&void 0!==r?r:"GET",headers:{...null==t?void 0:t.headers,"Content-Type":"application/json"}}),s=n.headers.get("Content-Type");if(!n.ok){let e=Error("An error occured while fetching data.");throw e.info=(null==s?void 0:s.includes("application/json"))&&await n.json(),e.status=n.status,e}return n}},6964:function(e,t,r){"use strict";r.d(t,{H:function(){return n}});class n extends Error{constructor(e){var t;super(e.title),this.title=e.title,this.name="APIError",this.render=e.render,this.err=e.err,this.type=null!==(t=e.type)&&void 0!==t?t:"error"}}},41551:function(e,t,r){"use strict";r.d(t,{x:function(){return a}});var n=r(37643);let s=r.n(n)()()?"http://localhost:3000":"",a=async e=>{let t=await fetch(s+"/api/login",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({email:e.email,password:e.password})});return 200===t.status?{ok:!0,...await t.json()}:{ok:!1}}},15165:function(e,t,r){"use strict";r.d(t,{Z:function(){return l}});var n=r(81758),s=r(67294),a=r(16647),l={useUser:()=>{let{data:e,error:t,mutate:r}=(0,n.ZP)("/api/user",a._),l=null==e?void 0:e.user,i=(0,s.useCallback)(async e=>{await r({user:{...l,...e}})},[l,r]);return[l,{mutateUser:i,clearUser:(0,s.useCallback)(async()=>{await r({user:void 0})},[r]),errorUser:(null==t?void 0:t.status)===401?void 0:t,loadingUser:(null==t?void 0:t.status)!==401&&!e}]},useUsers:()=>{var e;let{data:t,error:r,mutate:l}=(0,n.ZP)("/api/users",a._),i=null!==(e=null==t?void 0:t.users)&&void 0!==e?e:[],o=(0,s.useCallback)(async e=>{let t=[...i,{...e,authorizedplugins:[]}];await l({users:t})},[i,l]),c=(0,s.useCallback)(async e=>{let t=i.filter(t=>t.id!==e.id);await l({users:t})},[i,l]),u=(0,s.useCallback)(async e=>{let t=i.map(t=>(t.id===e.id&&(t={...t,...e}),t));await l({users:t})},[i,l]);return[i,{addOneUser:o,delOneUser:c,mutateOneUser:u,errorUsers:r,loadingUsers:!t}]},add:async e=>(await (0,a.R)("/api/user",{method:"POST",headers:{Accept:"application/json"},body:JSON.stringify(e)})).json(),update:async e=>{await (0,a.R)("/api/user",{method:"PUT",body:JSON.stringify(e)})},updateById:async(e,t)=>{await (0,a.R)("/api/user/"+e,{method:"PUT",body:JSON.stringify(t)})},del:async()=>{await (0,a.R)("/api/user",{method:"DELETE"})},delById:async e=>{await (0,a.R)("/api/user/"+e,{method:"DELETE"})},check:async e=>(await (0,a.R)("/api/user/check",{method:"POST",headers:{Accept:"application/json"},body:JSON.stringify(e)})).json()}},34883:function(e,t,r){"use strict";r.d(t,{AN:function(){return f},ZP:function(){return g}});var n=r(85893),s=r(67294),a=r(79505),l=r(9496),i=r(90941),o=r(97992),c=r(49),u=r(25946),d=r(62481),h=r(83192);let p={onOk:"Error while submitting deletion"};var f=e=>{let{visible:t,loading:r,title:a,children:f,onCancel:m,onOk:g}=e,{dispatch:y}=(0,s.useContext)(o.uj),x=(0,s.useCallback)(()=>{(0,u.u)(async()=>{try{await g()}catch(e){y((0,c.iT)({title:p.onOk,err:e,display:!1}))}})},[g,y]);return(0,n.jsx)(l.Z,{title:(0,n.jsxs)(i.Z.Text,{ellipsis:{tooltip:!0},children:[a," ",(0,n.jsx)(h.Z,{twoToneColor:"#ff4d4f",style:{marginLeft:"8px"}})]}),okText:"Delete",closable:!1,maskClosable:!1,open:t,cancelButtonProps:{disabled:r},onCancel:m,onOk:x,okButtonProps:{danger:!0,loading:r},children:(0,n.jsx)(d.Z,{align:"start",children:(0,n.jsx)("span",{style:{wordBreak:"break-word"},children:f})})})};let m={onOk:"Error while submitting data"};var g=e=>{let{visible:t,loading:r,title:d,initialValues:h,cancelButtonText:p,cancelButtonProps:f,okButtonProps:g,okButtonText:y,children:x,onCancel:_,onOk:j}=e,[v,b]=(0,s.useState)(!1),{dispatch:w}=(0,s.useContext)(o.uj),[k]=a.Z.useForm();(0,s.useEffect)(()=>{t&&h&&k.setFieldsValue(h)},[t,h,k]);let Z=(0,s.useCallback)(()=>{(0,u.u)(async()=>{if(j)try{let e=await k.validateFields();await j(e),k.resetFields()}catch(e){w((0,c.iT)({title:m.onOk,err:e,display:!1}))}})},[k,j,w]),C=(0,s.useCallback)(e=>{"Shift"===e.key&&b(!0),"Enter"!==e.key||v||(e.stopPropagation(),Z())},[v,Z]),E=(0,s.useCallback)(e=>{"Shift"===e.key&&b(!1)},[]),O=(0,s.useCallback)(()=>{k.resetFields(),null==_||_()},[k,_]);return(0,n.jsx)(l.Z,{title:(0,n.jsx)(i.Z.Text,{ellipsis:{tooltip:!0},children:d}),open:t,closable:!1,maskClosable:!1,onCancel:O,cancelButtonProps:{...f,disabled:r,style:{display:_?"inline-block":"none"}},cancelText:p,onOk:Z,okText:y,okButtonProps:{...g,loading:r,style:{display:j?"inline-block":"none"}},children:(0,n.jsx)(a.Z,{form:k,layout:"vertical",initialValues:h,onKeyDown:C,onKeyUp:E,children:x})})}},2634:function(e,t,r){"use strict";var n=r(85893),s=r(67294),a=r(5152),l=r.n(a),i=r(41664),o=r.n(i),c=r(62481),u=r(96952),d=r(69837),h=r(81384),p=r(90941),f=r(12609),m=r(7304),g=r(99832),y=r(58650),x=r.n(y),_=r(87396),j=r.n(_);let v=l()(()=>Promise.all([r.e(3737),r.e(447),r.e(9935),r.e(3911),r.e(7004),r.e(1156),r.e(9888),r.e(5566),r.e(2517),r.e(11)]).then(r.bind(r,34492)).then(e=>e.default.extra.Background),{loadableGenerated:{webpack:()=>[34492]},ssr:!1}),b=e=>{let{text:t,status:r,errors:a}=e,[l,i]=(0,s.useState)([]),[c,y]=(0,s.useState)([]);(0,s.useEffect)(()=>{if(!(null==r?void 0:r.length)){i([]);return}i(r.map((e,t)=>({index:t,status:"finish",icon:0===t?(0,n.jsx)(m.Z,{}):void 0,title:e})).filter(e=>e))},[r]),(0,s.useEffect)(()=>{if(!(null==a?void 0:a.length)){y([]);return}y(a.map(e=>{let t=null;return e.includes("docker: command not found")||e.includes("Is the docker daemon running")?t=(0,n.jsxs)(u.Z,{className:j().errorCard,children:["There is an error with your Docker installation.",(0,n.jsx)("br",{}),"Please verify that Docker is correctly installed and running."]}):(e.includes("EHOSTUNREACH")||e.includes("ENETUNREACH")||e.includes("ETIMEOUT"))&&(t=(0,n.jsxs)(u.Z,{className:j().errorCard,children:["There is an error with your PostgreSQL installation.",(0,n.jsx)("br",{}),'Please verify that postgres Docker container "tanatloc-postgres" is correctly installed and running.']})),(0,n.jsxs)("div",{children:[e,t]},e)}))},[a]);let _=!!(null==r?void 0:r.length)||!!(null==a?void 0:a.length);return(0,n.jsxs)(h.Z,{children:[(0,n.jsx)(v,{}),(0,n.jsx)("div",{className:x().logo,children:(0,n.jsx)("img",{src:"/images/logo.svg",alt:"Tanatloc"})}),(0,n.jsx)(u.Z,{className:j().loading,styles:{body:{padding:0}},title:(0,n.jsx)("div",{className:j().title,children:(null==a?void 0:a.length)?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(g.Z,{className:"warning"}),(0,n.jsx)(p.Z.Title,{level:3,style:{margin:"0"},children:"An error occurs"}),(0,n.jsx)(o(),{href:"https://github.com/Airthium/tanatloc/issues/new/choose",target:"_blank",children:"Open an issue"})]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(d.Z,{size:"large",indicator:(0,n.jsx)(m.Z,{})}),null!=t?t:"Loading, please wait..."]})}),children:_?(0,n.jsxs)("div",{className:j().content,children:[c.length?(0,n.jsxs)("div",{className:j().errors,children:[c.map(e=>e),(0,n.jsx)(p.Z.Title,{level:5,children:"Please restart the application"})]}):null,(0,n.jsx)("div",{className:j().status,children:(0,n.jsx)(f.Z,{direction:"vertical",items:l})})]}):null})]})};b.Simple=()=>(0,n.jsx)(c.Z,{style:{height:"100%",width:"100%",justifyContent:"center",alignItems:"center"},children:(0,n.jsx)(u.Z,{children:(0,n.jsxs)(c.Z,{children:[(0,n.jsx)(d.Z,{}),"Loading, please wait..."]})})}),t.Z=b},1311:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return D}});var n=r(85893),s=r(67294),a=r(11163),l=r(5152),i=r.n(l),o=r(81384),c=r(96952),u=r(62481),d=r(90941),h=r(53533),p=r(79505),f=r(59935),m=r(37643),g=r.n(m),y=r(97992),x=r(49),_=r(2634),j=r(25946),v=r(28426),b=r(6964),w=r(41551),k=r(15165),Z=r(34883),C=r(16647),E=r(70265);let O=async e=>{await (0,C.R)("/api/email",{method:"PUT",body:JSON.stringify({type:E.x_,email:e})})},P={recover:"Unable to recover password"},T=async e=>await O(e.email);var N=()=>{let e=(0,s.useRef)(null),[t,r]=(0,s.useState)(!1),[a,l]=(0,s.useState)(!1),{dispatch:i}=(0,s.useContext)(y.uj);(0,s.useEffect)(()=>{e.current&&e.current.focus()});let o=(0,s.useCallback)(()=>r(!0),[]),c=(0,s.useCallback)(()=>r(!1),[]),u=(0,s.useCallback)(async e=>{l(!0);try{await T(e),i((0,x.$E)({title:"An email has been send to recover your password",description:"If you entered a valid email"})),l(!1),r(!1)}catch(e){throw i((0,x.iT)({title:P.recover,err:e})),l(!1),e}},[i]);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(Z.ZP,{title:"Forgot your password ?",visible:t,onCancel:c,onOk:u,loading:a,children:(0,n.jsx)(p.Z.Item,{name:"email",label:"Your email address",rules:[{required:!0,message:"Email is required"}],children:(0,n.jsx)(f.Z,{ref:e,placeholder:"Email address",autoComplete:"email"})})}),(0,n.jsx)(d.Z.Text,{children:(0,n.jsx)(h.ZP,{type:"link",onClick:o,children:"Forgot your password ?"})})]})},S=r(58650),B=r.n(S),I=r(90986),R=r.n(I);let U=i()(()=>Promise.all([r.e(3737),r.e(447),r.e(3911),r.e(7004),r.e(1156),r.e(9888),r.e(5566),r.e(2517),r.e(7594)]).then(r.bind(r,34492)).then(e=>e.default.extra.Background),{loadableGenerated:{webpack:()=>[34492]},ssr:!1}),A={user:"Error while loading user",internal:"Server issue : please try again shortly",credentials:"Incorrect credentials"},z=async(e,t)=>{let r;try{r=await (0,w.x)(e)}catch(e){throw new b.H({title:A.internal,err:e})}if(r.ok)await t({id:r.id});else throw new b.H({title:A.credentials,type:"warning"})};var L=()=>{let e=(0,s.useRef)(0),[t,r]=(0,s.useState)(!1),[l,i]=(0,s.useState)(),{dispatch:m}=(0,s.useContext)(y.uj),[b,{mutateUser:Z,errorUser:C,loadingUser:E}]=k.Z.useUser(),O=(0,a.useRouter)();(0,s.useEffect)(()=>{(0,j.u)(async()=>{if(g()())try{await (0,w.x)({email:"admin",password:"password"}),await O.push("/dashboard")}catch(e){}})},[O]),(0,s.useEffect)(()=>{C&&m((0,x.iT)({title:A.user,err:C}))},[C,m]);let P=(0,s.useCallback)(()=>{(0,j.u)(async()=>{await O.push("/dashboard")})},[O]);(0,s.useEffect)(()=>{b&&!e.current&&(e.current++,P())},[b,P]);let T=(0,s.useCallback)(()=>{(0,j.u)(async()=>{await O.push("/signup")})},[O]),S=(0,s.useCallback)(e=>{(0,j.u)(async()=>{r(!0);try{await z(e,Z)}catch(e){i(e),r(!1)}})},[Z]);return E||b?(0,n.jsx)(_.Z,{}):(0,n.jsxs)(o.Z,{children:[(0,n.jsx)(U,{}),(0,n.jsx)(c.Z,{bordered:!1,className:R().login,children:(0,n.jsxs)(u.Z,{direction:"vertical",size:"large",className:B().fullWidth,children:[(0,n.jsxs)("div",{children:[(0,n.jsx)(d.Z.Title,{level:1,style:{padding:0,marginBottom:16,fontWeight:500},children:"Log In"}),(0,n.jsxs)(d.Z.Text,{children:["Your first time ?"," ",(0,n.jsx)(h.ZP,{type:"link",onClick:T,children:"Sign up"})]})]}),(0,n.jsxs)(p.Z,{requiredMark:"optional",onFinish:S,layout:"vertical",children:[(0,n.jsx)(p.Z.Item,{name:"email",label:"Your email address",rules:[{required:!0,message:"Email is required"}],children:(0,n.jsx)(f.Z,{placeholder:"Email address",autoComplete:"email"})}),(0,n.jsx)(p.Z.Item,{name:"password",label:"Your password",rules:[{required:!0,message:"Password is required"}],style:{marginBottom:"14px"},children:(0,n.jsx)(f.Z.Password,{placeholder:"Password",autoComplete:"current-password"})}),(0,n.jsx)(N,{}),(0,n.jsx)(v.Xq,{error:l}),(0,n.jsx)(p.Z.Item,{className:R().submit,children:(0,n.jsx)(h.ZP,{type:"primary",loading:t,htmlType:"submit",children:"Log in"})})]})]})})]})},D=()=>(0,n.jsx)(L,{})},87396:function(e){e.exports={loading:"loading_loading__WR55J",title:"loading_title___LzrV",content:"loading_content__NB5oB",status:"loading_status__3rOKY",errors:"loading_errors__NiPcj",error:"loading_error__3HHUG",errorCard:"loading_errorCard__lZ_jh"}},90986:function(e){e.exports={login:"login_login__BFpy1",submit:"login_submit__f8x_k"}},58650:function(e){e.exports={variables:'"./variables.css"',colorPrimary:"#fad114",textColorDark:"rgba(0, 0, 0, 0.65)",textColorLight:"rgba(0, 0, 0, 0.45)",logo:"styles_logo__a_88m",displayNone:"styles_displayNone__X5JML",displayFlex:"styles_displayFlex__pvl0H",fullWidth:"styles_fullWidth__ig6Zi",fullHeight:"styles_fullHeight__aD1qp",noScroll:"styles_noScroll__jJYvq",scroll:"styles_scroll___zuDw",noBackground:"styles_noBackground__QOpQc",noBorder:"styles_noBorder__T5mw6",noBorderBottom:"styles_noBorderBottom__5ori7",textWhite:"styles_textWhite__yojx2",textLight:"styles_textLight__QglC7",textDark:"styles_textDark__xPmmk",textOrange:"styles_textOrange__TYZ4a",textGreen:"styles_textGreen__M8GsP",textAlignLeft:"styles_textAlignLeft__Da1jw",textAlignCenter:"styles_textAlignCenter__DSN8m",primaryColor:"styles_primaryColor__lHC0K",backgroundPrimary:"styles_backgroundPrimary__5S8pd"}}},function(e){e.O(0,[1384,4120,6952,9935,6458,2609,1758,2888,9774,179],function(){return e(e.s=74250)}),_N_E=e.O()}]);