(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3459],{83236:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/login",function(){return r(54290)}])},40287:function(e,t,r){"use strict";r.d(t,{EQ:function(){return a},kD:function(){return i},x_:function(){return s}}),r(83454).env.EMAIL_TOKEN;let i="subscribe",s="passwordRecovery",a="revalidate"},4415:function(e,t,r){"use strict";r.d(t,{H:function(){return i}});class i extends Error{constructor(e){super(e.title),this.title=e.title,this.name="APIError",this.render=e.render,this.err=e.err,this.type=e.type||"error"}}},63406:function(e,t,r){"use strict";r.d(t,{x:function(){return n}});var i=r(59134),s=r.n(i);let a=s()()?"http://localhost:3000":"",n=async e=>{let t=await fetch(a+"/api/login",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({email:e.email,password:e.password})});return 200===t.status?{ok:!0,...await t.json()}:{ok:!1}}},54290:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return Y}});var i=r(14288),s=r(11163),a=r(67294),n=r(97183),o=r(85813),l=r(26713),c=r(22850),d=r(71577),u=r(62806),h=r(69677),p=r(59134),m=r.n(p),f=r(67641),Z=r(12271),w=r(4415),y=r(63406),g=r(55734),v=r(28345),b=r(11425),E=r(40287);let _=async e=>{await (0,b.R)("/api/email",{method:"PUT",body:JSON.stringify({type:E.x_,email:e})})};var k={recover:_};let x={recover:"Unable to recover password"},T=async e=>{try{await k.recover(e.email),(0,Z.Ur)("An email has been send to recover your password","If you entered a valid email")}catch(t){throw(0,Z.lt)(x.recover,t),t}},P=()=>{let e=(0,a.useRef)(null),[t,r]=(0,a.useState)(!1),[s,n]=(0,a.useState)(!1);return(0,a.useEffect)(()=>{e.current&&e.current.focus()}),(0,i.BX)(i.HY,{children:[(0,i.tZ)(v.ZP,{title:"Forgot your password ?",visible:t,onCancel:()=>r(!1),async onOk(e){n(!0);try{await T(e),n(!1),r(!1)}catch(t){throw n(!1),t}},loading:s,children:(0,i.tZ)(u.Z.Item,{name:"email",label:"Your email address",rules:[{required:!0,message:"Email is required"}],children:(0,i.tZ)(h.Z,{ref:e,placeholder:"Email address",autoComplete:"email"})})}),(0,i.tZ)(c.Z.Text,{children:(0,i.tZ)(d.Z,{type:"link",onClick:()=>r(!0),children:"Forgot your password ?"})})]})};var C=r(86159),I=r(70917);let S={login:(0,I.iv)({margin:"auto !important",width:"350px"}),submit:(0,I.iv)({marginTop:"32px",button:{width:"100%"}})},q={user:"Error while loading user",internal:"Server issue : please try again shortly",credentials:"Incorrect credentials"},N=async(e,t,r)=>{let i;try{i=await (0,y.x)(t)}catch(s){throw new w.H({title:q.internal,err:s})}if(i.ok)r({id:i.id}),e.push("/dashboard");else throw new w.H({title:q.credentials,type:"warning"})},X=e=>{e.push("/signup")},B=()=>{let[e,t]=(0,a.useState)(!1),[r,p]=(0,a.useState)(),[w,{mutateUser:v,errorUser:b,loadingUser:E}]=g.Z.useUser(),_=(0,s.useRouter)();return((0,a.useEffect)(()=>{m()()&&(0,y.x)({email:"admin",password:"password"}).then(()=>{_.push("/dashboard")}).catch()},[_]),(0,a.useEffect)(()=>{b&&(0,Z.lt)(q.user,b)},[b]),(0,a.useEffect)(()=>{w&&_.push("/dashboard")},[w,_]),(0,a.useEffect)(()=>{_.prefetch("/signup"),_.prefetch("/dashboard")},[_]),E||w)?(0,i.tZ)(f.Z,{}):(0,i.tZ)(n.Z,{children:(0,i.tZ)(o.Z,{bordered:!1,css:S.login,children:(0,i.BX)(l.Z,{direction:"vertical",size:"large",css:C.KP.fullWidth,children:[(0,i.BX)("div",{children:[(0,i.tZ)(c.Z.Title,{level:1,style:{padding:0,marginBottom:16,fontWeight:500},children:"Log In"}),(0,i.BX)(c.Z.Text,{children:["Your first time ?"," ",(0,i.tZ)(d.Z,{type:"link",onClick:()=>X(_),children:"Sign up"})]})]}),(0,i.BX)(u.Z,{requiredMark:"optional",async onFinish(e){t(!0);try{await N(_,e,v)}catch(r){p(r),t(!1)}},layout:"vertical",children:[(0,i.tZ)(u.Z.Item,{name:"email",label:"Your email address",rules:[{required:!0,message:"Email is required"}],children:(0,i.tZ)(h.Z,{placeholder:"Email address",autoComplete:"email"})}),(0,i.tZ)(u.Z.Item,{name:"password",label:"Your password",rules:[{required:!0,message:"Password is required"}],style:{marginBottom:"14px"},children:(0,i.tZ)(h.Z.Password,{placeholder:"Password",autoComplete:"current-password"})}),(0,i.tZ)(P,{}),(0,i.tZ)(Z.Xq,{error:r}),(0,i.tZ)(u.Z.Item,{css:S.submit,children:(0,i.tZ)(d.Z,{type:"primary",loading:e,htmlType:"submit",children:"Log in"})})]})]})})})},O=()=>(0,i.tZ)(B,{});var Y=O}},function(e){e.O(0,[4875,992,1183,5813,1577,3239,2833,4702,1473,3363,974,6106,7450,9774,2888,179],function(){return e(e.s=83236)}),_N_E=e.O()}]);