(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7616],{90619:function(e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M464 720a48 48 0 1096 0 48 48 0 10-96 0zm16-304v184c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V416c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8zm475.7 440l-416-720c-6.2-10.7-16.9-16-27.7-16s-21.6 5.3-27.7 16l-416 720C56 877.4 71.4 904 96 904h832c24.6 0 40-26.6 27.7-48zm-783.5-27.9L512 239.9l339.8 588.2H172.2z"}}]},name:"warning",theme:"outlined"}},33649:function(e,r,t){"use strict";Object.defineProperty(r,"Z",{enumerable:!0,get:function(){return i}});var s=_interop_require_wildcard(t(67294)),n=_interop_require_default(t(90619)),a=_interop_require_default(t(92074));function _define_property(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function _interop_require_default(e){return e&&e.__esModule?e:{default:e}}function _getRequireWildcardCache(e){if("function"!=typeof WeakMap)return null;var r=new WeakMap,t=new WeakMap;return(_getRequireWildcardCache=function(e){return e?t:r})(e)}function _interop_require_wildcard(e,r){if(!r&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=_getRequireWildcardCache(r);if(t&&t.has(e))return t.get(e);var s={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var i=n?Object.getOwnPropertyDescriptor(e,a):null;i&&(i.get||i.set)?Object.defineProperty(s,a,i):s[a]=e[a]}return s.default=e,t&&t.set(e,s),s}function _object_spread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{},s=Object.keys(t);"function"==typeof Object.getOwnPropertySymbols&&(s=s.concat(Object.getOwnPropertySymbols(t).filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),s.forEach(function(r){_define_property(e,r,t[r])})}return e}function ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);r&&(s=s.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,s)}return t}function _object_spread_props(e,r){return r=null!=r?r:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}),e}var i=s.forwardRef(function(e,r){return s.createElement(a.default,_object_spread_props(_object_spread({},e),{ref:r,icon:n.default}))})},21368:function(e,r,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/signup",function(){return t(65465)}])},59141:function(e,r,t){"use strict";var s;t.d(r,{JT:function(){return i},ah:function(){return l},nq:function(){return a},tE:function(){return o},yL:function(){return n}}),null!==(s=t(83454).env.AUTH_SECRET)&&void 0!==s||Array(33).join("a");let n=6,a=16,i=!0,o=!0,l=!0},21390:function(e,r,t){"use strict";t.d(r,{EQ:function(){return l},kD:function(){return i},o3:function(){return a},x_:function(){return o}});var s,n=t(83454);let a=null!==(s=n.env.EMAIL_TOKEN)&&void 0!==s?s:"",i="subscribe",o="passwordRecovery",l="revalidate"},948:function(e,r,t){"use strict";t.d(r,{R:function(){return call},_:function(){return fetcher}});var s=t(59134),n=t.n(s),a=t(83454);let i=a.env.PORT?parseInt(a.env.PORT):3e3,o=n()()?"http://localhost:"+i:"",fetcher=async(e,r)=>{let t=await fetch(o+e,{method:r?"POST":"GET",headers:{accept:"application/json","Content-Type":"application/json"},...r&&{body:r}}),s=t.headers.get("Content-Type");if(!t.ok){let e=Error("An error occured while fetching data.");throw e.info=(null==s?void 0:s.includes("application/json"))&&await t.json(),e.status=t.status,e}return t.json()},call=async(e,r)=>{var t;let s=await fetch(o+e,{...r,method:null!==(t=null==r?void 0:r.method)&&void 0!==t?t:"GET",headers:{...null==r?void 0:r.headers,"Content-Type":"application/json"}}),n=s.headers.get("Content-Type");if(!s.ok){let e=Error("An error occured while fetching data.");throw e.info=(null==n?void 0:n.includes("application/json"))&&await s.json(),e.status=s.status,e}return s}},77547:function(e,r,t){"use strict";t.d(r,{H:function(){return APIError}});let APIError=class APIError extends Error{constructor(e){var r;super(e.title),this.title=e.title,this.name="APIError",this.render=e.render,this.err=e.err,this.type=null!==(r=e.type)&&void 0!==r?r:"error"}}},751:function(e,r,t){"use strict";t.d(r,{Z:function(){return i}});var s=t(59734),n=t(67294),a=t(948);let update=async e=>{await (0,a.R)("/api/system",{method:"PUT",body:JSON.stringify(e)})};var i={useSystem:()=>{var e;let{data:r,error:t,mutate:i}=(0,s.ZP)("/api/system",a._),o=null!==(e=null==r?void 0:r.system)&&void 0!==e?e:{},l=(0,n.useCallback)(async e=>{await i({system:{...o,...e}})},[o,i]);return[o,{mutateSystem:l,errorSystem:t,loadingSystem:!r}]},update:update}},40144:function(e,r,t){"use strict";t.d(r,{Z:function(){return i}});var s=t(59734),n=t(67294),a=t(948);let add=async e=>{let r=await (0,a.R)("/api/user",{method:"POST",headers:{Accept:"application/json"},body:JSON.stringify(e)});return r.json()},update=async e=>{await (0,a.R)("/api/user",{method:"PUT",body:JSON.stringify(e)})},updateById=async(e,r)=>{await (0,a.R)("/api/user/"+e,{method:"PUT",body:JSON.stringify(r)})},del=async()=>{await (0,a.R)("/api/user",{method:"DELETE"})},delById=async e=>{await (0,a.R)("/api/user/"+e,{method:"DELETE"})},check=async e=>{let r=await (0,a.R)("/api/user/check",{method:"POST",headers:{Accept:"application/json"},body:JSON.stringify(e)});return r.json()};var i={useUser:()=>{let{data:e,error:r,mutate:t}=(0,s.ZP)("/api/user",a._),i=null==e?void 0:e.user,o=(0,n.useCallback)(async e=>{await t({user:{...i,...e}})},[i,t]),l=(0,n.useCallback)(async()=>{await t({user:void 0})},[t]);return[i,{mutateUser:o,clearUser:l,errorUser:(null==r?void 0:r.status)===401?void 0:r,loadingUser:(null==r?void 0:r.status)!==401&&!e}]},useUsers:()=>{var e;let{data:r,error:t,mutate:i}=(0,s.ZP)("/api/users",a._),o=null!==(e=null==r?void 0:r.users)&&void 0!==e?e:[],l=(0,n.useCallback)(async e=>{let r=[...o,{...e,authorizedplugins:[]}];await i({users:r})},[o,i]),u=(0,n.useCallback)(async e=>{let r=o.filter(r=>r.id!==e.id);await i({users:r})},[o,i]),d=(0,n.useCallback)(async e=>{let r=o.map(r=>(r.id===e.id&&(r={...r,...e}),r));await i({users:r})},[o,i]);return[o,{addOneUser:l,delOneUser:u,mutateOneUser:d,errorUsers:t,loadingUsers:!r}]},add:add,update:update,updateById:updateById,del:del,delById:delById,check:check}},55798:function(e,r,t){"use strict";t.d(r,{o:function(){return input_password}});var s=t(85893),n=t(97538),a=t(51024),i=t(59141),o=t(751);let l={password:"Please enter a password",passwordTooSmall:e=>"Your password is too small (minimum "+e+" characters)",passwordTooLong:e=>"Your password is too long (maximum "+e+" characters)",passwordRequireLetter:"Your password must contain a letter",passwordRequireNumber:"Your password must contain a number",passwordRequireSymbol:"Your password must contain a symbol"},_checkMin=(e,r)=>!(r.length<e),_checkMax=(e,r)=>!(r.length>e),_checkRegex=(e,r)=>-1!==e.search(r),_requireLetter=(e,r)=>{var t,s;return(null!==(s=null==e?void 0:null===(t=e.password)||void 0===t?void 0:t.requireLetter)&&void 0!==s?!s:!i.JT)||_checkRegex(r,/[a-zA-Z]/)},_requireNumber=(e,r)=>{var t,s;return(null!==(s=null==e?void 0:null===(t=e.password)||void 0===t?void 0:t.requireNumber)&&void 0!==s?!s:!i.tE)||_checkRegex(r,/\d/)},_requireSymbol=(e,r)=>{var t,s;return(null!==(s=null==e?void 0:null===(t=e.password)||void 0===t?void 0:t.requireSymbol)&&void 0!==s?!s:!i.ah)||_checkRegex(r,/[!@#$%^&*(){}[\]<>?/|.:;_-]/)},_checkSize=(e,r,t,s)=>{_checkMin(e,t)||s.push(l.passwordTooSmall(e)),_checkMax(r,t)||s.push(l.passwordTooLong(r))},_checkFormat=(e,r,t)=>{_requireLetter(e,r)||t.push(l.passwordRequireLetter),_requireNumber(e,r)||t.push(l.passwordRequireNumber),_requireSymbol(e,r)||t.push(l.passwordRequireSymbol)};var input_password=e=>{var r,t,u,d;let{labelCol:c,wrapperCol:p,name:h,label:_,inputPlaceholder:y,inputAutoComplete:m,edit:f,style:g,required:w}=e,[v]=o.Z.useSystem(),j=null!==(u=null==v?void 0:null===(r=v.password)||void 0===r?void 0:r.min)&&void 0!==u?u:i.yL,x=null!==(d=null==v?void 0:null===(t=v.password)||void 0===t?void 0:t.max)&&void 0!==d?d:i.nq;return(0,s.jsx)(n.Z.Item,{labelCol:c,wrapperCol:p,name:null!=h?h:"password",label:null!=_?_:"Password",rules:[()=>({validator(e,r){let t=[];return f&&"******"===r?Promise.resolve():r?(_checkSize(j,x,r,t),_checkFormat(v,r,t),t.length)?Promise.reject(t):Promise.resolve():Promise.reject(l.password)}}),{required:!!w,message:""}],style:g,children:(0,s.jsx)(a.default.Password,{placeholder:y,autoComplete:m})})}},40561:function(e,r,t){"use strict";var s=t(85893),n=t(67294),a=t(41664),i=t.n(a),o=t(70302),l=t(16373),u=t(74048),d=t(89552),c=t(94704),p=t(53740),h=t(4851),_=t(33649),y=t(35304),m=t.n(y),f=t(92544),g=t.n(f);let Loading=e=>{let{text:r,status:t,errors:a}=e,[u,y]=(0,n.useState)([]),[f,w]=(0,n.useState)([]);(0,n.useEffect)(()=>{if(!(null==t?void 0:t.length)){y([]);return}let e=t.map((e,r)=>({index:r,status:"finish",icon:0===r?(0,s.jsx)(h.default,{}):void 0,title:e})).filter(e=>e);y(e)},[t]),(0,n.useEffect)(()=>{if(!(null==a?void 0:a.length)){w([]);return}w(a.map(e=>{let r=null;return e.includes("docker: command not found")||e.includes("Is the docker daemon running")?r=(0,s.jsxs)(o.Z,{className:g().errorCard,children:["There is an error with your Docker installation.",(0,s.jsx)("br",{}),"Please verify that Docker is correctly installed and running."]}):(e.includes("EHOSTUNREACH")||e.includes("ENETUNREACH")||e.includes("ETIMEOUT"))&&(r=(0,s.jsxs)(o.Z,{className:g().errorCard,children:["There is an error with your PostgreSQL installation.",(0,s.jsx)("br",{}),'Please verify that postgres Docker container "tanatloc-postgres" is correctly installed and running.']})),(0,s.jsxs)("div",{children:[e,r]},e)}))},[a]);let v=!!(null==t?void 0:t.length)||!!(null==a?void 0:a.length);return(0,s.jsxs)(l.Z,{children:[(0,s.jsx)("div",{className:m().logo,children:(0,s.jsx)("img",{src:"/images/logo.svg",alt:"Tanatloc"})}),(0,s.jsx)(o.Z,{className:g().loading,bodyStyle:{padding:0},title:(0,s.jsx)("div",{className:g().title,children:(null==a?void 0:a.length)?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(_.Z,{className:"warning"}),(0,s.jsx)(p.Z.Title,{level:3,style:{margin:"0"},children:"An error occurs"}),(0,s.jsx)(i(),{href:"https://github.com/Airthium/tanatloc/issues/new/choose",target:"_blank",children:"Open an issue"})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(d.default,{size:"large",indicator:(0,s.jsx)(h.default,{})}),null!=r?r:"Loading, please wait..."]})}),children:v?(0,s.jsxs)("div",{className:g().content,children:[f.length?(0,s.jsxs)("div",{className:g().errors,children:[f.map(e=>e),(0,s.jsx)(p.Z.Title,{level:5,children:"Please restart the application"})]}):null,(0,s.jsx)("div",{className:g().status,children:(0,s.jsx)(c.Z,{direction:"vertical",items:u})})]}):null})]})};Loading.Simple=()=>(0,s.jsx)(u.default,{style:{height:"100%",width:"100%",justifyContent:"center",alignItems:"center"},children:(0,s.jsx)(o.Z,{children:(0,s.jsxs)(u.default,{children:[(0,s.jsx)(d.default,{}),"Loading, please wait..."]})})}),r.Z=Loading},65465:function(e,r,t){"use strict";t.r(r),t.d(r,{default:function(){return signup_page}});var s=t(85893),n=t(11163),a=t(67294),i=t(65400),o=t.n(i),l=t(70302),u=t(97538),d=t(51024),c=t(16373),p=t(74048),h=t(53740),_=t(21390),y=t(8061),m=t(54509),f=t(55798),g=t(27756),w=t(40561),v=t(77547),j=t(40144),x=t(751),b=t(35304),P=t.n(b),O=t(14888),k=t.n(O);let E={user:"Error while loading user",system:"Error while loading system",internal:"Server issue : please try again shortly",alreadyExists:"This email is already registered",passwordMismatch:"Passwords mismatch"},_onSignup=async(e,r)=>{let t;try{t=await j.Z.add(r)}catch(e){throw new v.H({title:E.internal,err:e})}if(t.alreadyExists)throw new v.H({title:E.alreadyExists,render:(0,s.jsxs)(s.Fragment,{children:["We know you! ",(0,s.jsx)("a",{onClick:()=>_onLogin(e),children:"Log in?"})]}),type:"warning"});_.o3?await e.push("/signup/send").catch():await e.push("/login").catch()},_onLogin=e=>{(async()=>{await e.push("/login").catch()})()};var signup=()=>{let[e,r]=(0,a.useState)(!1),[t,i]=(0,a.useState)(),{dispatch:_}=(0,a.useContext)(y.uj),v=(0,n.useRouter)(),[b,{errorUser:O,loadingUser:C}]=j.Z.useUser(),[S,{errorSystem:T,loadingSystem:N}]=x.Z.useSystem();(0,a.useEffect)(()=>{O&&_((0,m.iT)({title:E.user,err:O})),T&&_((0,m.iT)({title:E.system,err:T}))},[O,T,_]),(0,a.useEffect)(()=>{(async()=>{b&&await v.push("/dashboard")})()},[b,v]);let Z=(0,a.useCallback)(e=>{(async()=>{r(!0);try{await _onSignup(v,e)}catch(e){i(e)}finally{r(!1)}})()},[v]);return C||N||b?(0,s.jsx)(w.Z,{}):(null==S?void 0:S.allowsignup)?(0,s.jsx)(c.Z,{children:(0,s.jsx)(l.Z,{bordered:!1,className:k().signup,children:(0,s.jsxs)(p.default,{direction:"vertical",size:"large",className:P().fullWidth,children:[(0,s.jsx)("div",{children:(0,s.jsx)(h.Z.Title,{level:1,style:{padding:0,marginBottom:16,fontWeight:500},children:"Sign Up"})}),(0,s.jsxs)(u.Z,{requiredMark:"optional",onFinish:Z,layout:"vertical",children:[(0,s.jsx)(u.Z.Item,{name:"email",label:"Enter your email address",rules:[{required:!0,message:"Email is required"}],children:(0,s.jsx)(d.default,{placeholder:"Email address",autoComplete:"email"})}),(0,s.jsx)(f.o,{name:"password",label:"Choose your password",inputPlaceholder:"Password",inputAutoComplete:"current-password",style:{marginBottom:"14px"}}),(0,s.jsx)(u.Z.Item,{name:"passwordConfirmation",label:"Confirm your password",rules:[{required:!0,message:"Password confirmation is required"},e=>{let{getFieldValue:r}=e;return{validator:(e,t)=>t&&r("password")!==t?Promise.reject(E.passwordMismatch):Promise.resolve()}}],style:{marginBottom:"14px"},children:(0,s.jsx)(d.default.Password,{placeholder:"Password",autoComplete:"current-password"})}),(0,s.jsx)(g.Xq,{error:t}),(0,s.jsx)(u.Z.Item,{className:k().submit,children:(0,s.jsx)(o(),{type:"primary",loading:e,htmlType:"submit",children:"Finish"})})]})]})})}):(0,s.jsx)(c.Z,{children:(0,s.jsx)(l.Z,{className:k().signup,children:"The server does not allow signup for now"})})},signup_page=()=>(0,s.jsx)(signup,{})},92544:function(e){e.exports={loading:"loading_loading__WR55J",title:"loading_title___LzrV",content:"loading_content__NB5oB",status:"loading_status__3rOKY",errors:"loading_errors__NiPcj",error:"loading_error__3HHUG",errorCard:"loading_errorCard__lZ_jh"}},14888:function(e){e.exports={signup:"signup_signup__5hkI7",submit:"signup_submit__lKl_k"}},35304:function(e){e.exports={variables:'"./variables.css"',colorPrimary:"#fad114",textColorDark:"rgba(0, 0, 0, 0.65)",textColorLight:"rgba(0, 0, 0, 0.45)",logo:"styles_logo__a_88m",displayNone:"styles_displayNone__X5JML",displayFlex:"styles_displayFlex__pvl0H",fullWidth:"styles_fullWidth__ig6Zi",fullHeight:"styles_fullHeight__aD1qp",noScroll:"styles_noScroll__jJYvq",scroll:"styles_scroll___zuDw",noBackground:"styles_noBackground__QOpQc",noBorder:"styles_noBorder__T5mw6",noBorderBottom:"styles_noBorderBottom__5ori7",textWhite:"styles_textWhite__yojx2",textLight:"styles_textLight__QglC7",textDark:"styles_textDark__xPmmk",textOrange:"styles_textOrange__TYZ4a",textGreen:"styles_textGreen__M8GsP",textAlignLeft:"styles_textAlignLeft__Da1jw",textAlignCenter:"styles_textAlignCenter__DSN8m",primaryColor:"styles_primaryColor__lHC0K",backgroundPrimary:"styles_backgroundPrimary__5S8pd"}}},function(e){e.O(0,[6373,1350,302,1664,4704,7651,9734,9774,2888,179],function(){return e(e.s=21368)}),_N_E=e.O()}]);