(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4252],{95637:(e,s,r)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/signup",function(){return r(84219)}])},21722:(e,s,r)=>{"use strict";var t;r.d(s,{F:()=>o,TL:()=>a,Vt:()=>l,bJ:()=>i,gv:()=>n}),null!==(t=r(65606).env.AUTH_SECRET)&&void 0!==t||Array(33).join("a");let a=6,l=16,i=!0,n=!0,o=!0},30498:(e,s,r)=>{"use strict";var t;r.d(s,{CV:()=>a,Rn:()=>l,k0:()=>i,kK:()=>n});let a=null!==(t=r(65606).env.EMAIL_TOKEN)&&void 0!==t?t:"",l="subscribe",i="passwordRecovery",n="revalidate"},22373:(e,s,r)=>{"use strict";r.d(s,{A:()=>n});var t=r(58168),a=r(96540);let l={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M464 720a48 48 0 1096 0 48 48 0 10-96 0zm16-304v184c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V416c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8zm475.7 440l-416-720c-6.2-10.7-16.9-16-27.7-16s-21.6 5.3-27.7 16l-416 720C56 877.4 71.4 904 96 904h832c24.6 0 40-26.6 27.7-48zm-783.5-27.9L512 239.9l339.8 588.2H172.2z"}}]},name:"warning",theme:"outlined"};var i=r(25363);let n=a.forwardRef(function(e,s){return a.createElement(i.A,(0,t.A)({},e,{ref:s,icon:l}))})},50641:(e,s,r)=>{"use strict";r.d(s,{G:()=>o,T:()=>d});var t=r(4866),a=r.n(t),l=r(65606);let i=l.env.PORT?parseInt(l.env.PORT):3e3,n=a()()?"http://localhost:"+i:"",o=async(e,s)=>{let r=await fetch(n+e,{method:s?"POST":"GET",headers:{accept:"application/json","Content-Type":"application/json"},...s&&{body:s}}),t=r.headers.get("Content-Type");if(!r.ok){let e=Error("An error occured while fetching data.");throw e.info=(null==t?void 0:t.includes("application/json"))&&await r.json(),e.status=r.status,e}return r.json()},d=async(e,s)=>{var r;let t=await fetch(n+e,{...s,method:null!==(r=null==s?void 0:s.method)&&void 0!==r?r:"GET",headers:{...null==s?void 0:s.headers,"Content-Type":"application/json"}}),a=t.headers.get("Content-Type");if(!t.ok){let e=Error("An error occured while fetching data.");throw e.info=(null==a?void 0:a.includes("application/json"))&&await t.json(),e.status=t.status,e}return t}},28952:(e,s,r)=>{"use strict";r.d(s,{L:()=>t});class t extends Error{constructor(e){var s;super(e.title),this.title=e.title,this.name="APIError",this.render=e.render,this.err=e.err,this.type=null!==(s=e.type)&&void 0!==s?s:"error"}}},5337:(e,s,r)=>{"use strict";r.d(s,{A:()=>i});var t=r(8065),a=r(96540),l=r(50641);let i={useSystem:()=>{var e;let{data:s,error:r,mutate:i}=(0,t.Ay)("/api/system",l.G),n=!s,o=null!==(e=null==s?void 0:s.system)&&void 0!==e?e:{},d=(0,a.useCallback)(async e=>{await i({system:{...o,...e}})},[o,i]);return[o,{mutateSystem:d,errorSystem:r,loadingSystem:n}]},update:async e=>{await (0,l.T)("/api/system",{method:"PUT",body:JSON.stringify(e)})}}},249:(e,s,r)=>{"use strict";r.d(s,{A:()=>i});var t=r(8065),a=r(96540),l=r(50641);let i={useUser:()=>{let{data:e,error:s,mutate:r}=(0,t.Ay)("/api/user",l.G),i=!e,n=null==e?void 0:e.user,o=(0,a.useCallback)(async e=>{await r({user:{...n,...e}})},[n,r]);return[n,{mutateUser:o,clearUser:(0,a.useCallback)(async()=>{await r({user:void 0})},[r]),errorUser:(null==s?void 0:s.status)===401?void 0:s,loadingUser:(null==s?void 0:s.status)!==401&&i}]},useUsers:()=>{var e;let{data:s,error:r,mutate:i}=(0,t.Ay)("/api/users",l.G),n=!s,o=null!==(e=null==s?void 0:s.users)&&void 0!==e?e:[],d=(0,a.useCallback)(async e=>{let s=[...o,{...e,authorizedplugins:[]}];await i({users:s})},[o,i]),u=(0,a.useCallback)(async e=>{let s=o.filter(s=>s.id!==e.id);await i({users:s})},[o,i]),c=(0,a.useCallback)(async e=>{let s=o.map(s=>(s.id===e.id&&(s={...s,...e}),s));await i({users:s})},[o,i]);return[o,{addOneUser:d,delOneUser:u,mutateOneUser:c,errorUsers:r,loadingUsers:n}]},add:async e=>(await (0,l.T)("/api/user",{method:"POST",headers:{Accept:"application/json"},body:JSON.stringify(e)})).json(),update:async e=>{await (0,l.T)("/api/user",{method:"PUT",body:JSON.stringify(e)})},updateById:async(e,s)=>{await (0,l.T)("/api/user/"+e,{method:"PUT",body:JSON.stringify(s)})},del:async()=>{await (0,l.T)("/api/user",{method:"DELETE"})},delById:async e=>{await (0,l.T)("/api/user/"+e,{method:"DELETE"})},check:async e=>(await (0,l.T)("/api/user/check",{method:"POST",headers:{Accept:"application/json"},body:JSON.stringify(e)})).json()}},87180:(e,s,r)=>{"use strict";r.d(s,{r:()=>_});var t=r(74848),a=r(61580),l=r(26603),i=r(21722),n=r(5337);let o={password:"Please enter a password",passwordTooSmall:e=>"Your password is too small (minimum "+e+" characters)",passwordTooLong:e=>"Your password is too long (maximum "+e+" characters)",passwordRequireLetter:"Your password must contain a letter",passwordRequireNumber:"Your password must contain a number",passwordRequireSymbol:"Your password must contain a symbol"},d=(e,s)=>!(s.length<e),u=(e,s)=>!(s.length>e),c=(e,s)=>-1!==e.search(s),h=(e,s)=>{var r,t;return(null!==(t=null==e?void 0:null===(r=e.password)||void 0===r?void 0:r.requireLetter)&&void 0!==t?!t:!i.bJ)||c(s,/[a-zA-Z]/)},p=(e,s)=>{var r,t;return(null!==(t=null==e?void 0:null===(r=e.password)||void 0===r?void 0:r.requireNumber)&&void 0!==t?!t:!i.gv)||c(s,/\d/)},m=(e,s)=>{var r,t;return(null!==(t=null==e?void 0:null===(r=e.password)||void 0===r?void 0:r.requireSymbol)&&void 0!==t?!t:!i.F)||c(s,/[!@#$%^&*(){}[\]<>?/|.:;_-]/)},y=(e,s,r,t)=>{d(e,r)||t.push(o.passwordTooSmall(e)),u(s,r)||t.push(o.passwordTooLong(s))},g=(e,s,r)=>{h(e,s)||r.push(o.passwordRequireLetter),p(e,s)||r.push(o.passwordRequireNumber),m(e,s)||r.push(o.passwordRequireSymbol)},_=e=>{var s,r,d,u;let{labelCol:c,wrapperCol:h,name:p,label:m,inputPlaceholder:_,inputAutoComplete:v,edit:w,style:x,required:j}=e,[A]=n.A.useSystem(),f=null!==(d=null==A?void 0:null===(s=A.password)||void 0===s?void 0:s.min)&&void 0!==d?d:i.TL,b=null!==(u=null==A?void 0:null===(r=A.password)||void 0===r?void 0:r.max)&&void 0!==u?u:i.Vt;return(0,t.jsx)(a.A.Item,{labelCol:c,wrapperCol:h,name:null!=p?p:"password",label:null!=m?m:"Password",rules:[()=>({validator(e,s){let r=[];return w&&"******"===s?Promise.resolve():s?(y(f,b,s,r),g(A,s,r),r.length)?Promise.reject(Error(r.join("; "))):Promise.resolve():Promise.reject(Error(o.password))}}),{required:!!j,message:""}],style:x,children:(0,t.jsx)(l.A.Password,{placeholder:_,autoComplete:v})})}},32632:(e,s,r)=>{"use strict";r.d(s,{A:()=>f});var t=r(74848),a=r(96540),l=r(14953),i=r.n(l),n=r(91106),o=r.n(n),d=r(17004),u=r(8331),c=r(8350),h=r(21807),p=r(75654),m=r(13452),y=r(22481),g=r(22373),_=r(66188),v=r.n(_),w=r(1025),x=r.n(w);let j=i()(()=>Promise.all([r.e(9438),r.e(3624),r.e(1084),r.e(6603),r.e(6337),r.e(9716),r.e(3902),r.e(1226),r.e(305),r.e(9663),r.e(67)]).then(r.bind(r,18629)).then(e=>e.default.extra.Background),{loadableGenerated:{webpack:()=>[18629]},ssr:!1}),A=e=>{let{text:s,status:r,errors:l}=e,[i,n]=(0,a.useState)([]),[d,_]=(0,a.useState)([]);(0,a.useEffect)(()=>{if(!(null==r?void 0:r.length)){n([]);return}n(r.map((e,s)=>({index:s,status:"finish",icon:0===s?(0,t.jsx)(y.A,{}):void 0,title:e})).filter(e=>e))},[r]),(0,a.useEffect)(()=>{if(!(null==l?void 0:l.length)){_([]);return}_(l.map(e=>{let s=null;return e.includes("docker: command not found")||e.includes("Is the docker daemon running")?s=(0,t.jsxs)(u.A,{className:x().errorCard,children:["There is an error with your Docker installation.",(0,t.jsx)("br",{}),"Please verify that Docker is correctly installed and running."]}):(e.includes("EHOSTUNREACH")||e.includes("ENETUNREACH")||e.includes("ETIMEOUT"))&&(s=(0,t.jsxs)(u.A,{className:x().errorCard,children:["There is an error with your PostgreSQL installation.",(0,t.jsx)("br",{}),'Please verify that postgres Docker container "tanatloc-postgres" is correctly installed and running.']})),(0,t.jsxs)("div",{children:[e,s]},e)}))},[l]);let w=!!(null==r?void 0:r.length)||!!(null==l?void 0:l.length);return(0,t.jsxs)(h.A,{children:[(0,t.jsx)(j,{}),(0,t.jsx)("div",{className:v().logo,children:(0,t.jsx)("img",{src:"/images/logo.svg",alt:"Tanatloc"})}),(0,t.jsx)(u.A,{className:x().loading,styles:{body:{padding:0}},title:(0,t.jsx)("div",{className:x().title,children:(null==l?void 0:l.length)?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(g.A,{className:"warning"}),(0,t.jsx)(p.A.Title,{level:3,style:{margin:"0"},children:"An error occurs"}),(0,t.jsx)(o(),{href:"https://github.com/Airthium/tanatloc/issues/new/choose",target:"_blank",children:"Open an issue"})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(c.A,{size:"large",indicator:(0,t.jsx)(y.A,{})}),null!=s?s:"Loading, please wait..."]})}),children:w?(0,t.jsxs)("div",{className:x().content,children:[d.length?(0,t.jsxs)("div",{className:x().errors,children:[d.map(e=>e),(0,t.jsx)(p.A.Title,{level:5,children:"Please restart the application"})]}):null,(0,t.jsx)("div",{className:x().status,children:(0,t.jsx)(m.A,{direction:"vertical",items:i})})]}):null})]})};A.Simple=()=>(0,t.jsx)(d.A,{style:{height:"100%",width:"100%",justifyContent:"center",alignItems:"center"},children:(0,t.jsx)(u.A,{children:(0,t.jsxs)(d.A,{children:[(0,t.jsx)(c.A,{}),"Loading, please wait..."]})})});let f=A},84219:(e,s,r)=>{"use strict";r.r(s),r.d(s,{default:()=>L});var t=r(74848),a=r(96540),l=r(91106),i=r.n(l),n=r(86715),o=r(21807),d=r(8331),u=r(17004),c=r(75654),h=r(61580),p=r(26603),m=r(43508),y=r(30498),g=r(78252),_=r(40889),v=r(70551),w=r(87180),x=r(57628),j=r(32632),A=r(28952),f=r(249),b=r(5337),T=r(66188),C=r.n(T),E=r(48051),k=r.n(E);let N={user:"Error while loading user",system:"Error while loading system",internal:"Server issue : please try again shortly",alreadyExists:"This email is already registered",passwordMismatch:"Passwords mismatch"},P=async(e,s)=>{let r;try{r=await f.A.add(s)}catch(e){throw new A.L({title:N.internal,err:e})}if(r.alreadyExists)throw new A.L({title:N.alreadyExists,render:(0,t.jsxs)(t.Fragment,{children:["We know you! ",(0,t.jsx)(i(),{href:"/login",children:"Log in?"})]}),type:"warning"});y.CV?await e.push("/signup/send").catch():await e.push("/login").catch()},S=()=>{let[e,s]=(0,a.useState)(!1),[r,l]=(0,a.useState)(),{dispatch:i}=(0,a.useContext)(g.V2),y=(0,n.useRouter)(),[A,{errorUser:T,loadingUser:E}]=f.A.useUser(),[S,{errorSystem:L,loadingSystem:O}]=b.A.useSystem();(0,a.useEffect)(()=>{T&&i((0,_.CN)({title:N.user,err:T})),L&&i((0,_.CN)({title:N.system,err:L}))},[T,L,i]),(0,a.useEffect)(()=>{(0,v.g)(async()=>{A&&await y.push("/dashboard")})},[A,y]);let U=(0,a.useCallback)(e=>{(0,v.g)(async()=>{s(!0);try{await P(y,e)}catch(e){l(e)}finally{s(!1)}})},[y]);return E||O||A?(0,t.jsx)(j.A,{}):(null==S?void 0:S.allowsignup)?(0,t.jsx)(o.A,{children:(0,t.jsx)(d.A,{bordered:!1,className:k().signup,children:(0,t.jsxs)(u.A,{direction:"vertical",size:"large",className:C().fullWidth,children:[(0,t.jsx)("div",{children:(0,t.jsx)(c.A.Title,{level:1,style:{padding:0,marginBottom:16,fontWeight:500},children:"Sign Up"})}),(0,t.jsxs)(h.A,{requiredMark:"optional",onFinish:U,layout:"vertical",children:[(0,t.jsx)(h.A.Item,{name:"email",label:"Enter your email address",rules:[{required:!0,message:"Email is required"}],children:(0,t.jsx)(p.A,{placeholder:"Email address",autoComplete:"email"})}),(0,t.jsx)(w.r,{name:"password",label:"Choose your password",inputPlaceholder:"Password",inputAutoComplete:"current-password",style:{marginBottom:"14px"}}),(0,t.jsx)(h.A.Item,{name:"passwordConfirmation",label:"Confirm your password",rules:[{required:!0,message:"Password confirmation is required"},e=>{let{getFieldValue:s}=e;return{validator:(e,r)=>r&&s("password")!==r?Promise.reject(Error(N.passwordMismatch)):Promise.resolve()}}],style:{marginBottom:"14px"},children:(0,t.jsx)(p.A.Password,{placeholder:"Password",autoComplete:"current-password"})}),(0,t.jsx)(x.jQ,{error:r}),(0,t.jsx)(h.A.Item,{className:k().submit,children:(0,t.jsx)(m.Ay,{type:"primary",loading:e,htmlType:"submit",children:"Finish"})})]})]})})}):(0,t.jsx)(o.A,{children:(0,t.jsx)(d.A,{className:k().signup,children:"The server does not allow signup for now"})})},L=()=>(0,t.jsx)(S,{})},1025:e=>{e.exports={loading:"loading_loading__WR55J",title:"loading_title___LzrV",content:"loading_content__NB5oB",status:"loading_status__3rOKY",errors:"loading_errors__NiPcj",error:"loading_error__3HHUG",errorCard:"loading_errorCard__lZ_jh"}},48051:e=>{e.exports={signup:"signup_signup__5hkI7",submit:"signup_submit__lKl_k"}},66188:e=>{e.exports={variables:'"./variables.css"',colorPrimary:"#fad114",textColorDark:"rgba(0, 0, 0, 0.65)",textColorLight:"rgba(0, 0, 0, 0.45)",logo:"styles_logo__a_88m",displayNone:"styles_displayNone__X5JML",displayFlex:"styles_displayFlex__pvl0H",fullWidth:"styles_fullWidth__ig6Zi",fullHeight:"styles_fullHeight__aD1qp",noScroll:"styles_noScroll__jJYvq",scroll:"styles_scroll___zuDw",noBackground:"styles_noBackground__QOpQc",noBorder:"styles_noBorder__T5mw6",noBorderBottom:"styles_noBorderBottom__5ori7",textWhite:"styles_textWhite__yojx2",textLight:"styles_textLight__QglC7",textDark:"styles_textDark__xPmmk",textOrange:"styles_textOrange__TYZ4a",textGreen:"styles_textGreen__M8GsP",textAlignLeft:"styles_textAlignLeft__Da1jw",textAlignCenter:"styles_textAlignCenter__DSN8m",primaryColor:"styles_primaryColor__lHC0K",backgroundPrimary:"styles_backgroundPrimary__5S8pd"}}},e=>{var s=s=>e(e.s=s);e.O(0,[1807,5391,8331,6603,6380,3452,8065,636,6593,8792],()=>s(95637)),_N_E=e.O()}]);