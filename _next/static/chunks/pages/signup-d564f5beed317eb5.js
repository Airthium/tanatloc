(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7616],{21368:function(e,r,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/signup",function(){return s(80142)}])},74989:function(e,r,s){"use strict";var t;s.d(r,{JT:function(){return i},ah:function(){return o},nq:function(){return a},tE:function(){return l},yL:function(){return n}}),null!==(t=s(34155).env.AUTH_SECRET)&&void 0!==t||Array(33).join("a");let n=6,a=16,i=!0,l=!0,o=!0},96205:function(e,r,s){"use strict";var t;s.d(r,{EQ:function(){return l},kD:function(){return a},o3:function(){return n},x_:function(){return i}});let n=null!==(t=s(34155).env.EMAIL_TOKEN)&&void 0!==t?t:"",a="subscribe",i="passwordRecovery",l="revalidate"},17098:function(e,r,s){"use strict";var t=s(87462),n=s(67294),a=s(18362),i=s(91266),l=n.forwardRef(function(e,r){return n.createElement(i.Z,(0,t.Z)({},e,{ref:r,icon:a.Z}))});r.Z=l},83740:function(e,r,s){"use strict";s.d(r,{Z:function(){return l}});var t=s(87462),n=s(67294),a={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M464 720a48 48 0 1096 0 48 48 0 10-96 0zm16-304v184c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V416c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8zm475.7 440l-416-720c-6.2-10.7-16.9-16-27.7-16s-21.6 5.3-27.7 16l-416 720C56 877.4 71.4 904 96 904h832c24.6 0 40-26.6 27.7-48zm-783.5-27.9L512 239.9l339.8 588.2H172.2z"}}]},name:"warning",theme:"outlined"},i=s(91266),l=n.forwardRef(function(e,r){return n.createElement(i.Z,(0,t.Z)({},e,{ref:r,icon:a}))})},10914:function(e,r,s){"use strict";s.d(r,{R:function(){return u},_:function(){return o}});var t=s(59134),n=s.n(t),a=s(34155);let i=a.env.PORT?parseInt(a.env.PORT):3e3,l=n()()?"http://localhost:"+i:"",o=async(e,r)=>{let s=await fetch(l+e,{method:r?"POST":"GET",headers:{accept:"application/json","Content-Type":"application/json"},...r&&{body:r}}),t=s.headers.get("Content-Type");if(!s.ok){let e=Error("An error occured while fetching data.");throw e.info=(null==t?void 0:t.includes("application/json"))&&await s.json(),e.status=s.status,e}return s.json()},u=async(e,r)=>{var s;let t=await fetch(l+e,{...r,method:null!==(s=null==r?void 0:r.method)&&void 0!==s?s:"GET",headers:{...null==r?void 0:r.headers,"Content-Type":"application/json"}}),n=t.headers.get("Content-Type");if(!t.ok){let e=Error("An error occured while fetching data.");throw e.info=(null==n?void 0:n.includes("application/json"))&&await t.json(),e.status=t.status,e}return t}},69037:function(e,r,s){"use strict";s.d(r,{H:function(){return t}});class t extends Error{constructor(e){var r;super(e.title),this.title=e.title,this.name="APIError",this.render=e.render,this.err=e.err,this.type=null!==(r=e.type)&&void 0!==r?r:"error"}}},27509:function(e,r,s){"use strict";s.d(r,{Z:function(){return i}});var t=s(81758),n=s(67294),a=s(10914),i={useSystem:()=>{var e;let{data:r,error:s,mutate:i}=(0,t.ZP)("/api/system",a._),l=null!==(e=null==r?void 0:r.system)&&void 0!==e?e:{},o=(0,n.useCallback)(async e=>{await i({system:{...l,...e}})},[l,i]);return[l,{mutateSystem:o,errorSystem:s,loadingSystem:!r}]},update:async e=>{await (0,a.R)("/api/system",{method:"PUT",body:JSON.stringify(e)})}}},30792:function(e,r,s){"use strict";s.d(r,{Z:function(){return i}});var t=s(81758),n=s(67294),a=s(10914),i={useUser:()=>{let{data:e,error:r,mutate:s}=(0,t.ZP)("/api/user",a._),i=null==e?void 0:e.user,l=(0,n.useCallback)(async e=>{await s({user:{...i,...e}})},[i,s]);return[i,{mutateUser:l,clearUser:(0,n.useCallback)(async()=>{await s({user:void 0})},[s]),errorUser:(null==r?void 0:r.status)===401?void 0:r,loadingUser:(null==r?void 0:r.status)!==401&&!e}]},useUsers:()=>{var e;let{data:r,error:s,mutate:i}=(0,t.ZP)("/api/users",a._),l=null!==(e=null==r?void 0:r.users)&&void 0!==e?e:[],o=(0,n.useCallback)(async e=>{let r=[...l,{...e,authorizedplugins:[]}];await i({users:r})},[l,i]),u=(0,n.useCallback)(async e=>{let r=l.filter(r=>r.id!==e.id);await i({users:r})},[l,i]),d=(0,n.useCallback)(async e=>{let r=l.map(r=>(r.id===e.id&&(r={...r,...e}),r));await i({users:r})},[l,i]);return[l,{addOneUser:o,delOneUser:u,mutateOneUser:d,errorUsers:s,loadingUsers:!r}]},add:async e=>(await (0,a.R)("/api/user",{method:"POST",headers:{Accept:"application/json"},body:JSON.stringify(e)})).json(),update:async e=>{await (0,a.R)("/api/user",{method:"PUT",body:JSON.stringify(e)})},updateById:async(e,r)=>{await (0,a.R)("/api/user/"+e,{method:"PUT",body:JSON.stringify(r)})},del:async()=>{await (0,a.R)("/api/user",{method:"DELETE"})},delById:async e=>{await (0,a.R)("/api/user/"+e,{method:"DELETE"})},check:async e=>(await (0,a.R)("/api/user/check",{method:"POST",headers:{Accept:"application/json"},body:JSON.stringify(e)})).json()}},6280:function(e,r,s){"use strict";s.d(r,{o:function(){return _}});var t=s(85893),n=s(60594),a=s(27829),i=s(74989),l=s(27509);let o={password:"Please enter a password",passwordTooSmall:e=>"Your password is too small (minimum "+e+" characters)",passwordTooLong:e=>"Your password is too long (maximum "+e+" characters)",passwordRequireLetter:"Your password must contain a letter",passwordRequireNumber:"Your password must contain a number",passwordRequireSymbol:"Your password must contain a symbol"},u=(e,r)=>!(r.length<e),d=(e,r)=>!(r.length>e),c=(e,r)=>-1!==e.search(r),h=(e,r)=>{var s,t;return(null!==(t=null==e?void 0:null===(s=e.password)||void 0===s?void 0:s.requireLetter)&&void 0!==t?!t:!i.JT)||c(r,/[a-zA-Z]/)},m=(e,r)=>{var s,t;return(null!==(t=null==e?void 0:null===(s=e.password)||void 0===s?void 0:s.requireNumber)&&void 0!==t?!t:!i.tE)||c(r,/\d/)},p=(e,r)=>{var s,t;return(null!==(t=null==e?void 0:null===(s=e.password)||void 0===s?void 0:s.requireSymbol)&&void 0!==t?!t:!i.ah)||c(r,/[!@#$%^&*(){}[\]<>?/|.:;_-]/)},y=(e,r,s,t)=>{u(e,s)||t.push(o.passwordTooSmall(e)),d(r,s)||t.push(o.passwordTooLong(r))},g=(e,r,s)=>{h(e,r)||s.push(o.passwordRequireLetter),m(e,r)||s.push(o.passwordRequireNumber),p(e,r)||s.push(o.passwordRequireSymbol)};var _=e=>{var r,s,u,d;let{labelCol:c,wrapperCol:h,name:m,label:p,inputPlaceholder:_,inputAutoComplete:v,edit:w,style:f,required:x}=e,[j]=l.Z.useSystem(),Z=null!==(u=null==j?void 0:null===(r=j.password)||void 0===r?void 0:r.min)&&void 0!==u?u:i.yL,b=null!==(d=null==j?void 0:null===(s=j.password)||void 0===s?void 0:s.max)&&void 0!==d?d:i.nq;return(0,t.jsx)(n.Z.Item,{labelCol:c,wrapperCol:h,name:null!=m?m:"password",label:null!=p?p:"Password",rules:[()=>({validator(e,r){let s=[];return w&&"******"===r?Promise.resolve():r?(y(Z,b,r,s),g(j,r,s),s.length)?Promise.reject(s):Promise.resolve():Promise.reject(o.password)}}),{required:!!x,message:""}],style:f,children:(0,t.jsx)(a.Z.Password,{placeholder:_,autoComplete:v})})}},91093:function(e,r,s){"use strict";var t=s(85893),n=s(67294),a=s(5152),i=s.n(a),l=s(41664),o=s.n(l),u=s(56999),d=s(98123),c=s(47945),h=s(32312),m=s(81812),p=s(95054),y=s(17098),g=s(83740),_=s(41017),v=s.n(_),w=s(69630),f=s.n(w);let x=i()(()=>Promise.all([s.e(3737),s.e(6162),s.e(8764),s.e(4961),s.e(5767),s.e(7365)]).then(s.bind(s,15767)).then(e=>e.default.extra.Background),{loadableGenerated:{webpack:()=>[15767]},ssr:!1}),j=e=>{let{text:r,status:s,errors:a}=e,[i,l]=(0,n.useState)([]),[u,_]=(0,n.useState)([]);(0,n.useEffect)(()=>{if(!(null==s?void 0:s.length)){l([]);return}l(s.map((e,r)=>({index:r,status:"finish",icon:0===r?(0,t.jsx)(y.Z,{}):void 0,title:e})).filter(e=>e))},[s]),(0,n.useEffect)(()=>{if(!(null==a?void 0:a.length)){_([]);return}_(a.map(e=>{let r=null;return e.includes("docker: command not found")||e.includes("Is the docker daemon running")?r=(0,t.jsxs)(d.Z,{className:f().errorCard,children:["There is an error with your Docker installation.",(0,t.jsx)("br",{}),"Please verify that Docker is correctly installed and running."]}):(e.includes("EHOSTUNREACH")||e.includes("ENETUNREACH")||e.includes("ETIMEOUT"))&&(r=(0,t.jsxs)(d.Z,{className:f().errorCard,children:["There is an error with your PostgreSQL installation.",(0,t.jsx)("br",{}),'Please verify that postgres Docker container "tanatloc-postgres" is correctly installed and running.']})),(0,t.jsxs)("div",{children:[e,r]},e)}))},[a]);let w=!!(null==s?void 0:s.length)||!!(null==a?void 0:a.length);return(0,t.jsxs)(h.Z,{children:[(0,t.jsx)(x,{}),(0,t.jsx)("div",{className:v().logo,children:(0,t.jsx)("img",{src:"/images/logo.svg",alt:"Tanatloc"})}),(0,t.jsx)(d.Z,{className:f().loading,styles:{body:{padding:0}},title:(0,t.jsx)("div",{className:f().title,children:(null==a?void 0:a.length)?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(g.Z,{className:"warning"}),(0,t.jsx)(m.Z.Title,{level:3,style:{margin:"0"},children:"An error occurs"}),(0,t.jsx)(o(),{href:"https://github.com/Airthium/tanatloc/issues/new/choose",target:"_blank",children:"Open an issue"})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(c.Z,{size:"large",indicator:(0,t.jsx)(y.Z,{})}),null!=r?r:"Loading, please wait..."]})}),children:w?(0,t.jsxs)("div",{className:f().content,children:[u.length?(0,t.jsxs)("div",{className:f().errors,children:[u.map(e=>e),(0,t.jsx)(m.Z.Title,{level:5,children:"Please restart the application"})]}):null,(0,t.jsx)("div",{className:f().status,children:(0,t.jsx)(p.Z,{direction:"vertical",items:i})})]}):null})]})};j.Simple=()=>(0,t.jsx)(u.Z,{style:{height:"100%",width:"100%",justifyContent:"center",alignItems:"center"},children:(0,t.jsx)(d.Z,{children:(0,t.jsxs)(u.Z,{children:[(0,t.jsx)(c.Z,{}),"Loading, please wait..."]})})}),r.Z=j},80142:function(e,r,s){"use strict";s.r(r),s.d(r,{default:function(){return R}});var t=s(85893),n=s(67294),a=s(41664),i=s.n(a),l=s(11163),o=s(32312),u=s(98123),d=s(56999),c=s(81812),h=s(60594),m=s(27829),p=s(84369),y=s(96205),g=s(56243),_=s(79877),v=s(12732),w=s(6280),f=s(52382),x=s(91093),j=s(69037),Z=s(30792),b=s(27509),E=s(41017),T=s.n(E),P=s(11089),C=s.n(P);let k={user:"Error while loading user",system:"Error while loading system",internal:"Server issue : please try again shortly",alreadyExists:"This email is already registered",passwordMismatch:"Passwords mismatch"},N=async(e,r)=>{let s;try{s=await Z.Z.add(r)}catch(e){throw new j.H({title:k.internal,err:e})}if(s.alreadyExists)throw new j.H({title:k.alreadyExists,render:(0,t.jsxs)(t.Fragment,{children:["We know you! ",(0,t.jsx)(i(),{href:"/login",children:"Log in?"})]}),type:"warning"});y.o3?await e.push("/signup/send").catch():await e.push("/login").catch()};var S=()=>{let[e,r]=(0,n.useState)(!1),[s,a]=(0,n.useState)(),{dispatch:i}=(0,n.useContext)(g.uj),y=(0,l.useRouter)(),[j,{errorUser:E,loadingUser:P}]=Z.Z.useUser(),[S,{errorSystem:R,loadingSystem:O}]=b.Z.useSystem();(0,n.useEffect)(()=>{E&&i((0,_.iT)({title:k.user,err:E})),R&&i((0,_.iT)({title:k.system,err:R}))},[E,R,i]),(0,n.useEffect)(()=>{(0,v.u)(async()=>{j&&await y.push("/dashboard")})},[j,y]);let L=(0,n.useCallback)(e=>{(0,v.u)(async()=>{r(!0);try{await N(y,e)}catch(e){a(e)}finally{r(!1)}})},[y]);return P||O||j?(0,t.jsx)(x.Z,{}):(null==S?void 0:S.allowsignup)?(0,t.jsx)(o.Z,{children:(0,t.jsx)(u.Z,{bordered:!1,className:C().signup,children:(0,t.jsxs)(d.Z,{direction:"vertical",size:"large",className:T().fullWidth,children:[(0,t.jsx)("div",{children:(0,t.jsx)(c.Z.Title,{level:1,style:{padding:0,marginBottom:16,fontWeight:500},children:"Sign Up"})}),(0,t.jsxs)(h.Z,{requiredMark:"optional",onFinish:L,layout:"vertical",children:[(0,t.jsx)(h.Z.Item,{name:"email",label:"Enter your email address",rules:[{required:!0,message:"Email is required"}],children:(0,t.jsx)(m.Z,{placeholder:"Email address",autoComplete:"email"})}),(0,t.jsx)(w.o,{name:"password",label:"Choose your password",inputPlaceholder:"Password",inputAutoComplete:"current-password",style:{marginBottom:"14px"}}),(0,t.jsx)(h.Z.Item,{name:"passwordConfirmation",label:"Confirm your password",rules:[{required:!0,message:"Password confirmation is required"},e=>{let{getFieldValue:r}=e;return{validator:(e,s)=>s&&r("password")!==s?Promise.reject(k.passwordMismatch):Promise.resolve()}}],style:{marginBottom:"14px"},children:(0,t.jsx)(m.Z.Password,{placeholder:"Password",autoComplete:"current-password"})}),(0,t.jsx)(f.Xq,{error:s}),(0,t.jsx)(h.Z.Item,{className:C().submit,children:(0,t.jsx)(p.ZP,{type:"primary",loading:e,htmlType:"submit",children:"Finish"})})]})]})})}):(0,t.jsx)(o.Z,{children:(0,t.jsx)(u.Z,{className:C().signup,children:"The server does not allow signup for now"})})},R=()=>(0,t.jsx)(S,{})},69630:function(e){e.exports={loading:"loading_loading__WR55J",title:"loading_title___LzrV",content:"loading_content__NB5oB",status:"loading_status__3rOKY",errors:"loading_errors__NiPcj",error:"loading_error__3HHUG",errorCard:"loading_errorCard__lZ_jh"}},11089:function(e){e.exports={signup:"signup_signup__5hkI7",submit:"signup_submit__lKl_k"}},41017:function(e){e.exports={variables:'"./variables.css"',colorPrimary:"#fad114",textColorDark:"rgba(0, 0, 0, 0.65)",textColorLight:"rgba(0, 0, 0, 0.45)",logo:"styles_logo__a_88m",displayNone:"styles_displayNone__X5JML",displayFlex:"styles_displayFlex__pvl0H",fullWidth:"styles_fullWidth__ig6Zi",fullHeight:"styles_fullHeight__aD1qp",noScroll:"styles_noScroll__jJYvq",scroll:"styles_scroll___zuDw",noBackground:"styles_noBackground__QOpQc",noBorder:"styles_noBorder__T5mw6",noBorderBottom:"styles_noBorderBottom__5ori7",textWhite:"styles_textWhite__yojx2",textLight:"styles_textLight__QglC7",textDark:"styles_textDark__xPmmk",textOrange:"styles_textOrange__TYZ4a",textGreen:"styles_textGreen__M8GsP",textAlignLeft:"styles_textAlignLeft__Da1jw",textAlignCenter:"styles_textAlignCenter__DSN8m",primaryColor:"styles_primaryColor__lHC0K",backgroundPrimary:"styles_backgroundPrimary__5S8pd"}}},function(e){e.O(0,[2312,688,8485,8123,1715,5054,7829,1758,2888,9774,179],function(){return e(e.s=21368)}),_N_E=e.O()}]);