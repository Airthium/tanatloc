(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7616],{90619:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M464 720a48 48 0 1096 0 48 48 0 10-96 0zm16-304v184c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V416c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8zm475.7 440l-416-720c-6.2-10.7-16.9-16-27.7-16s-21.6 5.3-27.7 16l-416 720C56 877.4 71.4 904 96 904h832c24.6 0 40-26.6 27.7-48zm-783.5-27.9L512 239.9l339.8 588.2H172.2z"}}]},name:"warning",theme:"outlined"}},33649:function(e,t,r){"use strict";Object.defineProperty(t,"Z",{enumerable:!0,get:function(){return o}});var s=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=l(t);if(r&&r.has(e))return r.get(e);var s={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var i=n?Object.getOwnPropertyDescriptor(e,a):null;i&&(i.get||i.set)?Object.defineProperty(s,a,i):s[a]=e[a]}return s.default=e,r&&r.set(e,s),s}(r(67294)),n=i(r(90619)),a=i(r(92074));function i(e){return e&&e.__esModule?e:{default:e}}function l(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(l=function(e){return e?r:t})(e)}var o=s.forwardRef(function(e,t){var r,i;return s.createElement(a.default,(r=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},s=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(s=s.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),s.forEach(function(t){var s;s=r[t],t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s})}return e}({},e),i=i={ref:t,icon:n.default},Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(i)):(function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);r.push.apply(r,s)}return r})(Object(i)).forEach(function(e){Object.defineProperty(r,e,Object.getOwnPropertyDescriptor(i,e))}),r))})},21368:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/signup",function(){return r(65465)}])},59141:function(e,t,r){"use strict";var s;r.d(t,{JT:function(){return i},ah:function(){return o},nq:function(){return a},tE:function(){return l},yL:function(){return n}}),null!==(s=r(83454).env.AUTH_SECRET)&&void 0!==s||Array(33).join("a");let n=6,a=16,i=!0,l=!0,o=!0},21390:function(e,t,r){"use strict";r.d(t,{EQ:function(){return o},kD:function(){return i},o3:function(){return a},x_:function(){return l}});var s,n=r(83454);let a=null!==(s=n.env.EMAIL_TOKEN)&&void 0!==s?s:"",i="subscribe",l="passwordRecovery",o="revalidate"},948:function(e,t,r){"use strict";r.d(t,{R:function(){return u},_:function(){return o}});var s=r(59134),n=r.n(s),a=r(83454);let i=a.env.PORT?parseInt(a.env.PORT):3e3,l=n()()?"http://localhost:"+i:"",o=async(e,t)=>{let r=await fetch(l+e,{method:t?"POST":"GET",headers:{accept:"application/json","Content-Type":"application/json"},...t&&{body:t}}),s=r.headers.get("Content-Type");if(!r.ok){let e=Error("An error occured while fetching data.");throw e.info=(null==s?void 0:s.includes("application/json"))&&await r.json(),e.status=r.status,e}return r.json()},u=async(e,t)=>{var r;let s=await fetch(l+e,{...t,method:null!==(r=null==t?void 0:t.method)&&void 0!==r?r:"GET",headers:{...null==t?void 0:t.headers,"Content-Type":"application/json"}}),n=s.headers.get("Content-Type");if(!s.ok){let e=Error("An error occured while fetching data.");throw e.info=(null==n?void 0:n.includes("application/json"))&&await s.json(),e.status=s.status,e}return s}},77547:function(e,t,r){"use strict";r.d(t,{H:function(){return s}});class s extends Error{constructor(e){var t;super(e.title),this.title=e.title,this.name="APIError",this.render=e.render,this.err=e.err,this.type=null!==(t=e.type)&&void 0!==t?t:"error"}}},751:function(e,t,r){"use strict";r.d(t,{Z:function(){return l}});var s=r(59734),n=r(67294),a=r(948);let i=async e=>{await (0,a.R)("/api/system",{method:"PUT",body:JSON.stringify(e)})};var l={useSystem:()=>{var e;let{data:t,error:r,mutate:i}=(0,s.ZP)("/api/system",a._),l=null!==(e=null==t?void 0:t.system)&&void 0!==e?e:{},o=(0,n.useCallback)(async e=>{await i({system:{...l,...e}})},[l,i]);return[l,{mutateSystem:o,errorSystem:r,loadingSystem:!t}]},update:i}},40144:function(e,t,r){"use strict";r.d(t,{Z:function(){return p}});var s=r(59734),n=r(67294),a=r(948);let i=async e=>{let t=await (0,a.R)("/api/user",{method:"POST",headers:{Accept:"application/json"},body:JSON.stringify(e)});return t.json()},l=async e=>{await (0,a.R)("/api/user",{method:"PUT",body:JSON.stringify(e)})},o=async(e,t)=>{await (0,a.R)("/api/user/"+e,{method:"PUT",body:JSON.stringify(t)})},u=async()=>{await (0,a.R)("/api/user",{method:"DELETE"})},d=async e=>{await (0,a.R)("/api/user/"+e,{method:"DELETE"})},c=async e=>{let t=await (0,a.R)("/api/user/check",{method:"POST",headers:{Accept:"application/json"},body:JSON.stringify(e)});return t.json()};var p={useUser:()=>{let{data:e,error:t,mutate:r}=(0,s.ZP)("/api/user",a._),i=null==e?void 0:e.user,l=(0,n.useCallback)(async e=>{await r({user:{...i,...e}})},[i,r]),o=(0,n.useCallback)(async()=>{await r({user:void 0})},[r]);return[i,{mutateUser:l,clearUser:o,errorUser:(null==t?void 0:t.status)===401?void 0:t,loadingUser:(null==t?void 0:t.status)!==401&&!e}]},useUsers:()=>{var e;let{data:t,error:r,mutate:i}=(0,s.ZP)("/api/users",a._),l=null!==(e=null==t?void 0:t.users)&&void 0!==e?e:[],o=(0,n.useCallback)(async e=>{let t=[...l,{...e,authorizedplugins:[]}];await i({users:t})},[l,i]),u=(0,n.useCallback)(async e=>{let t=l.filter(t=>t.id!==e.id);await i({users:t})},[l,i]),d=(0,n.useCallback)(async e=>{let t=l.map(t=>(t.id===e.id&&(t={...t,...e}),t));await i({users:t})},[l,i]);return[l,{addOneUser:o,delOneUser:u,mutateOneUser:d,errorUsers:r,loadingUsers:!t}]},add:i,update:l,updateById:o,del:u,delById:d,check:c}},55798:function(e,t,r){"use strict";r.d(t,{o:function(){return g}});var s=r(85893),n=r(97538),a=r(51024),i=r(59141),l=r(751);let o={password:"Please enter a password",passwordTooSmall:e=>"Your password is too small (minimum "+e+" characters)",passwordTooLong:e=>"Your password is too long (maximum "+e+" characters)",passwordRequireLetter:"Your password must contain a letter",passwordRequireNumber:"Your password must contain a number",passwordRequireSymbol:"Your password must contain a symbol"},u=(e,t)=>!(t.length<e),d=(e,t)=>!(t.length>e),c=(e,t)=>-1!==e.search(t),p=(e,t)=>{var r,s;return(null!==(s=null==e?void 0:null===(r=e.password)||void 0===r?void 0:r.requireLetter)&&void 0!==s?!s:!i.JT)||c(t,/[a-zA-Z]/)},h=(e,t)=>{var r,s;return(null!==(s=null==e?void 0:null===(r=e.password)||void 0===r?void 0:r.requireNumber)&&void 0!==s?!s:!i.tE)||c(t,/\d/)},m=(e,t)=>{var r,s;return(null!==(s=null==e?void 0:null===(r=e.password)||void 0===r?void 0:r.requireSymbol)&&void 0!==s?!s:!i.ah)||c(t,/[!@#$%^&*(){}[\]<>?/|.:;_-]/)},y=(e,t,r,s)=>{u(e,r)||s.push(o.passwordTooSmall(e)),d(t,r)||s.push(o.passwordTooLong(t))},f=(e,t,r)=>{p(e,t)||r.push(o.passwordRequireLetter),h(e,t)||r.push(o.passwordRequireNumber),m(e,t)||r.push(o.passwordRequireSymbol)};var g=e=>{var t,r,u,d;let{labelCol:c,wrapperCol:p,name:h,label:m,inputPlaceholder:g,inputAutoComplete:_,edit:v,style:w,required:j}=e,[x]=l.Z.useSystem(),b=null!==(u=null==x?void 0:null===(t=x.password)||void 0===t?void 0:t.min)&&void 0!==u?u:i.yL,P=null!==(d=null==x?void 0:null===(r=x.password)||void 0===r?void 0:r.max)&&void 0!==d?d:i.nq;return(0,s.jsx)(n.Z.Item,{labelCol:c,wrapperCol:p,name:null!=h?h:"password",label:null!=m?m:"Password",rules:[()=>({validator(e,t){let r=[];return v&&"******"===t?Promise.resolve():t?(y(b,P,t,r),f(x,t,r),r.length)?Promise.reject(r):Promise.resolve():Promise.reject(o.password)}}),{required:!!j,message:""}],style:w,children:(0,s.jsx)(a.default.Password,{placeholder:g,autoComplete:_})})}},40561:function(e,t,r){"use strict";var s=r(85893),n=r(67294),a=r(5152),i=r.n(a),l=r(41664),o=r.n(l),u=r(70302),d=r(16373),c=r(74048),p=r(89552),h=r(94704),m=r(53740),y=r(4851),f=r(33649),g=r(35304),_=r.n(g),v=r(92544),w=r.n(v);let j=i()(()=>Promise.all([r.e(3737),r.e(8905),r.e(5143),r.e(1059),r.e(4580),r.e(9120)]).then(r.bind(r,14580)).then(e=>e.default.extra.Background),{loadableGenerated:{webpack:()=>[14580]},ssr:!1}),x=e=>{let{text:t,status:r,errors:a}=e,[i,l]=(0,n.useState)([]),[c,g]=(0,n.useState)([]);(0,n.useEffect)(()=>{if(!(null==r?void 0:r.length)){l([]);return}let e=r.map((e,t)=>({index:t,status:"finish",icon:0===t?(0,s.jsx)(y.default,{}):void 0,title:e})).filter(e=>e);l(e)},[r]),(0,n.useEffect)(()=>{if(!(null==a?void 0:a.length)){g([]);return}g(a.map(e=>{let t=null;return e.includes("docker: command not found")||e.includes("Is the docker daemon running")?t=(0,s.jsxs)(u.Z,{className:w().errorCard,children:["There is an error with your Docker installation.",(0,s.jsx)("br",{}),"Please verify that Docker is correctly installed and running."]}):(e.includes("EHOSTUNREACH")||e.includes("ENETUNREACH")||e.includes("ETIMEOUT"))&&(t=(0,s.jsxs)(u.Z,{className:w().errorCard,children:["There is an error with your PostgreSQL installation.",(0,s.jsx)("br",{}),'Please verify that postgres Docker container "tanatloc-postgres" is correctly installed and running.']})),(0,s.jsxs)("div",{children:[e,t]},e)}))},[a]);let v=!!(null==r?void 0:r.length)||!!(null==a?void 0:a.length);return(0,s.jsxs)(d.Z,{children:[(0,s.jsx)(j,{}),(0,s.jsx)("div",{className:_().logo,children:(0,s.jsx)("img",{src:"/images/logo.svg",alt:"Tanatloc"})}),(0,s.jsx)(u.Z,{className:w().loading,bodyStyle:{padding:0},title:(0,s.jsx)("div",{className:w().title,children:(null==a?void 0:a.length)?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(f.Z,{className:"warning"}),(0,s.jsx)(m.Z.Title,{level:3,style:{margin:"0"},children:"An error occurs"}),(0,s.jsx)(o(),{href:"https://github.com/Airthium/tanatloc/issues/new/choose",target:"_blank",children:"Open an issue"})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(p.default,{size:"large",indicator:(0,s.jsx)(y.default,{})}),null!=t?t:"Loading, please wait..."]})}),children:v?(0,s.jsxs)("div",{className:w().content,children:[c.length?(0,s.jsxs)("div",{className:w().errors,children:[c.map(e=>e),(0,s.jsx)(m.Z.Title,{level:5,children:"Please restart the application"})]}):null,(0,s.jsx)("div",{className:w().status,children:(0,s.jsx)(h.Z,{direction:"vertical",items:i})})]}):null})]})};x.Simple=()=>(0,s.jsx)(c.default,{style:{height:"100%",width:"100%",justifyContent:"center",alignItems:"center"},children:(0,s.jsx)(u.Z,{children:(0,s.jsxs)(c.default,{children:[(0,s.jsx)(p.default,{}),"Loading, please wait..."]})})}),t.Z=x},64352:function(e,t,r){"use strict";r.d(t,{u:function(){return s}});let s=e=>{e().catch(console.error)}},65465:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return R}});var s=r(85893),n=r(67294),a=r(41664),i=r.n(a),l=r(11163),o=r(65400),u=r.n(o),d=r(70302),c=r(97538),p=r(51024),h=r(16373),m=r(74048),y=r(53740),f=r(21390),g=r(8061),_=r(54509),v=r(64352),w=r(55798),j=r(22361),x=r(40561),b=r(77547),P=r(40144),O=r(751),E=r(35304),T=r.n(E),k=r(14888),C=r.n(k);let S={user:"Error while loading user",system:"Error while loading system",internal:"Server issue : please try again shortly",alreadyExists:"This email is already registered",passwordMismatch:"Passwords mismatch"},N=async(e,t)=>{let r;try{r=await P.Z.add(t)}catch(e){throw new b.H({title:S.internal,err:e})}if(r.alreadyExists)throw new b.H({title:S.alreadyExists,render:(0,s.jsxs)(s.Fragment,{children:["We know you! ",(0,s.jsx)(i(),{href:"/login",children:"Log in?"})]}),type:"warning"});f.o3?await e.push("/signup/send").catch():await e.push("/login").catch()};var Z=()=>{let[e,t]=(0,n.useState)(!1),[r,a]=(0,n.useState)(),{dispatch:i}=(0,n.useContext)(g.uj),o=(0,l.useRouter)(),[f,{errorUser:b,loadingUser:E}]=P.Z.useUser(),[k,{errorSystem:Z,loadingSystem:R}]=O.Z.useSystem();(0,n.useEffect)(()=>{b&&i((0,_.iT)({title:S.user,err:b})),Z&&i((0,_.iT)({title:S.system,err:Z}))},[b,Z,i]),(0,n.useEffect)(()=>{(0,v.u)(async()=>{f&&await o.push("/dashboard")})},[f,o]);let L=(0,n.useCallback)(e=>{(0,v.u)(async()=>{t(!0);try{await N(o,e)}catch(e){a(e)}finally{t(!1)}})},[o]);return E||R||f?(0,s.jsx)(x.Z,{}):(null==k?void 0:k.allowsignup)?(0,s.jsx)(h.Z,{children:(0,s.jsx)(d.Z,{bordered:!1,className:C().signup,children:(0,s.jsxs)(m.default,{direction:"vertical",size:"large",className:T().fullWidth,children:[(0,s.jsx)("div",{children:(0,s.jsx)(y.Z.Title,{level:1,style:{padding:0,marginBottom:16,fontWeight:500},children:"Sign Up"})}),(0,s.jsxs)(c.Z,{requiredMark:"optional",onFinish:L,layout:"vertical",children:[(0,s.jsx)(c.Z.Item,{name:"email",label:"Enter your email address",rules:[{required:!0,message:"Email is required"}],children:(0,s.jsx)(p.default,{placeholder:"Email address",autoComplete:"email"})}),(0,s.jsx)(w.o,{name:"password",label:"Choose your password",inputPlaceholder:"Password",inputAutoComplete:"current-password",style:{marginBottom:"14px"}}),(0,s.jsx)(c.Z.Item,{name:"passwordConfirmation",label:"Confirm your password",rules:[{required:!0,message:"Password confirmation is required"},e=>{let{getFieldValue:t}=e;return{validator:(e,r)=>r&&t("password")!==r?Promise.reject(S.passwordMismatch):Promise.resolve()}}],style:{marginBottom:"14px"},children:(0,s.jsx)(p.default.Password,{placeholder:"Password",autoComplete:"current-password"})}),(0,s.jsx)(j.Xq,{error:r}),(0,s.jsx)(c.Z.Item,{className:C().submit,children:(0,s.jsx)(u(),{type:"primary",loading:e,htmlType:"submit",children:"Finish"})})]})]})})}):(0,s.jsx)(h.Z,{children:(0,s.jsx)(d.Z,{className:C().signup,children:"The server does not allow signup for now"})})},R=()=>(0,s.jsx)(Z,{})},92544:function(e){e.exports={loading:"loading_loading__WR55J",title:"loading_title___LzrV",content:"loading_content__NB5oB",status:"loading_status__3rOKY",errors:"loading_errors__NiPcj",error:"loading_error__3HHUG",errorCard:"loading_errorCard__lZ_jh"}},14888:function(e){e.exports={signup:"signup_signup__5hkI7",submit:"signup_submit__lKl_k"}},35304:function(e){e.exports={variables:'"./variables.css"',colorPrimary:"#fad114",textColorDark:"rgba(0, 0, 0, 0.65)",textColorLight:"rgba(0, 0, 0, 0.45)",logo:"styles_logo__a_88m",displayNone:"styles_displayNone__X5JML",displayFlex:"styles_displayFlex__pvl0H",fullWidth:"styles_fullWidth__ig6Zi",fullHeight:"styles_fullHeight__aD1qp",noScroll:"styles_noScroll__jJYvq",scroll:"styles_scroll___zuDw",noBackground:"styles_noBackground__QOpQc",noBorder:"styles_noBorder__T5mw6",noBorderBottom:"styles_noBorderBottom__5ori7",textWhite:"styles_textWhite__yojx2",textLight:"styles_textLight__QglC7",textDark:"styles_textDark__xPmmk",textOrange:"styles_textOrange__TYZ4a",textGreen:"styles_textGreen__M8GsP",textAlignLeft:"styles_textAlignLeft__Da1jw",textAlignCenter:"styles_textAlignCenter__DSN8m",primaryColor:"styles_primaryColor__lHC0K",backgroundPrimary:"styles_backgroundPrimary__5S8pd"}}},function(e){e.O(0,[6373,9003,1350,302,1664,4704,1024,9734,9774,2888,179],function(){return e(e.s=21368)}),_N_E=e.O()}]);