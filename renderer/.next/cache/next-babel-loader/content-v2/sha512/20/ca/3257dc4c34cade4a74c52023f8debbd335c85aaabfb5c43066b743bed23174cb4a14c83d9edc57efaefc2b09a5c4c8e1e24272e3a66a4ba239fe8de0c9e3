{"ast":null,"code":"import { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nimport _Layout from \"antd/lib/layout\";\nimport _Menu from \"antd/lib/menu\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nvar _jsxFileName = \"/home/simon/Documents/Git/Airthium/tanatloc-ssr/renderer/components/dashboard/index.js\";\n\n/** @module renderer/components/dashboard */\nimport { useRouter } from 'next/router';\nimport { useState, useEffect } from 'react';\nimport { AppstoreFilled, ShareAltOutlined, SettingFilled, QuestionCircleFilled, LogoutOutlined } from '@ant-design/icons';\nimport { Error } from '../assets/notification';\nimport Loading from '../../components/loading';\nimport Welcome from './welcome';\nimport Workspace from '../../components/workspace';\nimport Add from '../../components/workspace/add';\nimport Account from '../../components/account';\nimport Help from '../../components/help';\nimport UserAPI from '../../../src/api/user';\nimport WorkspaceAPI from '../../../src/api/workspace';\nimport logout from '../../../src/api/logout';\n/**\n * Errors\n */\n\nconst errors = {\n  logoutError: 'Unable to logout'\n};\n/**\n * Dashboard menu items\n */\n\nconst menuItems = {\n  workspaces: {\n    label: 'My Workspaces',\n    key: 'my_workspaces'\n  },\n  shared: {\n    label: 'Shared With Me',\n    key: 'shared'\n  },\n  account: {\n    label: 'Account Settings',\n    key: 'account'\n  },\n  help: {\n    label: 'I Need Help',\n    key: 'help'\n  },\n  logout: {\n    label: 'Logout',\n    key: 'logout'\n  }\n};\n/**\n * Dashboard\n */\n\nconst Dashboard = () => {\n  // State\n  const {\n    0: currentView,\n    1: setCurrentView\n  } = useState();\n  const {\n    0: currentWorkspace,\n    1: setCurrentWorkspace\n  } = useState(); // Data\n\n  const [user, {\n    mutateUser,\n    loadingUser\n  }] = UserAPI.useUser();\n  const [workspaces] = WorkspaceAPI.useWorkspaces(); // Router\n\n  const router = useRouter();\n  const {\n    page,\n    workspaceId\n  } = router.query; // Not logged -> go to login page\n\n  useEffect(() => {\n    if (!loadingUser && !user) router.replace('/login');\n  }, [user, loadingUser]); // Update workspace\n\n  useEffect(() => {\n    if (currentWorkspace) {\n      const workspace = workspaces === null || workspaces === void 0 ? void 0 : workspaces.find(w => w.id === currentWorkspace.id);\n      if (JSON.stringify(workspace) !== JSON.stringify(currentWorkspace)) setCurrentWorkspace(workspace);\n    }\n  }, [workspaces, currentWorkspace]); // Page effect\n\n  useEffect(() => {\n    if (workspaceId) {\n      var _workspace$owners, _workspace$users;\n\n      const workspace = workspaces === null || workspaces === void 0 ? void 0 : workspaces.find(w => w.id === workspaceId);\n      if (workspace !== null && workspace !== void 0 && (_workspace$owners = workspace.owners) !== null && _workspace$owners !== void 0 && _workspace$owners.find(o => o.id === user.id)) setCurrentView(menuItems.workspaces.key);else if (workspace !== null && workspace !== void 0 && (_workspace$users = workspace.users) !== null && _workspace$users !== void 0 && _workspace$users.find(u => u.id === user.id)) setCurrentView(menuItems.shared.key);\n      setCurrentWorkspace(workspace);\n    } else if (page) {\n      setCurrentView(page);\n    }\n  }, [page, workspaceId]);\n  /**\n   * Menu selection\n   * @param {Object} data {item, key}\n   */\n\n  const onSelect = ({\n    item,\n    key\n  }) => {\n    const subMenuKey = item.props.subMenuKey.replace('-menu-', ''); // In a submenu\n\n    if (subMenuKey === menuItems.workspaces.key || subMenuKey === menuItems.shared.key) {\n      setCurrentView(subMenuKey);\n      router.replace({\n        pathname: '/dashboard',\n        query: {\n          page: subMenuKey\n        }\n      });\n      const workspace = workspaces[key];\n      setCurrentWorkspace(workspace);\n    } else {\n      if (key === menuItems.logout.key) handleLogout();else {\n        setCurrentView(key);\n        router.replace({\n          pathname: '/dashboard',\n          query: {\n            page: key\n          }\n        });\n      }\n    }\n  };\n  /**\n   * Logout\n   */\n\n\n  const handleLogout = async () => {\n    try {\n      await logout();\n      mutateUser({\n        user: null\n      });\n      router.push('/');\n    } catch (err) {\n      Error(errors.logoutError, err);\n    }\n  }; // My / Shared workspaces\n\n\n  let myWorkspaces = [];\n  let sharedWorkspaces = [];\n\n  if (user) {\n    workspaces === null || workspaces === void 0 ? void 0 : workspaces.forEach((workspace, index) => {\n      if (workspace.owners && workspace.owners.find(o => o.id === user.id)) myWorkspaces.push( /*#__PURE__*/_jsxDEV(_Menu.Item, {\n        children: workspace.name\n      }, index, false, {\n        fileName: _jsxFileName,\n        lineNumber: 156,\n        columnNumber: 27\n      }, this));else if (workspace.users && workspace.users.find(u => u.id === user.id)) sharedWorkspaces.push( /*#__PURE__*/_jsxDEV(_Menu.Item, {\n        children: workspace.name\n      }, index, false, {\n        fileName: _jsxFileName,\n        lineNumber: 159,\n        columnNumber: 11\n      }, this));\n    });\n  }\n  /**\n   * On workspaces\n   */\n\n\n  const onWorkspaces = () => {\n    if (!(myWorkspaces !== null && myWorkspaces !== void 0 && myWorkspaces.length)) {\n      setCurrentView();\n    }\n  };\n\n  let displayed;\n\n  switch (currentView) {\n    case menuItems.workspaces.key:\n    case menuItems.shared.key:\n      displayed = /*#__PURE__*/_jsxDEV(Workspace, {\n        workspace: currentWorkspace\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 177,\n        columnNumber: 19\n      }, this);\n      break;\n\n    case menuItems.account.key:\n      displayed = /*#__PURE__*/_jsxDEV(Account, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 180,\n        columnNumber: 19\n      }, this);\n      break;\n\n    case menuItems.help.key:\n      displayed = /*#__PURE__*/_jsxDEV(Help, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 183,\n        columnNumber: 19\n      }, this);\n      break;\n\n    default:\n      displayed = /*#__PURE__*/_jsxDEV(Welcome, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 186,\n        columnNumber: 19\n      }, this);\n  }\n  /**\n   * Render\n   */\n\n\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: loadingUser || !user ? /*#__PURE__*/_jsxDEV(Loading, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 195,\n      columnNumber: 9\n    }, this) : /*#__PURE__*/_jsxDEV(_Layout, {\n      children: [/*#__PURE__*/_jsxDEV(_Layout.Sider, {\n        theme: \"light\",\n        width: \"250\",\n        className: \"Dashboard-sider\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"logo\",\n          children: /*#__PURE__*/_jsxDEV(\"img\", {\n            src: \"/images/logo_enora.svg\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 200,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 199,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(_Menu, {\n          className: \"Dashboard-menu\",\n          theme: \"light\",\n          onClick: onSelect,\n          defaultOpenKeys: [menuItems.workspaces.key, menuItems.shared.key],\n          mode: \"inline\",\n          children: [/*#__PURE__*/_jsxDEV(_Menu.SubMenu, {\n            icon: /*#__PURE__*/_jsxDEV(AppstoreFilled, {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 212,\n              columnNumber: 23\n            }, this),\n            title: menuItems.workspaces.label,\n            onTitleClick: onWorkspaces,\n            children: [myWorkspaces, /*#__PURE__*/_jsxDEV(\"li\", {\n              id: \"Add-workspace-button\",\n              children: /*#__PURE__*/_jsxDEV(Add, {}, \"add\", false, {\n                fileName: _jsxFileName,\n                lineNumber: 218,\n                columnNumber: 19\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 217,\n              columnNumber: 17\n            }, this)]\n          }, menuItems.workspaces.key, true, {\n            fileName: _jsxFileName,\n            lineNumber: 210,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(_Menu.SubMenu, {\n            icon: /*#__PURE__*/_jsxDEV(ShareAltOutlined, {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 223,\n              columnNumber: 23\n            }, this),\n            title: menuItems.shared.label,\n            children: sharedWorkspaces\n          }, menuItems.shared.key, false, {\n            fileName: _jsxFileName,\n            lineNumber: 221,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(_Menu.Item, {\n            icon: /*#__PURE__*/_jsxDEV(SettingFilled, {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 228,\n              columnNumber: 60\n            }, this),\n            children: menuItems.account.label\n          }, menuItems.account.key, false, {\n            fileName: _jsxFileName,\n            lineNumber: 228,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(_Menu.Item, {\n            icon: /*#__PURE__*/_jsxDEV(QuestionCircleFilled, {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 233,\n              columnNumber: 23\n            }, this),\n            children: menuItems.help.label\n          }, menuItems.help.key, false, {\n            fileName: _jsxFileName,\n            lineNumber: 231,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(_Menu.Divider, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 237,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(_Menu.Item, {\n            danger: true,\n            icon: /*#__PURE__*/_jsxDEV(LogoutOutlined, {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 241,\n              columnNumber: 23\n            }, this),\n            children: menuItems.logout.label\n          }, menuItems.logout.key, false, {\n            fileName: _jsxFileName,\n            lineNumber: 238,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 203,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 198,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(_Layout.Content, {\n        className: \"no-scroll\",\n        children: displayed\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 248,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 197,\n      columnNumber: 9\n    }, this)\n  }, void 0, false);\n};\n\nexport default Dashboard;","map":{"version":3,"sources":["/home/simon/Documents/Git/Airthium/tanatloc-ssr/renderer/components/dashboard/index.js"],"names":["useRouter","useState","useEffect","AppstoreFilled","ShareAltOutlined","SettingFilled","QuestionCircleFilled","LogoutOutlined","Error","Loading","Welcome","Workspace","Add","Account","Help","UserAPI","WorkspaceAPI","logout","errors","logoutError","menuItems","workspaces","label","key","shared","account","help","Dashboard","currentView","setCurrentView","currentWorkspace","setCurrentWorkspace","user","mutateUser","loadingUser","useUser","useWorkspaces","router","page","workspaceId","query","replace","workspace","find","w","id","JSON","stringify","owners","o","users","u","onSelect","item","subMenuKey","props","pathname","handleLogout","push","err","myWorkspaces","sharedWorkspaces","forEach","index","name","onWorkspaces","length","displayed"],"mappings":"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","sourcesContent":["/** @module renderer/components/dashboard */\n\nimport { useRouter } from 'next/router'\nimport { useState, useEffect } from 'react'\nimport { Layout, Menu } from 'antd'\nimport {\n  AppstoreFilled,\n  ShareAltOutlined,\n  SettingFilled,\n  QuestionCircleFilled,\n  LogoutOutlined\n} from '@ant-design/icons'\n\nimport { Error } from '../assets/notification'\n\nimport Loading from '../../components/loading'\nimport Welcome from './welcome'\nimport Workspace from '../../components/workspace'\nimport Add from '../../components/workspace/add'\nimport Account from '../../components/account'\nimport Help from '../../components/help'\n\nimport UserAPI from '../../../src/api/user'\nimport WorkspaceAPI from '../../../src/api/workspace'\nimport logout from '../../../src/api/logout'\n\n/**\n * Errors\n */\nconst errors = {\n  logoutError: 'Unable to logout'\n}\n\n/**\n * Dashboard menu items\n */\nconst menuItems = {\n  workspaces: {\n    label: 'My Workspaces',\n    key: 'my_workspaces'\n  },\n  shared: {\n    label: 'Shared With Me',\n    key: 'shared'\n  },\n  account: {\n    label: 'Account Settings',\n    key: 'account'\n  },\n  help: {\n    label: 'I Need Help',\n    key: 'help'\n  },\n  logout: {\n    label: 'Logout',\n    key: 'logout'\n  }\n}\n\n/**\n * Dashboard\n */\nconst Dashboard = () => {\n  // State\n  const [currentView, setCurrentView] = useState()\n  const [currentWorkspace, setCurrentWorkspace] = useState()\n\n  // Data\n  const [user, { mutateUser, loadingUser }] = UserAPI.useUser()\n  const [workspaces] = WorkspaceAPI.useWorkspaces()\n\n  // Router\n  const router = useRouter()\n  const { page, workspaceId } = router.query\n\n  // Not logged -> go to login page\n  useEffect(() => {\n    if (!loadingUser && !user) router.replace('/login')\n  }, [user, loadingUser])\n\n  // Update workspace\n  useEffect(() => {\n    if (currentWorkspace) {\n      const workspace = workspaces?.find((w) => w.id === currentWorkspace.id)\n      if (JSON.stringify(workspace) !== JSON.stringify(currentWorkspace))\n        setCurrentWorkspace(workspace)\n    }\n  }, [workspaces, currentWorkspace])\n\n  // Page effect\n  useEffect(() => {\n    if (workspaceId) {\n      const workspace = workspaces?.find((w) => w.id === workspaceId)\n      if (workspace?.owners?.find((o) => o.id === user.id))\n        setCurrentView(menuItems.workspaces.key)\n      else if (workspace?.users?.find((u) => u.id === user.id))\n        setCurrentView(menuItems.shared.key)\n      setCurrentWorkspace(workspace)\n    } else if (page) {\n      setCurrentView(page)\n    }\n  }, [page, workspaceId])\n\n  /**\n   * Menu selection\n   * @param {Object} data {item, key}\n   */\n  const onSelect = ({ item, key }) => {\n    const subMenuKey = item.props.subMenuKey.replace('-menu-', '')\n\n    // In a submenu\n    if (\n      subMenuKey === menuItems.workspaces.key ||\n      subMenuKey === menuItems.shared.key\n    ) {\n      setCurrentView(subMenuKey)\n      router.replace({\n        pathname: '/dashboard',\n        query: { page: subMenuKey }\n      })\n\n      const workspace = workspaces[key]\n      setCurrentWorkspace(workspace)\n    } else {\n      if (key === menuItems.logout.key) handleLogout()\n      else {\n        setCurrentView(key)\n        router.replace({\n          pathname: '/dashboard',\n          query: { page: key }\n        })\n      }\n    }\n  }\n\n  /**\n   * Logout\n   */\n  const handleLogout = async () => {\n    try {\n      await logout()\n      mutateUser({ user: null })\n\n      router.push('/')\n    } catch (err) {\n      Error(errors.logoutError, err)\n    }\n  }\n\n  // My / Shared workspaces\n  let myWorkspaces = []\n  let sharedWorkspaces = []\n  if (user) {\n    workspaces?.forEach((workspace, index) => {\n      if (workspace.owners && workspace.owners.find((o) => o.id === user.id))\n        myWorkspaces.push(<Menu.Item key={index}>{workspace.name}</Menu.Item>)\n      else if (workspace.users && workspace.users.find((u) => u.id === user.id))\n        sharedWorkspaces.push(\n          <Menu.Item key={index}>{workspace.name}</Menu.Item>\n        )\n    })\n  }\n\n  /**\n   * On workspaces\n   */\n  const onWorkspaces = () => {\n    if (!myWorkspaces?.length) {\n      setCurrentView()\n    }\n  }\n\n  let displayed\n  switch (currentView) {\n    case menuItems.workspaces.key:\n    case menuItems.shared.key:\n      displayed = <Workspace workspace={currentWorkspace} />\n      break\n    case menuItems.account.key:\n      displayed = <Account />\n      break\n    case menuItems.help.key:\n      displayed = <Help />\n      break\n    default:\n      displayed = <Welcome />\n  }\n\n  /**\n   * Render\n   */\n  return (\n    <>\n      {loadingUser || !user ? (\n        <Loading />\n      ) : (\n        <Layout>\n          <Layout.Sider theme=\"light\" width=\"250\" className=\"Dashboard-sider\">\n            <div className=\"logo\">\n              <img src=\"/images/logo_enora.svg\" />\n            </div>\n\n            <Menu\n              className=\"Dashboard-menu\"\n              theme=\"light\"\n              onClick={onSelect}\n              defaultOpenKeys={[menuItems.workspaces.key, menuItems.shared.key]}\n              mode=\"inline\"\n            >\n              <Menu.SubMenu\n                key={menuItems.workspaces.key}\n                icon={<AppstoreFilled />}\n                title={menuItems.workspaces.label}\n                onTitleClick={onWorkspaces}\n              >\n                {myWorkspaces}\n                <li id=\"Add-workspace-button\">\n                  <Add key=\"add\" />\n                </li>\n              </Menu.SubMenu>\n              <Menu.SubMenu\n                key={menuItems.shared.key}\n                icon={<ShareAltOutlined />}\n                title={menuItems.shared.label}\n              >\n                {sharedWorkspaces}\n              </Menu.SubMenu>\n              <Menu.Item key={menuItems.account.key} icon={<SettingFilled />}>\n                {menuItems.account.label}\n              </Menu.Item>\n              <Menu.Item\n                key={menuItems.help.key}\n                icon={<QuestionCircleFilled />}\n              >\n                {menuItems.help.label}\n              </Menu.Item>\n              <Menu.Divider />\n              <Menu.Item\n                key={menuItems.logout.key}\n                danger={true}\n                icon={<LogoutOutlined />}\n              >\n                {menuItems.logout.label}\n              </Menu.Item>\n            </Menu>\n          </Layout.Sider>\n\n          <Layout.Content className=\"no-scroll\">{displayed}</Layout.Content>\n        </Layout>\n      )}\n    </>\n  )\n}\n\nexport default Dashboard\n"]},"metadata":{},"sourceType":"module"}