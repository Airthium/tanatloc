{"ast":null,"code":"import _Layout from \"antd/lib/layout\";\nimport _Typography from \"antd/lib/typography\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport _Menu from \"antd/lib/menu\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\n/** @module renderer/components/project */\nimport { useRouter } from 'next/router';\nimport { useEffect, useState } from 'react';\nimport { ArrowLeftOutlined, CalculatorOutlined, CheckCircleOutlined, CloseCircleOutlined, ExclamationCircleOutlined, PlusOutlined } from '@ant-design/icons';\nimport { Error } from '../assets/notification';\nimport NotAuthorized from '../notauthorized';\nimport View from './view';\nimport Simulation from './simulation';\nimport UserAPI from '../../../src/api/user';\nimport ProjectAPI from '../../../src/api/project';\nimport SimulationAPI from '../../../src/api/simulation';\n/**\n * Menu keys\n */\n\nconst menuKeys = {\n  dashboard: 'dashboard',\n  newSimulation: 'new-simulation',\n  simulation: 'simulation'\n};\n/**\n * Errors\n */\n\nconst errors = {\n  updateError: 'Unable to update the project',\n  addError: 'Unable to add a simulation'\n};\n/**\n * Project\n */\n\nconst Project = () => {\n  // Router\n  const router = useRouter();\n  const {\n    workspaceId,\n    projectId\n  } = router.query; // State\n\n  const {\n    0: selectorVisible,\n    1: setSelectorVisible\n  } = useState(false);\n  const {\n    0: currentSimulation,\n    1: setCurrentSimulation\n  } = useState();\n  const {\n    0: currentType,\n    1: setCurrentType\n  } = useState();\n  const {\n    0: partSummary,\n    1: setPartSummary\n  } = useState(); // Data\n\n  const [user, {\n    loadingUser\n  }] = UserAPI.useUser();\n  const [project, {\n    mutateProject\n  }] = ProjectAPI.useProject(projectId || '');\n  const [simulations, {\n    addOneSimulation\n  }] = SimulationAPI.useSimulations(project.simulations); // Not logged -> go to login page\n\n  useEffect(() => {\n    if (!loadingUser && !user) router.replace('/login');\n  }, [user, loadingUser]); // Modified simulation\n\n  useEffect(() => {\n    const simulation = simulations.find(s => s.id === (currentSimulation === null || currentSimulation === void 0 ? void 0 : currentSimulation.id));\n    if (JSON.stringify(simulation) !== JSON.stringify(currentSimulation)) setCurrentSimulation(simulation);\n  }, [simulations]);\n  /**\n   * Handle title\n   * @param {srting} title Title\n   */\n\n  const handleTitle = async title => {\n    try {\n      // Update\n      await ProjectAPI.update({\n        id: project.id\n      }, [{\n        key: 'title',\n        value: title\n      }]); // Mutate\n\n      mutateProject(_objectSpread(_objectSpread({}, project), {}, {\n        title\n      }));\n    } catch (err) {\n      Error(errors.updateError, err);\n    }\n  };\n  /**\n   * On menu click\n   * @param {Object} data Data { key }\n   */\n\n\n  const onMenuClick = ({\n    key\n  }) => {\n    if (key === menuKeys.dashboard) handleDashboard();else if (key === menuKeys.newSimulation) addSimulation();else if (key.includes(menuKeys.simulation)) selectSimulation(key);\n  };\n  /**\n   * Handle dashboard\n   */\n\n\n  const handleDashboard = () => {\n    router.push({\n      pathname: '/dashboard',\n      query: {\n        workspaceId\n      }\n    });\n  };\n  /**\n   * Add simulation\n   */\n\n\n  const addSimulation = () => {\n    setSelectorVisible(true);\n  };\n  /**\n   * On selector ok\n   * @param {Object} scheme Simulation scheme\n   */\n\n\n  const onSelectorOk = async scheme => {\n    try {\n      // Add in dB\n      const simulation = await SimulationAPI.add({\n        id: project.id\n      }, {\n        name: scheme.algorithm,\n        scheme\n      }); // Mutate\n\n      addOneSimulation(simulation);\n      mutateProject(_objectSpread(_objectSpread({}, project), {}, {\n        simulations: [...(project.simulations || []), simulation]\n      })); // Close selector\n\n      setSelectorVisible(false);\n    } catch (err) {\n      Error(errors.addError, err);\n    }\n  };\n  /**\n   * On selector cancel\n   */\n\n\n  const onSelectorCancel = () => {\n    setSelectorVisible(false);\n  };\n  /**\n   * On simulation select\n   * @param {string} key Key\n   */\n\n\n  const selectSimulation = key => {\n    setCurrentType();\n    const descriptor = key.split('&');\n    const simulationId = descriptor[1];\n    const type = descriptor[2];\n    const simulation = simulations.find(s => s.id === simulationId);\n    setCurrentSimulation(simulation);\n    setCurrentType(type);\n  };\n  /**\n   * On simulation close\n   */\n\n\n  const onSimulationClose = () => {\n    setCurrentSimulation();\n    setCurrentType();\n  }; // Simulations render build\n\n\n  const simulationsRender = simulations.map(s => {\n    var _s$scheme;\n\n    const categories = [];\n    const configuration = (s === null || s === void 0 ? void 0 : (_s$scheme = s.scheme) === null || _s$scheme === void 0 ? void 0 : _s$scheme.configuration) || {};\n    Object.keys(configuration).forEach(key => {\n      var _child$subMenus;\n\n      if (key === 'part') return;\n      const child = configuration[key];\n\n      if (!((_child$subMenus = child.subMenus) !== null && _child$subMenus !== void 0 && _child$subMenus.length)) {\n        categories[child.index] = /*#__PURE__*/_jsx(_Menu.Item, {\n          icon: child.error ? /*#__PURE__*/_jsx(CloseCircleOutlined, {\n            style: {\n              color: 'red'\n            }\n          }) : child.done ? /*#__PURE__*/_jsx(CheckCircleOutlined, {\n            style: {\n              color: 'green'\n            }\n          }) : /*#__PURE__*/_jsx(ExclamationCircleOutlined, {\n            style: {\n              color: 'orange'\n            }\n          }),\n          children: child.title\n        }, menuKeys.simulation + '&' + s.id + '&' + key);\n      } else {\n        const subMenus = child.subMenus.map((subMenu, index) => {\n          return /*#__PURE__*/_jsx(_Menu.Item, {\n            children: subMenu.title\n          }, menuKeys.simulation + '&' + s.id + '&' + key + '&' + index);\n        });\n        categories[child.index] = /*#__PURE__*/_jsx(_Menu.SubMenu, {\n          icon: child.done ? /*#__PURE__*/_jsx(CheckCircleOutlined, {\n            style: {\n              color: 'green'\n            }\n          }) : /*#__PURE__*/_jsx(ExclamationCircleOutlined, {\n            style: {\n              color: 'orange'\n            }\n          }),\n          title: child.title,\n          onTitleClick: onMenuClick,\n          children: subMenus\n        }, menuKeys.simulation + '&' + s.id + '&' + key);\n      }\n    });\n    return /*#__PURE__*/_jsxs(_Menu.SubMenu, {\n      icon: /*#__PURE__*/_jsx(CalculatorOutlined, {}),\n      title: s.name,\n      children: [/*#__PURE__*/_jsx(_Menu.Item, {\n        icon: /*#__PURE__*/_jsx(CheckCircleOutlined, {\n          style: {\n            color: 'green'\n          }\n        }),\n        children: \"About\"\n      }, menuKeys.simulation + '&' + s.id + '&about'), categories]\n    }, menuKeys.simulation + s.id);\n  });\n  /**\n   * Render\n   */\n\n  return project === 'Unauthorized' ? /*#__PURE__*/_jsx(NotAuthorized, {}) : /*#__PURE__*/_jsxs(_Layout, {\n    hasSider: true,\n    children: [/*#__PURE__*/_jsxs(_Layout.Sider, {\n      theme: \"light\",\n      className: \"Project-sider\",\n      children: [/*#__PURE__*/_jsx(_Menu, {\n        onClick: onMenuClick,\n        children: /*#__PURE__*/_jsx(_Menu.Item, {\n          icon: /*#__PURE__*/_jsx(ArrowLeftOutlined, {}),\n          children: \"Dashboard\"\n        }, menuKeys.dashboard)\n      }), /*#__PURE__*/_jsx(_Typography.Title, {\n        className: \"Project-title\",\n        level: 4,\n        editable: {\n          onChange: handleTitle,\n          maxLength: 50\n        },\n        children: project.title\n      }), /*#__PURE__*/_jsxs(_Menu, {\n        mode: \"inline\",\n        onClick: onMenuClick,\n        children: [/*#__PURE__*/_jsx(_Menu.Item, {\n          icon: /*#__PURE__*/_jsx(PlusOutlined, {}),\n          children: \"New simulation\"\n        }, menuKeys.newSimulation), simulationsRender]\n      })]\n    }), /*#__PURE__*/_jsxs(_Layout.Content, {\n      className: \"no-scroll relative\",\n      children: [/*#__PURE__*/_jsx(Simulation.Selector, {\n        visible: selectorVisible,\n        onOk: onSelectorOk,\n        onCancel: onSelectorCancel\n      }), /*#__PURE__*/_jsx(Simulation, {\n        project: {\n          id: project.id,\n          simulations: project.simulations\n        },\n        simulation: currentSimulation,\n        type: currentType,\n        part: partSummary,\n        onClose: onSimulationClose\n      }), /*#__PURE__*/_jsx(View, {\n        simulation: currentSimulation,\n        setPartSummary: setPartSummary\n      })]\n    })]\n  });\n};\n\nexport default Project;","map":null,"metadata":{},"sourceType":"module"}