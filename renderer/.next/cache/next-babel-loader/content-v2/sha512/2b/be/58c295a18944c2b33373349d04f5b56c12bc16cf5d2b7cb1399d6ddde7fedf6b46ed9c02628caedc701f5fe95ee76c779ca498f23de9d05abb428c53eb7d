{"ast":null,"code":"import _Layout from \"antd/lib/layout\";\nimport _Popconfirm from \"antd/lib/popconfirm\";\nimport _Button from \"antd/lib/button\";\nimport _Card from \"antd/lib/card\";\nimport _Spin from \"antd/lib/spin\";\nimport _Alert from \"antd/lib/alert\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nimport _Collapse from \"antd/lib/collapse\";\nimport _Space from \"antd/lib/space\";\nimport _Upload from \"antd/lib/upload\";\nimport _Typography from \"antd/lib/typography\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _slicedToArray from \"@babel/runtime/helpers/esm/slicedToArray\";\n\nvar _jsxFileName = \"/home/simon/Documents/Git/Airthium/tanatloc-ssr/renderer/components/project/simulation/geometry/index.js\",\n    _this = this,\n    _s = $RefreshSig$();\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport { useState, useEffect } from 'react';\nimport { DeleteOutlined, DownloadOutlined, LoadingOutlined, PlusOutlined, QuestionCircleOutlined } from '@ant-design/icons';\nimport { Error } from '../../../assets/notification';\nimport SimulationAPI from '../../../../../src/api/simulation';\nimport FileAPI from '../../../../../src/api/file';\n/**\n * Errors simulation/geometry\n * @memberof module:renderer/components/project/simulation\n */\n\nvar errors = {\n  updateError: 'Unable to update the simulation',\n  downloadError: 'Unable to download the file',\n  UNABLE_TO_LOAD: 'Unable to load geometry'\n};\n/**\n * Geometry\n * @memberof module:renderer/components/project/simulation\n * @param {Object} props Props\n */\n\nvar Geometry = function Geometry(_ref) {\n  _s();\n\n  var _part$solids, _part$faces, _part$edges;\n\n  var project = _ref.project,\n      simulation = _ref.simulation,\n      part = _ref.part;\n\n  // State\n  var _useState = useState(false),\n      upload = _useState[0],\n      setUpload = _useState[1];\n\n  var _useState2 = useState(false),\n      loading = _useState2[0],\n      setLoading = _useState2[1];\n\n  var _useState3 = useState(),\n      currentFile = _useState3[0],\n      setCurrentFile = _useState3[1]; // Data\n\n\n  var _SimulationAPI$useSim = SimulationAPI.useSimulations(project === null || project === void 0 ? void 0 : project.simulations),\n      _SimulationAPI$useSim2 = _slicedToArray(_SimulationAPI$useSim, 2),\n      mutateOneSimulation = _SimulationAPI$useSim2[1].mutateOneSimulation; // Effect\n\n\n  useEffect(function () {\n    var file = simulation === null || simulation === void 0 ? void 0 : simulation.scheme.configuration.geometry.file;\n    setCurrentFile(file);\n\n    if (file) {\n      setUpload(false);\n    } else {\n      setUpload(true);\n    }\n  }, [simulation]);\n  /**\n   * Upload check\n   * @param {Object} file File\n   */\n\n  var beforeUpload = function beforeUpload(file) {\n    var goodFormat = file.name.toLowerCase().includes('.stp') || file.name.toLowerCase().includes('.step') || file.name.toLowerCase().includes('.dxf');\n    return goodFormat;\n  };\n  /**\n   * On upload\n   * @param {object} info Info\n   */\n\n\n  var onChange = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(info) {\n      var buffer, diff;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              if (info.file.status === 'uploading') setLoading(true);\n\n              if (!(info.file.status === 'done')) {\n                _context.next = 18;\n                break;\n              }\n\n              _context.next = 4;\n              return getFile(info.file.originFileObj);\n\n            case 4:\n              buffer = _context.sent;\n              // Diff scheme\n              diff = {\n                file: {\n                  name: info.file.name,\n                  uid: info.file.uid,\n                  buffer: Buffer.from(buffer)\n                },\n                done: true\n              };\n              _context.prev = 6;\n              _context.next = 9;\n              return SimulationAPI.update({\n                id: simulation.id\n              }, [{\n                key: 'scheme',\n                type: 'json',\n                method: 'diff',\n                path: ['configuration', 'geometry'],\n                value: diff\n              }]);\n\n            case 9:\n              // Mutate simulation\n              mutateOneSimulation(_objectSpread({}, simulation), true);\n              _context.next = 15;\n              break;\n\n            case 12:\n              _context.prev = 12;\n              _context.t0 = _context[\"catch\"](6);\n              Error(errors.updateError, _context.t0);\n\n            case 15:\n              _context.prev = 15;\n              setLoading(false);\n              return _context.finish(15);\n\n            case 18:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[6, 12, 15, 18]]);\n    }));\n\n    return function onChange(_x) {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n  /**\n   * Get file\n   * @param {Object} file File\n   */\n\n\n  var getFile = /*#__PURE__*/function () {\n    var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(file) {\n      var reader, buffer;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              reader = new FileReader();\n              _context2.next = 3;\n              return new Promise(function (resolve) {\n                reader.addEventListener('load', function () {\n                  resolve(reader.result);\n                });\n                reader.readAsArrayBuffer(file);\n              });\n\n            case 3:\n              buffer = _context2.sent;\n              return _context2.abrupt(\"return\", buffer);\n\n            case 5:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n\n    return function getFile(_x2) {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n  /**\n   * On delete\n   */\n\n\n  var onDelete = /*#__PURE__*/function () {\n    var _ref4 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3() {\n      var diff;\n      return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              // Diff scheme\n              diff = {\n                file: 'remove',\n                done: false\n              };\n              _context3.prev = 1;\n              _context3.next = 4;\n              return SimulationAPI.update({\n                id: simulation.id\n              }, [{\n                key: 'scheme',\n                type: 'json',\n                method: 'diff',\n                path: ['configuration', 'geometry'],\n                value: diff\n              }]);\n\n            case 4:\n              // Mutate\n              mutateOneSimulation(_objectSpread(_objectSpread({}, simulation), {}, {\n                scheme: _objectSpread(_objectSpread({}, simulation.scheme), {}, {\n                  configuration: _objectSpread(_objectSpread({}, simulation.scheme.configuration), {}, {\n                    geometry: _objectSpread(_objectSpread({}, simulation.scheme.configuration.geometry), {}, {\n                      file: undefined,\n                      done: false\n                    })\n                  })\n                })\n              }));\n              _context3.next = 10;\n              break;\n\n            case 7:\n              _context3.prev = 7;\n              _context3.t0 = _context3[\"catch\"](1);\n              Error(errors.updateError, _context3.t0);\n\n            case 10:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3, null, [[1, 7]]);\n    }));\n\n    return function onDelete() {\n      return _ref4.apply(this, arguments);\n    };\n  }();\n\n  var onDownload = /*#__PURE__*/function () {\n    var _ref5 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4() {\n      var file, content, data, url, link;\n      return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n        while (1) {\n          switch (_context4.prev = _context4.next) {\n            case 0:\n              file = {\n                origin: simulation.scheme.configuration.geometry.file.origin,\n                originPath: simulation.scheme.configuration.geometry.file.originPath\n              };\n              _context4.prev = 1;\n              _context4.next = 4;\n              return FileAPI.get({\n                id: simulation.id\n              }, file);\n\n            case 4:\n              content = _context4.sent;\n              data = new File([Buffer.from(content.buffer).toString()], file.origin);\n              url = window.URL.createObjectURL(data);\n              link = document.createElement('a');\n              link.href = url;\n              link.setAttribute('download', file.origin);\n              link.click();\n              link.remove();\n              _context4.next = 17;\n              break;\n\n            case 14:\n              _context4.prev = 14;\n              _context4.t0 = _context4[\"catch\"](1);\n              Error(errors.downloadError, _context4.t0);\n\n            case 17:\n            case \"end\":\n              return _context4.stop();\n          }\n        }\n      }, _callee4, null, [[1, 14]]);\n    }));\n\n    return function onDownload() {\n      return _ref5.apply(this, arguments);\n    };\n  }();\n\n  useEffect(function () {\n    var _window$MathJax;\n\n    (_window$MathJax = window.MathJax) === null || _window$MathJax === void 0 ? void 0 : _window$MathJax.typeset();\n  }, []);\n  /**\n   * Render\n   */\n\n  return /*#__PURE__*/_jsxDEV(_Layout, {\n    children: /*#__PURE__*/_jsxDEV(_Layout.Content, {\n      children: upload ? /*#__PURE__*/_jsxDEV(_Space, {\n        direction: \"vertical\",\n        children: [/*#__PURE__*/_jsxDEV(_Typography.Text, {\n          children: /*#__PURE__*/_jsxDEV(\"b\", {\n            children: \"Upload a geometry\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 218,\n            columnNumber: 15\n          }, _this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 217,\n          columnNumber: 13\n        }, _this), /*#__PURE__*/_jsxDEV(_Typography.Text, {\n          children: \"STEP (3D) of DXF (2D) file\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 220,\n          columnNumber: 13\n        }, _this), /*#__PURE__*/_jsxDEV(_Upload, {\n          accept: \".stp,.step,.dxf\",\n          showUploadList: false,\n          listType: \"picture-card\",\n          beforeUpload: beforeUpload,\n          onChange: onChange,\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            children: [loading ? /*#__PURE__*/_jsxDEV(LoadingOutlined, {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 229,\n              columnNumber: 28\n            }, _this) : /*#__PURE__*/_jsxDEV(PlusOutlined, {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 229,\n              columnNumber: 50\n            }, _this), /*#__PURE__*/_jsxDEV(\"div\", {\n              style: {\n                marginTop: 8\n              },\n              children: \"Upload\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 230,\n              columnNumber: 17\n            }, _this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 228,\n            columnNumber: 15\n          }, _this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 221,\n          columnNumber: 13\n        }, _this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 216,\n        columnNumber: 11\n      }, _this) : /*#__PURE__*/_jsxDEV(_Fragment, {\n        children: [/*#__PURE__*/_jsxDEV(_Card, {\n          title: \"Informations\",\n          children: /*#__PURE__*/_jsxDEV(_Space, {\n            direction: \"vertical\",\n            children: [/*#__PURE__*/_jsxDEV(_Typography.Text, {\n              children: [/*#__PURE__*/_jsxDEV(\"b\", {\n                children: \"File:\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 239,\n                columnNumber: 19\n              }, _this), \" \", currentFile === null || currentFile === void 0 ? void 0 : currentFile.name, ' ']\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 238,\n              columnNumber: 17\n            }, _this), /*#__PURE__*/_jsxDEV(_Typography.Text, {\n              children: [/*#__PURE__*/_jsxDEV(\"b\", {\n                children: \"Unit:\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 242,\n                columnNumber: 19\n              }, _this), \" \\\\(m\\\\)\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 241,\n              columnNumber: 17\n            }, _this), part ? part.error ? /*#__PURE__*/_jsxDEV(_Alert, {\n              message: \"Error\",\n              description: /*#__PURE__*/_jsxDEV(_Fragment, {\n                children: [errors.UNABLE_TO_LOAD, /*#__PURE__*/_jsxDEV(_Collapse, {\n                  ghost: true,\n                  children: /*#__PURE__*/_jsxDEV(_Collapse.Panel, {\n                    header: \"Error\",\n                    children: part.message\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 252,\n                    columnNumber: 29\n                  }, _this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 251,\n                  columnNumber: 27\n                }, _this)]\n              }, void 0, true),\n              type: \"error\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 246,\n              columnNumber: 21\n            }, _this) : /*#__PURE__*/_jsxDEV(_Fragment, {\n              children: [part.solids && /*#__PURE__*/_jsxDEV(_Typography.Text, {\n                children: [/*#__PURE__*/_jsxDEV(\"b\", {\n                  children: \"Number of solids:\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 264,\n                  columnNumber: 27\n                }, _this), \" \", (_part$solids = part.solids) === null || _part$solids === void 0 ? void 0 : _part$solids.length]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 263,\n                columnNumber: 25\n              }, _this), part.faces && /*#__PURE__*/_jsxDEV(_Typography.Text, {\n                children: [/*#__PURE__*/_jsxDEV(\"b\", {\n                  children: \"Number of faces:\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 269,\n                  columnNumber: 27\n                }, _this), \" \", (_part$faces = part.faces) === null || _part$faces === void 0 ? void 0 : _part$faces.length]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 268,\n                columnNumber: 25\n              }, _this), part.edges && /*#__PURE__*/_jsxDEV(_Typography.Text, {\n                children: [/*#__PURE__*/_jsxDEV(\"b\", {\n                  children: \"Number of edges:\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 274,\n                  columnNumber: 27\n                }, _this), \" \", (_part$edges = part.edges) === null || _part$edges === void 0 ? void 0 : _part$edges.length]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 273,\n                columnNumber: 25\n              }, _this)]\n            }, void 0, true) : /*#__PURE__*/_jsxDEV(_Spin, {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 280,\n              columnNumber: 19\n            }, _this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 237,\n            columnNumber: 15\n          }, _this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 236,\n          columnNumber: 13\n        }, _this), /*#__PURE__*/_jsxDEV(_Space, {\n          style: {\n            marginTop: '10px'\n          },\n          children: [/*#__PURE__*/_jsxDEV(_Button, {\n            icon: /*#__PURE__*/_jsxDEV(DownloadOutlined, {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 285,\n              columnNumber: 29\n            }, _this),\n            onClick: onDownload\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 285,\n            columnNumber: 15\n          }, _this), /*#__PURE__*/_jsxDEV(_Popconfirm, {\n            title: \"Are you sure\",\n            icon: /*#__PURE__*/_jsxDEV(QuestionCircleOutlined, {\n              style: {\n                color: 'red'\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 288,\n              columnNumber: 23\n            }, _this),\n            onConfirm: onDelete,\n            children: /*#__PURE__*/_jsxDEV(_Button, {\n              type: \"danger\",\n              icon: /*#__PURE__*/_jsxDEV(DeleteOutlined, {}, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 291,\n                columnNumber: 45\n              }, _this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 291,\n              columnNumber: 17\n            }, _this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 286,\n            columnNumber: 15\n          }, _this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 284,\n          columnNumber: 13\n        }, _this)]\n      }, void 0, true)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 214,\n      columnNumber: 7\n    }, _this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 213,\n    columnNumber: 5\n  }, _this);\n};\n\n_s(Geometry, \"kDeybnx0EvPZJV7huBrcxdaTifk=\", false, function () {\n  return [SimulationAPI.useSimulations];\n});\n\n_c = Geometry;\nexport default Geometry;\n\nvar _c;\n\n$RefreshReg$(_c, \"Geometry\");","map":{"version":3,"sources":["/home/simon/Documents/Git/Airthium/tanatloc-ssr/renderer/components/project/simulation/geometry/index.js"],"names":["useState","useEffect","DeleteOutlined","DownloadOutlined","LoadingOutlined","PlusOutlined","QuestionCircleOutlined","Error","SimulationAPI","FileAPI","errors","updateError","downloadError","UNABLE_TO_LOAD","Geometry","project","simulation","part","upload","setUpload","loading","setLoading","currentFile","setCurrentFile","useSimulations","simulations","mutateOneSimulation","file","scheme","configuration","geometry","beforeUpload","goodFormat","name","toLowerCase","includes","onChange","info","status","getFile","originFileObj","buffer","diff","uid","Buffer","from","done","update","id","key","type","method","path","value","reader","FileReader","Promise","resolve","addEventListener","result","readAsArrayBuffer","onDelete","undefined","onDownload","origin","originPath","get","content","data","File","toString","url","window","URL","createObjectURL","link","document","createElement","href","setAttribute","click","remove","MathJax","typeset","marginTop","error","message","solids","length","faces","edges","color"],"mappings":"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","sourcesContent":["import { useState, useEffect } from 'react'\nimport {\n  message,\n  Alert,\n  Button,\n  Card,\n  Collapse,\n  Layout,\n  Popconfirm,\n  Space,\n  Spin,\n  Typography,\n  Upload\n} from 'antd'\nimport {\n  DeleteOutlined,\n  DownloadOutlined,\n  LoadingOutlined,\n  PlusOutlined,\n  QuestionCircleOutlined\n} from '@ant-design/icons'\n\nimport { Error } from '../../../assets/notification'\n\nimport SimulationAPI from '../../../../../src/api/simulation'\nimport FileAPI from '../../../../../src/api/file'\n\n/**\n * Errors simulation/geometry\n * @memberof module:renderer/components/project/simulation\n */\nconst errors = {\n  updateError: 'Unable to update the simulation',\n  downloadError: 'Unable to download the file',\n  UNABLE_TO_LOAD: 'Unable to load geometry'\n}\n\n/**\n * Geometry\n * @memberof module:renderer/components/project/simulation\n * @param {Object} props Props\n */\nconst Geometry = ({ project, simulation, part }) => {\n  // State\n  const [upload, setUpload] = useState(false)\n  const [loading, setLoading] = useState(false)\n  const [currentFile, setCurrentFile] = useState()\n\n  // Data\n  const [, { mutateOneSimulation }] = SimulationAPI.useSimulations(\n    project?.simulations\n  )\n\n  // Effect\n  useEffect(() => {\n    const file = simulation?.scheme.configuration.geometry.file\n    setCurrentFile(file)\n    if (file) {\n      setUpload(false)\n    } else {\n      setUpload(true)\n    }\n  }, [simulation])\n\n  /**\n   * Upload check\n   * @param {Object} file File\n   */\n  const beforeUpload = (file) => {\n    const goodFormat =\n      file.name.toLowerCase().includes('.stp') ||\n      file.name.toLowerCase().includes('.step') ||\n      file.name.toLowerCase().includes('.dxf')\n    return goodFormat\n  }\n\n  /**\n   * On upload\n   * @param {object} info Info\n   */\n  const onChange = async (info) => {\n    if (info.file.status === 'uploading') setLoading(true)\n\n    if (info.file.status === 'done') {\n      const buffer = await getFile(info.file.originFileObj)\n\n      // Diff scheme\n      const diff = {\n        file: {\n          name: info.file.name,\n          uid: info.file.uid,\n          buffer: Buffer.from(buffer)\n        },\n        done: true\n      }\n\n      try {\n        // Update simulation\n        await SimulationAPI.update({ id: simulation.id }, [\n          {\n            key: 'scheme',\n            type: 'json',\n            method: 'diff',\n            path: ['configuration', 'geometry'],\n            value: diff\n          }\n        ])\n\n        // Mutate simulation\n        mutateOneSimulation(\n          {\n            ...simulation\n          },\n          true\n        )\n      } catch (err) {\n        Error(errors.updateError, err)\n      } finally {\n        setLoading(false)\n      }\n    }\n  }\n\n  /**\n   * Get file\n   * @param {Object} file File\n   */\n  const getFile = async (file) => {\n    const reader = new FileReader()\n    const buffer = await new Promise((resolve) => {\n      reader.addEventListener('load', () => {\n        resolve(reader.result)\n      })\n      reader.readAsArrayBuffer(file)\n    })\n    return buffer\n  }\n\n  /**\n   * On delete\n   */\n  const onDelete = async () => {\n    // Diff scheme\n    const diff = {\n      file: 'remove',\n      done: false\n    }\n\n    try {\n      // Update simulation\n      await SimulationAPI.update({ id: simulation.id }, [\n        {\n          key: 'scheme',\n          type: 'json',\n          method: 'diff',\n          path: ['configuration', 'geometry'],\n          value: diff\n        }\n      ])\n\n      // Mutate\n      mutateOneSimulation({\n        ...simulation,\n        scheme: {\n          ...simulation.scheme,\n          configuration: {\n            ...simulation.scheme.configuration,\n            geometry: {\n              ...simulation.scheme.configuration.geometry,\n              file: undefined,\n              done: false\n            }\n          }\n        }\n      })\n    } catch (err) {\n      Error(errors.updateError, err)\n    }\n  }\n\n  const onDownload = async () => {\n    const file = {\n      origin: simulation.scheme.configuration.geometry.file.origin,\n      originPath: simulation.scheme.configuration.geometry.file.originPath\n    }\n\n    try {\n      const content = await FileAPI.get({ id: simulation.id }, file)\n\n      const data = new File(\n        [Buffer.from(content.buffer).toString()],\n        file.origin\n      )\n      const url = window.URL.createObjectURL(data)\n      const link = document.createElement('a')\n      link.href = url\n      link.setAttribute('download', file.origin)\n      link.click()\n      link.remove()\n    } catch (err) {\n      Error(errors.downloadError, err)\n    }\n  }\n\n  useEffect(() => {\n    window.MathJax?.typeset()\n  }, [])\n\n  /**\n   * Render\n   */\n  return (\n    <Layout>\n      <Layout.Content>\n        {upload ? (\n          <Space direction=\"vertical\">\n            <Typography.Text>\n              <b>Upload a geometry</b>\n            </Typography.Text>\n            <Typography.Text>STEP (3D) of DXF (2D) file</Typography.Text>\n            <Upload\n              accept=\".stp,.step,.dxf\"\n              showUploadList={false}\n              listType=\"picture-card\"\n              beforeUpload={beforeUpload}\n              onChange={onChange}\n            >\n              <div>\n                {loading ? <LoadingOutlined /> : <PlusOutlined />}\n                <div style={{ marginTop: 8 }}>Upload</div>\n              </div>\n            </Upload>\n          </Space>\n        ) : (\n          <>\n            <Card title=\"Informations\">\n              <Space direction=\"vertical\">\n                <Typography.Text>\n                  <b>File:</b> {currentFile?.name}{' '}\n                </Typography.Text>\n                <Typography.Text>\n                  <b>Unit:</b> \\(m\\)\n                </Typography.Text>\n                {part ? (\n                  part.error ? (\n                    <Alert\n                      message=\"Error\"\n                      description={\n                        <>\n                          {errors.UNABLE_TO_LOAD}\n                          <Collapse ghost={true}>\n                            <Collapse.Panel header=\"Error\">\n                              {part.message}\n                            </Collapse.Panel>\n                          </Collapse>\n                        </>\n                      }\n                      type=\"error\"\n                    />\n                  ) : (\n                    <>\n                      {part.solids && (\n                        <Typography.Text>\n                          <b>Number of solids:</b> {part.solids?.length}\n                        </Typography.Text>\n                      )}\n                      {part.faces && (\n                        <Typography.Text>\n                          <b>Number of faces:</b> {part.faces?.length}\n                        </Typography.Text>\n                      )}\n                      {part.edges && (\n                        <Typography.Text>\n                          <b>Number of edges:</b> {part.edges?.length}\n                        </Typography.Text>\n                      )}\n                    </>\n                  )\n                ) : (\n                  <Spin />\n                )}\n              </Space>\n            </Card>\n            <Space style={{ marginTop: '10px' }}>\n              <Button icon={<DownloadOutlined />} onClick={onDownload} />\n              <Popconfirm\n                title=\"Are you sure\"\n                icon={<QuestionCircleOutlined style={{ color: 'red' }} />}\n                onConfirm={onDelete}\n              >\n                <Button type=\"danger\" icon={<DeleteOutlined />} />\n              </Popconfirm>\n            </Space>\n          </>\n        )}\n      </Layout.Content>\n    </Layout>\n  )\n}\n\nexport default Geometry\n"]},"metadata":{},"sourceType":"module"}