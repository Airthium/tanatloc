{"ast":null,"code":"import _Layout from \"antd/lib/layout\";\nimport _Typography from \"antd/lib/typography\";\nimport _Menu from \"antd/lib/menu\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport _toConsumableArray from \"@babel/runtime/helpers/esm/toConsumableArray\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _slicedToArray from \"@babel/runtime/helpers/esm/slicedToArray\";\n\nvar _jsxFileName = \"/home/simon/Documents/Git/Airthium/tanatloc-ssr/renderer/components/project/index.js\",\n    _this = this,\n    _s = $RefreshSig$();\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\n/** @module renderer/components/project */\nimport { useRouter } from 'next/router';\nimport { useEffect, useState } from 'react';\nimport { ArrowLeftOutlined, CalculatorOutlined, CheckCircleOutlined, CloseCircleOutlined, ExclamationCircleOutlined, PlusOutlined } from '@ant-design/icons';\nimport { Error } from '../assets/notification';\nimport NotAuthorized from '../notauthorized';\nimport View from './view';\nimport Simulation from './simulation';\nimport UserAPI from '../../../src/api/user';\nimport ProjectAPI from '../../../src/api/project';\nimport SimulationAPI from '../../../src/api/simulation';\n/**\n * Menu keys\n */\n\nvar menuKeys = {\n  dashboard: 'dashboard',\n  newSimulation: 'new-simulation',\n  simulation: 'simulation'\n};\n/**\n * Errors\n */\n\nvar errors = {\n  updateError: 'Unable to update the project',\n  addError: 'Unable to add a simulation'\n};\n/**\n * Project\n */\n\nvar Project = function Project() {\n  _s();\n\n  // Router\n  var router = useRouter();\n  var _router$query = router.query,\n      workspaceId = _router$query.workspaceId,\n      projectId = _router$query.projectId; // State\n\n  var _useState = useState(false),\n      selectorVisible = _useState[0],\n      setSelectorVisible = _useState[1];\n\n  var _useState2 = useState(),\n      currentSimulation = _useState2[0],\n      setCurrentSimulation = _useState2[1];\n\n  var _useState3 = useState(),\n      currentType = _useState3[0],\n      setCurrentType = _useState3[1];\n\n  var _useState4 = useState(),\n      partSummary = _useState4[0],\n      setPartSummary = _useState4[1]; // Data\n\n\n  var _UserAPI$useUser = UserAPI.useUser(),\n      _UserAPI$useUser2 = _slicedToArray(_UserAPI$useUser, 2),\n      user = _UserAPI$useUser2[0],\n      loadingUser = _UserAPI$useUser2[1].loadingUser;\n\n  var _ProjectAPI$useProjec = ProjectAPI.useProject(projectId || ''),\n      _ProjectAPI$useProjec2 = _slicedToArray(_ProjectAPI$useProjec, 2),\n      project = _ProjectAPI$useProjec2[0],\n      mutateProject = _ProjectAPI$useProjec2[1].mutateProject;\n\n  var _SimulationAPI$useSim = SimulationAPI.useSimulations(project.simulations),\n      _SimulationAPI$useSim2 = _slicedToArray(_SimulationAPI$useSim, 2),\n      simulations = _SimulationAPI$useSim2[0],\n      addOneSimulation = _SimulationAPI$useSim2[1].addOneSimulation; // Not logged -> go to login page\n\n\n  useEffect(function () {\n    if (!loadingUser && !user) router.replace('/login');\n  }, [user, loadingUser]); // Modified simulation\n\n  useEffect(function () {\n    var simulation = simulations.find(function (s) {\n      return s.id === (currentSimulation === null || currentSimulation === void 0 ? void 0 : currentSimulation.id);\n    });\n    if (JSON.stringify(simulation) !== JSON.stringify(currentSimulation)) setCurrentSimulation(simulation);\n  }, [simulations]);\n  /**\n   * Handle title\n   * @param {srting} title Title\n   */\n\n  var handleTitle = /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(title) {\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.prev = 0;\n              _context.next = 3;\n              return ProjectAPI.update({\n                id: project.id\n              }, [{\n                key: 'title',\n                value: title\n              }]);\n\n            case 3:\n              // Mutate\n              mutateProject(_objectSpread(_objectSpread({}, project), {}, {\n                title: title\n              }));\n              _context.next = 9;\n              break;\n\n            case 6:\n              _context.prev = 6;\n              _context.t0 = _context[\"catch\"](0);\n              Error(errors.updateError, _context.t0);\n\n            case 9:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[0, 6]]);\n    }));\n\n    return function handleTitle(_x) {\n      return _ref.apply(this, arguments);\n    };\n  }();\n  /**\n   * On menu click\n   * @param {Object} data Data { key }\n   */\n\n\n  var onMenuClick = function onMenuClick(_ref2) {\n    var key = _ref2.key;\n    if (key === menuKeys.dashboard) handleDashboard();else if (key === menuKeys.newSimulation) addSimulation();else if (key.includes(menuKeys.simulation)) selectSimulation(key);\n  };\n  /**\n   * Handle dashboard\n   */\n\n\n  var handleDashboard = function handleDashboard() {\n    router.push({\n      pathname: '/dashboard',\n      query: {\n        workspaceId: workspaceId\n      }\n    });\n  };\n  /**\n   * Add simulation\n   */\n\n\n  var addSimulation = function addSimulation() {\n    setSelectorVisible(true);\n  };\n  /**\n   * On selector ok\n   * @param {Object} scheme Simulation scheme\n   */\n\n\n  var onSelectorOk = /*#__PURE__*/function () {\n    var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(scheme) {\n      var simulation;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.prev = 0;\n              _context2.next = 3;\n              return SimulationAPI.add({\n                id: project.id\n              }, {\n                name: scheme.algorithm,\n                scheme: scheme\n              });\n\n            case 3:\n              simulation = _context2.sent;\n              // Mutate\n              addOneSimulation(simulation);\n              mutateProject(_objectSpread(_objectSpread({}, project), {}, {\n                simulations: [].concat(_toConsumableArray(project.simulations || []), [simulation])\n              })); // Close selector\n\n              setSelectorVisible(false);\n              _context2.next = 12;\n              break;\n\n            case 9:\n              _context2.prev = 9;\n              _context2.t0 = _context2[\"catch\"](0);\n              Error(errors.addError, _context2.t0);\n\n            case 12:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2, null, [[0, 9]]);\n    }));\n\n    return function onSelectorOk(_x2) {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n  /**\n   * On selector cancel\n   */\n\n\n  var onSelectorCancel = function onSelectorCancel() {\n    setSelectorVisible(false);\n  };\n  /**\n   * On simulation select\n   * @param {string} key Key\n   */\n\n\n  var selectSimulation = function selectSimulation(key) {\n    setCurrentType();\n    var descriptor = key.split('&');\n    var simulationId = descriptor[1];\n    var type = descriptor[2];\n    var simulation = simulations.find(function (s) {\n      return s.id === simulationId;\n    });\n    setCurrentSimulation(simulation);\n    setCurrentType(type);\n  };\n  /**\n   * On simulation close\n   */\n\n\n  var onSimulationClose = function onSimulationClose() {\n    setCurrentSimulation();\n    setCurrentType();\n  }; // Simulations render build\n\n\n  var simulationsRender = simulations.map(function (s) {\n    var _s$scheme;\n\n    var categories = [];\n    var configuration = (s === null || s === void 0 ? void 0 : (_s$scheme = s.scheme) === null || _s$scheme === void 0 ? void 0 : _s$scheme.configuration) || {};\n    Object.keys(configuration).forEach(function (key) {\n      var _child$subMenus;\n\n      if (key === 'part') return;\n      var child = configuration[key];\n\n      if (!((_child$subMenus = child.subMenus) !== null && _child$subMenus !== void 0 && _child$subMenus.length)) {\n        categories[child.index] = /*#__PURE__*/_jsxDEV(_Menu.Item, {\n          icon: child.error ? /*#__PURE__*/_jsxDEV(CloseCircleOutlined, {\n            style: {\n              color: 'red'\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 194,\n            columnNumber: 17\n          }, _this) : child.done ? /*#__PURE__*/_jsxDEV(CheckCircleOutlined, {\n            style: {\n              color: 'green'\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 196,\n            columnNumber: 17\n          }, _this) : /*#__PURE__*/_jsxDEV(ExclamationCircleOutlined, {\n            style: {\n              color: 'orange'\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 198,\n            columnNumber: 17\n          }, _this),\n          children: child.title\n        }, menuKeys.simulation + '&' + s.id + '&' + key, false, {\n          fileName: _jsxFileName,\n          lineNumber: 190,\n          columnNumber: 11\n        }, _this);\n      } else {\n        var subMenus = child.subMenus.map(function (subMenu, index) {\n          return /*#__PURE__*/_jsxDEV(_Menu.Item, {\n            children: subMenu.title\n          }, menuKeys.simulation + '&' + s.id + '&' + key + '&' + index, false, {\n            fileName: _jsxFileName,\n            lineNumber: 208,\n            columnNumber: 13\n          }, _this);\n        });\n        categories[child.index] = /*#__PURE__*/_jsxDEV(_Menu.SubMenu, {\n          icon: child.done ? /*#__PURE__*/_jsxDEV(CheckCircleOutlined, {\n            style: {\n              color: 'green'\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 220,\n            columnNumber: 17\n          }, _this) : /*#__PURE__*/_jsxDEV(ExclamationCircleOutlined, {\n            style: {\n              color: 'orange'\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 222,\n            columnNumber: 17\n          }, _this),\n          title: child.title,\n          onTitleClick: onMenuClick,\n          children: subMenus\n        }, menuKeys.simulation + '&' + s.id + '&' + key, false, {\n          fileName: _jsxFileName,\n          lineNumber: 216,\n          columnNumber: 11\n        }, _this);\n      }\n    });\n    return /*#__PURE__*/_jsxDEV(_Menu.SubMenu, {\n      icon: /*#__PURE__*/_jsxDEV(CalculatorOutlined, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 236,\n        columnNumber: 15\n      }, _this),\n      title: s.name,\n      children: [/*#__PURE__*/_jsxDEV(_Menu.Item, {\n        icon: /*#__PURE__*/_jsxDEV(CheckCircleOutlined, {\n          style: {\n            color: 'green'\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 241,\n          columnNumber: 17\n        }, _this),\n        children: \"About\"\n      }, menuKeys.simulation + '&' + s.id + '&about', false, {\n        fileName: _jsxFileName,\n        lineNumber: 239,\n        columnNumber: 9\n      }, _this), categories]\n    }, menuKeys.simulation + s.id, true, {\n      fileName: _jsxFileName,\n      lineNumber: 234,\n      columnNumber: 7\n    }, _this);\n  });\n  /**\n   * Render\n   */\n\n  return project === 'Unauthorized' ? /*#__PURE__*/_jsxDEV(NotAuthorized, {}, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 254,\n    columnNumber: 5\n  }, _this) : /*#__PURE__*/_jsxDEV(_Layout, {\n    hasSider: true,\n    children: [/*#__PURE__*/_jsxDEV(_Layout.Sider, {\n      theme: \"light\",\n      className: \"Project-sider\",\n      children: [/*#__PURE__*/_jsxDEV(_Menu, {\n        onClick: onMenuClick,\n        children: /*#__PURE__*/_jsxDEV(_Menu.Item, {\n          icon: /*#__PURE__*/_jsxDEV(ArrowLeftOutlined, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 259,\n            columnNumber: 53\n          }, _this),\n          children: \"Dashboard\"\n        }, menuKeys.dashboard, false, {\n          fileName: _jsxFileName,\n          lineNumber: 259,\n          columnNumber: 11\n        }, _this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 258,\n        columnNumber: 9\n      }, _this), /*#__PURE__*/_jsxDEV(_Typography.Title, {\n        className: \"Project-title\",\n        level: 4,\n        editable: {\n          onChange: handleTitle,\n          maxLength: 50\n        },\n        children: project.title\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 263,\n        columnNumber: 9\n      }, _this), /*#__PURE__*/_jsxDEV(_Menu, {\n        mode: \"inline\",\n        onClick: onMenuClick,\n        children: [/*#__PURE__*/_jsxDEV(_Menu.Item, {\n          icon: /*#__PURE__*/_jsxDEV(PlusOutlined, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 275,\n            columnNumber: 57\n          }, _this),\n          children: \"New simulation\"\n        }, menuKeys.newSimulation, false, {\n          fileName: _jsxFileName,\n          lineNumber: 275,\n          columnNumber: 11\n        }, _this), simulationsRender]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 274,\n        columnNumber: 9\n      }, _this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 257,\n      columnNumber: 7\n    }, _this), /*#__PURE__*/_jsxDEV(_Layout.Content, {\n      className: \"no-scroll relative\",\n      children: [/*#__PURE__*/_jsxDEV(Simulation.Selector, {\n        visible: selectorVisible,\n        onOk: onSelectorOk,\n        onCancel: onSelectorCancel\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 282,\n        columnNumber: 9\n      }, _this), /*#__PURE__*/_jsxDEV(Simulation, {\n        project: {\n          id: project.id,\n          simulations: project.simulations\n        },\n        simulation: currentSimulation,\n        type: currentType,\n        part: partSummary,\n        onClose: onSimulationClose\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 287,\n        columnNumber: 9\n      }, _this), /*#__PURE__*/_jsxDEV(View, {\n        simulation: currentSimulation,\n        setPartSummary: setPartSummary\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 294,\n        columnNumber: 9\n      }, _this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 281,\n      columnNumber: 7\n    }, _this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 256,\n    columnNumber: 5\n  }, _this);\n};\n\n_s(Project, \"zCYPn7hS3Rk16EVmXp88zCpkDcA=\", false, function () {\n  return [useRouter, UserAPI.useUser, ProjectAPI.useProject, SimulationAPI.useSimulations];\n});\n\n_c = Project;\nexport default Project;\n\nvar _c;\n\n$RefreshReg$(_c, \"Project\");","map":{"version":3,"sources":["/home/simon/Documents/Git/Airthium/tanatloc-ssr/renderer/components/project/index.js"],"names":["useRouter","useEffect","useState","ArrowLeftOutlined","CalculatorOutlined","CheckCircleOutlined","CloseCircleOutlined","ExclamationCircleOutlined","PlusOutlined","Error","NotAuthorized","View","Simulation","UserAPI","ProjectAPI","SimulationAPI","menuKeys","dashboard","newSimulation","simulation","errors","updateError","addError","Project","router","query","workspaceId","projectId","selectorVisible","setSelectorVisible","currentSimulation","setCurrentSimulation","currentType","setCurrentType","partSummary","setPartSummary","useUser","user","loadingUser","useProject","project","mutateProject","useSimulations","simulations","addOneSimulation","replace","find","s","id","JSON","stringify","handleTitle","title","update","key","value","onMenuClick","handleDashboard","addSimulation","includes","selectSimulation","push","pathname","onSelectorOk","scheme","add","name","algorithm","onSelectorCancel","descriptor","split","simulationId","type","onSimulationClose","simulationsRender","map","categories","configuration","Object","keys","forEach","child","subMenus","length","index","error","color","done","subMenu","onChange","maxLength"],"mappings":"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","sourcesContent":["/** @module renderer/components/project */\n\nimport { useRouter } from 'next/router'\nimport { useEffect, useState } from 'react'\nimport { Layout, Menu, Typography } from 'antd'\nimport {\n  ArrowLeftOutlined,\n  CalculatorOutlined,\n  CheckCircleOutlined,\n  CloseCircleOutlined,\n  ExclamationCircleOutlined,\n  PlusOutlined\n} from '@ant-design/icons'\n\nimport { Error } from '../assets/notification'\n\nimport NotAuthorized from '../notauthorized'\nimport View from './view'\nimport Simulation from './simulation'\n\nimport UserAPI from '../../../src/api/user'\nimport ProjectAPI from '../../../src/api/project'\nimport SimulationAPI from '../../../src/api/simulation'\n\n/**\n * Menu keys\n */\nconst menuKeys = {\n  dashboard: 'dashboard',\n  newSimulation: 'new-simulation',\n  simulation: 'simulation'\n}\n\n/**\n * Errors\n */\nconst errors = {\n  updateError: 'Unable to update the project',\n  addError: 'Unable to add a simulation'\n}\n\n/**\n * Project\n */\nconst Project = () => {\n  // Router\n  const router = useRouter()\n  const { workspaceId, projectId } = router.query\n\n  // State\n  const [selectorVisible, setSelectorVisible] = useState(false)\n  const [currentSimulation, setCurrentSimulation] = useState()\n  const [currentType, setCurrentType] = useState()\n  const [partSummary, setPartSummary] = useState()\n\n  // Data\n  const [user, { loadingUser }] = UserAPI.useUser()\n  const [project, { mutateProject }] = ProjectAPI.useProject(projectId || '')\n  const [simulations, { addOneSimulation }] = SimulationAPI.useSimulations(\n    project.simulations\n  )\n\n  // Not logged -> go to login page\n  useEffect(() => {\n    if (!loadingUser && !user) router.replace('/login')\n  }, [user, loadingUser])\n\n  // Modified simulation\n  useEffect(() => {\n    const simulation = simulations.find((s) => s.id === currentSimulation?.id)\n    if (JSON.stringify(simulation) !== JSON.stringify(currentSimulation))\n      setCurrentSimulation(simulation)\n  }, [simulations])\n\n  /**\n   * Handle title\n   * @param {srting} title Title\n   */\n  const handleTitle = async (title) => {\n    try {\n      // Update\n      await ProjectAPI.update({ id: project.id }, [\n        { key: 'title', value: title }\n      ])\n\n      // Mutate\n      mutateProject({\n        ...project,\n        title\n      })\n    } catch (err) {\n      Error(errors.updateError, err)\n    }\n  }\n\n  /**\n   * On menu click\n   * @param {Object} data Data { key }\n   */\n  const onMenuClick = ({ key }) => {\n    if (key === menuKeys.dashboard) handleDashboard()\n    else if (key === menuKeys.newSimulation) addSimulation()\n    else if (key.includes(menuKeys.simulation)) selectSimulation(key)\n  }\n\n  /**\n   * Handle dashboard\n   */\n  const handleDashboard = () => {\n    router.push({\n      pathname: '/dashboard',\n      query: { workspaceId }\n    })\n  }\n\n  /**\n   * Add simulation\n   */\n  const addSimulation = () => {\n    setSelectorVisible(true)\n  }\n\n  /**\n   * On selector ok\n   * @param {Object} scheme Simulation scheme\n   */\n  const onSelectorOk = async (scheme) => {\n    try {\n      // Add in dB\n      const simulation = await SimulationAPI.add(\n        { id: project.id },\n        { name: scheme.algorithm, scheme }\n      )\n\n      // Mutate\n      addOneSimulation(simulation)\n      mutateProject({\n        ...project,\n        simulations: [...(project.simulations || []), simulation]\n      })\n\n      // Close selector\n      setSelectorVisible(false)\n    } catch (err) {\n      Error(errors.addError, err)\n    }\n  }\n\n  /**\n   * On selector cancel\n   */\n  const onSelectorCancel = () => {\n    setSelectorVisible(false)\n  }\n\n  /**\n   * On simulation select\n   * @param {string} key Key\n   */\n  const selectSimulation = (key) => {\n    setCurrentType()\n\n    const descriptor = key.split('&')\n    const simulationId = descriptor[1]\n    const type = descriptor[2]\n\n    const simulation = simulations.find((s) => s.id === simulationId)\n\n    setCurrentSimulation(simulation)\n    setCurrentType(type)\n  }\n\n  /**\n   * On simulation close\n   */\n  const onSimulationClose = () => {\n    setCurrentSimulation()\n    setCurrentType()\n  }\n\n  // Simulations render build\n  const simulationsRender = simulations.map((s) => {\n    const categories = []\n    const configuration = s?.scheme?.configuration || {}\n    Object.keys(configuration).forEach((key) => {\n      if (key === 'part') return\n      const child = configuration[key]\n      if (!child.subMenus?.length) {\n        categories[child.index] = (\n          <Menu.Item\n            key={menuKeys.simulation + '&' + s.id + '&' + key}\n            icon={\n              child.error ? (\n                <CloseCircleOutlined style={{ color: 'red' }} />\n              ) : child.done ? (\n                <CheckCircleOutlined style={{ color: 'green' }} />\n              ) : (\n                <ExclamationCircleOutlined style={{ color: 'orange' }} />\n              )\n            }\n          >\n            {child.title}\n          </Menu.Item>\n        )\n      } else {\n        const subMenus = child.subMenus.map((subMenu, index) => {\n          return (\n            <Menu.Item\n              key={menuKeys.simulation + '&' + s.id + '&' + key + '&' + index}\n            >\n              {subMenu.title}\n            </Menu.Item>\n          )\n        })\n        categories[child.index] = (\n          <Menu.SubMenu\n            key={menuKeys.simulation + '&' + s.id + '&' + key}\n            icon={\n              child.done ? (\n                <CheckCircleOutlined style={{ color: 'green' }} />\n              ) : (\n                <ExclamationCircleOutlined style={{ color: 'orange' }} />\n              )\n            }\n            title={child.title}\n            onTitleClick={onMenuClick}\n          >\n            {subMenus}\n          </Menu.SubMenu>\n        )\n      }\n    })\n    return (\n      <Menu.SubMenu\n        key={menuKeys.simulation + s.id}\n        icon={<CalculatorOutlined />}\n        title={s.name}\n      >\n        <Menu.Item\n          key={menuKeys.simulation + '&' + s.id + '&about'}\n          icon={<CheckCircleOutlined style={{ color: 'green' }} />}\n        >\n          About\n        </Menu.Item>\n        {categories}\n      </Menu.SubMenu>\n    )\n  })\n\n  /**\n   * Render\n   */\n  return project === 'Unauthorized' ? (\n    <NotAuthorized />\n  ) : (\n    <Layout hasSider={true}>\n      <Layout.Sider theme=\"light\" className=\"Project-sider\">\n        <Menu onClick={onMenuClick}>\n          <Menu.Item key={menuKeys.dashboard} icon={<ArrowLeftOutlined />}>\n            Dashboard\n          </Menu.Item>\n        </Menu>\n        <Typography.Title\n          className=\"Project-title\"\n          level={4}\n          editable={{\n            onChange: handleTitle,\n            maxLength: 50\n          }}\n        >\n          {project.title}\n        </Typography.Title>\n\n        <Menu mode=\"inline\" onClick={onMenuClick}>\n          <Menu.Item key={menuKeys.newSimulation} icon={<PlusOutlined />}>\n            New simulation\n          </Menu.Item>\n          {simulationsRender}\n        </Menu>\n      </Layout.Sider>\n      <Layout.Content className=\"no-scroll relative\">\n        <Simulation.Selector\n          visible={selectorVisible}\n          onOk={onSelectorOk}\n          onCancel={onSelectorCancel}\n        />\n        <Simulation\n          project={{ id: project.id, simulations: project.simulations }}\n          simulation={currentSimulation}\n          type={currentType}\n          part={partSummary}\n          onClose={onSimulationClose}\n        />\n        <View simulation={currentSimulation} setPartSummary={setPartSummary} />\n      </Layout.Content>\n    </Layout>\n  )\n}\n\nexport default Project\n"]},"metadata":{},"sourceType":"module"}