{"ast":null,"code":"import _Layout from \"antd/lib/layout\";\nimport _Collapse from \"antd/lib/collapse\";\nimport _Card from \"antd/lib/card\";\nimport _Space from \"antd/lib/space\";\nimport _Select from \"antd/lib/select\";\nimport _Typography from \"antd/lib/typography\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport _slicedToArray from \"@babel/runtime/helpers/esm/slicedToArray\";\n\nvar _jsxFileName = \"/home/simon/Documents/Git/Airthium/tanatloc-ssr/renderer/components/project/simulation/parameters/index.js\",\n    _this = this,\n    _s = $RefreshSig$();\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport { useState, useEffect } from 'react';\nimport { Error } from '../../../assets/notification';\nimport Formula from '../../../assets/formula';\nimport SimulationAPI from '../../../../../src/api/simulation';\n/**\n * Errors simulation/parameters\n * @memberof module:renderer/components/project/simulation\n */\n\nvar errors = {\n  updateError: 'Unable to update the simulation'\n};\n/**\n * Parameters\n * @memberof module:renderer/components/project/simulation\n * @param {Object} props Props\n */\n\nvar Parameters = function Parameters(_ref) {\n  _s();\n\n  var project = _ref.project,\n      simulation = _ref.simulation;\n\n  // State\n  var _useState = useState({}),\n      values = _useState[0],\n      setValues = _useState[1]; // Data\n\n\n  var subScheme = simulation === null || simulation === void 0 ? void 0 : simulation.scheme.configuration.parameters;\n\n  var _SimulationAPI$useSim = SimulationAPI.useSimulations(project === null || project === void 0 ? void 0 : project.simulations),\n      _SimulationAPI$useSim2 = _slicedToArray(_SimulationAPI$useSim, 2),\n      mutateOneSimulation = _SimulationAPI$useSim2[1].mutateOneSimulation; // Effect\n\n\n  useEffect(function () {\n    var newSimulation = _objectSpread({}, simulation); // Update local\n\n\n    Object.keys(values).forEach(function (key) {\n      var deepValues = values[key];\n      deepValues.forEach(function (value, index) {\n        if (value) newSimulation.scheme.configuration.parameters[key].children[index].value = value;\n      });\n    }); // Diff\n\n    var diff = _objectSpread(_objectSpread({}, newSimulation.scheme.configuration.parameters), {}, {\n      done: true\n    }); // Update\n\n\n    SimulationAPI.update({\n      id: simulation.id\n    }, [{\n      key: 'scheme',\n      type: 'json',\n      method: 'diff',\n      path: ['configuration', 'parameters'],\n      value: diff\n    }]).then(function () {\n      // Mutate\n      mutateOneSimulation(newSimulation);\n    })[\"catch\"](function (err) {\n      Error(errors.updateError, err);\n    });\n  }, [values]);\n  /**\n   * On parameter change\n   * @param {string} key Parameter key\n   * @param {number} index Children index\n   * @param {string} value Value\n   */\n\n  var _onChange = function onChange(key, index, value) {\n    var deepValues = values[key] || [];\n    deepValues[index] = value;\n\n    var newValues = _objectSpread(_objectSpread({}, values), {}, _defineProperty({}, key, deepValues));\n\n    setValues(newValues);\n  }; // Build parameters\n\n\n  var parameters = [];\n  var advanced = [];\n  Object.keys(subScheme).forEach(function (key) {\n    if (key === 'index' || key === 'title' || key == 'done') return;\n    var parameter = subScheme[key];\n    var components = parameter === null || parameter === void 0 ? void 0 : parameter.children.map(function (child, index) {\n      if (child.htmlEntity === 'formula') {\n        return /*#__PURE__*/_jsxDEV(_Typography.Text, {\n          children: [child.label, \":\", /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 101,\n            columnNumber: 27\n          }, _this), /*#__PURE__*/_jsxDEV(Formula, {\n            defaultValue: child.value === undefined ? child[\"default\"] : child.value,\n            onChange: function onChange(value) {\n              return _onChange(key, index, value);\n            },\n            unit: child.unit\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 102,\n            columnNumber: 13\n          }, _this)]\n        }, key + '&' + index, true, {\n          fileName: _jsxFileName,\n          lineNumber: 100,\n          columnNumber: 11\n        }, _this);\n      } else if (child.htmlEntity === 'select') {\n        return /*#__PURE__*/_jsxDEV(_Typography.Text, {\n          children: [child.label, \":\", /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 114,\n            columnNumber: 27\n          }, _this), /*#__PURE__*/_jsxDEV(_Select, {\n            options: child.options,\n            defaultValue: child.value || child[\"default\"],\n            onChange: function onChange(value) {\n              return _onChange(key, index, value);\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 115,\n            columnNumber: 13\n          }, _this)]\n        }, key + '&' + index, true, {\n          fileName: _jsxFileName,\n          lineNumber: 113,\n          columnNumber: 11\n        }, _this);\n      }\n    });\n\n    if (parameter !== null && parameter !== void 0 && parameter.advanced) {\n      advanced.push( /*#__PURE__*/_jsxDEV(_Card, {\n        title: parameter === null || parameter === void 0 ? void 0 : parameter.label,\n        children: /*#__PURE__*/_jsxDEV(_Space, {\n          direction: \"vertical\",\n          children: components\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 128,\n          columnNumber: 11\n        }, _this)\n      }, key, false, {\n        fileName: _jsxFileName,\n        lineNumber: 127,\n        columnNumber: 9\n      }, _this));\n    } else {\n      parameters.push( /*#__PURE__*/_jsxDEV(_Card, {\n        title: parameter === null || parameter === void 0 ? void 0 : parameter.label,\n        children: /*#__PURE__*/_jsxDEV(_Space, {\n          direction: \"vertical\",\n          children: components\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 134,\n          columnNumber: 11\n        }, _this)\n      }, key, false, {\n        fileName: _jsxFileName,\n        lineNumber: 133,\n        columnNumber: 9\n      }, _this));\n    }\n  });\n  /**\n   * Render\n   */\n\n  return /*#__PURE__*/_jsxDEV(_Layout, {\n    children: /*#__PURE__*/_jsxDEV(_Layout.Content, {\n      children: [parameters, /*#__PURE__*/_jsxDEV(_Collapse, {\n        children: /*#__PURE__*/_jsxDEV(_Collapse.Panel, {\n          header: \"Advanced\",\n          children: advanced\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 148,\n          columnNumber: 11\n        }, _this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 147,\n        columnNumber: 9\n      }, _this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 145,\n      columnNumber: 7\n    }, _this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 144,\n    columnNumber: 5\n  }, _this);\n};\n\n_s(Parameters, \"s64NOWPcsMfViGRADsPCX7yabiQ=\", false, function () {\n  return [SimulationAPI.useSimulations];\n});\n\n_c = Parameters;\nexport default Parameters;\n\nvar _c;\n\n$RefreshReg$(_c, \"Parameters\");","map":{"version":3,"sources":["/home/simon/Documents/Git/Airthium/tanatloc-ssr/renderer/components/project/simulation/parameters/index.js"],"names":["useState","useEffect","Error","Formula","SimulationAPI","errors","updateError","Parameters","project","simulation","values","setValues","subScheme","scheme","configuration","parameters","useSimulations","simulations","mutateOneSimulation","newSimulation","Object","keys","forEach","key","deepValues","value","index","children","diff","done","update","id","type","method","path","then","err","onChange","newValues","advanced","parameter","components","map","child","htmlEntity","label","undefined","unit","options","push"],"mappings":"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","sourcesContent":["import { useState, useEffect } from 'react'\nimport { Card, Collapse, Layout, Select, Space, Typography } from 'antd'\n\nimport { Error } from '../../../assets/notification'\nimport Formula from '../../../assets/formula'\n\nimport SimulationAPI from '../../../../../src/api/simulation'\n\n/**\n * Errors simulation/parameters\n * @memberof module:renderer/components/project/simulation\n */\nconst errors = {\n  updateError: 'Unable to update the simulation'\n}\n\n/**\n * Parameters\n * @memberof module:renderer/components/project/simulation\n * @param {Object} props Props\n */\nconst Parameters = ({ project, simulation }) => {\n  // State\n  const [values, setValues] = useState({})\n\n  // Data\n  const subScheme = simulation?.scheme.configuration.parameters\n  const [, { mutateOneSimulation }] = SimulationAPI.useSimulations(\n    project?.simulations\n  )\n\n  // Effect\n  useEffect(() => {\n    const newSimulation = { ...simulation }\n\n    // Update local\n    Object.keys(values).forEach((key) => {\n      const deepValues = values[key]\n      deepValues.forEach((value, index) => {\n        if (value)\n          newSimulation.scheme.configuration.parameters[key].children[\n            index\n          ].value = value\n      })\n    })\n\n    // Diff\n    const diff = {\n      ...newSimulation.scheme.configuration.parameters,\n      done: true\n    }\n\n    // Update\n    SimulationAPI.update({ id: simulation.id }, [\n      {\n        key: 'scheme',\n        type: 'json',\n        method: 'diff',\n        path: ['configuration', 'parameters'],\n        value: diff\n      }\n    ])\n      .then(() => {\n        // Mutate\n        mutateOneSimulation(newSimulation)\n      })\n      .catch((err) => {\n        Error(errors.updateError, err)\n      })\n  }, [values])\n\n  /**\n   * On parameter change\n   * @param {string} key Parameter key\n   * @param {number} index Children index\n   * @param {string} value Value\n   */\n  const onChange = (key, index, value) => {\n    const deepValues = values[key] || []\n    deepValues[index] = value\n    const newValues = {\n      ...values,\n      [key]: deepValues\n    }\n\n    setValues(newValues)\n  }\n\n  // Build parameters\n  const parameters = []\n  const advanced = []\n  Object.keys(subScheme).forEach((key) => {\n    if (key === 'index' || key === 'title' || key == 'done') return\n\n    const parameter = subScheme[key]\n\n    const components = parameter?.children.map((child, index) => {\n      if (child.htmlEntity === 'formula') {\n        return (\n          <Typography.Text key={key + '&' + index}>\n            {child.label}:<br />\n            <Formula\n              defaultValue={\n                child.value === undefined ? child.default : child.value\n              }\n              onChange={(value) => onChange(key, index, value)}\n              unit={child.unit}\n            />\n          </Typography.Text>\n        )\n      } else if (child.htmlEntity === 'select') {\n        return (\n          <Typography.Text key={key + '&' + index}>\n            {child.label}:<br />\n            <Select\n              options={child.options}\n              defaultValue={child.value || child.default}\n              onChange={(value) => onChange(key, index, value)}\n            />\n          </Typography.Text>\n        )\n      }\n    })\n\n    if (parameter?.advanced) {\n      advanced.push(\n        <Card key={key} title={parameter?.label}>\n          <Space direction=\"vertical\">{components}</Space>\n        </Card>\n      )\n    } else {\n      parameters.push(\n        <Card key={key} title={parameter?.label}>\n          <Space direction=\"vertical\">{components}</Space>\n        </Card>\n      )\n    }\n  })\n\n  /**\n   * Render\n   */\n  return (\n    <Layout>\n      <Layout.Content>\n        {parameters}\n        <Collapse>\n          <Collapse.Panel header=\"Advanced\">{advanced}</Collapse.Panel>\n        </Collapse>\n      </Layout.Content>\n    </Layout>\n  )\n}\n\nexport default Parameters\n"]},"metadata":{},"sourceType":"module"}