{"ast":null,"code":"import { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nimport _Button from \"antd/lib/button\";\nimport _Modal from \"antd/lib/modal\";\nimport _InputNumber from \"antd/lib/input-number\";\nimport _Radio from \"antd/lib/radio\";\nimport _Table from \"antd/lib/table\";\nimport _toConsumableArray from \"@babel/runtime/helpers/esm/toConsumableArray\";\nimport _Space from \"antd/lib/space\";\nimport _Typography from \"antd/lib/typography\";\nimport _Avatar from \"antd/lib/avatar\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nvar _jsxFileName = \"/home/simon/Documents/Git/Airthium/tanatloc-ssr/renderer/plugin/rescale/renderer/index.js\",\n    _this = this,\n    _s = $RefreshSig$();\n\nimport { useState, useEffect } from 'react';\nimport { SelectOutlined } from '@ant-design/icons';\n\nvar Rescale = function Rescale(_ref) {\n  _s();\n\n  var data = _ref.data,\n      onSelect = _ref.onSelect;\n\n  // State\n  var _useState = useState(false),\n      visible = _useState[0],\n      setVisible = _useState[1];\n\n  var _useState2 = useState(1),\n      step = _useState2[0],\n      setStep = _useState2[1];\n\n  var _useState3 = useState(),\n      selected = _useState3[0],\n      setSelected = _useState3[1];\n\n  var _useState4 = useState(true),\n      lowPriority = _useState4[0],\n      setLowPriority = _useState4[1];\n\n  var _useState5 = useState(),\n      coresError = _useState5[0],\n      setCoresError = _useState5[1];\n\n  var _useState6 = useState(),\n      numberOfCores = _useState6[0],\n      setNumberOfCores = _useState6[1];\n\n  var _useState7 = useState(0),\n      price = _useState7[0],\n      setPrice = _useState7[1];\n\n  var _useState8 = useState(false),\n      loading = _useState8[0],\n      setLoading = _useState8[1]; // Data\n\n\n  data.coreTypes.forEach(function (d) {\n    d.key = d.name;\n  });\n  var columns = [{\n    title: 'Name',\n    dataIndex: 'name',\n    key: 'name',\n    render: function render(text, record) {\n      return /*#__PURE__*/_jsxDEV(_Space, {\n        children: /*#__PURE__*/_jsxDEV(_Space, {\n          direction: \"vertical\",\n          children: [/*#__PURE__*/_jsxDEV(_Space, {\n            children: [/*#__PURE__*/_jsxDEV(_Avatar, {\n              style: {\n                marginRight: '-20px',\n                background: 'linear-gradient(to right,' + record.color + ', rgba(255, 255, 255, 0))',\n                opacity: 0.5\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 39,\n              columnNumber: 15\n            }, _this), /*#__PURE__*/_jsxDEV(_Typography.Text, {\n              strong: true,\n              children: text\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 49,\n              columnNumber: 15\n            }, _this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 38,\n            columnNumber: 13\n          }, _this), record.processorInfo]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 37,\n          columnNumber: 11\n        }, _this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 36,\n        columnNumber: 9\n      }, _this);\n    }\n  }, {\n    title: 'Cores',\n    dataIndex: 'cores',\n    key: 'cores',\n    render: function render(cores) {\n      return cores.join(', ');\n    }\n  }, {\n    title: 'Memory',\n    dataIndex: 'memory',\n    key: 'memory',\n    render: function render(text) {\n      return text / 1000 + ' Go';\n    }\n  }, {\n    title: 'Pro Price',\n    dataIndex: 'price',\n    key: 'price'\n  }, {\n    title: 'Price',\n    dataIndex: 'lowPriorityPrice',\n    key: 'lowPriorityPrice'\n  }]; // Extend cores\n\n  useEffect(function () {\n    if (selected !== null && selected !== void 0 && selected.cores) {\n      var max = selected.cores[selected.cores.length - 1];\n      var more = Math.floor(1000 / max);\n\n      var cores = _toConsumableArray(selected.cores);\n\n      for (var i = 0; i < more - 1; ++i) {\n        cores.push(max * (i + 2));\n      }\n\n      selected.fullCores = cores;\n    }\n  }, [selected]); // Set price\n\n  useEffect(function () {\n    var currentPrice = numberOfCores * (lowPriority ? selected === null || selected === void 0 ? void 0 : selected.lowPriorityPrice : selected === null || selected === void 0 ? void 0 : selected.price);\n    currentPrice *= 100;\n    currentPrice = Math.round(currentPrice);\n    currentPrice /= 100;\n    setPrice(currentPrice.toFixed(2));\n  }, [selected, numberOfCores, lowPriority]);\n  /**\n   * On row change\n   * @param {string} selectedRowKeys key\n   * @param {Object} selectedRows Seleced\n   */\n\n  var onRowChange = function onRowChange(selectedRowKeys, selectedRows) {\n    setSelected(selectedRows[0]);\n  };\n  /**\n   * Get checkbox props\n   * @param {Object} record Record\n   */\n\n\n  var getCheckboxProps = function getCheckboxProps(record) {\n    return {\n      disabled: record.mustBeRequested\n    };\n  };\n  /**\n   * On ok\n   */\n\n\n  var onOk = function onOk() {\n    if (step === 1) {\n      setNumberOfCores(selected.fullCores[0]);\n      setStep(step + 1);\n    } else {\n      setLoading(true);\n      onSelect({\n        inUseConfiguration: {\n          coreTypes: selected.code,\n          numberOfNodes: numberOfCores,\n          lowPriority: lowPriority\n        }\n      });\n      setLoading(false);\n      onCancel();\n    }\n  };\n  /**\n   * On cancel\n   */\n\n\n  var onCancel = function onCancel() {\n    setVisible(false);\n    setStep(1);\n    setSelected();\n    setLowPriority(true);\n  };\n  /**\n   * On cores change\n   * @param {number} value Value\n   */\n\n\n  var onCoresChange = function onCoresChange(value) {\n    if (!selected.fullCores.includes(value)) {\n      setCoresError(true);\n      setNumberOfCores(value);\n    } else {\n      setCoresError(false);\n      setNumberOfCores(value);\n    }\n  };\n\n  var onCoresStep = function onCoresStep(value, info) {\n    if (info.type === 'up') {\n      var sorted = selected.fullCores.filter(function (c) {\n        return c >= value;\n      });\n      if (sorted.length) onCoresChange(sorted[0]);else onCoresChange(selected.fullCores[selected.fullCores.length - 1]);\n    } else {\n      // down\n      var _sorted = selected.fullCores.filter(function (c) {\n        return c <= value;\n      });\n\n      if (_sorted.length) onCoresChange(_sorted.pop());else onCoresChange(selected.fullCores[0]);\n    }\n  };\n\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(_Modal, {\n      title: \"Rescale plugin\",\n      visible: visible,\n      onCancel: onCancel,\n      okText: step === 1 ? 'Next' : 'Ok',\n      okButtonProps: {\n        disabled: step === 1 && !selected,\n        loading: loading\n      },\n      onOk: onOk,\n      width: \"auto\",\n      children: [step === 1 && /*#__PURE__*/_jsxDEV(_Space, {\n        direction: \"vertical\",\n        children: [/*#__PURE__*/_jsxDEV(_Typography.Text, {\n          strong: true,\n          children: \"Select a coretype:\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 201,\n          columnNumber: 13\n        }, _this), /*#__PURE__*/_jsxDEV(_Table, {\n          dataSource: data.coreTypes,\n          columns: columns,\n          rowSelection: {\n            type: 'radio',\n            onChange: onRowChange,\n            getCheckboxProps: getCheckboxProps\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 202,\n          columnNumber: 13\n        }, _this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 200,\n        columnNumber: 11\n      }, _this), step === 2 && /*#__PURE__*/_jsxDEV(_Space, {\n        children: [/*#__PURE__*/_jsxDEV(_Space, {\n          direction: \"vertical\",\n          children: [/*#__PURE__*/_jsxDEV(_Radio.Group, {\n            onChange: function onChange(e) {\n              return setLowPriority(e.target.value);\n            },\n            value: lowPriority,\n            children: [/*#__PURE__*/_jsxDEV(_Radio, {\n              value: false,\n              children: \"On-Demand Pro\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 220,\n              columnNumber: 17\n            }, _this), /*#__PURE__*/_jsxDEV(_Radio, {\n              value: true,\n              children: \"On-Demand\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 221,\n              columnNumber: 17\n            }, _this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 216,\n            columnNumber: 15\n          }, _this), /*#__PURE__*/_jsxDEV(_Typography.Text, {\n            strong: true,\n            children: \"Number of cores:\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 223,\n            columnNumber: 15\n          }, _this), /*#__PURE__*/_jsxDEV(_InputNumber, {\n            min: selected.fullCores[0],\n            max: selected.fullCores[selected.fullCores.length - 1],\n            value: numberOfCores,\n            onChange: onCoresChange,\n            onStep: onCoresStep,\n            style: {\n              border: coresError && '1px solid red'\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 224,\n            columnNumber: 15\n          }, _this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 215,\n          columnNumber: 13\n        }, _this), /*#__PURE__*/_jsxDEV(_Space, {\n          direction: \"vertical\",\n          children: [/*#__PURE__*/_jsxDEV(_Typography.Text, {\n            strong: true,\n            children: \"Informations:\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 234,\n            columnNumber: 15\n          }, _this), /*#__PURE__*/_jsxDEV(_Typography.Text, {\n            children: [selected.name, \" Core (x\", numberOfCores, \")\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 235,\n            columnNumber: 15\n          }, _this), /*#__PURE__*/_jsxDEV(_Typography.Text, {\n            children: [\"Price: \", price, \" / hour\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 238,\n            columnNumber: 15\n          }, _this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 233,\n          columnNumber: 13\n        }, _this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 214,\n        columnNumber: 11\n      }, _this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 187,\n      columnNumber: 7\n    }, _this), /*#__PURE__*/_jsxDEV(_Space, {\n      children: [/*#__PURE__*/_jsxDEV(_Typography.Text, {\n        children: [\"More information on\", ' ', /*#__PURE__*/_jsxDEV(\"a\", {\n          href: \"https://www.rescale.com/infrastructure/\",\n          target: \"_blank\",\n          children: \"Rescale website\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 246,\n          columnNumber: 11\n        }, _this), \".\"]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 244,\n        columnNumber: 9\n      }, _this), /*#__PURE__*/_jsxDEV(_Button, {\n        onClick: function onClick() {\n          return setVisible(true);\n        },\n        icon: /*#__PURE__*/_jsxDEV(SelectOutlined, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 251,\n          columnNumber: 56\n        }, _this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 251,\n        columnNumber: 9\n      }, _this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 243,\n      columnNumber: 7\n    }, _this)]\n  }, void 0, true);\n};\n\n_s(Rescale, \"4KLYitSoj4o9BQ8baeWbpAE12x0=\");\n\n_c = Rescale;\nexport default Rescale;\n\nvar _c;\n\n$RefreshReg$(_c, \"Rescale\");","map":{"version":3,"sources":["/home/simon/Documents/Git/Airthium/tanatloc-ssr/renderer/plugin/rescale/renderer/index.js"],"names":["useState","useEffect","SelectOutlined","Rescale","data","onSelect","visible","setVisible","step","setStep","selected","setSelected","lowPriority","setLowPriority","coresError","setCoresError","numberOfCores","setNumberOfCores","price","setPrice","loading","setLoading","coreTypes","forEach","d","key","name","columns","title","dataIndex","render","text","record","marginRight","background","color","opacity","processorInfo","cores","join","max","length","more","Math","floor","i","push","fullCores","currentPrice","lowPriorityPrice","round","toFixed","onRowChange","selectedRowKeys","selectedRows","getCheckboxProps","disabled","mustBeRequested","onOk","inUseConfiguration","code","numberOfNodes","onCancel","onCoresChange","value","includes","onCoresStep","info","type","sorted","filter","c","pop","onChange","e","target","border"],"mappings":"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","sourcesContent":["import { useState, useEffect } from 'react'\nimport {\n  Avatar,\n  Button,\n  InputNumber,\n  Modal,\n  Radio,\n  Space,\n  Table,\n  Typography\n} from 'antd'\nimport { SelectOutlined } from '@ant-design/icons'\n\nconst Rescale = ({ data, onSelect }) => {\n  // State\n  const [visible, setVisible] = useState(false)\n  const [step, setStep] = useState(1)\n  const [selected, setSelected] = useState()\n  const [lowPriority, setLowPriority] = useState(true)\n  const [coresError, setCoresError] = useState()\n  const [numberOfCores, setNumberOfCores] = useState()\n  const [price, setPrice] = useState(0)\n  const [loading, setLoading] = useState(false)\n\n  // Data\n  data.coreTypes.forEach((d) => {\n    d.key = d.name\n  })\n\n  const columns = [\n    {\n      title: 'Name',\n      dataIndex: 'name',\n      key: 'name',\n      render: (text, record) => (\n        <Space>\n          <Space direction=\"vertical\">\n            <Space>\n              <Avatar\n                style={{\n                  marginRight: '-20px',\n                  background:\n                    'linear-gradient(to right,' +\n                    record.color +\n                    ', rgba(255, 255, 255, 0))',\n                  opacity: 0.5\n                }}\n              />\n              <Typography.Text strong={true}>{text}</Typography.Text>\n            </Space>\n            {record.processorInfo}\n          </Space>\n        </Space>\n      )\n    },\n    {\n      title: 'Cores',\n      dataIndex: 'cores',\n      key: 'cores',\n      render: (cores) => cores.join(', ')\n    },\n    {\n      title: 'Memory',\n      dataIndex: 'memory',\n      key: 'memory',\n      render: (text) => text / 1000 + ' Go'\n    },\n    {\n      title: 'Pro Price',\n      dataIndex: 'price',\n      key: 'price'\n    },\n    {\n      title: 'Price',\n      dataIndex: 'lowPriorityPrice',\n      key: 'lowPriorityPrice'\n    }\n  ]\n\n  // Extend cores\n  useEffect(() => {\n    if (selected?.cores) {\n      const max = selected.cores[selected.cores.length - 1]\n      const more = Math.floor(1000 / max)\n\n      const cores = [...selected.cores]\n      for (let i = 0; i < more - 1; ++i) {\n        cores.push(max * (i + 2))\n      }\n\n      selected.fullCores = cores\n    }\n  }, [selected])\n\n  // Set price\n  useEffect(() => {\n    let currentPrice =\n      numberOfCores *\n      (lowPriority ? selected?.lowPriorityPrice : selected?.price)\n\n    currentPrice *= 100\n    currentPrice = Math.round(currentPrice)\n    currentPrice /= 100\n\n    setPrice(currentPrice.toFixed(2))\n  }, [selected, numberOfCores, lowPriority])\n\n  /**\n   * On row change\n   * @param {string} selectedRowKeys key\n   * @param {Object} selectedRows Seleced\n   */\n  const onRowChange = (selectedRowKeys, selectedRows) => {\n    setSelected(selectedRows[0])\n  }\n\n  /**\n   * Get checkbox props\n   * @param {Object} record Record\n   */\n  const getCheckboxProps = (record) => ({\n    disabled: record.mustBeRequested\n  })\n\n  /**\n   * On ok\n   */\n  const onOk = () => {\n    if (step === 1) {\n      setNumberOfCores(selected.fullCores[0])\n      setStep(step + 1)\n    } else {\n      setLoading(true)\n      onSelect({\n        inUseConfiguration: {\n          coreTypes: selected.code,\n          numberOfNodes: numberOfCores,\n          lowPriority: lowPriority\n        }\n      })\n      setLoading(false)\n      onCancel()\n    }\n  }\n\n  /**\n   * On cancel\n   */\n  const onCancel = () => {\n    setVisible(false)\n    setStep(1)\n    setSelected()\n    setLowPriority(true)\n  }\n\n  /**\n   * On cores change\n   * @param {number} value Value\n   */\n  const onCoresChange = (value) => {\n    if (!selected.fullCores.includes(value)) {\n      setCoresError(true)\n      setNumberOfCores(value)\n    } else {\n      setCoresError(false)\n      setNumberOfCores(value)\n    }\n  }\n\n  const onCoresStep = (value, info) => {\n    if (info.type === 'up') {\n      const sorted = selected.fullCores.filter((c) => c >= value)\n\n      if (sorted.length) onCoresChange(sorted[0])\n      else onCoresChange(selected.fullCores[selected.fullCores.length - 1])\n    } else {\n      // down\n      const sorted = selected.fullCores.filter((c) => c <= value)\n\n      if (sorted.length) onCoresChange(sorted.pop())\n      else onCoresChange(selected.fullCores[0])\n    }\n  }\n\n  return (\n    <>\n      <Modal\n        title=\"Rescale plugin\"\n        visible={visible}\n        onCancel={onCancel}\n        okText={step === 1 ? 'Next' : 'Ok'}\n        okButtonProps={{\n          disabled: step === 1 && !selected,\n          loading: loading\n        }}\n        onOk={onOk}\n        width=\"auto\"\n      >\n        {step === 1 && (\n          <Space direction=\"vertical\">\n            <Typography.Text strong={true}>Select a coretype:</Typography.Text>\n            <Table\n              dataSource={data.coreTypes}\n              columns={columns}\n              rowSelection={{\n                type: 'radio',\n                onChange: onRowChange,\n                getCheckboxProps: getCheckboxProps\n              }}\n            />\n          </Space>\n        )}\n        {step === 2 && (\n          <Space>\n            <Space direction=\"vertical\">\n              <Radio.Group\n                onChange={(e) => setLowPriority(e.target.value)}\n                value={lowPriority}\n              >\n                <Radio value={false}>On-Demand Pro</Radio>\n                <Radio value={true}>On-Demand</Radio>\n              </Radio.Group>\n              <Typography.Text strong={true}>Number of cores:</Typography.Text>\n              <InputNumber\n                min={selected.fullCores[0]}\n                max={selected.fullCores[selected.fullCores.length - 1]}\n                value={numberOfCores}\n                onChange={onCoresChange}\n                onStep={onCoresStep}\n                style={{ border: coresError && '1px solid red' }}\n              />\n            </Space>\n            <Space direction=\"vertical\">\n              <Typography.Text strong={true}>Informations:</Typography.Text>\n              <Typography.Text>\n                {selected.name} Core (x{numberOfCores})\n              </Typography.Text>\n              <Typography.Text>Price: {price} / hour</Typography.Text>\n            </Space>\n          </Space>\n        )}\n      </Modal>\n      <Space>\n        <Typography.Text>\n          More information on{' '}\n          <a href=\"https://www.rescale.com/infrastructure/\" target=\"_blank\">\n            Rescale website\n          </a>\n          .\n        </Typography.Text>\n        <Button onClick={() => setVisible(true)} icon={<SelectOutlined />} />\n      </Space>\n    </>\n  )\n}\n\nexport default Rescale\n"]},"metadata":{},"sourceType":"module"}