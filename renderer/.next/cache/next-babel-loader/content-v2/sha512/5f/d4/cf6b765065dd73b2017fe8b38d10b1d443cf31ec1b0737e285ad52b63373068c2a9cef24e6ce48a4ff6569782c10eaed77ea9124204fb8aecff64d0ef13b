{"ast":null,"code":"import _Drawer from \"antd/lib/drawer\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nimport _Radio from \"antd/lib/radio\";\nimport _Divider from \"antd/lib/divider\";\nimport _Switch from \"antd/lib/switch\";\nimport _Tooltip from \"antd/lib/tooltip\";\nimport _Button from \"antd/lib/button\";\nimport _Layout from \"antd/lib/layout\";\nimport _Spin from \"antd/lib/spin\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\n\nvar _jsxFileName = \"/home/simon/Documents/Git/Airthium/tanatloc-ssr/renderer/components/project/view/index.js\",\n    _this = this,\n    _s = $RefreshSig$(),\n    _s2 = $RefreshSig$();\n\n/** @module renderer/components/project/view */\nimport { useRef, useState, useEffect } from 'react';\nimport { BorderlessTableOutlined, CompressOutlined, ControlOutlined, DragOutlined, EyeInvisibleOutlined, LoadingOutlined, ZoomInOutlined, ZoomOutOutlined, SelectOutlined, RadiusUprightOutlined, ScissorOutlined, StopOutlined, SyncOutlined, RetweetOutlined } from '@ant-design/icons';\nimport { AmbientLight, Box3, PerspectiveCamera, PointLight, Scene, Sphere, Vector2, Vector3, WebGLRenderer } from 'three/build/three.module';\nimport { Error } from '../../assets/notification';\nimport { RenderPass } from 'three/examples/jsm/postprocessing/RenderPass';\nimport { OutlinePass } from 'three/examples/jsm/postprocessing/OutlinePass';\nimport { EffectComposer } from 'three/examples/jsm/postprocessing/EffectComposer';\nimport { TrackballControls } from '../../../../src/lib/three/controls/TrackballControls';\nimport { AxisHelper } from '../../../../src/lib/three/helpers/AxisHelper';\nimport { NavigationHelper } from '../../../../src/lib/three/helpers/NavigationHelper';\nimport { GridHelper } from '../../../../src/lib/three/helpers/GridHelper';\nimport { SelectionHelper } from '../../../../src/lib/three/helpers/SelectionHelper';\nimport { SectionViewHelper } from '../../../../src/lib/three/helpers/SectionViewHelper';\nimport { ColorbarHelper } from '../../../../src/lib/three/helpers/ColorbarHelper';\nimport { PartLoader } from '../../../../src/lib/three/loaders/PartLoader';\nimport PartAPI from '../../../../src/api/part';\nimport { useSelector, useDispatch } from 'react-redux';\nimport { highlight, select, unselect } from '../../../store/select/action';\n/**\n * Errors\n */\n\nvar errors = {\n  partError: 'Unable to load part'\n};\n/**\n * ThreeView\n */\n\nvar ThreeView = function ThreeView(_ref) {\n  _s();\n\n  var loading = _ref.loading,\n      part = _ref.part;\n  // Ref\n  var mount = useRef(null);\n  var scene = useRef();\n  var camera = useRef();\n  var renderer = useRef();\n  var outlinePass = useRef();\n  var effectComposer = useRef();\n  var controls = useRef();\n  var gridHelper = useRef();\n  var selectionHelper = useRef();\n  var sectionViewHelper = useRef();\n  var colorbarHelper = useRef(); // State\n\n  var _useState = useState(false),\n      controlVisible = _useState[0],\n      setControlVisible = _useState[1];\n\n  var _useState2 = useState(false),\n      transparent = _useState2[0],\n      setTransparent = _useState2[1];\n\n  var _useState3 = useState(false),\n      sectionView = _useState3[0],\n      setSectionView = _useState3[1];\n\n  var _useState4 = useState('translate'),\n      transform = _useState4[0],\n      setTransform = _useState4[1]; // Store\n\n\n  var _useSelector = useSelector(function (state) {\n    return {\n      selectEnabled: state.select.enabled,\n      selectType: state.select.type,\n      selectPart: state.select.part,\n      selectHighlighted: state.select.highlighted,\n      selectSelected: state.select.selected\n    };\n  }),\n      selectEnabled = _useSelector.selectEnabled,\n      selectType = _useSelector.selectType,\n      selectPart = _useSelector.selectPart,\n      selectHighlighted = _useSelector.selectHighlighted,\n      selectSelected = _useSelector.selectSelected;\n\n  var dispatch = useDispatch(); // Zoom factor\n\n  var zoomFactor = 0.01; // Mount\n\n  useEffect(function () {\n    var currentMount = mount.current;\n    var width = currentMount.clientWidth;\n    var height = currentMount.clientHeight;\n    var frameId; // Scene\n\n    scene.current = new Scene(); // Camera\n\n    camera.current = new PerspectiveCamera(50, width / height, 0.1, 1000);\n    camera.current.position.z = 10; // Light\n\n    var ambientLight = new AmbientLight('#999999');\n    var pointLight1 = new PointLight('#ffffff');\n    pointLight1.decay = 5;\n    pointLight1.position.set(5, 5, 5);\n    var pointLight2 = new PointLight('#ffffff');\n    pointLight2.decay = 5;\n    pointLight2.position.set(-5, -5, -5);\n    scene.current.add(ambientLight);\n    scene.current.add(pointLight1);\n    scene.current.add(pointLight2); // Renderer\n\n    renderer.current = new WebGLRenderer({\n      antialias: true,\n      alpha: true\n    });\n    renderer.current.setClearColor('#ffffff');\n    renderer.current.setSize(width, height);\n    renderer.current.setPixelRatio(window.devicePixelRatio || 1);\n    renderer.current.autoClear = false;\n    currentMount.appendChild(renderer.current.domElement); // Render pass\n\n    var renderPass = new RenderPass(scene.current, camera.current); // Outline pass\n\n    outlinePass.current = new OutlinePass(new Vector2(width, height), scene.current, camera.current);\n    outlinePass.current.visibleEdgeColor.set('#0096C7');\n    outlinePass.current.hiddenEdgeColor.set('#0096C7'); // Effect composer\n\n    effectComposer.current = new EffectComposer(renderer.current);\n    effectComposer.current.addPass(renderPass);\n    effectComposer.current.addPass(outlinePass.current); // Controls\n\n    controls.current = new TrackballControls(camera.current, currentMount);\n    controls.current.rotateSpeed = 3;\n    controls.current.panSpeed = 0.1; // Axis\n\n    var axisHelper = AxisHelper(renderer.current, camera.current, {\n      offsetWidth: width - 150,\n      offsetHeight: 0,\n      width: 150,\n      height: 150\n    }); // NavigationHelper\n\n    var navigationHelper = NavigationHelper(renderer.current, scene.current, camera.current, controls.current, {\n      offsetWidth: 0,\n      offsetHeight: 0,\n      width: 150,\n      height: 150\n    }); // GridHelper\n\n    gridHelper.current = GridHelper(scene.current); // SelectionHelper\n\n    selectionHelper.current = SelectionHelper(renderer.current, scene.current, camera.current, controls.current); // SectionViewHelper\n\n    sectionViewHelper.current = SectionViewHelper(renderer.current, scene.current, camera.current, controls.current); // ColorbarHelper\n\n    colorbarHelper.current = ColorbarHelper(renderer.current, scene.current);\n    colorbarHelper.current.setVisible(false);\n    /**\n     * Render scene\n     */\n\n    var renderScene = function renderScene() {\n      controls.current.update();\n      renderer.current.setViewport(0, 0, width, height);\n      renderer.current.render(scene.current, camera.current);\n      effectComposer.current.render();\n      axisHelper.render();\n      navigationHelper.render();\n      colorbarHelper.current.render();\n    };\n    /**\n     * Handle resize\n     */\n\n\n    var handleResize = function handleResize() {\n      width = currentMount.clientWidth;\n      height = currentMount.clientHeight;\n      renderer.current.setSize(width, height);\n      camera.current.aspect = width / height;\n      camera.current.updateProjectionMatrix();\n      axisHelper.resize({\n        newOffsetWidth: width - 150,\n        newOffsetHeight: 0,\n        newWidth: 150,\n        newHeight: 150\n      });\n      navigationHelper.resize({\n        newOffsetWidth: 0,\n        newOffsetHeight: 0,\n        newWidth: 150,\n        newHeight: 150\n      });\n      renderScene();\n    };\n    /**\n     * Animate\n     */\n\n\n    var animate = function animate() {\n      renderScene();\n      /*frameId = */\n\n      requestAnimationFrame(animate);\n    };\n    /**\n     * Start animate\n     */\n\n\n    var start = function start() {\n      // if (!frameId) {\n      frameId = requestAnimationFrame(animate); // }\n    };\n    /**\n     * Stop animate\n     */\n\n\n    var stop = function stop() {\n      cancelAnimationFrame(frameId);\n      frameId = null;\n    }; // Event listeners\n\n\n    window.addEventListener('resize', handleResize); // First rendering\n\n    start(); // Unmount\n\n    return function () {\n      stop();\n      window.removeEventListener('resize', handleResize);\n      currentMount.removeChild(renderer.current.domElement); // Clean scene\n\n      scene.current.children.forEach(function (child) {\n        scene.current.remove(child);\n      }); // Dispose\n\n      axisHelper.dispose();\n      navigationHelper.dispose();\n      gridHelper.current.dispose();\n      sectionViewHelper.current.dispose();\n      selectionHelper.current.dispose();\n    };\n  }, []);\n  useEffect(function () {\n    // Clean scene\n    scene.current.children.forEach(function (child) {\n      if (child.type === 'Part') {\n        child.dispose();\n        scene.current.remove(child);\n      }\n    });\n    if (part) loadPart();\n  }, [part]); // Enable / disable selection\n\n  useEffect(function () {\n    scene.current.children.forEach(function (child) {\n      if (child.type === 'Part' && child.uuid === selectPart) {\n        if (selectEnabled) child.startSelection(renderer.current, camera.current, outlinePass.current, selectType);else {\n          child.stopSelection();\n        }\n      }\n    });\n  }, [selectEnabled, selectPart, selectType]);\n  useEffect(function () {\n    scene.current.children.forEach(function (child) {\n      if (child.type === 'Part' && child.uuid === selectPart) {\n        // Highlight\n        child.highlight(selectHighlighted); // Selection\n\n        var selected = child.getSelected(); // Unselect\n\n        var minus = selected.filter(function (s) {\n          return !selectSelected.includes(s);\n        });\n        minus.forEach(function (m) {\n          child.unselect(m);\n        }); // Select\n\n        var plus = selectSelected.filter(function (s) {\n          return !selected.includes(s);\n        });\n        plus.forEach(function (p) {\n          child.select(p);\n        });\n      }\n    });\n  }, [selectHighlighted, selectSelected]);\n  /**\n   * Compute scene bounding box\n   */\n\n  var computeSceneBoundingSphere = function computeSceneBoundingSphere() {\n    var box = new Box3();\n    scene.current.children.forEach(function (child) {\n      if (child.visible && child.type === 'Part') {\n        var childBox = child.boundingBox;\n        var min = new Vector3(Math.min(box.min.x, childBox.min.x), Math.min(box.min.y, childBox.min.y), Math.min(box.min.z, childBox.min.z));\n        var max = new Vector3(Math.max(box.max.x, childBox.max.x), Math.max(box.max.y, childBox.max.y), Math.max(box.max.z, childBox.max.z));\n        box.set(min, max);\n      }\n    });\n    var sphere = new Sphere();\n    box.getBoundingSphere(sphere);\n    scene.current.boundingBox = box;\n    scene.current.boundingSphere = sphere;\n  };\n  /**\n   * Zoom\n   * @param {Object} direction Direction\n   */\n\n\n  var zoom = function zoom(direction) {\n    var targetDistance = controls.current.object.position.distanceTo(controls.current.target);\n    var zoomDistance = targetDistance * direction * zoomFactor;\n    var translation = controls.current.target.clone().sub(camera.current.position).normalize().multiplyScalar(zoomDistance);\n    camera.current.position.add(translation);\n  };\n\n  var zoomInProgress = null;\n  /**\n   * Zoom in\n   */\n\n  var zoomIn = function zoomIn() {\n    zoom(1);\n    zoomInProgress = requestAnimationFrame(zoomIn);\n  };\n  /**\n   * Zoom out\n   */\n\n\n  var zoomOut = function zoomOut() {\n    zoom(-1);\n    zoomInProgress = requestAnimationFrame(zoomOut);\n  };\n  /**\n   * Zoom stop\n   */\n\n\n  var zoomStop = function zoomStop() {\n    cancelAnimationFrame(zoomInProgress);\n    zoomInProgress = null;\n  };\n  /**\n   * Zoom to fit\n   */\n\n\n  var zoomToFit = function zoomToFit() {\n    var sphere = scene.current.boundingSphere;\n    if (!sphere || sphere.radius === 0) return; // Center\n\n    var center = sphere.center; // Direction\n\n    var maxSize = 2 * sphere.radius;\n    var fitHeight = maxSize / (2 * Math.atan(Math.PI * camera.current.fov / 360));\n    var fitWidth = fitHeight / camera.current.aspect;\n    var distance = 1.1 * Math.max(fitHeight, fitWidth);\n    var direction = controls.current.target.clone().sub(camera.current.position).normalize().multiplyScalar(distance); // Controls\n\n    controls.current.target.copy(center); // Camera\n\n    camera.current.position.copy(center).sub(direction);\n    camera.current.near = distance / 100;\n    camera.current.far = distance * 100;\n    camera.current.updateProjectionMatrix(); // Lights\n\n    scene.current.children.forEach(function (child) {\n      if (child.type === 'PointLight') {\n        var position = child.position;\n        var max = Math.max(Math.max(Math.abs(position.x), Math.abs(position.y)), Math.abs(position.z));\n        child.position.multiplyScalar(1.5 * distance / max);\n      }\n    });\n  };\n  /**\n   * Load part\n   */\n\n\n  var loadPart = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      var _mesh$children$, _mesh$children$$child;\n\n      var mouseMoveEvent, mouseDownEvent, loader, mesh;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              // Events\n              mouseMoveEvent = function mouseMoveEvent(child, uuid) {\n                child.highlight(uuid);\n                setTimeout(function () {\n                  return dispatch(highlight(uuid));\n                }, 1);\n              };\n\n              mouseDownEvent = function mouseDownEvent(child, uuid) {\n                var selected = child.getSelected();\n\n                if (selected.includes(uuid)) {\n                  child.unselect(uuid);\n                  setTimeout(function () {\n                    return dispatch(unselect(uuid));\n                  }, 1);\n                } else {\n                  child.select(uuid);\n                  setTimeout(function () {\n                    return dispatch(select(uuid));\n                  }, 1);\n                }\n              }; // Load\n\n\n              loader = PartLoader(mouseMoveEvent, mouseDownEvent);\n              mesh = loader.load(part, transparent, sectionViewHelper.current.getClippingPlane(), outlinePass.current); // Scene\n\n              scene.current.add(mesh);\n              computeSceneBoundingSphere(); // Grid\n\n              gridHelper.current.update(); // Zoom\n\n              zoomToFit(); // Colorbar\n\n              if (mesh !== null && mesh !== void 0 && (_mesh$children$ = mesh.children[1]) !== null && _mesh$children$ !== void 0 && (_mesh$children$$child = _mesh$children$.children[0]) !== null && _mesh$children$$child !== void 0 && _mesh$children$$child.lut) {\n                colorbarHelper.current.setLUT(mesh.children[1].children[0].lut);\n                colorbarHelper.current.setVisible(true);\n              } else {\n                colorbarHelper.current.setVisible(false);\n              }\n\n            case 9:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function loadPart() {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n  /**\n   * Toggle grid\n   * @param {boolean} checked Checked\n   */\n\n\n  var toggleGrid = function toggleGrid(checked) {\n    gridHelper.current.setVisible(checked);\n  };\n\n  var toggleTransparent = function toggleTransparent(checked) {\n    setTransparent(checked);\n    scene.current.children.forEach(function (child) {\n      if (child.type === 'Part') {\n        child.setTransparent(checked);\n      }\n    });\n  };\n  /**\n   * Toggle section view\n   */\n\n\n  var toggleSectionView = function toggleSectionView() {\n    var active = !sectionView;\n    setSectionView(active);\n    active ? sectionViewHelper.current.start() : sectionViewHelper.current.stop();\n  };\n  /**\n   * Handle transform mode\n   * @param {Object} event Event\n   */\n\n\n  var handleTransform = function handleTransform(event) {\n    var mode = event.target.value;\n    setTransform(mode);\n    sectionViewHelper.current.setMode(mode);\n  };\n  /**\n   * Render\n   */\n\n\n  return /*#__PURE__*/_jsxDEV(_Layout, {\n    className: \"View no-scroll\",\n    children: [/*#__PURE__*/_jsxDEV(_Layout.Content, {\n      className: \"View-content no-scroll\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          display: loading ? 'flex' : 'none'\n        },\n        className: \"View-loading\",\n        children: /*#__PURE__*/_jsxDEV(_Spin, {\n          indicator: /*#__PURE__*/_jsxDEV(LoadingOutlined, {\n            style: {\n              fontSize: 60\n            },\n            spin: true\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 583,\n            columnNumber: 28\n          }, _this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 583,\n          columnNumber: 11\n        }, _this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 579,\n        columnNumber: 9\n      }, _this), /*#__PURE__*/_jsxDEV(\"div\", {\n        ref: mount,\n        className: \"View-canvas\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 585,\n        columnNumber: 9\n      }, _this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 578,\n      columnNumber: 7\n    }, _this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"View-controls\",\n      children: [/*#__PURE__*/_jsxDEV(_Tooltip, {\n        title: \"Controls\",\n        children: /*#__PURE__*/_jsxDEV(_Button, {\n          icon: /*#__PURE__*/_jsxDEV(ControlOutlined, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 590,\n            columnNumber: 19\n          }, _this),\n          onClick: function onClick() {\n            return setControlVisible(!controlVisible);\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 589,\n          columnNumber: 11\n        }, _this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 588,\n        columnNumber: 9\n      }, _this), /*#__PURE__*/_jsxDEV(_Drawer, {\n        className: \"View-controls-drawer\",\n        title: \"Controls\",\n        visible: controlVisible,\n        onClose: function onClose() {\n          return setControlVisible(!controlVisible);\n        },\n        mask: false,\n        maskClosable: false,\n        placement: \"right\",\n        getContainer: false,\n        headerStyle: {\n          borderLeft: '1px solid #f0f0f0'\n        },\n        bodyStyle: {\n          display: 'flex',\n          flexDirection: 'column',\n          padding: '10px',\n          borderLeft: '1px solid #f0f0f0'\n        },\n        width: \"100%\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"drawer-group\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"drawer-subgroup\",\n            children: /*#__PURE__*/_jsxDEV(_Tooltip, {\n              title: \"Display grid\",\n              children: /*#__PURE__*/_jsxDEV(_Switch, {\n                defaultChecked: true,\n                checkedChildren: /*#__PURE__*/_jsxDEV(BorderlessTableOutlined, {}, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 619,\n                  columnNumber: 36\n                }, _this),\n                unCheckedChildren: /*#__PURE__*/_jsxDEV(BorderlessTableOutlined, {}, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 620,\n                  columnNumber: 38\n                }, _this),\n                onChange: toggleGrid\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 617,\n                columnNumber: 17\n              }, _this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 616,\n              columnNumber: 15\n            }, _this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 615,\n            columnNumber: 13\n          }, _this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"drawer-subgroup\",\n            children: /*#__PURE__*/_jsxDEV(_Tooltip, {\n              title: \"Set transparency\",\n              children: /*#__PURE__*/_jsxDEV(_Switch, {\n                className: \"transparent\",\n                checked: transparent,\n                checkedChildren: /*#__PURE__*/_jsxDEV(RadiusUprightOutlined, {}, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 630,\n                  columnNumber: 36\n                }, _this),\n                unCheckedChildren: /*#__PURE__*/_jsxDEV(RadiusUprightOutlined, {}, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 631,\n                  columnNumber: 38\n                }, _this),\n                onChange: toggleTransparent\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 627,\n                columnNumber: 17\n              }, _this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 626,\n              columnNumber: 15\n            }, _this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 625,\n            columnNumber: 13\n          }, _this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 614,\n          columnNumber: 11\n        }, _this), /*#__PURE__*/_jsxDEV(_Divider, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 638,\n          columnNumber: 11\n        }, _this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"drawer-group\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"drawer-subgroup\",\n            children: [/*#__PURE__*/_jsxDEV(_Tooltip, {\n              title: \"Zoom out\",\n              placement: \"left\",\n              children: /*#__PURE__*/_jsxDEV(_Button, {\n                icon: /*#__PURE__*/_jsxDEV(ZoomOutOutlined, {}, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 644,\n                  columnNumber: 25\n                }, _this),\n                onMouseDown: zoomOut,\n                onMouseUp: zoomStop,\n                onMouseOut: zoomStop\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 643,\n                columnNumber: 17\n              }, _this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 642,\n              columnNumber: 15\n            }, _this), /*#__PURE__*/_jsxDEV(_Tooltip, {\n              title: \"Zoom to fit\",\n              placement: \"left\",\n              children: /*#__PURE__*/_jsxDEV(_Button, {\n                icon: /*#__PURE__*/_jsxDEV(CompressOutlined, {}, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 651,\n                  columnNumber: 31\n                }, _this),\n                onClick: zoomToFit\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 651,\n                columnNumber: 17\n              }, _this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 650,\n              columnNumber: 15\n            }, _this), /*#__PURE__*/_jsxDEV(_Tooltip, {\n              title: \"Zoom in\",\n              placement: \"left\",\n              children: /*#__PURE__*/_jsxDEV(_Button, {\n                icon: /*#__PURE__*/_jsxDEV(ZoomInOutlined, {}, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 655,\n                  columnNumber: 25\n                }, _this),\n                onMouseDown: zoomIn,\n                onMouseUp: zoomStop,\n                onMouseOut: zoomStop\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 654,\n                columnNumber: 17\n              }, _this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 653,\n              columnNumber: 15\n            }, _this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 641,\n            columnNumber: 13\n          }, _this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"drawer-subgroup\",\n            children: /*#__PURE__*/_jsxDEV(_Tooltip, {\n              title: \"Zoom to selection\",\n              placement: \"left\",\n              children: /*#__PURE__*/_jsxDEV(_Button, {\n                icon: /*#__PURE__*/_jsxDEV(SelectOutlined, {}, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 665,\n                  columnNumber: 25\n                }, _this),\n                onClick: function onClick() {\n                  return selectionHelper.current.isEnabled() ? selectionHelper.current.end() : selectionHelper.current.start();\n                }\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 664,\n                columnNumber: 17\n              }, _this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 663,\n              columnNumber: 15\n            }, _this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 662,\n            columnNumber: 13\n          }, _this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 640,\n          columnNumber: 11\n        }, _this), /*#__PURE__*/_jsxDEV(_Divider, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 676,\n          columnNumber: 11\n        }, _this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"drawer-group\",\n          children: sectionView ? /*#__PURE__*/_jsxDEV(_Fragment, {\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"drawer-subgroup\",\n              children: [/*#__PURE__*/_jsxDEV(_Tooltip, {\n                title: \"Stop\",\n                placement: \"left\",\n                children: /*#__PURE__*/_jsxDEV(_Button, {\n                  icon: /*#__PURE__*/_jsxDEV(StopOutlined, {}, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 684,\n                    columnNumber: 29\n                  }, _this),\n                  onClick: toggleSectionView\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 683,\n                  columnNumber: 21\n                }, _this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 682,\n                columnNumber: 19\n              }, _this), /*#__PURE__*/_jsxDEV(_Radio.Group, {\n                onChange: handleTransform,\n                value: transform,\n                style: {\n                  display: 'flex',\n                  flexDirection: 'column',\n                  marginTop: '10px'\n                },\n                children: [/*#__PURE__*/_jsxDEV(_Tooltip, {\n                  title: \"Translate\",\n                  placement: \"left\",\n                  children: /*#__PURE__*/_jsxDEV(_Radio, {\n                    value: \"translate\",\n                    children: /*#__PURE__*/_jsxDEV(DragOutlined, {}, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 699,\n                      columnNumber: 25\n                    }, _this)\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 698,\n                    columnNumber: 23\n                  }, _this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 697,\n                  columnNumber: 21\n                }, _this), /*#__PURE__*/_jsxDEV(_Tooltip, {\n                  title: \"Rotate\",\n                  placement: \"left\",\n                  children: /*#__PURE__*/_jsxDEV(_Radio, {\n                    value: \"rotate\",\n                    children: /*#__PURE__*/_jsxDEV(SyncOutlined, {}, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 704,\n                      columnNumber: 25\n                    }, _this)\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 703,\n                    columnNumber: 23\n                  }, _this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 702,\n                  columnNumber: 21\n                }, _this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 688,\n                columnNumber: 19\n              }, _this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 681,\n              columnNumber: 17\n            }, _this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"drawer-subgroup\",\n              children: [/*#__PURE__*/_jsxDEV(_Tooltip, {\n                title: \"Hide plane\",\n                placement: \"left\",\n                children: /*#__PURE__*/_jsxDEV(_Button, {\n                  icon: /*#__PURE__*/_jsxDEV(EyeInvisibleOutlined, {}, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 712,\n                    columnNumber: 29\n                  }, _this),\n                  onClick: function onClick() {\n                    return sectionViewHelper.current.toggleVisible();\n                  }\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 711,\n                  columnNumber: 21\n                }, _this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 710,\n                columnNumber: 19\n              }, _this), /*#__PURE__*/_jsxDEV(_Tooltip, {\n                title: \"Snap to X\",\n                placement: \"left\",\n                children: /*#__PURE__*/_jsxDEV(_Button, {\n                  className: \"ant-btn-icon-only\",\n                  onClick: function onClick() {\n                    return sectionViewHelper.current.toAxis(new Vector3(1, 0, 0));\n                  },\n                  children: \"X\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 717,\n                  columnNumber: 21\n                }, _this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 716,\n                columnNumber: 19\n              }, _this), /*#__PURE__*/_jsxDEV(_Tooltip, {\n                title: \"Snap to Y\",\n                placement: \"left\",\n                children: /*#__PURE__*/_jsxDEV(_Button, {\n                  className: \"ant-btn-icon-only\",\n                  onClick: function onClick() {\n                    return sectionViewHelper.current.toAxis(new Vector3(0, 1, 0));\n                  },\n                  children: \"Y\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 727,\n                  columnNumber: 21\n                }, _this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 726,\n                columnNumber: 19\n              }, _this), /*#__PURE__*/_jsxDEV(_Tooltip, {\n                title: \"Snap to Z\",\n                placement: \"left\",\n                children: /*#__PURE__*/_jsxDEV(_Button, {\n                  className: \"ant-btn-icon-only\",\n                  onClick: function onClick() {\n                    return sectionViewHelper.current.toAxis(new Vector3(0, 0, 1));\n                  },\n                  children: \"Z\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 737,\n                  columnNumber: 21\n                }, _this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 736,\n                columnNumber: 19\n              }, _this), /*#__PURE__*/_jsxDEV(_Tooltip, {\n                title: \"Flip\",\n                placement: \"left\",\n                children: /*#__PURE__*/_jsxDEV(_Button, {\n                  onClick: function onClick() {\n                    return sectionViewHelper.current.flip();\n                  },\n                  icon: /*#__PURE__*/_jsxDEV(RetweetOutlined, {}, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 749,\n                    columnNumber: 29\n                  }, _this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 747,\n                  columnNumber: 21\n                }, _this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 746,\n                columnNumber: 19\n              }, _this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 709,\n              columnNumber: 17\n            }, _this)]\n          }, void 0, true) : /*#__PURE__*/_jsxDEV(_Tooltip, {\n            title: \"Section view\",\n            children: /*#__PURE__*/_jsxDEV(_Button, {\n              icon: /*#__PURE__*/_jsxDEV(ScissorOutlined, {}, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 757,\n                columnNumber: 25\n              }, _this),\n              onClick: toggleSectionView\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 756,\n              columnNumber: 17\n            }, _this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 755,\n            columnNumber: 15\n          }, _this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 678,\n          columnNumber: 11\n        }, _this), /*#__PURE__*/_jsxDEV(_Divider, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 764,\n          columnNumber: 11\n        }, _this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 594,\n        columnNumber: 9\n      }, _this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 587,\n      columnNumber: 7\n    }, _this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 577,\n    columnNumber: 5\n  }, _this);\n};\n/**\n * View\n * @param {Object} Props props\n */\n\n\n_s(ThreeView, \"M2n/UMrSvZ/VV5DDByKYby9Ekdg=\", false, function () {\n  return [useSelector, useDispatch];\n});\n\n_c = ThreeView;\n\nvar View = function View(_ref3) {\n  _s2();\n\n  var simulation = _ref3.simulation,\n      setPartSummary = _ref3.setPartSummary;\n\n  // State\n  var _useState5 = useState(),\n      part = _useState5[0],\n      setPart = _useState5[1];\n\n  var _useState6 = useState(false),\n      loading = _useState6[0],\n      setLoading = _useState6[1]; // Part\n\n\n  useEffect(function () {\n    var _simulation$scheme;\n\n    var configuration = simulation === null || simulation === void 0 ? void 0 : (_simulation$scheme = simulation.scheme) === null || _simulation$scheme === void 0 ? void 0 : _simulation$scheme.configuration;\n    if (configuration !== null && configuration !== void 0 && configuration.part) loadPart(configuration.part);\n  }, [simulation]);\n  /**\n   * Load part\n   * @param {Object} file File\n   */\n\n  var loadPart = /*#__PURE__*/function () {\n    var _ref4 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(file) {\n      var _partContent$solids, _partContent$faces, _partContent$edges, _partContent$solids2, _partContent$faces2, _partContent$edges2, partContent, summary;\n\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              setLoading(true);\n              _context2.prev = 1;\n              _context2.next = 4;\n              return PartAPI.get({\n                id: simulation.id\n              }, file);\n\n            case 4:\n              partContent = _context2.sent;\n\n              if (!partContent.error) {\n                _context2.next = 8;\n                break;\n              }\n\n              setPartSummary({\n                error: true,\n                message: partContent.message\n              });\n              return _context2.abrupt(\"return\");\n\n            case 8:\n              // Convert buffers\n              (_partContent$solids = partContent.solids) === null || _partContent$solids === void 0 ? void 0 : _partContent$solids.forEach(function (solid) {\n                solid.buffer = JSON.parse(Buffer.from(solid.buffer).toString());\n              });\n              (_partContent$faces = partContent.faces) === null || _partContent$faces === void 0 ? void 0 : _partContent$faces.forEach(function (face) {\n                face.buffer = JSON.parse(Buffer.from(face.buffer).toString());\n              });\n              (_partContent$edges = partContent.edges) === null || _partContent$edges === void 0 ? void 0 : _partContent$edges.forEach(function (edge) {\n                edge.buffer = JSON.parse(Buffer.from(edge.buffer).toString());\n              }); // Summary\n\n              summary = {\n                uuid: partContent.uuid,\n                solids: (_partContent$solids2 = partContent.solids) === null || _partContent$solids2 === void 0 ? void 0 : _partContent$solids2.map(function (solid) {\n                  return {\n                    name: solid.name,\n                    number: solid.number,\n                    uuid: solid.buffer.uuid\n                  };\n                }),\n                faces: (_partContent$faces2 = partContent.faces) === null || _partContent$faces2 === void 0 ? void 0 : _partContent$faces2.map(function (face) {\n                  return {\n                    name: face.name,\n                    number: face.number,\n                    uuid: face.buffer.uuid\n                  };\n                }),\n                edges: (_partContent$edges2 = partContent.edges) === null || _partContent$edges2 === void 0 ? void 0 : _partContent$edges2.map(function (edge) {\n                  return {\n                    name: edge.name,\n                    number: edge.number,\n                    uuid: edge.buffer.uuid\n                  };\n                })\n              };\n              setPart(partContent);\n              setPartSummary(summary);\n              _context2.next = 19;\n              break;\n\n            case 16:\n              _context2.prev = 16;\n              _context2.t0 = _context2[\"catch\"](1);\n              Error(errors.partError, _context2.t0);\n\n            case 19:\n              _context2.prev = 19;\n              setLoading(false);\n              return _context2.finish(19);\n\n            case 22:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2, null, [[1, 16, 19, 22]]);\n    }));\n\n    return function loadPart(_x) {\n      return _ref4.apply(this, arguments);\n    };\n  }();\n  /**\n   * Render\n   */\n\n\n  return /*#__PURE__*/_jsxDEV(ThreeView, {\n    loading: loading,\n    part: part\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 851,\n    columnNumber: 10\n  }, _this);\n};\n\n_s2(View, \"toWYD+nR7aOMe49szhTTZfl9MGk=\");\n\n_c2 = View;\nexport default View;\n\nvar _c, _c2;\n\n$RefreshReg$(_c, \"ThreeView\");\n$RefreshReg$(_c2, \"View\");","map":{"version":3,"sources":["/home/simon/Documents/Git/Airthium/tanatloc-ssr/renderer/components/project/view/index.js"],"names":["useRef","useState","useEffect","BorderlessTableOutlined","CompressOutlined","ControlOutlined","DragOutlined","EyeInvisibleOutlined","LoadingOutlined","ZoomInOutlined","ZoomOutOutlined","SelectOutlined","RadiusUprightOutlined","ScissorOutlined","StopOutlined","SyncOutlined","RetweetOutlined","AmbientLight","Box3","PerspectiveCamera","PointLight","Scene","Sphere","Vector2","Vector3","WebGLRenderer","Error","RenderPass","OutlinePass","EffectComposer","TrackballControls","AxisHelper","NavigationHelper","GridHelper","SelectionHelper","SectionViewHelper","ColorbarHelper","PartLoader","PartAPI","useSelector","useDispatch","highlight","select","unselect","errors","partError","ThreeView","loading","part","mount","scene","camera","renderer","outlinePass","effectComposer","controls","gridHelper","selectionHelper","sectionViewHelper","colorbarHelper","controlVisible","setControlVisible","transparent","setTransparent","sectionView","setSectionView","transform","setTransform","state","selectEnabled","enabled","selectType","type","selectPart","selectHighlighted","highlighted","selectSelected","selected","dispatch","zoomFactor","currentMount","current","width","clientWidth","height","clientHeight","frameId","position","z","ambientLight","pointLight1","decay","set","pointLight2","add","antialias","alpha","setClearColor","setSize","setPixelRatio","window","devicePixelRatio","autoClear","appendChild","domElement","renderPass","visibleEdgeColor","hiddenEdgeColor","addPass","rotateSpeed","panSpeed","axisHelper","offsetWidth","offsetHeight","navigationHelper","setVisible","renderScene","update","setViewport","render","handleResize","aspect","updateProjectionMatrix","resize","newOffsetWidth","newOffsetHeight","newWidth","newHeight","animate","requestAnimationFrame","start","stop","cancelAnimationFrame","addEventListener","removeEventListener","removeChild","children","forEach","child","remove","dispose","loadPart","uuid","startSelection","stopSelection","getSelected","minus","filter","s","includes","m","plus","p","computeSceneBoundingSphere","box","visible","childBox","boundingBox","min","Math","x","y","max","sphere","getBoundingSphere","boundingSphere","zoom","direction","targetDistance","object","distanceTo","target","zoomDistance","translation","clone","sub","normalize","multiplyScalar","zoomInProgress","zoomIn","zoomOut","zoomStop","zoomToFit","radius","center","maxSize","fitHeight","atan","PI","fov","fitWidth","distance","copy","near","far","abs","mouseMoveEvent","setTimeout","mouseDownEvent","loader","mesh","load","getClippingPlane","lut","setLUT","toggleGrid","checked","toggleTransparent","toggleSectionView","active","handleTransform","event","mode","value","setMode","display","fontSize","borderLeft","flexDirection","padding","isEnabled","end","marginTop","toggleVisible","toAxis","flip","View","simulation","setPartSummary","setPart","setLoading","configuration","scheme","file","get","id","partContent","error","message","solids","solid","buffer","JSON","parse","Buffer","from","toString","faces","face","edges","edge","summary","map","name","number"],"mappings":"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","sourcesContent":["/** @module renderer/components/project/view */\n\nimport { useRef, useState, useEffect } from 'react'\nimport {\n  Button,\n  Divider,\n  Drawer,\n  Layout,\n  Radio,\n  Spin,\n  Switch,\n  Tooltip\n} from 'antd'\nimport {\n  BorderlessTableOutlined,\n  CompressOutlined,\n  ControlOutlined,\n  DragOutlined,\n  EyeInvisibleOutlined,\n  LoadingOutlined,\n  ZoomInOutlined,\n  ZoomOutOutlined,\n  SelectOutlined,\n  RadiusUprightOutlined,\n  ScissorOutlined,\n  StopOutlined,\n  SyncOutlined,\n  RetweetOutlined\n} from '@ant-design/icons'\nimport {\n  AmbientLight,\n  Box3,\n  PerspectiveCamera,\n  PointLight,\n  Scene,\n  Sphere,\n  Vector2,\n  Vector3,\n  WebGLRenderer\n} from 'three/build/three.module'\n\nimport { Error } from '../../assets/notification'\n\nimport { RenderPass } from 'three/examples/jsm/postprocessing/RenderPass'\nimport { OutlinePass } from 'three/examples/jsm/postprocessing/OutlinePass'\nimport { EffectComposer } from 'three/examples/jsm/postprocessing/EffectComposer'\n\nimport { TrackballControls } from '../../../../src/lib/three/controls/TrackballControls'\nimport { AxisHelper } from '../../../../src/lib/three/helpers/AxisHelper'\nimport { NavigationHelper } from '../../../../src/lib/three/helpers/NavigationHelper'\nimport { GridHelper } from '../../../../src/lib/three/helpers/GridHelper'\nimport { SelectionHelper } from '../../../../src/lib/three/helpers/SelectionHelper'\nimport { SectionViewHelper } from '../../../../src/lib/three/helpers/SectionViewHelper'\nimport { ColorbarHelper } from '../../../../src/lib/three/helpers/ColorbarHelper'\n\nimport { PartLoader } from '../../../../src/lib/three/loaders/PartLoader'\n\nimport PartAPI from '../../../../src/api/part'\n\nimport { useSelector, useDispatch } from 'react-redux'\nimport { highlight, select, unselect } from '../../../store/select/action'\n\n/**\n * Errors\n */\nconst errors = {\n  partError: 'Unable to load part'\n}\n\n/**\n * ThreeView\n */\nconst ThreeView = ({ loading, part }) => {\n  // Ref\n  const mount = useRef(null)\n  const scene = useRef()\n  const camera = useRef()\n  const renderer = useRef()\n  const outlinePass = useRef()\n  const effectComposer = useRef()\n  const controls = useRef()\n  const gridHelper = useRef()\n  const selectionHelper = useRef()\n  const sectionViewHelper = useRef()\n  const colorbarHelper = useRef()\n\n  // State\n  const [controlVisible, setControlVisible] = useState(false)\n  const [transparent, setTransparent] = useState(false)\n  const [sectionView, setSectionView] = useState(false)\n  const [transform, setTransform] = useState('translate')\n\n  // Store\n  const {\n    selectEnabled,\n    selectType,\n    selectPart,\n    selectHighlighted,\n    selectSelected\n  } = useSelector((state) => ({\n    selectEnabled: state.select.enabled,\n    selectType: state.select.type,\n    selectPart: state.select.part,\n    selectHighlighted: state.select.highlighted,\n    selectSelected: state.select.selected\n  }))\n  const dispatch = useDispatch()\n\n  // Zoom factor\n  const zoomFactor = 0.01\n\n  // Mount\n  useEffect(() => {\n    const currentMount = mount.current\n\n    let width = currentMount.clientWidth\n    let height = currentMount.clientHeight\n    let frameId\n\n    // Scene\n    scene.current = new Scene()\n\n    // Camera\n    camera.current = new PerspectiveCamera(50, width / height, 0.1, 1000)\n    camera.current.position.z = 10\n\n    // Light\n    const ambientLight = new AmbientLight('#999999')\n    const pointLight1 = new PointLight('#ffffff')\n    pointLight1.decay = 5\n    pointLight1.position.set(5, 5, 5)\n    const pointLight2 = new PointLight('#ffffff')\n    pointLight2.decay = 5\n    pointLight2.position.set(-5, -5, -5)\n    scene.current.add(ambientLight)\n    scene.current.add(pointLight1)\n    scene.current.add(pointLight2)\n\n    // Renderer\n    renderer.current = new WebGLRenderer({\n      antialias: true,\n      alpha: true\n    })\n    renderer.current.setClearColor('#ffffff')\n    renderer.current.setSize(width, height)\n    renderer.current.setPixelRatio(window.devicePixelRatio || 1)\n    renderer.current.autoClear = false\n    currentMount.appendChild(renderer.current.domElement)\n\n    // Render pass\n    const renderPass = new RenderPass(scene.current, camera.current)\n\n    // Outline pass\n    outlinePass.current = new OutlinePass(\n      new Vector2(width, height),\n      scene.current,\n      camera.current\n    )\n    outlinePass.current.visibleEdgeColor.set('#0096C7')\n    outlinePass.current.hiddenEdgeColor.set('#0096C7')\n\n    // Effect composer\n    effectComposer.current = new EffectComposer(renderer.current)\n    effectComposer.current.addPass(renderPass)\n    effectComposer.current.addPass(outlinePass.current)\n\n    // Controls\n    controls.current = new TrackballControls(camera.current, currentMount)\n    controls.current.rotateSpeed = 3\n    controls.current.panSpeed = 0.1\n\n    // Axis\n    const axisHelper = AxisHelper(renderer.current, camera.current, {\n      offsetWidth: width - 150,\n      offsetHeight: 0,\n      width: 150,\n      height: 150\n    })\n\n    // NavigationHelper\n    const navigationHelper = NavigationHelper(\n      renderer.current,\n      scene.current,\n      camera.current,\n      controls.current,\n      {\n        offsetWidth: 0,\n        offsetHeight: 0,\n        width: 150,\n        height: 150\n      }\n    )\n\n    // GridHelper\n    gridHelper.current = GridHelper(scene.current)\n\n    // SelectionHelper\n    selectionHelper.current = SelectionHelper(\n      renderer.current,\n      scene.current,\n      camera.current,\n      controls.current\n    )\n\n    // SectionViewHelper\n    sectionViewHelper.current = SectionViewHelper(\n      renderer.current,\n      scene.current,\n      camera.current,\n      controls.current\n    )\n\n    // ColorbarHelper\n    colorbarHelper.current = ColorbarHelper(renderer.current, scene.current)\n    colorbarHelper.current.setVisible(false)\n\n    /**\n     * Render scene\n     */\n    const renderScene = () => {\n      controls.current.update()\n\n      renderer.current.setViewport(0, 0, width, height)\n      renderer.current.render(scene.current, camera.current)\n\n      effectComposer.current.render()\n\n      axisHelper.render()\n\n      navigationHelper.render()\n\n      colorbarHelper.current.render()\n    }\n\n    /**\n     * Handle resize\n     */\n    const handleResize = () => {\n      width = currentMount.clientWidth\n      height = currentMount.clientHeight\n      renderer.current.setSize(width, height)\n      camera.current.aspect = width / height\n      camera.current.updateProjectionMatrix()\n\n      axisHelper.resize({\n        newOffsetWidth: width - 150,\n        newOffsetHeight: 0,\n        newWidth: 150,\n        newHeight: 150\n      })\n\n      navigationHelper.resize({\n        newOffsetWidth: 0,\n        newOffsetHeight: 0,\n        newWidth: 150,\n        newHeight: 150\n      })\n\n      renderScene()\n    }\n\n    /**\n     * Animate\n     */\n    const animate = () => {\n      renderScene()\n      /*frameId = */ requestAnimationFrame(animate)\n    }\n\n    /**\n     * Start animate\n     */\n    const start = () => {\n      // if (!frameId) {\n      frameId = requestAnimationFrame(animate)\n      // }\n    }\n\n    /**\n     * Stop animate\n     */\n    const stop = () => {\n      cancelAnimationFrame(frameId)\n      frameId = null\n    }\n\n    // Event listeners\n    window.addEventListener('resize', handleResize)\n\n    // First rendering\n    start()\n\n    // Unmount\n    return () => {\n      stop()\n\n      window.removeEventListener('resize', handleResize)\n\n      currentMount.removeChild(renderer.current.domElement)\n\n      // Clean scene\n      scene.current.children.forEach((child) => {\n        scene.current.remove(child)\n      })\n\n      // Dispose\n      axisHelper.dispose()\n      navigationHelper.dispose()\n      gridHelper.current.dispose()\n      sectionViewHelper.current.dispose()\n      selectionHelper.current.dispose()\n    }\n  }, [])\n\n  useEffect(() => {\n    // Clean scene\n    scene.current.children.forEach((child) => {\n      if (child.type === 'Part') {\n        child.dispose()\n        scene.current.remove(child)\n      }\n    })\n\n    if (part) loadPart()\n  }, [part])\n\n  // Enable / disable selection\n  useEffect(() => {\n    scene.current.children.forEach((child) => {\n      if (child.type === 'Part' && child.uuid === selectPart) {\n        if (selectEnabled)\n          child.startSelection(\n            renderer.current,\n            camera.current,\n            outlinePass.current,\n            selectType\n          )\n        else {\n          child.stopSelection()\n        }\n      }\n    })\n  }, [selectEnabled, selectPart, selectType])\n\n  useEffect(() => {\n    scene.current.children.forEach((child) => {\n      if (child.type === 'Part' && child.uuid === selectPart) {\n        // Highlight\n        child.highlight(selectHighlighted)\n\n        // Selection\n        const selected = child.getSelected()\n\n        // Unselect\n        const minus = selected.filter((s) => !selectSelected.includes(s))\n        minus.forEach((m) => {\n          child.unselect(m)\n        })\n\n        // Select\n        const plus = selectSelected.filter((s) => !selected.includes(s))\n        plus.forEach((p) => {\n          child.select(p)\n        })\n      }\n    })\n  }, [selectHighlighted, selectSelected])\n\n  /**\n   * Compute scene bounding box\n   */\n  const computeSceneBoundingSphere = () => {\n    const box = new Box3()\n    scene.current.children.forEach((child) => {\n      if (child.visible && child.type === 'Part') {\n        const childBox = child.boundingBox\n        const min = new Vector3(\n          Math.min(box.min.x, childBox.min.x),\n          Math.min(box.min.y, childBox.min.y),\n          Math.min(box.min.z, childBox.min.z)\n        )\n        const max = new Vector3(\n          Math.max(box.max.x, childBox.max.x),\n          Math.max(box.max.y, childBox.max.y),\n          Math.max(box.max.z, childBox.max.z)\n        )\n        box.set(min, max)\n      }\n    })\n\n    const sphere = new Sphere()\n    box.getBoundingSphere(sphere)\n\n    scene.current.boundingBox = box\n    scene.current.boundingSphere = sphere\n  }\n\n  /**\n   * Zoom\n   * @param {Object} direction Direction\n   */\n  const zoom = (direction) => {\n    const targetDistance = controls.current.object.position.distanceTo(\n      controls.current.target\n    )\n    const zoomDistance = targetDistance * direction * zoomFactor\n    const translation = controls.current.target\n      .clone()\n      .sub(camera.current.position)\n      .normalize()\n      .multiplyScalar(zoomDistance)\n\n    camera.current.position.add(translation)\n  }\n\n  let zoomInProgress = null\n  /**\n   * Zoom in\n   */\n  const zoomIn = () => {\n    zoom(1)\n    zoomInProgress = requestAnimationFrame(zoomIn)\n  }\n\n  /**\n   * Zoom out\n   */\n  const zoomOut = () => {\n    zoom(-1)\n    zoomInProgress = requestAnimationFrame(zoomOut)\n  }\n\n  /**\n   * Zoom stop\n   */\n  const zoomStop = () => {\n    cancelAnimationFrame(zoomInProgress)\n    zoomInProgress = null\n  }\n\n  /**\n   * Zoom to fit\n   */\n  const zoomToFit = () => {\n    const sphere = scene.current.boundingSphere\n    if (!sphere || sphere.radius === 0) return\n\n    // Center\n    const center = sphere.center\n\n    // Direction\n    const maxSize = 2 * sphere.radius\n    const fitHeight =\n      maxSize / (2 * Math.atan((Math.PI * camera.current.fov) / 360))\n    const fitWidth = fitHeight / camera.current.aspect\n    const distance = 1.1 * Math.max(fitHeight, fitWidth)\n    const direction = controls.current.target\n      .clone()\n      .sub(camera.current.position)\n      .normalize()\n      .multiplyScalar(distance)\n\n    // Controls\n    controls.current.target.copy(center)\n\n    // Camera\n    camera.current.position.copy(center).sub(direction)\n    camera.current.near = distance / 100\n    camera.current.far = distance * 100\n    camera.current.updateProjectionMatrix()\n\n    // Lights\n    scene.current.children.forEach((child) => {\n      if (child.type === 'PointLight') {\n        const position = child.position\n        const max = Math.max(\n          Math.max(Math.abs(position.x), Math.abs(position.y)),\n          Math.abs(position.z)\n        )\n        child.position.multiplyScalar((1.5 * distance) / max)\n      }\n    })\n  }\n\n  /**\n   * Load part\n   */\n  const loadPart = async () => {\n    // Events\n    const mouseMoveEvent = (child, uuid) => {\n      child.highlight(uuid)\n      setTimeout(() => dispatch(highlight(uuid)), 1)\n    }\n    const mouseDownEvent = (child, uuid) => {\n      const selected = child.getSelected()\n      if (selected.includes(uuid)) {\n        child.unselect(uuid)\n        setTimeout(() => dispatch(unselect(uuid)), 1)\n      } else {\n        child.select(uuid)\n        setTimeout(() => dispatch(select(uuid)), 1)\n      }\n    }\n\n    // Load\n    const loader = PartLoader(mouseMoveEvent, mouseDownEvent)\n    const mesh = loader.load(\n      part,\n      transparent,\n      sectionViewHelper.current.getClippingPlane(),\n      outlinePass.current\n    )\n\n    // Scene\n    scene.current.add(mesh)\n    computeSceneBoundingSphere()\n\n    // Grid\n    gridHelper.current.update()\n\n    // Zoom\n    zoomToFit()\n\n    // Colorbar\n    if (mesh?.children[1]?.children[0]?.lut) {\n      colorbarHelper.current.setLUT(mesh.children[1].children[0].lut)\n      colorbarHelper.current.setVisible(true)\n    } else {\n      colorbarHelper.current.setVisible(false)\n    }\n  }\n\n  /**\n   * Toggle grid\n   * @param {boolean} checked Checked\n   */\n  const toggleGrid = (checked) => {\n    gridHelper.current.setVisible(checked)\n  }\n\n  const toggleTransparent = (checked) => {\n    setTransparent(checked)\n    scene.current.children.forEach((child) => {\n      if (child.type === 'Part') {\n        child.setTransparent(checked)\n      }\n    })\n  }\n\n  /**\n   * Toggle section view\n   */\n  const toggleSectionView = () => {\n    const active = !sectionView\n    setSectionView(active)\n    active\n      ? sectionViewHelper.current.start()\n      : sectionViewHelper.current.stop()\n  }\n\n  /**\n   * Handle transform mode\n   * @param {Object} event Event\n   */\n  const handleTransform = (event) => {\n    const mode = event.target.value\n\n    setTransform(mode)\n\n    sectionViewHelper.current.setMode(mode)\n  }\n\n  /**\n   * Render\n   */\n  return (\n    <Layout className=\"View no-scroll\">\n      <Layout.Content className=\"View-content no-scroll\">\n        <div\n          style={{ display: loading ? 'flex' : 'none' }}\n          className=\"View-loading\"\n        >\n          <Spin indicator={<LoadingOutlined style={{ fontSize: 60 }} spin />} />\n        </div>\n        <div ref={mount} className=\"View-canvas\" />\n      </Layout.Content>\n      <div className=\"View-controls\">\n        <Tooltip title=\"Controls\">\n          <Button\n            icon={<ControlOutlined />}\n            onClick={() => setControlVisible(!controlVisible)}\n          />\n        </Tooltip>\n        <Drawer\n          className=\"View-controls-drawer\"\n          title=\"Controls\"\n          visible={controlVisible}\n          onClose={() => setControlVisible(!controlVisible)}\n          mask={false}\n          maskClosable={false}\n          placement=\"right\"\n          getContainer={false}\n          headerStyle={{\n            borderLeft: '1px solid #f0f0f0'\n          }}\n          bodyStyle={{\n            display: 'flex',\n            flexDirection: 'column',\n            padding: '10px',\n            borderLeft: '1px solid #f0f0f0'\n          }}\n          width=\"100%\"\n        >\n          <div className=\"drawer-group\">\n            <div className=\"drawer-subgroup\">\n              <Tooltip title=\"Display grid\">\n                <Switch\n                  defaultChecked\n                  checkedChildren={<BorderlessTableOutlined />}\n                  unCheckedChildren={<BorderlessTableOutlined />}\n                  onChange={toggleGrid}\n                />\n              </Tooltip>\n            </div>\n            <div className=\"drawer-subgroup\">\n              <Tooltip title=\"Set transparency\">\n                <Switch\n                  className=\"transparent\"\n                  checked={transparent}\n                  checkedChildren={<RadiusUprightOutlined />}\n                  unCheckedChildren={<RadiusUprightOutlined />}\n                  onChange={toggleTransparent}\n                />\n              </Tooltip>\n            </div>\n          </div>\n\n          <Divider />\n\n          <div className=\"drawer-group\">\n            <div className=\"drawer-subgroup\">\n              <Tooltip title=\"Zoom out\" placement=\"left\">\n                <Button\n                  icon={<ZoomOutOutlined />}\n                  onMouseDown={zoomOut}\n                  onMouseUp={zoomStop}\n                  onMouseOut={zoomStop}\n                />\n              </Tooltip>\n              <Tooltip title=\"Zoom to fit\" placement=\"left\">\n                <Button icon={<CompressOutlined />} onClick={zoomToFit} />\n              </Tooltip>\n              <Tooltip title=\"Zoom in\" placement=\"left\">\n                <Button\n                  icon={<ZoomInOutlined />}\n                  onMouseDown={zoomIn}\n                  onMouseUp={zoomStop}\n                  onMouseOut={zoomStop}\n                />\n              </Tooltip>\n            </div>\n            <div className=\"drawer-subgroup\">\n              <Tooltip title=\"Zoom to selection\" placement=\"left\">\n                <Button\n                  icon={<SelectOutlined />}\n                  onClick={() =>\n                    selectionHelper.current.isEnabled()\n                      ? selectionHelper.current.end()\n                      : selectionHelper.current.start()\n                  }\n                />\n              </Tooltip>\n            </div>\n          </div>\n\n          <Divider />\n\n          <div className=\"drawer-group\">\n            {sectionView ? (\n              <>\n                <div className=\"drawer-subgroup\">\n                  <Tooltip title=\"Stop\" placement=\"left\">\n                    <Button\n                      icon={<StopOutlined />}\n                      onClick={toggleSectionView}\n                    />\n                  </Tooltip>\n                  <Radio.Group\n                    onChange={handleTransform}\n                    value={transform}\n                    style={{\n                      display: 'flex',\n                      flexDirection: 'column',\n                      marginTop: '10px'\n                    }}\n                  >\n                    <Tooltip title=\"Translate\" placement=\"left\">\n                      <Radio value=\"translate\">\n                        <DragOutlined />\n                      </Radio>\n                    </Tooltip>\n                    <Tooltip title=\"Rotate\" placement=\"left\">\n                      <Radio value=\"rotate\">\n                        <SyncOutlined />\n                      </Radio>\n                    </Tooltip>\n                  </Radio.Group>\n                </div>\n                <div className=\"drawer-subgroup\">\n                  <Tooltip title=\"Hide plane\" placement=\"left\">\n                    <Button\n                      icon={<EyeInvisibleOutlined />}\n                      onClick={() => sectionViewHelper.current.toggleVisible()}\n                    />\n                  </Tooltip>\n                  <Tooltip title=\"Snap to X\" placement=\"left\">\n                    <Button\n                      className=\"ant-btn-icon-only\"\n                      onClick={() =>\n                        sectionViewHelper.current.toAxis(new Vector3(1, 0, 0))\n                      }\n                    >\n                      X\n                    </Button>\n                  </Tooltip>\n                  <Tooltip title=\"Snap to Y\" placement=\"left\">\n                    <Button\n                      className=\"ant-btn-icon-only\"\n                      onClick={() =>\n                        sectionViewHelper.current.toAxis(new Vector3(0, 1, 0))\n                      }\n                    >\n                      Y\n                    </Button>\n                  </Tooltip>\n                  <Tooltip title=\"Snap to Z\" placement=\"left\">\n                    <Button\n                      className=\"ant-btn-icon-only\"\n                      onClick={() =>\n                        sectionViewHelper.current.toAxis(new Vector3(0, 0, 1))\n                      }\n                    >\n                      Z\n                    </Button>\n                  </Tooltip>\n                  <Tooltip title=\"Flip\" placement=\"left\">\n                    <Button\n                      onClick={() => sectionViewHelper.current.flip()}\n                      icon={<RetweetOutlined />}\n                    />\n                  </Tooltip>\n                </div>\n              </>\n            ) : (\n              <Tooltip title=\"Section view\">\n                <Button\n                  icon={<ScissorOutlined />}\n                  onClick={toggleSectionView}\n                />\n              </Tooltip>\n            )}\n          </div>\n\n          <Divider />\n        </Drawer>\n      </div>\n    </Layout>\n  )\n}\n\n/**\n * View\n * @param {Object} Props props\n */\nconst View = ({ simulation, setPartSummary }) => {\n  // State\n  const [part, setPart] = useState()\n  const [loading, setLoading] = useState(false)\n\n  // Part\n  useEffect(() => {\n    const configuration = simulation?.scheme?.configuration\n\n    if (configuration?.part) loadPart(configuration.part)\n  }, [simulation])\n\n  /**\n   * Load part\n   * @param {Object} file File\n   */\n  const loadPart = async (file) => {\n    setLoading(true)\n    try {\n      // Load\n      const partContent = await PartAPI.get({ id: simulation.id }, file)\n\n      if (partContent.error) {\n        setPartSummary({ error: true, message: partContent.message })\n        return\n      }\n\n      // Convert buffers\n      partContent.solids?.forEach((solid) => {\n        solid.buffer = JSON.parse(Buffer.from(solid.buffer).toString())\n      })\n      partContent.faces?.forEach((face) => {\n        face.buffer = JSON.parse(Buffer.from(face.buffer).toString())\n      })\n      partContent.edges?.forEach((edge) => {\n        edge.buffer = JSON.parse(Buffer.from(edge.buffer).toString())\n      })\n\n      // Summary\n      const summary = {\n        uuid: partContent.uuid,\n        solids: partContent.solids?.map((solid) => {\n          return {\n            name: solid.name,\n            number: solid.number,\n            uuid: solid.buffer.uuid\n          }\n        }),\n        faces: partContent.faces?.map((face) => {\n          return {\n            name: face.name,\n            number: face.number,\n            uuid: face.buffer.uuid\n          }\n        }),\n        edges: partContent.edges?.map((edge) => {\n          return {\n            name: edge.name,\n            number: edge.number,\n            uuid: edge.buffer.uuid\n          }\n        })\n      }\n\n      setPart(partContent)\n      setPartSummary(summary)\n    } catch (err) {\n      Error(errors.partError, err)\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  /**\n   * Render\n   */\n  return <ThreeView loading={loading} part={part} />\n}\n\nexport default View\n"]},"metadata":{},"sourceType":"module"}