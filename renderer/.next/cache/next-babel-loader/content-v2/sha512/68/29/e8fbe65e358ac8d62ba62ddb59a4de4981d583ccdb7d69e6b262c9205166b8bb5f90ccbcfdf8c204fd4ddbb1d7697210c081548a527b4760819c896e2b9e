{"ast":null,"code":"import { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nimport _Layout from \"antd/lib/layout\";\nimport _Card from \"antd/lib/card\";\nimport _Space from \"antd/lib/space\";\nimport _Form from \"antd/lib/form\";\nimport _Input from \"antd/lib/input\";\nimport _Alert from \"antd/lib/alert\";\nimport _Button from \"antd/lib/button\";\nimport _Typography from \"antd/lib/typography\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _slicedToArray from \"@babel/runtime/helpers/esm/slicedToArray\";\n\nvar _jsxFileName = \"/home/simon/Documents/Git/Airthium/tanatloc-ssr/renderer/components/login/index.js\",\n    _this = this,\n    _s = $RefreshSig$();\n\n/** @module renderer/components/login */\nimport { useRouter } from 'next/router';\nimport { useState, useEffect } from 'react';\nimport Loading from '../loading'; //import Background from '../background'\n\nimport login from '../../../src/api/login';\nimport UserAPI from '../../../src/api/user';\nimport Sentry from '../../../src/lib/sentry';\n/**\n * Errors\n */\n\nvar errors = {\n  INTERNAL_ERROR: 'Server issue : try again shortly.',\n  BAD_CREDENTIALS: 'Incorrect credentials.'\n};\n/**\n * Login\n */\n\nvar Login = function Login() {\n  _s();\n\n  // State\n  var _useState = useState(false),\n      checking = _useState[0],\n      setChecking = _useState[1];\n\n  var _useState2 = useState(false),\n      loginErr = _useState2[0],\n      setLoginErr = _useState2[1];\n\n  var _useState3 = useState(false),\n      internalErr = _useState3[0],\n      setInternalErr = _useState3[1]; // Data\n\n\n  var _UserAPI$useUser = UserAPI.useUser(),\n      _UserAPI$useUser2 = _slicedToArray(_UserAPI$useUser, 2),\n      user = _UserAPI$useUser2[0],\n      _UserAPI$useUser2$ = _UserAPI$useUser2[1],\n      mutateUser = _UserAPI$useUser2$.mutateUser,\n      loadingUser = _UserAPI$useUser2$.loadingUser; // Router\n\n\n  var router = useRouter(); // Already connected\n\n  useEffect(function () {\n    if (user) router.push('/dashboard');\n  }, [user]); // Prefetch\n\n  useEffect(function () {\n    router.prefetch('/signup');\n    router.prefetch('/dashboard');\n  }, []);\n  /**\n   * Handle login\n   * @param {Object} values Values { username, password }\n   */\n\n  var onLogin = /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(values) {\n      var loggedUser;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              // State\n              setChecking(true);\n              setLoginErr(false);\n              setInternalErr(false); // Check\n\n              _context.prev = 3;\n              _context.next = 6;\n              return login(values);\n\n            case 6:\n              loggedUser = _context.sent;\n\n              if (loggedUser.ok) {\n                // Logged\n                mutateUser(loggedUser);\n                router.push('/dashboard');\n              } else {\n                // Bad\n                setLoginErr(true);\n                setChecking(false);\n              }\n\n              _context.next = 16;\n              break;\n\n            case 10:\n              _context.prev = 10;\n              _context.t0 = _context[\"catch\"](3);\n              setInternalErr(true);\n              setChecking(false);\n              console.error(_context.t0);\n              Sentry.captureException(_context.t0);\n\n            case 16:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[3, 10]]);\n    }));\n\n    return function onLogin(_x) {\n      return _ref.apply(this, arguments);\n    };\n  }();\n  /**\n   * Go to signup\n   */\n\n\n  var signUp = function signUp() {\n    router.push('/signup');\n  };\n  /**\n   * Render\n   */\n\n\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: loadingUser || user ? /*#__PURE__*/_jsxDEV(Loading, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 101,\n      columnNumber: 9\n    }, _this) : /*#__PURE__*/_jsxDEV(_Layout, {\n      children: /*#__PURE__*/_jsxDEV(_Card, {\n        bordered: false,\n        className: \"Login\",\n        children: /*#__PURE__*/_jsxDEV(_Space, {\n          direction: \"vertical\",\n          size: \"large\",\n          style: {\n            width: '100%'\n          },\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            children: [/*#__PURE__*/_jsxDEV(_Typography.Title, {\n              level: 1,\n              style: {\n                padding: 0,\n                marginBottom: 16,\n                fontWeight: 500\n              },\n              children: \"Log In\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 108,\n              columnNumber: 17\n            }, _this), /*#__PURE__*/_jsxDEV(_Typography.Text, {\n              children: [\"Your first time ?\", ' ', /*#__PURE__*/_jsxDEV(_Button, {\n                type: \"link\",\n                onClick: signUp,\n                children: \"Sign up\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 116,\n                columnNumber: 19\n              }, _this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 114,\n              columnNumber: 17\n            }, _this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 107,\n            columnNumber: 15\n          }, _this), /*#__PURE__*/_jsxDEV(_Form, {\n            requiredMark: \"optional\",\n            onFinish: onLogin,\n            layout: \"vertical\",\n            children: [(loginErr || internalErr) && /*#__PURE__*/_jsxDEV(_Alert, {\n              message: internalErr ? errors.INTERNAL_ERROR : errors.BAD_CREDENTIALS,\n              type: \"error\",\n              showIcon: true,\n              style: {\n                marginBottom: '16px'\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 127,\n              columnNumber: 19\n            }, _this), /*#__PURE__*/_jsxDEV(_Form.Item, {\n              name: \"username\",\n              label: \"Your email address\",\n              rules: [{\n                required: true,\n                message: 'Please enter your email'\n              }],\n              children: /*#__PURE__*/_jsxDEV(_Input, {\n                placeholder: \"Email address\",\n                autoComplete: \"email\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 147,\n                columnNumber: 19\n              }, _this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 140,\n              columnNumber: 17\n            }, _this), /*#__PURE__*/_jsxDEV(_Form.Item, {\n              name: \"password\",\n              label: \"Your password\",\n              rules: [{\n                required: true,\n                message: 'Please enter your password'\n              }],\n              style: {\n                marginBottom: '14px'\n              },\n              children: /*#__PURE__*/_jsxDEV(_Input.Password, {\n                placeholder: \"Password\",\n                autoComplete: \"current-password\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 157,\n                columnNumber: 19\n              }, _this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 149,\n              columnNumber: 17\n            }, _this), /*#__PURE__*/_jsxDEV(_Typography.Text, {\n              children: /*#__PURE__*/_jsxDEV(_Button, {\n                type: \"link\",\n                children: \"Forgot your password ?\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 163,\n                columnNumber: 19\n              }, _this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 162,\n              columnNumber: 17\n            }, _this), /*#__PURE__*/_jsxDEV(_Form.Item, {\n              className: \"Login-submit\",\n              children: /*#__PURE__*/_jsxDEV(_Button, {\n                type: \"primary\",\n                loading: checking,\n                htmlType: \"submit\",\n                children: \"Log in\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 166,\n                columnNumber: 19\n              }, _this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 165,\n              columnNumber: 17\n            }, _this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 121,\n            columnNumber: 15\n          }, _this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 106,\n          columnNumber: 13\n        }, _this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 105,\n        columnNumber: 11\n      }, _this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 103,\n      columnNumber: 9\n    }, _this)\n  }, void 0, false);\n};\n\n_s(Login, \"OmvNewcHralp90yoxm3aqkAT5Pc=\", false, function () {\n  return [UserAPI.useUser, useRouter];\n});\n\n_c = Login;\nexport default Login;\n\nvar _c;\n\n$RefreshReg$(_c, \"Login\");","map":{"version":3,"sources":["/home/simon/Documents/Git/Airthium/tanatloc-ssr/renderer/components/login/index.js"],"names":["useRouter","useState","useEffect","Loading","login","UserAPI","Sentry","errors","INTERNAL_ERROR","BAD_CREDENTIALS","Login","checking","setChecking","loginErr","setLoginErr","internalErr","setInternalErr","useUser","user","mutateUser","loadingUser","router","push","prefetch","onLogin","values","loggedUser","ok","console","error","captureException","signUp","width","padding","marginBottom","fontWeight","required","message"],"mappings":"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","sourcesContent":["/** @module renderer/components/login */\n\nimport { useRouter } from 'next/router'\nimport { useState, useEffect } from 'react'\nimport {\n  Button,\n  Card,\n  Form,\n  Input,\n  Layout,\n  Space,\n  Typography,\n  Alert\n} from 'antd'\n\nimport Loading from '../loading'\n//import Background from '../background'\n\nimport login from '../../../src/api/login'\nimport UserAPI from '../../../src/api/user'\n\nimport Sentry from '../../../src/lib/sentry'\n\n/**\n * Errors\n */\nconst errors = {\n  INTERNAL_ERROR: 'Server issue : try again shortly.',\n  BAD_CREDENTIALS: 'Incorrect credentials.'\n}\n\n/**\n * Login\n */\nconst Login = () => {\n  // State\n  const [checking, setChecking] = useState(false)\n  const [loginErr, setLoginErr] = useState(false)\n  const [internalErr, setInternalErr] = useState(false)\n\n  // Data\n  const [user, { mutateUser, loadingUser }] = UserAPI.useUser()\n\n  // Router\n  const router = useRouter()\n\n  // Already connected\n  useEffect(() => {\n    if (user) router.push('/dashboard')\n  }, [user])\n\n  // Prefetch\n  useEffect(() => {\n    router.prefetch('/signup')\n    router.prefetch('/dashboard')\n  }, [])\n\n  /**\n   * Handle login\n   * @param {Object} values Values { username, password }\n   */\n  const onLogin = async (values) => {\n    // State\n    setChecking(true)\n    setLoginErr(false)\n    setInternalErr(false)\n\n    // Check\n    try {\n      const loggedUser = await login(values)\n      if (loggedUser.ok) {\n        // Logged\n        mutateUser(loggedUser)\n        router.push('/dashboard')\n      } else {\n        // Bad\n        setLoginErr(true)\n        setChecking(false)\n      }\n    } catch (err) {\n      setInternalErr(true)\n      setChecking(false)\n      console.error(err)\n      Sentry.captureException(err)\n    }\n  }\n\n  /**\n   * Go to signup\n   */\n  const signUp = () => {\n    router.push('/signup')\n  }\n\n  /**\n   * Render\n   */\n  return (\n    <>\n      {loadingUser || user ? (\n        <Loading />\n      ) : (\n        <Layout>\n          {/*<Background />*/}\n          <Card bordered={false} className=\"Login\">\n            <Space direction=\"vertical\" size=\"large\" style={{ width: '100%' }}>\n              <div>\n                <Typography.Title\n                  level={1}\n                  style={{ padding: 0, marginBottom: 16, fontWeight: 500 }}\n                >\n                  Log In\n                </Typography.Title>\n                <Typography.Text>\n                  Your first time ?{' '}\n                  <Button type=\"link\" onClick={signUp}>\n                    Sign up\n                  </Button>\n                </Typography.Text>\n              </div>\n              <Form\n                requiredMark=\"optional\"\n                onFinish={onLogin}\n                layout=\"vertical\"\n              >\n                {(loginErr || internalErr) && (\n                  <Alert\n                    message={\n                      internalErr\n                        ? errors.INTERNAL_ERROR\n                        : errors.BAD_CREDENTIALS\n                    }\n                    type=\"error\"\n                    showIcon\n                    style={{\n                      marginBottom: '16px'\n                    }}\n                  />\n                )}\n                <Form.Item\n                  name=\"username\"\n                  label=\"Your email address\"\n                  rules={[\n                    { required: true, message: 'Please enter your email' }\n                  ]}\n                >\n                  <Input placeholder=\"Email address\" autoComplete=\"email\" />\n                </Form.Item>\n                <Form.Item\n                  name=\"password\"\n                  label=\"Your password\"\n                  rules={[\n                    { required: true, message: 'Please enter your password' }\n                  ]}\n                  style={{ marginBottom: '14px' }}\n                >\n                  <Input.Password\n                    placeholder=\"Password\"\n                    autoComplete=\"current-password\"\n                  />\n                </Form.Item>\n                <Typography.Text>\n                  <Button type=\"link\">Forgot your password ?</Button>\n                </Typography.Text>\n                <Form.Item className=\"Login-submit\">\n                  <Button type=\"primary\" loading={checking} htmlType=\"submit\">\n                    Log in\n                  </Button>\n                </Form.Item>\n              </Form>\n            </Space>\n          </Card>\n        </Layout>\n      )}\n    </>\n  )\n}\n\nexport default Login\n"]},"metadata":{},"sourceType":"module"}