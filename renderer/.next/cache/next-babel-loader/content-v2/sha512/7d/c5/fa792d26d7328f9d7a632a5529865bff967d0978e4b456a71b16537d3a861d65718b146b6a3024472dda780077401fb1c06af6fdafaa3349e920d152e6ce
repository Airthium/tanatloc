{"ast":null,"code":"import _Space from \"antd/lib/space\";\nimport _Typography from \"antd/lib/typography\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nimport _slicedToArray from \"@babel/runtime/helpers/esm/slicedToArray\";\nimport _Modal from \"antd/lib/modal\";\nimport _Layout from \"antd/lib/layout\";\nimport _Menu from \"antd/lib/menu\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\n\nvar _jsxFileName = \"/home/simon/Documents/Git/Airthium/tanatloc-ssr/renderer/components/project/simulation/index.js\",\n    _this = this,\n    _s = $RefreshSig$(),\n    _s2 = $RefreshSig$();\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\n/** @module renderer/components/project/simulation */\nimport { useState, useEffect } from 'react';\nimport { WarningOutlined } from '@ant-design/icons';\nimport { addedDiff, updatedDiff } from 'deep-object-diff';\nimport merge from 'lodash.merge';\nimport { Error } from '../../assets/notification';\nimport Panel from '../panel';\nimport About from './about';\nimport Geometry from './geometry';\nimport Materials from './materials';\nimport Parameters from './parameters';\nimport BoundaryConditions from './boundaryConditions';\nimport Run from './run';\nimport SimulationAPI from '../../../../src/api/simulation';\nimport models from '../../../../models';\n/**\n * Errors\n */\n\nvar errors = {\n  updateError: 'Unable to update the simulation'\n};\n/**\n * Simulation Selector\n * @param {Object} props Props\n */\n\nvar Selector = function Selector(_ref) {\n  _s();\n\n  var visible = _ref.visible,\n      onOk = _ref.onOk,\n      onCancel = _ref.onCancel;\n\n  // State\n  var _useState = useState(),\n      current = _useState[0],\n      setCurrent = _useState[1];\n\n  var _useState2 = useState(false),\n      loading = _useState2[0],\n      setLoading = _useState2[1];\n  /**\n   * On select\n   * @param {Object} data Data { key }\n   */\n\n\n  var onSelect = function onSelect(_ref2) {\n    var key = _ref2.key;\n    var model = models.find(function (m) {\n      return m.algorithm === key;\n    });\n    setCurrent(_objectSpread({}, model)); // TODO review that\n  };\n  /**\n   * On create\n   */\n\n\n  var onCreate = /*#__PURE__*/function () {\n    var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              setLoading(true);\n              if (current) onOk(current);\n              setLoading(false);\n\n            case 3:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function onCreate() {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n  /**\n   * MatJax\n   */\n\n\n  useEffect(function () {\n    var _window$MathJax;\n\n    (_window$MathJax = window.MathJax) === null || _window$MathJax === void 0 ? void 0 : _window$MathJax.typeset();\n  }, [current]);\n  /**\n   * Render\n   */\n\n  return /*#__PURE__*/_jsxDEV(_Modal, {\n    visible: visible,\n    title: \"Create simulation\",\n    okText: \"Create\",\n    okButtonProps: {\n      loading: loading\n    },\n    onOk: onCreate,\n    onCancel: onCancel,\n    children: /*#__PURE__*/_jsxDEV(_Layout, {\n      children: [/*#__PURE__*/_jsxDEV(_Layout.Sider, {\n        theme: \"light\",\n        children: /*#__PURE__*/_jsxDEV(_Menu, {\n          mode: \"inline\",\n          onSelect: onSelect,\n          children: models.map(function (model) {\n            return /*#__PURE__*/_jsxDEV(_Menu.Item, {\n              children: model.name\n            }, model.algorithm, false, {\n              fileName: _jsxFileName,\n              lineNumber: 82,\n              columnNumber: 22\n            }, _this);\n          })\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 80,\n          columnNumber: 11\n        }, _this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 79,\n        columnNumber: 9\n      }, _this), /*#__PURE__*/_jsxDEV(_Layout.Content, {\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          dangerouslySetInnerHTML: {\n            __html: current === null || current === void 0 ? void 0 : current.description\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 87,\n          columnNumber: 11\n        }, _this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 86,\n        columnNumber: 9\n      }, _this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 78,\n      columnNumber: 7\n    }, _this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 70,\n    columnNumber: 5\n  }, _this);\n};\n/**\n * Simulation\n * @param {Object} props Props\n */\n\n\n_s(Selector, \"tR2r2ZvZcZgVfmmWsMbLb6NF7tI=\");\n\n_c = Selector;\n\nvar Simulation = function Simulation(_ref4) {\n  _s2();\n\n  var project = _ref4.project,\n      simulation = _ref4.simulation,\n      type = _ref4.type,\n      part = _ref4.part,\n      onClose = _ref4.onClose;\n\n  // State\n  var _useState3 = useState(false),\n      needUpdate = _useState3[0],\n      setNeedUpdate = _useState3[1];\n\n  var _useState4 = useState(false),\n      loading = _useState4[0],\n      setLoading = _useState4[1];\n\n  var _useState5 = useState(false),\n      visible = _useState5[0],\n      setVisible = _useState5[1];\n\n  var _useState6 = useState(),\n      title = _useState6[0],\n      setTitle = _useState6[1]; // Data\n\n\n  var _SimulationAPI$useSim = SimulationAPI.useSimulations(project === null || project === void 0 ? void 0 : project.simulations),\n      _SimulationAPI$useSim2 = _slicedToArray(_SimulationAPI$useSim, 2),\n      mutateOneSimulation = _SimulationAPI$useSim2[1].mutateOneSimulation; // Check model update\n\n\n  useEffect(function () {\n    var currentModel = models.find(function (m) {\n      var _simulation$scheme;\n\n      return m.algorithm === (simulation === null || simulation === void 0 ? void 0 : (_simulation$scheme = simulation.scheme) === null || _simulation$scheme === void 0 ? void 0 : _simulation$scheme.algorithm);\n    });\n\n    if (currentModel && simulation !== null && simulation !== void 0 && simulation.scheme) {\n      var added = addedDiff(simulation.scheme, currentModel);\n      var updated = updatedDiff(simulation.scheme, currentModel);\n      if (Object.keys(added).length || Object.keys(updated).length) setNeedUpdate(true);else setNeedUpdate(false);\n    }\n  }, [simulation]);\n  /**\n   * Simulation effect\n   */\n\n  useEffect(function () {\n    var _simulation$scheme2, _configuration$geomet;\n\n    setVisible(simulation);\n    var configuration = simulation === null || simulation === void 0 ? void 0 : (_simulation$scheme2 = simulation.scheme) === null || _simulation$scheme2 === void 0 ? void 0 : _simulation$scheme2.configuration; // Check if a part is visible\n\n    if (configuration && !configuration.part && (_configuration$geomet = configuration.geometry) !== null && _configuration$geomet !== void 0 && _configuration$geomet.file) {\n      var newSimulation = _objectSpread({}, simulation); // Update local\n\n\n      newSimulation.scheme.configuration.part = configuration.geometry.file; // Update simulation\n\n      SimulationAPI.update({\n        id: simulation.id\n      }, [{\n        key: 'scheme',\n        type: 'json',\n        method: 'diff',\n        path: ['configuration', 'part'],\n        value: configuration.geometry.file\n      }]).then(function () {\n        // Mutate\n        mutateOneSimulation(newSimulation);\n      })[\"catch\"](function (err) {\n        Error(errors.updateError, err);\n      });\n    }\n\n    var subScheme = configuration === null || configuration === void 0 ? void 0 : configuration[type];\n    setTitle(subScheme ? subScheme.title : 'About');\n  }, [simulation, type]);\n  /**\n   * On update\n   */\n\n  var onUpdate = /*#__PURE__*/function () {\n    var _ref5 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n      var currentModel, newSimulation;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              setLoading(true);\n              _context2.prev = 1;\n              // Current model\n              currentModel = models.find(function (m) {\n                var _simulation$scheme3;\n\n                return m.algorithm === (simulation === null || simulation === void 0 ? void 0 : (_simulation$scheme3 = simulation.scheme) === null || _simulation$scheme3 === void 0 ? void 0 : _simulation$scheme3.algorithm);\n              }); // New simulation\n\n              newSimulation = _objectSpread({}, simulation); // Merge\n\n              merge(newSimulation.scheme, currentModel); // Update simulation\n\n              _context2.next = 7;\n              return SimulationAPI.update({\n                id: simulation.id\n              }, [{\n                key: 'scheme',\n                value: newSimulation.scheme\n              }]);\n\n            case 7:\n              // Mutate\n              mutateOneSimulation(newSimulation);\n              _context2.next = 13;\n              break;\n\n            case 10:\n              _context2.prev = 10;\n              _context2.t0 = _context2[\"catch\"](1);\n              Error(errors.updateError, _context2.t0);\n\n            case 13:\n              setLoading(false);\n              setNeedUpdate(false);\n\n            case 15:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2, null, [[1, 10]]);\n    }));\n\n    return function onUpdate() {\n      return _ref5.apply(this, arguments);\n    };\n  }();\n  /**\n   * Render\n   */\n\n\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(_Modal, {\n      title: /*#__PURE__*/_jsxDEV(_Fragment, {\n        children: [/*#__PURE__*/_jsxDEV(WarningOutlined, {\n          style: {\n            color: 'orange',\n            marginRight: '5px'\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 207,\n          columnNumber: 13\n        }, _this), \"Update\"]\n      }, void 0, true),\n      visible: needUpdate,\n      onOk: onUpdate,\n      okText: \"Yes\",\n      confirmLoading: loading,\n      onCancel: function onCancel() {\n        return setNeedUpdate(false);\n      },\n      cancelText: \"No\",\n      children: /*#__PURE__*/_jsxDEV(_Space, {\n        direction: \"vertical\",\n        children: [/*#__PURE__*/_jsxDEV(_Typography.Text, {\n          children: \"Your model needs an update!\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 219,\n          columnNumber: 11\n        }, _this), /*#__PURE__*/_jsxDEV(_Typography.Text, {\n          strong: true,\n          children: \"Update now?\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 220,\n          columnNumber: 11\n        }, _this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 218,\n        columnNumber: 9\n      }, _this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 204,\n      columnNumber: 7\n    }, _this), /*#__PURE__*/_jsxDEV(Panel, {\n      visible: visible,\n      title: title,\n      onClose: onClose,\n      children: [type === 'about' && /*#__PURE__*/_jsxDEV(About, {\n        project: project,\n        simulation: simulation\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 225,\n        columnNumber: 11\n      }, _this), type === 'geometry' && /*#__PURE__*/_jsxDEV(Geometry, {\n        project: project,\n        simulation: simulation,\n        part: part\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 228,\n        columnNumber: 11\n      }, _this), type === 'parameters' && /*#__PURE__*/_jsxDEV(Parameters, {\n        project: project,\n        simulation: simulation\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 231,\n        columnNumber: 11\n      }, _this), type === 'materials' && /*#__PURE__*/_jsxDEV(Materials, {\n        project: project,\n        simulation: simulation,\n        part: part,\n        setVisible: setVisible\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 234,\n        columnNumber: 11\n      }, _this), type === 'boundaryConditions' && /*#__PURE__*/_jsxDEV(BoundaryConditions, {\n        project: project,\n        simulation: simulation,\n        part: part,\n        setVisible: setVisible\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 242,\n        columnNumber: 11\n      }, _this), type === 'run' && /*#__PURE__*/_jsxDEV(Run, {\n        project: project,\n        simulation: simulation\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 249,\n        columnNumber: 28\n      }, _this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 223,\n      columnNumber: 7\n    }, _this)]\n  }, void 0, true);\n};\n\n_s2(Simulation, \"arVVyVj7kgZlbCG1DFGUgnQ8l80=\", false, function () {\n  return [SimulationAPI.useSimulations];\n});\n\n_c2 = Simulation;\nSimulation.Selector = Selector;\nexport default Simulation;\n\nvar _c, _c2;\n\n$RefreshReg$(_c, \"Selector\");\n$RefreshReg$(_c2, \"Simulation\");","map":{"version":3,"sources":["/home/simon/Documents/Git/Airthium/tanatloc-ssr/renderer/components/project/simulation/index.js"],"names":["useState","useEffect","WarningOutlined","addedDiff","updatedDiff","merge","Error","Panel","About","Geometry","Materials","Parameters","BoundaryConditions","Run","SimulationAPI","models","errors","updateError","Selector","visible","onOk","onCancel","current","setCurrent","loading","setLoading","onSelect","key","model","find","m","algorithm","onCreate","window","MathJax","typeset","map","name","__html","description","Simulation","project","simulation","type","part","onClose","needUpdate","setNeedUpdate","setVisible","title","setTitle","useSimulations","simulations","mutateOneSimulation","currentModel","scheme","added","updated","Object","keys","length","configuration","geometry","file","newSimulation","update","id","method","path","value","then","err","subScheme","onUpdate","color","marginRight"],"mappings":"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","sourcesContent":["/** @module renderer/components/project/simulation */\n\nimport { useState, useEffect } from 'react'\nimport { Layout, Menu, Modal, Space, Typography } from 'antd'\nimport { WarningOutlined } from '@ant-design/icons'\nimport { addedDiff, updatedDiff } from 'deep-object-diff'\nimport merge from 'lodash.merge'\n\nimport { Error } from '../../assets/notification'\n\nimport Panel from '../panel'\n\nimport About from './about'\nimport Geometry from './geometry'\nimport Materials from './materials'\nimport Parameters from './parameters'\nimport BoundaryConditions from './boundaryConditions'\nimport Run from './run'\n\nimport SimulationAPI from '../../../../src/api/simulation'\n\nimport models from '../../../../models'\n\n/**\n * Errors\n */\nconst errors = {\n  updateError: 'Unable to update the simulation'\n}\n\n/**\n * Simulation Selector\n * @param {Object} props Props\n */\nconst Selector = ({ visible, onOk, onCancel }) => {\n  // State\n  const [current, setCurrent] = useState()\n  const [loading, setLoading] = useState(false)\n\n  /**\n   * On select\n   * @param {Object} data Data { key }\n   */\n  const onSelect = ({ key }) => {\n    const model = models.find((m) => m.algorithm === key)\n    setCurrent({ ...model })\n    // TODO review that\n  }\n\n  /**\n   * On create\n   */\n  const onCreate = async () => {\n    setLoading(true)\n    if (current) onOk(current)\n    setLoading(false)\n  }\n\n  /**\n   * MatJax\n   */\n  useEffect(() => {\n    window.MathJax?.typeset()\n  }, [current])\n\n  /**\n   * Render\n   */\n  return (\n    <Modal\n      visible={visible}\n      title=\"Create simulation\"\n      okText=\"Create\"\n      okButtonProps={{ loading: loading }}\n      onOk={onCreate}\n      onCancel={onCancel}\n    >\n      <Layout>\n        <Layout.Sider theme=\"light\">\n          <Menu mode=\"inline\" onSelect={onSelect}>\n            {models.map((model) => {\n              return <Menu.Item key={model.algorithm}>{model.name}</Menu.Item>\n            })}\n          </Menu>\n        </Layout.Sider>\n        <Layout.Content>\n          <div dangerouslySetInnerHTML={{ __html: current?.description }} />\n        </Layout.Content>\n      </Layout>\n    </Modal>\n  )\n}\n\n/**\n * Simulation\n * @param {Object} props Props\n */\nconst Simulation = ({ project, simulation, type, part, onClose }) => {\n  // State\n  const [needUpdate, setNeedUpdate] = useState(false)\n  const [loading, setLoading] = useState(false)\n  const [visible, setVisible] = useState(false)\n  const [title, setTitle] = useState()\n\n  // Data\n  const [, { mutateOneSimulation }] = SimulationAPI.useSimulations(\n    project?.simulations\n  )\n\n  // Check model update\n  useEffect(() => {\n    const currentModel = models.find(\n      (m) => m.algorithm === simulation?.scheme?.algorithm\n    )\n\n    if (currentModel && simulation?.scheme) {\n      const added = addedDiff(simulation.scheme, currentModel)\n      const updated = updatedDiff(simulation.scheme, currentModel)\n\n      if (Object.keys(added).length || Object.keys(updated).length)\n        setNeedUpdate(true)\n      else setNeedUpdate(false)\n    }\n  }, [simulation])\n\n  /**\n   * Simulation effect\n   */\n  useEffect(() => {\n    setVisible(simulation)\n    const configuration = simulation?.scheme?.configuration\n\n    // Check if a part is visible\n    if (configuration && !configuration.part && configuration.geometry?.file) {\n      const newSimulation = { ...simulation }\n\n      // Update local\n      newSimulation.scheme.configuration.part = configuration.geometry.file\n\n      // Update simulation\n      SimulationAPI.update({ id: simulation.id }, [\n        {\n          key: 'scheme',\n          type: 'json',\n          method: 'diff',\n          path: ['configuration', 'part'],\n          value: configuration.geometry.file\n        }\n      ])\n        .then(() => {\n          // Mutate\n          mutateOneSimulation(newSimulation)\n        })\n        .catch((err) => {\n          Error(errors.updateError, err)\n        })\n    }\n\n    const subScheme = configuration?.[type]\n    setTitle(subScheme ? subScheme.title : 'About')\n  }, [simulation, type])\n\n  /**\n   * On update\n   */\n  const onUpdate = async () => {\n    setLoading(true)\n\n    try {\n      // Current model\n      const currentModel = models.find(\n        (m) => m.algorithm === simulation?.scheme?.algorithm\n      )\n\n      // New simulation\n      const newSimulation = { ...simulation }\n\n      // Merge\n      merge(newSimulation.scheme, currentModel)\n\n      // Update simulation\n      await SimulationAPI.update({ id: simulation.id }, [\n        {\n          key: 'scheme',\n          value: newSimulation.scheme\n        }\n      ])\n\n      // Mutate\n      mutateOneSimulation(newSimulation)\n    } catch (err) {\n      Error(errors.updateError, err)\n    }\n\n    setLoading(false)\n    setNeedUpdate(false)\n  }\n\n  /**\n   * Render\n   */\n  return (\n    <>\n      <Modal\n        title={\n          <>\n            <WarningOutlined style={{ color: 'orange', marginRight: '5px' }} />\n            Update\n          </>\n        }\n        visible={needUpdate}\n        onOk={onUpdate}\n        okText=\"Yes\"\n        confirmLoading={loading}\n        onCancel={() => setNeedUpdate(false)}\n        cancelText=\"No\"\n      >\n        <Space direction=\"vertical\">\n          <Typography.Text>Your model needs an update!</Typography.Text>\n          <Typography.Text strong>Update now?</Typography.Text>\n        </Space>\n      </Modal>\n      <Panel visible={visible} title={title} onClose={onClose}>\n        {type === 'about' && (\n          <About project={project} simulation={simulation} />\n        )}\n        {type === 'geometry' && (\n          <Geometry project={project} simulation={simulation} part={part} />\n        )}\n        {type === 'parameters' && (\n          <Parameters project={project} simulation={simulation} />\n        )}\n        {type === 'materials' && (\n          <Materials\n            project={project}\n            simulation={simulation}\n            part={part}\n            setVisible={setVisible}\n          />\n        )}\n        {type === 'boundaryConditions' && (\n          <BoundaryConditions\n            project={project}\n            simulation={simulation}\n            part={part}\n            setVisible={setVisible}\n          />\n        )}\n        {type === 'run' && <Run project={project} simulation={simulation} />}\n      </Panel>\n    </>\n  )\n}\n\nSimulation.Selector = Selector\n\nexport default Simulation\n"]},"metadata":{},"sourceType":"module"}