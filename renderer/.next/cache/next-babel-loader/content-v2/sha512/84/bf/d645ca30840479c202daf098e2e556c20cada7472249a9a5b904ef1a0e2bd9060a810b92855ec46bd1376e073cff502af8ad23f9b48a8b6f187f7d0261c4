{"ast":null,"code":"import _Layout from \"antd/lib/layout\";\nimport _Collapse from \"antd/lib/collapse\";\nimport _Card from \"antd/lib/card\";\nimport _Space from \"antd/lib/space\";\nimport _Select from \"antd/lib/select\";\nimport _Typography from \"antd/lib/typography\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport { useState, useEffect } from 'react';\nimport { Error } from '../../../assets/notification';\nimport Formula from '../../../assets/formula';\nimport SimulationAPI from '../../../../../src/api/simulation';\n/**\n * Errors simulation/parameters\n * @memberof module:renderer/components/project/simulation\n */\n\nconst errors = {\n  updateError: 'Unable to update the simulation'\n};\n/**\n * Parameters\n * @memberof module:renderer/components/project/simulation\n * @param {Object} props Props\n */\n\nconst Parameters = ({\n  project,\n  simulation\n}) => {\n  // State\n  const {\n    0: values,\n    1: setValues\n  } = useState({}); // Data\n\n  const subScheme = simulation === null || simulation === void 0 ? void 0 : simulation.scheme.configuration.parameters;\n  const [, {\n    mutateOneSimulation\n  }] = SimulationAPI.useSimulations(project === null || project === void 0 ? void 0 : project.simulations); // Effect\n\n  useEffect(() => {\n    const newSimulation = _objectSpread({}, simulation); // Update local\n\n\n    Object.keys(values).forEach(key => {\n      const deepValues = values[key];\n      deepValues.forEach((value, index) => {\n        if (value) newSimulation.scheme.configuration.parameters[key].children[index].value = value;\n      });\n    }); // Diff\n\n    const diff = _objectSpread(_objectSpread({}, newSimulation.scheme.configuration.parameters), {}, {\n      done: true\n    }); // Update\n\n\n    SimulationAPI.update({\n      id: simulation.id\n    }, [{\n      key: 'scheme',\n      type: 'json',\n      method: 'diff',\n      path: ['configuration', 'parameters'],\n      value: diff\n    }]).then(() => {\n      // Mutate\n      mutateOneSimulation(newSimulation);\n    }).catch(err => {\n      Error(errors.updateError, err);\n    });\n  }, [values]);\n  /**\n   * On parameter change\n   * @param {string} key Parameter key\n   * @param {number} index Children index\n   * @param {string} value Value\n   */\n\n  const onChange = (key, index, value) => {\n    const deepValues = values[key] || [];\n    deepValues[index] = value;\n\n    const newValues = _objectSpread(_objectSpread({}, values), {}, {\n      [key]: deepValues\n    });\n\n    setValues(newValues);\n  }; // Build parameters\n\n\n  const parameters = [];\n  const advanced = [];\n  Object.keys(subScheme).forEach(key => {\n    if (key === 'index' || key === 'title' || key == 'done') return;\n    const parameter = subScheme[key];\n    const components = parameter === null || parameter === void 0 ? void 0 : parameter.children.map((child, index) => {\n      if (child.htmlEntity === 'formula') {\n        return /*#__PURE__*/_jsxs(_Typography.Text, {\n          children: [child.label, \":\", /*#__PURE__*/_jsx(\"br\", {}), /*#__PURE__*/_jsx(Formula, {\n            defaultValue: child.value === undefined ? child.default : child.value,\n            onChange: value => onChange(key, index, value),\n            unit: child.unit\n          })]\n        }, key + '&' + index);\n      } else if (child.htmlEntity === 'select') {\n        return /*#__PURE__*/_jsxs(_Typography.Text, {\n          children: [child.label, \":\", /*#__PURE__*/_jsx(\"br\", {}), /*#__PURE__*/_jsx(_Select, {\n            options: child.options,\n            defaultValue: child.value || child.default,\n            onChange: value => onChange(key, index, value)\n          })]\n        }, key + '&' + index);\n      }\n    });\n\n    if (parameter !== null && parameter !== void 0 && parameter.advanced) {\n      advanced.push( /*#__PURE__*/_jsx(_Card, {\n        title: parameter === null || parameter === void 0 ? void 0 : parameter.label,\n        children: /*#__PURE__*/_jsx(_Space, {\n          direction: \"vertical\",\n          children: components\n        })\n      }, key));\n    } else {\n      parameters.push( /*#__PURE__*/_jsx(_Card, {\n        title: parameter === null || parameter === void 0 ? void 0 : parameter.label,\n        children: /*#__PURE__*/_jsx(_Space, {\n          direction: \"vertical\",\n          children: components\n        })\n      }, key));\n    }\n  });\n  /**\n   * Render\n   */\n\n  return /*#__PURE__*/_jsx(_Layout, {\n    children: /*#__PURE__*/_jsxs(_Layout.Content, {\n      children: [parameters, /*#__PURE__*/_jsx(_Collapse, {\n        children: /*#__PURE__*/_jsx(_Collapse.Panel, {\n          header: \"Advanced\",\n          children: advanced\n        })\n      })]\n    })\n  });\n};\n\nexport default Parameters;","map":null,"metadata":{},"sourceType":"module"}