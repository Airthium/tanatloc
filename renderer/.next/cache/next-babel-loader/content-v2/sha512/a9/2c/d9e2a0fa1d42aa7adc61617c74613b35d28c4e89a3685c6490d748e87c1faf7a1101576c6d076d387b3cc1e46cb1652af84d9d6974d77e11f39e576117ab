{"ast":null,"code":"import { Fragment as _Fragment } from \"react/jsx-runtime\";\nimport _Layout from \"antd/lib/layout\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport _Menu from \"antd/lib/menu\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\n\n/** @module renderer/components/dashboard */\nimport { useRouter } from 'next/router';\nimport { useState, useEffect } from 'react';\nimport { AppstoreFilled, ShareAltOutlined, SettingFilled, QuestionCircleFilled, LogoutOutlined } from '@ant-design/icons';\nimport { Error } from '../assets/notification';\nimport Loading from '../../components/loading';\nimport Welcome from './welcome';\nimport Workspace from '../../components/workspace';\nimport Add from '../../components/workspace/add';\nimport Account from '../../components/account';\nimport Help from '../../components/help';\nimport UserAPI from '../../../src/api/user';\nimport WorkspaceAPI from '../../../src/api/workspace';\nimport logout from '../../../src/api/logout';\n/**\n * Errors\n */\n\nconst errors = {\n  logoutError: 'Unable to logout'\n};\n/**\n * Dashboard menu items\n */\n\nconst menuItems = {\n  workspaces: {\n    label: 'My Workspaces',\n    key: 'my_workspaces'\n  },\n  shared: {\n    label: 'Shared With Me',\n    key: 'shared'\n  },\n  account: {\n    label: 'Account Settings',\n    key: 'account'\n  },\n  help: {\n    label: 'I Need Help',\n    key: 'help'\n  },\n  logout: {\n    label: 'Logout',\n    key: 'logout'\n  }\n};\n/**\n * Dashboard\n */\n\nconst Dashboard = () => {\n  // State\n  const {\n    0: currentView,\n    1: setCurrentView\n  } = useState();\n  const {\n    0: currentWorkspace,\n    1: setCurrentWorkspace\n  } = useState(); // Data\n\n  const [user, {\n    mutateUser,\n    loadingUser\n  }] = UserAPI.useUser();\n  const [workspaces] = WorkspaceAPI.useWorkspaces(); // Router\n\n  const router = useRouter();\n  const {\n    page,\n    workspaceId\n  } = router.query; // Not logged -> go to login page\n\n  useEffect(() => {\n    if (!loadingUser && !user) router.replace('/login');\n  }, [user, loadingUser]); // Update workspace\n\n  useEffect(() => {\n    if (currentWorkspace) {\n      const workspace = workspaces === null || workspaces === void 0 ? void 0 : workspaces.find(w => w.id === currentWorkspace.id);\n      if (JSON.stringify(workspace) !== JSON.stringify(currentWorkspace)) setCurrentWorkspace(workspace);\n    }\n  }, [workspaces, currentWorkspace]); // Page effect\n\n  useEffect(() => {\n    if (workspaceId) {\n      var _workspace$owners, _workspace$users;\n\n      const workspace = workspaces === null || workspaces === void 0 ? void 0 : workspaces.find(w => w.id === workspaceId);\n      if (workspace !== null && workspace !== void 0 && (_workspace$owners = workspace.owners) !== null && _workspace$owners !== void 0 && _workspace$owners.find(o => o.id === user.id)) setCurrentView(menuItems.workspaces.key);else if (workspace !== null && workspace !== void 0 && (_workspace$users = workspace.users) !== null && _workspace$users !== void 0 && _workspace$users.find(u => u.id === user.id)) setCurrentView(menuItems.shared.key);\n      setCurrentWorkspace(workspace);\n    } else if (page) {\n      setCurrentView(page);\n    }\n  }, [page, workspaceId]);\n  /**\n   * Menu selection\n   * @param {Object} data {item, key}\n   */\n\n  const onSelect = ({\n    item,\n    key\n  }) => {\n    const subMenuKey = item.props.subMenuKey.replace('-menu-', ''); // In a submenu\n\n    if (subMenuKey === menuItems.workspaces.key || subMenuKey === menuItems.shared.key) {\n      setCurrentView(subMenuKey);\n      router.replace({\n        pathname: '/dashboard',\n        query: {\n          page: subMenuKey\n        }\n      });\n      const workspace = workspaces[key];\n      setCurrentWorkspace(workspace);\n    } else {\n      if (key === menuItems.logout.key) handleLogout();else {\n        setCurrentView(key);\n        router.replace({\n          pathname: '/dashboard',\n          query: {\n            page: key\n          }\n        });\n      }\n    }\n  };\n  /**\n   * Logout\n   */\n\n\n  const handleLogout = async () => {\n    try {\n      await logout();\n      mutateUser({\n        user: null\n      });\n      router.push('/');\n    } catch (err) {\n      Error(errors.logoutError, err);\n    }\n  }; // My / Shared workspaces\n\n\n  let myWorkspaces = [];\n  let sharedWorkspaces = [];\n\n  if (user) {\n    workspaces === null || workspaces === void 0 ? void 0 : workspaces.forEach((workspace, index) => {\n      if (workspace.owners && workspace.owners.find(o => o.id === user.id)) myWorkspaces.push( /*#__PURE__*/_jsx(_Menu.Item, {\n        children: workspace.name\n      }, index));else if (workspace.users && workspace.users.find(u => u.id === user.id)) sharedWorkspaces.push( /*#__PURE__*/_jsx(_Menu.Item, {\n        children: workspace.name\n      }, index));\n    });\n  }\n  /**\n   * On workspaces\n   */\n\n\n  const onWorkspaces = () => {\n    if (!(myWorkspaces !== null && myWorkspaces !== void 0 && myWorkspaces.length)) {\n      setCurrentView();\n    }\n  };\n\n  let displayed;\n\n  switch (currentView) {\n    case menuItems.workspaces.key:\n    case menuItems.shared.key:\n      displayed = /*#__PURE__*/_jsx(Workspace, {\n        workspace: currentWorkspace\n      });\n      break;\n\n    case menuItems.account.key:\n      displayed = /*#__PURE__*/_jsx(Account, {});\n      break;\n\n    case menuItems.help.key:\n      displayed = /*#__PURE__*/_jsx(Help, {});\n      break;\n\n    default:\n      displayed = /*#__PURE__*/_jsx(Welcome, {});\n  }\n  /**\n   * Render\n   */\n\n\n  return /*#__PURE__*/_jsx(_Fragment, {\n    children: loadingUser || !user ? /*#__PURE__*/_jsx(Loading, {}) : /*#__PURE__*/_jsxs(_Layout, {\n      children: [/*#__PURE__*/_jsxs(_Layout.Sider, {\n        theme: \"light\",\n        width: \"250\",\n        className: \"Dashboard-sider\",\n        children: [/*#__PURE__*/_jsx(\"div\", {\n          className: \"logo\",\n          children: /*#__PURE__*/_jsx(\"img\", {\n            src: \"/images/logo_enora.svg\"\n          })\n        }), /*#__PURE__*/_jsxs(_Menu, {\n          className: \"Dashboard-menu\",\n          theme: \"light\",\n          onClick: onSelect,\n          defaultOpenKeys: [menuItems.workspaces.key, menuItems.shared.key],\n          mode: \"inline\",\n          children: [/*#__PURE__*/_jsxs(_Menu.SubMenu, {\n            icon: /*#__PURE__*/_jsx(AppstoreFilled, {}),\n            title: menuItems.workspaces.label,\n            onTitleClick: onWorkspaces,\n            children: [myWorkspaces, /*#__PURE__*/_jsx(\"li\", {\n              id: \"Add-workspace-button\",\n              children: /*#__PURE__*/_jsx(Add, {}, \"add\")\n            })]\n          }, menuItems.workspaces.key), /*#__PURE__*/_jsx(_Menu.SubMenu, {\n            icon: /*#__PURE__*/_jsx(ShareAltOutlined, {}),\n            title: menuItems.shared.label,\n            children: sharedWorkspaces\n          }, menuItems.shared.key), /*#__PURE__*/_jsx(_Menu.Item, {\n            icon: /*#__PURE__*/_jsx(SettingFilled, {}),\n            children: menuItems.account.label\n          }, menuItems.account.key), /*#__PURE__*/_jsx(_Menu.Item, {\n            icon: /*#__PURE__*/_jsx(QuestionCircleFilled, {}),\n            children: menuItems.help.label\n          }, menuItems.help.key), /*#__PURE__*/_jsx(_Menu.Divider, {}), /*#__PURE__*/_jsx(_Menu.Item, {\n            danger: true,\n            icon: /*#__PURE__*/_jsx(LogoutOutlined, {}),\n            children: menuItems.logout.label\n          }, menuItems.logout.key)]\n        })]\n      }), /*#__PURE__*/_jsx(_Layout.Content, {\n        className: \"no-scroll\",\n        children: displayed\n      })]\n    })\n  });\n};\n\nexport default Dashboard;","map":null,"metadata":{},"sourceType":"module"}