{"ast":null,"code":"import { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nimport _Layout from \"antd/lib/layout\";\nimport _Menu from \"antd/lib/menu\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _slicedToArray from \"@babel/runtime/helpers/esm/slicedToArray\";\n\nvar _jsxFileName = \"/home/simon/Documents/Git/Airthium/tanatloc-ssr/renderer/components/dashboard/index.js\",\n    _this = this,\n    _s = $RefreshSig$();\n\n/** @module renderer/components/dashboard */\nimport { useRouter } from 'next/router';\nimport { useState, useEffect } from 'react';\nimport { AppstoreFilled, ShareAltOutlined, SettingFilled, QuestionCircleFilled, LogoutOutlined } from '@ant-design/icons';\nimport { Error } from '../assets/notification';\nimport Loading from '../../components/loading';\nimport Welcome from './welcome';\nimport Workspace from '../../components/workspace';\nimport Add from '../../components/workspace/add';\nimport Account from '../../components/account';\nimport Help from '../../components/help';\nimport UserAPI from '../../../src/api/user';\nimport WorkspaceAPI from '../../../src/api/workspace';\nimport logout from '../../../src/api/logout';\n/**\n * Errors\n */\n\nvar errors = {\n  logoutError: 'Unable to logout'\n};\n/**\n * Dashboard menu items\n */\n\nvar menuItems = {\n  workspaces: {\n    label: 'My Workspaces',\n    key: 'my_workspaces'\n  },\n  shared: {\n    label: 'Shared With Me',\n    key: 'shared'\n  },\n  account: {\n    label: 'Account Settings',\n    key: 'account'\n  },\n  help: {\n    label: 'I Need Help',\n    key: 'help'\n  },\n  logout: {\n    label: 'Logout',\n    key: 'logout'\n  }\n};\n/**\n * Dashboard\n */\n\nvar Dashboard = function Dashboard() {\n  _s();\n\n  // State\n  var _useState = useState(),\n      currentView = _useState[0],\n      setCurrentView = _useState[1];\n\n  var _useState2 = useState(),\n      currentWorkspace = _useState2[0],\n      setCurrentWorkspace = _useState2[1]; // Data\n\n\n  var _UserAPI$useUser = UserAPI.useUser(),\n      _UserAPI$useUser2 = _slicedToArray(_UserAPI$useUser, 2),\n      user = _UserAPI$useUser2[0],\n      _UserAPI$useUser2$ = _UserAPI$useUser2[1],\n      mutateUser = _UserAPI$useUser2$.mutateUser,\n      loadingUser = _UserAPI$useUser2$.loadingUser;\n\n  var _WorkspaceAPI$useWork = WorkspaceAPI.useWorkspaces(),\n      _WorkspaceAPI$useWork2 = _slicedToArray(_WorkspaceAPI$useWork, 1),\n      workspaces = _WorkspaceAPI$useWork2[0]; // Router\n\n\n  var router = useRouter();\n  var _router$query = router.query,\n      page = _router$query.page,\n      workspaceId = _router$query.workspaceId; // Not logged -> go to login page\n\n  useEffect(function () {\n    if (!loadingUser && !user) router.replace('/login');\n  }, [user, loadingUser]); // Update workspace\n\n  useEffect(function () {\n    if (currentWorkspace) {\n      var workspace = workspaces === null || workspaces === void 0 ? void 0 : workspaces.find(function (w) {\n        return w.id === currentWorkspace.id;\n      });\n      if (JSON.stringify(workspace) !== JSON.stringify(currentWorkspace)) setCurrentWorkspace(workspace);\n    }\n  }, [workspaces, currentWorkspace]); // Page effect\n\n  useEffect(function () {\n    if (workspaceId) {\n      var _workspace$owners, _workspace$users;\n\n      var workspace = workspaces === null || workspaces === void 0 ? void 0 : workspaces.find(function (w) {\n        return w.id === workspaceId;\n      });\n      if (workspace !== null && workspace !== void 0 && (_workspace$owners = workspace.owners) !== null && _workspace$owners !== void 0 && _workspace$owners.find(function (o) {\n        return o.id === user.id;\n      })) setCurrentView(menuItems.workspaces.key);else if (workspace !== null && workspace !== void 0 && (_workspace$users = workspace.users) !== null && _workspace$users !== void 0 && _workspace$users.find(function (u) {\n        return u.id === user.id;\n      })) setCurrentView(menuItems.shared.key);\n      setCurrentWorkspace(workspace);\n    } else if (page) {\n      setCurrentView(page);\n    }\n  }, [page, workspaceId]);\n  /**\n   * Menu selection\n   * @param {Object} data {item, key}\n   */\n\n  var onSelect = function onSelect(_ref) {\n    var item = _ref.item,\n        key = _ref.key;\n    var subMenuKey = item.props.subMenuKey.replace('-menu-', ''); // In a submenu\n\n    if (subMenuKey === menuItems.workspaces.key || subMenuKey === menuItems.shared.key) {\n      setCurrentView(subMenuKey);\n      router.replace({\n        pathname: '/dashboard',\n        query: {\n          page: subMenuKey\n        }\n      });\n      var workspace = workspaces[key];\n      setCurrentWorkspace(workspace);\n    } else {\n      if (key === menuItems.logout.key) handleLogout();else {\n        setCurrentView(key);\n        router.replace({\n          pathname: '/dashboard',\n          query: {\n            page: key\n          }\n        });\n      }\n    }\n  };\n  /**\n   * Logout\n   */\n\n\n  var handleLogout = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.prev = 0;\n              _context.next = 3;\n              return logout();\n\n            case 3:\n              mutateUser({\n                user: null\n              });\n              router.push('/');\n              _context.next = 10;\n              break;\n\n            case 7:\n              _context.prev = 7;\n              _context.t0 = _context[\"catch\"](0);\n              Error(errors.logoutError, _context.t0);\n\n            case 10:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[0, 7]]);\n    }));\n\n    return function handleLogout() {\n      return _ref2.apply(this, arguments);\n    };\n  }(); // My / Shared workspaces\n\n\n  var myWorkspaces = [];\n  var sharedWorkspaces = [];\n\n  if (user) {\n    workspaces === null || workspaces === void 0 ? void 0 : workspaces.forEach(function (workspace, index) {\n      if (workspace.owners && workspace.owners.find(function (o) {\n        return o.id === user.id;\n      })) myWorkspaces.push( /*#__PURE__*/_jsxDEV(_Menu.Item, {\n        children: workspace.name\n      }, index, false, {\n        fileName: _jsxFileName,\n        lineNumber: 156,\n        columnNumber: 27\n      }, _this));else if (workspace.users && workspace.users.find(function (u) {\n        return u.id === user.id;\n      })) sharedWorkspaces.push( /*#__PURE__*/_jsxDEV(_Menu.Item, {\n        children: workspace.name\n      }, index, false, {\n        fileName: _jsxFileName,\n        lineNumber: 159,\n        columnNumber: 11\n      }, _this));\n    });\n  }\n  /**\n   * On workspaces\n   */\n\n\n  var onWorkspaces = function onWorkspaces() {\n    if (!(myWorkspaces !== null && myWorkspaces !== void 0 && myWorkspaces.length)) {\n      setCurrentView();\n    }\n  };\n\n  var displayed;\n\n  switch (currentView) {\n    case menuItems.workspaces.key:\n    case menuItems.shared.key:\n      displayed = /*#__PURE__*/_jsxDEV(Workspace, {\n        workspace: currentWorkspace\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 177,\n        columnNumber: 19\n      }, _this);\n      break;\n\n    case menuItems.account.key:\n      displayed = /*#__PURE__*/_jsxDEV(Account, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 180,\n        columnNumber: 19\n      }, _this);\n      break;\n\n    case menuItems.help.key:\n      displayed = /*#__PURE__*/_jsxDEV(Help, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 183,\n        columnNumber: 19\n      }, _this);\n      break;\n\n    default:\n      displayed = /*#__PURE__*/_jsxDEV(Welcome, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 186,\n        columnNumber: 19\n      }, _this);\n  }\n  /**\n   * Render\n   */\n\n\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: loadingUser || !user ? /*#__PURE__*/_jsxDEV(Loading, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 195,\n      columnNumber: 9\n    }, _this) : /*#__PURE__*/_jsxDEV(_Layout, {\n      children: [/*#__PURE__*/_jsxDEV(_Layout.Sider, {\n        theme: \"light\",\n        width: \"250\",\n        className: \"Dashboard-sider\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"logo\",\n          children: /*#__PURE__*/_jsxDEV(\"img\", {\n            src: \"/images/logo_enora.svg\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 200,\n            columnNumber: 15\n          }, _this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 199,\n          columnNumber: 13\n        }, _this), /*#__PURE__*/_jsxDEV(_Menu, {\n          className: \"Dashboard-menu\",\n          theme: \"light\",\n          onClick: onSelect,\n          defaultOpenKeys: [menuItems.workspaces.key, menuItems.shared.key],\n          mode: \"inline\",\n          children: [/*#__PURE__*/_jsxDEV(_Menu.SubMenu, {\n            icon: /*#__PURE__*/_jsxDEV(AppstoreFilled, {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 212,\n              columnNumber: 23\n            }, _this),\n            title: menuItems.workspaces.label,\n            onTitleClick: onWorkspaces,\n            children: [myWorkspaces, /*#__PURE__*/_jsxDEV(\"li\", {\n              id: \"Add-workspace-button\",\n              children: /*#__PURE__*/_jsxDEV(Add, {}, \"add\", false, {\n                fileName: _jsxFileName,\n                lineNumber: 218,\n                columnNumber: 19\n              }, _this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 217,\n              columnNumber: 17\n            }, _this)]\n          }, menuItems.workspaces.key, true, {\n            fileName: _jsxFileName,\n            lineNumber: 210,\n            columnNumber: 15\n          }, _this), /*#__PURE__*/_jsxDEV(_Menu.SubMenu, {\n            icon: /*#__PURE__*/_jsxDEV(ShareAltOutlined, {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 223,\n              columnNumber: 23\n            }, _this),\n            title: menuItems.shared.label,\n            children: sharedWorkspaces\n          }, menuItems.shared.key, false, {\n            fileName: _jsxFileName,\n            lineNumber: 221,\n            columnNumber: 15\n          }, _this), /*#__PURE__*/_jsxDEV(_Menu.Item, {\n            icon: /*#__PURE__*/_jsxDEV(SettingFilled, {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 228,\n              columnNumber: 60\n            }, _this),\n            children: menuItems.account.label\n          }, menuItems.account.key, false, {\n            fileName: _jsxFileName,\n            lineNumber: 228,\n            columnNumber: 15\n          }, _this), /*#__PURE__*/_jsxDEV(_Menu.Item, {\n            icon: /*#__PURE__*/_jsxDEV(QuestionCircleFilled, {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 233,\n              columnNumber: 23\n            }, _this),\n            children: menuItems.help.label\n          }, menuItems.help.key, false, {\n            fileName: _jsxFileName,\n            lineNumber: 231,\n            columnNumber: 15\n          }, _this), /*#__PURE__*/_jsxDEV(_Menu.Divider, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 237,\n            columnNumber: 15\n          }, _this), /*#__PURE__*/_jsxDEV(_Menu.Item, {\n            danger: true,\n            icon: /*#__PURE__*/_jsxDEV(LogoutOutlined, {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 241,\n              columnNumber: 23\n            }, _this),\n            children: menuItems.logout.label\n          }, menuItems.logout.key, false, {\n            fileName: _jsxFileName,\n            lineNumber: 238,\n            columnNumber: 15\n          }, _this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 203,\n          columnNumber: 13\n        }, _this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 198,\n        columnNumber: 11\n      }, _this), /*#__PURE__*/_jsxDEV(_Layout.Content, {\n        className: \"no-scroll\",\n        children: displayed\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 248,\n        columnNumber: 11\n      }, _this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 197,\n      columnNumber: 9\n    }, _this)\n  }, void 0, false);\n};\n\n_s(Dashboard, \"0Mb0UI1mxkjp9R94W0X37c9M9dM=\", false, function () {\n  return [UserAPI.useUser, WorkspaceAPI.useWorkspaces, useRouter];\n});\n\n_c = Dashboard;\nexport default Dashboard;\n\nvar _c;\n\n$RefreshReg$(_c, \"Dashboard\");","map":{"version":3,"sources":["/home/simon/Documents/Git/Airthium/tanatloc-ssr/renderer/components/dashboard/index.js"],"names":["useRouter","useState","useEffect","AppstoreFilled","ShareAltOutlined","SettingFilled","QuestionCircleFilled","LogoutOutlined","Error","Loading","Welcome","Workspace","Add","Account","Help","UserAPI","WorkspaceAPI","logout","errors","logoutError","menuItems","workspaces","label","key","shared","account","help","Dashboard","currentView","setCurrentView","currentWorkspace","setCurrentWorkspace","useUser","user","mutateUser","loadingUser","useWorkspaces","router","query","page","workspaceId","replace","workspace","find","w","id","JSON","stringify","owners","o","users","u","onSelect","item","subMenuKey","props","pathname","handleLogout","push","myWorkspaces","sharedWorkspaces","forEach","index","name","onWorkspaces","length","displayed"],"mappings":"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","sourcesContent":["/** @module renderer/components/dashboard */\n\nimport { useRouter } from 'next/router'\nimport { useState, useEffect } from 'react'\nimport { Layout, Menu } from 'antd'\nimport {\n  AppstoreFilled,\n  ShareAltOutlined,\n  SettingFilled,\n  QuestionCircleFilled,\n  LogoutOutlined\n} from '@ant-design/icons'\n\nimport { Error } from '../assets/notification'\n\nimport Loading from '../../components/loading'\nimport Welcome from './welcome'\nimport Workspace from '../../components/workspace'\nimport Add from '../../components/workspace/add'\nimport Account from '../../components/account'\nimport Help from '../../components/help'\n\nimport UserAPI from '../../../src/api/user'\nimport WorkspaceAPI from '../../../src/api/workspace'\nimport logout from '../../../src/api/logout'\n\n/**\n * Errors\n */\nconst errors = {\n  logoutError: 'Unable to logout'\n}\n\n/**\n * Dashboard menu items\n */\nconst menuItems = {\n  workspaces: {\n    label: 'My Workspaces',\n    key: 'my_workspaces'\n  },\n  shared: {\n    label: 'Shared With Me',\n    key: 'shared'\n  },\n  account: {\n    label: 'Account Settings',\n    key: 'account'\n  },\n  help: {\n    label: 'I Need Help',\n    key: 'help'\n  },\n  logout: {\n    label: 'Logout',\n    key: 'logout'\n  }\n}\n\n/**\n * Dashboard\n */\nconst Dashboard = () => {\n  // State\n  const [currentView, setCurrentView] = useState()\n  const [currentWorkspace, setCurrentWorkspace] = useState()\n\n  // Data\n  const [user, { mutateUser, loadingUser }] = UserAPI.useUser()\n  const [workspaces] = WorkspaceAPI.useWorkspaces()\n\n  // Router\n  const router = useRouter()\n  const { page, workspaceId } = router.query\n\n  // Not logged -> go to login page\n  useEffect(() => {\n    if (!loadingUser && !user) router.replace('/login')\n  }, [user, loadingUser])\n\n  // Update workspace\n  useEffect(() => {\n    if (currentWorkspace) {\n      const workspace = workspaces?.find((w) => w.id === currentWorkspace.id)\n      if (JSON.stringify(workspace) !== JSON.stringify(currentWorkspace))\n        setCurrentWorkspace(workspace)\n    }\n  }, [workspaces, currentWorkspace])\n\n  // Page effect\n  useEffect(() => {\n    if (workspaceId) {\n      const workspace = workspaces?.find((w) => w.id === workspaceId)\n      if (workspace?.owners?.find((o) => o.id === user.id))\n        setCurrentView(menuItems.workspaces.key)\n      else if (workspace?.users?.find((u) => u.id === user.id))\n        setCurrentView(menuItems.shared.key)\n      setCurrentWorkspace(workspace)\n    } else if (page) {\n      setCurrentView(page)\n    }\n  }, [page, workspaceId])\n\n  /**\n   * Menu selection\n   * @param {Object} data {item, key}\n   */\n  const onSelect = ({ item, key }) => {\n    const subMenuKey = item.props.subMenuKey.replace('-menu-', '')\n\n    // In a submenu\n    if (\n      subMenuKey === menuItems.workspaces.key ||\n      subMenuKey === menuItems.shared.key\n    ) {\n      setCurrentView(subMenuKey)\n      router.replace({\n        pathname: '/dashboard',\n        query: { page: subMenuKey }\n      })\n\n      const workspace = workspaces[key]\n      setCurrentWorkspace(workspace)\n    } else {\n      if (key === menuItems.logout.key) handleLogout()\n      else {\n        setCurrentView(key)\n        router.replace({\n          pathname: '/dashboard',\n          query: { page: key }\n        })\n      }\n    }\n  }\n\n  /**\n   * Logout\n   */\n  const handleLogout = async () => {\n    try {\n      await logout()\n      mutateUser({ user: null })\n\n      router.push('/')\n    } catch (err) {\n      Error(errors.logoutError, err)\n    }\n  }\n\n  // My / Shared workspaces\n  let myWorkspaces = []\n  let sharedWorkspaces = []\n  if (user) {\n    workspaces?.forEach((workspace, index) => {\n      if (workspace.owners && workspace.owners.find((o) => o.id === user.id))\n        myWorkspaces.push(<Menu.Item key={index}>{workspace.name}</Menu.Item>)\n      else if (workspace.users && workspace.users.find((u) => u.id === user.id))\n        sharedWorkspaces.push(\n          <Menu.Item key={index}>{workspace.name}</Menu.Item>\n        )\n    })\n  }\n\n  /**\n   * On workspaces\n   */\n  const onWorkspaces = () => {\n    if (!myWorkspaces?.length) {\n      setCurrentView()\n    }\n  }\n\n  let displayed\n  switch (currentView) {\n    case menuItems.workspaces.key:\n    case menuItems.shared.key:\n      displayed = <Workspace workspace={currentWorkspace} />\n      break\n    case menuItems.account.key:\n      displayed = <Account />\n      break\n    case menuItems.help.key:\n      displayed = <Help />\n      break\n    default:\n      displayed = <Welcome />\n  }\n\n  /**\n   * Render\n   */\n  return (\n    <>\n      {loadingUser || !user ? (\n        <Loading />\n      ) : (\n        <Layout>\n          <Layout.Sider theme=\"light\" width=\"250\" className=\"Dashboard-sider\">\n            <div className=\"logo\">\n              <img src=\"/images/logo_enora.svg\" />\n            </div>\n\n            <Menu\n              className=\"Dashboard-menu\"\n              theme=\"light\"\n              onClick={onSelect}\n              defaultOpenKeys={[menuItems.workspaces.key, menuItems.shared.key]}\n              mode=\"inline\"\n            >\n              <Menu.SubMenu\n                key={menuItems.workspaces.key}\n                icon={<AppstoreFilled />}\n                title={menuItems.workspaces.label}\n                onTitleClick={onWorkspaces}\n              >\n                {myWorkspaces}\n                <li id=\"Add-workspace-button\">\n                  <Add key=\"add\" />\n                </li>\n              </Menu.SubMenu>\n              <Menu.SubMenu\n                key={menuItems.shared.key}\n                icon={<ShareAltOutlined />}\n                title={menuItems.shared.label}\n              >\n                {sharedWorkspaces}\n              </Menu.SubMenu>\n              <Menu.Item key={menuItems.account.key} icon={<SettingFilled />}>\n                {menuItems.account.label}\n              </Menu.Item>\n              <Menu.Item\n                key={menuItems.help.key}\n                icon={<QuestionCircleFilled />}\n              >\n                {menuItems.help.label}\n              </Menu.Item>\n              <Menu.Divider />\n              <Menu.Item\n                key={menuItems.logout.key}\n                danger={true}\n                icon={<LogoutOutlined />}\n              >\n                {menuItems.logout.label}\n              </Menu.Item>\n            </Menu>\n          </Layout.Sider>\n\n          <Layout.Content className=\"no-scroll\">{displayed}</Layout.Content>\n        </Layout>\n      )}\n    </>\n  )\n}\n\nexport default Dashboard\n"]},"metadata":{},"sourceType":"module"}